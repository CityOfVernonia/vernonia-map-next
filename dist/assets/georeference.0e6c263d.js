import{a6 as t,y as n,n as r,a8 as e,bX as o,c2 as a,h8 as i,h4 as s,h6 as l,gD as c,g2 as p,gd as u,kY as g,p0 as f,gt as h,k0 as y,gs as m,f8 as A,p1 as d,hs as v,z as w,ab as x,iw as T,p2 as F,hw as M,kW as R,bh as b,fL as E,mV as N,cv as j,lZ as z,p3 as L,gy as _}from"./vendor.9770a310.js";import{a as P,v as B,x as k}from"./axisAngleDegrees.427db55f.js";import{e as I,a as O,f as Y}from"./vec33.fc83c3d5.js";import{M as G,_ as S,R as q,v as D,F as V,B as W,V as X,k as Z,L as C}from"./projection.9c98dd23.js";var H;let J=H=class extends e{constructor(t){super(t),this.origin=o(),this.translation=o(),this.rotation=P(),this.scale=a(1,1,1),this.geographic=!0}get localMatrix(){const t=p();return i(t,t,this.scale),s(t,t,k(this.rotation),B(this.rotation)),l(t,t,this.translation),t}get localMatrixInverse(){return c(p(),this.localMatrix)}applyLocal(t,n){return u(n,t,this.localMatrix)}applyLocalInverse(t,n){return u(n,t,this.localMatrixInverse)}project(t,n){const r=new Float64Array(t.length),e=g.fromTypedArray(r),o=g.fromTypedArray(t);if(this.geographic){const t=f(h(n)),a=p();return y(n,this.origin,a,t),m(a,a,this.localMatrix),I(e,o,a),A(r,t,0,r,n,0,r.length/3),r}const{localMatrix:a,origin:i}=this;d(a,v)?O(e,o):I(e,o,a);for(let s=0;s<r.length;s+=3)r[s+0]+=i[0],r[s+1]+=i[1],r[s+2]+=i[2];return r}getOriginPoint(t){const[n,r,e]=this.origin;return new w({x:n,y:r,z:e,spatialReference:t})}equals(t){return x(t)&&this.geographic===t.geographic&&T(this.origin,t.origin)&&F(this.localMatrix,t.localMatrix)}clone(){const t={origin:M(this.origin),translation:M(this.translation),rotation:P(this.rotation),scale:M(this.scale),geographic:this.geographic};return new H(t)}};t([n({type:[Number],nonNullable:!0,json:{write:!0}})],J.prototype,"origin",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],J.prototype,"translation",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],J.prototype,"rotation",void 0),t([n({type:[Number],nonNullable:!0,json:{write:!0}})],J.prototype,"scale",void 0),t([n({type:Boolean,nonNullable:!0,json:{write:!0}})],J.prototype,"geographic",void 0),t([n()],J.prototype,"localMatrix",null),t([n()],J.prototype,"localMatrixInverse",null),J=H=t([r("esri.geometry.support.MeshTransform")],J);var K=J;function Q(t,n){var r;return t.isGeographic||t.isWebMercator&&(null==(r=null==n?void 0:n.geographic)||r)}function U(t,n,r){return Q(n.spatialReference,r)?function(t,n,r){const e=n.spatialReference,o=st(n,r,ut),a=new Float64Array(t.position.length),i=function(t,n,r,e){I(g.fromTypedArray(e),g.fromTypedArray(t),n);const o=new Float64Array(t.length);return G(e,o,r)}(t.position,o,e,a),s=R(ft,o);return{position:i,normal:et(i,a,t.normal,s,e),tangent:ot(i,a,t.tangent,s,e)}}(t,n,r):function(t,n,r){const e=new Float64Array(t.position.length),o=t.position,a=n.x,i=n.y,s=n.z||0,{horizontal:l,vertical:c}=pt(r?r.unit:null,n.spatialReference);for(let p=0;p<o.length;p+=3)e[p+0]=o[p+0]*l+a,e[p+1]=o[p+1]*l+i,e[p+2]=o[p+2]*c+s;return{position:e,normal:t.normal,tangent:t.tangent}}(t,n,r)}function $(t,n,r){const{position:e,normal:o,tangent:a}=t;if(b(n))return{position:e,normal:o,tangent:a};const i=n.localMatrix;return U({position:X(e,new Float64Array(e.length),i),normal:x(o)?Z(o,new Float32Array(o.length),i):null,tangent:x(a)?C(a,new Float32Array(a.length),i):null},n.getOriginPoint(r),{geographic:n.geographic})}function tt(t,n,r){if(null!=r&&r.useTransform){var e;const{position:o,normal:a,tangent:i}=t;return{vertexAttributes:{position:o,normal:a,tangent:i},transform:new K({origin:[n.x,n.y,null!=(e=n.z)?e:0],geographic:Q(n.spatialReference,r)})}}return{vertexAttributes:U(t,n,r),transform:null}}function nt(t,n,r){return Q(n.spatialReference,r)?it(t,n,r):at(t,n,r)}function rt(t,n,r,e){if(b(n))return nt(t,r,e);const o=$(t,n,r.spatialReference);return r.equals(n.getOriginPoint(r.spatialReference))?at(o,r,e):Q(r.spatialReference,e)?it(o,r,e):at(o,r,e)}function et(t,n,r,e,o){if(b(r))return null;const a=new Float32Array(r.length);return Y(E.fromTypedArray(a),E.fromTypedArray(r),e),S(a,t,n,o,a),a}function ot(t,n,r,e,o){if(b(r))return null;const a=new Float32Array(r.length);Y(E.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT),E.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),e);for(let i=3;i<a.length;i+=4)a[i]=r[i];return q(a,t,n,o,a),a}function at(t,n,r){const e=new Float64Array(t.position.length),o=t.position,a=n.x,i=n.y,s=n.z||0,{horizontal:l,vertical:c}=pt(r?r.unit:null,n.spatialReference);for(let p=0;p<o.length;p+=3)e[p+0]=(o[p+0]-a)/l,e[p+1]=(o[p+1]-i)/l,e[p+2]=(o[p+2]-s)/c;return{position:e,normal:t.normal,tangent:t.tangent}}function it(t,n,r){const e=n.spatialReference;st(n,r,ut);const o=c(gt,ut),a=new Float64Array(t.position.length),i=function(t,n,r,e){const o=D(t,n,e),a=g.fromTypedArray(o),i=new Float64Array(o.length),s=g.fromTypedArray(i);return I(s,a,r),i}(t.position,e,o,a),s=R(ft,o);return{position:i,normal:lt(t.normal,t.position,a,e,s),tangent:ct(t.tangent,t.position,a,e,s)}}function st(t,n,r){y(t.spatialReference,[t.x,t.y,t.z||0],r,N(t.spatialReference));const{horizontal:e,vertical:o}=pt(n?n.unit:null,t.spatialReference);return i(r,r,[e,e,o]),r}function lt(t,n,r,e,o){if(b(t))return null;const a=V(t,n,r,e,new Float32Array(t.length)),i=E.fromTypedArray(a);return Y(i,i,o),a}function ct(t,n,r,e,o){if(b(t))return null;const a=W(t,n,r,e,new Float32Array(t.length)),i=E.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT);return Y(i,i,o),a}function pt(t,n){if(b(t))return ht;const r=n.isGeographic?1:j(n),e=n.isGeographic?1:z(n),o=L(1,t,"meters");return{horizontal:o*r,vertical:o*e}}const ut=p(),gt=p(),ft=_(),ht={horizontal:1,vertical:1};export{nt as M,K as O,rt as P,$ as _,tt as k,Q as r,U as x};
