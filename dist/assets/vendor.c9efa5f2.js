var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,a=(e,t)=>{for(var i in t||(t={}))s.call(t,i)&&o(e,i,t[i]);if(r)for(var i of r(t))n.call(t,i)&&o(e,i,t[i]);return e},l=(e,r)=>t(e,i(r));const h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0;var c,u;let p;var d,f;function y(e){return"function"==typeof p[e]?p[e]=p[e](h):p[e]}p=null!=(c=h.dojoConfig)&&c.has||null!=(u=h.esriConfig)&&u.has?a(a({},null==(d=h.dojoConfig)?void 0:d.has),null==(f=h.esriConfig)?void 0:f.has):{},y.add=(e,t,i,r)=>((r||void 0===p[e])&&(p[e]=t),i&&y(e)),y.cache=p,y.add("esri-deprecation-warnings",!0),(()=>{y.add("host-webworker",void 0!==h.WorkerGlobalScope&&self instanceof h.WorkerGlobalScope);const e="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(y.add("host-browser",e),y.add("host-node","object"==typeof h.process&&h.process.versions&&h.process.versions.node&&h.process.versions.v8),y.add("dom",e),y("host-browser")){const e=navigator,t=e.userAgent,i=e.appVersion,r=parseFloat(i);if(y.add("wp",parseFloat(t.split("Windows Phone")[1])||void 0),y.add("msapp",parseFloat(t.split("MSAppHost/")[1])||void 0),y.add("khtml",i.includes("Konqueror")?r:void 0),y.add("edge",parseFloat(t.split("Edge/")[1])||void 0),y.add("opr",parseFloat(t.split("OPR/")[1])||void 0),y.add("webkit",!y("wp")&&!y("edge")&&parseFloat(t.split("WebKit/")[1])||void 0),y.add("chrome",!y("edge")&&!y("opr")&&parseFloat(t.split("Chrome/")[1])||void 0),y.add("android",!y("wp")&&parseFloat(t.split("Android ")[1])||void 0),y.add("safari",!i.includes("Safari")||y("wp")||y("chrome")||y("android")||y("edge")||y("opr")?void 0:parseFloat(i.split("Version/")[1])),y.add("mac",i.includes("Macintosh")),!y("wp")&&t.match(/(iPhone|iPod|iPad)/)){const e=RegExp.$1.replace(/P/,"p"),i=t.match(/OS ([\d_]+)/)?RegExp.$1:"1",r=parseFloat(i.replace(/_/,".").replace(/_/g,""));y.add(e,r),y.add("ios",r)}y.add("trident",parseFloat(i.split("Trident/")[1])||void 0),y("webkit")||(!t.includes("Gecko")||y("wp")||y("khtml")||y("trident")||y("edge")||y.add("mozilla",r),y("mozilla")&&y.add("ff",parseFloat(t.split("Firefox/")[1]||t.split("Minefield/")[1])||void 0))}})(),(()=>{if(h.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&y.add("esri-mobile",t),i&&y.add("esri-iPhone",i),y.add("esri-geolocation",!!navigator.geolocation)}y.add("esri-canvas-svg-support",!y("trident")),y.add("esri-wasm","WebAssembly"in h),y.add("esri-shared-array-buffer",(()=>{const e="SharedArrayBuffer"in h,t=!1===h.crossOriginIsolated;return e&&!t})),y.add("esri-atomics","Atomics"in h),y.add("esri-workers","Worker"in h),y.add("esri-text-decoder","TextDecoder"in h),y.add("esri-text-encoder","TextEncoder"in h),y.add("web-feat:cache","caches"in h),y.add("esri-workers-arraybuffer-transfer",!y("safari")||Number(y("safari"))>=12),y.add("featurelayer-snapshot-enabled",!0),y.add("featurelayer-snapshot-point-min-threshold",8e4),y.add("featurelayer-snapshot-point-max-threshold",4e5),y.add("featurelayer-snapshot-point-coverage",.1),y.add("featurelayer-advanced-symbols",!1),y.add("featurelayer-pbf",!0),y.add("featurelayer-pbf-statistics",!1),y.add("feature-layers-workers",!0),y.add("mapview-transitions-duration",200),y.add("mapserver-pbf-enabled",!1),y("host-webworker")||y("host-browser")&&(y.add("csp-restrictions",(()=>{try{new Function}catch{return!0}return!1})),y.add("esri-image-decode",(()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then((()=>{y.add("esri-image-decode",!0,!0,!0)})).catch((()=>{y.add("esri-image-decode",!1,!0,!0)}))}return!1})),y.add("esri-url-encodes-apostrophe",(()=>{const e=h.document.createElement("a");return e.href="?'",e.href.includes("?%27")})),y.add("vectortilelayer-max-buffers",y("ff")?160:Number.POSITIVE_INFINITY))})();const g=null;function m(e){return null!=e}function v(e){return null==e}function b(e){return void 0===e}function w(e,t){return m(e)?t(e):null}function _(e){return e}function x(e,t){if(v(e))throw new Error(t);return e}function S(e,t){return m(e)?e:"function"==typeof t?t():t}function M(e){return m(e)&&e.destroy(),null}function T(e){return m(e)&&e.dispose(),null}function I(e){return m(e)&&e.remove(),null}function E(e){return m(e)&&e.abort(),null}function A(e){return m(e)&&e.release(),null}function P(e,t){const i=new Array;for(const r of e)i.push(O(r,null,t));return i}function C(e,t){for(const i of e)O(i,null,t)}function O(e,t,i){return m(e)?i(e):t}function k(e,t){return m(e)?t(e):null}function L(e){return e.filter((e=>m(e)))}function R(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function D(e){return e}function F(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function j(e,t,i){if(e.slice)return e.slice(t,i);void 0===t?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),void 0===i?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function N(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}function z(e){return e instanceof Uint8Array||e&&e.constructor&&"Uint8Array"===e.constructor.name}function V(e){return e instanceof Uint16Array||e&&e.constructor&&"Uint16Array"===e.constructor.name}function U(e){return e instanceof Uint32Array||e&&e.constructor&&"Uint32Array"===e.constructor.name}function G(e){return e instanceof Float32Array||e&&e.constructor&&"Float32Array"===e.constructor.name}function B(e){return e instanceof Float64Array||e&&e.constructor&&"Float64Array"===e.constructor.name}function q(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(void 0===e[i]?delete e[i]:e[i]instanceof Object&&q(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&void 0===e[i]&&delete e[i];return e}function H(e){if(!e||"object"!=typeof e||"function"==typeof e)return e;if((t=e)instanceof Int8Array||t&&t.constructor&&"Int8Array"===t.constructor.name||z(e)||function(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&"Uint8ClampedArray"===e.constructor.name}(e)||function(e){return e instanceof Int16Array||e&&e.constructor&&"Int16Array"===e.constructor.name}(e)||V(e)||function(e){return e instanceof Int32Array||e&&e.constructor&&"Int32Array"===e.constructor.name}(e)||U(e)||G(e)||B(e))return j(e);var t;if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach(((e,i)=>{t.set(i,H(e))})),t}if(e instanceof Set){const t=new Set;return e.forEach((e=>{t.add(H(e))})),t}let i;const r=e;if("function"==typeof r.clone)i=r.clone();else if("function"==typeof r.map&&"function"==typeof r.forEach)i=r.map(H);else if("function"==typeof r.notifyChange&&"function"==typeof r.watch)i=r.clone();else{i={};for(const t of Object.getOwnPropertyNames(e))i[t]=H(e[t])}return i}function W(e,t){return e===t||"number"==typeof e&&isNaN(e)&&"number"==typeof t&&isNaN(t)||"function"==typeof(e||{}).getTime&&"function"==typeof(t||{}).getTime&&e.getTime()===t.getTime()||!1}function $(e,t,i=!1){return Y(e,t,i)}function J(e,t){if(null!=t)return t[e]||K(e.split("."),!1,t)}function X(e,t,i){const r=e.split("."),s=r.pop(),n=K(r,!0,i);n&&s&&(n[s]=t)}function K(e,t,i){let r=i;for(const s of e){if(null==r)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function Y(e,t,i){return t?Object.keys(t).reduce((function(e,r){let s=e[r],n=t[r];return s===n?e:void 0===s?(e[r]=H(n),e):(Array.isArray(n)||Array.isArray(e)?(s=s?Array.isArray(s)?e[r]=s.concat():e[r]=[s]:e[r]=[],n&&(Array.isArray(n)||(n=[n]),i?n.forEach((e=>{-1===s.indexOf(e)&&s.push(e)})):e[r]=n.concat())):n&&"object"==typeof n?e[r]=Y(s,n,i):e.hasOwnProperty(r)&&!t.hasOwnProperty(r)||(e[r]=n),e)}),e||{}):e}const Z={apiKey:void 0,applicationUrl:h.location&&h.location.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryService:null,geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(h.esriConfig&&($(Z,h.esriConfig,!0),delete Z.has),!Z.assetsPath){const e="4.20.2";Z.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}function Q(e,t,i,r){var s,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}Z.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(Z,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),Z.request.corsEnabledServers=[],Z.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};class ee{constructor(e,t={ignoreUnknown:!1}){this.jsonToAPI=e,this.options=t,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this.invertMap(e),this.apiValues=this.getKeysSorted(this.apiToJSON),this.jsonValues=this.getKeysSorted(this.jsonToAPI),this.read=e=>this.fromJSON(e),this.write=(e,t,i)=>{const r=this.toJSON(e);void 0!==r&&X(i,r,t)},this.write.isJSONMapWriter=!0}toJSON(e){return this.apiToJSON.hasOwnProperty(e)?this.apiToJSON[e]:this.options.ignoreUnknown?void 0:e}fromJSON(e){return this.jsonToAPI.hasOwnProperty(e)?this.jsonToAPI[e]:this.options.ignoreUnknown?void 0:e}invertMap(e){const t={};for(const i in e)t[e[i]]=i;return t}getKeysSorted(e){const t=[];for(const i in e)t.push(i);return t.sort(),t}}function te(){return function(e){return new ee(e,{ignoreUnknown:!0})}}var ie,re,se;let ne;const oe=null!=(ie=null==(re=h.esriConfig)?void 0:re.locale)?ie:null==(se=h.dojoConfig)?void 0:se.locale;function ae(){var e,t;return null!=(e=null!=oe?oe:null==(t=h.navigator)?void 0:t.language)?e:"en"}function le(){return void 0===ne&&(ne=ae()),ne}const he=[];function ce(e){return he.push(e),{remove(){he.splice(he.indexOf(e),1)}}}const ue=[];function pe(e){return ue.push(e),{remove(){he.splice(ue.indexOf(e),1)}}}null==h.addEventListener||h.addEventListener("languagechange",(function(){const e=null!=undefined?undefined:ae();ne!==e&&(ne=e,[...ue].forEach((t=>{t.call(null,e)})),[...he].forEach((t=>{t.call(null,e)})))}));const de={year:"numeric",month:"numeric",day:"numeric"},fe={year:"numeric",month:"long",day:"numeric"},ye={year:"numeric",month:"short",day:"numeric"},ge={year:"numeric",month:"long",weekday:"long",day:"numeric"},me={hour:"numeric",minute:"numeric"},ve=l(a({},me),{second:"numeric"}),be={"short-date":de,"short-date-short-time":a(a({},de),me),"short-date-short-time-24":l(a(a({},de),me),{hour12:!1}),"short-date-long-time":a(a({},de),ve),"short-date-long-time-24":l(a(a({},de),ve),{hour12:!1}),"short-date-le":de,"short-date-le-short-time":a(a({},de),me),"short-date-le-short-time-24":l(a(a({},de),me),{hour12:!1}),"short-date-le-long-time":a(a({},de),ve),"short-date-le-long-time-24":l(a(a({},de),ve),{hour12:!1}),"long-month-day-year":fe,"long-month-day-year-short-time":a(a({},fe),me),"long-month-day-year-short-time-24":l(a(a({},fe),me),{hour12:!1}),"long-month-day-year-long-time":a(a({},fe),ve),"long-month-day-year-long-time-24":l(a(a({},fe),ve),{hour12:!1}),"day-short-month-year":ye,"day-short-month-year-short-time":a(a({},ye),me),"day-short-month-year-short-time-24":l(a(a({},ye),me),{hour12:!1}),"day-short-month-year-long-time":a(a({},ye),ve),"day-short-month-year-long-time-24":l(a(a({},ye),ve),{hour12:!1}),"long-date":ge,"long-date-short-time":a(a({},ge),me),"long-date-short-time-24":l(a(a({},ge),me),{hour12:!1}),"long-date-long-time":a(a({},ge),ve),"long-date-long-time-24":l(a(a({},ge),ve),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":me,"long-time":ve},we=te()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});we.apiValues,we.toJSON.bind(we),we.fromJSON.bind(we);const _e={ar:"ar-u-nu-latn-ca-gregory"};let xe=new WeakMap,Se=be["short-date-short-time"];function Me(e){return be[e]||null}function Te(e,t){return function(e){const t=e||Se;if(!xe.has(t)){const e=le(),i=_e[le()]||e;xe.set(t,new Intl.DateTimeFormat(i,t))}return xe.get(t)}(t).format(e)}pe((()=>{xe=new WeakMap,Se=be["short-date-short-time"]}));const Ie={ar:"ar-u-nu-latn"};let Ee=new WeakMap,Ae={};function Pe(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Ce(e,t){return function(e){const t=e||Ae;if(!Ee.has(t)){const i=le(),r=Ie[le()]||i;Ee.set(t,new Intl.NumberFormat(r,e))}return Ee.get(t)}(t).format(e)}pe((()=>{Ee=new WeakMap,Ae={}}));const Oe=/\{([^\}]+)\}/g;function ke(e){return null==e?"":e}function Le(e,t){return e.replace(Oe,"object"==typeof t?(e,i)=>ke(J(i,t)):(e,i)=>ke(t(i)))}function Re(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,(e=>t&&-1!==t.indexOf(e)?e:`\\${e}`))}function De(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function Fe(e){return(new DOMParser).parseFromString(e||"","text/html").body.innerText||""}const je={info:0,warn:1,error:2,none:3};class Ne{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=e.level&&(this.level=e.level),null!=e.writer&&(this.writer=e.writer),this._module=e.module,Ne._loggers[this.module]=this;const t=this.module.lastIndexOf(".");-1!==t&&(this._parent=Ne.getLogger(this.module.slice(0,t)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(e={}){const t=Ne._loggers;return Ne._loggers=e,t},set throttlingDisabled(e){Ne._throttlingDisabled=e}}}static getLogger(e){let t=Ne._loggers[e];return t||(t=new Ne({module:e})),t}_log(e,t,...i){if(this._matchLevel(e)){if("always"!==t&&!Ne._throttlingDisabled){const r=this._argsToKey(i),s=this._loggedMessages[e].get(r);if("once"===t&&null!=s||"oncePerTick"===t&&s&&s>=Ne._tickCounter)return;this._loggedMessages[e].set(r,Ne._tickCounter),Ne._scheduleTickCounterIncrement()}for(const t of Z.log.interceptors)if(t(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,t){let i=this;for(;m(i);){const t=i[e];if(m(t))return t;i=i.parent}return t}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,t,...i){console[e](`[${t}]`,...i)}_matchLevel(e){const t=Z.log.level?Z.log.level:"warn";return je[this._parentWithMember("level",t)]<=je[e]}_argsToKey(...e){return De(JSON.stringify(e,((e,t)=>"object"!=typeof t||Array.isArray(t)?t:"[Object]")))}static _scheduleTickCounterIncrement(){Ne._tickCounterScheduled||(Ne._tickCounterScheduled=!0,Promise.resolve().then((()=>{Ne._tickCounter++,Ne._tickCounterScheduled=!1})))}}Ne._loggers={},Ne._tickCounter=0,Ne._tickCounterScheduled=!1,Ne._throttlingDisabled=!1;const ze=Ne.getLogger("esri.intl");function Ve(e,t,i={}){const{format:r={}}=i;return Le(e,(e=>function(e,t,i){let r,s;const n=e.indexOf(":");if(-1===n?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=J(r,t);if(null==o)return"";const a=i[s]||i[r];return a?function(e,t){switch(t.type){case"date":return Te(e,t.intlOptions);case"number":return Ce(e,t.intlOptions);default:return ze.warn("missing format descriptor for key {key}"),Ue(e)}}(o,a):s?function(e,t){switch(t.toLowerCase()){case"dateformat":return Te(e);case"numberformat":return Ce(e);default:return ze.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Te(e):/^numberformat/i.test(t)?Ce(e):Ue(e)}}(o,s):Ue(o)}(e,t,r)))}function Ue(e){switch(typeof e){case"string":return e;case"number":return Ce(e);case"boolean":return""+e;default:return e instanceof Date?Te(e):""}}class Ge{constructor(e,t,i){var r;this.name=e,this.details=i,this.message=void 0,this instanceof Ge&&(this.message=t&&(r=i,t.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(function(e,t){if(""===t)return"$";const i=J(t,r),s=null==i?"":i;if(void 0===s)throw new Error(`could not find key "${t}" in template`);return s.toString()})))||"")}toString(){return"["+this.name+"]: "+this.message}}class Be extends Ge{constructor(e,t,i){if(super(e,t,i),!(this instanceof Be))return new Be(e,t,i)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,((e,t)=>{if(t&&"object"==typeof t&&"function"==typeof t.toJSON)return t;try{return H(t)}catch(i){return"[object]"}})))}}catch(ehe){throw Ne.getLogger("esri.core.Error").error(ehe),ehe}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new Be(e.name,e.message,e.details)}}Be.prototype.type="error";var qe,He=(qe=h,{setTimeout:(e,t)=>{const i=qe.setTimeout(e,t);return{remove:()=>qe.clearTimeout(i)}}});function We(e){return e&&("function"==typeof e.on||"function"==typeof e.addEventListener)}function $e(e,t,i){if(!We(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const t of r)e.addEventListener(t,i);return{remove(){for(const t of r)e.removeEventListener(t,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function Je(e,t,i){if(!We(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=$e(e,t,(t=>{r.remove(),i.call(e,t)}));return{remove(){r.remove()}}}const Xe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function Ke({key:e}){return Xe[e]||e}function Ye(e){return Promise.all(e)}function Ze(e){return new Promise(((t,i)=>{try{e(t,i)}catch(ehe){Promise.resolve().then((()=>i(ehe)))}}))}function Qe(e="Aborted"){return new Be("AbortError",e)}function et(){return new AbortController}function tt(e,t="Aborted"){if(rt(e))throw Qe(t)}function it(e){return m(e)?"aborted"in e?e:e.signal:e}function rt(e){const t=it(e);return m(t)&&t.aborted}function st(e){if(ht(e))throw e}function nt(e){if(!ht(e))throw e}function ot(e,t){const i=it(e);if(!v(i)){if(!i.aborted)return Je(i,"abort",(()=>t()));t()}}function at(e,t){const i=it(e);if(!v(i))return tt(i),Je(i,"abort",(()=>t(Qe())))}function lt(e,t){return v(it(t))?e:new Promise(((i,r)=>{let s=ot(t,(()=>r(Qe())));const n=()=>s=I(s);e.then(n,n),e.then(i,r)}))}function ht(e){return e&&"AbortError"===e.name}function ct(e){return e.catch((e=>{if(!ht(e))throw e}))}function ut(){let e=null;const t=new Promise(((t,i)=>{e={promise:void 0,resolve:t,reject:i}}));return e.promise=t,e}function pt(e){if(!e)return;if("function"!=typeof e.forEach){const t=Object.keys(e);return pt(t.map((t=>e[t]))).then((e=>{const i={};return t.forEach(((t,r)=>i[t]=e[r])),i}))}const t=e;return Ze((e=>{const i=[];let r=t.length;0===r&&e(i),t.forEach((t=>{const s={promise:t||Promise.resolve(t)};i.push(s),s.promise.then((e=>{s.value=e})).catch((e=>{s.error=e})).then((()=>{--r,0===r&&e(i)}))}))}))}function dt(e){return pt(e).then((e=>e.filter((e=>!!e.value)).map((e=>e.value))))}function ft(e){return Promise.reject(e)}function yt(e){return Promise.resolve(e)}function gt(e,t,i){const r=et();return ot(i,(()=>r.abort())),new Promise(((i,s)=>{let n=setTimeout((()=>{n=0,i(t)}),e);ot(r,(()=>{n&&(clearTimeout(n),s(Qe()))}))}))}function mt(e){return e&&"function"==typeof e.then}function vt(e){return bt(e)?e:Promise.resolve(e)}function bt(e){return e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}function wt(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject(Qe()),n=ut();const e=n.promise;if(o){const e=o;o=null,e.abort()}return e}if(s=n||ut(),n=null,t>0){const r=et();i=vt(e(...l,r.signal));const s=i;gt(t).then((()=>{i===s&&(n?r.abort():o=r)}))}else i=1,i=vt(e(...l));const h=()=>{const e=r;r=s=i=o=null,null!=e&&a(...e)},c=i,u=s;return c.then(h,h),c.then(u.resolve,u.reject),u.promise};return a}function _t(){let e,t;const i=new Promise(((i,r)=>{e=i,t=r})),r=t=>{e(t)};return r.resolve=t=>e(t),r.reject=e=>t(e),r.timeout=(e,t)=>He.setTimeout((()=>r.reject(t)),e),r.promise=i,r}function xt(e){let t=et();const i=e(t.signal);let r={promise:i,finished:!1,abort:()=>{t&&(t.abort(),t=null)}};const s=()=>{r&&(r.finished=!0,r=null),t=null};return i.then(s,s),r}const St=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,Mt={ar:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Tt(e){var t;return null!=(t=Mt[e])&&t}const It=[],Et=new Map;function At(e){for(const t of Et.keys())Ct(e.pattern,t)&&Et.delete(t)}async function Pt(e){const t=le();Et.has(e)||Et.set(e,async function(e,t){const i=[];for(const s of It)if(Ct(s.pattern,e))try{return await s.fetchMessageBundle(e,t)}catch(r){i.push(r)}if(i.length)throw new Be("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i});throw new Be("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const i=Et.get(e);return await Ot.add(i),i}function Ct(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}pe((()=>{Et.clear()}));const Ot=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=ut())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},kt=Ne.getLogger("esri.core.urlUtils"),Lt=Z.request,Rt="esri/config: esriConfig.request.proxyUrl is not set.",Dt=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Ft=/^\s*http:/i,jt=/^\s*https:/i,Nt=/^\s*file:/i,zt=/:\d+$/,Vt=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,Ut=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),Gt=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class Bt{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let t=this.uri.match(Ut);this.scheme=t[2]||(t[1]?"":null),this.authority=t[4]||(t[3]?"":null),this.path=t[5],this.query=t[7]||(t[6]?"":null),this.fragment=t[9]||(t[8]?"":null),null!=this.authority&&(t=this.authority.match(Gt),this.user=t[3]||null,this.password=t[4]||null,this.host=t[6]||t[7],this.port=t[9]||null)}toString(){return this.uri}}const qt=new Bt(Z.applicationUrl),Ht={},Wt=(()=>{const e=qt.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${qt.scheme}://${qt.host}${null!=qt.port?`:${qt.port}`:""}${t}`})();function $t(e){const t={path:null,query:null},i=new Bt(e),r=e.indexOf("?");return null===i.query?t.path=e:(t.path=e.substring(0,r),t.query=Jt(i.query)),i.fragment&&(t.hash=i.fragment,null===i.query&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function Jt(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const e=r.indexOf("=");let t,s;e<0?(t=decodeURIComponent(r),s=""):(t=decodeURIComponent(r.slice(0,e)),s=decodeURIComponent(r.slice(e+1)));let n=i[t];"string"==typeof n&&(n=i[t]=[n]),Array.isArray(n)?n.push(s):i[t]=s}return i}function Xt(e){return e&&"object"==typeof e&&"toJSON"in e&&"function"==typeof e.toJSON}function Kt(e,t){return e?t&&"function"==typeof t?Object.keys(e).map((i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i])))).join("&"):Object.keys(e).map((i=>{const r=e[i];if(null==r)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map((e=>Xt(e)?s+encodeURIComponent(JSON.stringify(e)):s+encodeURIComponent(e))).join("&"):Xt(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)})).filter((e=>e)).join("&"):""}function Yt(e){const t=ti(e);let i,r;if(t){const e=Qt(t.proxyUrl);i=e.path,r=e.query?Jt(e.query):null}if(i){const t=$t(e);e=i+"?"+t.path;const s=Kt(a(a({},r),t.query));s&&(e=`${e}?${s}`)}return e}const Zt={path:"",query:""};function Qt(e){const t=e.indexOf("?");return-1!==t?(Zt.path=e.slice(0,t),Zt.query=e.slice(t+1)):(Zt.path=e,Zt.query=null),Zt}function ei(e){return(e=Mi(e=function(e){return e&&"/"===e[e.length-1]?e:`${e}/`}(e=Qt(e).path),!0)).toLowerCase()}function ti(e){const t=Lt.proxyRules,i=ei(e);for(let r=0;r<t.length;r++)if(0===i.indexOf(t[r].urlPrefix))return t[r]}function ii(e,t){return e=ri(e),t=ri(t),Mi(e)===Mi(t)}function ri(e){const t=(e=hi(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function si(e,t,i=!1){const r=Pi(e),s=Pi(t);return!(!i&&r.scheme!==s.scheme)&&null!=r.host&&null!=s.host&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function ni(e){if("string"==typeof e){if(!pi(e))return!0;e=Pi(e)}if(si(e,qt))return!0;const t=Lt.trustedServers||[];for(let i=0;i<t.length;i++){const r=oi(t[i]);for(let t=0;t<r.length;t++)if(si(e,r[t]))return!0}return!1}function oi(e){return Ht[e]||(wi(e)||bi(e)?Ht[e]=[new Bt(ai(e))]:Ht[e]=[new Bt(`http://${e}`),new Bt(`https://${e}`)]),Ht[e]}function ai(e,t=Wt,i){return bi(e)?i&&i.preserveProtocolRelative?e:"http"===qt.scheme&&qt.authority===ui(e).slice(2)?`http:${e}`:`https:${e}`:wi(e)?e:ci("/"===e[0]?function(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return-1===i?e:e.slice(0,i)}(t):t,e)}function li(e,t=Wt,i){if(!pi(e))return e;const r=hi(e),s=r.toLowerCase(),n=hi(t).toLowerCase().replace(/\/+$/,""),o=i?hi(i).toLowerCase().replace(/\/+$/,""):null;if(o&&0!==n.indexOf(o))return e;const a=(e,t,i)=>-1===(i=e.indexOf(t,i))?e.length:i;let l=a(s,"/",s.indexOf("//")+2),h=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(h=l+1,l!==s.length);)l=a(s,"/",l+1);if(-1===h)return e;if(o&&h<o.length)return e;e=r.slice(h);const c=n.slice(h-1).replace(/[^/]+/g,"").length;if(c>0)for(let u=0;u<c;u++)e=`../${e}`;else e=`./${e}`;return e}function hi(e){return function(e){const t=Lt.httpsDomains;if(!function(e){return Ft.test(e)||"http"===qt.scheme&&bi(e)}(e))return e;const i=e.indexOf("/",7);let r;if(r=-1===i?e:e.slice(0,i),r=r.toLowerCase().slice(7),zt.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return"http"===qt.scheme&&r===qt.authority&&!Vt.test(e)||(Si()&&r===qt.authority||t&&t.some((e=>r===e||r.endsWith(`.${e}`)))||Si()&&!ti(e))&&(e=xi(e)),e}(e=function(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(e=function(e){if(/^https?:\/\//i.test(e)){const t=Qt(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}(e=ai(e=e.trim()))))}function ci(...e){const t=e.filter(m);if(!t||!t.length)return;const i=[];if(pi(t[0])){const e=t[0],r=e.indexOf("//");-1!==r&&(i.push(e.slice(0,r+1)),function(e){return Nt.test(e)}(t[0])&&(i[0]+="/"),t[0]=e.slice(r+2))}else"/"===t[0][0]&&i.push("");const r=t.reduce(((e,t)=>t?e.concat(t.split("/")):e),[]);for(let s=0;s<r.length;s++){const e=r[s];".."===e&&i.length>0&&".."!==i[i.length-1]?i.pop():(!e&&s===r.length-1||e&&("."!==e||0===i.length))&&i.push(e)}return i.join("/")}function ui(e,t=!1){if(di(e)||fi(e))return null;let i=e.indexOf("://");if(-1===i&&bi(e))i=2;else{if(-1===i)return null;i+=3}const r=e.indexOf("/",i);return-1!==r&&(e=e.slice(0,r)),t&&(e=Mi(e,!0)),e}function pi(e){return bi(e)||wi(e)}function di(e){return null!=e&&"blob:"===e.slice(0,5)}function fi(e){return"data:"===e.slice(0,5)}function yi(e){const t=mi(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}const gi=/^data:(.*?)(;base64)?,(.*)$/;function mi(e){const t=e.match(gi);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function vi(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function bi(e){return null!=e&&void 0!==e&&"/"===e[0]&&"/"===e[1]}function wi(e){return Dt.test(e)}function _i(e){return jt.test(e)||"https"===qt.scheme&&bi(e)}function xi(e){return bi(e)?`https:${e}`:e.replace(Ft,"https:")}function Si(){return"https"===qt.scheme}function Mi(e,t=!1){return bi(e)?e.slice(2):(e=e.replace(Dt,""),t&&e.length>1&&"/"===e[0]&&"/"===e[1]&&(e=e.slice(2)),e)}function Ti(e){let t=0;if(pi(e)){const i=e.indexOf("//");-1!==i&&(t=i+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function Ii(e,t){if(!e)return"";const i=$t(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(null==t||!t.length)return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function Ei(e){return e.replace(/\/+$/,"")}function Ai(e,t,i){if(!(t&&i&&e&&pi(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function Pi(e){return"string"==typeof e?new Bt(ai(e)):(e.scheme||(e.scheme=qt.scheme),e)}function Ci(e){return Fi.test(e)}function Oi(e,t){const i=$t(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function ki(e,t,i){const r=$t(e),s=r.query||{};return s[t]=String(i),`${r.path}?${Kt(s)}`}function Li(e,t){const i=$t(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=Kt(r);return s?`${i.path}?${s}`:i.path}function Ri(e){if(v(e))return null;const t=e.match(Di);return t?t[1]:null}const Di=/.*?\.([^\/]*)$/,Fi=/(^data:image\/svg|\.svg$)/i,ji="20210707",Ni="17f9314e751fd1e720022ff5819d4e40def1f79a",zi="4.20",Vi={request(e,t){var i;const r=null==(i=e.options)?void 0:i.responseType;return Promise.resolve().then((function(){return cr})).then((({default:i})=>{const s=e.options||{};return s.responseType="native"===r||"native-request-init"===r?"native-request-init":"array-buffer",s.signal=null==t?void 0:t.signal,i(e.url,s)})).then((e=>{const t={data:e.data,ssl:e.ssl};return"native-request-init"===e.requestOptions.responseType?(delete t.data.signal,t):{result:t,transferList:[t.data]}}))}};let Ui;function Gi(e){const t=Ui&&Ui.findCredential(e);return t&&t.token?ki(e,"token",t.token):e}y("host-webworker")||(y("edge")||y("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const Bi=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function qi(e){const t=ui(e,!0);return t&&t.endsWith(".arcgis.com")&&!Bi.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function Hi(e,t,i=!1,r){return new Promise(((s,n)=>{if(rt(r))return void n(Wi());let o=()=>{h(),n(new Error(`Unable to load ${t}`))},a=()=>{const t=e;h(),s(t)},l=()=>{if(!e)return;const t=e;h(),t.src="",n(Wi())};const h=()=>{y("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,m(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};m(r)&&r.addEventListener("abort",l),y("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))}))}function Wi(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}async function $i(e,t){const i=fi(e),r=di(e);r||i||(e=hi(e));const s={url:e,requestOptions:a({},t)};let n=function(e){const t=t=>null==t||t instanceof RegExp&&t.test(e)||"string"==typeof t&&e.startsWith(t),i=Lt.interceptors;if(i)for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r;return null}(e);if(n){const e=await async function(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers=a(a({},t.requestOptions.headers),e.headers)),e.query&&(t.requestOptions.query=a(a({},t.requestOptions.query),e.query)),e.before){let i,s;try{s=await e.before(t)}catch(r){i=rr("request:interceptor",r,t)}if((s instanceof Error||s instanceof Be)&&(i=rr("request:interceptor",s,t)),i)throw e.error&&e.error(i),i;return s}}(n,s);if(null!=e)return{data:e,getHeader:er,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,"image"===(t=s.requestOptions).responseType){if(y("host-webworker")||y("host-node"))throw rr("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw rr("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if("head"===t.method){if(t.body)throw rr("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw rr("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await async function(){y("host-webworker")?Ji||(Ji=await import("./request.45ecb8fb.js")):$i._abortableFetch||($i._abortableFetch=h.fetch.bind(h))}(),Ji)return Ji.execute(e,t);const o=et();ot(t,(()=>o.abort()));const l={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:Xi.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},c=await async function(e){var t,i;let r,s;await async function(e){const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null,a=null;if(Ki&&"HTMLFormElement"in h&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(o=s,n=new FormData(o))),"string"==typeof s&&(a=s),e.fetchOptions={cache:i.cacheBust&&!$i._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:"head"===i.method?"HEAD":"GET",mode:"cors",redirect:"follow",signal:r},(n||a)&&(e.fetchOptions.body=n||a),"anonymous"===i.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||i.query&&i.query.token||n&&n.get&&n.get("token")||o&&o.elements.token),!e.hasToken&&Z.apiKey&&qi(t)&&(i.query||(i.query={}),i.query.token=Z.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!nr(t)&&!rt(r)){let s;"immediate"===i.authMode?(await sr(),s=await Ui.getCredential(t,{signal:r}),e.credential=s):"no-prompt"===i.authMode?(await sr(),s=await Ui.getCredential(t,{prompt:!1,signal:r}).catch((()=>{})),e.credential=s):Ui&&(s=Ui.findCredential(t)),s&&(e.credentialToken=s.token,e.useSSL=!!s.ssl)}}(e);try{do{[r,s]=await or(e)}while(!(await lr(e,r,s)))}catch(a){const t=rr("request:server",a,e.params,r);throw t.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(t),t}const n=e.params.url;if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)&&!e.hasToken&&!e.credentialToken&&null!=(t=s)&&null!=(i=t.user)&&i.username&&!ni(n)){const e=ui(n,!0);e&&Xi.trustedServers.push(e)}const o=e.credential;if(o&&Ui){const e=Ui.findServerInfo(o.server);let t=e&&e.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=Ui.findCredential(t,o.userId);e&&-1===Ui._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:s,getHeader:r?e=>r.headers.get(e):er,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}(l);return n&&n.after&&n.after(c),c}let Ji;const Xi=Z.request,Ki="FormData"in h,Yi=[499,498,403,401],Zi=["COM_0056","COM_0057","SB_0008"],Qi=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],er=()=>null,tr=Symbol();function ir(e){const t=ui(e);return!t||t.endsWith(".arcgis.com")||$i._corsServers.includes(t)||ni(t)}function rr(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:er,ssl:!1};if(t instanceof Be)return t.details?(t.details=H(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const e=r&&(e=>r.headers.get(e)),i=r&&r.status,o=t.message;o&&(s=o),e&&(n.getHeader=e),n.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||i||0,n.subCode=t.subcode,n.messageCode=t.messageCode,"string"==typeof t.details?n.messages=[t.details]:n.messages=t.details,n.raw=tr in t?t[tr]:t}return ht(t)?Qe():new Be(e,s,n)}async function sr(){Ui||await Promise.resolve().then((function(){return Cg}))}function nr(e){return Qi.some((t=>t.test(e)))}async function or(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=di(t)||fi(t),n=i.responseType||"json",o=s?0:null!=i.timeout?i.timeout:Xi.timeout;let l=!1;if(!s){e.useSSL&&(t=xi(t)),i.cacheBust&&"default"===r.cache&&(t=ki(t,"request.preventCache",Date.now()));let s=a({},i.query);e.credentialToken&&(s.token=e.credentialToken);let n=Kt(s);y("esri-url-encodes-apostrophe")&&(n=n.replace(/'/g,"%27"));const o=t.length+1+n.length;let h;l="delete"===i.method||"post"===i.method||"put"===i.method||!!i.body||o>Xi.maxUrlLength;const c=i.useProxy||!!ti(t);if(c){const e=function(e=!1){let t,i=Lt.proxyUrl;if("string"==typeof e){t=_i(e);const r=ti(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw kt.warn(Rt),new Be("urlutils:proxy-not-set",Rt);return t&&Si()&&(i=xi(i)),$t(i)}(t);h=e.path,!l&&h.length+1+o>Xi.maxUrlLength&&(l=!0),e.query&&(s=a(a({},e.query),s))}if("HEAD"===r.method&&(l||c)){if(l){if(o>Xi.maxUrlLength)throw rr("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw rr("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(c)throw rr("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(l?(r.method="delete"===i.method?"DELETE":"put"===i.method?"PUT":"POST",i.body?t=Li(t,s):(r.body=Kt(s),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=Li(t,s),c&&(e.useProxy=!0,t=`${h}?${t}`),s.token&&Ki&&r.body instanceof FormData){const e=r.body;e.set?e.set("token",s.token):e.append("token",s.token)}if(i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!si(t,qt))if(ni(t))e.withCredentials=!0;else if(Ui){const i=Ui.findServerInfo(t);i&&i.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(r.credentials="include")}let h,c,u=0,p=!1;o>0&&(u=setTimeout((()=>{p=!0,e.controller.abort()}),o));try{if("native-request-init"===i.responseType)c=r,c.url=t;else if("image"!==i.responseType||"default"!==r.cache||"GET"!==r.method||l||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(i.headers)||!s&&!e.useProxy&&Xi.proxyUrl&&!ir(t)){if(h=await $i._abortableFetch(t,r),e.useProxy||function(e){const t=ui(e);t&&!$i._corsServers.includes(t)&&$i._corsServers.push(t)}(t),"native"===i.responseType)c=h;else if("HEAD"!==r.method)if(h.ok){switch(n){case"array-buffer":c=await h.arrayBuffer();break;case"blob":case"image":c=await h.blob();break;default:c=await h.text()}if(u&&(clearTimeout(u),u=0),"json"===n||"xml"===n||"document"===n)if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=ar(c,"application/xml");break;case"document":c=ar(c,"text/html")}else c=null;if(c){if("array-buffer"===n||"blob"===n){const e=h.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(e)&&c["blob"===n?"size":"byteLength"]<=750)try{const e=await new Response(c).json();e.error&&(c=e)}catch{}}"image"===n&&c instanceof Blob&&(c=await hr(URL.createObjectURL(c),e,!0))}}else c=await h.text()}else c=await hr(t,e)}catch(d){if("AbortError"===d.name){if(p)throw new Error("Timeout exceeded");throw Qe("Request canceled")}if(!(!h&&d instanceof TypeError&&Xi.proxyUrl)||i.body||"delete"===i.method||"head"===i.method||"post"===i.method||"put"===i.method||e.useProxy||ir(t))throw d;e.redoRequest=!0,function(e){const t={proxyUrl:e.proxyUrl,urlPrefix:ei(e.urlPrefix)},i=Lt.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const e=i[n].urlPrefix;if(0===r.indexOf(e)){if(r.length===e.length)return-1;s=n;break}0===e.indexOf(r)&&(s=n+1)}i.splice(s,0,t)}({proxyUrl:Xi.proxyUrl,urlPrefix:ui(t)})}finally{u&&clearTimeout(u)}return[h,c]}function ar(e,t){let i;try{i=(new DOMParser).parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function lr(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||"native"===r.responseType||"native-request-init"===r.responseType)return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[tr]=i,s;null!=i&&i.error&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(403===n&&(4===o||s.message&&s.message.toLowerCase().indexOf("ssl")>-1&&-1===s.message.toLowerCase().indexOf("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==l||498===n)&&-1!==Yi.indexOf(n)&&!nr(e.params.url)&&(403!==n||-1===Zi.indexOf(a)&&(null==o||2===o&&e.credentialToken))){await sr();try{const t=await Ui.getCredential(e.params.url,{error:rr("request:server",s,e.params),prompt:"no-prompt"!==l,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(h){if("no-prompt"===l)return e.credential=null,e.credentialToken=null,!1;s=h}}if(s)throw s;return!0}function hr(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.src=e,Hi(s,e,i,r)}$i._abortableFetch=null,$i._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];var cr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:$i});async function ur(e,t,i,r){const s=t.exec(i);if(!s)throw new Be("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=function(e){if(!St.test(e))return null;const[,t,i]=St.exec(e),r=t+(i?"-"+i.toUpperCase():"");return Tt(r)?r:Tt(t)?t:null}(r),l=`${n}${o}.json`,h=a?`${n}${o}_${a}.json`:l;let c;try{c=await pr(e(h))}catch(u){if(h===l)throw new Be("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:u});try{c=await pr(e(l))}catch(p){throw new Be("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p})}}return c}async function pr(e){if(m(fr.fetchBundleAsset))return fr.fetchBundleAsset(e);const t=await $i(e,{responseType:"text"});return JSON.parse(t.data)}class dr{constructor({base:e="",pattern:t,location:i=new URL(window.location.href)}){let r;r="string"==typeof i?e=>new URL(e,new URL(i,h.location)).href:i instanceof URL?e=>new URL(e,i).href:i,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=r,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,t){return ur(this.getAssetUrl,this.matcher,e,t)}}const fr={},yr=Ne.getLogger("esri.assets");function gr(e){if(!Z.assetsPath)throw yr.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new Be("assets:path-not-set","config.assetsPath is not set");return ci(Z.assetsPath,e)}var mr;mr=function(e){return new dr(e)}({pattern:"esri/",location:gr}),It.includes(mr)||(At(mr),It.unshift(mr));const vr=new Set;function br(e,t,i={}){if(y("esri-deprecation-warnings")){const{moduleName:r}=i;wr(e,"Property: "+((r?r+"::":"")+t),i)}}function wr(e,t,i={}){if(y("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`\n\tðŸ› ï¸ Replacement: ${r}`),s&&(a+=`\n\tâš™ï¸ Version: ${s}`),n&&(a+=`\n\tðŸ”— See ${n} for more details.`),function(e,t,i=!1){i&&vr.has(t)||(i&&vr.add(t),e.warn(`ðŸ›‘ DEPRECATED - ${t}`))}(e,a,o)}}function _r(e){return xr((()=>e.forEach((e=>m(e)&&e.remove()))))}function xr(e){return{remove:()=>{e&&(e(),e=void 0)}}}function Sr(e){return xr((()=>{const t=e();m(t)&&t.remove()}))}function Mr(e){return xr(m(e)?()=>e.destroy():void 0)}function Tr(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function Ir(e,t,i){return Er(e,t,i?{policy:i,path:""}:null)}function Er(e,t,i){return t?Object.keys(t).reduce((function(e,r){let s=null,n="merge";if(i&&(s=i.path?`${i.path}.${r}`:r,n=i.policy(s)),"replace"===n)return e[r]=t[r],e;if(void 0===e[r])return e[r]=H(t[r]),e;let o=e[r],a=t[r];if(o===a)return e;if(Array.isArray(a)||Array.isArray(e))o=o?Array.isArray(o)?e[r]=o.concat():e[r]=[o]:e[r]=[],a&&(Array.isArray(a)||(a=[a]),a.forEach((e=>{-1===o.indexOf(e)&&o.push(e)})));else if(a&&"object"==typeof a)if(i){const t=i.path;i.path=s,e[r]=Er(o,a,i),i.path=t}else e[r]=Er(o,a,null);else e.hasOwnProperty(r)&&!t.hasOwnProperty(r)||(e[r]=a);return e}),e||{}):e}function Ar(e){return Array.isArray(e)?e:e.split(".")}function Pr(e){return e.indexOf(",")>-1?e.split(",").map((e=>e.trim())):[e.trim()]}function Cr(e,t,i,r){const s=function(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...Pr(i));return t}return Pr(e)}(t);if(1!==s.length){return _r(s.map((t=>r(e,t,i))))}return r(e,s[0],i)}function Or(e){let t=!1;return()=>{t||(t=!0,e())}}function kr(e,t){const i="?"===e[e.length-1]?e.slice(0,-1):e;if(null!=t.getItemAt||Array.isArray(t)){const e=parseInt(i,10);if(!isNaN(e))return Array.isArray(t)?t[e]:t.getItemAt(e)}const r=Tr(t);return n=i,null!=(s=r)&&s.metadatas&&null!=s.metadatas[n]?r.get(i):t[i];var s,n}function Lr(e,t,i){if(null==e)return e;const r=kr(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:Lr(r,t,i+1)}function Rr(e,t,i=0){return"string"==typeof t&&-1===t.indexOf(".")?kr(t,e):Lr(e,Ar(t),i)}function Dr(e,t){return Rr(e,t)}function Fr(e,t){return void 0!==Rr(t,e)}class jr{constructor(e){this.autoDestroy=!1,this.properties=e}}function Nr(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const i=Object.create(t.properties),r=t.autoDestroy;for(const e in i)i[e]=H(i[e]);t=new jr(i),t.autoDestroy=r,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new jr({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function zr(e,t){const i=function(e){return Nr(e).properties}(e);let r=i[t];return r||(r=i[t]={}),r}const Vr=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function Ur(e){return Vr.test(e)?"replace":"merge"}class Gr{constructor(e,t,i,r=1,s=0){if(this.ctor=e,this.acquireFunction=t,this.releaseFunction=i,this.allocationSize=r,this._pool=new Array(s),this._initialSize=s,this.ctor)for(let n=0;n<s;n++)this._pool[n]=new this.ctor;this.allocationSize=Math.max(r,1)}destroy(){this.prune(0)}acquire(...e){let t;if(Gr.test.disabled)t=new this.ctor;else{if(0===this._pool.length){const e=this.allocationSize;for(let t=0;t<e;t++)this._pool[t]=new this.ctor}t=this._pool.pop()}return this.acquireFunction?this.acquireFunction(t,...e):function(e){return e&&e.acquire&&"function"==typeof e.acquire}(t)&&t.acquire(...e),t}release(e){e&&!Gr.test.disabled&&(this.releaseFunction?this.releaseFunction(e):function(e){return e&&e.release&&"function"==typeof e.release}(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let t=e;t<this._pool.length;++t){const e=this._pool[t];this._dispose(e)}this._pool.length=e}}_dispose(e){e.dispose&&"function"==typeof e.dispose&&e.dispose()}}Gr.test={disabled:!1};let Br,qr=[];const Hr=Ne.getLogger("esri.core.Accessor");function Wr(e){void 0!==Br&&Br.onObservableAccessed(e)}let $r=!1,Jr=!1;function Xr(e,t,i){if($r)return Kr(e,t,i);Yr(e);const r=t.call(i);return Zr(),r}function Kr(e,t,i){const r=$r;$r=!0,Yr(e);let s=null;try{s=t.call(i)}catch(n){Jr&&Hr.error(n)}return Zr(),$r=r,s}function Yr(e){Br=e,qr.push(e)}function Zr(){const e=qr.pop();Br=qr.length>0?qr[qr.length-1]:void 0,void 0!==e&&e.onTrackingEnd()}function Qr(e,t){if(32&t.flags)return;const i=Jr;Jr=!1,64&t.flags?Kr(t,t.metadata.get,e):ts(e,t),Jr=i}const es=[];function ts(e,t){128&t.flags||(t.flags|=128,Kr(t,(()=>{const i=t.metadata.dependsOn||es;for(const t of i)if("string"==typeof t&&-1===t.indexOf("."))is(e,t,!1);else{const i=Ar(t);for(let t=0,r=e;t<i.length&&null!=r&&"object"==typeof r;++t)r=is(r,i[t],t!==i.length-1)}})),t.flags&=-129)}function is(e,t,i){const r="?"===t[t.length-1]?t.slice(0,-1):t;if(null!=e.getItemAt||Array.isArray(e)){const t=parseInt(r,10);if(!isNaN(t))return Array.isArray(e)?e[t]:e.getItemAt(t)}const s=Tr(e),n=null==s?void 0:s.properties.get(r);return n&&(Wr(n),Qr(e,n)),i?e[r]:void 0}class rs{constructor(e=1){this._seed=e}set seed(e){this._seed=null==e?Math.random()*rs._m:e}getInt(){return this._seed=(rs._a*this._seed+rs._c)%rs._m,this._seed}getFloat(){return this.getInt()/(rs._m-1)}getIntRange(e,t){return Math.round(this.getFloatRange(e,t))}getFloatRange(e,t){const i=t-e;return e+this.getInt()/rs._m*i}}function ss(e,t){return t?e.filter(((e,i,r)=>r.findIndex(t.bind(null,e))===i)):e.filter(((e,t,i)=>i.indexOf(e)===t))}function ns(e,t,i){if(v(e)&&v(t))return!0;if(v(e)||v(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function os(e){return e&&"number"==typeof e.length}rs._m=2147483647,rs._a=48271,rs._c=0;const as=!!Array.prototype.fill;function ls(e,t){if(as)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function hs(e,t){void 0===t&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function cs(e){return e.reduce(((e,t)=>e.concat(t||[])),[])}class us{constructor(){this.last=0}}const ps=new us;function ds(e,t,i,r){r=r||ps;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function fs(e,t,i,r){const s=null==i?e.length:i,n=ds(e,t,s,r);if(-1!==n)return e[n]=e[s-1],null==i&&e.pop(),t}const ys=new Set;function gs(e,t){const i=e.indexOf(t);return-1!==i?(e.splice(i,1),t):null}new rs;class ms{constructor(e,t){this._observers=e,this._observer=t}remove(){gs(this._observers,this._observer)}}class vs{constructor(e,t,i){this.properties=e,this.propertyName=t,this.metadata=i,this._observers=null,this._accessed=null,this._handles=null,this.flags=1|(i.nonNullable?8:0)|(i.hasOwnProperty("value")?16:0)|(void 0===i.get?32:0)|(void 0===i.dependsOn?64:0)}destroy(){this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){Wr(this);const e=this.properties.store,t=this.propertyName,i=this.flags,r=e.get(t);if(4&i)return r;if(1&~i&&e.has(t))return r;this.flags|=4;const s=this.properties.host;let n;64&i?n=Xr(this,this.metadata.get,s):(ts(s,this),n=this.metadata.get.call(s)),e.set(t,n,1);const o=e.get(t);return o===r?this.flags&=-2:this.commit(),this.flags&=-5,o}onObservableAccessed(e){e!==this&&(null===this._accessed&&(this._accessed=[]),this._accessed.includes(e)||this._accessed.push(e))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=32;const e=this._accessed;if(null===e)return;let t=this._handles;null===t&&(t=this._handles=[]);for(let i=0;i<e.length;++i)t.push(e[i].observe(this));e.length=0}observe(e){return null===this._observers&&(this._observers=[]),this._observers.includes(e)||this._observers.push(e),new ms(this._observers,e)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){2&~this.flags&&(this.flags|=1);const e=this._observers;if(null!==e)for(let t=0;t<e.length;++t)e[t].onInvalidated()}commit(){this.flags&=-2,this.onCommitted()}onCommitted(){if(null===this._observers)return;const e=this._observers.slice();for(let t=0;t<e.length;++t)e[t].onCommitted()}_clearObservationHandles(){const e=this._handles;if(null!==e){for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}}function bs(e){switch(e){case"defaults":return 0;case"service":return 2;case"portal-item":return 3;case"web-scene":return 4;case"web-map":return 5;case"user":return 6}}function ws(e){switch(e){case 0:return"defaults";case 2:return"service";case 3:return"portal-item";case 4:return"web-scene";case 5:return"web-map";case 6:return"user"}}function _s(e){return ws(e)}class xs{constructor(){this._values=new Map}clone(e){const t=new xs;return this._values.forEach(((i,r)=>{e&&e.has(r)||t.set(r,H(i))})),t}get(e){return this._values.get(e)}originOf(){return 6}keys(){return[...this._values.keys()]}set(e,t){this._values.set(e,t)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}}function Ss(e,t,i){return void 0!==e}function Ms(e,t,i,r){return!(void 0===e||null==i&&8&e.flags&&(r.lifecycle,1))}function Ts(e){return e&&"function"==typeof e.destroy}Ne.getLogger("esri.core.accessorSupport.Properties");class Is{constructor(e){this.host=e,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=0,this.store=new xs,this._origin=6;const t=this.host.constructor.__accessorMetadata__,i=t.properties;for(const r in i){const e=new vs(this,r,i[r]);this.properties.set(r,e)}this.metadatas=i,this._autoDestroy=t.autoDestroy}initialize(){this.lifecycle=1}constructed(){this.lifecycle=2}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[e,t]of this.properties){const i=this.internalGet(e);i&&Ts(i)&&(i.destroy(),8&~t.flags&&this._internalSet(t,null)),t.destroy()}else for(const[e,t]of this.properties)t.destroy()}get initialized(){return 0!==this.lifecycle}get(e){const t=this.properties.get(e);if(t.metadata.get)return t.getComputed();Wr(t);const i=this.store;return i.has(e)?i.get(e):t.metadata.value}originOf(e){const t=this.store.originOf(e);if(void 0===t){const t=this.properties.get(e);if(void 0!==t&&16&t.flags)return"defaults"}return ws(t)}has(e){return!!this.properties.has(e)&&this.store.has(e)}keys(){return[...this.properties.keys()]}internalGet(e){const t=this.properties.get(e);if(Ss(t))return this.store.has(e)?this.store.get(e):t.metadata.value}internalSet(e,t){const i=this.properties.get(e);Ss(i)&&this._internalSet(i,t)}getDependsInfo(e,t,i){const r=this.properties.get(t);if(!Ss(r))return"";const s=new Set,n=Xr({onObservableAccessed:e=>s.add(e),onTrackingEnd:()=>{}},(()=>{var t;return null==(t=r.metadata.get)?void 0:t.call(e)}));let o=`${i}${e.declaredClass.split(".").pop()}.${t}: ${n}\n`;if(0===s.size)return o;i+="  ";for(const a of s){if(!(a instanceof vs))continue;const e=a.properties.host,t=a.propertyName,r=Tr(e);o+=r?r.getDependsInfo(e,t,i):`${i}${t}: undefined\n`}return o}setAtOrigin(e,t,i){const r=this.properties.get(e);if(Ss(r))return this._setAtOrigin(r,t,i)}isOverridden(e){const t=this.properties.get(e);return void 0!==t&&!!(2&t.flags)}clearOverride(e){const t=this.properties.get(e);void 0!==t&&2&t.flags&&(t.flags&=-3,t.notifyChange())}override(e,t){const i=this.properties.get(e);if(!Ms(i,0,t,this))return;const r=i.metadata.cast;if(r){const e=this._cast(r,t),{valid:i,value:s}=e;if(Es.release(e),!i)return;t=s}i.flags|=2,this._internalSet(i,t)}set(e,t){const i=this.properties.get(e);if(!Ms(i,0,t,this))return;const r=i.metadata.cast;if(r){const e=this._cast(r,t),{valid:i,value:s}=e;if(Es.release(e),!i)return;t=s}const s=i.metadata.set;s?s.call(this.host,t):this._internalSet(i,t)}setDefaultOrigin(e){this._origin=bs(e)}getDefaultOrigin(){return ws(this._origin)}notifyChange(e){const t=this.properties.get(e);void 0!==t&&t.notifyChange()}invalidate(e){const t=this.properties.get(e);void 0!==t&&t.invalidate()}commit(e){const t=this.properties.get(e);void 0!==t&&t.commit()}_internalSet(e,t){const i=0!==this.lifecycle?this._origin:0;this._setAtOrigin(e,t,i)}_setAtOrigin(e,t,i){const r=this.store,s=e.propertyName;r.has(s,i)&&W(t,r.get(s))&&2&~e.flags&&i===r.originOf(s)||(e.invalidate(),r.set(s,t,i),e.commit(),Qr(this.host,e))}_cast(e,t){const i=Es.acquire();return i.valid=!0,i.value=t,e&&(i.value=e.call(this.host,t,i)),i}}const Es=new Gr(class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});function As(e,t,i){if(e&&t)if("object"==typeof t)for(const r of Object.getOwnPropertyNames(t))As(e,r,t[r]);else{if(-1!==t.indexOf(".")){const r=t.split("."),s=r.splice(r.length-1,1)[0];return void As(Dr(e,r),s,i)}e[t]=i}}function Ps(e){e.length=0}Ne.getLogger("esri.core.accessorSupport.set");class Cs{constructor(e=50,t=50){this._pool=new Gr(Array,void 0,Ps,t,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return Os.acquire()}static release(e){return Os.release(e)}static prune(){Os.prune()}}const Os=new Cs(100);class ks extends Gr{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=(this._set,null)}acquire(...e){const t=super.acquire(...e);return this._set.delete(t),t}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}}const Ls=h.queueMicrotask?h.queueMicrotask:e=>{h.Promise.resolve().then(e)},Rs=[];let Ds=[];function Fs(e){Rs.push(e),1===Rs.length&&Ls((()=>{for(const t of Ds)t();const e=Rs.slice();Rs.length=0;for(const t of e)t()}))}(Fs||(Fs={})).before=function(e){return Ds.push(e),{remove(){Ds=Ds.filter((t=>t!==e))}}};var js=Fs;class Ns{constructor(e,t=29){this.name=e,this._counter=0,this._items=new Array(t)}record(e){this._items[++this._counter%this._items.length]=e}get median(){return this._items.slice().sort()[Math.floor(this._items.length/2)]}get average(){return this._items.reduce(((e,t)=>e+t),0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var zs;!function(e){const t=(e,t,i,r)=>{let s=t,n=t;const o=i>>>1,a=e[s-1];for(;n<=o;){n=s<<1,n<i&&r(e[n-1],e[n])<0&&++n;const t=e[n-1];if(r(t,a)<=0)break;e[s-1]=t,s=n}e[s-1]=a},i=(e,t)=>e<t?-1:e>t?1:0;e.sort=function(e,r,s,n){void 0===r&&(r=0),void 0===s&&(s=e.length),void 0===n&&(n=i);for(let i=s>>>1;i>r;i--)t(e,i,s,n);const o=r+1;for(let i=s-1;i>r;i--){const s=e[r];e[r]=e[i],e[i]=s,t(e,o,i,n)}},e.iterableSort=function*(e,r,s,n){void 0===r&&(r=0),void 0===s&&(s=e.length),void 0===n&&(n=i);for(let i=s>>>1;i>r;i--)t(e,i,s,n),yield;const o=r+1;for(let i=s-1;i>r;i--){const s=e[r];e[r]=e[i],e[i]=s,t(e,o,i,n),yield}}}(zs||(zs={}));var Vs=zs;class Us{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new us,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),void 0!==e.deallocator&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>Gs(this)))}toArray(){return this.data.slice(0,this.length)}getItemAt(e){if(!(e<0||e>=this._length))return this.data[e]}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let t=e;t<this._length;++t)this.data[t]=this._deallocator(this.data[t]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,t=e.length){for(let i=0;i<t;i++)this.data[this._length++]=e[i]}fill(e,t){for(let i=0;i<t;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,Gs(this)}pop(){if(0===this.length)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const t=ds(this.data,e,this.length,this._hint);if(-1!==t)return this.data.splice(t,1),this.length=this.length-1,e}removeUnordered(e){const t=fs(this.data,e,this.length,this._hint);return void 0!==t&&(this.length=this.length-1),this._shrink(),t}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,t=e.length,i){this.length=function(e,t,i=e.length,r=t.length,s,n){if(0===r||0===i)return i;ys.clear();for(let a=0;a<r;++a)ys.add(t[a]);s=s||ps;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(ys.has(e[a])&&(n&&n.push(e[a]),ys.delete(e[a]),e[a]=e[i-1],--i,--a,0===ys.size||0===i))return ys.clear(),i;for(let a=0;a<o;++a)if(ys.has(e[a])&&(n&&n.push(e[a]),ys.delete(e[a]),e[a]=e[i-1],--i,--a,0===ys.size||0===i))return ys.clear(),i;return ys.clear(),i}(this.data,e,this.length,t,this._hint,i),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(e,t){e>=this.length||t>=this.length||e===t||([this.data[e],this.data[t]]=[this.data[t],this.data[e]])}sort(e){Vs.sort(this.data,0,this.length,e)}iterableSort(e){return Vs.iterableSort(this.data,0,this.length,e)}some(e,t){for(let i=0;i<this.length;++i)if(e.call(t,this.data[i],i,this.data))return!0;return!1}filterInPlace(e,t){let i=0;for(let r=0;r<this._length;++r){const s=this.data[r];e.call(t,s,r,this.data)&&(this.data[r]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let r=i;r<this._length;r++)this.data[r]=this._deallocator(this.data[r]);return this._length=i,this._shrink(),this}forAll(e,t){const i=this.length,r=this.data;for(let s=0;s<i;++s)e.call(t,r[s],s,r)}map(e,t){const i=new Array(this.length);for(let r=0;r<this.length;++r)i[r]=e.call(t,this.data[r],r,this.data);return i}reduce(e,t){let i=t;for(let r=0;r<this.length;++r)i=e(i,this.data[r],r,this.data);return i}has(e){const t=this.length,i=this.data;for(let r=0;r<t;++r)if(i[r]===e)return!0;return!1}}function Gs(e){e.data.length>1.5*e.length&&(e.data.length=Math.floor(1.1*e.length))}function Bs(e){return e}class qs{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}}class Hs{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}}let Ws=0;const $s={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},Js=["prepare","preRender","render","postRender","update"],Xs=[],Ks=new Us;class Ys{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const Zs={frameTasks:Ks,willDispatch:!1,clearFrameTasks:function(e=!1){Ks.forAll((e=>{e.removed=!0})),e&&nn()},dispatch:on,executeFrameTasks:function(e){const t=e-Ws;Ws=e;const i=1e3/60,r=Math.max(0,t-i);for(let s=0;s<Js.length;s++){const n=performance.now(),o=Js[s];Ks.forAll((n=>{var a;n.paused||n.removed||(0===s&&n.ticks++,n.phases[o]&&($s.time=e,$s.deltaTime=0===n.ticks?0:t,$s.elapsedFrameTime=performance.now()-e,$s.frameDuration=i-r,null==(a=n.phases[o])||a.call(n,$s)))})),an[s].record(performance.now()-n)}nn(),ln.record(performance.now()-e)}};function Qs(e){const t=new Hs(e);return Xs.push(t),Zs.willDispatch||(Zs.willDispatch=!0,js(on)),t}function en(e){const t=new qs(e);return Ks.push(t),null==tn&&(Ws=performance.now(),tn=requestAnimationFrame(rn)),new Ys(t)}let tn=null;function rn(){const e=performance.now();tn=null,tn=Ks.length>0?requestAnimationFrame(rn):null,Zs.executeFrameTasks(e)}const sn=new Us;function nn(){Ks.forAll((e=>{e.removed&&sn.push(e)})),Ks.removeUnorderedMany(sn.data,sn.length),sn.clear()}function on(){for(;Xs.length;){const e=Xs.shift();e.isActive&&e.callback()}Zs.willDispatch=!1}const an=Js.map((e=>new Ns(e))),ln=new Ns("total");function hn(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}class cn{constructor(e){this._notify=e,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const e=this._invalidCount;if(1===e)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}onObservableAccessed(e){this._accessed.includes(e)||this._accessed.push(e)}onTrackingEnd(){const e=this._handles,t=this._accessed;for(let i=0;i<t.length;++i)e.push(t[i].observe(this));t.length=0}clear(){const e=this._handles;for(let t=0;t<e.length;++t)e[t].remove();e.length=0}}let un=!1;const pn=[];function dn(e,t,i={runImmediately:!1}){let r=new cn((function i(){if(!r||n)return;if(un)return void fn(i);const o=s;r.clear(),un=!0,n=!0,s=Xr(r,e),n=!1,un=!1,t(s,o),yn()})),s=null,n=!1;return n=!0,s=Xr(r,e),n=!1,i.runImmediately&&t(s,s),{remove:function(){r&&(r.destroy(),r=null,s=null)}}}function fn(e){pn.includes(e)||pn.unshift(e)}function yn(){for(;pn.length;)pn.pop()()}class gn{constructor(){this.uid=0,this.target=null,this.path=null,this.oldValue=null,this.callback=null,this.getValue=null,this.removed=!1,this.propertyPath=null}acquire(e,t,i,r,s){this.target=e,this.path=t,this.oldValue=i,this.callback=r,this.getValue=s,this.propertyPath=function(e){return e?"string"==typeof e&&-1===e.indexOf(".")?e:Ar(e):e}(t),this.uid=++gn.uid,this.removed=!1}release(){this.target=this.path=this.propertyPath=this.callback=this.oldValue=null,this.uid=++gn.uid,this.removed=!0}}gn.pool=new ks(gn),gn.uid=0;const mn=new Cs,vn=new Set;let bn;function wn(e){vn.delete(e),vn.add(e),bn||(bn=Qs(Sn))}function _n(e){if(e.removed)return;const{callback:t,path:i,oldValue:r,target:s}=e,n=e.getValue();xn(r,n)&&(e.oldValue=n,t.call(s,n,r,i,s))}function xn(e,t){return!W(e,t)}function Sn(){let e=10;for(;bn&&e--;){bn=null;const e=Mn(),t=mn.acquire();for(const i of e){const e=i.uid;_n(i),e===i.uid&&i.removed&&t.push(i)}for(const i of vn)i.removed&&(t.push(i),vn.delete(i));for(let i=0;i<t.length;i++)gn.pool.release(t[i]);mn.release(t),mn.release(e),Tn.forEach((e=>e()))}}function Mn(){const e=mn.acquire();e.length=vn.size;let t=0;for(const i of vn)e[t]=i,++t;return vn.clear(),e}const Tn=new Set;function In(e){return Tn.add(e),{remove(){Tn.delete(e)}}}function En(e,t,i){let r=Cr(e,t,i,((e,t,i)=>{let s,n,o=function(e,t){let i=new cn((function(){t(r,s)})),r=null;function s(){return i?(i.clear(),r=Xr(i,e),r):null}return s(),{remove:function(){i&&(i.destroy(),i=null),r=null}}}((()=>Rr(e,t)),((o,a)=>{e.__accessor__.destroyed||s&&s.uid!==n?r.remove():(s||(s=gn.pool.acquire(e,t,o,i,a),n=s.uid),wn(s))}));return{remove:Or((function(){o.remove(),s&&(s.uid!==n||s.removed||(s.removed=!0,wn(s)),s=null),r=o=null}))}}));return r}function An(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?function(e,t,i){const r=Cr(e,t,i,((e,t,i)=>{let s=!1;return dn((()=>Rr(e,t)),((n,o)=>{e.__accessor__.destroyed?r.remove():s||(s=!0,xn(o,n)&&i.call(e,n,o,t,e),s=!1)}))}));return r}(e,t,i):En(e,t,i)}function Pn(e){return hn(vn,(t=>t.oldValue===e))}const Cn=Ne.getLogger("esri.core.Accessor");function On(e){return null==e?e:new Date(e)}function kn(e){return null==e?e:!!e}function Ln(e){return null==e?e:e.toString()}function Rn(e){return null==e?e:(e=parseFloat(e),isNaN(e)?0:e)}function Dn(e){return null==e?e:Math.round(parseFloat(e))}function Fn(e){return e&&e.constructor&&void 0!==e.constructor.__accessorMetadata__}function jn(e,t){return null!=t&&e&&!(t instanceof e)}function Nn(e){return e&&"isCollection"in e}function zn(e){return e&&e.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function Vn(e,t){return!!Fn(t)&&(Cn.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+Gn(e)+"'"),!0)}function Un(e,t){return null==t?t:Nn(e)?function(e,t){if(!t||!t.constructor||!Nn(t.constructor))return Vn(e,t)?t:new e(t);const i=zn(e.prototype.itemType),r=zn(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(Vn(e,t),t):new e(t):t}(e,t):jn(e,t)?Vn(e,t)?t:new e(t):t}function Gn(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}function Bn(e){switch(e){case Number:return Rn;case Yn:return Dn;case Boolean:return kn;case String:return Ln;case Date:return On;default:return Un.bind(null,e)}}function qn(e,t){const i=Bn(e);return 1===arguments.length?i:i(t)}function Hn(e,t,i){return 1===arguments.length?Hn.bind(null,e):t?Array.isArray(t)?t.map((t=>e(t,i))):[e(t,i)]:t}function Wn(e,t,i){return 0!==t&&Array.isArray(i)?i.map((i=>Wn(e,t-1,i))):e(i)}function $n(e,t,i){if(2===arguments.length)return $n.bind(null,e,t);if(!i)return i;let r=t,s=i=Wn(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(void 0!==s)for(let n=0;n<r;n++)i=[i];return i}function Jn(e){return!!Array.isArray(e)&&!e.some((t=>{const i=typeof t;return!("string"===i||"number"===i||"function"===i&&e.length>1)}))}function Xn(e,t){if(2===arguments.length)return Xn(e).call(null,t);const i=new Set,r=e.filter((e=>"function"!=typeof e)),s=e.filter((e=>"function"==typeof e));for(const a of e)"string"!=typeof a&&"number"!=typeof a||i.add(a);let n=null,o=null;return(e,t)=>{if(null==e)return e;const a=typeof e,l="string"===a||"number"===a;return l&&(i.has(e)||s.some((e=>"string"===a&&e===String||"number"===a&&e===Number)))||"object"===a&&s.some((t=>!jn(e,t)))?e:(l&&r.length?(n||(n=r.map((e=>"string"==typeof e?`'${e}'`:`${e}`)).join(", ")),Cn.error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${n}`)):"object"==typeof e&&s.length?(o||(o=s.map((e=>Gn(e))).join(", ")),Cn.error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${o}`)):Cn.error("Accessor#set",`'${e}' is not a valid value for this property`),t&&(t.valid=!1),null)}}function Kn(e,t){if(2===arguments.length)return Kn(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const t=e.typeMap[l];i[l]=qn(t),r.push(Gn(t)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a="string"==typeof e.key?t=>t[e.key]:e.key;return t=>{if(e.base&&!jn(e.base,t))return t;if(null==t)return t;const r=a(t)||e.defaultKeyValue,s=i[r];if(!s)return Cn.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!jn(e.typeMap[r],t))return t;if("string"==typeof e.key&&!Fn(t)){const i={};for(const r in t)r!==e.key&&(i[r]=t[r]);return s(i)}return s(t)}}class Yn{}const Zn={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function Qn(e){switch(e.type){case"native":return qn(e.value);case"array":return Hn(Qn(e.value));case"one-of":return function(e){let t=null;return(i,r)=>to(i,e)?i:(null==t&&(t=eo(e)),Cn.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}(e);default:return null}}function eo(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case Yn:return"integer";case Date:return"date";default:return Gn(e.value)}case"array":return`array of ${eo(e.value)}`;case"one-of":{const t=e.values.map((e=>eo(e)));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function to(e,t){if(null==e)return!0;switch(t.type){case"native":switch(t.value){case Number:case Yn:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some((e=>!to(e,t.value)));case"one-of":return t.values.some((t=>to(e,t)))}}const io=Ne.getLogger("esri.core.accessorSupport.decorators.property");function ro(e={}){return(t,i,r)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const s=zr(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&io.warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),null!=e.readOnly&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const e="string"==typeof n?n:n.source,t="string"==typeof n?null:!0===n.overridable;let r;s.dependsOn=[e],s.get=function(){let t=Dr(this,e);if("function"==typeof t){r||(r=e.split(".").slice(0,-1).join("."));const i=Dr(this,r);i&&(t=t.bind(i))}return t},s.readOnly||(s.set=t?function(e){void 0!==e?this._override(i,e):this._clearOverride(i)}:function(t){As(this,e,t)})}const o=e.type,a=e.types;s.cast||(o?s.cast=function(e){let t=0,i=e;if(function(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}(e))return Qn(e);for(;Array.isArray(i)&&1===i.length&&"string"!=typeof i[0]&&"number"!=typeof i[0];)i=i[0],t++;const r=i;if(Jn(r))return 0===t?Xn(r):$n(Xn(r),t);if(1===t)return function(e,t){return 1===arguments.length?Hn(qn.bind(null,e)):Hn(qn.bind(null,e),t)}(r);if(t>1)return function(e,t,i){return 2===arguments.length?$n(qn.bind(null,e),t):$n(qn.bind(null,e),t,i)}(r,t);const s=e;return s.from?s.from:qn(s)}(o):a&&(Array.isArray(a)?s.cast=Hn(Kn(a[0])):s.cast=Kn(a))),e.range&&(s.cast=no(s.cast,e.range)),function(e,t){Ir(e,t,Ur)}(s,e)}}function so(e,t,i){const r=zr(e,i);r.json||(r.json={});let s=r.json;return void 0!==t&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function no(e,t){return i=>{let r=+e(i);return null!=t.step&&(r=Math.round(r/t.step)*t.step),null!=t.min&&(r=Math.max(t.min,r)),null!=t.max&&(r=Math.min(t.max,r)),r}}class oo extends Ge{constructor(e,t,i){if(super(e,t,i),!(this instanceof oo))return new oo(e,t,i)}}function ao(e){return!!e&&e.prototype&&e.prototype.declaredClass&&0===e.prototype.declaredClass.indexOf("esri.core.Collection")}oo.prototype.type="warning";const lo=Ne.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function ho(e,t,i){var r,s;e&&(!i&&!t.read||null!=(r=t.read)&&r.reader||!1===(null==(s=t.read)?void 0:s.enabled)||function(e){return"types"in e?mo(e.types):go(e.type)}(e)&&X("read.reader",co(e),t))}function co(e){var t;const i=null!=(t=e.ndimArray)?t:0;if(i>1)return function(e){var t;const i=uo(e),r=po.bind(null,i),s=null!=(t=e.ndimArray)?t:0;return(e,t,i)=>{if(null==e)return e;e=r(e,i,s);let n=s,o=e;for(;n>0&&Array.isArray(o);)n--,o=o[0];if(void 0!==o)for(let r=0;r<n;r++)e=[e];return e}}(e);if(1===i)return fo(e);if("type"in e&&yo(e.type)){var r,s;const t=null==(r=e.type.prototype)||null==(s=r.itemType)?void 0:s.Type,i=fo("function"==typeof t?{type:t}:{types:t});return(t,r,s)=>{const n=i(t,r,s);return n?new e.type(n):n}}return uo(e)}function uo(e){return"type"in e?function(e){return e.prototype.read?(t,i,r)=>{if(null==t)return t;const s=typeof t;if("object"!==s)return void lo.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}(e.type):function(e){var t;let i=null;const r=null!=(t=e.errorContext)?t:"type";return(t,s,n)=>{if(null==t)return t;const o=typeof t;if("object"!==o)return void lo.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);i||(i=function(e){const t={};for(const s in e.typeMap){var i,r;const n=e.typeMap[s],o=Nr(n.prototype);if("function"==typeof e.key)continue;const a=o.properties[e.key];if(!a)continue;null!=(i=a.json)&&i.type&&Array.isArray(a.json.type)&&1===a.json.type.length&&"string"==typeof a.json.type[0]&&(t[a.json.type[0]]=n);const l=null==(r=a.json)?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const h=l.target,c="string"==typeof h?h:e.key,u={};l.writer(s,u,c),u[c]&&(t[u[c]]=n)}return t}(e));const a=e.key;if("string"!=typeof a)return;const l=t[a],h=l?i[l]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const e=`Type '${l||"unknown"}' is not supported`;return n&&n.messages&&t&&n.messages.push(new oo(`${r}:unsupported`,e,{definition:t,context:n})),void lo.error(e)}const c=new h;return c.read(t,n),c}}(e.types)}function po(e,t,i,r){return 0!==r&&Array.isArray(t)?t.map((t=>po(e,t,i,r-1))):e(t,void 0,i)}function fo(e){const t=uo(e);return(e,i,r)=>{if(null==e)return e;if(Array.isArray(e)){const i=[];for(const s of e){const e=t(s,void 0,r);void 0!==e&&i.push(e)}return i}const s=t(e,void 0,r);return void 0!==s?[s]:void 0}}function yo(e){if(!ao(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&("function"==typeof t.Type?go(t.Type):mo(t.Type))}function go(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||yo(e))}function mo(e){for(const t in e.typeMap)if(!go(e.typeMap[t]))return!1;return!0}function vo(e){e.name&&(e.read&&"object"==typeof e.read?void 0===e.read.source&&(e.read.source=e.name):e.read={source:e.name},e.write&&"object"==typeof e.write?void 0===e.write.target&&(e.write.target=e.name):e.write={target:e.name})}function bo(e){"boolean"==typeof e.read?e.read={enabled:e.read}:"function"==typeof e.read?e.read={enabled:!0,reader:e.read}:e.read&&"object"==typeof e.read&&void 0===e.read.enabled&&(e.read.enabled=!0)}function wo(e){"boolean"==typeof e.write?e.write={enabled:e.write}:"function"==typeof e.write?e.write={enabled:!0,writer:e.write}:e.write&&"object"==typeof e.write&&void 0===e.write.enabled&&(e.write.enabled=!0)}function _o(e,t){var i;if(!t.write||t.write.writer||!1===t.write.enabled&&!t.write.overridePolicy)return;const r=null!=(i=null==e?void 0:e.ndimArray)?i:0;e&&(1===r||"type"in e&&ao(e.type))?t.write.writer=To:t.write.writer=r>1?function(e){return function(t,i,r,s){let n;if(null===t)n=null;else{n=Io(t,s,e);let i=e,r=n;for(;i>0&&Array.isArray(r);)i--,r=r[0];if(void 0!==r)for(let e=0;e<i;e++)n=[n]}X(r,n,i)}}(r):xo}function xo(e,t,i,r){X(i,So(e,r),t)}function So(e,t){return e&&"function"==typeof e.write?e.write({},t):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?Mo(e):e}function Mo(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function To(e,t,i,r){let s;null===e?s=null:e&&"function"==typeof e.map?(s=e.map((e=>So(e,r))),"function"==typeof s.toArray&&(s=s.toArray())):s=[So(e,r)],X(i,s,t)}function Io(e,t,i){return 0!==i&&Array.isArray(e)?e.map((e=>Io(e,t,i-1))):So(e,t)}function Eo(e,t){return Po(e,"read",t)}function Ao(e,t){return Po(e,"write",t)}function Po(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&("any"===t||t in s)&&(r=s)}return r}function Co(e){const t=function(e){return e.type?function(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!Jn(i);)i=i[0],t++;return{type:i,ndimArray:t}}(e):function(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}(e)}(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i];ho(t,r,!1),_o(t,r)}ho(t,e.json,!0),_o(t,e.json)}const Oo=[{processPrototypePropertyMetadata(e,t){(function(e){if(e.json||(e.json={}),bo(e.json),wo(e.json),vo(e.json),e.json.origins)for(const t in e.json.origins)bo(e.json.origins[t]),wo(e.json.origins[t]),vo(e.json.origins[t]);return!0})(t)&&(function(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const e in i)if(t[e]){const r=t[e];i[e].forEach((e=>{t[e]=r})),delete t[e]}}}(t),Co(t))}}];const ko=new Set,Lo=new Set;function Ro(e){return t=>{t.prototype.declaredClass=e,function(e,t){for(const i of Oo)if(i.processPrototypePropertyMetadata)for(const r in e){const s=e[r];i.processPrototypePropertyMetadata(r,s,e,t)}}(Nr(t.prototype).properties,e),function(e){const t=e.prototype,i=t.declaredClass,r=Nr(t).properties;!function(e,t){for(const i of Oo)if(i.processClassPropertyMetadata)for(const r in e){const s=e[r];i.processClassPropertyMetadata(r,s,e,t)}}(r,i);const s={};for(const n of Object.getOwnPropertyNames(r)){const e=r[n];s[n]={enumerable:!0,configurable:!0,get:Do(n,e),set(t){const i=this.__accessor__;if(void 0!==i){if(!Object.isFrozen(this)){if(i.initialized&&e.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(2===i.lifecycle&&e.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);i.set(n,t)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:t})}}}Object.defineProperties(e.prototype,s)}(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!ko.has(s.initialize)&&(ko.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!Lo.has(s.destroy)&&(Lo.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);ko.clear(),Lo.clear();class n extends t{constructor(...e){if(super(...e),this.constructor===n&&"function"==typeof this.postscript){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let e=i.length-1;e>=0;e--)i[e].call(this)}}),r.length){let e=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!e){e=!0;for(let e=0;e<r.length;e++)r[e].call(this)}}})}this.postscript(...e)}}}return n.__accessorMetadata__=Nr(t.prototype),n.prototype.declaredClass=e,n}}function Do(e,t){return null==t.get?function(){const t=this.__accessor__.properties.get(e);if(void 0===t)return;Wr(t);const i=this.__accessor__.store;return i.has(e)?i.get(e):t.metadata.value}:function(){const t=this.__accessor__.properties.get(e);if(void 0!==t)return t.getComputed()}}function Fo(e){if(null==e)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return e.constructor&&e.constructor.__accessorMetadata__||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}class jo{constructor(...e){if(this.constructor===jo)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new Is(this)}),e.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,e))}static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:t,declaredClass:i,constructor:r}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class n extends s{constructor(...e){super(...e),this.inherited=null,r&&r.apply(this,e)}}Nr(n.prototype);for(const o in e){const t=e[o];n.prototype[o]="function"==typeof t?function(...e){const i=this.inherited;let r;this.inherited=function(...e){if(s.prototype[o])return s.prototype[o].apply(this,e)};try{r=t.apply(this,e)}catch(n){throw this.inherited=i,n}return this.inherited=i,r}:e[o]}for(const o in t){ro(Fo(t[o]))(n.prototype,o)}return Ro(i)(n)}postscript(e){const t=this.__accessor__,i=t.ctorArgs||e;t.initialize(),i&&(this.set(i),t.ctorArgs=null),t.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(function(e){for(const t of vn.values())t.target===e&&(t.removed=!0)}(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&2===this.__accessor__.lifecycle||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return Dr(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}isInstanceOf(e){return function(e,t,i={}){if(y("esri-deprecation-warnings")){const{moduleName:r}=i;wr(e,"Function: "+(r?r+"::":"")+t+"()",i)}}(Ne.getLogger(this.declaredClass),"isInstanceOf",{replacement:"Use instanceof directly",version:"4.16"}),this instanceof e}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,t){return As(this,e,t),this}watch(e,t,i){return An(this,e,t,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_override(e,t){return this.__accessor__.override(e,t)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,t){return this.__accessor__.internalSet(e,t),this}}function No(e,t,i){if(!e||!e.read||!1===e.read.enabled||!e.read.source)return!1;const r=e.read.source;if("string"==typeof r){if(r===t)return!0;if(r.indexOf(".")>-1&&0===r.indexOf(t)&&Fr(r,i))return!0}else for(const s of r){if(s===t)return!0;if(s.indexOf(".")>-1&&0===s.indexOf(t)&&Fr(s,i))return!0}return!1}function zo(e,t,i,r,s){let n=Eo(t[i],s);(function(e){return e&&(!e.read||!1!==e.read.enabled&&!e.read.source)})(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=Eo(t[o],s),No(n,i,r)&&(e[o]=!0)}function Vo(e,t,i,r){const s=Po(i.metadatas[t],"any",r),n=s&&s.default;if(void 0===n)return;const o="function"==typeof n?n.call(e,t,r):n;void 0!==o&&i.set(t,o)}const Uo={origin:"service"};function Go(e,t,i=Uo){if(!t||"object"!=typeof t)return;const r=Tr(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))zo(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const n=Eo(s[o],i).read,a=n&&n.source;let l;l=a&&"string"==typeof a?Rr(t,a):t[o],n&&n.reader&&(l=n.reader.call(e,l,t,i)),void 0!==l&&r.set(o,l)}if(!i||!i.ignoreDefaults)for(const o of Object.getOwnPropertyNames(s))n[o]||Vo(e,o,r,i);r.setDefaultOrigin("user")}const Bo=Ne.getLogger("esri.core.accessorSupport.write");function qo(e,t,i,r,s){var n,o;const a={};return null==(n=t.write)||null==(o=n.writer)||o.call(e,r,a,i,s),a}function Ho(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const t=r.write.overridePolicy.call(e,o,i,n);void 0!==t&&(s=t)}if(s||(s=r.write),!s||!1===s.enabled)return!1;if((null===o&&!s.allowNull||void 0===o)&&s.isRequired){const t=new Be("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return t&&n&&n.messages?n.messages.push(t):t&&!n&&Bo.error(t.name,t.message),!1}return void 0!==o&&(!(null===o&&!s.allowNull)&&(!function(e,t,i,r,s){const n=r.default;if(void 0===n)return!1;if(null!=r.defaultEquals)return r.defaultEquals(s);if("function"==typeof n){if(Array.isArray(s)){return ns(n.call(e,t,i),s)}return!1}return n===s}(e,i,n,r,o)&&(void 0!==r.default||!(!s.ignoreOrigin&&n&&n.origin&&t.store.originOf(i)<bs(n.origin)))))}function Wo(e,t,i,r){const s=Tr(e),n=Ao(s.metadatas[t],r);return!!n&&Ho(e,s,t,n,i,r)}function $o(e,t,i){if(e&&"function"==typeof e.toJSON&&(!e.toJSON.isDefaultToJSON||!e.write))return Ir(t,e.toJSON());const r=Tr(e),s=r.metadatas;for(const a in s){const l=Ao(s[a],i);if(!Ho(e,r,a,l,void 0,i))continue;const h=e.get(a),c=qo(e,l,l.write&&"string"==typeof l.write.target?l.write.target:a,h,i);var n,o;Object.keys(c).length>0&&(t=Ir(t,c),null!=i&&null!=(n=i.resources)&&null!=(o=n.pendingOperations)&&o.length&&Promise.all(i.resources.pendingOperations).then((()=>Ir(t,c))),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:_s(r.store.originOf(a)),newOrigin:i.origin}))}return t}const Jo=e=>{let t=class extends e{constructor(...e){super(...e)}read(e,t){Go(this,e,t)}write(e={},t){return $o(this,e,t)}toJSON(e){return this.write({},e)}static fromJSON(e,t){return Xo.call(this,e,t)}};return t=Q([Ro("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function Xo(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let Ko=class extends(Jo(jo)){};Ko=Q([Ro("esri.core.JSONSupport")],Ko);class Yo{constructor(e){this.instance=e,this._resolver=ut(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then((()=>{this._status=1,this._cleanUp()}),(()=>{this._status=2,this._cleanUp()}))}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return 1===this._status}isRejected(){return 2===this._status}isFulfilled(){return 0!==this._status}abort(){this._resolver.reject(Qe())}when(e,t){return this._resolver.promise.then(e,t)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const e=ut(),t=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(t);i.then((()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve(this.instance)}),(e=>{this.isFulfilled()||this._allPromise!==i||ht(e)||this._resolver.reject(e)})),e.resolve()}}const Zo=e=>{let t=class extends e{constructor(...e){super(...e),this._promiseProps=new Yo(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,t){return new Promise(((e,t)=>{this._promiseProps.when(e,t)})).then(e,t)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}};return t=Q([Ro("esri.core.Promise")],t),t};let Qo=class extends(Zo(jo)){};Qo=Q([Ro("esri.core.Promise")],Qo);const ea=e=>{let t=class extends e{constructor(...e){super(...e),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise((e=>{const t=this.load.bind(this);this.load=i=>{const r=new Promise(((e,t)=>{const r=at(i,t);this.destroyed&&t(new Be("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(e,t).finally((()=>{r&&r.remove()}))}));if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=et();t({signal:e.signal}),ot(e.signal,(()=>{this._promiseProps.abort()}))}return e(),r}}))),this.when((()=>{this._set("loadStatus","loaded"),this._loadController=null}),(e=>{this._set("loadStatus","failed"),this._set("loadError",e),this._loadController=null}))}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var e;return this.isFulfilled()||(this._set("loadError",new Be("load:cancelled","Cancelled")),null==(e=this._loadController)||e.abort()),this}};return Q([ro({readOnly:!0})],t.prototype,"loaded",null),Q([ro({readOnly:!0})],t.prototype,"loadError",void 0),Q([ro()],t.prototype,"loadStatus",void 0),Q([ro({type:[oo],readOnly:!0})],t.prototype,"loadWarnings",null),t=Q([Ro("esri.core.Loadable")],t),t};let ta=class extends(ea(Qo)){};var ia;ta=Q([Ro("esri.core.Loadable")],ta),(ia=ta||(ta={})).LoadableMixin=ea,ia.isLoadable=function(e){return!(!e||!e.load)};var ra=ta;function sa(e,t,i){let r,s;return void 0===t||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(e,t)=>{const n=e.constructor.prototype;r.forEach((r=>{const o=so(e,r,s);o.read&&"object"!=typeof o.read&&(o.read={}),X("read.reader",n[t],o),i&&(o.read.source=(o.read.source||[]).concat(i))}))}}function na(e,t,i){let r,s;return void 0===t?(s=e,r=[void 0]):"string"!=typeof t?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(e,t)=>{const n=e.constructor.prototype;r.forEach((r=>{const o=so(e,r,s);o.write&&"object"!=typeof o.write&&(o.write={}),i&&X("write.target",i,o),X("write.writer",n[t],o)}))}}let oa;const aa={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:13,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:14,102069:15,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(oa=2e3;oa<=2045;oa++)aa[oa]=0;for(oa=2056;oa<=2065;oa++)aa[oa]=0;for(oa=2067;oa<=2135;oa++)aa[oa]=0;for(oa=2137;oa<=2154;oa++)aa[oa]=0;for(oa=2161;oa<=2170;oa++)aa[oa]=0;for(oa=2172;oa<=2193;oa++)aa[oa]=0;for(oa=2195;oa<=2198;oa++)aa[oa]=0;for(oa=2200;oa<=2203;oa++)aa[oa]=0;for(oa=2205;oa<=2217;oa++)aa[oa]=0;for(oa=2222;oa<=2224;oa++)aa[oa]=1;for(oa=2225;oa<=2250;oa++)aa[oa]=2;for(oa=2251;oa<=2253;oa++)aa[oa]=1;for(oa=2257;oa<=2264;oa++)aa[oa]=2;for(oa=2274;oa<=2279;oa++)aa[oa]=2;for(oa=2280;oa<=2282;oa++)aa[oa]=1;for(oa=2283;oa<=2289;oa++)aa[oa]=2;for(oa=2290;oa<=2292;oa++)aa[oa]=0;for(oa=2308;oa<=2313;oa++)aa[oa]=0;for(oa=2315;oa<=2491;oa++)aa[oa]=0;for(oa=2494;oa<=2866;oa++)aa[oa]=0;for(oa=2867;oa<=2869;oa++)aa[oa]=1;for(oa=2870;oa<=2888;oa++)aa[oa]=2;for(oa=2891;oa<=2895;oa++)aa[oa]=2;for(oa=2896;oa<=2898;oa++)aa[oa]=1;for(oa=2902;oa<=2908;oa++)aa[oa]=2;for(oa=2915;oa<=2920;oa++)aa[oa]=2;for(oa=2921;oa<=2923;oa++)aa[oa]=1;for(oa=2924;oa<=2930;oa++)aa[oa]=2;for(oa=2931;oa<=2962;oa++)aa[oa]=0;for(oa=2964;oa<=2968;oa++)aa[oa]=2;for(oa=2969;oa<=2973;oa++)aa[oa]=0;for(oa=2975;oa<=2991;oa++)aa[oa]=0;for(oa=2995;oa<=3051;oa++)aa[oa]=0;for(oa=3054;oa<=3079;oa++)aa[oa]=0;for(oa=3081;oa<=3088;oa++)aa[oa]=0;for(oa=3092;oa<=3101;oa++)aa[oa]=0;for(oa=3106;oa<=3138;oa++)aa[oa]=0;for(oa=3146;oa<=3151;oa++)aa[oa]=0;for(oa=3153;oa<=3166;oa++)aa[oa]=0;for(oa=3168;oa<=3172;oa++)aa[oa]=0;for(oa=3174;oa<=3203;oa++)aa[oa]=0;for(oa=3294;oa<=3358;oa++)aa[oa]=0;for(oa=3367;oa<=3403;oa++)aa[oa]=0;for(oa=3408;oa<=3416;oa++)aa[oa]=0;for(oa=3417;oa<=3438;oa++)aa[oa]=2;for(oa=3441;oa<=3446;oa++)aa[oa]=2;for(oa=3447;oa<=3450;oa++)aa[oa]=0;for(oa=3451;oa<=3459;oa++)aa[oa]=2;for(oa=3460;oa<=3478;oa++)aa[oa]=0;for(oa=3554;oa<=3559;oa++)aa[oa]=0;for(oa=3560;oa<=3570;oa++)aa[oa]=2;for(oa=3571;oa<=3581;oa++)aa[oa]=0;for(oa=3594;oa<=3597;oa++)aa[oa]=0;for(oa=3601;oa<=3604;oa++)aa[oa]=0;for(oa=3637;oa<=3639;oa++)aa[oa]=0;for(oa=3665;oa<=3667;oa++)aa[oa]=0;for(oa=3693;oa<=3695;oa++)aa[oa]=0;for(oa=3701;oa<=3727;oa++)aa[oa]=0;for(oa=3728;oa<=3739;oa++)aa[oa]=2;for(oa=3740;oa<=3751;oa++)aa[oa]=0;for(oa=3753;oa<=3760;oa++)aa[oa]=2;for(oa=3761;oa<=3773;oa++)aa[oa]=0;for(oa=3775;oa<=3777;oa++)aa[oa]=0;for(oa=3779;oa<=3781;oa++)aa[oa]=0;for(oa=3783;oa<=3785;oa++)aa[oa]=0;for(oa=3788;oa<=3791;oa++)aa[oa]=0;for(oa=3797;oa<=3802;oa++)aa[oa]=0;for(oa=3814;oa<=3816;oa++)aa[oa]=0;for(oa=3825;oa<=3829;oa++)aa[oa]=0;for(oa=3832;oa<=3841;oa++)aa[oa]=0;for(oa=3844;oa<=3852;oa++)aa[oa]=0;for(oa=3873;oa<=3885;oa++)aa[oa]=0;for(oa=3890;oa<=3893;oa++)aa[oa]=0;for(oa=3907;oa<=3912;oa++)aa[oa]=0;for(oa=3942;oa<=3950;oa++)aa[oa]=0;for(oa=3968;oa<=3970;oa++)aa[oa]=0;for(oa=3973;oa<=3976;oa++)aa[oa]=0;for(oa=3986;oa<=3989;oa++)aa[oa]=0;for(oa=3994;oa<=3997;oa++)aa[oa]=0;for(oa=4048;oa<=4051;oa++)aa[oa]=0;for(oa=4056;oa<=4063;oa++)aa[oa]=0;for(oa=4093;oa<=4096;oa++)aa[oa]=0;for(oa=4390;oa<=4398;oa++)aa[oa]=0;for(oa=4399;oa<=4413;oa++)aa[oa]=2;for(oa=4418;oa<=4433;oa++)aa[oa]=2;for(oa=4455;oa<=4457;oa++)aa[oa]=2;for(oa=4484;oa<=4489;oa++)aa[oa]=0;for(oa=4491;oa<=4554;oa++)aa[oa]=0;for(oa=4568;oa<=4589;oa++)aa[oa]=0;for(oa=4652;oa<=4656;oa++)aa[oa]=0;for(oa=4766;oa<=4800;oa++)aa[oa]=0;for(oa=5014;oa<=5016;oa++)aa[oa]=0;for(oa=5069;oa<=5072;oa++)aa[oa]=0;for(oa=5105;oa<=5130;oa++)aa[oa]=0;for(oa=5173;oa<=5188;oa++)aa[oa]=0;for(oa=5253;oa<=5259;oa++)aa[oa]=0;for(oa=5269;oa<=5275;oa++)aa[oa]=0;for(oa=5292;oa<=5311;oa++)aa[oa]=0;for(oa=5329;oa<=5331;oa++)aa[oa]=0;for(oa=5343;oa<=5349;oa++)aa[oa]=0;for(oa=5355;oa<=5357;oa++)aa[oa]=0;for(oa=5387;oa<=5389;oa++)aa[oa]=0;for(oa=5459;oa<=5463;oa++)aa[oa]=0;for(oa=5479;oa<=5482;oa++)aa[oa]=0;for(oa=5518;oa<=5520;oa++)aa[oa]=0;for(oa=5530;oa<=5539;oa++)aa[oa]=0;for(oa=5550;oa<=5552;oa++)aa[oa]=0;for(oa=5562;oa<=5583;oa++)aa[oa]=0;for(oa=5623;oa<=5625;oa++)aa[oa]=2;for(oa=5631;oa<=5639;oa++)aa[oa]=0;for(oa=5649;oa<=5653;oa++)aa[oa]=0;for(oa=5663;oa<=5680;oa++)aa[oa]=0;for(oa=5682;oa<=5685;oa++)aa[oa]=0;for(oa=5875;oa<=5877;oa++)aa[oa]=0;for(oa=5896;oa<=5899;oa++)aa[oa]=0;for(oa=5921;oa<=5940;oa++)aa[oa]=0;for(oa=6050;oa<=6125;oa++)aa[oa]=0;for(oa=6244;oa<=6275;oa++)aa[oa]=0;for(oa=6328;oa<=6348;oa++)aa[oa]=0;for(oa=6350;oa<=6356;oa++)aa[oa]=0;for(oa=6366;oa<=6372;oa++)aa[oa]=0;for(oa=6381;oa<=6387;oa++)aa[oa]=0;for(oa=6393;oa<=6404;oa++)aa[oa]=0;for(oa=6480;oa<=6483;oa++)aa[oa]=0;for(oa=6511;oa<=6514;oa++)aa[oa]=0;for(oa=6579;oa<=6581;oa++)aa[oa]=0;for(oa=6619;oa<=6624;oa++)aa[oa]=0;for(oa=6625;oa<=6627;oa++)aa[oa]=2;for(oa=6628;oa<=6632;oa++)aa[oa]=0;for(oa=6634;oa<=6637;oa++)aa[oa]=0;for(oa=6669;oa<=6692;oa++)aa[oa]=0;for(oa=6707;oa<=6709;oa++)aa[oa]=0;for(oa=6720;oa<=6723;oa++)aa[oa]=0;for(oa=6732;oa<=6738;oa++)aa[oa]=0;for(oa=6931;oa<=6933;oa++)aa[oa]=0;for(oa=6956;oa<=6959;oa++)aa[oa]=0;for(oa=7005;oa<=7007;oa++)aa[oa]=0;for(oa=7057;oa<=7070;oa++)aa[oa]=2;for(oa=7074;oa<=7082;oa++)aa[oa]=0;for(oa=7109;oa<=7118;oa++)aa[oa]=0;for(oa=7119;oa<=7127;oa++)aa[oa]=1;for(oa=7374;oa<=7376;oa++)aa[oa]=0;for(oa=7528;oa<=7586;oa++)aa[oa]=0;for(oa=7587;oa<=7645;oa++)aa[oa]=2;for(oa=7692;oa<=7696;oa++)aa[oa]=0;for(oa=7755;oa<=7787;oa++)aa[oa]=0;for(oa=7791;oa<=7795;oa++)aa[oa]=0;for(oa=7799;oa<=7801;oa++)aa[oa]=0;for(oa=7803;oa<=7805;oa++)aa[oa]=0;for(oa=7825;oa<=7831;oa++)aa[oa]=0;for(oa=7845;oa<=7859;oa++)aa[oa]=0;for(oa=8013;oa<=8032;oa++)aa[oa]=0;for(oa=8065;oa<=8068;oa++)aa[oa]=1;for(oa=8518;oa<=8529;oa++)aa[oa]=2;for(oa=8533;oa<=8536;oa++)aa[oa]=2;for(oa=8538;oa<=8540;oa++)aa[oa]=2;for(oa=8677;oa<=8679;oa++)aa[oa]=0;for(oa=8836;oa<=8840;oa++)aa[oa]=0;for(oa=8857;oa<=8859;oa++)aa[oa]=0;for(oa=8908;oa<=8910;oa++)aa[oa]=0;for(oa=9154;oa<=9159;oa++)aa[oa]=0;for(oa=9205;oa<=9218;oa++)aa[oa]=0;for(oa=9271;oa<=9273;oa++)aa[oa]=0;for(oa=9295;oa<=9297;oa++)aa[oa]=0;for(oa=9356;oa<=9360;oa++)aa[oa]=0;for(oa=9404;oa<=9407;oa++)aa[oa]=0;for(oa=9476;oa<=9482;oa++)aa[oa]=0;for(oa=9487;oa<=9494;oa++)aa[oa]=0;for(oa=9697;oa<=9699;oa++)aa[oa]=0;for(oa=20002;oa<=20032;oa++)aa[oa]=0;for(oa=20062;oa<=20092;oa++)aa[oa]=0;for(oa=20135;oa<=20138;oa++)aa[oa]=0;for(oa=20248;oa<=20258;oa++)aa[oa]=0;for(oa=20348;oa<=20358;oa++)aa[oa]=0;for(oa=20436;oa<=20440;oa++)aa[oa]=0;for(oa=20822;oa<=20824;oa++)aa[oa]=0;for(oa=20934;oa<=20936;oa++)aa[oa]=0;for(oa=21035;oa<=21037;oa++)aa[oa]=0;for(oa=21095;oa<=21097;oa++)aa[oa]=0;for(oa=21148;oa<=21150;oa++)aa[oa]=0;for(oa=21413;oa<=21423;oa++)aa[oa]=0;for(oa=21453;oa<=21463;oa++)aa[oa]=0;for(oa=21473;oa<=21483;oa++)aa[oa]=0;for(oa=21780;oa<=21782;oa++)aa[oa]=0;for(oa=21891;oa<=21894;oa++)aa[oa]=0;for(oa=21896;oa<=21899;oa++)aa[oa]=0;for(oa=22171;oa<=22177;oa++)aa[oa]=0;for(oa=22181;oa<=22187;oa++)aa[oa]=0;for(oa=22191;oa<=22197;oa++)aa[oa]=0;for(oa=22234;oa<=22236;oa++)aa[oa]=0;for(oa=22521;oa<=22525;oa++)aa[oa]=0;for(oa=22991;oa<=22994;oa++)aa[oa]=0;for(oa=23028;oa<=23038;oa++)aa[oa]=0;for(oa=23830;oa<=23853;oa++)aa[oa]=0;for(oa=23866;oa<=23872;oa++)aa[oa]=0;for(oa=23877;oa<=23884;oa++)aa[oa]=0;for(oa=23886;oa<=23894;oa++)aa[oa]=0;for(oa=23946;oa<=23948;oa++)aa[oa]=0;for(oa=24311;oa<=24313;oa++)aa[oa]=0;for(oa=24342;oa<=24347;oa++)aa[oa]=0;for(oa=24370;oa<=24374;oa++)aa[oa]=10;for(oa=24375;oa<=24381;oa++)aa[oa]=0;for(oa=24718;oa<=24721;oa++)aa[oa]=0;for(oa=24817;oa<=24821;oa++)aa[oa]=0;for(oa=24877;oa<=24882;oa++)aa[oa]=0;for(oa=24891;oa<=24893;oa++)aa[oa]=0;for(oa=25391;oa<=25395;oa++)aa[oa]=0;for(oa=25828;oa<=25838;oa++)aa[oa]=0;for(oa=26191;oa<=26195;oa++)aa[oa]=0;for(oa=26391;oa<=26393;oa++)aa[oa]=0;for(oa=26701;oa<=26722;oa++)aa[oa]=0;for(oa=26729;oa<=26799;oa++)aa[oa]=2;for(oa=26801;oa<=26803;oa++)aa[oa]=2;for(oa=26811;oa<=26813;oa++)aa[oa]=2;for(oa=26847;oa<=26870;oa++)aa[oa]=2;for(oa=26891;oa<=26899;oa++)aa[oa]=0;for(oa=26901;oa<=26923;oa++)aa[oa]=0;for(oa=26929;oa<=26946;oa++)aa[oa]=0;for(oa=26948;oa<=26998;oa++)aa[oa]=0;for(oa=27037;oa<=27040;oa++)aa[oa]=0;for(oa=27205;oa<=27232;oa++)aa[oa]=0;for(oa=27258;oa<=27260;oa++)aa[oa]=0;for(oa=27391;oa<=27398;oa++)aa[oa]=0;for(oa=27561;oa<=27564;oa++)aa[oa]=0;for(oa=27571;oa<=27574;oa++)aa[oa]=0;for(oa=27581;oa<=27584;oa++)aa[oa]=0;for(oa=27591;oa<=27594;oa++)aa[oa]=0;for(oa=28191;oa<=28193;oa++)aa[oa]=0;for(oa=28348;oa<=28358;oa++)aa[oa]=0;for(oa=28402;oa<=28432;oa++)aa[oa]=0;for(oa=28462;oa<=28492;oa++)aa[oa]=0;for(oa=29118;oa<=29122;oa++)aa[oa]=0;for(oa=29168;oa<=29172;oa++)aa[oa]=0;for(oa=29177;oa<=29185;oa++)aa[oa]=0;for(oa=29187;oa<=29195;oa++)aa[oa]=0;for(oa=29900;oa<=29903;oa++)aa[oa]=0;for(oa=30161;oa<=30179;oa++)aa[oa]=0;for(oa=30491;oa<=30494;oa++)aa[oa]=0;for(oa=30729;oa<=30732;oa++)aa[oa]=0;for(oa=31251;oa<=31259;oa++)aa[oa]=0;for(oa=31265;oa<=31268;oa++)aa[oa]=0;for(oa=31275;oa<=31279;oa++)aa[oa]=0;for(oa=31281;oa<=31297;oa++)aa[oa]=0;for(oa=31461;oa<=31469;oa++)aa[oa]=0;for(oa=31491;oa<=31495;oa++)aa[oa]=0;for(oa=31917;oa<=31922;oa++)aa[oa]=0;for(oa=31965;oa<=32e3;oa++)aa[oa]=0;for(oa=32001;oa<=32003;oa++)aa[oa]=2;for(oa=32005;oa<=32031;oa++)aa[oa]=2;for(oa=32033;oa<=32060;oa++)aa[oa]=2;for(oa=32064;oa<=32067;oa++)aa[oa]=2;for(oa=32074;oa<=32077;oa++)aa[oa]=2;for(oa=32081;oa<=32086;oa++)aa[oa]=0;for(oa=32107;oa<=32130;oa++)aa[oa]=0;for(oa=32133;oa<=32158;oa++)aa[oa]=0;for(oa=32164;oa<=32167;oa++)aa[oa]=2;for(oa=32180;oa<=32199;oa++)aa[oa]=0;for(oa=32201;oa<=32260;oa++)aa[oa]=0;for(oa=32301;oa<=32360;oa++)aa[oa]=0;for(oa=32601;oa<=32662;oa++)aa[oa]=0;for(oa=32664;oa<=32667;oa++)aa[oa]=2;for(oa=32701;oa<=32761;oa++)aa[oa]=0;for(oa=53001;oa<=53004;oa++)aa[oa]=0;for(oa=53008;oa<=53019;oa++)aa[oa]=0;for(oa=53021;oa<=53032;oa++)aa[oa]=0;for(oa=53034;oa<=53037;oa++)aa[oa]=0;for(oa=53042;oa<=53046;oa++)aa[oa]=0;for(oa=53074;oa<=53080;oa++)aa[oa]=0;for(oa=54001;oa<=54004;oa++)aa[oa]=0;for(oa=54008;oa<=54019;oa++)aa[oa]=0;for(oa=54021;oa<=54032;oa++)aa[oa]=0;for(oa=54034;oa<=54037;oa++)aa[oa]=0;for(oa=54042;oa<=54046;oa++)aa[oa]=0;for(oa=54048;oa<=54053;oa++)aa[oa]=0;for(oa=54074;oa<=54080;oa++)aa[oa]=0;for(oa=54098;oa<=54101;oa++)aa[oa]=0;for(oa=102001;oa<=102040;oa++)aa[oa]=0;for(oa=102042;oa<=102063;oa++)aa[oa]=0;for(oa=102065;oa<=102067;oa++)aa[oa]=0;for(oa=102070;oa<=102117;oa++)aa[oa]=0;for(oa=102122;oa<=102216;oa++)aa[oa]=0;for(oa=102221;oa<=102377;oa++)aa[oa]=0;for(oa=102382;oa<=102388;oa++)aa[oa]=0;for(oa=102389;oa<=102398;oa++)aa[oa]=2;for(oa=102399;oa<=102444;oa++)aa[oa]=0;for(oa=102445;oa<=102447;oa++)aa[oa]=2;for(oa=102448;oa<=102458;oa++)aa[oa]=0;for(oa=102459;oa<=102468;oa++)aa[oa]=2;for(oa=102469;oa<=102499;oa++)aa[oa]=0;for(oa=102500;oa<=102519;oa++)aa[oa]=1;for(oa=102520;oa<=102524;oa++)aa[oa]=0;for(oa=102525;oa<=102529;oa++)aa[oa]=2;for(oa=102530;oa<=102588;oa++)aa[oa]=0;for(oa=102590;oa<=102598;oa++)aa[oa]=0;for(oa=102601;oa<=102603;oa++)aa[oa]=0;for(oa=102605;oa<=102628;oa++)aa[oa]=0;for(oa=102629;oa<=102646;oa++)aa[oa]=2;for(oa=102648;oa<=102700;oa++)aa[oa]=2;for(oa=102701;oa<=102703;oa++)aa[oa]=0;for(oa=102707;oa<=102730;oa++)aa[oa]=2;for(oa=102733;oa<=102758;oa++)aa[oa]=2;for(oa=102767;oa<=102900;oa++)aa[oa]=0;for(oa=102965;oa<=102969;oa++)aa[oa]=0;for(oa=102971;oa<=102973;oa++)aa[oa]=0;for(oa=102975;oa<=102989;oa++)aa[oa]=0;for(oa=102990;oa<=102992;oa++)aa[oa]=1;for(oa=102997;oa<=103002;oa++)aa[oa]=0;for(oa=103003;oa<=103008;oa++)aa[oa]=2;for(oa=103009;oa<=103011;oa++)aa[oa]=0;for(oa=103012;oa<=103014;oa++)aa[oa]=2;for(oa=103019;oa<=103021;oa++)aa[oa]=0;for(oa=103022;oa<=103024;oa++)aa[oa]=2;for(oa=103029;oa<=103031;oa++)aa[oa]=0;for(oa=103032;oa<=103034;oa++)aa[oa]=2;for(oa=103065;oa<=103068;oa++)aa[oa]=0;for(oa=103074;oa<=103076;oa++)aa[oa]=0;for(oa=103077;oa<=103079;oa++)aa[oa]=1;for(oa=103080;oa<=103082;oa++)aa[oa]=0;for(oa=103083;oa<=103085;oa++)aa[oa]=2;for(oa=103090;oa<=103093;oa++)aa[oa]=0;for(oa=103097;oa<=103099;oa++)aa[oa]=0;for(oa=103100;oa<=103102;oa++)aa[oa]=2;for(oa=103107;oa<=103109;oa++)aa[oa]=0;for(oa=103110;oa<=103112;oa++)aa[oa]=2;for(oa=103113;oa<=103116;oa++)aa[oa]=0;for(oa=103117;oa<=103120;oa++)aa[oa]=2;for(oa=103153;oa<=103157;oa++)aa[oa]=0;for(oa=103158;oa<=103162;oa++)aa[oa]=2;for(oa=103163;oa<=103165;oa++)aa[oa]=0;for(oa=103166;oa<=103168;oa++)aa[oa]=1;for(oa=103169;oa<=103171;oa++)aa[oa]=2;for(oa=103186;oa<=103188;oa++)aa[oa]=0;for(oa=103189;oa<=103191;oa++)aa[oa]=2;for(oa=103192;oa<=103195;oa++)aa[oa]=0;for(oa=103196;oa<=103199;oa++)aa[oa]=2;for(oa=103200;oa<=103224;oa++)aa[oa]=0;for(oa=103225;oa<=103227;oa++)aa[oa]=1;for(oa=103232;oa<=103237;oa++)aa[oa]=0;for(oa=103238;oa<=103243;oa++)aa[oa]=2;for(oa=103244;oa<=103246;oa++)aa[oa]=0;for(oa=103247;oa<=103249;oa++)aa[oa]=2;for(oa=103254;oa<=103256;oa++)aa[oa]=0;for(oa=103257;oa<=103259;oa++)aa[oa]=2;for(oa=103264;oa<=103266;oa++)aa[oa]=0;for(oa=103267;oa<=103269;oa++)aa[oa]=2;for(oa=103300;oa<=103375;oa++)aa[oa]=0;for(oa=103381;oa<=103383;oa++)aa[oa]=0;for(oa=103384;oa<=103386;oa++)aa[oa]=1;for(oa=103387;oa<=103389;oa++)aa[oa]=0;for(oa=103390;oa<=103392;oa++)aa[oa]=2;for(oa=103397;oa<=103399;oa++)aa[oa]=0;for(oa=103400;oa<=103471;oa++)aa[oa]=2;for(oa=103476;oa<=103478;oa++)aa[oa]=0;for(oa=103479;oa<=103481;oa++)aa[oa]=2;for(oa=103486;oa<=103488;oa++)aa[oa]=0;for(oa=103489;oa<=103491;oa++)aa[oa]=2;for(oa=103492;oa<=103495;oa++)aa[oa]=0;for(oa=103496;oa<=103499;oa++)aa[oa]=2;for(oa=103528;oa<=103543;oa++)aa[oa]=0;for(oa=103544;oa<=103548;oa++)aa[oa]=2;for(oa=103549;oa<=103551;oa++)aa[oa]=0;for(oa=103552;oa<=103554;oa++)aa[oa]=1;for(oa=103555;oa<=103557;oa++)aa[oa]=2;for(oa=103558;oa<=103560;oa++)aa[oa]=0;for(oa=103571;oa<=103573;oa++)aa[oa]=0;for(oa=103574;oa<=103576;oa++)aa[oa]=2;for(oa=103577;oa<=103580;oa++)aa[oa]=0;for(oa=103581;oa<=103583;oa++)aa[oa]=2;for(oa=103595;oa<=103694;oa++)aa[oa]=0;for(oa=103696;oa<=103699;oa++)aa[oa]=0;for(oa=103700;oa<=103793;oa++)aa[oa]=2;for(oa=103794;oa<=103872;oa++)aa[oa]=0;for(oa=103900;oa<=103971;oa++)aa[oa]=2;const la={102113:!0,102100:!0,3857:!0,3785:!0},ha={102113:!0,102100:!0,3857:!0,3785:!0,4326:!0},ca='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',ua=[-20037508.342788905,20037508.342788905],pa=[-20037508.342787,20037508.342787],da={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:ua,origin:pa,dx:1e-5},102100:{wkTemplate:ca,valid:ua,origin:pa,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:ua,origin:pa,dx:1e-5},3857:{wkTemplate:ca,valid:ua,origin:pa,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function fa(e,t){return!v(e)&&!v(t)&&(e===t||(null!=e.wkid||null!=t.wkid?e.wkid===t.wkid||ba(e)&&ba(t)||null!=t.latestWkid&&e.wkid===t.latestWkid||null!=e.latestWkid&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function ya(e){return Ma(e)&&e.wkid?da[e.wkid]:null}function ga(e){return!!Ma(e)&&(e.wkid?null==aa[e.wkid]:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function ma(e){return Ma(e)&&4326===e.wkid}function va(e){return Ma(e)&&4490===e.wkid}function ba(e){return Ma(e)&&null!=e.wkid&&!0===la[e.wkid]}function wa(e){return 104971===e||104905===e}function _a(e){return Ma(e)&&null!=e.wkid&&wa(e.wkid)}function xa(e){return 104903===e}function Sa(e){return Ma(e)&&null!=e.wkid&&xa(e.wkid)}function Ma(e){return m(e)&&(null!=e.wkid&&e.wkid>=2e3||null!=e.wkt)}const Ta={wkid:4326,wkt:Le(da[4326].wkTemplate,{Central_Meridian:"0.0"})};var Ia;let Ea=Ia=class extends Ko{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(102100===e.wkid)return Ia.WebMercator;if(4326===e.wkid)return Ia.WGS84}const t=new Ia;return t.read(e),t}normalizeCtorArgs(e){return e&&"object"==typeof e?e:{["string"==typeof e?"wkt":"wkid"]:e}}get isWGS84(){return ma(this)}get isWebMercator(){return ba(this)}get isGeographic(){return ga(this)}get isWrappable(){return function(e){return Ma(e)&&null!=e.wkid&&!0===ha[e.wkid]}(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Ia.WGS84)return Ia.WGS84;if(this===Ia.WebMercator)return Ia.WebMercator;const e=new Ia;return null!=this.wkid?(e.wkid=this.wkid,null!=this.latestWkid&&(e.latestWkid=this.latestWkid),null!=this.vcsWkid&&(e.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(e.latestVcsWkid=this.latestVcsWkid)):null!=this.wkt&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=H(this.imageCoordinateSystem)),e}equals(e){if(null==e)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==e.imageCoordinateSystem)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return null==t||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return fa(this,e)}toJSON(e){return this.write(void 0,e)}};Ea.GCS_NAD_1927=null,Ea.WGS84=null,Ea.WebMercator=null,Q([ro({readOnly:!0})],Ea.prototype,"isWGS84",null),Q([ro({readOnly:!0})],Ea.prototype,"isWebMercator",null),Q([ro({readOnly:!0})],Ea.prototype,"isGeographic",null),Q([ro({readOnly:!0})],Ea.prototype,"isWrappable",null),Q([ro({type:Yn,json:{write:!0}})],Ea.prototype,"latestWkid",void 0),Q([ro({type:Yn,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkt}}}}}}})],Ea.prototype,"wkid",void 0),Q([ro({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkid}}}}}}})],Ea.prototype,"wkt",void 0),Q([na("wkt"),na("web-scene","wkt")],Ea.prototype,"writeWkt",null),Q([ro({type:Yn,json:{write:!0}})],Ea.prototype,"vcsWkid",void 0),Q([ro({type:Yn,json:{write:!0}})],Ea.prototype,"latestVcsWkid",void 0),Q([ro()],Ea.prototype,"imageCoordinateSystem",void 0),Ea=Ia=Q([Ro("esri.geometry.SpatialReference")],Ea),Ea.prototype.toJSON.isDefaultToJSON=!0,Ea.GCS_NAD_1927=new Ea({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ea.WGS84=new Ea(Ta),Ea.WebMercator=new Ea({wkid:102100,latestWkid:3857}),Object.freeze&&(Object.freeze(Ea.GCS_NAD_1927),Object.freeze(Ea.WGS84),Object.freeze(Ea.WebMercator));var Aa=Ea;let Pa=class extends Ko{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=Aa.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof Aa)return e;if(null!=e){const i=new Aa;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};Q([ro()],Pa.prototype,"type",void 0),Q([ro({readOnly:!0})],Pa.prototype,"cache",null),Q([ro({readOnly:!0})],Pa.prototype,"extent",null),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Pa.prototype,"hasM",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Pa.prototype,"hasZ",void 0),Q([ro({type:Aa,json:{write:!0}})],Pa.prototype,"spatialReference",void 0),Q([sa("spatialReference")],Pa.prototype,"readSpatialReference",null),Pa=Q([Ro("esri.geometry.Geometry")],Pa);var Ca=Pa;const Oa=Object.prototype.toString;function ka(e){const t="__accessorMetadata__"in e?qn(e):e;return function(...e){if(e.push(t),"number"==typeof e[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return La.apply(this,e)}}function La(e,t,i,r){zr(e,t).cast=r}function Ra(...e){if(3!==e.length||"string"!=typeof e[1])return 1===e.length&&"[object Function]"===Oa.call(e[0])?ka(e[0]):1===e.length&&"string"==typeof e[0]?function(e){return function(t,i){zr(t,e).cast=t[i]}}(e[0]):void 0}class Da{constructor(e,t,i,r){this.semiMajorAxis=e,this.flattening=t,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=r||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Fa=new Da(6378137,1/298.257223563,3e5,.006694379990137799),ja=new Da(3396190,1/169.8944472236118,23e4),Na=new Da(1737400,0,0);function za(e){return 57.29577951308232*e}function Va(e){return.017453292519943*e}function Ua(e){return Math.PI/2-2*Math.atan(Math.exp(-1*e/Fa.radius))}function Ga(e){return null!=e.wkid||null!=e.wkt}const Ba=[0,0];function qa(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,Ba,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,Ba,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,Ba,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const e="paths"in n?n.paths:n.rings,i=[];let s;for(let n=0;n<e.length;n++){const o=e[n];s=[],i.push(s);for(let e=0;e<o.length;e++)s.push(t(o[e][0],o[e][1],[0,0],r)),o[e].length>2&&s[e].push(o[e][2]),o[e].length>3&&s[e].push(o[e][3])}"paths"in o?o.paths=i:o.rings=i}else if("points"in n&&"points"in o){const e=n.points,i=[];for(let s=0;s<e.length;s++)i[s]=t(e[s][0],e[s][1],[0,0],r),e[s].length>2&&i[s].push(e[s][2]),e[s].length>3&&i[s].push(e[s][3]);o.points=i}return s}function Ha(e,t){const i=e&&(Ga(e)?e:e.spatialReference),r=t&&(Ga(t)?t:t.spatialReference);return!(e&&"type"in e&&"mesh"===e.type||t&&"type"in t&&"mesh"===t.type||!i||!r)&&(!!fa(r,i)||ba(r)&&ma(i)||ba(i)&&ma(r))}function Wa(e,t){const i=e&&e.spatialReference,r=t&&(Ga(t)?t:t.spatialReference);return Ha(i,r)?fa(i,r)?H(e):ba(r)?qa(e,$a,Aa.WebMercator,!1,H(e)):ma(r)?qa(e,Ja,Aa.WGS84,!1,H(e)):null:null}function $a(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=Va(t);return i[0]=Va(e)*Fa.radius,i[1]=Fa.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function Ja(e,t,i=[0,0],r=!1){const s=za(e/Fa.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=za(Math.PI/2-2*Math.atan(Math.exp(-1*t/Fa.radius))),i}function Xa(e,t=!1,i=H(e)){return qa(e,$a,Aa.WebMercator,t,i)}function Ka(e,t=!1,i=H(e)){return qa(e,Ja,Aa.WGS84,t,i)}var Ya;const Za=[0,0];function Qa(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}const el=Ne.getLogger("esri.geometry.Point");let tl=Ya=class extends Ca{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&"object"==typeof e){if(n=e,e=null!=n.x?n.x:n.longitude,t=null!=n.y?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&"esri.geometry.SpatialReference"!==s.declaredClass&&(s=new Aa(s)),null!=n.longitude||null!=n.latitude)if(null==n.longitude)el.warn(".longitude=","Latitude was defined without longitude");else if(null==n.latitude)el.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const i=$a(n.longitude,n.latitude,Za);e=i[0],t=i[1]}}else Qa(i)?(s=i,i=null):Qa(r)&&(s=r,r=null);const o={x:e,y:t};return null==o.x&&null!=o.y?el.warn(".y=","Y coordinate was defined without an X coordinate"):null==o.y&&null!=o.x&&el.warn(".x=","X coordinate was defined without a Y coordinate"),null!=s&&(o.spatialReference=s),null!=i&&(o.z=i),null!=r&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(e){e!==(void 0!==this._get("m"))&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return void 0!==this.z}set hasZ(e){e!==(void 0!==this._get("z"))&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return Ja(t,i,Za)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",$a(i,e,Za)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return Ja(e,t,Za)[0];if(i.isGeographic)return e}return NaN}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",$a(e,t,Za)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return"string"==typeof e?NaN:e}clone(){const e=new Ya;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return Ya.copy(e,this),this}equals(e){if(!e)return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:h,spatialReference:c}=e;if(!n.equals(c))if(n.isWebMercator&&c.isWGS84)[l,h]=$a(l,h),c=n;else{if(!n.isWGS84||!c.isWebMercator)return!1;[l,h]=Ja(l,h),c=n}return t===l&&i===h&&r===o&&s===a&&n.wkid===c.wkid}offset(e,t,i){return function(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,null!=r&&(e.z=(null!=(s=e.z)?s:0)+r),e}(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=ya(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return function(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write(null,e)}};Q([ro({readOnly:!0})],tl.prototype,"cache",null),Q([ro({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],tl.prototype,"hasM",null),Q([ro({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],tl.prototype,"hasZ",null),Q([ro({type:Number})],tl.prototype,"latitude",null),Q([ro({type:Number})],tl.prototype,"longitude",null),Q([ro({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Ra((e=>isNaN(e)?e:Rn(e)))],tl.prototype,"x",void 0),Q([na("x")],tl.prototype,"writeX",null),Q([sa("x")],tl.prototype,"readX",null),Q([ro({type:Number,json:{write:!0}})],tl.prototype,"y",void 0),Q([ro({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],tl.prototype,"z",void 0),Q([ro({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],tl.prototype,"m",void 0),tl=Ya=Q([Ro("esri.geometry.Point")],tl),tl.prototype.toJSON.isDefaultToJSON=!0;var il=tl;const rl=[0,0];function sl(e,t){return ll(e,t.x,t.y,t.z)}function nl(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!ol(e,i))return!1;return!0}function ol(e,t){return ll(e,t[0],t[1])}function al(e,t){return ll(e,t[0],t[1],t[2])}function ll(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(null==r||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function hl(e,t){return rl[1]=t.y,rl[0]=t.x,cl(e,rl)}function cl(e,t){return function(e,t){if(!e)return!1;if(function(e){return!Array.isArray(e[0][0])}(e))return ul(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=ul(i,e[r],t);return i}(e.rings,t)}function ul(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[e,i]=t[a],[h,c]=t[o];(i<s&&c>=s||c<s&&i>=s)&&e+(s-i)/(c-i)*(h-e)<r&&(n=!n)}return n}function pl(e,t){return sl(e,t)}function dl(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ)if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1;return!0}function fl(e,t){const{points:i,hasZ:r}=t,s=r?al:ol;for(const n of i)if(s(e,n))return!0;return!1}const yl=[0,0],gl=[0,0],ml=[0,0],vl=[0,0],bl=[yl,gl,ml,vl],wl=[[ml,yl],[yl,gl],[gl,vl],[vl,ml]];function _l(e,t){yl[0]=e.xmin,yl[1]=e.ymax,gl[0]=e.xmax,gl[1]=e.ymax,ml[0]=e.xmin,ml[1]=e.ymin,vl[0]=e.xmax,vl[1]=e.ymin;for(const i of bl)if(cl(t,i))return!0;for(const i of t.rings){if(!i.length)continue;let t=i[0];if(ol(e,t))return!0;for(let r=1;r<i.length;r++){const s=i[r];if(ol(e,s)||Ml(t,s,wl))return!0;t=s}}return!1}function xl(e,t){yl[0]=e.xmin,yl[1]=e.ymax,gl[0]=e.xmax,gl[1]=e.ymax,ml[0]=e.xmin,ml[1]=e.ymin,vl[0]=e.xmax,vl[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let t=r[0];if(ol(e,t))return!0;for(let i=1;i<r.length;i++){const s=r[i];if(ol(e,s)||Ml(t,s,wl))return!0;t=s}}return!1}const Sl=[0,0];function Ml(e,t,i){for(let r=0;r<i.length;r++)if(Tl(e,t,i[r][0],i[r][1]))return!0;return!1}function Tl(e,t,i,r,s){const[n,o]=e,[a,l]=t,[h,c]=i,[u,p]=r,d=u-h,f=n-h,y=a-n,g=p-c,m=o-c,v=l-o,b=g*y-d*v;if(0===b)return!1;const w=(d*m-g*f)/b,_=(y*m-v*f)/b;return w>=0&&w<=1&&_>=0&&_<=1&&(s&&(s[0]=n+w*(a-n),s[1]=o+w*(l-o)),!0)}function Il(e){switch(e){case"esriGeometryEnvelope":case"extent":return dl;case"esriGeometryMultipoint":case"multipoint":return fl;case"esriGeometryPoint":case"point":return pl;case"esriGeometryPolygon":case"polygon":return _l;case"esriGeometryPolyline":case"polyline":return xl}}var El;function Al(e,t,i){return null==t?i:null==i?t:e(t,i)}let Pl=El=class extends Ca{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof e?(e.spatialReference=null==e.spatialReference?Aa.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:null==s?Aa.WGS84:s}}static fromBounds(e,t){return new El({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new il({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return null!=e.z&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new El;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,null!=this.zmin&&(e.zmin=this.zmin,e.zmax=this.zmax),null!=this.mmin&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ha(t,i)&&(e=t.isWebMercator?Xa(e):Ka(e,!0)),"point"===e.type?sl(this,e):"extent"===e.type&&function(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?ll(e,i,r,s)&&ll(e,i,o,s)&&ll(e,n,o,s)&&ll(e,n,r,s)&&ll(e,i,r,a)&&ll(e,i,o,a)&&ll(e,n,o,a)&&ll(e,n,r,a):ll(e,i,r)&&ll(e,i,o)&&ll(e,n,o)&&ll(e,n,r)}(this,e)}equals(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ha(t,i)&&(e=t.isWebMercator?Xa(e):Ka(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const e=(this.zmax-this.zmin)*t;this.zmin+=e,this.zmax-=e}if(this.hasM){const e=(this.mmax-this.mmin)*t;this.mmin+=e,this.mmax-=e}return this}intersects(e){if(v(e))return!1;"mesh"===e.type&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Ha(t,i)&&(e=t.isWebMercator?Xa(e):Ka(e,!0)),Il(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,null!=i&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Al(Math.min,this.zmin,e.zmin),this.zmax=Al(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Al(Math.min,this.mmin,e.mmin),this.mmax=Al(Math.max,this.mmax,e.mmax)),this}intersection(e){return this.intersects(e)?(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=Al(Math.max,this.zmin,e.zmin),this.zmax=Al(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=Al(Math.max,this.mmin,e.mmin),this.mmax=Al(Math.min,this.mmax,e.mmax)),this):null}toJSON(e){return this.write(null,e)}_shiftCM(e=ya(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?Ka(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new Aa(Le(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||ya(r)))return this;const s=this._getParts(i).map((e=>e.extent));if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach((e=>{e.hasZ||(n=!1),e.hasM||(o=!1)})),{rings:s.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(n){const i=(e.zmax-e.zmin)/2;for(let e=0;e<t.length;e++)t[e].push(i)}if(o){const i=(e.mmax-e.mmin)/2;for(let e=0;e<t.length;e++)t[e].push(i)}return t})),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:i,ymax:r,spatialReference:s}=this,n=this.width,o=this.xmin,a=this.xmax;let l;e=e||ya(s);const[h,c]=e.valid;l=this._normalizeX(this.xmin,e);const u=l.x,p=l.frameId;l=this._normalizeX(this.xmax,e);const d=l.x,f=l.frameId,y=u===d&&n>0;if(n>2*c){const e=new El(o<a?u:d,i,c,r,s),n=new El(h,i,o<a?d:u,r,s),l=new El(0,i,c,r,s),y=new El(h,i,0,r,s),g=[],m=[];e.contains(l)&&g.push(p),e.contains(y)&&m.push(p),n.contains(l)&&g.push(f),n.contains(y)&&m.push(f);for(let t=p+1;t<f;t++)g.push(t),m.push(t);t.push({extent:e,frameIds:[p]},{extent:n,frameIds:[f]},{extent:l,frameIds:g},{extent:y,frameIds:m})}else u>d||y?t.push({extent:new El(u,i,c,r,s),frameIds:[p]},{extent:new El(h,i,d,r,s),frameIds:[f]}):t.push({extent:new El(u,i,d,r,s),frameIds:[p]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const e={};i&&(e.zmin=this.zmin,e.zmax=this.zmax),r&&(e.mmin=this.mmin,e.mmax=this.mmax);for(let i=0;i<t.length;i++)t[i].extent.set(e)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};Q([ro({readOnly:!0})],Pl.prototype,"cache",null),Q([ro({readOnly:!0})],Pl.prototype,"center",null),Q([ro({readOnly:!0})],Pl.prototype,"extent",null),Q([ro({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Pl.prototype,"hasM",null),Q([ro({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],Pl.prototype,"hasZ",null),Q([ro({readOnly:!0})],Pl.prototype,"height",null),Q([ro({readOnly:!0})],Pl.prototype,"width",null),Q([ro({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],Pl.prototype,"xmin",void 0),Q([ro({type:Number,json:{write:!0}})],Pl.prototype,"ymin",void 0),Q([ro({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Pl.prototype,"mmin",void 0),Q([ro({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Pl.prototype,"zmin",void 0),Q([ro({type:Number,json:{write:!0}})],Pl.prototype,"xmax",void 0),Q([ro({type:Number,json:{write:!0}})],Pl.prototype,"ymax",void 0),Q([ro({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],Pl.prototype,"mmax",void 0),Q([ro({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Pl.prototype,"zmax",void 0),Pl=El=Q([Ro("esri.geometry.Extent")],Pl),Pl.prototype.toJSON.isDefaultToJSON=!0;var Cl,Ol=Pl;const kl=new ee({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Ll=Cl=class extends jo{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)}clone(){return new Cl({categories:this.categories?H(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map((e=>Array.isArray(e)?JSON.stringify(e):e))),this.extent){const e=Wa(this.extent,Aa.WGS84);e&&(r=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map((e=>kl.toJSON(e.trim()))).join(","),n.sortOrder=this.sortOrder),{query:a(a({},t),n)}}};Q([ro()],Ll.prototype,"categories",void 0),Q([ro()],Ll.prototype,"disableExtraQuery",void 0),Q([ro({type:Ol})],Ll.prototype,"extent",void 0),Q([ro()],Ll.prototype,"num",void 0),Q([ro()],Ll.prototype,"query",void 0),Q([ro()],Ll.prototype,"sortField",void 0),Q([ro()],Ll.prototype,"sortOrder",null),Q([ro()],Ll.prototype,"start",void 0),Ll=Cl=Q([Ro("esri.portal.PortalQueryParams")],Ll);var Rl=Ll;let Dl=class extends jo{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};Q([ro()],Dl.prototype,"nextQueryParams",void 0),Q([ro()],Dl.prototype,"queryParams",void 0),Q([ro()],Dl.prototype,"results",void 0),Q([ro()],Dl.prototype,"total",void 0),Dl=Q([Ro("esri.portal.PortalQueryResult")],Dl);var Fl=Dl;let jl=class extends Ko{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new Be("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};Q([ro({type:Date})],jl.prototype,"created",void 0),Q([ro()],jl.prototype,"id",void 0),Q([ro()],jl.prototype,"portal",void 0),Q([ro()],jl.prototype,"title",void 0),Q([ro({readOnly:!0})],jl.prototype,"url",null),Q([ro()],jl.prototype,"username",void 0),jl=Q([Ro("esri.portal.PortalFolder")],jl);var Nl=jl;let zl=class extends Ko{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then((t=>{const i=t.categorySchema||[];return i.some((e=>"contentCategorySetsGroupQuery.LivingAtlas"===e.source))?this._fetchCategorySchemaSet("LivingAtlas",e):i}))}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new Be("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=qn(Rl,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new Rl,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new Rl,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then((e=>{const i=e.contentCategorySetsGroupQuery;if(i){const e=new Rl;return e.disableExtraQuery=!0,e.num=1,e.query=i,this.portal.queryGroups(e,t)}throw new Be("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")})).then((i=>{if(i.total){const r=i.results[0],s=new Rl;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new Be("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")})).then((e=>e.total?e.results[0].fetchData("json",t).then((e=>{const t=e&&e.categorySchema;return t&&t.length?t:[]})):[]))}};Q([ro()],zl.prototype,"access",void 0),Q([ro({type:Date})],zl.prototype,"created",void 0),Q([ro()],zl.prototype,"description",void 0),Q([ro()],zl.prototype,"id",void 0),Q([ro()],zl.prototype,"isInvitationOnly",void 0),Q([ro({type:Date})],zl.prototype,"modified",void 0),Q([ro()],zl.prototype,"owner",void 0),Q([ro()],zl.prototype,"portal",void 0),Q([ro()],zl.prototype,"snippet",void 0),Q([ro()],zl.prototype,"sortField",void 0),Q([ro()],zl.prototype,"sortOrder",void 0),Q([ro()],zl.prototype,"tags",void 0),Q([ro()],zl.prototype,"thumbnail",void 0),Q([ro({readOnly:!0})],zl.prototype,"thumbnailUrl",null),Q([ro()],zl.prototype,"title",void 0),Q([ro({readOnly:!0})],zl.prototype,"url",null),zl=Q([Ro("esri.portal.PortalGroup")],zl);var Vl,Ul=zl,Gl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Ul});let Bl=Vl=class extends Ko{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),null!=i&&("string"==typeof i?s.query.text=i:"object"==typeof i&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+("string"==typeof r?r:r.id)),this.portal._request(n+"/addItem",s).then((e=>(t.id=e.id,t.portal=this.portal,t.loaded?t.reload():t.load())))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then((()=>{e.id=null,e.portal=null}))}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map((e=>e.id));if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then((()=>{e.forEach((e=>{e.id=null,e.portal=null}))}))}return Promise.resolve(void 0)}fetchFolders(){return this.portal._request(this.userContentUrl,{query:{num:1}}).then((e=>{let t;return t=e&&e.folders?e.folders.map((e=>{const t=Nl.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchGroups(){return this.portal._request(this.url).then((e=>{let t;return t=e&&e.groups?e.groups.map((e=>{const t=Ul.fromJSON(e);return t.portal=this.portal,t})):[],t}))}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),Promise.resolve().then((function(){return Wg})).then((({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})})).then((e=>{let i;return e&&e.items?(i=e.items.map((e=>{const i=t.fromJSON(e);return i.portal=this.portal,i})),Promise.all(i.map((e=>e.load()))).catch((e=>e)).then((()=>({items:i,nextStart:e.nextStart,total:e.total})))):{items:[],nextStart:-1,total:0}}))}fetchTags(){return this.portal._request(this.url+"/tags").then((e=>e.tags))}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new Ul({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new Be("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new Be("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new Vl;return t.sourceJSON=e,t.read(e),t}};Q([ro()],Bl.prototype,"access",void 0),Q([ro({type:Date})],Bl.prototype,"created",void 0),Q([ro()],Bl.prototype,"culture",void 0),Q([ro()],Bl.prototype,"description",void 0),Q([ro()],Bl.prototype,"email",void 0),Q([ro()],Bl.prototype,"favGroupId",void 0),Q([ro()],Bl.prototype,"fullName",void 0),Q([ro({type:Date})],Bl.prototype,"modified",void 0),Q([ro()],Bl.prototype,"orgId",void 0),Q([ro()],Bl.prototype,"portal",void 0),Q([ro()],Bl.prototype,"preferredView",void 0),Q([ro()],Bl.prototype,"privileges",void 0),Q([ro()],Bl.prototype,"region",void 0),Q([ro()],Bl.prototype,"role",void 0),Q([ro()],Bl.prototype,"roleId",void 0),Q([ro()],Bl.prototype,"sourceJSON",void 0),Q([ro()],Bl.prototype,"thumbnail",void 0),Q([ro({readOnly:!0})],Bl.prototype,"thumbnailUrl",null),Q([ro()],Bl.prototype,"units",void 0),Q([ro({readOnly:!0})],Bl.prototype,"userContentUrl",null),Q([ro({readOnly:!0})],Bl.prototype,"url",null),Q([ro()],Bl.prototype,"username",void 0),Q([ro()],Bl.prototype,"userType",void 0),Bl=Vl=Q([Ro("esri.portal.PortalUser")],Bl);var ql,Hl=Bl,Wl=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Hl});let $l;const Jl={PortalGroup:()=>Promise.resolve().then((function(){return Gl})),PortalItem:()=>Promise.resolve().then((function(){return Wg})),PortalUser:()=>Promise.resolve().then((function(){return Wl}))};let Xl=ql=class extends(Jo(ra)){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Z.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return"string"==typeof e?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)-1===Z.request.trustedServers.indexOf(t)&&Z.request.trustedServers.push(t);return e}readDefaultBasemap(e){if(e){const t=$l.fromJSON(e);return t.portalItem={portal:this},t}return null}readDefaultVectorBasemap(e){if(e){const t=$l.fromJSON(e);return t.portalItem={portal:this},t}return null}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e?e.toLowerCase():e}readUser(e){let t=null;return e&&(t=Hl.fromJSON(e),t.portal=this),t}load(e){const t=Promise.resolve().then((function(){return om})).then((({default:t})=>{tt(e),$l=t})).then((()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e))).then((e=>{if(Ui){const e=Ui;this.credential=e.findCredential(this.restUrl),this.credential||this.authMode!==ql.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=e.on("credential-create",(()=>{e.findCredential(this.restUrl)&&this._signIn()})))}this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}async createClosestFacilityTask(){await this.load();const e=this._getHelperServiceUrl("closestFacility");return new((await import("./ClosestFacilityTask.bfa3503c.js")).default)(e)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await import("./ElevationLayer.ab0f88f6.js")).default;return e?e.map((e=>new t({id:e.id,url:e.url}))):[]}async createGeometryService(){await this.load();const e=this._getHelperServiceUrl("geometry");return new((await import("./GeometryService.e0418c1e.js")).default)({url:e})}async createPrintTask(){await this.load();const e=this._getHelperServiceUrl("printTask");return new((await import("./PrintTask.37bdf821.js")).default)(e)}async createRouteTask(){await this.load();const e=this._getHelperServiceUrl("route");return new((await import("./RouteTask.d5741361.js")).default)(e)}async createServiceAreaTask(){await this.load();const e=this._getHelperServiceUrl("serviceArea");return new((await import("./ServiceAreaTask.a9b8439f.js")).default)(e)}fetchBasemaps(e,t){const i=new Rl;return i.query=e||(this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then((e=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',e.total){const r=e.results[0];return i.sortField=r.sortField||"name",i.sortOrder=r.sortOrder||"desc",r.queryItems(i,t)}return null})).then((e=>{let t;return t=e&&e.total?e.results.filter((e=>"Web Map"===e.type)).map((e=>new $l({portalItem:e}))):[],t}))}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then((e=>e.categorySchema)):rt(e)?Promise.reject(Qe()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new Rl;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const e of t)r.push(`(title:"${e.title}" AND owner:${e.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then((e=>e.results))}return rt(e)?Promise.reject(Qe()):Promise.resolve([])}fetchRegions(e){const t=this.user&&this.user.culture||this.culture||le();return this._request(this.restUrl+"/portals/regions",l(a({},e),{query:{culture:t}}))}static getDefault(){return ql._default&&!ql._default.destroyed||(ql._default=new ql),ql._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new Be("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new ql({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new Be("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new Be("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s=a({authMode:e,query:{culture:le().toLowerCase()}},i);return"auto"===s.authMode&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=qn(Rl,t),n=t=>this._request(this.restUrl+e,a(a({},s.toRequestOptions(this)),r)).then((e=>{const i=s.clone();return i.start=e.nextStart,new Fl({nextQueryParams:i,queryParams:s,total:e.total,results:ql._resultsToTypedArray(t,{portal:this},e,r)})})).then((e=>Promise.all(e.results.map((t=>"function"==typeof t.when?t.when():e))).then((()=>e),(t=>(st(t),e)))));return i&&Jl[i]?Jl[i]().then((({default:e})=>(tt(r),n(e)))):n()}_signIn(){if(this.authMode===ql.AUTH_MODE_ANONYMOUS)return Promise.reject(new Be("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e=e=>Promise.resolve().then((()=>"not-loaded"===this.loadStatus?(e||(this.authMode="immediate"),this.load().then((()=>null))):"loading"===this.loadStatus?this.load().then((()=>this.credential?null:(this.credential=e,this._fetchSelf("immediate")))):this.user&&this.credential===e?null:(this.credential=e,this._fetchSelf("immediate")))).then((e=>{e&&(this.sourceJSON=e,this.read(e))}));return Ui?Ui.getCredential(this.restUrl).then((t=>e(t))):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.indexOf("?")>-1?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then((e=>{const t=ql._resultsToTypedArray(i,{portal:this},e);return Promise.all(t.map((t=>"function"==typeof t.when?t.when():e))).then((()=>t),(()=>t))}))}_request(e,t={}){const i=a({f:"json"},t.query),{authMode:r=(this.authMode===ql.AUTH_MODE_ANONYMOUS?"anonymous":"auto"),body:s=null,cacheBust:n=!1,method:o="auto",responseType:l="json",signal:h}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:l,timeout:0,signal:h};return $i(this._normalizeSSL(e),c).then((e=>e.data))}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=m(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map((i=>{const r=Object.assign(e?e.fromJSON(i):i,t);return"function"==typeof r.load&&r.load(n),r})))}else s=[];return s}};Xl.AUTH_MODE_ANONYMOUS="anonymous",Xl.AUTH_MODE_AUTO="auto",Xl.AUTH_MODE_IMMEDIATE="immediate",Q([ro()],Xl.prototype,"access",void 0),Q([ro()],Xl.prototype,"allSSL",void 0),Q([ro()],Xl.prototype,"authMode",void 0),Q([ro()],Xl.prototype,"authorizedCrossOriginDomains",void 0),Q([sa("authorizedCrossOriginDomains")],Xl.prototype,"readAuthorizedCrossOriginDomains",null),Q([ro()],Xl.prototype,"basemapGalleryGroupQuery",void 0),Q([ro()],Xl.prototype,"bingKey",void 0),Q([ro()],Xl.prototype,"canListApps",void 0),Q([ro()],Xl.prototype,"canListData",void 0),Q([ro()],Xl.prototype,"canListPreProvisionedItems",void 0),Q([ro()],Xl.prototype,"canProvisionDirectPurchase",void 0),Q([ro()],Xl.prototype,"canSearchPublic",void 0),Q([ro()],Xl.prototype,"canShareBingPublic",void 0),Q([ro()],Xl.prototype,"canSharePublic",void 0),Q([ro()],Xl.prototype,"canSignInArcGIS",void 0),Q([ro()],Xl.prototype,"canSignInIDP",void 0),Q([ro()],Xl.prototype,"colorSetsGroupQuery",void 0),Q([ro()],Xl.prototype,"commentsEnabled",void 0),Q([ro({type:Date})],Xl.prototype,"created",void 0),Q([ro()],Xl.prototype,"credential",void 0),Q([ro()],Xl.prototype,"culture",void 0),Q([ro()],Xl.prototype,"currentVersion",void 0),Q([ro()],Xl.prototype,"customBaseUrl",void 0),Q([ro()],Xl.prototype,"defaultBasemap",void 0),Q([sa("defaultBasemap")],Xl.prototype,"readDefaultBasemap",null),Q([ro({type:Ol})],Xl.prototype,"defaultExtent",void 0),Q([ro()],Xl.prototype,"defaultVectorBasemap",void 0),Q([sa("defaultVectorBasemap")],Xl.prototype,"readDefaultVectorBasemap",null),Q([ro()],Xl.prototype,"description",void 0),Q([ro()],Xl.prototype,"eueiEnabled",void 0),Q([ro({readOnly:!0})],Xl.prototype,"extraQuery",null),Q([ro()],Xl.prototype,"featuredGroups",void 0),Q([ro()],Xl.prototype,"featuredItemsGroupQuery",void 0),Q([ro()],Xl.prototype,"galleryTemplatesGroupQuery",void 0),Q([ro()],Xl.prototype,"livingAtlasGroupQuery",void 0),Q([ro()],Xl.prototype,"hasCategorySchema",void 0),Q([ro()],Xl.prototype,"helpBase",void 0),Q([ro()],Xl.prototype,"helperServices",void 0),Q([ro()],Xl.prototype,"helpMap",void 0),Q([ro()],Xl.prototype,"homePageFeaturedContent",void 0),Q([ro()],Xl.prototype,"homePageFeaturedContentCount",void 0),Q([ro()],Xl.prototype,"httpPort",void 0),Q([ro()],Xl.prototype,"httpsPort",void 0),Q([ro()],Xl.prototype,"id",void 0),Q([ro()],Xl.prototype,"ipCntryCode",void 0),Q([ro({readOnly:!0})],Xl.prototype,"isOrganization",null),Q([ro()],Xl.prototype,"isPortal",void 0),Q([ro()],Xl.prototype,"isReadOnly",void 0),Q([ro()],Xl.prototype,"layerTemplatesGroupQuery",void 0),Q([ro()],Xl.prototype,"maxTokenExpirationMinutes",void 0),Q([ro({type:Date})],Xl.prototype,"modified",void 0),Q([ro()],Xl.prototype,"name",void 0),Q([ro()],Xl.prototype,"portalHostname",void 0),Q([ro()],Xl.prototype,"portalMode",void 0),Q([ro()],Xl.prototype,"portalProperties",void 0),Q([ro()],Xl.prototype,"region",void 0),Q([ro({readOnly:!0})],Xl.prototype,"restUrl",null),Q([ro()],Xl.prototype,"rotatorPanels",void 0),Q([ro()],Xl.prototype,"showHomePageDescription",void 0),Q([ro()],Xl.prototype,"sourceJSON",void 0),Q([ro()],Xl.prototype,"staticImagesUrl",void 0),Q([ro()],Xl.prototype,"stylesGroupQuery",void 0),Q([ro()],Xl.prototype,"supportsHostedServices",void 0),Q([ro()],Xl.prototype,"symbolSetsGroupQuery",void 0),Q([ro()],Xl.prototype,"templatesGroupQuery",void 0),Q([ro()],Xl.prototype,"thumbnail",void 0),Q([ro({readOnly:!0})],Xl.prototype,"thumbnailUrl",null),Q([ro()],Xl.prototype,"units",void 0),Q([ro()],Xl.prototype,"url",void 0),Q([ro()],Xl.prototype,"urlKey",void 0),Q([sa("urlKey")],Xl.prototype,"readUrlKey",null),Q([ro()],Xl.prototype,"user",void 0),Q([sa("user")],Xl.prototype,"readUser",null),Q([ro()],Xl.prototype,"useStandardizedQuery",void 0),Q([ro()],Xl.prototype,"useVectorBasemaps",void 0),Q([ro()],Xl.prototype,"vectorBasemapGalleryGroupQuery",void 0),Xl=ql=Q([Ro("esri.portal.Portal")],Xl);var Kl,Yl=Xl;let Zl=Kl=class extends Ko{constructor(e){super(e),this._oAuthCred=null,this.appId=null,this.authNamespace="/",this.expiration=20160,this.forceLogin=!1,this.forceUserId=!1,this.locale=null,this.minTimeUntilExpiration=30,this.popup=!1,this.popupCallbackUrl="oauth-callback.html",this.popupWindowFeatures="height=490,width=800,resizable,scrollbars,status",this.portalUrl="https://www.arcgis.com",this.preserveUrlHash=!1,this.userId=null}clone(){return Kl.fromJSON(this.toJSON())}};Q([ro({json:{write:!0}})],Zl.prototype,"appId",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"authNamespace",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"expiration",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"forceLogin",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"forceUserId",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"locale",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"minTimeUntilExpiration",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"popup",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"popupCallbackUrl",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"popupWindowFeatures",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"portalUrl",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"preserveUrlHash",void 0),Q([ro({json:{write:!0}})],Zl.prototype,"userId",void 0),Zl=Kl=Q([Ro("esri.identity.OAuthInfo")],Zl);var Ql=Zl;function eh(e,t){return ro({aliasOf:t?l(a({},t),{source:e}):e})}function th(e,t={}){var i;const r=e instanceof ee?e:new ee(e,t),s={type:null==(i=null==t?void 0:t.ignoreUnknown)||i?r.apiValues:String,readOnly:null==t?void 0:t.readOnly,json:{type:r.jsonValues,read:(null==t||!t.readOnly)&&{reader:r.read},write:{writer:r.write}}};return void 0!==(null==t?void 0:t.default)&&(s.json.default=t.default),void 0!==(null==t?void 0:t.name)&&(s.json.name=t.name),ro(s)}class ih{constructor(){this._emitter=new ih.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}}!function(e){class t{constructor(e=null){this.target=e,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear()}emit(e,t){const i=this._listenersMap&&this._listenersMap.get(e);if(!i)return!1;const r=this.target||this;return[...i].forEach((e=>{e.call(r,t)})),i.length>0}on(e,t){if(Array.isArray(e)){return _r(e.map((e=>this.on(e,t))))}if(e.indexOf(",")>-1)throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const i=this._listenersMap.get(e)||[];return i.push(t),this._listenersMap.set(e,i),{remove:()=>{const i=this._listenersMap&&this._listenersMap.get(e)||[],r=i.indexOf(t);r>=0&&i.splice(r,1)}}}once(e,t){const i=this.on(e,(e=>{i.remove(),t.call(null,e)}));return i}hasEventListener(e){const t=this._listenersMap&&this._listenersMap.get(e);return null!=t&&t.length>0}}e.EventEmitter=t,e.EventedMixin=e=>{let i=class extends e{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};return i=Q([Ro("esri.core.Evented")],i),i};let i=class extends jo{constructor(){super(...arguments),this._emitter=new ih.EventEmitter(this)}emit(e,t){return this._emitter.emit(e,t)}on(e,t){return this._emitter.on(e,t)}once(e,t){return this._emitter.once(e,t)}hasEventListener(e){return this._emitter.hasEventListener(e)}};i=Q([Ro("esri.core.Evented")],i),e.EventedAccessor=i}(ih||(ih={}));var rh,sh=ih;function nh(e){return"string"==typeof e?document.getElementById(e):e}function oh(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function ah(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function lh(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}class hh{constructor(){this._observers=[]}observe(e){return this._observers.includes(e)||this._observers.push(e),new ms(this._observers,e)}notify(){const e=this._observers.slice();for(let t=0;t<e.length;++t){const i=e[t];i.onInvalidated(),i.onCommitted()}}}const ch=new Gr(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,(e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1})),uh=()=>{};function ph(e){return e?e instanceof _h?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function dh(e){if(e&&e.length)return e[0]}function fh(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function yh(e,t,i,r){t&&t.forEach(((t,s,n)=>{e.push(t),yh(e,i.call(r,t,s,n),i,r)}))}const gh=new Set,mh=new Set,vh=new Set,bh=new Map;let wh=0,_h=rh=class extends sh.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new hh,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:wh++})}static isCollection(e){return null!=e&&e instanceof rh}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof rh?{items:e}:e:{}}*[Symbol.iterator](){yield*this.items}get items(){return Wr(this._observable),this._items}set items(e){this._emitBeforeChanges(1)||(this._splice(0,this.length,...ph(e)),this._emitAfterChanges(1))}hasEventListener(e){return"change"===e?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if("change"===e){const e=this._chgListeners,i={removed:!1,callback:t};return e.push(i),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=uh,i.removed=!0,e.splice(e.indexOf(i),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(Wr(this._observable),this._emitBeforeChanges(1))return this;const i=this.getNextIndex(null!=t?t:null);return this._splice(i,0,e),this._emitAfterChanges(1),this}addMany(e,t=this._items.length){if(Wr(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(1))return this;const i=this.getNextIndex(t);return this._splice(i,0,...ph(e)),this._emitAfterChanges(1),this}removeAll(){if(Wr(this._observable),!this.length||this._emitBeforeChanges(2))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(2),e}clone(){return Wr(this._observable),this._createNewInstance({items:this._items.map(H)})}concat(...e){Wr(this._observable);const t=e.map(ph);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(Wr(this._observable),!this.length||this._emitBeforeChanges(2))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(2)}every(e,t){return Wr(this._observable),this._items.every(e,t)}filter(e,t){let i;return Wr(this._observable),i=2===arguments.length?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return Wr(this._observable),this._items.find(e,t)}findIndex(e,t){return Wr(this._observable),this._items.findIndex(e,t)}flatten(e,t){Wr(this._observable);const i=[];return yh(i,this,e,t),new rh(i)}forEach(e,t){return Wr(this._observable),this._items.forEach(e,t)}getItemAt(e){return Wr(this._observable),this._items[e]}getNextIndex(e){Wr(this._observable);const t=this.length;return(e=null==e?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return Wr(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return Wr(this._observable),this._items.indexOf(e,t)}join(e=","){return Wr(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return Wr(this._observable),this._items.lastIndexOf(e,t)}map(e,t){Wr(this._observable);const i=this._items.map(e,t);return new rh({items:i})}reorder(e,t=this.length-1){Wr(this._observable);const i=this.indexOf(e);if(-1!==i){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(4))return e;this._splice(i,1),this._splice(t,0,e),this._emitAfterChanges(4)}return e}}pop(){if(Wr(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=dh(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}push(...e){return Wr(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,...e),this._emitAfterChanges(1)),this.length}reduce(e,t){Wr(this._observable);const i=this._items;return 2===arguments.length?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){Wr(this._observable);const i=this._items;return 2===arguments.length?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return Wr(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(Wr(this._observable),e<0||e>=this.length||this._emitBeforeChanges(2))return;const t=dh(this._splice(e,1));return this._emitAfterChanges(2),t}removeMany(e){if(Wr(this._observable),!e||!e.length||this._emitBeforeChanges(2))return[];const t=e instanceof rh?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const e=t[n],s=i.indexOf(e);if(s>-1){const e=1+fh(t,i,n+1,s+1),o=this._splice(s,e);o&&o.length>0&&r.push.apply(r,o),n+=e-1}}return this._emitAfterChanges(2),r}reverse(){if(Wr(this._observable),this._emitBeforeChanges(4))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,...e)),this._emitAfterChanges(4),this}shift(){if(Wr(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=dh(this._splice(0,1));return this._emitAfterChanges(2),e}slice(e=0,t=this.length){return Wr(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return Wr(this._observable),this._items.some(e,t)}sort(e){if(Wr(this._observable),!this.length||this._emitBeforeChanges(4))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,...t),this._emitAfterChanges(4),this}splice(e,t,...i){Wr(this._observable);const r=(t?2:0)|(i.length?1:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,...i)||[];return this._emitAfterChanges(r),s}toArray(){return Wr(this._observable),this._items.slice()}toJSON(){return Wr(this._observable),this.toArray()}toLocaleString(){return Wr(this._observable),this._items.toLocaleString()}toString(){return Wr(this._observable),this._items.toString()}unshift(...e){return Wr(this._observable),!e.length||this._emitBeforeChanges(1)||(this._splice(0,0,...e),this._emitAfterChanges(1)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,...i){const r=this._items,s=this.constructor.prototype.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=Qs((()=>this._dispatchChange()))),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const t=ch.acquire();t.target=this,t.cancellable=!0;for(let i=0,s=o.length;i<s;i++)n=o[i],t.reset(n),this.emit("before-remove",t),t.defaultPrevented&&(o.splice(i,1),r.splice(e,0,n),e+=1,i-=1,s-=1);ch.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=ch.acquire();e.target=this,e.cancellable=!1;const t=o.length;for(let i=0;i<t;i++)e.reset(o[i]),this.emit("after-remove",e);ch.release(e)}}if(i&&i.length){if(s){const e=[];for(const t of i){const i=s.ensureType(t);null==i&&null!=t||e.push(i)}i=e}const t=this.hasEventListener("before-add"),n=this.hasEventListener("after-add"),o=e===this.length;if(t||n){const s=ch.acquire();s.target=this,s.cancellable=!0;const a=ch.acquire();a.target=this,a.cancellable=!1;for(const l of i)t?(s.reset(l),this.emit("before-add",s),s.defaultPrevented||(o?r.push(l):r.splice(e++,0,l),this._set("length",r.length),n&&(a.reset(l),this.emit("after-add",a)))):(o?r.push(l):r.splice(e++,0,l),this._set("length",r.length),a.reset(l),this.emit("after-add",a));ch.release(a),ch.release(s)}else{if(o)for(const e of i)r.push(e);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=ch.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,ch.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=ch.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),ch.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const e=t.changes;gh.clear(),mh.clear(),vh.clear();for(const{added:t,removed:a}of e){if(t)if(0===vh.size&&0===mh.size)for(const e of t)gh.add(e);else for(const e of t)mh.has(e)?(vh.add(e),mh.delete(e)):vh.has(e)||gh.add(e);if(a)if(0===vh.size&&0===gh.size)for(const e of a)mh.add(e);else for(const e of a)gh.has(e)?gh.delete(e):(vh.delete(e),mh.add(e))}const i=Cs.acquire();gh.forEach((e=>{i.push(e)}));const r=Cs.acquire();mh.forEach((e=>{r.push(e)}));const s=this._items,n=t.items,o=Cs.acquire();if(vh.forEach((e=>{n.indexOf(e)!==s.indexOf(e)&&o.push(e)})),t.listeners&&(i.length||r.length||o.length)){const e={target:this,added:i,removed:r,moved:o},s=t.listeners.length;for(let i=0;i<s;i++){const r=t.listeners[i];r.removed||r.callback.call(this,e)}}Cs.release(i),Cs.release(r),Cs.release(o)}gh.clear(),mh.clear(),vh.clear()}};_h.ofType=e=>{if(!e)return rh;if(bh.has(e))return bh.get(e);let t=null;if("function"==typeof e)t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const s in e.typeMap){const i=e.typeMap[s].prototype.declaredClass;t?t+=` | ${i}`:t=i}let i=class extends rh{};i=Q([Ro(`esri.core.Collection<${t}>`)],i);const r={Type:e,ensureType:"function"==typeof e?qn(e):Kn(e)};return Object.defineProperty(i.prototype,"itemType",{value:r}),bh.set(e,i),i},Q([ro()],_h.prototype,"length",void 0),Q([ro()],_h.prototype,"items",null),_h=rh=Q([Ro("esri.core.Collection")],_h);var xh=_h;let Sh=class extends jo{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach((t=>{e+=t.length})),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!xh.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||xh.isCollection(e)?e.forEach((e=>this._isHandle(e)&&i.push(e))):i.push(e),this.notifyChange("size"),this}forEach(e,t){if("function"==typeof e)this._groups.forEach((t=>t.forEach(e)));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||xh.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach((e=>{for(let t=0;t<e.length;t++)e[t].remove()})),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};Q([ro({readOnly:!0})],Sh.prototype,"size",null),Sh=Q([Ro("esri.core.Handles")],Sh);var Mh=Sh;function Th(){const e=Ih.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const Ih=h.crypto||h.msCrypto;function Eh(e,t,i,r,s){const n=e.watch(t,((t,s,n,o)=>{i&&!i(t)||null==r||r.call(e,t,s,n,o)}),s);if(Array.isArray(t))for(const o of t){const s=e.get(o);i&&i(s)&&(null==r||r.call(e,s,s,t,e))}else{const s=e.get(t);i&&i(s)&&(null==r||r.call(e,s,s,t,e))}return n}function Ah(e,t,i,r,s){const n="function"==typeof r?r:null,o="object"==typeof r?r:null;"boolean"==typeof r&&(s=r);let a,l=!1;function h(){a&&(a.remove(),a=null)}const c=ut();ot(o,(()=>{h(),c.reject(Qe())}));const u={then:c.promise.then.bind(c.promise),catch:c.promise.catch.bind(c.promise),remove:h};return Object.freeze(u),a=Eh(e,t,i,((t,i,r,s)=>{l=!0,h(),n&&n.call(e,t,i,r,s),c.resolve({value:t,oldValue:i,propertyName:r,target:s})}),s),l&&h(),u}function Ph(e){return!!e}function Ch(e){return!e}function Oh(e){return!0===e}function kh(e){return!1===e}const Lh=/\?(\.|$)/g;function Rh(e,t,i,r){const s=Array.isArray(t)?t:t.indexOf(",")>-1?t.split(","):[t],n=Dh(e,t,i,r);for(const o of s){const t=o.trim().replace(Lh,"$1"),r=e.get(t);i.call(e,r,r,t,e)}return n}function Dh(e,t,i,r){return e.watch(t,i,r)}function Fh(e,t,i,r){return Eh(e,t,Ph,i,r)}function jh(e,t,i,r){return Ah(e,t,Ph,i,r)}function Nh(e,t,i,r){return Eh(e,t,Ch,i,r)}function zh(e,t,i,r){return Ah(e,t,Ch,i,r)}function Vh(e,t,i,r){return Eh(e,t,Oh,i,r)}function Uh(e,t,i,r){return Ah(e,t,Oh,i,r)}function Gh(e,t,i,r){return Eh(e,t,kh,i,r)}function Bh(e,t,i,r){return Ah(e,t,kh,i,r)}function qh(e,t,i,r){let s=!1;const n=e.watch(t,((t,r,n,o)=>{s||i.call(e,t,r,n,o)}),r);return{remove(){n.remove()},pause(){s=!0},resume(){s=!1}}}function Hh(e,t,i,r,s,n,o){const a={};function l(t){const r=a[t];r&&(n&&n(r.target,t,e,i),r.handle.remove(),delete a[t])}const h=Rh(e,t,((t,n,o)=>{l(o),We(t)&&(a[o]={handle:$e(t,i,r),target:t},s&&s(t,o,e,i))}),o);return{remove(){h.remove();for(const e in a)l(e)}}}
/*!
 * @esri/arcgis-html-sanitizer - v2.6.1 - Thu Jun 17 2021 14:37:35 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2021 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(é›·å®—æ°‘) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var Wh,$h,Jh=Function.prototype,Xh=Object.prototype,Kh=Jh.toString,Yh=Xh.hasOwnProperty,Zh=Kh.call(Object),Qh=Xh.toString,ec=(Wh=Object.getPrototypeOf,$h=Object,function(e){return Wh($h(e))});var tc=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=Qh.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(qe){}return t}(e))return!1;var t=ec(e);if(null===t)return!0;var i=Yh.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Kh.call(i)==Zh},ic={exports:{}},rc={},sc={exports:{}},nc={};function oc(){var e={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return e}var ac=/javascript\s*\:/gim;nc.whiteList=oc(),nc.getDefaultWhiteList=oc,nc.onAttr=function(e,t,i){},nc.onIgnoreAttr=function(e,t,i){},nc.safeAttrValue=function(e,t){return ac.test(t)?"":t};var lc={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}};var hc=nc,cc=function(e,t){";"!==(e=lc.trimRight(e))[e.length-1]&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var i=lc.trim(e.slice(s,n)),a=i.indexOf(":");if(-1!==a){var l=lc.trim(i.slice(0,a)),h=lc.trim(i.slice(a+1));if(l){var c=t(s,o.length,l,h,i);c&&(o+=c+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if("/"===l&&"*"===e[n+1]){var h=e.indexOf("*/",n+2);if(-1===h)break;s=(n=h+1)+1,r=!1}else"("===l?r=!0:")"===l?r=!1:";"===l?r||a():"\n"===l&&a()}return lc.trim(o)};function uc(e){return null==e}function pc(e){(e=function(e){var t={};for(var i in e)t[i]=e[i];return t}(e||{})).whiteList=e.whiteList||hc.whiteList,e.onAttr=e.onAttr||hc.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||hc.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||hc.safeAttrValue,this.options=e}pc.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,i=t.whiteList,r=t.onAttr,s=t.onIgnoreAttr,n=t.safeAttrValue;return cc(e,(function(e,t,o,a,l){var h=i[o],c=!1;if(!0===h?c=h:"function"==typeof h?c=h(a):h instanceof RegExp&&(c=h.test(a)),!0!==c&&(c=!1),a=n(o,a)){var u,p={position:t,sourcePosition:e,source:l,isWhite:c};return c?uc(u=r(o,a,p))?o+":"+a:u:uc(u=s(o,a,p))?void 0:u}}))};var dc=pc;!function(e,t){var i=nc,r=dc;for(var s in(t=e.exports=function(e,t){return new r(t).process(e)}).FilterCSS=r,i)t[s]=i[s]}(sc,sc.exports);var fc={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1}},yc=sc.exports.FilterCSS,gc=sc.exports.getDefaultWhiteList,mc=fc;function vc(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var bc=new yc;function wc(e){return e.replace(_c,"&lt;").replace(xc,"&gt;")}var _c=/</g,xc=/>/g,Sc=/"/g,Mc=/&quot;/g,Tc=/&#([a-zA-Z0-9]*);?/gim,Ic=/&colon;?/gim,Ec=/&newline;?/gim,Ac=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,Pc=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,Cc=/u\s*r\s*l\s*\(.*/gi;function Oc(e){return e.replace(Sc,"&quot;")}function kc(e){return e.replace(Mc,'"')}function Lc(e){return e.replace(Tc,(function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))}))}function Rc(e){return e.replace(Ic,":").replace(Ec," ")}function Dc(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return mc.trim(t)}function Fc(e){return e=Dc(e=Rc(e=Lc(e=kc(e))))}function jc(e){return e=wc(e=Oc(e))}var Nc=/<!--[\s\S]*?-->/g;rc.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},rc.getDefaultWhiteList=vc,rc.onTag=function(e,t,i){},rc.onIgnoreTag=function(e,t,i){},rc.onTagAttr=function(e,t,i){},rc.onIgnoreTagAttr=function(e,t,i){},rc.safeAttrValue=function(e,t,i,r){if(i=Fc(i),"href"===t||"src"===t){if("#"===(i=mc.trim(i)))return"#";if("http://"!==i.substr(0,7)&&"https://"!==i.substr(0,8)&&"mailto:"!==i.substr(0,7)&&"tel:"!==i.substr(0,4)&&"data:image/"!==i.substr(0,11)&&"ftp://"!==i.substr(0,6)&&"./"!==i.substr(0,2)&&"../"!==i.substr(0,3)&&"#"!==i[0]&&"/"!==i[0])return""}else if("background"===t){if(Ac.lastIndex=0,Ac.test(i))return""}else if("style"===t){if(Pc.lastIndex=0,Pc.test(i))return"";if(Cc.lastIndex=0,Cc.test(i)&&(Ac.lastIndex=0,Ac.test(i)))return"";!1!==r&&(i=(r=r||bc).process(i))}return i=jc(i)},rc.escapeHtml=wc,rc.escapeQuote=Oc,rc.unescapeQuote=kc,rc.escapeHtmlEntities=Lc,rc.escapeDangerHtml5Entities=Rc,rc.clearNonPrintableCharacter=Dc,rc.friendlyAttrValue=Fc,rc.escapeAttrValue=jc,rc.onIgnoreTagStripAll=function(){return""},rc.StripTagBody=function(e,t){"function"!=typeof t&&(t=function(){});var i=!Array.isArray(e),r=[],s=!1;return{onIgnoreTag:function(n,o,a){if(function(t){return!!i||-1!==mc.indexOf(e,t)}(n)){if(a.isClosing){var l="[/removed]",h=a.position+l.length;return r.push([!1!==s?s:a.position,h]),s=!1,l}return s||(s=a.position),"[removed]"}return t(n,o,a)},remove:function(e){var t="",i=0;return mc.forEach(r,(function(r){t+=e.slice(i,r[0]),i=r[1]})),t+=e.slice(i)}}},rc.stripCommentTag=function(e){return e.replace(Nc,"")},rc.stripBlankChar=function(e){var t=e.split("");return(t=t.filter((function(e){var t=e.charCodeAt(0);return 127!==t&&(!(t<=31)||(10===t||13===t))}))).join("")},rc.cssFilter=bc,rc.getDefaultCSSWhiteList=gc;var zc={},Vc=fc;function Uc(e){var t=Vc.spaceIndex(e);if(-1===t)var i=e.slice(1,-1);else i=e.slice(1,t+1);return"/"===(i=Vc.trim(i).toLowerCase()).slice(0,1)&&(i=i.slice(1)),"/"===i.slice(-1)&&(i=i.slice(0,-1)),i}function Gc(e){return"</"===e.slice(0,2)}var Bc=/[^a-zA-Z0-9_:\.\-]/gim;function qc(e,t){for(;t<e.length;t++){var i=e[t];if(" "!==i)return"="===i?t:-1}}function Hc(e,t){for(;t>0;t--){var i=e[t];if(" "!==i)return"="===i?t:-1}}function Wc(e){return function(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]}(e)?e.substr(1,e.length-2):e}zc.parseTag=function(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,h="",c="";e:for(a=0;a<l;a++){var u=e.charAt(a);if(!1===n){if("<"===u){n=a;continue}}else if(!1===o){if("<"===u){r+=i(e.slice(s,a)),n=a,s=a;continue}if(">"===u){r+=i(e.slice(s,n)),h=Uc(c=e.slice(n,a+1)),r+=t(n,r.length,h,c,Gc(c)),s=a+1,n=!1;continue}if('"'===u||"'"===u)for(var p=1,d=e.charAt(a-p);""===d.trim()||"="===d;){if("="===d){o=u;continue e}d=e.charAt(a-++p)}}else if(u===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r},zc.parseAttr=function(e,t){var i=0,r=[],s=!1,n=e.length;function o(e,i){if(!((e=(e=Vc.trim(e)).replace(Bc,"").toLowerCase()).length<1)){var s=t(e,i||"");s&&r.push(s)}}for(var a=0;a<n;a++){var l,h=e.charAt(a);if(!1!==s||"="!==h)if(!1===s||a!==i||'"'!==h&&"'"!==h||"="!==e.charAt(a-1))if(/\s|\n|\t/.test(h)){if(e=e.replace(/\s|\n|\t/g," "),!1===s){if(-1===(l=qc(e,a))){o(Vc.trim(e.slice(i,a))),s=!1,i=a+1;continue}a=l-1;continue}if(-1===(l=Hc(e,a-1))){o(s,Wc(Vc.trim(e.slice(i,a)))),s=!1,i=a+1;continue}}else;else{if(-1===(l=e.indexOf(h,a+1)))break;o(s,Vc.trim(e.slice(i+1,l))),s=!1,i=(a=l)+1}else s=e.slice(i,a),i=a+1}return i<e.length&&(!1===s?o(e.slice(i)):o(s,Wc(Vc.trim(e.slice(i))))),Vc.trim(r.join(" "))};var $c=sc.exports.FilterCSS,Jc=rc,Xc=zc,Kc=Xc.parseTag,Yc=Xc.parseAttr,Zc=fc;function Qc(e){return null==e}function eu(e){(e=function(e){var t={};for(var i in e)t[i]=e[i];return t}(e||{})).stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=Jc.onIgnoreTagStripAll),e.whiteList=e.whiteList||Jc.whiteList,e.onTag=e.onTag||Jc.onTag,e.onTagAttr=e.onTagAttr||Jc.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||Jc.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||Jc.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||Jc.safeAttrValue,e.escapeHtml=e.escapeHtml||Jc.escapeHtml,this.options=e,!1===e.css?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new $c(e.css))}eu.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t=this.options,i=t.whiteList,r=t.onTag,s=t.onIgnoreTag,n=t.onTagAttr,o=t.onIgnoreTagAttr,a=t.safeAttrValue,l=t.escapeHtml,h=this.cssFilter;t.stripBlankChar&&(e=Jc.stripBlankChar(e)),t.allowCommentTag||(e=Jc.stripCommentTag(e));var c=!1;if(t.stripIgnoreTagBody){c=Jc.StripTagBody(t.stripIgnoreTagBody,s);s=c.onIgnoreTag}var u=Kc(e,(function(e,t,c,u,p){var d,f={sourcePosition:e,position:t,isClosing:p,isWhite:i.hasOwnProperty(c)};if(!Qc(d=r(c,u,f)))return d;if(f.isWhite){if(f.isClosing)return"</"+c+">";var y=function(e){var t=Zc.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var i="/"===(e=Zc.trim(e.slice(t+1,-1)))[e.length-1];return i&&(e=Zc.trim(e.slice(0,-1))),{html:e,closing:i}}(u),g=i[c],m=Yc(y.html,(function(e,t){var i,r=-1!==Zc.indexOf(g,e);return Qc(i=n(c,e,t,r))?r?(t=a(c,e,t,h))?e+'="'+t+'"':e:Qc(i=o(c,e,t,r))?void 0:i:i}));u="<"+c;return m&&(u+=" "+m),y.closing&&(u+=" /"),u+=">"}return Qc(d=s(c,u,f))?l(u):d}),l);return c&&(u=c.remove(u)),u};var tu=eu;!function(e,t){var i=rc,r=zc,s=tu;function n(e,t){return new s(t).process(e)}for(var o in(t=e.exports=n).filterXSS=n,t.FilterXSS=s,i)t[o]=i[o];for(var o in r)t[o]=r[o];"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=e.exports)}(ic,ic.exports);var iu,ru,su=function(){function e(e,t){var i,r=this;this.arcgisWhiteList={a:["href","target","style"],abbr:["title"],img:["src","width","height","border","alt","style"],video:["autoplay","controls","height","loop","muted","poster","preload","width"],audio:["autoplay","controls","loop","muted","preload"],source:["media","src","type"],span:["style"],table:["width","height","cellpadding","cellspacing","border","style"],div:["style","align"],font:["size","color","style"],tr:["height","valign","align","style"],td:["height","width","valign","align","colspan","rowspan","nowrap","style"],th:["height","width","valign","align","colspan","rowspan","nowrap","style"],p:["style"],b:[],strong:[],i:[],em:[],u:[],br:[],li:[],ul:[],ol:[],hr:[],tbody:[]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(e,t,i,s){return"a"===e&&"href"===t||("img"===e||"source"===e)&&"src"===t?r.sanitizeUrl(i):ic.exports.safeAttrValue(e,t,i,s)}},e&&!t?i=e:e&&t?(i=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach((function(t){"whiteList"===t?i.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):i[t]=e[t]}))):(i=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=i,this._xssFilter=new ic.exports.FilterXSS(i)}return e.prototype.sanitize=function(e,t){switch(void 0===t&&(t={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,t);default:if(t.allowUndefined&&void 0===e)return;return null}},e.prototype.sanitizeUrl=function(e){var t=this._trim(e.substring(0,e.indexOf(":")));return"/"===e||"#"===e||"#"===e[0]||this.allowedProtocols.indexOf(t.toLowerCase())>-1?ic.exports.escapeAttrValue(e):""},e.prototype.sanitizeHTMLAttribute=function(e,t,i,r){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(e,t,i,r):ic.exports.safeAttrValue(e,t,i,r)},e.prototype.validate=function(e,t){void 0===t&&(t={});var i=this.sanitize(e,t);return{isValid:e===i,sanitized:i}},e.prototype._extendObjectOfArrays=function(e){var t={};return e.forEach((function(e){Object.keys(e).forEach((function(i){Array.isArray(e[i])&&Array.isArray(t[i])?t[i]=t[i].concat(e[i]):t[i]=e[i]}))})),t},e.prototype._iterateOverObject=function(e,t){var i=this;void 0===t&&(t={});try{var r=!1,s=void 0;if(Array.isArray(e))s=e.reduce((function(e,s){var n=i.validate(s,t);return n.isValid?e.concat([s]):(r=!0,e.concat([n.sanitized]))}),[]);else{if(!tc(e)){if(t.allowUndefined&&void 0===e)return;return null}s=Object.keys(e).reduce((function(s,n){var o=e[n],a=i.validate(o,t);return a.isValid?s[n]=o:(r=!0,s[n]=a.sanitized),s}),{})}return r?s:e}catch(n){return null}},e.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},e}(),nu=function(e){iu||function(e){if("WebkitTransition"in e.style)iu="webkitTransitionEnd",ru="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");iu="transitionend",ru="animationend"}}(e)},ou=function(e,t){return void 0===t&&(t=e+"-active"),function(i){nu(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(iu,s),i.removeEventListener(ru,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(iu,s),i.addEventListener(ru,s),requestAnimationFrame((function(){i.classList.add(t)}))}},au=function(e,t){return void 0===t&&(t=e+"-active"),function(i,r){nu(i);var s=!1,n=function(e){s||(s=!0,i.removeEventListener(iu,n),i.removeEventListener(ru,n),r())};i.classList.add(e),i.addEventListener(iu,n),i.addEventListener(ru,n),requestAnimationFrame((function(){i.classList.add(t)}))}};function lu(e){const t=Cs.acquire();for(let r=0;r<arguments.length;r++){const e=arguments[r],i=typeof e;if("string"===i)t.push(e);else if(Array.isArray(e))t.push.apply(t,e);else if("object"===i)for(const r in e)e[r]&&t.push(r)}const i=t.join(" ");return Cs.release(t),i}function hu(){return"rtl"===document.dir}function cu(e){this[e.getAttribute("data-node-ref")]=null}function uu(e){this[e.getAttribute("data-node-ref")]=e}function pu(e,t){return("enter"===e?ou:au)(t)}Ne.getLogger("esri.widgets.support.widgetUtils");const du=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce(((e,t)=>(e[t]=[],e)),{}),fu=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],yu=new su({whiteList:du,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(fu.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function gu(e){return"Enter"===e||" "===e}function mu(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function vu(){return mu().startsWith("dark")}const bu="http://www.w3.org/",wu=`${bu}2000/svg`,_u=`${bu}1999/xlink`;let xu,Su=[],Mu=(e,t)=>{let i={};return Object.keys(e).forEach((t=>{i[t]=e[t]})),t&&Object.keys(t).forEach((e=>{i[e]=t[e]})),i},Tu=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Iu=e=>{if("string"!=typeof e)throw new Error("Style values must be strings")},Eu=(e,t,i)=>{if(""!==t.vnodeSelector)for(let r=i;r<e.length;r++)if(Tu(e[r],t))return r;return-1},Au=(e,t,i,r)=>{let s=e[t];if(""===s.vnodeSelector)return;let n=s.properties;if(!(n?void 0===n.key?n.bind:n.key:void 0))for(let o=0;o<e.length;o++)if(o!==t){let t=e[o];if(Tu(t,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${"added"===r?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}},Pu=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},Cu=[],Ou=!1,ku=e=>{(e.children||[]).forEach(ku),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},Lu=()=>{Ou=!1,Cu.forEach(ku),Cu.length=0},Ru=e=>{Cu.push(e),Ou||(Ou=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(Lu,{timeout:16}):setTimeout(Lu,16))},Du=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i){t.style.pointerEvents="none";let r=()=>{t.parentNode&&(t.parentNode.removeChild(t),Ru(e))};return void i(t,r,e.properties)}}t.parentNode&&(t.parentNode.removeChild(t),Ru(e))},Fu=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let n=s[o],a=t[n];if("className"===n)throw new Error('Property "className" is not supported, use "class".');if("class"===n)zu(e,a,!0);else if("classes"===n){let t=Object.keys(a),i=t.length;for(let r=0;r<i;r++){let i=t[r];a[i]&&e.classList.add(i)}}else if("styles"===n){let t=Object.keys(a),r=t.length;for(let s=0;s<r;s++){let r=t[s],n=a[r];n&&(Iu(n),i.styleApplyer(e,r,n))}}else if("key"!==n&&null!=a){let s=typeof a;"function"===s?(0===n.lastIndexOf("on",0)&&(r&&(a=r(n,a,e,t)),"oninput"===n&&function(){let e=a;a=function(t){e.apply(this,[t]),t.target["oninput-value"]=t.target.value}}()),e[n]=a):i.namespace===wu?"href"===n?e.setAttributeNS(_u,n,a):e.setAttribute(n,a):"string"===s&&"value"!==n?"innerHTML"===n?e[n]=yu.sanitize(a):e.setAttribute(n,a):e[n]=a}}},ju=(e,t,i)=>{((e,t,i)=>{if(t)for(let r of t)Nu(r,e,void 0,i)})(e,t.children,i),t.text&&(e.textContent=t.text),Fu(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},Nu=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(""===o)s=e.domNode=a.createTextNode(e.text),void 0!==i?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let h=o.charAt(l);if(l===o.length||"."===h||"#"===h){let h=o.charAt(n-1),c=o.slice(n,l);"."===h?s.classList.add(c):"#"===h?s.id=c:("svg"===c&&(r=Mu(r,{namespace:wu})),void 0!==r.namespace?s=e.domNode=a.createElementNS(r.namespace,c):(s=e.domNode=e.domNode||a.createElement(c),"input"===c&&e.properties&&void 0!==e.properties.type&&s.setAttribute("type",e.properties.type)),void 0!==i?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}ju(s,e,r)}},zu=(e,t,i)=>{t&&t.split(" ").forEach((t=>{t&&e.classList.toggle(t,i)}))};xu=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(""===t.vnodeSelector){if(t.text!==e.text){let e=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(e,r),t.domNode=e,s=!0,s}t.domNode=r}else 0===t.vnodeSelector.lastIndexOf("svg",0)&&(i=Mu(i,{namespace:wu})),e.text!==t.text&&(n=!0,void 0===t.text?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=((e,t,i,r,s)=>{if(i===r)return!1;r=r||Su;let n,o=(i=i||Su).length,a=r.length,l=0,h=0,c=!1;for(;h<a;){let a=l<o?i[l]:void 0,u=r[h];if(void 0!==a&&Tu(a,u))c=xu(a,u,s)||c,l++;else{let a=Eu(i,u,l+1);if(a>=0){for(n=l;n<a;n++)Du(i[n]),Au(i,n,e,"removed");c=xu(i[a],u,s)||c,l=a+1}else Nu(u,t,l<o?i[l].domNode:void 0,s),Pu(u),Au(r,h,e,"added")}h++}if(o>l)for(n=l;n<o;n++)Du(i[n]),Au(i,n,e,"removed");return c})(t,r,e.children,t.children,i)||n,n=((e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let o=n[a],l=i[o],h=t[o];if("class"===o)h!==l&&(zu(e,h,!1),zu(e,l,!0));else if("classes"===o){let t=e.classList,i=Object.keys(l),r=i.length;for(let e=0;e<r;e++){let r=i[e],n=!!l[r];n!==!!h[r]&&(s=!0,n?t.add(r):t.remove(r))}}else if("styles"===o){let t=Object.keys(l),i=t.length;for(let n=0;n<i;n++){let i=t[n],o=l[i];o!==h[i]&&(s=!0,o?(Iu(o),r.styleApplyer(e,i,o)):r.styleApplyer(e,i,""))}}else if(l||"string"!=typeof h||(l=""),"value"===o){let t=e[o];t!==l&&(e["oninput-value"]?t===e["oninput-value"]:l!==h)&&(e[o]=l,e["oninput-value"]=void 0),l!==h&&(s=!0)}else if(l!==h){let t=typeof l;"function"===t&&r.eventHandlerInterceptor||(r.namespace===wu?"href"===o?e.setAttributeNS(_u,o,l):e.setAttribute(o,l):"string"===t?"innerHTML"===o?e[o]=yu.sanitize(l):"role"===o&&""===l?e.removeAttribute(o):e.setAttribute(o,l):e[o]!==l&&(e[o]=l),s=!0)}}return s})(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let Vu=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,xu(r,i,t)},domNode:e.domNode});const Uu={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{"-"===t.charAt(0)?e.style.setProperty(t,i):e.style[t]=i}};let Gu,Bu=e=>Mu(Uu,e),qu=(e,t,i)=>(i=Bu(i),Nu(t,e,void 0,i),Vu(t,i)),Hu=(e,t,i)=>(i=Bu(i),Nu(t,e.parentNode,e,i),Vu(t,i)),Wu=(e,t,i)=>(i=Bu(i),t.domNode=e,ju(e,t,i),Vu(t,i)),$u=(e,t,i)=>(i=Bu(i),Nu(t,e.parentNode,e,i),e.parentNode.removeChild(e),Vu(t,i)),Ju=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};Gu=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let Xu=(e,t)=>{let i=e;return t.forEach((e=>{i=i&&i.children?Gu(i.children,(t=>t.domNode===e)):void 0})),i},Ku=(e,t,i)=>{let r=function(r){i("domEvent",r);let s=t(),n=Ju(r.currentTarget,s.domNode);n.reverse();let o,a=Xu(s.getLastRender(),n);return e.scheduleRender(),a&&(o=a.properties[`on${r.type}`].apply(a.properties.bind||this,arguments)),i("domEventProcessed",r),o};return(e,t,i,s)=>r},Yu=e=>{let t,i,r=Bu(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],h=(e,i,n)=>{let o;r.eventHandlerInterceptor=Ku(t,(()=>o),s),o=e(i,n(),r),a.push(o),l.push(n)},c=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let e=0;e<a.length;e++){let t=l[e]();s("rendered",void 0),a[e].update(t),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:c,scheduleRender:()=>{i||o||(i=requestAnimationFrame(c))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(e,t)=>{h(qu,e,t)},insertBefore:(e,t)=>{h(Hu,e,t)},merge:(e,t)=>{h(Wu,e,t)},replace:(e,t)=>{h($u,e,t)},detach:e=>{for(let t=0;t<l.length;t++)if(l[t]===e)return l.splice(t,1),a.splice(t,1)[0];throw new Error("renderFunction was not found")}},t};const Zu={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},Qu={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},ep=(e,t,i=!1)=>{let r=e;return t.forEach(((e,s)=>{var n;const o=null!=(n=r)&&n.children?((e,t)=>e.find(t))(r.children,(t=>t.domNode===e)):void 0;i&&!o&&s!==t.length-1||(r=o)})),r},tp="undefined"!=typeof window?window:{};var ip,rp;tp.document,tp.HTMLElement,(rp=ip||(ip={})).green="checkCircle",rp.yellow="exclamationMarkTriangle",rp.red="exclamationMarkTriangle",rp.blue="lightbulb";const sp=/^#[0-9A-F]{3}$/i,np=/^#[0-9A-F]{6}$/i;function op(e){return ap(e)||function(e){return e&&7===e.length&&np.test(e)}(e)}function ap(e){return e&&4===e.length&&sp.test(e)}function lp(e,t,i){return e(i={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},i.exports),i.exports}var hp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},cp=lp((function(e){var t=Array.prototype.concat,i=Array.prototype.slice,r=e.exports=function(e){for(var r,s=[],n=0,o=e.length;n<o;n++){var a=e[n];(r=a)&&"string"!=typeof r&&(r instanceof Array||Array.isArray(r)||r.length>=0&&(r.splice instanceof Function||Object.getOwnPropertyDescriptor(r,r.length-1)&&"String"!==r.constructor.name))?s=t.call(s,i.call(a)):s.push(a)}return s};r.wrap=function(e){return function(){return e(r(arguments))}}})),up=lp((function(e){var t={};for(var i in hp)hp.hasOwnProperty(i)&&(t[hp[i]]=i);var r=e.exports={to:{},get:{}};function s(e,t,i){return Math.min(Math.max(t,e),i)}function n(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}r.get=function(e){var t,i;switch(e.substring(0,3).toLowerCase()){case"hsl":t=r.get.hsl(e),i="hsl";break;case"hwb":t=r.get.hwb(e),i="hwb";break;default:t=r.get.rgb(e),i="rgb"}return t?{model:i,value:t}:null},r.get.rgb=function(e){if(!e)return null;var t,i,r,n=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=t[2],t=t[1],i=0;i<3;i++){var o=2*i;n[i]=parseInt(t.slice(o,o+2),16)}r&&(n[3]=parseInt(r,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(r=(t=t[1])[3],i=0;i<3;i++)n[i]=parseInt(t[i]+t[i],16);r&&(n[3]=parseInt(r+r,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(i=0;i<3;i++)n[i]=parseInt(t[i+1],0);t[4]&&(n[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(n=hp[t[1]])?(n[3]=1,n):null:null;for(i=0;i<3;i++)n[i]=Math.round(2.55*parseFloat(t[i+1]));t[4]&&(n[3]=parseFloat(t[4]))}for(i=0;i<3;i++)n[i]=s(n[i],0,255);return n[3]=s(n[3],0,1),n},r.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var i=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,s(parseFloat(t[2]),0,100),s(parseFloat(t[3]),0,100),s(isNaN(i)?1:i,0,1)]}return null},r.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var i=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,s(parseFloat(t[2]),0,100),s(parseFloat(t[3]),0,100),s(isNaN(i)?1:i,0,1)]}return null},r.to.hex=function(){var e=cp(arguments);return"#"+n(e[0])+n(e[1])+n(e[2])+(e[3]<1?n(Math.round(255*e[3])):"")},r.to.rgb=function(){var e=cp(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},r.to.rgb.percent=function(){var e=cp(arguments),t=Math.round(e[0]/255*100),i=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+i+"%, "+r+"%)":"rgba("+t+"%, "+i+"%, "+r+"%, "+e[3]+")"},r.to.hsl=function(){var e=cp(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},r.to.hwb=function(){var e=cp(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},r.to.keyword=function(e){return t[e.slice(0,3)]}})),pp=lp((function(e){var t={};for(var i in hp)hp.hasOwnProperty(i)&&(t[hp[i]]=i);var r=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var s in r)if(r.hasOwnProperty(s)){if(!("channels"in r[s]))throw new Error("missing channels property: "+s);if(!("labels"in r[s]))throw new Error("missing channel labels property: "+s);if(r[s].labels.length!==r[s].channels)throw new Error("channel and label counts mismatch: "+s);var n=r[s].channels,o=r[s].labels;delete r[s].channels,delete r[s].labels,Object.defineProperty(r[s],"channels",{value:n}),Object.defineProperty(r[s],"labels",{value:o})}r.rgb.hsl=function(e){var t,i,r=e[0]/255,s=e[1]/255,n=e[2]/255,o=Math.min(r,s,n),a=Math.max(r,s,n),l=a-o;return a===o?t=0:r===a?t=(s-n)/l:s===a?t=2+(n-r)/l:n===a&&(t=4+(r-s)/l),(t=Math.min(60*t,360))<0&&(t+=360),i=(o+a)/2,[t,100*(a===o?0:i<=.5?l/(a+o):l/(2-a-o)),100*i]},r.rgb.hsv=function(e){var t,i,r,s,n,o=e[0]/255,a=e[1]/255,l=e[2]/255,h=Math.max(o,a,l),c=h-Math.min(o,a,l),u=function(e){return(h-e)/6/c+.5};return 0===c?s=n=0:(n=c/h,t=u(o),i=u(a),r=u(l),o===h?s=r-i:a===h?s=1/3+t-r:l===h&&(s=2/3+i-t),s<0?s+=1:s>1&&(s-=1)),[360*s,100*n,100*h]},r.rgb.hwb=function(e){var t=e[0],i=e[1],s=e[2];return[r.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(i,s))),100*(s=1-1/255*Math.max(t,Math.max(i,s)))]},r.rgb.cmyk=function(e){var t,i=e[0]/255,r=e[1]/255,s=e[2]/255;return[100*((1-i-(t=Math.min(1-i,1-r,1-s)))/(1-t)||0),100*((1-r-t)/(1-t)||0),100*((1-s-t)/(1-t)||0),100*t]},r.rgb.keyword=function(e){var i=t[e];if(i)return i;var r,s,n,o=1/0;for(var a in hp)if(hp.hasOwnProperty(a)){var l=hp[a],h=(s=e,n=l,Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2)+Math.pow(s[2]-n[2],2));h<o&&(o=h,r=a)}return r},r.keyword.rgb=function(e){return hp[e]},r.rgb.xyz=function(e){var t=e[0]/255,i=e[1]/255,r=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*t+.7152*i+.0722*r),100*(.0193*t+.1192*i+.9505*r)]},r.rgb.lab=function(e){var t=r.rgb.xyz(e),i=t[0],s=t[1],n=t[2];return s/=100,n/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116)-16,500*(i-s),200*(s-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},r.hsl.rgb=function(e){var t,i,r,s,n,o=e[0]/360,a=e[1]/100,l=e[2]/100;if(0===a)return[n=255*l,n,n];t=2*l-(i=l<.5?l*(1+a):l+a-l*a),s=[0,0,0];for(var h=0;h<3;h++)(r=o+1/3*-(h-1))<0&&r++,r>1&&r--,n=6*r<1?t+6*(i-t)*r:2*r<1?i:3*r<2?t+(i-t)*(2/3-r)*6:t,s[h]=255*n;return s},r.hsl.hsv=function(e){var t=e[0],i=e[1]/100,r=e[2]/100,s=i,n=Math.max(r,.01);return i*=(r*=2)<=1?r:2-r,s*=n<=1?n:2-n,[t,100*(0===r?2*s/(n+s):2*i/(r+i)),100*((r+i)/2)]},r.hsv.rgb=function(e){var t=e[0]/60,i=e[1]/100,r=e[2]/100,s=Math.floor(t)%6,n=t-Math.floor(t),o=255*r*(1-i),a=255*r*(1-i*n),l=255*r*(1-i*(1-n));switch(r*=255,s){case 0:return[r,l,o];case 1:return[a,r,o];case 2:return[o,r,l];case 3:return[o,a,r];case 4:return[l,o,r];case 5:return[r,o,a]}},r.hsv.hsl=function(e){var t,i,r,s=e[0],n=e[1]/100,o=e[2]/100,a=Math.max(o,.01);return r=(2-n)*o,i=n*a,[s,100*(i=(i/=(t=(2-n)*a)<=1?t:2-t)||0),100*(r/=2)]},r.hwb.rgb=function(e){var t,i,r,s,n,o,a,l=e[0]/360,h=e[1]/100,c=e[2]/100,u=h+c;switch(u>1&&(h/=u,c/=u),r=6*l-(t=Math.floor(6*l)),0!=(1&t)&&(r=1-r),s=h+r*((i=1-c)-h),t){default:case 6:case 0:n=i,o=s,a=h;break;case 1:n=s,o=i,a=h;break;case 2:n=h,o=i,a=s;break;case 3:n=h,o=s,a=i;break;case 4:n=s,o=h,a=i;break;case 5:n=i,o=h,a=s}return[255*n,255*o,255*a]},r.cmyk.rgb=function(e){var t=e[0]/100,i=e[1]/100,r=e[2]/100,s=e[3]/100;return[255*(1-Math.min(1,t*(1-s)+s)),255*(1-Math.min(1,i*(1-s)+s)),255*(1-Math.min(1,r*(1-s)+s))]},r.xyz.rgb=function(e){var t,i,r,s=e[0]/100,n=e[1]/100,o=e[2]/100;return i=-.9689*s+1.8758*n+.0415*o,r=.0557*s+-.204*n+1.057*o,t=(t=3.2406*s+-1.5372*n+-.4986*o)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(t=Math.min(Math.max(0,t),1)),255*(i=Math.min(Math.max(0,i),1)),255*(r=Math.min(Math.max(0,r),1))]},r.xyz.lab=function(e){var t=e[0],i=e[1],r=e[2];return i/=100,r/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(t-i),200*(i-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},r.lab.xyz=function(e){var t,i,r,s=e[0];t=e[1]/500+(i=(s+16)/116),r=i-e[2]/200;var n=Math.pow(i,3),o=Math.pow(t,3),a=Math.pow(r,3);return i=n>.008856?n:(i-16/116)/7.787,t=o>.008856?o:(t-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[t*=95.047,i*=100,r*=108.883]},r.lab.lch=function(e){var t,i=e[0],r=e[1],s=e[2];return(t=360*Math.atan2(s,r)/2/Math.PI)<0&&(t+=360),[i,Math.sqrt(r*r+s*s),t]},r.lch.lab=function(e){var t,i=e[0],r=e[1];return t=e[2]/360*2*Math.PI,[i,r*Math.cos(t),r*Math.sin(t)]},r.rgb.ansi16=function(e){var t=e[0],i=e[1],s=e[2],n=1 in arguments?arguments[1]:r.rgb.hsv(e)[2];if(0===(n=Math.round(n/50)))return 30;var o=30+(Math.round(s/255)<<2|Math.round(i/255)<<1|Math.round(t/255));return 2===n&&(o+=60),o},r.hsv.ansi16=function(e){return r.rgb.ansi16(r.hsv.rgb(e),e[2])},r.rgb.ansi256=function(e){var t=e[0],i=e[1],r=e[2];return t===i&&i===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(i/255*5)+Math.round(r/255*5)},r.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var i=.5*(1+~~(e>50));return[(1&t)*i*255,(t>>1&1)*i*255,(t>>2&1)*i*255]},r.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var i;return e-=16,[Math.floor(e/36)/5*255,Math.floor((i=e%36)/6)/5*255,i%6/5*255]},r.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},r.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var i=t[0];3===t[0].length&&(i=i.split("").map((function(e){return e+e})).join(""));var r=parseInt(i,16);return[r>>16&255,r>>8&255,255&r]},r.rgb.hcg=function(e){var t,i=e[0]/255,r=e[1]/255,s=e[2]/255,n=Math.max(Math.max(i,r),s),o=Math.min(Math.min(i,r),s),a=n-o;return t=a<=0?0:n===i?(r-s)/a%6:n===r?2+(s-i)/a:4+(i-r)/a+4,t/=6,[360*(t%=1),100*a,100*(a<1?o/(1-a):0)]},r.hsl.hcg=function(e){var t=e[1]/100,i=e[2]/100,r=1,s=0;return(r=i<.5?2*t*i:2*t*(1-i))<1&&(s=(i-.5*r)/(1-r)),[e[0],100*r,100*s]},r.hsv.hcg=function(e){var t=e[1]/100,i=e[2]/100,r=t*i,s=0;return r<1&&(s=(i-r)/(1-r)),[e[0],100*r,100*s]},r.hcg.rgb=function(e){var t=e[0]/360,i=e[1]/100,r=e[2]/100;if(0===i)return[255*r,255*r,255*r];var s,n=[0,0,0],o=t%1*6,a=o%1,l=1-a;switch(Math.floor(o)){case 0:n[0]=1,n[1]=a,n[2]=0;break;case 1:n[0]=l,n[1]=1,n[2]=0;break;case 2:n[0]=0,n[1]=1,n[2]=a;break;case 3:n[0]=0,n[1]=l,n[2]=1;break;case 4:n[0]=a,n[1]=0,n[2]=1;break;default:n[0]=1,n[1]=0,n[2]=l}return s=(1-i)*r,[255*(i*n[0]+s),255*(i*n[1]+s),255*(i*n[2]+s)]},r.hcg.hsv=function(e){var t=e[1]/100,i=t+e[2]/100*(1-t),r=0;return i>0&&(r=t/i),[e[0],100*r,100*i]},r.hcg.hsl=function(e){var t=e[1]/100,i=e[2]/100*(1-t)+.5*t,r=0;return i>0&&i<.5?r=t/(2*i):i>=.5&&i<1&&(r=t/(2*(1-i))),[e[0],100*r,100*i]},r.hcg.hwb=function(e){var t=e[1]/100,i=t+e[2]/100*(1-t);return[e[0],100*(i-t),100*(1-i)]},r.hwb.hcg=function(e){var t=e[1]/100,i=1-e[2]/100,r=i-t,s=0;return r<1&&(s=(i-r)/(1-r)),[e[0],100*r,100*s]},r.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},r.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},r.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},r.gray.hsl=r.gray.hsv=function(e){return[0,0,e[0]]},r.gray.hwb=function(e){return[0,100,e[0]]},r.gray.cmyk=function(e){return[0,0,0,e[0]]},r.gray.lab=function(e){return[e[0],0,0]},r.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),i=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(i.length)+i},r.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}}));function dp(e){var t=function(){for(var e={},t=Object.keys(pp),i=t.length,r=0;r<i;r++)e[t[r]]={distance:-1,parent:null};return e}(),i=[e];for(t[e].distance=0;i.length;)for(var r=i.pop(),s=Object.keys(pp[r]),n=s.length,o=0;o<n;o++){var a=s[o],l=t[a];-1===l.distance&&(l.distance=t[r].distance+1,l.parent=r,i.unshift(a))}return t}function fp(e,t){return function(i){return t(e(i))}}function yp(e,t){for(var i=[t[e].parent,e],r=pp[t[e].parent][e],s=t[e].parent;t[s].parent;)i.unshift(t[s].parent),r=fp(pp[t[s].parent][s],r),s=t[s].parent;return r.conversion=i,r}var gp={};Object.keys(pp).forEach((function(e){gp[e]={},Object.defineProperty(gp[e],"channels",{value:pp[e].channels}),Object.defineProperty(gp[e],"labels",{value:pp[e].labels});var t=function(e){for(var t=dp(e),i={},r=Object.keys(t),s=r.length,n=0;n<s;n++){var o=r[n];null!==t[o].parent&&(i[o]=yp(o,t))}return i}(e);Object.keys(t).forEach((function(i){var r=t[i];gp[e][i]=function(e){var t=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var i=e(t);if("object"==typeof i)for(var r=i.length,s=0;s<r;s++)i[s]=Math.round(i[s]);return i};return"conversion"in e&&(t.conversion=e.conversion),t}(r),gp[e][i].raw=function(e){var t=function(t){return null==t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(r)}))}));var mp=gp,vp=[].slice,bp=["keyword","gray","hex"],wp={};Object.keys(mp).forEach((function(e){wp[vp.call(mp[e].labels).sort().join("")]=e}));var _p={};function xp(e,t){if(!(this instanceof xp))return new xp(e,t);if(t&&t in bp&&(t=null),t&&!(t in mp))throw new Error("Unknown model: "+t);var i,r;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof xp)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var s=up.get(e);if(null===s)throw new Error("Unable to parse color from string: "+e);this.model=s.model,r=mp[this.model].channels,this.color=s.value.slice(0,r),this.valpha="number"==typeof s.value[r]?s.value[r]:1}else if(e.length){this.model=t||"rgb",r=mp[this.model].channels;var n=vp.call(e,0,r);this.color=Ip(n,r),this.valpha="number"==typeof e[r]?e[r]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var o=Object.keys(e);"alpha"in e&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var a=o.sort().join("");if(!(a in wp))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=wp[a];var l=mp[this.model].labels,h=[];for(i=0;i<l.length;i++)h.push(e[l[i]]);this.color=Ip(h)}if(_p[this.model])for(r=mp[this.model].channels,i=0;i<r;i++){var c=_p[this.model][i];c&&(this.color[i]=c(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function Sp(e,t,i){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(_p[e]||(_p[e]=[]))[t]=i})),e=e[0],function(r){var s;return arguments.length?(i&&(r=i(r)),(s=this[e]()).color[t]=r,s):(s=this[e]().color[t],i&&(s=i(s)),s)}}function Mp(e){return function(t){return Math.max(0,Math.min(e,t))}}function Tp(e){return Array.isArray(e)?e:[e]}function Ip(e,t){for(var i=0;i<t;i++)"number"!=typeof e[i]&&(e[i]=0);return e}xp.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var t=this.model in up.to?this:this.rgb(),i=1===(t=t.round("number"==typeof e?e:1)).valpha?t.color:t.color.concat(this.valpha);return up.to[t.model](i)},percentString:function(e){var t=this.rgb().round("number"==typeof e?e:1),i=1===t.valpha?t.color:t.color.concat(this.valpha);return up.to.rgb.percent(i)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},t=mp[this.model].channels,i=mp[this.model].labels,r=0;r<t;r++)e[i[r]]=this.color[r];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new xp(this.color.map(function(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new xp(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:Sp("rgb",0,Mp(255)),green:Sp("rgb",1,Mp(255)),blue:Sp("rgb",2,Mp(255)),hue:Sp(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:Sp("hsl",1,Mp(100)),lightness:Sp("hsl",2,Mp(100)),saturationv:Sp("hsv",1,Mp(100)),value:Sp("hsv",2,Mp(100)),chroma:Sp("hcg",1,Mp(100)),gray:Sp("hcg",2,Mp(100)),white:Sp("hwb",1,Mp(100)),wblack:Sp("hwb",2,Mp(100)),cyan:Sp("cmyk",0,Mp(100)),magenta:Sp("cmyk",1,Mp(100)),yellow:Sp("cmyk",2,Mp(100)),black:Sp("cmyk",3,Mp(100)),x:Sp("xyz",0,Mp(100)),y:Sp("xyz",1,Mp(100)),z:Sp("xyz",2,Mp(100)),l:Sp("lab",0,Mp(100)),a:Sp("lab",1),b:Sp("lab",2),keyword:function(e){return arguments.length?new xp(e):mp[this.model].keyword(this.color)},hex:function(e){return arguments.length?new xp(e):up.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,t=[],i=0;i<e.length;i++){var r=e[i]/255;t[i]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),i=e.luminosity();return t>i?(t+.05)/(i+.05):(i+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten:function(e){var t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken:function(e){var t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate:function(e){var t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate:function(e){var t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten:function(e){var t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken:function(e){var t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale:function(){var e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return xp.rgb(t,t,t)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var t=this.hsl(),i=t.color[0];return i=(i=(i+e)%360)<0?360+i:i,t.color[0]=i,t},mix:function(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var i=e.rgb(),r=this.rgb(),s=void 0===t?.5:t,n=2*s-1,o=i.alpha()-r.alpha(),a=((n*o==-1?n:(n+o)/(1+n*o))+1)/2,l=1-a;return xp.rgb(a*i.red()+l*r.red(),a*i.green()+l*r.green(),a*i.blue()+l*r.blue(),i.alpha()*s+r.alpha()*(1-s))}},Object.keys(mp).forEach((function(e){if(-1===bp.indexOf(e)){var t=mp[e].channels;xp.prototype[e]=function(){if(this.model===e)return new xp(this);if(arguments.length)return new xp(arguments,e);var i="number"==typeof arguments[t]?t:this.valpha;return new xp(Tp(mp[this.model][e].raw(this.color)).concat(i),e)},xp[e]=function(i){return"number"==typeof i&&(i=Ip(vp.call(arguments),t)),new xp(i,e)}}}));var Ep=xp;const Ap=Ep("#007AC2");var Pp="object"==typeof global&&global&&global.Object===Object&&global,Cp="object"==typeof self&&self&&self.Object===Object&&self,Op=Pp||Cp||Function("return this")(),kp=Op.Symbol,Lp=Object.prototype,Rp=Lp.hasOwnProperty,Dp=Lp.toString,Fp=kp?kp.toStringTag:void 0;var jp=Object.prototype.toString;var Np=kp?kp.toStringTag:void 0;function zp(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Np&&Np in Object(e)?function(e){var t=Rp.call(e,Fp),i=e[Fp];try{e[Fp]=void 0;var r=!0}catch(qe){}var s=Dp.call(e);return r&&(t?e[Fp]=i:delete e[Fp]),s}(e):function(e){return jp.call(e)}(e)}function Vp(e){return null!=e&&"object"==typeof e}var Up=kp?kp.prototype:void 0;Up&&Up.toString;function Gp(e){return Vp(e)&&"[object Arguments]"==zp(e)}var Bp=Object.prototype;Bp.hasOwnProperty,Bp.propertyIsEnumerable;Gp(function(){return arguments}());var qp="object"==typeof exports&&exports&&!exports.nodeType&&exports,Hp=qp&&"object"==typeof module&&module&&!module.nodeType&&module,Wp=Hp&&Hp.exports===qp?Op.Buffer:void 0;Wp&&Wp.isBuffer;var $p,Jp,Xp,Kp,Yp,Zp="object"==typeof exports&&exports&&!exports.nodeType&&exports,Qp=Zp&&"object"==typeof module&&module&&!module.nodeType&&module,ed=Qp&&Qp.exports===Zp&&Pp.process,td=function(){try{var e=Qp&&Qp.require&&Qp.require("util").types;return e||ed&&ed.binding&&ed.binding("util")}catch(qe){}}();
/**!
 * Sortable 1.13.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */
function id(e){return(id="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function sd(){return(sd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function nd(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),r.forEach((function(t){rd(e,t,i[t])}))}return e}function od(e,t){if(null==e)return{};var i,r,s=function(e,t){if(null==e)return{};var i,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||(s[i]=e[i]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}td&&td.isTypedArray,($p=($p=Ap.hex()).toLowerCase()).startsWith("#")||($p=`#${$p}`),ap($p)&&function(e){const{r:t,g:i,b:r}=e;`#${t.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}${r.toString(16).padStart(2,"0")}`.toLowerCase()}(function(e){if(!op(e))return null;if(3===(e=e.replace("#","")).length){const[t,i,r]=e.split("");return{r:parseInt(`${t}${t}`,16),g:parseInt(`${i}${i}`,16),b:parseInt(`${r}${r}`,16)}}const t=parseInt(e.slice(0,2),16),i=parseInt(e.slice(2,4),16),r=parseInt(e.slice(4,6),16);return{r:t,g:i,b:r}}($p)),Ep(),(Xp=Jp||(Jp={})).valid="check-circle",Xp.invalid="exclamation-mark-triangle",Xp.idle="information",(Yp=Kp||(Kp={})).circle="circle",Yp.square="square",Yp.grip="grip";function ad(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var ld=ad(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),hd=ad(/Edge/i),cd=ad(/firefox/i),ud=ad(/safari/i)&&!ad(/chrome/i)&&!ad(/android/i),pd=ad(/iP(ad|od|hone)/i),dd=ad(/chrome/i)&&ad(/android/i),fd={capture:!1,passive:!1};function yd(e,t,i){e.addEventListener(t,i,!ld&&fd)}function gd(e,t,i){e.removeEventListener(t,i,!ld&&fd)}function md(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(i){return!1}return!1}}function vd(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function bd(e,t,i,r){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&md(e,t):md(e,t))||r&&e===i)return e;if(e===i)break}while(e=vd(e))}return null}var wd,_d=/\s+/g;function xd(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(_d," ").replace(" "+t+" "," ");e.className=(r+(i?" "+t:"")).replace(_d," ")}}function Sd(e,t,i){var r=e&&e.style;if(r){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in r||-1!==t.indexOf("webkit")||(t="-webkit-"+t),r[t]=i+("string"==typeof i?"":"px")}}function Md(e,t){var i="";if("string"==typeof e)i=e;else do{var r=Sd(e,"transform");r&&"none"!==r&&(i=r+" "+i)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(i)}function Td(e,t,i){if(e){var r=e.getElementsByTagName(t),s=0,n=r.length;if(i)for(;s<n;s++)i(r[s],s);return r}return[]}function Id(){var e=document.scrollingElement;return e||document.documentElement}function Ed(e,t,i,r,s){if(e.getBoundingClientRect||e===window){var n,o,a,l,h,c,u;if(e!==window&&e.parentNode&&e!==Id()?(o=(n=e.getBoundingClientRect()).top,a=n.left,l=n.bottom,h=n.right,c=n.height,u=n.width):(o=0,a=0,l=window.innerHeight,h=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||i)&&e!==window&&(s=s||e.parentNode,!ld))do{if(s&&s.getBoundingClientRect&&("none"!==Sd(s,"transform")||i&&"static"!==Sd(s,"position"))){var p=s.getBoundingClientRect();o-=p.top+parseInt(Sd(s,"border-top-width")),a-=p.left+parseInt(Sd(s,"border-left-width")),l=o+n.height,h=a+n.width;break}}while(s=s.parentNode);if(r&&e!==window){var d=Md(s||e),f=d&&d.a,y=d&&d.d;d&&(l=(o/=y)+(c/=y),h=(a/=f)+(u/=f))}return{top:o,left:a,bottom:l,right:h,width:u,height:c}}}function Ad(e,t,i){for(var r=Ld(e,!0),s=Ed(e)[t];r;){var n=Ed(r)[i];if(!("top"===i||"left"===i?s>=n:s<=n))return r;if(r===Id())break;r=Ld(r,!1)}return!1}function Pd(e,t,i){for(var r=0,s=0,n=e.children;s<n.length;){if("none"!==n[s].style.display&&n[s]!==Ff.ghost&&n[s]!==Ff.dragged&&bd(n[s],i.draggable,e,!1)){if(r===t)return n[s];r++}s++}return null}function Cd(e,t){for(var i=e.lastElementChild;i&&(i===Ff.ghost||"none"===Sd(i,"display")||t&&!md(i,t));)i=i.previousElementSibling;return i||null}function Od(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Ff.clone||t&&!md(e,t)||i++;return i}function kd(e){var t=0,i=0,r=Id();if(e)do{var s=Md(e),n=s.a,o=s.d;t+=e.scrollLeft*n,i+=e.scrollTop*o}while(e!==r&&(e=e.parentNode));return[t,i]}function Ld(e,t){if(!e||!e.getBoundingClientRect)return Id();var i=e,r=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var s=Sd(i);if(i.clientWidth<i.scrollWidth&&("auto"==s.overflowX||"scroll"==s.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==s.overflowY||"scroll"==s.overflowY)){if(!i.getBoundingClientRect||i===document.body)return Id();if(r||t)return i;r=!0}}}while(i=i.parentNode);return Id()}function Rd(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function Dd(e,t){return function(){if(!wd){var i=arguments,r=this;1===i.length?e.call(r,i[0]):e.apply(r,i),wd=setTimeout((function(){wd=void 0}),t)}}}function Fd(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function jd(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var Nd="Sortable"+(new Date).getTime();function zd(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==Sd(e,"display")&&e!==Ff.ghost){t.push({target:e,rect:Ed(e)});var i=nd({},t[t.length-1].rect);if(e.thisAnimationDuration){var r=Md(e,!0);r&&(i.top-=r.f,i.left-=r.e)}e.fromRect=i}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var r in t)if(t.hasOwnProperty(r)&&t[r]===e[i][r])return Number(i);return-1}(t,{target:e}),1)},animateAll:function(i){var r=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof i&&i());var s=!1,n=0;t.forEach((function(e){var t=0,i=e.target,o=i.fromRect,a=Ed(i),l=i.prevFromRect,h=i.prevToRect,c=e.rect,u=Md(i,!0);u&&(a.top-=u.f,a.left-=u.e),i.toRect=a,i.thisAnimationDuration&&Rd(l,a)&&!Rd(o,a)&&(c.top-a.top)/(c.left-a.left)==(o.top-a.top)/(o.left-a.left)&&(t=function(e,t,i,r){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*r.animation}(c,l,h,r.options)),Rd(a,o)||(i.prevFromRect=o,i.prevToRect=a,t||(t=r.options.animation),r.animate(i,c,a,t)),t&&(s=!0,n=Math.max(n,t),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),t),i.thisAnimationDuration=t)})),clearTimeout(e),s?e=setTimeout((function(){"function"==typeof i&&i()}),n):"function"==typeof i&&i(),t=[]},animate:function(e,t,i,r){if(r){Sd(e,"transition",""),Sd(e,"transform","");var s=Md(this.el),n=s&&s.a,o=s&&s.d,a=(t.left-i.left)/(n||1),l=(t.top-i.top)/(o||1);e.animatingX=!!a,e.animatingY=!!l,Sd(e,"transform","translate3d("+a+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),Sd(e,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),Sd(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){Sd(e,"transition",""),Sd(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),r)}}}}var Vd=[],Ud={initializeByDefault:!0},Gd={mount:function(e){for(var t in Ud)Ud.hasOwnProperty(t)&&!(t in e)&&(e[t]=Ud[t]);Vd.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),Vd.push(e)},pluginEvent:function(e,t,i){var r=this;this.eventCanceled=!1,i.cancel=function(){r.eventCanceled=!0};var s=e+"Global";Vd.forEach((function(r){t[r.pluginName]&&(t[r.pluginName][s]&&t[r.pluginName][s](nd({sortable:t},i)),t.options[r.pluginName]&&t[r.pluginName][e]&&t[r.pluginName][e](nd({sortable:t},i)))}))},initializePlugins:function(e,t,i,r){for(var s in Vd.forEach((function(r){var s=r.pluginName;if(e.options[s]||r.initializeByDefault){var n=new r(e,t,e.options);n.sortable=e,n.options=e.options,e[s]=n,sd(i,n.defaults)}})),e.options)if(e.options.hasOwnProperty(s)){var n=this.modifyOption(e,s,e.options[s]);void 0!==n&&(e.options[s]=n)}},getEventProperties:function(e,t){var i={};return Vd.forEach((function(r){"function"==typeof r.eventProperties&&sd(i,r.eventProperties.call(t[r.pluginName],e))})),i},modifyOption:function(e,t,i){var r;return Vd.forEach((function(s){e[s.pluginName]&&s.optionListeners&&"function"==typeof s.optionListeners[t]&&(r=s.optionListeners[t].call(e[s.pluginName],i))})),r}};var Bd=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.evt,s=od(i,["evt"]);Gd.pluginEvent.bind(Ff)(e,t,nd({dragEl:Hd,parentEl:Wd,ghostEl:$d,rootEl:Jd,nextEl:Xd,lastDownEl:Kd,cloneEl:Yd,cloneHidden:Zd,dragStarted:pf,putSortable:nf,activeSortable:Ff.active,originalEvent:r,oldIndex:Qd,oldDraggableIndex:tf,newIndex:ef,newDraggableIndex:rf,hideGhostForTarget:kf,unhideGhostForTarget:Lf,cloneNowHidden:function(){Zd=!0},cloneNowShown:function(){Zd=!1},dispatchSortableEvent:function(e){qd({sortable:t,name:e,originalEvent:r})}},s))};function qd(e){!function(e){var t=e.sortable,i=e.rootEl,r=e.name,s=e.targetEl,n=e.cloneEl,o=e.toEl,a=e.fromEl,l=e.oldIndex,h=e.newIndex,c=e.oldDraggableIndex,u=e.newDraggableIndex,p=e.originalEvent,d=e.putSortable,f=e.extraEventProperties;if(t=t||i&&i[Nd]){var y,g=t.options,m="on"+r.charAt(0).toUpperCase()+r.substr(1);!window.CustomEvent||ld||hd?(y=document.createEvent("Event")).initEvent(r,!0,!0):y=new CustomEvent(r,{bubbles:!0,cancelable:!0}),y.to=o||i,y.from=a||i,y.item=s||i,y.clone=n,y.oldIndex=l,y.newIndex=h,y.oldDraggableIndex=c,y.newDraggableIndex=u,y.originalEvent=p,y.pullMode=d?d.lastPutMode:void 0;var v=nd({},f,Gd.getEventProperties(r,t));for(var b in v)y[b]=v[b];i&&i.dispatchEvent(y),g[m]&&g[m].call(t,y)}}(nd({putSortable:nf,cloneEl:Yd,targetEl:Hd,rootEl:Jd,oldIndex:Qd,oldDraggableIndex:tf,newIndex:ef,newDraggableIndex:rf},e))}var Hd,Wd,$d,Jd,Xd,Kd,Yd,Zd,Qd,ef,tf,rf,sf,nf,of,af,lf,hf,cf,uf,pf,df,ff,yf,gf,mf=!1,vf=!1,bf=[],wf=!1,_f=!1,xf=[],Sf=!1,Mf=[],Tf="undefined"!=typeof document,If=pd,Ef=hd||ld?"cssFloat":"float",Af=Tf&&!dd&&!pd&&"draggable"in document.createElement("div"),Pf=function(){if(Tf){if(ld)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Cf=function(e,t){var i=Sd(e),r=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),s=Pd(e,0,t),n=Pd(e,1,t),o=s&&Sd(s),a=n&&Sd(n),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+Ed(s).width,h=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+Ed(n).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&o.float&&"none"!==o.float){var c="left"===o.float?"left":"right";return!n||"both"!==a.clear&&a.clear!==c?"horizontal":"vertical"}return s&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=r&&"none"===i[Ef]||n&&"none"===i[Ef]&&l+h>r)?"vertical":"horizontal"},Of=function(e){function t(e,i){return function(r,s,n,o){var a=r.options.group.name&&s.options.group.name&&r.options.group.name===s.options.group.name;if(null==e&&(i||a))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(r,s,n,o),i)(r,s,n,o);var l=(i?r:s).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var i={},r=e.group;r&&"object"==id(r)||(r={name:r}),i.name=r.name,i.checkPull=t(r.pull,!0),i.checkPut=t(r.put),i.revertClone=r.revertClone,e.group=i},kf=function(){!Pf&&$d&&Sd($d,"display","none")},Lf=function(){!Pf&&$d&&Sd($d,"display","")};Tf&&document.addEventListener("click",(function(e){if(vf)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),vf=!1,!1}),!0);var Rf=function(e){if(Hd){e=e.touches?e.touches[0]:e;var t=(s=e.clientX,n=e.clientY,bf.some((function(e){if(!Cd(e)){var t=Ed(e),i=e[Nd].options.emptyInsertThreshold,r=s>=t.left-i&&s<=t.right+i,a=n>=t.top-i&&n<=t.bottom+i;return i&&r&&a?o=e:void 0}})),o);if(t){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[Nd]._onDragOver(i)}}var s,n,o},Df=function(e){Hd&&Hd.parentNode[Nd]._isOutsideThisEl(e.target)};function Ff(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=sd({},t),e[Nd]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Cf(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Ff.supportPointer&&"PointerEvent"in window&&!ud,emptyInsertThreshold:5};for(var r in Gd.initializePlugins(this,e,i),i)!(r in t)&&(t[r]=i[r]);for(var s in Of(t),this)"_"===s.charAt(0)&&"function"==typeof this[s]&&(this[s]=this[s].bind(this));this.nativeDraggable=!t.forceFallback&&Af,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?yd(e,"pointerdown",this._onTapStart):(yd(e,"mousedown",this._onTapStart),yd(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(yd(e,"dragover",this),yd(e,"dragenter",this)),bf.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),sd(this,zd())}function jf(e,t,i,r,s,n,o,a){var l,h,c=e[Nd],u=c.options.onMove;return!window.CustomEvent||ld||hd?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=i,l.draggedRect=r,l.related=s||t,l.relatedRect=n||Ed(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),u&&(h=u.call(c,l,o)),h}function Nf(e){e.draggable=!1}function zf(){Sf=!1}function Vf(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,r=0;i--;)r+=t.charCodeAt(i);return r.toString(36)}function Uf(e){return setTimeout(e,0)}function Gf(e){return clearTimeout(e)}Ff.prototype={constructor:Ff,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(df=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,Hd):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,r=this.options,s=r.preventOnFilter,n=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,h=r.filter;if(function(e){Mf.length=0;var t=e.getElementsByTagName("input"),i=t.length;for(;i--;){var r=t[i];r.checked&&Mf.push(r)}}(i),!Hd&&!(/mousedown|pointerdown/.test(n)&&0!==e.button||r.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!ud||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=bd(a,r.draggable,i,!1))&&a.animated||Kd===a)){if(Qd=Od(a),tf=Od(a,r.draggable),"function"==typeof h){if(h.call(this,e,a,this))return qd({sortable:t,rootEl:l,name:"filter",targetEl:a,toEl:i,fromEl:i}),Bd("filter",t,{evt:e}),void(s&&e.cancelable&&e.preventDefault())}else if(h&&(h=h.split(",").some((function(r){if(r=bd(l,r.trim(),i,!1))return qd({sortable:t,rootEl:r,name:"filter",targetEl:a,fromEl:i,toEl:i}),Bd("filter",t,{evt:e}),!0}))))return void(s&&e.cancelable&&e.preventDefault());r.handle&&!bd(l,r.handle,i,!1)||this._prepareDragStart(e,o,a)}}},_prepareDragStart:function(e,t,i){var r,s=this,n=s.el,o=s.options,a=n.ownerDocument;if(i&&!Hd&&i.parentNode===n){var l=Ed(i);if(Jd=n,Wd=(Hd=i).parentNode,Xd=Hd.nextSibling,Kd=i,sf=o.group,Ff.dragged=Hd,of={target:Hd,clientX:(t||e).clientX,clientY:(t||e).clientY},cf=of.clientX-l.left,uf=of.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,Hd.style["will-change"]="all",r=function(){Bd("delayEnded",s,{evt:e}),Ff.eventCanceled?s._onDrop():(s._disableDelayedDragEvents(),!cd&&s.nativeDraggable&&(Hd.draggable=!0),s._triggerDragStart(e,t),qd({sortable:s,name:"choose",originalEvent:e}),xd(Hd,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){Td(Hd,e.trim(),Nf)})),yd(a,"dragover",Rf),yd(a,"mousemove",Rf),yd(a,"touchmove",Rf),yd(a,"mouseup",s._onDrop),yd(a,"touchend",s._onDrop),yd(a,"touchcancel",s._onDrop),cd&&this.nativeDraggable&&(this.options.touchStartThreshold=4,Hd.draggable=!0),Bd("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(hd||ld))r();else{if(Ff.eventCanceled)return void this._onDrop();yd(a,"mouseup",s._disableDelayedDrag),yd(a,"touchend",s._disableDelayedDrag),yd(a,"touchcancel",s._disableDelayedDrag),yd(a,"mousemove",s._delayedDragTouchMoveHandler),yd(a,"touchmove",s._delayedDragTouchMoveHandler),o.supportPointer&&yd(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(r,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){Hd&&Nf(Hd),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;gd(e,"mouseup",this._disableDelayedDrag),gd(e,"touchend",this._disableDelayedDrag),gd(e,"touchcancel",this._disableDelayedDrag),gd(e,"mousemove",this._delayedDragTouchMoveHandler),gd(e,"touchmove",this._delayedDragTouchMoveHandler),gd(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?yd(document,"pointermove",this._onTouchMove):yd(document,t?"touchmove":"mousemove",this._onTouchMove):(yd(Hd,"dragend",this),yd(Jd,"dragstart",this._onDragStart));try{document.selection?Uf((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(i){}},_dragStarted:function(e,t){if(mf=!1,Jd&&Hd){Bd("dragStarted",this,{evt:t}),this.nativeDraggable&&yd(document,"dragover",Df);var i=this.options;!e&&xd(Hd,i.dragClass,!1),xd(Hd,i.ghostClass,!0),Ff.active=this,e&&this._appendGhost(),qd({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(af){this._lastX=af.clientX,this._lastY=af.clientY,kf();for(var e=document.elementFromPoint(af.clientX,af.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(af.clientX,af.clientY))!==t;)t=e;if(Hd.parentNode[Nd]._isOutsideThisEl(e),t)do{if(t[Nd]){if(t[Nd]._onDragOver({clientX:af.clientX,clientY:af.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);Lf()}},_onTouchMove:function(e){if(of){var t=this.options,i=t.fallbackTolerance,r=t.fallbackOffset,s=e.touches?e.touches[0]:e,n=$d&&Md($d,!0),o=$d&&n&&n.a,a=$d&&n&&n.d,l=If&&gf&&kd(gf),h=(s.clientX-of.clientX+r.x)/(o||1)+(l?l[0]-xf[0]:0)/(o||1),c=(s.clientY-of.clientY+r.y)/(a||1)+(l?l[1]-xf[1]:0)/(a||1);if(!Ff.active&&!mf){if(i&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if($d){n?(n.e+=h-(lf||0),n.f+=c-(hf||0)):n={a:1,b:0,c:0,d:1,e:h,f:c};var u="matrix(".concat(n.a,",").concat(n.b,",").concat(n.c,",").concat(n.d,",").concat(n.e,",").concat(n.f,")");Sd($d,"webkitTransform",u),Sd($d,"mozTransform",u),Sd($d,"msTransform",u),Sd($d,"transform",u),lf=h,hf=c,af=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!$d){var e=this.options.fallbackOnBody?document.body:Jd,t=Ed(Hd,!0,If,!0,e),i=this.options;if(If){for(gf=e;"static"===Sd(gf,"position")&&"none"===Sd(gf,"transform")&&gf!==document;)gf=gf.parentNode;gf!==document.body&&gf!==document.documentElement?(gf===document&&(gf=Id()),t.top+=gf.scrollTop,t.left+=gf.scrollLeft):gf=Id(),xf=kd(gf)}xd($d=Hd.cloneNode(!0),i.ghostClass,!1),xd($d,i.fallbackClass,!0),xd($d,i.dragClass,!0),Sd($d,"transition",""),Sd($d,"transform",""),Sd($d,"box-sizing","border-box"),Sd($d,"margin",0),Sd($d,"top",t.top),Sd($d,"left",t.left),Sd($d,"width",t.width),Sd($d,"height",t.height),Sd($d,"opacity","0.8"),Sd($d,"position",If?"absolute":"fixed"),Sd($d,"zIndex","100000"),Sd($d,"pointerEvents","none"),Ff.ghost=$d,e.appendChild($d),Sd($d,"transform-origin",cf/parseInt($d.style.width)*100+"% "+uf/parseInt($d.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,r=e.dataTransfer,s=i.options;Bd("dragStart",this,{evt:e}),Ff.eventCanceled?this._onDrop():(Bd("setupClone",this),Ff.eventCanceled||((Yd=jd(Hd)).draggable=!1,Yd.style["will-change"]="",this._hideClone(),xd(Yd,this.options.chosenClass,!1),Ff.clone=Yd),i.cloneId=Uf((function(){Bd("clone",i),Ff.eventCanceled||(i.options.removeCloneOnHide||Jd.insertBefore(Yd,Hd),i._hideClone(),qd({sortable:i,name:"clone"}))})),!t&&xd(Hd,s.dragClass,!0),t?(vf=!0,i._loopId=setInterval(i._emulateDragOver,50)):(gd(document,"mouseup",i._onDrop),gd(document,"touchend",i._onDrop),gd(document,"touchcancel",i._onDrop),r&&(r.effectAllowed="move",s.setData&&s.setData.call(i,r,Hd)),yd(document,"drop",i),Sd(Hd,"transform","translateZ(0)")),mf=!0,i._dragStartId=Uf(i._dragStarted.bind(i,t,e)),yd(document,"selectstart",i),pf=!0,ud&&Sd(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,r,s,n=this.el,o=e.target,a=this.options,l=a.group,h=Ff.active,c=sf===l,u=a.sort,p=nf||h,d=this,f=!1;if(!Sf){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=bd(o,a.draggable,n,!0),A("dragOver"),Ff.eventCanceled)return f;if(Hd.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||d._ignoreWhileAnimating===o)return C(!1);if(vf=!1,h&&!a.disabled&&(c?u||(r=!Jd.contains(Hd)):nf===this||(this.lastPutMode=sf.checkPull(this,h,Hd,e))&&l.checkPut(this,h,Hd,e))){if(s="vertical"===this._getDirection(e,o),t=Ed(Hd),A("dragOverValid"),Ff.eventCanceled)return f;if(r)return Wd=Jd,P(),this._hideClone(),A("revert"),Ff.eventCanceled||(Xd?Jd.insertBefore(Hd,Xd):Jd.appendChild(Hd)),C(!0);var y=Cd(n,a.draggable);if(!y||function(e,t,i){var r=Ed(Cd(i.el,i.options.draggable)),s=10;return t?e.clientX>r.right+s||e.clientX<=r.right&&e.clientY>r.bottom&&e.clientX>=r.left:e.clientX>r.right&&e.clientY>r.top||e.clientX<=r.right&&e.clientY>r.bottom+s}(e,s,this)&&!y.animated){if(y===Hd)return C(!1);if(y&&n===e.target&&(o=y),o&&(i=Ed(o)),!1!==jf(Jd,n,Hd,t,o,i,e,!!o))return P(),n.appendChild(Hd),Wd=n,O(),C(!0)}else if(o.parentNode===n){i=Ed(o);var g,m,v,b=Hd.parentNode!==n,w=!function(e,t,i){var r=i?e.left:e.top,s=i?e.right:e.bottom,n=i?e.width:e.height,o=i?t.left:t.top,a=i?t.right:t.bottom,l=i?t.width:t.height;return r===o||s===a||r+n/2===o+l/2}(Hd.animated&&Hd.toRect||t,o.animated&&o.toRect||i,s),_=s?"top":"left",x=Ad(o,"top","top")||Ad(Hd,"top","top"),S=x?x.scrollTop:void 0;if(df!==o&&(m=i[_],wf=!1,_f=!w&&a.invertSwap||b),0!==(g=function(e,t,i,r,s,n,o,a){var l=r?e.clientY:e.clientX,h=r?i.height:i.width,c=r?i.top:i.left,u=r?i.bottom:i.right,p=!1;if(!o)if(a&&yf<h*s){if(!wf&&(1===ff?l>c+h*n/2:l<u-h*n/2)&&(wf=!0),wf)p=!0;else if(1===ff?l<c+yf:l>u-yf)return-ff}else if(l>c+h*(1-s)/2&&l<u-h*(1-s)/2)return function(e){return Od(Hd)<Od(e)?1:-1}(t);if((p=p||o)&&(l<c+h*n/2||l>u-h*n/2))return l>c+h/2?1:-1;return 0}(e,o,i,s,w?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,_f,df===o))){var M=Od(Hd);do{M-=g,v=Wd.children[M]}while(v&&("none"===Sd(v,"display")||v===$d))}if(0===g||v===o)return C(!1);df=o,ff=g;var T=o.nextElementSibling,I=!1,E=jf(Jd,n,Hd,t,o,i,e,I=1===g);if(!1!==E)return 1!==E&&-1!==E||(I=1===E),Sf=!0,setTimeout(zf,30),P(),I&&!T?n.appendChild(Hd):o.parentNode.insertBefore(Hd,I?T:o),x&&Fd(x,0,S-x.scrollTop),Wd=Hd.parentNode,void 0===m||_f||(yf=Math.abs(m-Ed(o)[_])),O(),C(!0)}if(n.contains(Hd))return C(!1)}return!1}function A(a,l){Bd(a,d,nd({evt:e,isOwner:c,axis:s?"vertical":"horizontal",revert:r,dragRect:t,targetRect:i,canSort:u,fromSortable:p,target:o,completed:C,onMove:function(i,r){return jf(Jd,n,Hd,t,i,Ed(i),e,r)},changed:O},l))}function P(){A("dragOverAnimationCapture"),d.captureAnimationState(),d!==p&&p.captureAnimationState()}function C(t){return A("dragOverCompleted",{insertion:t}),t&&(c?h._hideClone():h._showClone(d),d!==p&&(xd(Hd,nf?nf.options.ghostClass:h.options.ghostClass,!1),xd(Hd,a.ghostClass,!0)),nf!==d&&d!==Ff.active?nf=d:d===Ff.active&&nf&&(nf=null),p===d&&(d._ignoreWhileAnimating=o),d.animateAll((function(){A("dragOverAnimationComplete"),d._ignoreWhileAnimating=null})),d!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(o===Hd&&!Hd.animated||o===n&&!o.animated)&&(df=null),a.dragoverBubble||e.rootEl||o===document||(Hd.parentNode[Nd]._isOutsideThisEl(e.target),!t&&Rf(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),f=!0}function O(){ef=Od(Hd),rf=Od(Hd,a.draggable),qd({sortable:d,name:"change",toEl:n,newIndex:ef,newDraggableIndex:rf,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){gd(document,"mousemove",this._onTouchMove),gd(document,"touchmove",this._onTouchMove),gd(document,"pointermove",this._onTouchMove),gd(document,"dragover",Rf),gd(document,"mousemove",Rf),gd(document,"touchmove",Rf)},_offUpEvents:function(){var e=this.el.ownerDocument;gd(e,"mouseup",this._onDrop),gd(e,"touchend",this._onDrop),gd(e,"pointerup",this._onDrop),gd(e,"touchcancel",this._onDrop),gd(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;ef=Od(Hd),rf=Od(Hd,i.draggable),Bd("drop",this,{evt:e}),Wd=Hd&&Hd.parentNode,ef=Od(Hd),rf=Od(Hd,i.draggable),Ff.eventCanceled||(mf=!1,_f=!1,wf=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Gf(this.cloneId),Gf(this._dragStartId),this.nativeDraggable&&(gd(document,"drop",this),gd(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ud&&Sd(document.body,"user-select",""),Sd(Hd,"transform",""),e&&(pf&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),$d&&$d.parentNode&&$d.parentNode.removeChild($d),(Jd===Wd||nf&&"clone"!==nf.lastPutMode)&&Yd&&Yd.parentNode&&Yd.parentNode.removeChild(Yd),Hd&&(this.nativeDraggable&&gd(Hd,"dragend",this),Nf(Hd),Hd.style["will-change"]="",pf&&!mf&&xd(Hd,nf?nf.options.ghostClass:this.options.ghostClass,!1),xd(Hd,this.options.chosenClass,!1),qd({sortable:this,name:"unchoose",toEl:Wd,newIndex:null,newDraggableIndex:null,originalEvent:e}),Jd!==Wd?(ef>=0&&(qd({rootEl:Wd,name:"add",toEl:Wd,fromEl:Jd,originalEvent:e}),qd({sortable:this,name:"remove",toEl:Wd,originalEvent:e}),qd({rootEl:Wd,name:"sort",toEl:Wd,fromEl:Jd,originalEvent:e}),qd({sortable:this,name:"sort",toEl:Wd,originalEvent:e})),nf&&nf.save()):ef!==Qd&&ef>=0&&(qd({sortable:this,name:"update",toEl:Wd,originalEvent:e}),qd({sortable:this,name:"sort",toEl:Wd,originalEvent:e})),Ff.active&&(null!=ef&&-1!==ef||(ef=Qd,rf=tf),qd({sortable:this,name:"end",toEl:Wd,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){Bd("nulling",this),Jd=Hd=Wd=$d=Xd=Yd=Kd=Zd=of=af=pf=ef=rf=Qd=tf=df=ff=nf=sf=Ff.dragged=Ff.ghost=Ff.clone=Ff.active=null,Mf.forEach((function(e){e.checked=!0})),Mf.length=lf=hf=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":Hd&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,r=0,s=i.length,n=this.options;r<s;r++)bd(e=i[r],n.draggable,this.el,!1)&&t.push(e.getAttribute(n.dataIdAttr)||Vf(e));return t},sort:function(e,t){var i={},r=this.el;this.toArray().forEach((function(e,t){var s=r.children[t];bd(s,this.options.draggable,r,!1)&&(i[e]=s)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(r.removeChild(i[e]),r.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return bd(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var r=Gd.modifyOption(this,e,t);i[e]=void 0!==r?r:t,"group"===e&&Of(i)},destroy:function(){Bd("destroy",this);var e=this.el;e[Nd]=null,gd(e,"mousedown",this._onTapStart),gd(e,"touchstart",this._onTapStart),gd(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(gd(e,"dragover",this),gd(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),bf.splice(bf.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Zd){if(Bd("hideClone",this),Ff.eventCanceled)return;Sd(Yd,"display","none"),this.options.removeCloneOnHide&&Yd.parentNode&&Yd.parentNode.removeChild(Yd),Zd=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Zd){if(Bd("showClone",this),Ff.eventCanceled)return;Hd.parentNode!=Jd||this.options.group.revertClone?Xd?Jd.insertBefore(Yd,Xd):Jd.appendChild(Yd):Jd.insertBefore(Yd,Hd),this.options.group.revertClone&&this.animate(Hd,Yd),Sd(Yd,"display",""),Zd=!1}}else this._hideClone()}},Tf&&yd(document,"touchmove",(function(e){(Ff.active||mf)&&e.cancelable&&e.preventDefault()})),Ff.utils={on:yd,off:gd,css:Sd,find:Td,is:function(e,t){return!!bd(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:Dd,closest:bd,toggleClass:xd,clone:jd,index:Od,nextTick:Uf,cancelNextTick:Gf,detectDirection:Cf,getChild:Pd},Ff.get=function(e){return e[Nd]},Ff.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Ff.utils=nd({},Ff.utils,e.utils)),Gd.mount(e)}))},Ff.create=function(e,t){return new Ff(e,t)},Ff.version="1.13.0";var Bf,qf,Hf,Wf,$f,Jf,Xf=[],Kf=!1;function Yf(){Xf.forEach((function(e){clearInterval(e.pid)})),Xf=[]}function Zf(){clearInterval(Jf)}var Qf=Dd((function(e,t,i,r){if(t.scroll){var s,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,l=t.scrollSpeed,h=Id(),c=!1;qf!==i&&(qf=i,Yf(),Bf=t.scroll,s=t.scrollFn,!0===Bf&&(Bf=Ld(i,!0)));var u=0,p=Bf;do{var d=p,f=Ed(d),y=f.top,g=f.bottom,m=f.left,v=f.right,b=f.width,w=f.height,_=void 0,x=void 0,S=d.scrollWidth,M=d.scrollHeight,T=Sd(d),I=d.scrollLeft,E=d.scrollTop;d===h?(_=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),x=w<M&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(_=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX),x=w<M&&("auto"===T.overflowY||"scroll"===T.overflowY));var A=_&&(Math.abs(v-n)<=a&&I+b<S)-(Math.abs(m-n)<=a&&!!I),P=x&&(Math.abs(g-o)<=a&&E+w<M)-(Math.abs(y-o)<=a&&!!E);if(!Xf[u])for(var C=0;C<=u;C++)Xf[C]||(Xf[C]={});Xf[u].vx==A&&Xf[u].vy==P&&Xf[u].el===d||(Xf[u].el=d,Xf[u].vx=A,Xf[u].vy=P,clearInterval(Xf[u].pid),0==A&&0==P||(c=!0,Xf[u].pid=setInterval(function(){r&&0===this.layer&&Ff.active._onTouchMove($f);var t=Xf[this.layer].vy?Xf[this.layer].vy*l:0,i=Xf[this.layer].vx?Xf[this.layer].vx*l:0;"function"==typeof s&&"continue"!==s.call(Ff.dragged.parentNode[Nd],i,t,e,$f,Xf[this.layer].el)||Fd(Xf[this.layer].el,i,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==h&&(p=Ld(p,!1)));Kf=c}}),30),ey=function(e){var t=e.originalEvent,i=e.putSortable,r=e.dragEl,s=e.activeSortable,n=e.dispatchSortableEvent,o=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var l=i||s;o();var h=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,c=document.elementFromPoint(h.clientX,h.clientY);a(),l&&!l.el.contains(c)&&(n("spill"),this.onSpill({dragEl:r,putSortable:i}))}};function ty(){}function iy(){}ty.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var r=Pd(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:ey},sd(ty,{pluginName:"revertOnSpill"}),iy.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:ey},sd(iy,{pluginName:"removeOnSpill"}),Ff.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?yd(document,"dragover",this._handleAutoScroll):this.options.supportPointer?yd(document,"pointermove",this._handleFallbackAutoScroll):t.touches?yd(document,"touchmove",this._handleFallbackAutoScroll):yd(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?gd(document,"dragover",this._handleAutoScroll):(gd(document,"pointermove",this._handleFallbackAutoScroll),gd(document,"touchmove",this._handleFallbackAutoScroll),gd(document,"mousemove",this._handleFallbackAutoScroll)),Zf(),Yf(),clearTimeout(wd),wd=void 0},nulling:function(){$f=qf=Bf=Kf=Jf=Hf=Wf=null,Xf.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,r=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,n=document.elementFromPoint(r,s);if($f=e,t||hd||ld||ud){Qf(e,this.options,n,t);var o=Ld(n,!0);!Kf||Jf&&r===Hf&&s===Wf||(Jf&&Zf(),Jf=setInterval((function(){var n=Ld(document.elementFromPoint(r,s),!0);n!==o&&(o=n,Yf()),Qf(e,i.options,n,t)}),10),Hf=r,Wf=s)}else{if(!this.options.bubbleScroll||Ld(n,!0)===Id())return void Yf();Qf(e,this.options,Ld(n,!1),!1)}}},sd(e,{pluginName:"scroll",initializeByDefault:!0})}),Ff.mount(iy,ty);var ry,sy,ny;let oy;JSON.stringify({display:"flex",flexDirection:"column",flexWrap:"wrap",width:"100%",minWidth:"100%"}).replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/[,]/g,";").replace(/["{}]/g,"").toLowerCase(),(sy=ry||(ry={})).Single="single",sy.Multi="multi",sy.Children="children",sy.MultiChildren="multi-children",sy.Ancestors="ancestors",(ny||(ny={})).grip="grip",oy="components/assets";const ay=Symbol("widget"),ly=new WeakMap;function hy(e,t){const i=t.vnodeSelector;if(dy(i)){const r=t.properties||{},s=r.key||i;return{vnodeSelector:"div",properties:{parentWidget:e,widgetConstructor:i,key:s,widgetProps:l(a({},r),{key:s}),afterCreate:cy,afterUpdate:uy,afterRemoved:py},children:void 0,text:void 0,domNode:null}}const r=t.children;if(r)for(let s=0;s<r.length;++s)r[s]=hy(e,r[s]);return t}function cy(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProps:n}){const o=new s(l(a({},n),{container:e}));ly.set(e,o),null==o.afterCreate||o.afterCreate(o,e),r._internalHandles.add(xr((()=>py(e))))}function uy(e,t,i,{widgetProps:r}){const s=ly.get(e);s&&(s.set(r),null==s.afterUpdate||s.afterUpdate(s,e))}function py(e){const t=ly.get(e);t&&(t.destroy(),ly.delete(e))}function dy(e){return"function"==typeof e&&e[ay]}const fy="esri.widgets.Widget",yy=Ne.getLogger(fy);let gy=0;const my="esri-icon-checkbox-unchecked";function vy(e,t){for(const i in t)null!=e[i]&&("object"==typeof e[i]&&"object"==typeof t[i]?vy(e[i],t[i]):e[i]=t[i]);return e}const by=(e=>{let t;const i=a(a({},Zu),e),r=(n=i,a(a({},Qu),n)),s=r.performanceLogger;var n;let o,l=!0,h=!1;const c=[],u=[],p=(e,n,o)=>{let a;r.eventHandlerInterceptor=(e,r,n,o)=>function(e){let r;s("domEvent",e);const n=((e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i})(e.currentTarget,a.domNode),o=n.some((e=>{var t;return customElements.get(null==e||null==(t=e.tagName)?void 0:t.toLowerCase())}));if(e.eventPhase!==Event.CAPTURING_PHASE&&o){const t=e.composedPath(),i=t.slice(t.indexOf(e.currentTarget),t.indexOf(a.domNode)).filter((e=>e.getRootNode()===e.ownerDocument)).reverse();r=ep(a.getLastRender(),i,!0)}else n.reverse(),r=ep(a.getLastRender(),n);let l;return r&&(l=i.handleInterceptedEvent(t,r,this,e)),s("domEventProcessed",e),l},null==i.postProcessProjectionOptions||i.postProcessProjectionOptions(r);const l=o();a=e(n,l,r),c.push(a),u.push(o),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(a,l)};let d=()=>{if(o=void 0,l){l=!1,s("renderStart",void 0);for(let e=0;e<c.length;e++){const t=u[e]();s("rendered",void 0),c[e].update(t),s("patched",void 0)}s("renderDone",void 0),l=!0}};return i.modifyDoRenderImplementation&&(d=i.modifyDoRenderImplementation(d,c,u)),t={renderNow:d,scheduleRender:()=>{o||h||(o=requestAnimationFrame(d))},stop:()=>{o&&(cancelAnimationFrame(o),o=void 0),h=!0},resume:()=>{h=!1,l=!0,t.scheduleRender()},append:(e,t)=>{p(qu,e,t)},insertBefore:(e,t)=>{p(Hu,e,t)},merge:(e,t)=>{p(Wu,e,t)},replace:(e,t)=>{p($u,e,t)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),c.splice(t,1)[0];throw new Error("renderFunction was not found")}},t})({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(e,r,s,n)=>{const o=t(e,r,s,n),a=i.test(e);if(!((e=e.replace(i,"")).toLowerCase()in s)||a){const t=e[2].toLowerCase()+e.slice(3),i=e=>o.call(s,e);s.addEventListener(t,i,a);const r=()=>s.removeEventListener(t,i,a),l=n.afterRemoved;n.afterRemoved=e=>{null==l||l(e),r()}}return o}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(e.scheduleRender(),l[a].call(l.bind||i,r))}});let wy=!1,_y=class extends(Zo(sh.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new Mh,this._projector=by,this.domNode=null,this.iconClass=my,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=wt((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const e=await pt(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{let i=await Pt(e);this.localeStrings&&Object.keys(this.localeStrings)&&(i=vy(H(i),this.localeStrings)),this[t]=i})));for(const t of e)t.error&&yy.error("widget-intl:locale-error",this.declaredClass,t.error)}await this.loadLocale()})),ai(gr(oy));const i=mu()||"light";["light","dark"].includes(i)||wr(yy,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const r="esri-widget-uid-"+Th(),s=this.render.bind(this);let n=!1;this._trackingTarget=new cn((()=>this.scheduleRender()));const o=()=>{var e;if(!n||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:r,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const t=s();let{properties:i}=t;i||(t.properties=i={});let{key:o,styles:a}=i;o||(i.key=r),a||(i.styles=a={}),a.display||(a.display="");let l=0;return null==(e=t.children)||e.forEach((e=>{if(dy(e.vnodeSelector))return;let{properties:t}=e;t||(e.properties=t={}),t.key||(t.key=`${this.id}--${l++}`)})),hy(this,t)};this.render=()=>{if(wy)return o();let e;this._trackingTarget.clear(),wy=!0;try{e=Xr(this._trackingTarget,o)}finally{wy=!1}return e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{n=!0,this._postInitialize()})))}normalizeCtorArgs(e,t){const i=a({},e);return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return this._loadLocale().catch(nt)}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget.destroy(),this._trackingTarget=null,this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return nh(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+gy++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector,handles:this._internalHandles}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return lu.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),null!=(e=this._delegatedEventNames)&&e.length&&this._internalHandles.add(Rh(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize();const t=async()=>{await this._loadLocale().catch(nt),this.scheduleRender()};this._internalHandles.add([ce(t),this.watch("localeStrings",t),jh(this,"container",(async e=>{this.destroyed||this._attach(e)}))])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};_y[ay]=!0,Q([ro({value:null})],_y.prototype,"container",null),Q([Ra("container")],_y.prototype,"castContainer",null),Q([ro({aliasOf:"container"})],_y.prototype,"domNode",void 0),Q([ro()],_y.prototype,"iconClass",void 0),Q([ro()],_y.prototype,"id",null),Q([ro()],_y.prototype,"label",void 0),Q([ro()],_y.prototype,"localeStrings",void 0),Q([ro()],_y.prototype,"renderable",null),Q([ro()],_y.prototype,"viewModel",void 0),Q([ro()],_y.prototype,"visible",void 0),Q([ro()],_y.prototype,"key",void 0),Q([ro()],_y.prototype,"afterCreate",void 0),Q([ro()],_y.prototype,"afterUpdate",void 0),Q([ro()],_y.prototype,"afterRemoved",void 0),_y=Q([Ro(fy)],_y);var xy=_y;function Sy(e){return function(t,i){t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var My=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},Ty=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?Ty(s,t):null!=s&&!1!==s&&(s.hasOwnProperty("vnodeSelector")||(s=My(s)),t.push(s))}};function Iy(e,t,...i){return"function"!=typeof e||dy(e)?function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(1===i.length&&"string"==typeof i[0])return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return Ty(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}}(e,t,...i):e(t,...i)}const Ey="esri-identity-form",Ay="esri-identity-form__group",Py="esri-identity-form__label",Cy="esri-identity-form__footer",Oy="esri-input",ky="esri-button",Ly="esri-button--secondary";let Ry=class extends xy{constructor(e,t){super(e,t),this._usernameInputNode=null,this._passwordInputNode=null,this.messages=null,this.signingIn=!1,this.server=null,this.resource=null,this.error=null,this.oAuthPrompt=!1}render(){const{error:e,server:t,resource:i,signingIn:r,oAuthPrompt:s,messages:n}=this,o=Iy("div",{class:Ay},Ve(s?n.oAuthInfo:n.info,{server:/\.arcgis\.com/i.test(t)?"ArcGIS Online":t,resource:`(${i||n.lblItem})`})),a=s?null:Iy("div",{class:Ay,key:"username"},Iy("label",{class:Py},n.lblUser,Iy("input",{value:"",required:!0,autocomplete:"off",spellcheck:!1,type:"text",bind:this,afterCreate:uu,"data-node-ref":"_usernameInputNode",class:Oy}))),l=s?null:Iy("div",{class:Ay,key:"password"},Iy("label",{class:Py},n.lblPwd,Iy("input",{value:"",required:!0,type:"password",bind:this,afterCreate:uu,"data-node-ref":"_passwordInputNode",class:Oy}))),h=Iy("div",{class:this.classes(Ay,Cy)},Iy("input",{type:"submit",disabled:!!r,value:r?n.lblSigning:n.lblOk,class:ky}),Iy("input",{type:"button",value:n.lblCancel,bind:this,onclick:this._cancel,class:this.classes(ky,Ly)})),c=e?Iy("div",null,e.details&&e.details.httpStatus?n.invalidUser:n.noAuthService):null;return Iy("form",{class:Ey,bind:this,onsubmit:this._submit},o,c,a,l,h)}_cancel(){this._set("signingIn",!1),this._usernameInputNode&&(this._usernameInputNode.value=""),this._passwordInputNode&&(this._passwordInputNode.value=""),this.emit("cancel")}_submit(e){e.preventDefault(),this._set("signingIn",!0);const t=this.oAuthPrompt?{}:{username:this._usernameInputNode&&this._usernameInputNode.value,password:this._passwordInputNode&&this._passwordInputNode.value};this.emit("submit",t)}};Q([ro(),Sy("esri/identity/t9n/identity")],Ry.prototype,"messages",void 0),Q([ro()],Ry.prototype,"signingIn",void 0),Q([ro()],Ry.prototype,"server",void 0),Q([ro()],Ry.prototype,"resource",void 0),Q([ro()],Ry.prototype,"error",void 0),Q([ro()],Ry.prototype,"oAuthPrompt",void 0),Ry=Q([Ro("esri.identity.IdentityForm")],Ry);var Dy=Ry;function Fy(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:jy(e[t])}}}function jy(e){return function(t,...i){!function(e){const{type:t}=e;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}(t)?e.call(this,t,...i):gu(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click())}}function Ny(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:e.split(",").map((e=>e.trim()));i.push(...r)}}function zy(e){return e&&"function"==typeof e.render}
/*!
* tabbable 5.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/
var Vy,Uy=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details"],Gy=Uy.join(","),By="undefined"==typeof Element?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,qy=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return isNaN(t)?function(e){return"true"===e.contentEditable}(e)?0:"AUDIO"!==e.nodeName&&"VIDEO"!==e.nodeName&&"DETAILS"!==e.nodeName||null!==e.getAttribute("tabindex")?e.tabIndex:0:t},Hy=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},Wy=function(e){return"INPUT"===e.tagName},$y=function(e){return function(e){return Wy(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var t,i=e.form||e.ownerDocument,r=function(e){return i.querySelectorAll('input[type="radio"][name="'+e+'"]')};if("undefined"!=typeof window&&void 0!==window.CSS&&"function"==typeof window.CSS.escape)t=r(window.CSS.escape(e.name));else try{t=r(e.name)}catch(n){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",n.message),!1}var s=function(e,t){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===t)return e[i]}(t,e.form);return!s||s===e}(e)},Jy=function(e,t){return!(t.disabled||function(e){return Wy(e)&&"hidden"===e.type}(t)||function(e,t){if("hidden"===getComputedStyle(e).visibility)return!0;var i=By.call(e,"details>summary:first-of-type")?e.parentElement:e;if(By.call(i,"details:not([open]) *"))return!0;if(t&&"full"!==t){if("non-zero-area"===t){var r=e.getBoundingClientRect(),s=r.width,n=r.height;return 0===s&&0===n}}else for(;e;){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(t,e.displayCheck)||function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some((function(e){return"SUMMARY"===e.tagName}))}(t))},Xy=function(e,t){return!(!Jy(e,t)||$y(t)||qy(t)<0)},Ky=function(e,t){var i=[],r=[];return function(e,t,i){var r=Array.prototype.slice.apply(e.querySelectorAll(Gy));return t&&By.call(e,Gy)&&r.unshift(e),r.filter(i)}(e,(t=t||{}).includeContainer,Xy.bind(null,t)).forEach((function(e,t){var s=qy(e);0===s?i.push(e):r.push({documentOrder:t,tabIndex:s,node:e})})),r.sort(Hy).map((function(e){return e.node})).concat(i)},Yy=Uy.concat("iframe").join(","),Zy=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return!1!==By.call(e,Yy)&&Jy(t,e)};
/*!
* focus-trap 6.5.1
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/
function Qy(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function eg(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var tg,ig=(tg=[],{activateTrap:function(e){if(tg.length>0){var t=tg[tg.length-1];t!==e&&t.pause()}var i=tg.indexOf(e);-1===i||tg.splice(i,1),tg.push(e)},deactivateTrap:function(e){var t=tg.indexOf(e);-1!==t&&tg.splice(t,1),tg.length>0&&tg[tg.length-1].unpause()}}),rg=function(e){return setTimeout(e,0)},sg=function(e,t){var i=-1;return e.every((function(e,r){return!t(e)||(i=r,!1)})),i},ng=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return"function"==typeof e?e.apply(void 0,i):e},og=function(e,t){var i,r=document,s=function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Qy(Object(i),!0).forEach((function(t){eg(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qy(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0},t),n={containers:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1},o=function(e,t,i){return e&&void 0!==e[t]?e[t]:s[i||t]},a=function(e){return n.containers.some((function(t){return t.contains(e)}))},l=function(e){var t=s[e];if(!t)return null;var i=t;if("string"==typeof t&&!(i=r.querySelector(t)))throw new Error("`".concat(e,"` refers to no known node"));if("function"==typeof t&&!(i=t()))throw new Error("`".concat(e,"` did not return a node"));return i},h=function(){var e;if(null!==l("initialFocus"))e=l("initialFocus");else if(a(r.activeElement))e=r.activeElement;else{var t=n.tabbableGroups[0];e=t&&t.firstTabbableNode||l("fallbackFocus")}if(!e)throw new Error("Your focus-trap needs to have at least one focusable element");return e},c=function(){if(n.tabbableGroups=n.containers.map((function(e){var t=Ky(e);if(t.length>0)return{container:e,firstTabbableNode:t[0],lastTabbableNode:t[t.length-1]}})).filter((function(e){return!!e})),n.tabbableGroups.length<=0&&!l("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times")},u=function e(t){t!==r.activeElement&&(t&&t.focus?(t.focus({preventScroll:!!s.preventScroll}),n.mostRecentlyFocusedNode=t,function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select}(t)&&t.select()):e(h()))},p=function(e){var t=l("setReturnFocus");return t||e},d=function(e){a(e.target)||(ng(s.clickOutsideDeactivates,e)?i.deactivate({returnFocus:s.returnFocusOnDeactivate&&!Zy(e.target)}):ng(s.allowOutsideClick,e)||e.preventDefault())},f=function(e){var t=a(e.target);t||e.target instanceof Document?t&&(n.mostRecentlyFocusedNode=e.target):(e.stopImmediatePropagation(),u(n.mostRecentlyFocusedNode||h()))},y=function(e){if(!1!==s.escapeDeactivates&&function(e){return"Escape"===e.key||"Esc"===e.key||27===e.keyCode}(e))return e.preventDefault(),void i.deactivate();(function(e){return"Tab"===e.key||9===e.keyCode})(e)&&function(e){c();var t=null;if(n.tabbableGroups.length>0){var i=sg(n.tabbableGroups,(function(t){return t.container.contains(e.target)}));if(i<0)t=e.shiftKey?n.tabbableGroups[n.tabbableGroups.length-1].lastTabbableNode:n.tabbableGroups[0].firstTabbableNode;else if(e.shiftKey){var r=sg(n.tabbableGroups,(function(t){var i=t.firstTabbableNode;return e.target===i}));if(r<0&&n.tabbableGroups[i].container===e.target&&(r=i),r>=0){var s=0===r?n.tabbableGroups.length-1:r-1;t=n.tabbableGroups[s].lastTabbableNode}}else{var o=sg(n.tabbableGroups,(function(t){var i=t.lastTabbableNode;return e.target===i}));if(o<0&&n.tabbableGroups[i].container===e.target&&(o=i),o>=0){var a=o===n.tabbableGroups.length-1?0:o+1;t=n.tabbableGroups[a].firstTabbableNode}}}else t=l("fallbackFocus");t&&(e.preventDefault(),u(t))}(e)},g=function(e){ng(s.clickOutsideDeactivates,e)||a(e.target)||ng(s.allowOutsideClick,e)||(e.preventDefault(),e.stopImmediatePropagation())},m=function(){if(n.active)return ig.activateTrap(i),Vy=s.delayInitialFocus?rg((function(){u(h())})):u(h()),r.addEventListener("focusin",f,!0),r.addEventListener("mousedown",d,{capture:!0,passive:!1}),r.addEventListener("touchstart",d,{capture:!0,passive:!1}),r.addEventListener("click",g,{capture:!0,passive:!1}),r.addEventListener("keydown",y,{capture:!0,passive:!1}),i},v=function(){if(n.active)return r.removeEventListener("focusin",f,!0),r.removeEventListener("mousedown",d,!0),r.removeEventListener("touchstart",d,!0),r.removeEventListener("click",g,!0),r.removeEventListener("keydown",y,!0),i};return(i={activate:function(e){if(n.active)return this;var t=o(e,"onActivate"),i=o(e,"onPostActivate"),s=o(e,"checkCanFocusTrap");s||c(),n.active=!0,n.paused=!1,n.nodeFocusedBeforeActivation=r.activeElement,t&&t();var a=function(){s&&c(),m(),i&&i()};return s?(s(n.containers.concat()).then(a,a),this):(a(),this)},deactivate:function(e){if(!n.active)return this;clearTimeout(Vy),v(),n.active=!1,n.paused=!1,ig.deactivateTrap(i);var t=o(e,"onDeactivate"),r=o(e,"onPostDeactivate"),s=o(e,"checkCanReturnFocus");t&&t();var a=o(e,"returnFocus","returnFocusOnDeactivate"),l=function(){rg((function(){a&&u(p(n.nodeFocusedBeforeActivation)),r&&r()}))};return a&&s?(s(p(n.nodeFocusedBeforeActivation)).then(l,l),this):(l(),this)},pause:function(){return n.paused||!n.active||(n.paused=!0,v()),this},unpause:function(){return n.paused&&n.active?(n.paused=!1,c(),m(),this):this},updateContainerElements:function(e){var t=[].concat(e).filter(Boolean);return n.containers=t.map((function(e){return"string"==typeof e?r.querySelector(e):e})),n.active&&c(),this}}).updateContainerElements(e),i};const ag="esri-identity-modal",lg="esri-identity-modal--open",hg="esri-identity-modal--closed",cg="esri-identity-modal__title",ug="esri-identity-modal__dialog",pg="esri-identity-modal__content",dg="esri-identity-modal__close-button",fg="esri-icon-close";let yg=class extends xy{constructor(e,t){super(e,t),this.container=document.createElement("div"),this.content=null,this.open=!1,this._close=()=>{this.open=!1},document.body.appendChild(this.container),this.own(this.watch("open",(()=>this._toggleFocusTrap())))}destroy(){this._destroyFocusTrap()}render(){const e=this.id,{open:t,content:i,title:r,messages:s}=this,n=t&&!!i,o={[lg]:n,[hg]:!n},a=Iy("button",{class:dg,"aria-label":s.close,title:s.close,bind:this,onclick:this._close},Iy("span",{"aria-hidden":"true",class:fg})),l=`${e}_title`,h=`${e}_content`,c=r?Iy("h1",{id:l,class:cg},r):null,u=n?Iy("div",{bind:this,class:ug,role:"dialog","aria-labelledby":l,"aria-describedby":h,afterCreate:this._createFocusTrap},a,c,this._renderContent(h)):null;return Iy("div",{tabIndex:-1,class:this.classes(ag,o)},u)}_destroyFocusTrap(){var e;null==(e=this._focusTrap)||e.deactivate({onDeactivate:null}),this._focusTrap=null}_toggleFocusTrap(){const{_focusTrap:e,open:t}=this;e&&(t?e.activate():e.deactivate())}_createFocusTrap(e){this._destroyFocusTrap();const t=requestAnimationFrame((()=>{this._focusTrap=og(e,{initialFocus:"input",onDeactivate:this._close}),this._toggleFocusTrap()}));this.own(xr((()=>cancelAnimationFrame(t))))}_renderContent(e){const t=this.content;return"string"==typeof t?Iy("div",{class:pg,id:e,innerHTML:t}):zy(t)?Iy("div",{class:pg,id:e},t.render()):t instanceof HTMLElement?Iy("div",{class:pg,id:e,bind:t,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};Q([ro({readOnly:!0})],yg.prototype,"container",void 0),Q([ro()],yg.prototype,"content",void 0),Q([ro()],yg.prototype,"open",void 0),Q([ro(),Sy("esri/t9n/common")],yg.prototype,"messages",void 0),Q([ro({aliasOf:"messages.auth.signIn"})],yg.prototype,"title",void 0),yg=Q([Ro("esri.identity.IdentityModal")],yg);var gg=yg;const mg="esriJSAPIOAuth";class vg{constructor(e,t){this.oAuthInfo=null,this.storage=null,this.appId=null,this.expires=null,this.ssl=null,this.token=null,this.userId=null,this.oAuthInfo=e,this.storage=t,this._init()}isValid(){let e=!1;if(this.oAuthInfo&&this.token&&this.userId){const t=Date.now();this.expires>t&&(this.expires-t)/1e3>60*this.oAuthInfo.minTimeUntilExpiration&&(e=!0)}return e}save(){if(!this.storage)return;const e=this._load(),t=this.oAuthInfo;if(t&&t.authNamespace&&t.portalUrl){let r=e[t.authNamespace];r||(r=e[t.authNamespace]={}),r[t.portalUrl]={appId:this.appId=t.appId,expires:this.expires,ssl:this.ssl,token:this.token,userId:this.userId};try{this.storage.setItem(mg,JSON.stringify(e))}catch(i){console.log(i)}}}destroy(){const e=this._load(),t=this.oAuthInfo;if(t&&t.appId&&t.portalUrl&&this.token&&this.expires>Date.now()){const e=t.portalUrl.replace(/^http:/i,"https:")+"/sharing/rest/oauth2/revokeToken",i=new FormData;if(i.append("f","json"),i.append("auth_token",this.token),i.append("client_id",t.appId),i.append("token_type_hint","access_token"),"function"==typeof navigator.sendBeacon)navigator.sendBeacon(e,i);else{const t=new XMLHttpRequest;t.open("POST",e),t.send(i)}}if(t&&t.authNamespace&&t.portalUrl&&this.storage){const r=e[t.authNamespace];if(r){delete r[t.portalUrl];try{this.storage.setItem(mg,JSON.stringify(e))}catch(i){console.log(i)}}}t&&(t._oAuthCred=null,this.oAuthInfo=null)}_init(){const e=this._load(),t=this.oAuthInfo;if(t&&t.authNamespace&&t.portalUrl){let i=e[t.authNamespace];i&&(i=i[t.portalUrl],i&&(this.appId=i.appId,this.expires=i.expires,this.ssl=i.ssl,this.token=i.token,this.userId=i.userId))}}_load(){let e={};if(this.storage){const t=this.storage.getItem(mg);if(t)try{e=JSON.parse(t)}catch(qe){console.log(qe)}}return e}}vg.prototype.declaredClass="esri.identity.OAuthCredential";let bg=class extends Ko{constructor(e){super(e),this.adminTokenServiceUrl=null,this.currentVersion=null,this.hasPortal=null,this.hasServer=null,this.owningSystemUrl=null,this.owningTenant=null,this.server=null,this.shortLivedTokenValidity=null,this.tokenServiceUrl=null,this.webTierAuth=null}};Q([ro({json:{write:!0}})],bg.prototype,"adminTokenServiceUrl",void 0),Q([ro({json:{write:!0}})],bg.prototype,"currentVersion",void 0),Q([ro({json:{write:!0}})],bg.prototype,"hasPortal",void 0),Q([ro({json:{write:!0}})],bg.prototype,"hasServer",void 0),Q([ro({json:{write:!0}})],bg.prototype,"owningSystemUrl",void 0),Q([ro({json:{write:!0}})],bg.prototype,"owningTenant",void 0),Q([ro({json:{write:!0}})],bg.prototype,"server",void 0),Q([ro({json:{write:!0}})],bg.prototype,"shortLivedTokenValidity",void 0),Q([ro({json:{write:!0}})],bg.prototype,"tokenServiceUrl",void 0),Q([ro({json:{write:!0}})],bg.prototype,"webTierAuth",void 0),bg=Q([Ro("esri.identity.ServerInfo")],bg);var wg=bg;const _g={},xg=e=>{const t=new Bt(e.owningSystemUrl).host,i=new Bt(e.server).host,r=/.+\.arcgis\.com$/i;return r.test(t)&&r.test(i)},Sg=(e,t)=>!!(xg(e)&&t&&t.some((t=>t.test(e.server))));let Mg=null,Tg=null;try{Mg=window.localStorage,Tg=window.sessionStorage}catch{}class Ig extends sh{constructor(){super(),this._portalConfig=h.esriGeowConfig,this.serverInfos=[],this.oAuthInfos=[],this.credentials=[],this._soReqs=[],this._xoReqs=[],this._portals=[],this.defaultOAuthInfo=null,this.defaultTokenValidity=60,this.dialog=null,this.formConstructor=Dy,this.tokenValidity=null,this.normalizeWebTierAuth=!1,this._appOrigin="null"!==window.origin?window.origin:window.location.origin,this._appUrlObj=$t(window.location.href),this._busy=null,this._rejectOnPersistedPageShow=!1,this._oAuthHash=null,this._gwTokenUrl="/sharing/rest/generateToken",this._agsRest="/rest/services",this._agsPortal=/\/sharing(\/|$)/i,this._agsAdmin=/(https?:\/\/[^\/]+\/[^\/]+)\/admin\/?(\/.*)?$/i,this._adminSvcs=/\/rest\/admin\/services(\/|$)/i,this._gwDomains=[{regex:/^https?:\/\/www\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:dev|[a-z\d-]+\.mapsdev)\.arcgis\.com/i,customBaseUrl:"mapsdev.arcgis.com",tokenServiceUrl:"https://dev.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:devext|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,customBaseUrl:"mapsdevext.arcgis.com",tokenServiceUrl:"https://devext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/(?:qaext|[a-z\d-]+\.mapsqa)\.arcgis\.com/i,customBaseUrl:"mapsqa.arcgis.com",tokenServiceUrl:"https://qaext.arcgis.com/sharing/rest/generateToken"},{regex:/^https?:\/\/[a-z\d-]+\.maps\.arcgis\.com/i,customBaseUrl:"maps.arcgis.com",tokenServiceUrl:"https://www.arcgis.com/sharing/rest/generateToken"}],this._legacyFed=[],this._regexSDirUrl=/http.+\/rest\/services\/?/gi,this._regexServerType=/(\/(FeatureServer|GPServer|GeoDataServer|GeocodeServer|GeoenrichmentServer|GeometryServer|GlobeServer|ImageServer|MapServer|MobileServer|NAServer|NetworkDiagramServer|OGCFeatureServer|ParcelFabricServer|RelationalCatalogServer|SceneServer|StreamServer|UtilityNetworkServer|ValidationServer|VectorTileServer|VersionManagementServer)).*/gi,this._gwUser=/http.+\/users\/([^\/]+)\/?.*/i,this._gwItem=/http.+\/items\/([^\/]+)\/?.*/i,this._gwGroup=/http.+\/groups\/([^\/]+)\/?.*/i,this._rePortalTokenSvc=/\/sharing(\/rest)?\/generatetoken/i,this._createDefaultOAuthInfo=!0,this._hasTestedIfAppIsOnPortal=!1,this._getOAuthHash(),window.addEventListener("pageshow",(e=>{this._pageShowHandler(e)}))}registerServers(e){const t=this.serverInfos;t?(e=e.filter((e=>!this.findServerInfo(e.server))),this.serverInfos=t.concat(e)):this.serverInfos=e,e.forEach((e=>{e.owningSystemUrl&&this._portals.push(e.owningSystemUrl),e.hasPortal&&this._portals.push(e.server)}))}registerOAuthInfos(e){const t=this.oAuthInfos;if(t){for(const i of e){const e=this.findOAuthInfo(i.portalUrl);e&&t.splice(t.indexOf(e),1)}this.oAuthInfos=t.concat(e)}else this.oAuthInfos=e}registerToken(e){e=a({},e);const t=this._sanitizeUrl(e.server),i=this._isServerRsrc(t);let r,s=this.findServerInfo(t),n=!0;s||(s=new wg,s.server=this._getServerInstanceRoot(t),i?s.hasServer=!0:(s.tokenServiceUrl=this._getTokenSvcUrl(t),s.hasPortal=!0),this.registerServers([s])),r=this._findCredential(t),r?(delete e.server,Object.assign(r,e),n=!1):(r=new Eg({userId:e.userId,server:s.server,token:e.token,expires:e.expires,ssl:e.ssl,scope:i?"server":"portal"}),r.resources=[t],this.credentials.push(r)),r.emitTokenChange(!1),n||r.refreshServerTokens()}toJSON(){return q({serverInfos:this.serverInfos.map((e=>e.toJSON())),oAuthInfos:this.oAuthInfos.map((e=>e.toJSON())),credentials:this.credentials.map((e=>e.toJSON()))})}initialize(e){if(!e)return;"string"==typeof e&&(e=JSON.parse(e));const t=e.serverInfos,i=e.oAuthInfos,r=e.credentials;if(t){const e=[];t.forEach((t=>{t.server&&t.tokenServiceUrl&&e.push(t.declaredClass?t:new wg(t))})),e.length&&this.registerServers(e)}if(i){const e=[];i.forEach((t=>{t.appId&&e.push(t.declaredClass?t:new Ql(t))})),e.length&&this.registerOAuthInfos(e)}r&&r.forEach((e=>{e.server&&e.token&&e.expires&&e.expires>Date.now()&&((e=e.declaredClass?e:new Eg(e)).emitTokenChange(),this.credentials.push(e))}))}findServerInfo(e){let t;e=this._sanitizeUrl(e);for(const i of this.serverInfos)if(this._hasSameServerInstance(i.server,e)){t=i;break}return t}findOAuthInfo(e){let t;e=this._sanitizeUrl(e);for(const i of this.oAuthInfos)if(this._hasSameServerInstance(i.portalUrl,e)){t=i;break}return t}findCredential(e,t){let i;e=this._sanitizeUrl(e);const r=this._isServerRsrc(e)?"server":"portal";if(t){for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&t===s.userId&&s.scope===r){i=s;break}}else for(const s of this.credentials)if(this._hasSameServerInstance(s.server,e)&&-1!==this._getIdenticalSvcIdx(e,s)&&s.scope===r){i=s;break}return i}getCredential(e,t){let i,r,s=!0;t&&(i=!!t.token,r=t.error,s=!1!==t.prompt),t=a({},t),e=this._sanitizeUrl(e);const n=et(),o=_t();if(t.signal&&ot(t.signal,(()=>{n.abort()})),ot(n,(()=>{o.reject(new Be("identity-manager:user-aborted","ABORTED"))})),rt(n))return o.promise;t.signal=n.signal;const l=this._isAdminResource(e),h=i?this.findCredential(e):null;let c;if(h&&r&&r.details&&498===r.details.httpStatus)h.destroy();else if(h)return c=new Be("identity-manager:not-authorized","You are currently signed in as: '"+h.userId+"'. You do not have access to this resource: "+e,{error:r}),o.reject(c),o.promise;const u=this._findCredential(e,t);if(u)return o.resolve(u),o.promise;let p=this.findServerInfo(e);if(p)!p.hasServer&&this._isServerRsrc(e)&&(p._restInfoPms=this._getTokenSvcUrl(e),p.hasServer=!0);else{const t=this._getTokenSvcUrl(e);if(!t)return c=new Be("identity-manager:unknown-resource","Unknown resource - could not find token service endpoint."),o.reject(c),o.promise;p=new wg,p.server=this._getServerInstanceRoot(e),"string"==typeof t?(p.tokenServiceUrl=t,p.hasPortal=!0):(p._restInfoPms=t,p.hasServer=!0),this.registerServers([p])}return p.hasPortal&&void 0===p._selfReq&&(s||si(p.tokenServiceUrl,this._appOrigin)||this._gwDomains.some((e=>e.tokenServiceUrl===p.tokenServiceUrl)))&&(p._selfReq={owningTenant:t&&t.owningTenant,selfDfd:this._getPortalSelf(p.tokenServiceUrl.replace(this._rePortalTokenSvc,"/sharing/rest/portals/self"),e)}),this._enqueue(e,p,t,o,l)}getResourceName(e){return this._isRESTService(e)?e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"")||"":this._gwUser.test(e)&&e.replace(this._gwUser,"$1")||this._gwItem.test(e)&&e.replace(this._gwItem,"$1")||this._gwGroup.test(e)&&e.replace(this._gwGroup,"$1")||""}generateToken(e,t,i){const r=this._rePortalTokenSvc.test(e.tokenServiceUrl),s=new Bt(this._appOrigin),n=e.shortLivedTokenValidity;let o,l,h,c,u,p,d,f;t&&(f=this.tokenValidity||n||this.defaultTokenValidity,f>n&&n>0&&(f=n)),i&&(o=i.isAdmin,l=i.serverUrl,h=i.token,p=i.signal,d=i.ssl,e.customParameters=i.customParameters),o?c=e.adminTokenServiceUrl:(c=e.tokenServiceUrl,u=new Bt(c.toLowerCase()),e.webTierAuth&&null!=i&&i.serverUrl&&!d&&"http"===s.scheme&&(si(s.uri,c,!0)||"https"===u.scheme&&s.host===u.host&&"7080"===s.port&&"7443"===u.port)&&(c=c.replace(/^https:/i,"http:").replace(/:7443/i,":7080")));const y=a({query:a({request:"getToken",username:null==t?void 0:t.username,password:null==t?void 0:t.password,serverUrl:l,token:h,expiration:f,referer:o||r?this._appOrigin:null,client:o?"referer":null,f:"json"},e.customParameters),method:"post",authMode:"anonymous",useProxy:this._useProxy(e,i),signal:p},null==i?void 0:i.ioArgs);return r||(y.withCredentials=!1),$i(c,y).then((i=>{const r=i.data;if(!r||!r.token)return new Be("identity-manager:authentication-failed","Unable to generate token");const s=e.server;return _g[s]||(_g[s]={}),t&&(_g[s][t.username]=t.password),r.validity=f,r}))}isBusy(){return!!this._busy}checkSignInStatus(e){return this.checkAppAccess(e,"").then((e=>e.credential))}checkAppAccess(e,t,i){let r=!1;return this.getCredential(e,{prompt:!1}).then((s=>{let n;const o={f:"json"};if("portal"===s.scope)if(t&&(this._doPortalSignIn(e)||i&&i.force))n=s.server+"/sharing/rest/oauth2/validateAppAccess",o.client_id=t;else{if(!s.token)return{credential:s};n=s.server+"/sharing/rest"}else{if(!s.token)return{credential:s};n=s.server+"/rest/services"}return s.token&&(o.token=s.token),$i(n,{query:o,authMode:"anonymous"}).then((e=>{if(!1===e.data.valid)throw new Be("identity-manager:not-authorized",`You are currently signed in as: '${s.userId}'.`,e.data);return r=!!e.data.viewOnlyUserTypeApp,{credential:s}})).catch((e=>{if("identity-manager:not-authorized"===e.name)throw e;const t=e.details&&e.details.httpStatus;if(498===t)throw s.destroy(),new Be("identity-manager:not-authenticated","User is not signed in.");if(400===t)throw new Be("identity-manager:invalid-request");return{credential:s}}))})).then((e=>({credential:e.credential,viewOnly:r})))}setOAuthResponseHash(e){var t;const i=this._oAuthDfd;if(this._oAuthDfd=null,!i||!e)return;clearInterval(this._oAuthIntervalId),null==(t=this._oAuthOnHashHandle)||t.remove(),"#"===e.charAt(0)&&(e=e.substring(1));const r=Jt(e);if(r.error){const e="access_denied"===r.error,t=new Be(e?"identity-manager:user-aborted":"identity-manager:authentication-failed",e?"ABORTED":"OAuth: "+r.error+" - "+r.error_description);i.reject(t)}else{const e=i.sinfo_,t=i.oinfo_,s=t._oAuthCred,n=new Eg({userId:r.username,server:e.server,token:r.access_token,expires:Date.now()+1e3*Number(r.expires_in),ssl:"true"===r.ssl,_oAuthCred:s});t.userId=n.userId,s.storage=r.persist?Mg:Tg,s.token=n.token,s.expires=n.expires,s.userId=n.userId,s.ssl=n.ssl,s.save(),i.resolve(n)}}setOAuthRedirectionHandler(e){this._oAuthRedirectFunc=e}setProtocolErrorHandler(e){this._protocolFunc=e}signIn(e,t,i={}){const r=_t(),s=()=>{var e,t,i,r,s;null==(e=a)||e.remove(),null==(t=l)||t.remove(),null==(i=h)||i.remove(),null==(r=o)||r.destroy(),null==(s=this.dialog)||s.destroy(),this.dialog=o=a=l=h=null},n=()=>{s(),this._oAuthDfd=null,r.reject(new Be("identity-manager:user-aborted","ABORTED"))};i.signal&&ot(i.signal,(()=>{n()}));let o=new this.formConstructor;o.resource=this.getResourceName(e),o.server=t.server,this.dialog=new gg,this.dialog.content=o,this.dialog.open=!0,this.emit("dialog-create");let a=o.on("cancel",n),l=this.dialog.watch("open",n),h=o.on("submit",(e=>{this.generateToken(t,e,{isAdmin:i.isAdmin,signal:i.signal}).then((n=>{s();const o=new Eg({userId:e.username,server:t.server,token:n.token,expires:null!=n.expires?Number(n.expires):null,ssl:!!n.ssl,isAdmin:i.isAdmin,validity:n.validity});r.resolve(o)})).catch((e=>{o.error=e,o.signingIn=!1}))}));return r.promise}oAuthSignIn(e,t,i,r){this._oAuthDfd=_t();const s=this._oAuthDfd;null!=r&&r.signal&&ot(r.signal,(()=>{const e=this._oAuthDfd&&this._oAuthDfd.oAuthWin_;e&&!e.closed?e.close():this.dialog&&a()})),s.resUrl_=e,s.sinfo_=t,s.oinfo_=i;const n=!r||!1!==r.oAuthPopupConfirmation;if(!i.popup||!n)return this._doOAuthSignIn(e,t,i),s.promise;const o=new this.formConstructor;o.oAuthPrompt=!0,o.server=t.server,this.dialog=new gg,this.dialog.content=o,this.dialog.open=!0,this.emit("dialog-create");const a=()=>{u(),this._oAuthDfd=null,s.reject(new Be("identity-manager:user-aborted","ABORTED"))},l=o.on("cancel",a),h=this.dialog.watch("open",a),c=o.on("submit",(()=>{u(),this._doOAuthSignIn(e,t,i)})),u=()=>{l.remove(),h.remove(),c.remove(),o.destroy(),this.dialog.destroy(),this.dialog=null};return s.promise}destroyCredentials(){this.credentials&&this.credentials.slice().forEach((e=>{e.destroy()})),this.emit("credentials-destroy")}enablePostMessageAuth(e="https://www.arcgis.com/sharing/rest"){this._postMessageAuthHandle&&this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=$e(window,"message",(t=>{var i;if((t.origin===this._appOrigin||t.origin.endsWith(".arcgis.com"))&&"arcgis:auth:requestCredential"===(null==(i=t.data)?void 0:i.type)){const i=t.source;this.getCredential(e).then((e=>{i.postMessage({type:"arcgis:auth:credential",credential:{expires:e.expires,server:e.server,ssl:e.ssl,token:e.token,userId:e.userId}},t.origin)})).catch((e=>{i.postMessage({type:"arcgis:auth:error",error:{name:e.name,message:e.message}},t.origin)}))}}))}disablePostMessageAuth(){this._postMessageAuthHandle&&(this._postMessageAuthHandle.remove(),this._postMessageAuthHandle=null)}_getOAuthHash(){let e=window.location.hash;if(e){"#"===e.charAt(0)&&(e=e.substring(1));const t=Jt(e);let i=!1;if(t.access_token&&t.expires_in&&t.state&&t.hasOwnProperty("username"))try{t.state=JSON.parse(t.state),"object"==typeof t.state&&t.state.portalUrl&&(this._oAuthHash=t,i=!0)}catch{}else t.error&&t.error_description&&(console.log("IdentityManager OAuth Error: ",t.error," - ",t.error_description),"access_denied"===t.error&&(i=!0));i&&(window.location.hash="object"==typeof t.state&&t.state.hash||"")}}_pageShowHandler(e){if(e.persisted&&this.isBusy()&&this._rejectOnPersistedPageShow){const e=new Be("identity-manager:user-aborted","ABORTED");this._errbackFunc(e)}}_findCredential(e,t){let i,r,s,n,o=-1;const a=t&&t.token,l=t&&t.resource,h=this._isServerRsrc(e)?"server":"portal",c=this.credentials.filter((t=>this._hasSameServerInstance(t.server,e)&&t.scope===h));if(e=l||e,c.length)if(1===c.length){if(i=c[0],n=this.findServerInfo(i.server),r=n&&n.owningSystemUrl,s=r&&this.findCredential(r,i.userId),o=this._getIdenticalSvcIdx(e,i),!a)return-1===o&&i.resources.push(e),this._addResource(e,s),i;-1!==o&&(i.resources.splice(o,1),this._removeResource(e,s))}else{let t,i;if(c.some((a=>(i=this._getIdenticalSvcIdx(e,a),-1!==i&&(t=a,n=this.findServerInfo(t.server),r=n&&n.owningSystemUrl,s=r&&this.findCredential(r,t.userId),o=i,!0)))),a)t&&(t.resources.splice(o,1),this._removeResource(e,s));else if(t)return this._addResource(e,s),t}}_findOAuthInfo(e){let t=this.findOAuthInfo(e);if(!t)for(const i of this.oAuthInfos)if(this._isIdProvider(i.portalUrl,e)){t=i;break}return t}_addResource(e,t){t&&-1===this._getIdenticalSvcIdx(e,t)&&t.resources.push(e)}_removeResource(e,t){let i=-1;t&&(i=this._getIdenticalSvcIdx(e,t),i>-1&&t.resources.splice(i,1))}_useProxy(e,t){return t&&t.isAdmin&&!si(e.adminTokenServiceUrl,this._appOrigin)||!this._isPortalDomain(e.tokenServiceUrl)&&"10.1"===String(e.currentVersion)&&!si(e.tokenServiceUrl,this._appOrigin)}_getOrigin(e){const t=new Bt(e);return t.scheme+"://"+t.host+(null!=t.port?":"+t.port:"")}_getServerInstanceRoot(e){const t=e.toLowerCase();let i=t.indexOf(this._agsRest);return-1===i&&this._isAdminResource(e)&&(i=this._agsAdmin.test(e)?e.replace(this._agsAdmin,"$1").length:e.search(this._adminSvcs)),-1===i&&(i=t.indexOf("/sharing")),-1===i&&"/"===t.substr(-1)&&(i=t.length-1),i>-1?e.substring(0,i):e}_hasSameServerInstance(e,t){return"/"===e.substr(-1)&&(e=e.slice(0,-1)),e=e.toLowerCase(),t=this._getServerInstanceRoot(t).toLowerCase(),e=this._normalizeAGOLorgDomain(e),t=this._normalizeAGOLorgDomain(t),(e=e.substr(e.indexOf(":")))===t.substr(t.indexOf(":"))}_normalizeAGOLorgDomain(e){const t=/^https?:\/\/(?:cdn|[a-z\d-]+\.maps)\.arcgis\.com/i,i=/^https?:\/\/(?:cdndev|[a-z\d-]+\.mapsdevext)\.arcgis\.com/i,r=/^https?:\/\/(?:cdnqa|[a-z\d-]+\.mapsqa)\.arcgis\.com/i;return t.test(e)?e=e.replace(t,"https://www.arcgis.com"):i.test(e)?e=e.replace(i,"https://devext.arcgis.com"):r.test(e)&&(e=e.replace(r,"https://qaext.arcgis.com")),e}_sanitizeUrl(e){const t=(Z.request.proxyUrl||"").toLowerCase(),i=t?e.toLowerCase().indexOf(t+"?"):-1;return-1!==i&&(e=e.substring(i+t.length+1)),$t(e=hi(e)).path}_isRESTService(e){return e.indexOf(this._agsRest)>-1}_isAdminResource(e){return this._agsAdmin.test(e)||this._adminSvcs.test(e)}_isServerRsrc(e){return this._isRESTService(e)||this._isAdminResource(e)}_isIdenticalService(e,t){let i;if(this._isRESTService(e)&&this._isRESTService(t)){const r=this._getSuffix(e).toLowerCase(),s=this._getSuffix(t).toLowerCase();if(i=r===s,!i){const e=/(.*)\/(MapServer|FeatureServer|UtilityNetworkServer).*/gi;i=r.replace(e,"$1")===s.replace(e,"$1")}}else this._isAdminResource(e)&&this._isAdminResource(t)?i=!0:this._isServerRsrc(e)||this._isServerRsrc(t)||!this._isPortalDomain(e)||(i=!0);return i}_isPortalDomain(e){const t=new Bt(e.toLowerCase()),i=this._portalConfig;let r=this._gwDomains.some((e=>e.regex.test(t.uri)));return!r&&i&&(r=this._hasSameServerInstance(this._getServerInstanceRoot(i.restBaseUrl),t.uri)),r||Z.portalUrl&&(r=si(t,Z.portalUrl,!0)),r||(r=this._portals.some((e=>this._hasSameServerInstance(e,t.uri)))),r=r||this._agsPortal.test(t.path),r}_isIdProvider(e,t){let i=-1,r=-1;this._gwDomains.forEach(((s,n)=>{-1===i&&s.regex.test(e)&&(i=n),-1===r&&s.regex.test(t)&&(r=n)}));let s=!1;if(i>-1&&r>-1&&(0===i||4===i?0!==r&&4!==r||(s=!0):1===i?1!==r&&2!==r||(s=!0):2===i?2===r&&(s=!0):3===i&&3===r&&(s=!0)),!s){const i=this.findServerInfo(t),r=i&&i.owningSystemUrl;r&&xg(i)&&this._isPortalDomain(r)&&this._isIdProvider(e,r)&&(s=!0)}return s}_getIdenticalSvcIdx(e,t){let i=-1;for(let r=0;r<t.resources.length;r++){const s=t.resources[r];if(this._isIdenticalService(e,s)){i=r;break}}return i}_getSuffix(e){return e.replace(this._regexSDirUrl,"").replace(this._regexServerType,"$1")}_getTokenSvcUrl(e){let t,i,r;if(this._isRESTService(e)||this._isAdminResource(e)){const r=this._getServerInstanceRoot(e);return t=r+"/admin/generateToken",i=$i(e=r+"/rest/info",{query:{f:"json"}}).then((e=>e.data)),{adminUrl:t,promise:i}}if(this._isPortalDomain(e)){let t="";if(this._gwDomains.some((i=>(i.regex.test(e)&&(t=i.tokenServiceUrl),!!t))),t||this._portals.some((i=>(this._hasSameServerInstance(i,e)&&(t=i+this._gwTokenUrl),!!t))),t||(r=e.toLowerCase().indexOf("/sharing"),-1!==r&&(t=e.substring(0,r)+this._gwTokenUrl)),t||(t=this._getOrigin(e)+this._gwTokenUrl),t){const i=new Bt(e).port;/^http:\/\//i.test(e)&&"7080"===i&&(t=t.replace(/:7080/i,":7443")),t=t.replace(/http:/i,"https:")}return t}if(-1!==e.toLowerCase().indexOf("premium.arcgisonline.com"))return"https://premium.arcgisonline.com/server/tokens"}_exchangeToken(e,t,i){return $i(`${e}/sharing/rest/oauth2/exchangeToken`,{authMode:"anonymous",method:"post",query:{f:"json",client_id:t,token:i}}).then((e=>e.data.token))}_getPlatformSelf(e,t){return $i(`${e}/sharing/rest/oauth2/platformSelf`,{authMode:"anonymous",headers:{"X-Esri-Auth-Client-Id":t,"X-Esri-Auth-Redirect-Uri":window.location.href.replace(/#.*$/,"")},method:"post",query:{f:"json"},withCredentials:!0}).then((e=>e.data))}_getPortalSelf(e,t){let i;return this._gwDomains.some((t=>(t.regex.test(e)&&(i=t.customBaseUrl),!!i))),i?Promise.resolve({allSSL:!0,currentVersion:"4.4",customBaseUrl:i,portalMode:"multitenant",supportsOAuth:!0}):(this._appOrigin.startsWith("https:")?e=e.replace(/^http:/i,"https:").replace(/:7080/i,":7443"):/^http:/i.test(t)&&(e=e.replace(/^https:/i,"http:").replace(/:7443/i,":7080")),$i(e,{query:{f:"json"},authMode:"anonymous",withCredentials:!0}).then((e=>e.data)))}_doPortalSignIn(e){const t=this._portalConfig,i=window.location.href,r=this.findServerInfo(e);return!(!t&&!this._isPortalDomain(i)||!(r?r.hasPortal||r.owningSystemUrl&&this._isPortalDomain(r.owningSystemUrl):this._isPortalDomain(e))||!(this._isIdProvider(i,e)||t&&(this._hasSameServerInstance(this._getServerInstanceRoot(t.restBaseUrl),e)||this._isIdProvider(t.restBaseUrl,e))||si(i,e,!0)))}_checkProtocol(e,t,i,r){let s=!0;const n=r?t.adminTokenServiceUrl:t.tokenServiceUrl;return n.trim().toLowerCase().startsWith("https:")&&!this._appOrigin.startsWith("https:")&&ti(n)&&(s=!!this._protocolFunc&&!!this._protocolFunc({resourceUrl:e,serverInfo:t}),!s)&&i(new Be("identity-manager:aborted","Aborted the Sign-In process to avoid sending password over insecure connection.")),s}_enqueue(e,t,i,r,s,n){return r||(r=_t()),r.resUrl_=e,r.sinfo_=t,r.options_=i,r.admin_=s,r.refresh_=n,this._busy?this._hasSameServerInstance(this._getServerInstanceRoot(e),this._busy.resUrl_)?(this._oAuthDfd&&this._oAuthDfd.oAuthWin_&&this._oAuthDfd.oAuthWin_.focus(),this._soReqs.push(r)):this._xoReqs.push(r):this._doSignIn(r),r.promise}_doSignIn(e){this._busy=e,this._rejectOnPersistedPageShow=!1;const t=t=>{const i=e.options_&&e.options_.resource,r=e.resUrl_,s=e.refresh_;let n=!1;-1===this.credentials.indexOf(t)&&(s&&-1!==this.credentials.indexOf(s)?(s.userId=t.userId,s.token=t.token,s.expires=t.expires,s.validity=t.validity,s.ssl=t.ssl,s.creationTime=t.creationTime,n=!0,t=s):this.credentials.push(t)),t.resources||(t.resources=[]),t.resources.push(i||r),t.scope=this._isServerRsrc(r)?"server":"portal",t.emitTokenChange();const o=this._soReqs,a={};this._soReqs=[],o.forEach((e=>{if(!this._isIdenticalService(r,e.resUrl_)){const i=this._getSuffix(e.resUrl_);a[i]||(a[i]=!0,t.resources.push(e.resUrl_))}})),e.resolve(t),o.forEach((e=>{this._hasSameServerInstance(this._getServerInstanceRoot(r),e.resUrl_)?e.resolve(t):this._soReqs.push(e)})),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,n||this.emit("credential-create",{credential:t}),this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},i=t=>{e.reject(t),this._busy=e.resUrl_=e.sinfo_=e.refresh_=null,this._soReqs.length?this._doSignIn(this._soReqs.shift()):this._xoReqs.length&&this._doSignIn(this._xoReqs.shift())},r=(r,s,n,o)=>{var a,l;const h=e.sinfo_,c=!e.options_||!1!==e.options_.prompt,u=h.hasPortal&&this._findOAuthInfo(e.resUrl_);let p,d;if(r)t(new Eg({userId:r,server:h.server,token:n||null,expires:null!=o?Number(o):null,ssl:!!s}));else if(window!==window.parent&&null!=(a=this._appUrlObj.query)&&a["arcgis-auth-origin"]&&null!=(l=this._appUrlObj.query)&&l["arcgis-auth-portal"]&&this._hasSameServerInstance(this._getServerInstanceRoot(this._appUrlObj.query["arcgis-auth-portal"]),e.resUrl_)){var f;window.parent.postMessage({type:"arcgis:auth:requestCredential"},this._appUrlObj.query["arcgis-auth-origin"]);const r=$e(window,"message",(e=>{e.source===window.parent&&e.data&&("arcgis:auth:credential"===e.data.type?(r.remove(),t(new Eg(e.data.credential))):"arcgis:auth:error"===e.data.type&&(r.remove(),i(Be.fromJSON(e.data.error))))}));ot(null==(f=e.options_)?void 0:f.signal,(()=>{r.remove()}))}else if(u){let r=u._oAuthCred;if(!r){const e=new vg(u,Mg),t=new vg(u,Tg);e.isValid()&&t.isValid()?e.expires>t.expires?(r=e,t.destroy()):(r=t,e.destroy()):r=e.isValid()?e:t,u._oAuthCred=r}if(r.isValid())p=new Eg({userId:r.userId,server:h.server,token:r.token,expires:r.expires,ssl:r.ssl,_oAuthCred:r}),u.appId!==r.appId&&this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._exchangeToken(p.server,u.appId,p.token).then((e=>{p.token=e,r.token=e,r.save(),t(p)})).catch((()=>{t(p)})):t(p);else if(this._oAuthHash&&this._hasSameServerInstance(u.portalUrl,this._oAuthHash.state.portalUrl)){const e=this._oAuthHash;p=new Eg({userId:e.username,server:h.server,token:e.access_token,expires:Date.now()+1e3*Number(e.expires_in),ssl:"true"===e.ssl,oAuthState:e.state,_oAuthCred:r}),u.userId=p.userId,r.storage=e.persist?Mg:Tg,r.token=p.token,r.expires=p.expires,r.userId=p.userId,r.ssl=p.ssl,r.save(),this._oAuthHash=null,t(p)}else{const r=()=>{c?e._pendingDfd=this.oAuthSignIn(e.resUrl_,h,u,e.options_).then(t,i):(d=new Be("identity-manager:not-authenticated","User is not signed in."),i(d))};this._doPortalSignIn(e.resUrl_)?e._pendingDfd=this._getPlatformSelf(h.server,u.appId).then((({portalUrl:e,token:i,username:s})=>{!e||si(e,this._appOrigin,!0)?(p=new Eg({server:h.server,userId:s,token:i}),t(p)):r()})).catch(r):r()}}else if(c){if(this._checkProtocol(e.resUrl_,h,i,e.admin_)){let r=e.options_;e.admin_&&(r=r||{},r.isAdmin=!0),e._pendingDfd=this.signIn(e.resUrl_,h,r).then(t,i)}}else d=new Be("identity-manager:not-authenticated","User is not signed in."),i(d)},s=()=>{const r=e.sinfo_,s=r.owningSystemUrl,n=e.options_;let o,a,l,h;if(n&&(o=n.token,a=n.error,l=n.prompt),h=this._findCredential(s,{token:o,resource:e.resUrl_}),!h)for(const e of this.credentials)if(this._isIdProvider(s,e.server)){h=e;break}if(h){const s=this.findCredential(e.resUrl_,h.userId);if(s)t(s);else if(Sg(r,this._legacyFed)){const e=h.toJSON();e.server=r.server,e.resources=null,t(new Eg(e))}else(e._pendingDfd=this.generateToken(this.findServerInfo(h.server),null,{serverUrl:e.resUrl_,token:h.token,signal:e.options_.signal,ssl:h.ssl})).then((i=>{t(new Eg({userId:h.userId,server:r.server,token:i.token,expires:null!=i.expires?Number(i.expires):null,ssl:!!i.ssl,isAdmin:e.admin_,validity:i.validity}))}),i)}else this._busy=null,o&&(e.options_.token=null),(e._pendingDfd=this.getCredential(s.replace(/\/?$/,"/sharing"),{resource:e.resUrl_,owningTenant:r.owningTenant,signal:e.options_.signal,token:o,error:a,prompt:l})).then((()=>{this._enqueue(e.resUrl_,e.sinfo_,e.options_,e,e.admin_)}),(e=>{i(e)}))};this._errbackFunc=i;const n=e.sinfo_.owningSystemUrl,o=this._isServerRsrc(e.resUrl_),a=e.sinfo_._restInfoPms;a?a.promise.then((t=>{const i=e.sinfo_;if(i._restInfoPms){i.adminTokenServiceUrl=i._restInfoPms.adminUrl,i._restInfoPms=null,i.tokenServiceUrl=J("authInfo.tokenServicesUrl",t)||J("authInfo.tokenServiceUrl",t)||J("tokenServiceUrl",t),i.shortLivedTokenValidity=J("authInfo.shortLivedTokenValidity",t),i.currentVersion=t.currentVersion,i.owningTenant=t.owningTenant;const e=i.owningSystemUrl=t.owningSystemUrl;e&&this._portals.push(e)}o&&i.owningSystemUrl?s():r()}),(()=>{e.sinfo_._restInfoPms=null;const t=new Be("identity-manager:server-identification-failed","Unknown resource - could not find token service endpoint.");i(t)})):o&&n?s():e.sinfo_._selfReq?e.sinfo_._selfReq.selfDfd.then((t=>{const i={};let r,s,n,o;return t&&(r=t.user&&t.user.username,i.username=r,i.allSSL=t.allSSL,s=t.supportsOAuth,n=t.currentVersion,"multitenant"===t.portalMode&&(o=t.customBaseUrl)),e.sinfo_.webTierAuth=!!r,r&&this.normalizeWebTierAuth?this.generateToken(e.sinfo_,null,{ssl:i.allSSL}).catch((()=>null)).then((e=>(i.portalToken=e&&e.token,i.tokenExpiration=e&&e.expires,i))):!r&&s&&parseFloat(n)>=4.4&&!this._findOAuthInfo(e.resUrl_)?this._generateOAuthInfo({portalUrl:e.sinfo_.server,customBaseUrl:o,owningTenant:e.sinfo_._selfReq.owningTenant}).catch((()=>null)).then((()=>i)):i})).catch((()=>null)).then((t=>{e.sinfo_._selfReq=null,t?r(t.username,t.allSSL,t.portalToken,t.tokenExpiration):r()})):r()}_generateOAuthInfo(e){let t,i,r=e.portalUrl;const s=e.customBaseUrl,n=e.owningTenant,o=!this.defaultOAuthInfo&&this._createDefaultOAuthInfo&&!this._hasTestedIfAppIsOnPortal;if(o){i=window.location.href;let e=i.indexOf("?");e>-1&&(i=i.slice(0,e)),e=i.search(/\/(apps|home)\//),i=e>-1?i.slice(0,e):null}return o&&i?(this._hasTestedIfAppIsOnPortal=!0,t=$i(i+"/sharing/rest",{query:{f:"json"}}).then((()=>{this.defaultOAuthInfo=new Ql({appId:"arcgisonline",popupCallbackUrl:i+"/home/oauth-callback.html"})}))):t=Promise.resolve(),t.then((()=>{if(this.defaultOAuthInfo)return r=r.replace(/^http:/i,"https:"),$i(r+"/sharing/rest/oauth2/validateRedirectUri",{query:{accountId:n,client_id:this.defaultOAuthInfo.appId,redirect_uri:ai(this.defaultOAuthInfo.popupCallbackUrl),f:"json"}}).then((e=>{if(e.data.valid){const t=this.defaultOAuthInfo.clone();e.data.urlKey&&s?t.portalUrl="https://"+e.data.urlKey.toLowerCase()+"."+s:t.portalUrl=r,t.popup=window!==window.top||!(si(r,this._appOrigin)||this._gwDomains.some((e=>e.regex.test(r)&&e.regex.test(this._appOrigin)))),this.oAuthInfos.push(t)}}))}))}_doOAuthSignIn(e,t,i){const r={portalUrl:i.portalUrl};!i.popup&&i.preserveUrlHash&&window.location.hash&&(r.hash=window.location.hash);const s={client_id:i.appId,response_type:"token",state:JSON.stringify(r),expiration:i.expiration,locale:i.locale,redirect_uri:i.popup?ai(i.popupCallbackUrl):window.location.href.replace(/#.*$/,"")};i.forceLogin&&(s.force_login=!0),i.forceUserId&&i.userId&&(s.prepopulatedusername=i.userId),!i.popup&&this._doPortalSignIn(e)&&(s.redirectToUserOrgUrl=!0);const n=i.portalUrl.replace(/^http:/i,"https:")+"/sharing/oauth2/authorize",o=n+"?"+Kt(s);if(i.popup){const e=window.open(o,"esriJSAPIOAuth",i.popupWindowFeatures);if(e)e.focus(),this._oAuthDfd.oAuthWin_=e,this._oAuthIntervalId=setInterval((()=>{if(e.closed){clearInterval(this._oAuthIntervalId),this._oAuthOnHashHandle.remove();const e=this._oAuthDfd;if(e){const t=new Be("identity-manager:user-aborted","ABORTED");e.reject(t)}}}),500),this._oAuthOnHashHandle=$e(h,"arcgis:auth:hash",(e=>{this.setOAuthResponseHash(e.detail)}));else{const e=new Be("identity-manager:popup-blocked","ABORTED");this._oAuthDfd.reject(e)}}else this._rejectOnPersistedPageShow=!0,this._oAuthRedirectFunc?this._oAuthRedirectFunc({authorizeParams:s,authorizeUrl:n,resourceUrl:e,serverInfo:t,oAuthInfo:i}):window.location.href=o}}Ig.prototype.declaredClass="esri.identity.IdentityManagerBase";let Eg=class extends sh.EventedAccessor{constructor(e){super(e),this._oAuthCred=null,this.tokenRefreshBuffer=2,e&&e._oAuthCred&&(this._oAuthCred=e._oAuthCred)}initialize(){this.resources=this.resources||[],null==this.creationTime&&(this.creationTime=Date.now())}refreshToken(){const e=Ui.findServerInfo(this.server),t=e&&e.owningSystemUrl,i=!!t&&"server"===this.scope,r=i&&Sg(e,Ui._legacyFed),s=e.webTierAuth,n=s&&Ui.normalizeWebTierAuth,o=_g[this.server],a=o&&o[this.userId];let l,h=this.resources&&this.resources[0],c=i&&Ui.findServerInfo(t),u={username:this.userId,password:a};if(s&&!n)return;i&&!c&&Ui.serverInfos.some((e=>(Ui._isIdProvider(t,e.server)&&(c=e),!!c)));const p=c&&Ui.findCredential(c.server,this.userId);if(!i||p){if(!r){if(i)l={serverUrl:h,token:p&&p.token,ssl:p&&p.ssl};else if(n)u=null,l={ssl:this.ssl};else{if(!a){let t;return h&&(h=Ui._sanitizeUrl(h),this._enqueued=1,t=Ui._enqueue(h,e,null,null,this.isAdmin,this),t.then((()=>{this._enqueued=0,this.refreshServerTokens()})).catch((()=>{this._enqueued=0}))),t}this.isAdmin&&(l={isAdmin:!0})}return Ui.generateToken(i?c:e,i?null:u,l).then((e=>{this.token=e.token,this.expires=null!=e.expires?Number(e.expires):null,this.creationTime=Date.now(),this.validity=e.validity,this.emitTokenChange(),this.refreshServerTokens()})).catch((()=>{}))}p.refreshToken()}}refreshServerTokens(){"portal"===this.scope&&Ui.credentials.forEach((e=>{const t=Ui.findServerInfo(e.server),i=t&&t.owningSystemUrl;e!==this&&e.userId===this.userId&&i&&"server"===e.scope&&(Ui._hasSameServerInstance(this.server,i)||Ui._isIdProvider(i,this.server))&&(Sg(t,Ui._legacyFed)?(e.token=this.token,e.expires=this.expires,e.creationTime=this.creationTime,e.validity=this.validity,e.emitTokenChange()):e.refreshToken())}))}emitTokenChange(e){clearTimeout(this._refreshTimer);const t=this.server&&Ui.findServerInfo(this.server),i=t&&t.owningSystemUrl,r=i&&Ui.findServerInfo(i);!1===e||i&&"portal"!==this.scope&&(!r||!r.webTierAuth||Ui.normalizeWebTierAuth)||null==this.expires&&null==this.validity||this._startRefreshTimer(),this.emit("token-change")}destroy(){this.userId=this.server=this.token=this.expires=this.validity=this.resources=this.creationTime=null,this._oAuthCred&&(this._oAuthCred.destroy(),this._oAuthCred=null);const e=Ui.credentials.indexOf(this);e>-1&&Ui.credentials.splice(e,1),this.emitTokenChange(),this.emit("destroy")}toJSON(){const e=q({userId:this.userId,server:this.server,token:this.token,expires:this.expires,validity:this.validity,ssl:this.ssl,isAdmin:this.isAdmin,creationTime:this.creationTime,scope:this.scope}),t=this.resources;return t&&t.length>0&&(e.resources=t.slice()),e}_startRefreshTimer(){clearTimeout(this._refreshTimer);const e=6e4*this.tokenRefreshBuffer,t=2**31-1;let i=(this.validity?this.creationTime+6e4*this.validity:this.expires)-Date.now();i<0?i=0:i>t&&(i=t),this._refreshTimer=setTimeout(this.refreshToken.bind(this),i>e?i-e:i)}};Q([ro()],Eg.prototype,"creationTime",void 0),Q([ro()],Eg.prototype,"expires",void 0),Q([ro()],Eg.prototype,"isAdmin",void 0),Q([ro()],Eg.prototype,"oAuthState",void 0),Q([ro()],Eg.prototype,"resources",void 0),Q([ro()],Eg.prototype,"scope",void 0),Q([ro()],Eg.prototype,"server",void 0),Q([ro()],Eg.prototype,"ssl",void 0),Q([ro()],Eg.prototype,"token",void 0),Q([ro()],Eg.prototype,"tokenRefreshBuffer",void 0),Q([ro()],Eg.prototype,"userId",void 0),Q([ro()],Eg.prototype,"validity",void 0),Eg=Q([Ro("esri.identity.Credential")],Eg);class Ag extends Ig{}Ag.prototype.declaredClass="esri.identity.IdentityManager";const Pg=new Ag;!function(e){Ui=e}(Pg);var Cg=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Pg});function Og(e,t,i=xh){return t||(t=new i),t===e||(t.removeAll(),(r=e)&&(Array.isArray(r)||"items"in r&&Array.isArray(r.items))?t.addMany(e):e&&t.add(e)),t;var r}function kg(e){return e}function Lg(e,t,i){return pt(e.map(((e,r)=>t.apply(i,[e,r]))))}function Rg(e){return v(e)?yt():e.then((e=>({ok:!0,value:e}))).catch((e=>({ok:!1,error:e})))}function Dg(e){return e.then((e=>({ok:!0,value:e}))).catch((e=>(st(e),{ok:!1,error:e})))}async function Fg(e,t){return await e.load(),jg(e,t)}async function jg(e,t){const i=[],r=(...e)=>{for(const t of e)v(t)||(Array.isArray(t)?r(...t):xh.isCollection(t)?t.forEach((e=>r(e))):ra.isLoadable(t)&&i.push(t))};t(r);let s=null;if(await function(e,t,i){return pt(e.map(((e,r)=>t.apply(i,[e,r])))).then((e=>e.map((e=>e.value))))}(i,(async e=>{!1!==(await Rg(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load())).ok||s||(s=e)})),s)throw s.loadError;return e}const Ng=Ne.getLogger("esri.portal.PortalItemResource");let zg=class extends jo{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?l(a({},e),{path:this.normalizePath(e.path,e.portalItem)}):e}set path(e){m(e)&&pi(e)?Ng.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this.normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(v(i))throw new Be("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:R(t,"signal")})}async update(e,t){return(await import("./resourceUtils.7e2a0fbf.js")).addOrUpdateResource(this,"update",e,t)}hasPath(){return m(this.path)}normalizePath(e,t){return v(e)?e:(e=e.replace(/^\/+/,""),m(t)&&pi(e)&&(e=li(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};Q([ro()],zg.prototype,"portalItem",void 0),Q([ro({type:String,value:null})],zg.prototype,"path",null),Q([Ra("path")],zg.prototype,"_castPath",null),Q([ro({type:String,readOnly:!0})],zg.prototype,"url",null),Q([ro({type:String,readOnly:!0})],zg.prototype,"itemRelativeUrl",null),zg=Q([Ro("esri.portal.PortalItemResource")],zg);var Vg=zg;let Ug=class extends jo{constructor(e){super(e),this.created=null,this.rating=null}};Q([ro()],Ug.prototype,"created",void 0),Q([ro()],Ug.prototype,"rating",void 0),Ug=Q([Ro("esri.portal.PortalRating")],Ug);var Gg,Bg=Ug;let qg=Gg=class extends(Jo(ra)){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return Un(Gg,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return"Feature Service"===e||"Feature Collection"===e?i=t.indexOf("Table")>-1?"Table":t.indexOf("Route Layer")>-1?"Route Layer":t.indexOf("Markup")>-1?"Markup":"Feature Layer":"Image Service"===e?i=t.indexOf("Elevation 3D Layer")>-1?"Elevation Layer":t.indexOf("Tiled Imagery")>-1?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===e?i="Scene Layer":"Scene Package"===e?i="Scene Layer Package":"Stream Service"===e?i="Feature Layer":"Geoprocessing Service"===e&&this.portal&&this.portal.isPortal?i=t.indexOf("Web Tool")>-1?"Tool":"Geoprocessing Service":"Geocoding Service"===e?i="Locator":"Geoenrichment Service"===e?i="GeoEnrichment Service":"Microsoft Powerpoint"===e?i="Microsoft PowerPoint":"GeoJson"===e?i="GeoJSON":"Globe Service"===e?i="Globe Layer":"Vector Tile Service"===e?i="Tile Layer":"netCDF"===e?i="NetCDF":"Map Service"===e?i=-1===t.indexOf("Spatiotemporal")&&(t.indexOf("Hosted Service")>-1||t.indexOf("Tiled")>-1)&&-1===t.indexOf("Relational")?"Tile Layer":"Map Image Layer":e&&e.toLowerCase().indexOf("add in")>-1?i=e.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===e?i="Big Data File Share":"Compact Tile Package"===e?i="Tile Package (tpkx)":"OGCFeatureServer"===e&&(i="OGC Feature Layer"),i}readExtent(e){return e&&e.length?new Ol(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[];let i,r=!1,s=!1,n=!1,o=!1,a=!1,l=!1;return e.indexOf("service")>0||"feature collection"===e||"kml"===e||"wms"===e||"wmts"===e||"wfs"===e?(r=t.indexOf("Hosted Service")>-1,"feature service"===e||"feature collection"===e||"kml"===e||"wfs"===e?(s=t.indexOf("Table")>-1,n=t.indexOf("Route Layer")>-1,o=t.indexOf("Markup")>-1,a=-1!==t.indexOf("Spatiotemporal"),l=-1!==t.indexOf("UtilityNetwork"),i=a&&s?"spatiotemporaltable":s?"table":n?"routelayer":o?"markup":a?"spatiotemporal":r?"featureshosted":l?"utilitynetwork":"features"):i="map service"===e||"wms"===e||"wmts"===e?r||t.indexOf("Tiled")>-1||"wmts"===e?"maptiles":"mapimages":"scene service"===e?t.indexOf("Line")>-1?"sceneweblayerline":t.indexOf("3DObject")>-1?"sceneweblayermultipatch":t.indexOf("Point")>-1?"sceneweblayerpoint":t.indexOf("IntegratedMesh")>-1?"sceneweblayermesh":t.indexOf("PointCloud")>-1?"sceneweblayerpointcloud":t.indexOf("Polygon")>-1?"sceneweblayerpolygon":t.indexOf("Building")>-1?"sceneweblayerbuilding":t.indexOf("Voxel")>-1?"sceneweblayervoxel":"sceneweblayer":"image service"===e?t.indexOf("Elevation 3D Layer")>-1?"elevationlayer":t.indexOf("Tiled Imagery")>-1?"tiledimagerylayer":"imagery":"stream service"===e?"streamlayer":"vector tile service"===e?"vectortile":"datastore catalog service"===e?"datastorecollection":"geocoding service"===e?"geocodeservice":"geoprocessing service"===e&&t.indexOf("Web Tool")>-1&&this.portal&&this.portal.isPortal?"tool":"layers"):i="web map"===e||"cityengine web scene"===e?"maps":"web scene"===e?t.indexOf("ViewingMode-Local")>-1?"webscenelocal":"websceneglobal":"web mapping application"===e||"mobile application"===e||"application"===e||"operation view"===e||"desktop application"===e?"apps":"map document"===e||"map package"===e||"published map"===e||"scene document"===e||"globe document"===e||"basemap package"===e||"mobile basemap package"===e||"mobile map package"===e||"project package"===e||"project template"===e||"pro map"===e||"layout"===e||"layer"===e&&t.indexOf("ArcGIS Pro")>-1||"explorer map"===e&&t.indexOf("Explorer Document")?"mapsgray":"service definition"===e||"csv"===e||"shapefile"===e||"cad drawing"===e||"geojson"===e||"360 vr experience"===e||"netcdf"===e||"administrative report"===e?"datafiles":"explorer add in"===e||"desktop add in"===e||"windows viewer add in"===e||"windows viewer configuration"===e?"appsgray":"arcgis pro add in"===e||"arcgis pro configuration"===e?"addindesktop":"rule package"===e||"file geodatabase"===e||"sqlite geodatabase"===e||"csv collection"===e||"kml collection"===e||"windows mobile package"===e||"map template"===e||"desktop application template"===e||"gml"===e||"arcpad package"===e||"code sample"===e||"form"===e||"document link"===e||"earth configuration"===e||"operations dashboard add in"===e||"rules package"===e||"image"===e||"workflow manager package"===e||"explorer map"===e&&t.indexOf("Explorer Mapping Application")>-1||t.indexOf("Document")>-1?"datafilesgray":"network analysis service"===e||"geoprocessing service"===e||"geodata service"===e||"geometry service"===e||"geoprocessing package"===e||"locator package"===e||"geoprocessing sample"===e||"workflow manager service"===e?"toolsgray":"layer"===e||"layer package"===e||"explorer layer"===e?"layersgray":"scene package"===e?"scenepackage":"mobile scene package"===e?"mobilescenepackage":"tile package"===e||"compact tile package"===e?"tilepackage":"task file"===e?"taskfile":"report template"===e?"report-template":"statistical data collection"===e?"statisticaldatacollection":"insights workbook"===e?"workbook":"insights model"===e?"insightsmodel":"insights page"===e?"insightspage":"insights theme"===e?"insightstheme":"hub initiative"===e?"hubinitiative":"hubpage"===e?"hubpage":"hub event"===e?"hubevent":"hub site application"===e?"hubsite":"relational database connection"===e?"relationaldatabaseconnection":"big data file share"===e?"datastorecollection":"image collection"===e?"imagecollection":"style"===e?"style":"desktop style"===e?"desktopstyle":"dashboard"===e?"dashboard":"raster function template"===e?"rasterprocessingtemplate":"vector tile package"===e?"vectortilepackage":"ortho mapping project"===e?"orthomappingproject":"ortho mapping template"===e?"orthomappingtemplate":"solution"===e?"solutions":"geopackage"===e?"geopackage":"deep learning package"===e?"deeplearningpackage":"real time analytic"===e?"realtimeanalytics":"big data analytic"===e?"bigdataanalytics":"feed"===e?"feed":"excalibur imagery project"===e?"excaliburimageryproject":"notebook"===e?"notebook":"storymap"===e?"storymap":"survey123 add in"===e?"survey123addin":"mission"===e?"mission":"mission report"===e?"missionreport":"quickcapture project"===e?"quickcaptureproject":"pro report"===e?"proreport":"urban model"===e?"urbanmodel":"web experience"===e?"experiencebuilder":"web experience template"===e?"webexperiencetemplate":"workflow"===e?"workflow":"insights script"===e?"insightsscript":"kernel gateway connection"===e?"kernelgatewayconnection":"hub initiative template"===e?"hubinitiativetemplate":"storymap theme"===e?"storymaptheme":"knowledge graph"===e?"knowledgegraph":"native application"===e?"nativeapp":"native application installer"===e?"nativeappinstaller":"link chart"===e?"linkchart":"investigation"===e?"investigation":"ogcfeatureserver"===e?"features":"pro project"===e?"proproject":"insights workbook package"===e?"insightsworkbookpackage":"maps",i?gr("esri/images/portal/"+i+"16.png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].indexOf(this.type)>-1}get itemUrl(){const e=this.get("portal.restUrl");return e?e+"/content/items/"+this.id:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Yl.getDefault());const t=this.portal.load(e).then((()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:m(e)?e.signal:null,query:{token:this.apiKey}}):{})).then((e=>{this.sourceJSON=e,this.read(e)}));return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof Bg&&(e=e.rating),isNaN(e)||"number"!=typeof e||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then((()=>new Bg({rating:e,created:new Date})))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:H(this.applicationProxies),avgRating:this.avgRating,categories:H(this.categories),created:H(this.created),culture:this.culture,description:this.description,extent:H(this.extent),groupCategories:H(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:H(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:H(this.screenshots),size:this.size,snippet:this.snippet,tags:H(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:H(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new Gg({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then((()=>{}))}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",l(a({responseType:e},t),{query:{token:this.apiKey}}))}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",a({query:{token:this.apiKey}},e)).then((e=>null!=e.rating?(e.created=new Date(e.created),new Bg(e)):null))}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",a({query:l(a({},e),{token:this.apiKey})},t),Gg)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then((e=>(this.sourceJSON=e,this.read(e),this)))}update(e){return this.id?this.load().then((()=>this.portal._signIn())).then((()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const e in i.query)null===i.query[e]&&(i.query[e]="");return i.query.clearEmptyFields=!0,null!=t&&("string"==typeof t?i.query.text=t:"object"==typeof t&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then((()=>this.reload()))})):Promise.reject(new Be("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then((()=>this.portal._signIn())).then((()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if("string"==typeof t)fi(t)?r.query={data:t}:r.query={url:ai(t)},m(i)&&(r.query.filename=i);else{const e=new FormData;m(i)?e.append("file",t,i):e.append("file",t),r.body=e}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then((()=>this.reload()))})):Promise.reject(new Be("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await import("./resourceUtils.7e2a0fbf.js")).fetchResources(this,e,t)}async addResource(e,t,i){const r=await import("./resourceUtils.7e2a0fbf.js");return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await import("./resourceUtils.7e2a0fbf.js");if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new Be("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await import("./resourceUtils.7e2a0fbf.js")).removeAllResources(this,e)}resourceFromPath(e){return new Vg({portalItem:this,path:e})}toJSON(){const e=this.extent;return q({created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,tags:this.tags,thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:this.typeKeywords,url:this.url})}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new Gg({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)"tags"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"typeKeywords"===t&&null!==e[t]&&(e[t]=e[t].join(", ")),"extent"===t&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};Q([ro({type:["private","shared","org","public"]})],qg.prototype,"access",void 0),Q([ro()],qg.prototype,"accessInformation",void 0),Q([ro({type:String})],qg.prototype,"apiKey",void 0),Q([ro({json:{read:{source:"appProxies"}}})],qg.prototype,"applicationProxies",void 0),Q([ro()],qg.prototype,"avgRating",void 0),Q([ro()],qg.prototype,"categories",void 0),Q([ro({type:Date})],qg.prototype,"created",void 0),Q([ro()],qg.prototype,"culture",void 0),Q([ro()],qg.prototype,"description",void 0),Q([ro({readOnly:!0})],qg.prototype,"displayName",null),Q([ro({type:Ol})],qg.prototype,"extent",void 0),Q([sa("extent")],qg.prototype,"readExtent",null),Q([ro()],qg.prototype,"groupCategories",void 0),Q([ro({readOnly:!0})],qg.prototype,"iconUrl",null),Q([ro()],qg.prototype,"id",void 0),Q([ro({readOnly:!0})],qg.prototype,"isLayer",null),Q([ro()],qg.prototype,"itemControl",void 0),Q([ro({readOnly:!0})],qg.prototype,"itemUrl",null),Q([ro()],qg.prototype,"licenseInfo",void 0),Q([ro({type:Date})],qg.prototype,"modified",void 0),Q([ro()],qg.prototype,"name",void 0),Q([ro()],qg.prototype,"numComments",void 0),Q([ro()],qg.prototype,"numRatings",void 0),Q([ro()],qg.prototype,"numViews",void 0),Q([ro()],qg.prototype,"owner",void 0),Q([ro()],qg.prototype,"ownerFolder",void 0),Q([ro({type:Yl})],qg.prototype,"portal",void 0),Q([ro()],qg.prototype,"screenshots",void 0),Q([ro()],qg.prototype,"size",void 0),Q([ro()],qg.prototype,"snippet",void 0),Q([ro()],qg.prototype,"sourceJSON",void 0),Q([ro()],qg.prototype,"tags",void 0),Q([ro()],qg.prototype,"thumbnail",void 0),Q([ro({readOnly:!0})],qg.prototype,"thumbnailUrl",null),Q([ro()],qg.prototype,"title",void 0),Q([ro()],qg.prototype,"type",void 0),Q([ro()],qg.prototype,"typeKeywords",void 0),Q([ro()],qg.prototype,"url",void 0),Q([ro({readOnly:!0})],qg.prototype,"userItemUrl",null),qg=Gg=Q([Ro("esri.portal.PortalItem")],qg);var Hg=qg,Wg=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Hg});const $g={streets:{id:"streets",get thumbnailUrl(){return gr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",get thumbnailUrl(){return gr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",get thumbnailUrl(){return gr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Boundaries and Places",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",get thumbnailUrl(){return gr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",get thumbnailUrl(){return gr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",get thumbnailUrl(){return gr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",get thumbnailUrl(){return gr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",get thumbnailUrl(){return gr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",get thumbnailUrl(){return gr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",get thumbnailUrl(){return gr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",get thumbnailUrl(){return gr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",get thumbnailUrl(){return gr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",get thumbnailUrl(){return gr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",get thumbnailUrl(){return gr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",get thumbnailUrl(){return gr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",get thumbnailUrl(){return gr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",get thumbnailUrl(){return gr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return gr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return gr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return gr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return gr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return gr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return gr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return gr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return gr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return gr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return gr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},Jg=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile"]),Xg=new Set(["csv","feature","geo-rss","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","tile","unknown","unsupported","vector-tile","web-tile","wfs"]);function Kg(e){return!("feature"!==e.type||e.url||!e.source||"memory"!==e.source.type)}function Yg(e,t){if(t.restrictedWebMapWriting){const i=function(e){return"basemap"===e.layerContainerType?Jg:"operational-layers"===e.layerContainerType?Xg:null}(t);return!m(i)||i.has(e.type)&&!Kg(e)}return!0}function Zg(e,t){"maxScale"in e&&(t.maxScale=Mo(e.maxScale)),"minScale"in e&&(t.minScale=Mo(e.minScale))}function Qg(e,t){if(function(e,t){if(Kg(e)){const i=J("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&Zg(e,r)}else"stream"===e.type?Zg(e,t.layerDefinition=t.layerDefinition||{}):"group"!==e.type&&Zg(e,t)}(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=Mo(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type)if(Kg(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function em(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new Be("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(Yg(e,i)){const t={};return e.write(t,i)?t:null}return m(t)&&Qg(e,t=H(t)),t}var tm;let im=0;const rm=Ne.getLogger("esri.Basemap");let sm=tm=class extends(Jo(ra)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+im++,this.baseLayers=new xh,this.referenceLayers=new xh;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&rm.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=e=>{e.parent=null};this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>i(e.item))),this.referenceLayers.on("after-remove",(e=>i(e.item)))}initialize(){this.when().catch((e=>{rm.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const i=this.referenceLayers.removeAll();for(const r of i)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),null==(e=this.portalItem)||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=a({},e)).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Og(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e?(i=l(a({},i),{layerContainerType:"basemap"}),this.baseLayers.forEach((e=>{const t=em(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);m(t)&&r.push(t)})),this.referenceLayers.forEach((e=>{const t=em(e,i.webmap?i.webmap.getLayerJSONFromResourceInfo(e):null,i);m(t)&&(t.isReference=!0,r.push(t))})),t.baseMapLayers=r):t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Og(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Fg(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new tm({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t=a({origin:"web-map"},t)),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=H(e);return t.url&&bi(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&bi(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;tt(e);const r=[];if(t){const i=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,i,e)),t.data.id&&!t.data.title){const e=t.data.id;r.push(async function(e){if(!e)return;const t=e.indexOf("-vector")>-1?e.slice(0,e.indexOf("-vector")):e,i=await Pt("esri/t9n/basemaps");return i[e]||i[t]}(e).then((e=>{e&&this.read({title:e},t.context)})))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&"web-scene"===r.origin?"web-scene":"web-map",{populateOperationalLayers:o}=await import("./layersCreator.0c4b594d.js"),a=[];if(tt(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const i={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},r=o(this.baseLayers,e.baseMapLayers.filter((e=>!e.isReference)),i);a.push(r);const l=o(this.referenceLayers,e.baseMapLayers.filter((e=>e.isReference)),i);a.push(l)}await pt(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=$t(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||Yl.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Yl.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=$g[e];return t?tm.fromJSON(t):null}};Q([ro({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:xh}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],sm.prototype,"baseLayers",null),Q([ro({type:String,json:{origins:{"web-scene":{write:!0}}}})],sm.prototype,"id",void 0),Q([ro({type:Hg})],sm.prototype,"portalItem",void 0),Q([ro()],sm.prototype,"referenceLayers",null),Q([ro({readOnly:!0})],sm.prototype,"resourceInfo",void 0),Q([ro({type:Aa})],sm.prototype,"spatialReference",void 0),Q([ro()],sm.prototype,"thumbnailUrl",void 0),Q([ro({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],sm.prototype,"title",void 0),Q([na("title")],sm.prototype,"writeTitle",null),sm=tm=Q([Ro("esri.Basemap")],sm);var nm=sm,om=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:nm});const am={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,5,10]};function lm(e){var t;return null!=(t=am[e.toLowerCase()])?t:null}function hm(e){const t=lm(e);return t?[...t]:t}function cm(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function um(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(256*cm(o,n,s+1/3)),Math.round(256*cm(o,n,s)),Math.round(256*cm(o,n,s-1/3)),r]}function pm(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?9===e.length:5===e.length;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function dm(){return[0,0,0]}function fm(e){return[e[0],e[1],e[2]]}function ym(e,t,i){return[e,t,i]}function gm(e){const t=[0,0,0],i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function mm(e,t){return new Float64Array(e,t,3)}function vm(){return[0,0,0]}function bm(){return ym(1,1,1)}function wm(){return ym(1,0,0)}function _m(){return ym(0,1,0)}function xm(){return ym(0,0,1)}const Sm=[0,0,0],Mm=bm(),Tm=wm(),Im=_m(),Em=xm();Object.freeze({__proto__:null,create:dm,clone:fm,fromValues:ym,fromArray:gm,createView:mm,zeros:vm,ones:bm,unitX:wm,unitY:_m,unitZ:xm,ZEROS:Sm,ONES:Mm,UNIT_X:Tm,UNIT_Y:Im,UNIT_Z:Em});const Am=1e-6,Pm=Math.random,Cm=Math.PI/180,Om=180/Math.PI;function km(e){return e*Cm}function Lm(e){return e*Om}function Rm(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function Dm(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Fm(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function jm(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function Nm(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function zm(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Vm(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function Um(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Gm(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Bm(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function qm(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function Hm(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function Wm(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function $m(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function Jm(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Xm(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function Km(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function Ym(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function Zm(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function Qm(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],h=t[2];let c=s*h-n*l,u=n*a-r*h,p=r*l-s*a,d=s*p-n*u,f=n*c-r*p,y=r*u-s*c;const g=2*o;return c*=g,u*=g,p*=g,d*=2,f*=2,y*=2,e[0]=a+c+d,e[1]=l+u+f,e[2]=h+p+y,e}function ev(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}Object.freeze({__proto__:null,EPSILON:Am,RANDOM:Pm,toRadian:km,toDegree:Lm,equals:function(e,t){return Math.abs(e-t)<=Am*Math.max(1,Math.abs(e),Math.abs(t))}});const tv=[0,0,0],iv=[0,0,0];function rv(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function sv(e,t){const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Am*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Am*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Am*Math.max(1,Math.abs(s),Math.abs(a))}function nv(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const ov=Nm,av=zm,lv=Vm,hv=Bm,cv=qm,uv=Rm,pv=Hm;Object.freeze({__proto__:null,length:Rm,copy:Dm,set:Fm,add:jm,subtract:Nm,multiply:zm,divide:Vm,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},max:function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:Um,scaleAndAdd:Gm,distance:Bm,squaredDistance:qm,squaredLength:Hm,negate:Wm,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:$m,dot:Jm,cross:Xm,lerp:Km,hermite:function(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,h=o*(n-1),c=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*h+s[0]*c,e[1]=t[1]*a+i[1]*l+r[1]*h+s[1]*c,e[2]=t[2]*a+i[2]*l+r[2]*h+s[2]*c,e},bezier:function(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,h=a*o,c=3*n*a,u=3*l*o,p=l*n;return e[0]=t[0]*h+i[0]*c+r[0]*u+s[0]*p,e[1]=t[1]*h+i[1]*c+r[1]*u+s[1]*p,e[2]=t[2]*h+i[2]*c+r[2]*u+s[2]*p,e},random:function(e,t){t=t||1;const i=2*Pm()*Math.PI,r=2*Pm()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e},transformMat4:Ym,transformMat3:Zm,transformQuat:Qm,rotateX:function(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},rotateY:function(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e},rotateZ:ev,angle:function(e,t){Dm(tv,e),Dm(iv,t),$m(tv,tv),$m(iv,iv);const i=Jm(tv,iv);return i>1?0:i<-1?Math.PI:Math.acos(i)},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:rv,equals:sv,direction:nv,sub:ov,mul:av,div:lv,dist:hv,sqrDist:cv,len:uv,sqrLen:pv});const dv=new Float32Array(1),fv=Number.isFinite||function(e){return"number"==typeof e&&window.isFinite(e)},yv=Number.isNaN||function(e){return e!=e};function gv(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function mv(e,t,i){return Math.min(Math.max(e,t),i)}function vv(e){return 0==(e&e-1)}function bv(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}const wv=Math.sign||function(e){return+(e>0)-+(e<0)||+e},_v=Math.log2||function(e){return Math.log(e)/Math.LN2};function xv(e,t,i){return e+(t-e)*i}function Sv(e){return e*Math.PI/180}function Mv(e){return 180*e/Math.PI}function Tv(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Iv(e){return Math.acos(mv(e,-1,1))}function Ev(e){return Math.asin(mv(e,-1,1))}function Av(e,t,i=1e-6){return!yv(e)&&!yv(t)&&(e>t?e-t:t-e)<=i}function Pv(e,t){const i=Rm(e);return Fm(t,i,Ev(e[2]/i),Math.atan2(e[1]/i,e[0]/i)),t}var Cv,Ov;function kv(e){return mv(Dn(e),0,255)}function Lv(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}Cv=34028234663852886e22,dv[0]=Cv,dv[0];class Rv{constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}static blendColors(e,t,i,r=new Rv){return r.r=Math.round(e.r+(t.r-e.r)*i),r.g=Math.round(e.g+(t.g-e.g)*i),r.b=Math.round(e.b+(t.b-e.b)*i),r.a=e.a+(t.a-e.a)*i,r._sanitize()}static fromRgb(e,t){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const e=i[2].split(/\s*,\s*/),r=i[1];if("rgb"===r&&3===e.length||"rgba"===r&&4===e.length){const i=e[0];if("%"===i.charAt(i.length-1)){const i=e.map((e=>2.56*parseFloat(e)));return 4===e.length&&(i[3]=parseFloat(e[3])),Rv.fromArray(i,t)}return Rv.fromArray(e.map((e=>parseFloat(e))),t)}if("hsl"===r&&3===e.length||"hsla"===r&&4===e.length)return Rv.fromArray(um(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/100,parseFloat(e[3])),t)}return null}static fromHex(e,t=new Rv){if(4!==e.length&&7!==e.length||"#"!==e[0])return null;const i=4===e.length?4:8,r=(1<<i)-1;let s=Number("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach((e=>{const n=s&r;s>>=i,t[e]=4===i?17*n:n})),t.a=1,t)}static fromArray(e,t=new Rv){return t._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(t.a)&&(t.a=1),t._sanitize()}static fromString(e,t){const i=lm(e);return i&&Rv.fromArray(i,t)||Rv.fromRgb(e,t)||Rv.fromHex(e,t)}static fromJSON(e){return e&&new Rv([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return m(e)?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return m(e)?[e.r/255,e.g/255,e.b/255,null!=e.a?e.a:1]:null}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(e){if("string"==typeof e)Rv.fromString(e,this);else if(Array.isArray(e))Rv.fromArray(e,this);else{var t,i,r,s;this._set(null!=(t=e.r)?t:0,null!=(i=e.g)?i:0,null!=(r=e.b)?r:0,null!=(s=e.a)?s:1),e instanceof Rv||this._sanitize()}return this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}`}toCss(e=!1){const t=this.r+", "+this.g+", "+this.b;return e?`rgba(${t}, ${this.a})`:`rgb(${t})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=0){const t=kv(this.r),i=kv(this.g),r=kv(this.b);return 0===e||1!==this.a?[t,i,r,kv(255*this.a)]:[t,i,r]}clone(){return new Rv(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}_sanitize(){return this.r=Math.round(Lv(this.r,0,255)),this.g=Math.round(Lv(this.g,0,255)),this.b=Math.round(Lv(this.b,0,255)),this.a=Lv(this.a,0,1),this}_set(e,t,i,r){this.r=e,this.g=t,this.b=i,this.a=r}}function Dv(e){}function Fv(e){return()=>e}Rv.prototype.declaredClass="esri.Color";let jv=Ov=class extends Ko{constructor(e){super(e),this.type="none"}clone(){return new Ov({type:this.type})}};function Nv(e){const t=Dn(100*(1-e));return Math.max(0,Math.min(t,100))}function zv(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}var Vv;Q([th({none:"none",stayAbove:"stay-above"})],jv.prototype,"type",void 0),jv=Ov=Q([Ro("esri.ground.NavigationConstraint")],jv);const Uv=Ne.getLogger("esri.Ground");let Gv=Vv=class extends(Jo(ra)){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new xh;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"!==e.type&&"base-elevation"!==e.type&&Uv.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>(e=>{e.parent=null})(e.item)))}initialize(){this.when().catch((e=>{Uv.error("#load()","Failed to load ground",e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e=a({},e)).resourceInfo),e}set layers(e){this._set("layers",Og(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e?(r=l(a({},r),{layerContainerType:"ground"}),e.forEach((e=>{if("write"in e){const t={};Fv(e)().write(t,r)&&s.push(t)}else r&&r.messages&&r.messages.push(new Be("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in the ground`,{layer:e}))})),t.layers=s):t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Fg(this,(e=>{e(this.layers)}))}async queryElevation(e,t){await this.load({signal:null==t?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.4d67df96.js");tt(t);const r=new i,s=this.layers.filter(Bv).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:null==t?void 0:t.signal});const{ElevationQuery:i}=await import("./ElevationQuery.4d67df96.js");tt(t);const r=new i,s=this.layers.filter(Bv).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:H(this.surfaceColor),navigationConstraint:H(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new Vv({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return import("./layersCreator.0c4b594d.js").then((({populateOperationalLayers:t})=>{tt(i);const o=[];if(e.layers&&Array.isArray(e.layers)){const i={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};o.push(t(this.layers,e.layers,i))}return pt(o)})).then((()=>{}))}};function Bv(e){return"elevation"===e.type||function(e){return e&&"createElevationSampler"in e}(e)}Q([ro({json:{read:!1}})],Gv.prototype,"layers",null),Q([na("layers")],Gv.prototype,"writeLayers",null),Q([ro({readOnly:!0})],Gv.prototype,"resourceInfo",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Yn,read:{reader:zv,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Nv(e)},target:"transparency"}}})],Gv.prototype,"opacity",void 0),Q([ro({type:Rv,json:{type:[Yn],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],Gv.prototype,"surfaceColor",void 0),Q([ro({type:jv,json:{write:!0}})],Gv.prototype,"navigationConstraint",void 0),Gv=Vv=Q([Ro("esri.Ground")],Gv);var qv=Gv;let Hv=class extends jo{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new Mh,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i,r=0){const s=0!=(1&r),n=++this.handleId;s||this.installSyncUpdatingWatch(e,t,n);const o=0!=(2&r)?Rh(e,t,i,s):e.watch(t,i,s);return this.handles.add(o,n),{remove:()=>this.handles.remove(n)}}addOnCollectionPropertyChange(e,t,i,r=0){const s=0!=(2&r),n=++this.handleId;return this.handles.add([Hh(e,t,"after-changes",this.createSyncUpdatingCallback()),Hh(e,t,"change",i,s?e=>{i({added:e.items,removed:[],moved:[],target:e})}:void 0)],n),{remove:()=>{this.handles.remove(n)}}}addOnCollectionChange(e,t,i=0){const r=0!=(2&i),s=++this.handleId;return this.handles.add([e.on("after-changes",this.createSyncUpdatingCallback()),e.on("change",t)],s),r&&t({added:e.items,removed:[],moved:[],target:e}),{remove:()=>{this.handles.remove(s)}}}addPromise(e){if(v(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(0!==this.pendingPromises.size||this.handles.has(Wv)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(e,t,i){const r=dn((()=>Rr(e,t)),this.createSyncUpdatingCallback());return this.handles.add(r,i),r}createSyncUpdatingCallback(){return()=>{this.handles.remove(Wv),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(Qs((()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(Wv))})),Wv)}}};Q([ro({readOnly:!0})],Hv.prototype,"updating",void 0),Hv=Q([Ro("esri.views.support.WatchUpdatingTracking")],Hv);const Wv=-42,$v=e=>{let t=class extends e{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new Mh}get updatingHandles(){return this._get("updatingHandles")||new Hv}};return Q([ro({readOnly:!0})],t.prototype,"handles",null),Q([ro({readOnly:!0})],t.prototype,"updatingHandles",null),t=Q([Ro("esri.core.HandleOwner")],t),t};let Jv=class extends($v(jo)){};Jv=Q([Ro("esri.core.HandleOwner")],Jv);let Xv=class extends($v(xh)){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(function(e){let t=new cn((function r(){t&&!i&&(un?fn(r):(t.clear(),un=!0,i=!0,Xr(t,e),i=!1,un=!1,yn()))})),i=!1;return i=!0,Xr(t,e),i=!1,{remove:function(){t&&(t.destroy(),t=null)}}}((()=>this.refresh())))}destroy(){this.getCollections=null}refresh(){const e=m(this.getCollections)?this.getCollections():null;if(v(e))return void this.removeAll();let t=0;for(const i of e)m(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new xh(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:e=>!!e;for(const r of t)if(r){if(i(r)){const t=this.indexOf(r,e);t>=0?t!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const t=this.getChildrenFunction(r);if(Array.isArray(t))for(const i of t)e=this._processCollection(e,i);else e=this._processCollection(e,t)}}return e}};Q([ro()],Xv.prototype,"getCollections",void 0),Q([ro()],Xv.prototype,"getChildrenFunction",void 0),Q([ro()],Xv.prototype,"itemFilterFunction",void 0),Xv=Q([Ro("esri.core.CollectionFlattener")],Xv);var Kv=Xv;function Yv(e){var t;return!(!(e&&e.loaded&&"capabilities"in e&&null!=e&&null!=(t=e.capabilities)&&t.operations&&"supportsEditing"in e.capabilities.operations&&!0===e.capabilities.operations.supportsEditing)||"editingEnabled"in e&&!e.editingEnabled)}const Zv=Ne.getLogger("esri.support.basemapUtils");function Qv(e){for(const t in e){const i=e[t];!1===(null==i?void 0:i.destroyed)&&i.destroy(),delete e[t]}}function eb(e,t){var i;let r;if("string"==typeof e){if(!(e in $g)){const t=Object.keys($g).map((e=>`"${e}"`)).join(", ");return Zv.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${t}`),null}t&&(r=t[e]),r||(r=nm.fromId(e),t&&(t[e]=r))}else r=qn(nm,e);return null!=(i=r)&&i.destroyed&&(Zv.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function tb(e){let t=null;const i=function(e){return e?!e.loaded&&e.resourceInfo?sb(e.resourceInfo.data):{baseLayers:ib(e.baseLayers),referenceLayers:ib(e.referenceLayers)}:null}(e),r=!i.baseLayers.length;for(const s in $g){const e=ob(i,sb($g[s]),{mustMatchReferences:r});if("equal"===e){t=s;break}"base-layers-equal"===e&&(t=s)}return t}function ib(e){return(xh.isCollection(e)?e.toArray():e).map(rb)}function rb(e){return{type:e.type,url:hb("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible}}function sb(e){return e?{baseLayers:nb(e.baseMapLayers.filter((e=>!e.isReference))),referenceLayers:nb(e.baseMapLayers.filter((e=>e.isReference)))}:null}function nb(e){return e.map((e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;default:t="unknown"}return{type:t,url:hb(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:null!=e.minScale?e.minScale:0,maxScale:null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visibility||!!e.visibility}}(e)))}function ob(e,t,i){return null!=e!=(null!=t)?"not-equal":e?ab(e.baseLayers,t.baseLayers)?ab(e.referenceLayers,t.referenceLayers)?"equal":i.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function ab(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!lb(e[i],t[i]))return!1;return!0}function lb(e,t){return e.type===t.type&&e.url===t.url&&e.minScale===t.minScale&&e.maxScale===t.maxScale&&e.visible===t.visible&&e.opacity===t.opacity}function hb(e){return e?hi(e).replace(/^\s*https?:/i,"").toLowerCase():""}const cb=Ne.getLogger("esri.support.groundUtils"),ub={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function pb(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?4!==t.length||r||s?3===t.length&&i&&!r?(s=!0,r=!1):3===t.length&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var db;function fb(e){return(t,i)=>null==t?i:null==i?t:e(t,i)}let yb=db=class extends Ca{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):function(e){return e&&("esri.geometry.SpatialReference"===e.declaredClass||null!=e.wkid)}(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(void 0===i.hasZ&&void 0===i.hasM?(i.hasZ=r.length>2,i.hasM=!1):void 0===i.hasZ?i.hasZ=r.length>3:void 0===i.hasM&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new Ol,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=fb(Math.min),a=fb(Math.max);let l,h,c,u,[p,d]=n,[f,y]=n;for(let g=0,m=e.length;g<m;g++){const t=e[g],[n,m]=t;if(p=o(p,n),d=o(d,m),f=a(f,n),y=a(y,m),i&&t.length>2){const e=t[2];l=o(l,e),c=a(c,e)}if(r&&t.length>s){const e=t[s];h=o(h,e),u=a(u,e)}}return t.xmin=p,t.ymin=d,t.xmax=f,t.ymax=y,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=c):(t.zmin=null,t.zmax=null),r?(t.mmin=h,t.mmax=u):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=H(this.points)}addPoint(e){return pb(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:H(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new db(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new il(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new il(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(pb(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write(null,e)}_validateInputs(e){return null!=e&&e>=0&&e<this.points.length}};Q([ro({readOnly:!0})],yb.prototype,"cache",null),Q([ro()],yb.prototype,"extent",null),Q([ro({type:[[Number]],json:{write:{isRequired:!0}}})],yb.prototype,"points",void 0),Q([na("points")],yb.prototype,"writePoints",null),yb=db=Q([Ro("esri.geometry.Multipoint")],yb),yb.prototype.toJSON.isDefaultToJSON=!0;var gb=yb;function mb(e){if(!e)return null;if(Array.isArray(e))return e;const t=e.hasZ,i=e.hasM;if("point"===e.type)return i&&t?[e.x,e.y,e.z,e.m]:t?[e.x,e.y,e.z]:i?[e.x,e.y,e.m]:[e.x,e.y];if("polygon"===e.type)return e.rings.slice(0);if("polyline"===e.type)return e.paths.slice(0);if("multipoint"===e.type)return e.points.slice(0);if("extent"===e.type){const t=e.clone().normalize();if(!t)return null;let i=!1,r=!1;return t.forEach((e=>{e.hasZ&&(i=!0),e.hasM&&(r=!0)})),t.map((e=>{const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(i&&e.hasZ){const i=.5*(e.zmax-e.zmin);for(let e=0;e<t.length;e++)t[e].push(i)}if(r&&e.hasM){const i=.5*(e.mmax-e.mmin);for(let e=0;e<t.length;e++)t[e].push(i)}return t}))}return null}function vb(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function bb(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function wb(e,t,i,r){const[s,n]=t,[o,a]=i[r],[l,h]=i[r+1],c=l-o,u=h-a,p=c*c+u*u,d=(s-o)*c+(n-a)*u,f=Math.min(1,Math.max(0,d/p));return e[0]=o+c*f,e[1]=a+u*f,e}function _b(e,t){return bb(e,t,.5)}function xb(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=vb(e[r],e[r+1]);return i}function Sb(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const i=vb(e[s],e[s+1]);if(t-r<i){const n=(t-r)/i;return bb(e[s],e[s+1],n)}r+=i}return e[i-1]}function Mb(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],h=e[(a+1)%r];let c=2;s+=l[0]*h[1]-h[0]*l[1],l.length>2&&h.length>2&&i&&(n+=l[0]*h[2]-h[0]*l[2],c=3),l.length>c&&h.length>c&&t&&(o+=l[0]*h[c]-h[0]*l[c])}return s<=0&&n<=0&&o<=0}function Tb(e){if("rings"in e){for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]]);if(e.rings.length>0&&!Mb(e.rings[0],e.hasM,e.hasZ))for(let t=0;t<e.rings.length;++t)e.rings[t]=e.rings[t].reverse()}}function Ib(e){return"polygon"!==e.type&&"polyline"!==e.type||Eb("polygon"===e.type?e.rings:e.paths,e.spatialReference),e}function Eb(e,t){const i=ya(t);if(!i)return;const r=i.valid[0],s=i.valid[1],n=s-r;for(const o of e){let e=1/0,t=-1/0;o.forEach((i=>{let o=i[0];for(;o<r;)o+=n;for(;o>s;)o-=n;e=Math.min(e,o),t=Math.max(t,o),i[0]=o}));const i=t-e;n-i<i&&o.forEach((e=>{e[0]<0&&(e[0]+=n)}))}}function Ab(e){return e?Pb(e.rings,e.hasZ):null}function Pb(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const i=Cb(e[n],t,s);i&&r.push(i)}if(r.sort(((e,i)=>{let r=e[2]-i[2];return 0===r&&t&&(r=e[4]-i[4]),r})),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const r=e[0]&&e[0].length?function(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,h=e.length;l<h-1;l++){const h=e[l],c=e[l+1];if(h&&c){i[0]=h[0],i[1]=h[1],r[0]=c[0],r[1]=c[1],t&&h.length>2&&c.length>2&&(i[2]=h[2],r[2]=c[2]);const e=vb(i,r);if(e){s+=e;const i=_b(h,c);n+=e*i[0],o+=e*i[1],t&&i.length>2&&(a+=e*i[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}(e[0],t):null;if(!r)return null;i[0]=r[0],i[1]=r[1],t&&r.length>2&&(i[2]=r[2])}return i}function Cb(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,h=e.length?e[0][1]:0,c=e.length&&t?e[0][2]:0;for(let p=0;p<e.length;p++){const u=e[p],d=e[(p+1)%e.length],[f,y,g]=u,m=f-l,v=y-h,b=t?g-c:void 0,[w,_,x]=d,S=w-l,M=_-h,T=t?x-c:void 0,I=m*M-S*v;if(o+=I,r+=(m+S)*I,s+=(v+M)*I,t&&u.length>2&&d.length>2){const e=m*T-S*b;n+=(b+T)*e,a+=e}f<i[0]&&(i[0]=f),f>i[1]&&(i[1]=f),y<i[2]&&(i[2]=y),y>i[3]&&(i[3]=y),t&&(g<i[4]&&(i[4]=g),g>i[5]&&(i[5]=g))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const u=[r/(6*o)+l,s/(6*o)+h,o];return t&&(i[4]===i[5]||0===a?(u[3]=(i[4]+i[5])/2,u[4]=0):(u[3]=n/(6*a)+c,u[4]=a)),u}function Ob(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function kb(e){return void 0!==e.points}function Lb(e){return void 0!==e.x&&void 0!==e.y}function Rb(e){return void 0!==e.paths}function Db(e){return void 0!==e.rings}function Fb(e){return(t,i)=>null==t?i:null==i?t:e(t,i)}const jb=Fb(Math.min),Nb=Fb(Math.max);function zb(e,t){return Rb(t)?Ub(e,t.paths,!1,!1):Db(t)?Ub(e,t.rings,!1,!1):kb(t)?Bb(e,t.points,!1,!1,!1,!1):Ob(t)?Gb(e,t):(Lb(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Vb(e,t){return Rb(t)?Ub(e,t.paths,!0,!1):Db(t)?Ub(e,t.rings,!0,!1):kb(t)?Bb(e,t.points,!0,!1,!0,!1):Ob(t)?Gb(e,t,!0,!1,!0,!1):(Lb(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function Ub(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[h,c]=t[0][0],[u,p]=t[0][0];for(let d=0;d<t.length;d++){const e=t[d];for(let t=0;t<e.length;t++){const d=e[t],[f,y]=d;if(h=jb(h,f),c=jb(c,y),u=Nb(u,f),p=Nb(p,y),i&&d.length>2){const e=d[2];n=jb(n,e),o=Nb(o,e)}if(r&&d.length>s){const e=d[s];a=jb(n,e),l=Nb(o,e)}}}return i?r?(e[0]=h,e[1]=c,e[2]=n,e[3]=a,e[4]=u,e[5]=p,e[6]=o,e[7]=l,e.length=8,e):(e[0]=h,e[1]=c,e[2]=n,e[3]=u,e[4]=p,e[5]=o,e.length=6,e):r?(e[0]=h,e[1]=c,e[2]=a,e[3]=u,e[4]=p,e[5]=l,e.length=6,e):(e[0]=h,e[1]=c,e[2]=u,e[3]=p,e.length=4,e)}function Gb(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,h=t.ymax;let c=t.zmin,u=t.zmax,p=t.mmin,d=t.mmax;return s?(c=c||0,u=u||0,n?(p=p||0,d=d||0,e[0]=o,e[1]=l,e[2]=c,e[3]=p,e[4]=a,e[5]=h,e[6]=u,e[7]=d,e):(e[0]=o,e[1]=l,e[2]=c,e[3]=a,e[4]=h,e[5]=u,e)):n?(p=p||0,d=d||0,e[0]=o,e[1]=l,e[2]=p,e[3]=a,e[4]=h,e[5]=d,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=h,e)}function Bb(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let h,c,u,p,[d,f]=t[0],[y,g]=t[0];for(let m=0;m<t.length;m++){const e=t[m],[i,r]=e;if(d=jb(d,i),f=jb(f,r),y=Nb(y,i),g=Nb(g,r),l&&e.length>2){const t=e[2];h=jb(h,t),c=Nb(c,t)}if(a&&e.length>o){const t=e[o];u=jb(h,t),p=Nb(c,t)}}return s?(h=h||0,c=c||0,n?(u=u||0,p=p||0,e[0]=d,e[1]=f,e[2]=h,e[3]=u,e[4]=y,e[5]=g,e[6]=c,e[7]=p,e):(e[0]=d,e[1]=f,e[2]=h,e[3]=y,e[4]=g,e[5]=c,e)):n?(u=u||0,p=p||0,e[0]=d,e[1]=f,e[2]=u,e[3]=y,e[4]=g,e[5]=p,e):(e[0]=d,e[1]=f,e[2]=y,e[3]=g,e)}const qb=[];function Hb(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function Wb(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function $b(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Jb(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function Xb(e,t=!1,i=!1){return t?i?Jb(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Wb(e[0],e[1],e[2],e[3],e[4],e[5]):i?$b(e[0],e[1],e[2],e[3],e[4],e[5]):Hb(e[0],e[1],e[2],e[3])}function Kb(e){return e?function(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}(e)?e:function(e){return void 0!==e.x&&void 0!==e.y}(e)?function(e){const{x:t,y:i,z:r,m:s}=e,n=null!=s;return null!=r?n?Jb(t,i,r,s,t,i,r,s):Wb(t,i,r,t,i,r):n?$b(t,i,s,t,i,s):Hb(t,i,t,i)}(e):function(e){return void 0!==e.rings}(e)?Yb(e):function(e){return void 0!==e.paths}(e)?Zb(e):function(e){return void 0!==e.points}(e)?function(e){const{hasZ:t,hasM:i,points:r}=e;return Xb(Bb(qb,r,t,i),t,i)}(e):null:null}function Yb(e){const{hasZ:t,hasM:i,rings:r}=e,s=Ub(qb,r,t,i);return s?Xb(s,t,i):null}function Zb(e){const{hasZ:t,hasM:i,paths:r}=e,s=Ub(qb,r,t,i);return s?Xb(s,t,i):null}var Qb;function ew(e){return!Array.isArray(e[0])}let tw=Qb=class extends Ca{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;t.map((e=>{e.hasZ&&(r=!0),e.hasM&&(s=!0)}));const n={rings:t.map((function(e){const t=[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]];if(r&&e.hasZ){const i=e.zmin+.5*(e.zmax-e.zmin);for(let e=0;e<t.length;e++)t[e].push(i)}if(s&&e.hasM){const i=e.mmin+.5*(e.mmax-e.mmin);for(let e=0;e<t.length;e++)t[e].push(i)}return t})),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new Qb(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Aa.WGS84,s.length&&s[0]&&null!=s[0][0]&&"number"==typeof s[0][0]&&(s=[s]),n=s[0]&&s[0][0],n&&(void 0===i&&void 0===r?(i=n.length>2,r=n.length>3):void 0===i?i=r?n.length>3:n.length>2:void 0===r&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=Ab(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new il;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Yb(this);if(!t)return null;const i=new Ol(t);return i.spatialReference=e,i}get isSelfIntersecting(){return function(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const r=i[s],n=i[s+1];for(let i=t+1;i<e.length;i++)for(let t=0;t<e[i].length-1;t++){const s=e[i][t],o=e[i][t+1];if(Tl(r,n,s,o,Sl)&&!(Sl[0]===r[0]&&Sl[1]===r[1]||Sl[0]===s[0]&&Sl[1]===s[1]||Sl[0]===n[0]&&Sl[1]===n[1]||Sl[0]===o[0]&&Sl[1]===o[1]))return!0}}const r=i.length;if(!(r<=4))for(let e=0;e<r-3;e++){let t=r-1;0===e&&(t=r-2);const s=i[e],n=i[e+1];for(let r=e+2;r<t;r++){const e=i[r],t=i[r+1];if(Tl(s,n,e,t,Sl)&&!(Sl[0]===s[0]&&Sl[1]===s[1]||Sl[0]===e[0]&&Sl[1]===e[1]||Sl[0]===n[0]&&Sl[1]===n[1]||Sl[0]===t[0]&&Sl[1]===t[1]))return!0}}}return!1}(this.rings)}writeRings(e,t){t.rings=H(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(ew(e)){const r=[];for(let t=0,i=e.length;t<i;t++)r[t]=e[t].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new Qb;return e.spatialReference=this.spatialReference,e.rings=H(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}contains(e){return!!e&&(Ha(e,this.spatialReference)&&(e=Wa(e,this.spatialReference)),hl(this,e))}isClockwise(e){let t;return t=ew(e)?e.map((e=>this.hasZ?this.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])):e,Mb(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new il(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new il(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new il(i[0],i[1],i[2],i[3],this.spatialReference):new il(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(pb(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new il(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map((e=>new il(e,i)));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(pb(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(null==e||e<0||e>=this.rings.length)return!1;if(null!=t){const r=this.rings[e];if(i&&(t<0||t>r.length))return!1;if(!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write(null,e)}};Q([ro({readOnly:!0})],tw.prototype,"cache",null),Q([ro({readOnly:!0})],tw.prototype,"centroid",null),Q([ro({readOnly:!0})],tw.prototype,"extent",null),Q([ro({readOnly:!0})],tw.prototype,"isSelfIntersecting",null),Q([ro({type:[[[Number]]],json:{write:{isRequired:!0}}})],tw.prototype,"rings",void 0),Q([na("rings")],tw.prototype,"writeRings",null),tw=Qb=Q([Ro("esri.geometry.Polygon")],tw),tw.prototype.toJSON.isDefaultToJSON=!0;var iw,rw=tw;let sw=iw=class extends Ca{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||Aa.WGS84,s.length&&s[0]&&null!=s[0][0]&&"number"==typeof s[0][0]&&(s=[s]),n=s[0]&&s[0][0],n&&(void 0===i&&void 0===r?(i=n.length>2,r=!1):void 0===i?i=!r&&n.length>3:void 0===r&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Zb(this);if(!t)return null;const i=new Ol(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=H(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(function(e){return!Array.isArray(e[0])}(e)){const r=[];for(let t=0,i=e.length;t<i;t++)r[t]=e[t].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new iw;return e.spatialReference=this.spatialReference,e.paths=H(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new il(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new il(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new il(i[0],i[1],i[2],i[3],this.spatialReference):new il(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(pb(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map((e=>new il(e,i)));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new il(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(pb(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(null==e||e<0||e>=this.paths.length)return!1;if(null!=t){const r=this.paths[e];if(i&&(t<0||t>r.length))return!1;if(!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write(null,e)}};Q([ro({readOnly:!0})],sw.prototype,"cache",null),Q([ro({readOnly:!0})],sw.prototype,"extent",null),Q([ro({type:[[[Number]]],json:{write:{isRequired:!0}}})],sw.prototype,"paths",void 0),Q([na("paths")],sw.prototype,"writePaths",null),sw=iw=Q([Ro("esri.geometry.Polyline")],sw),sw.prototype.toJSON.isDefaultToJSON=!0;var nw=sw;const ow=te()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),aw=te()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function lw(e){return void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax}function hw(e){return void 0!==e.points}function cw(e){return void 0!==e.x&&void 0!==e.y}function uw(e){return void 0!==e.paths}function pw(e){return void 0!==e.rings}function dw(e){return e?e instanceof Ca?e:cw(e)?il.fromJSON(e):uw(e)?nw.fromJSON(e):pw(e)?rw.fromJSON(e):hw(e)?gb.fromJSON(e):lw(e)?Ol.fromJSON(e):null:null}function fw(e){return e?cw(e)?"esriGeometryPoint":uw(e)?"esriGeometryPolyline":pw(e)?"esriGeometryPolygon":lw(e)?"esriGeometryEnvelope":hw(e)?"esriGeometryMultipoint":null:null}const yw={esriGeometryPoint:il,esriGeometryPolyline:nw,esriGeometryPolygon:rw,esriGeometryEnvelope:Ol,esriGeometryMultipoint:gb};function gw(e){return e&&yw[e]||null}const mw={base:Ca,key:"type",typeMap:{extent:Ol,multipoint:gb,point:il,polyline:nw,polygon:rw}};Kn(mw);let vw=0;const bw=e=>{let t=class extends e{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+vw++})}};return t=Q([Ro("esri.core.Identifiable")],t),t};let ww=class extends(bw(class{})){};ww=Q([Ro("esri.core.Identifiable")],ww);let _w=0;const xw=Ne.getLogger("esri.layers.Layer");let Sw=class extends(sh.EventedMixin(bw(ra))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Ol(-180,-90,180,90,Aa.WGS84),this.id=Date.now().toString(16)+"-layer-"+_w++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=Aa.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t="string"==typeof e?{url:e}:e,i=await import("./arcgisLayers.b237b975.js");try{return await i.fromUrl(t)}catch(ia){throw xw.error("#fromArcGISServerUrl({ url: '"+t.url+"'})","Failed to create layer from arcgis server url",ia),ia}}static async fromPortalItem(e){const t="portalItem"in e?e:{portalItem:e},i=await import("./portalLayers.40b2529c.js").then((function(e){return e.p}));try{return await i.fromItem(t)}catch(r){const e=t&&t.portalItem,i=e&&e.id||"unset",s=e&&e.portal&&e.portal.url||Z.portalUrl;throw xw.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+s+"', id: '"+i+"')",r),r}}initialize(){this.when().catch((e=>{var t,i;ht(e)||Ne.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${null!=(t=this.title)?t:"no title"}', id: '${null!=(i=this.id)?i:"no id"}')`,{error:e})}))}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){const e=this.url;return e?$t(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await $i(e,{query:{f:"json"},responseType:"json"})).data;throw new Be("layer:no-attribution-data","Layer does not have attribution data")}};Q([ro({type:String})],Sw.prototype,"attributionDataUrl",void 0),Q([ro({type:Ol})],Sw.prototype,"fullExtent",void 0),Q([ro({readOnly:!0})],Sw.prototype,"hasAttributionData",null),Q([ro({type:String})],Sw.prototype,"id",void 0),Q([ro({type:Boolean,nonNullable:!0})],Sw.prototype,"legendEnabled",void 0),Q([ro({type:["show","hide","hide-children"]})],Sw.prototype,"listMode",void 0),Q([ro({type:Number,range:{min:0,max:1},nonNullable:!0})],Sw.prototype,"opacity",void 0),Q([ro()],Sw.prototype,"parent",void 0),Q([ro({readOnly:!0})],Sw.prototype,"parsedUrl",null),Q([ro({type:Boolean})],Sw.prototype,"popupEnabled",void 0),Q([ro({type:Boolean})],Sw.prototype,"attributionVisible",void 0),Q([ro({type:Aa})],Sw.prototype,"spatialReference",void 0),Q([ro({type:String})],Sw.prototype,"title",void 0),Q([ro({type:String,readOnly:!0,json:{read:!1}})],Sw.prototype,"type",void 0),Q([ro()],Sw.prototype,"url",void 0),Q([ro({type:Boolean,nonNullable:!0})],Sw.prototype,"visible",void 0),Sw=Q([Ro("esri.layers.Layer")],Sw);var Mw=Sw;function Tw(e){return e&&"group"===e.type}function Iw(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if(Tw(r)&&(s=Iw(r.layers,t,i),s))return s}}const Ew=Ne.getLogger("esri.support.LayersMixin"),Aw=e=>{let t=class extends e{constructor(...e){super(...e),this.layers=new xh;const t=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||Ew.error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},i=e=>{e.parent=null,this.layerRemoved(e)};this.layers.on("before-add",(e=>(e=>{e.parent&&"remove"in e.parent&&e.parent.remove(e)})(e.item))),this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>i(e.item)))}destroy(){const e=this.layers.removeAll();for(const t of e)this.layerRemoved(t),t.destroy();this.layers.destroy()}set layers(e){this._set("layers",Og(e,this._get("layers")))}add(e,t){const i=this.layers;if(t=i.getNextIndex(t),e instanceof Mw){const r=e;r.parent===this?this.reorder(r,t):i.add(r,t)}else mt(e)?e.then((e=>{this.destroyed||this.add(e,t)})):Ew.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const i=this.layers;t=i.getNextIndex(t),e.slice().forEach((e=>{e.parent!==this?(i.add(e,t),t+=1):this.reorder(e,t)}))}findLayerById(e){return Iw(this.layers,"id",e)}findLayerByUid(e){return Iw(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return Q([ro()],t.prototype,"layers",null),t=Q([Ro("esri.support.LayersMixin")],t),t},Pw="esri.support.TablesMixin",Cw=Ne.getLogger(Pw);function Ow(e){return e&&"group"===e.type}function kw(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const s=e.getItemAt(r);if(s[t]===i)return s;if(Ow(s)){const e=kw(s.tables,t,i);if(e)return e}}}const Lw=e=>{let t=class extends e{constructor(...e){super(...e),this.tables=new xh,this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,"feature"!==t.type&&Cw.error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))}destroy(){const e=this.tables.removeAll();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",Og(e,this._get("tables")))}findTableById(e){return kw(this.tables,"id",e)}findTableByUid(e){return kw(this.tables,"uid",e)}};return Q([ro()],t.prototype,"tables",null),t=Q([Ro(Pw)],t),t},Rw=Ne.getLogger("esri.Map");let Dw=class extends(Lw(Aw(sh.EventedMixin(jo)))){constructor(e){super(e),this.allLayers=new Kv({getCollections:()=>{var e,t,i;return[null==(e=this.basemap)?void 0:e.baseLayers,null==(t=this.ground)?void 0:t.layers,this.layers,null==(i=this.basemap)?void 0:i.referenceLayers]},getChildrenFunction:e=>"layers"in e?e.layers:null}),this.allTables=new Kv({getCollections:()=>[this.tables,this.layers],getChildrenFunction:e=>{const t=[];return"tables"in e&&t.push(e.tables),"layers"in e&&t.push(e.layers),t},itemFilterFunction:e=>{const t=e.parent;return t&&"tables"in t&&t.tables.includes(e)}}),this.basemap=null,this.editableLayers=new Kv({getCollections:()=>[this.allLayers],itemFilterFunction:Yv}),this.ground=new qv,this._basemapCache={}}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),null==(e=this.ground)||e.destroy(),null==(t=this.basemap)||t.destroy(),Qv(this._basemapCache),this._basemapCache=null}castBasemap(e){return eb(e,this._basemapCache)}castGround(e){return function(e){let t;"string"==typeof e?e in ub?t=new qv({resourceInfo:{data:{layers:[ub[e]]}}}):cb.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`):t=qn(qv,e);return t}(e)||(Rw.error("Map.ground may not be set to null or undefined"),this._get("ground"))}findLayerById(e){return this.allLayers.find((t=>t.id===e))}findTableById(e){return this.allTables.find((t=>t.id===e))}};Q([ro({readOnly:!0,dependsOn:[]})],Dw.prototype,"allLayers",void 0),Q([ro({readOnly:!0})],Dw.prototype,"allTables",void 0),Q([ro({type:nm})],Dw.prototype,"basemap",void 0),Q([Ra("basemap")],Dw.prototype,"castBasemap",null),Q([ro({readOnly:!0})],Dw.prototype,"editableLayers",void 0),Q([ro({type:qv,nonNullable:!0})],Dw.prototype,"ground",void 0),Q([Ra("ground")],Dw.prototype,"castGround",null),Dw=Q([Ro("esri.Map")],Dw);var Fw,jw=Dw;let Nw=Fw=class extends Ko{constructor(e){super(e),this.name=null,this.code=null}clone(){return new Fw({name:this.name,code:this.code})}};Q([ro({type:String,json:{write:!0}})],Nw.prototype,"name",void 0),Q([ro({type:[String,Number],json:{write:!0}})],Nw.prototype,"code",void 0),Nw=Fw=Q([Ro("esri.layers.support.CodedValue")],Nw);var zw=Nw;const Vw=new ee({inherited:"inherited",codedValue:"coded-value",range:"range"});let Uw=class extends Ko{constructor(e){super(e),this.name=null,this.type=null}};Q([ro({type:String,json:{write:!0}})],Uw.prototype,"name",void 0),Q([th(Vw)],Uw.prototype,"type",void 0),Uw=Q([Ro("esri.layers.support.Domain")],Uw);var Gw,Bw=Uw;let qw=Gw=class extends Bw{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some((e=>(String(e.code)===i&&(t=e.name),!!t)))}return t}clone(){return new Gw({codedValues:H(this.codedValues),name:this.name})}};Q([ro({type:[zw],json:{write:!0}})],qw.prototype,"codedValues",void 0),Q([th({codedValue:"coded-value"})],qw.prototype,"type",void 0),qw=Gw=Q([Ro("esri.layers.support.CodedValueDomain")],qw);var Hw,Ww=qw;let $w=Hw=class extends Bw{constructor(e){super(e),this.type="inherited"}clone(){return new Hw}};Q([th({inherited:"inherited"})],$w.prototype,"type",void 0),$w=Hw=Q([Ro("esri.layers.support.InheritedDomain")],$w);var Jw,Xw=$w;let Kw=Jw=class extends Bw{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new Jw({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};Q([ro({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],Kw.prototype,"maxValue",void 0),Q([ro({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],Kw.prototype,"minValue",void 0),Q([th({range:"range"})],Kw.prototype,"type",void 0),Kw=Jw=Q([Ro("esri.layers.support.RangeDomain")],Kw);var Yw,Zw=Kw;!function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"}(Yw||(Yw={}));const Qw={key:"type",base:Bw,typeMap:{range:Zw,"coded-value":Ww,inherited:Xw}};function e_(e){if(!e||!e.type)return null;switch(e.type){case"range":return Zw.fromJSON(e);case"codedValue":return Ww.fromJSON(e);case"inherited":return Xw.fromJSON(e)}return null}let t_;async function i_(){return t_||(t_=(async()=>{const e=await import("./arcadeUtils.af916cf9.js").then((function(e){return e.aq}));return await e.arcade.load(),{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),t_}const r_=(e,t,i)=>n_.create(e,t,i,null,["$feature"]),s_=(e,t,i)=>n_.create(e,t,i,null,["$feature","$view"]);class n_{constructor(e,t,i,r,s,n,o,a){this.script=e,this.evaluate=s;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=t,this._arcadeDictionary=i,this._arcadeFeature=n,this._spatialReference=a,this._referencesGeometry=t.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,t,i,r,s,n){const{arcade:o,Feature:h,Dictionary:c}=await i_(),u=Aa.fromJSON(t),p=o.parseScript(e,n),d=s.reduce(((e,t)=>l(a({},e),{[t]:null})),{});let f=null;m(r)&&(f=new c(r),f.immutable=!0,d.$config=null);const y=o.scriptUsesGeometryEngine(p)&&o.enableGeometrySupport(),g=o.scriptUsesFeatureSet(p)&&o.enableFeatureSetSupport(),v=o.scriptIsAsync(p)&&o.enableAsyncSupport(),b={vars:d,spatialReference:u,useAsync:!!v},w=new c;w.immutable=!1,w.setField("scale",0);const _=o.compileScript(p,b);return await Promise.all([y,g,v]),new n_(e,o,c,p,(e=>("$view"in e&&e.$view&&(w.setField("scale",e.$view.scale),e.$view=w),f&&(e.$config=f),_({vars:e,spatialReference:u}))),new h,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}repurposeAdapter(e){return this._arcadeFeature.repurposeFromAdapter(e,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(e){return this._arcade.referencesMember(this._syntaxTree,e)}referencesFunction(e){return this._arcade.referencesFunction(this._syntaxTree,e)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(e){return this._arcade.extractFieldLiterals(this._syntaxTree,e)}}const o_=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],a_=["field","normalizationField"];function l_(e,t){if(null!=e&&null!=t)for(const i of Array.isArray(e)?e:[e])if(h_(o_,i,t),"visualVariables"in i&&i.visualVariables)for(const e of i.visualVariables)h_(a_,e,t)}function h_(e,t,i){if(e)for(const r of e){const e=J(r,t),s=e&&"function"!=typeof e&&i.get(e);s&&X(r,s.name,t)}}function c_(e,t){if(null!=e&&null!=t&&t.fields.length)if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const u_=new Set;function p_(e,t){return e&&t?(u_.clear(),d_(u_,e,t),Array.from(u_).sort()):[]}function d_(e,t,i){var r;if(i)if(null!=t&&null!=(r=t.fields)&&r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)f_(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const t of i)e.add(t)}}function f_(e,t,i){if("string"==typeof i)if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function y_(e,t){return v(t)||v(e)?[]:t.includes("*")?e.fields.map((e=>e.name)):t}async function g_(e,t,i){if(!i)return;const{arcadeUtils:r}=await i_(),s=r.extractFieldNames(i);for(const n of s)f_(e,t,n)}async function m_(e,t,i){if(i&&"1=1"!==i){const r=(await import("./WhereClause.1471341a.js")).WhereClause.create(i,t);if(!r.isStandardized)throw new Be("fieldUtils:collectFilterFields","Where clause is not standardized");d_(e,t,r.fieldNames)}}function v_(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function b_(e,t){if(!t)return;const i=J("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function w_(e,t,i){t&&i&&"cluster"===i.type&&i.fields&&await Promise.all(i.fields.map((i=>async function(e,t,i){i.outStatistic.onStatisticValueExpression?g_(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}(e,t.fieldsIndex,i))))}async function __(e,t,i){t&&(t.timeInfo&&m(i)&&i.timeExtent&&d_(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&d_(e,t.fieldsIndex,[t.floorInfo.floorField]),m(i)&&m(i.where)&&await m_(e,t.fieldsIndex,i.where))}function x_(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?p_(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function S_(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map((t=>async function(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if("arcade"===r.type)await g_(e,t,r.expression);else{const i=r.expression.match(/{[^}]*}/g);i&&i.forEach((i=>{f_(e,t,i.slice(1,-1))}))}await m_(e,t,s)}(e,r,t))))}function M_(e){const t=e.defaultValue;return void 0!==t&&k_(e,t)?t:e.nullable?null:void 0}function T_(e){return"number"==typeof e&&!isNaN(e)&&isFinite(e)}function I_(e){return null===e||T_(e)}const E_="isInteger"in Number?Number.isInteger:e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e;function A_(e){return null===e||E_(e)}function P_(e){return null!=e&&"string"==typeof e}function C_(e){return null===e||P_(e)}function O_(){return!0}function k_(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?A_:E_;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?I_:T_;break;case"string":case"esriFieldTypeString":i=e.nullable?C_:P_;break;default:i=O_}return 1===arguments.length?i:i(t)}const L_=new Set(["integer","small-integer","single","double","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function R_(e){return null!=e&&L_.has(e.type)}function D_(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}var F_,j_;function N_(e){return null==e||"number"==typeof e&&isNaN(e)?null:e}function z_(e,t){return e.nullable&&null===t?null:R_(e)&&!function(e,t){const i="string"==typeof e?V_(e):e;return!!i&&(i.isInteger?E_(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}(e.type,Number(t))?F_.OUT_OF_RANGE:k_(e,t)?e.domain?function(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return Yw.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==e.codedValues||e.codedValues.every((e=>null==e||e.code!==t)))return Yw.INVALID_CODED_VALUE}return null}(e.domain,t):null:j_.INVALID_TYPE}function V_(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return U_;case"esriFieldTypeInteger":case"integer":return G_;case"esriFieldTypeSingle":case"single":return B_;case"esriFieldTypeDouble":case"double":return q_}}(F_||(F_={})).OUT_OF_RANGE="numeric-range-validation-error::out-of-range",(j_||(j_={})).INVALID_TYPE="type-validation-error::invalid-type";const U_={min:-32768,max:32767,isInteger:!0},G_={min:-2147483648,max:2147483647,isInteger:!0},B_={min:-34e37,max:12e37,isInteger:!1},q_={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function H_(e,t,i){switch(e){case Yw.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case Yw.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case j_.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case F_.OUT_OF_RANGE:{const{min:e,max:r}=V_(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${e} to ${r}`}}}function W_(e,t){return!function(e,t,i){if(!t||!t.attributes||!e){if(m(i))for(const t of e)i.add(t);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!m(i))break;i.add(n)}return s}(e,t,null)}let $_=class extends Ko{constructor(e){super(e),this.type=null}};Q([ro({type:["attachments","custom","fields","media","text"],readOnly:!0,json:{read:!1,write:!0}})],$_.prototype,"type",void 0),$_=Q([Ro("esri.popup.content.Content")],$_);var J_,X_=$_;let K_=J_=class extends X_{constructor(e){super(e),this.description=null,this.displayType=null,this.title=null,this.type="attachments"}clone(){return new J_({description:this.description,displayType:this.displayType,title:this.title})}};Q([ro({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],K_.prototype,"description",void 0),Q([ro({type:["preview","list"],json:{write:!0}})],K_.prototype,"displayType",void 0),Q([ro({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],K_.prototype,"title",void 0),Q([ro({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],K_.prototype,"type",void 0),K_=J_=Q([Ro("esri.popup.content.AttachmentsContent")],K_);var Y_,Z_=K_;let Q_=Y_=class extends X_{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new Y_({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?H(this.outFields):null})}};Q([ro()],Q_.prototype,"creator",void 0),Q([ro()],Q_.prototype,"destroyer",void 0),Q([ro()],Q_.prototype,"outFields",void 0),Q([ro({type:["custom"],readOnly:!0})],Q_.prototype,"type",void 0),Q_=Y_=Q([Ro("esri.popup.content.CustomContent")],Q_);var ex=Q_;const tx=te()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});var ix;tx.toJSON.bind(tx),tx.fromJSON.bind(tx);let rx=ix=class extends Ko{constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}clone(){return new ix({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Te(e,Me(this.dateFormat)):Ce(e,Pe(this))}};Q([th(tx)],rx.prototype,"dateFormat",void 0),Q([ro({type:Boolean,json:{write:!0}})],rx.prototype,"digitSeparator",void 0),Q([ro({type:Yn,json:{write:!0}})],rx.prototype,"places",void 0),rx=ix=Q([Ro("esri.popup.support.FieldInfoFormat")],rx);var sx,nx=rx;let ox=sx=class extends Ko{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new sx({fieldName:this.fieldName,format:this.format?H(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};Q([ro({type:String,json:{write:!0}})],ox.prototype,"fieldName",void 0),Q([ro({type:nx,json:{write:!0}})],ox.prototype,"format",void 0),Q([ro({type:Boolean,json:{write:!0,default:!1}})],ox.prototype,"isEditable",void 0),Q([ro({type:String,json:{write:!0}})],ox.prototype,"label",void 0),Q([th(new ee({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],ox.prototype,"stringFieldOption",void 0),Q([ro({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],ox.prototype,"statisticType",void 0),Q([ro({type:String,json:{write:!0}})],ox.prototype,"tooltip",void 0),Q([ro({type:Boolean,json:{write:!0}})],ox.prototype,"visible",void 0),ox=sx=Q([Ro("esri.popup.FieldInfo")],ox);var ax,lx=ox;let hx=ax=class extends X_{constructor(e){super(e),this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map((e=>e.toJSON()))}clone(){return new ax({description:this.description,fieldInfos:Array.isArray(this.fieldInfos)?H(this.fieldInfos):null,title:this.title})}};Q([ro({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hx.prototype,"description",void 0),Q([ro({type:[lx]})],hx.prototype,"fieldInfos",void 0),Q([na("fieldInfos")],hx.prototype,"writeFieldInfos",null),Q([ro({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],hx.prototype,"title",void 0),Q([ro({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],hx.prototype,"type",void 0),hx=ax=Q([Ro("esri.popup.content.FieldsContent")],hx);var cx=hx;let ux=class extends Ko{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};Q([ro({type:String,json:{write:!0}})],ux.prototype,"altText",void 0),Q([ro({type:String,json:{write:!0}})],ux.prototype,"caption",void 0),Q([ro({type:String,json:{write:!0}})],ux.prototype,"title",void 0),Q([ro({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],ux.prototype,"type",void 0),ux=Q([Ro("esri.popup.content.mixins.MediaInfo")],ux);var px,dx=ux;let fx=px=class extends jo{constructor(e){super(e),this.tooltip=null,this.value=null,this.x=null,this.y=null}clone(){return new px({tooltip:this.tooltip,value:this.value})}};Q([ro()],fx.prototype,"tooltip",void 0),Q([ro()],fx.prototype,"value",void 0),Q([eh("value")],fx.prototype,"x",void 0),Q([eh("tooltip")],fx.prototype,"y",void 0),fx=px=Q([Ro("esri.popup.content.support.ChartMediaInfoValueSeries")],fx);var yx,gx=fx;let mx=yx=class extends Ko{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new yx({fields:H(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};Q([ro({type:[String],json:{write:!0}})],mx.prototype,"fields",void 0),Q([ro({type:String,json:{write:!0}})],mx.prototype,"normalizeField",void 0),Q([ro({type:[gx],json:{read:!1}})],mx.prototype,"series",void 0),Q([ro({type:String,json:{write:!0}})],mx.prototype,"tooltipField",void 0),mx=yx=Q([Ro("esri.popup.content.support.ChartMediaInfoValue")],mx);var vx=mx;let bx=class extends dx{constructor(e){super(e),this.type=null,this.value=null}};Q([ro({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],bx.prototype,"type",void 0),Q([ro({type:vx,json:{write:!0}})],bx.prototype,"value",void 0),bx=Q([Ro("esri.popup.content.mixins.ChartMediaInfo")],bx);var wx=bx;const _x=te()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var xx;let Sx=xx=class extends wx{constructor(e){super(e),this.type="bar-chart"}clone(){return new xx({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Q([ro({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:_x.write}})],Sx.prototype,"type",void 0),Sx=xx=Q([Ro("esri.popup.content.BarChartMediaInfo")],Sx);var Mx,Tx=Sx;let Ix=Mx=class extends wx{constructor(e){super(e),this.type="column-chart"}clone(){return new Mx({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Q([ro({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:_x.write}})],Ix.prototype,"type",void 0),Ix=Mx=Q([Ro("esri.popup.content.ColumnChartMediaInfo")],Ix);var Ex,Ax=Ix;let Px=Ex=class extends Ko{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new Ex({linkURL:this.linkURL,sourceURL:this.sourceURL})}};Q([ro({type:String,json:{write:!0}})],Px.prototype,"linkURL",void 0),Q([ro({type:String,json:{write:!0}})],Px.prototype,"sourceURL",void 0),Px=Ex=Q([Ro("esri.popup.content.support.ImageMediaInfoValue")],Px);var Cx,Ox=Px;let kx=Cx=class extends dx{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new Cx({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};Q([ro({type:Number,json:{write:!0}})],kx.prototype,"refreshInterval",void 0),Q([ro({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],kx.prototype,"type",void 0),Q([ro({type:Ox,json:{write:!0}})],kx.prototype,"value",void 0),kx=Cx=Q([Ro("esri.popup.content.ImageMediaInfo")],kx);var Lx,Rx=kx;let Dx=Lx=class extends wx{constructor(e){super(e),this.type="line-chart"}clone(){return new Lx({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Q([ro({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:_x.write}})],Dx.prototype,"type",void 0),Dx=Lx=Q([Ro("esri.popup.content.LineChartMediaInfo")],Dx);var Fx,jx=Dx;let Nx=Fx=class extends wx{constructor(e){super(e),this.type="pie-chart"}clone(){return new Fx({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};Q([ro({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:_x.write}})],Nx.prototype,"type",void 0),Nx=Fx=Q([Ro("esri.popup.content.PieChartMediaInfo")],Nx);var zx=Nx;const Vx={base:dx,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":Tx,"column-chart":Ax,"line-chart":jx,"pie-chart":zx,image:Rx}};var Ux;let Gx=Ux=class extends X_{constructor(e){super(e),this.activeMediaInfoIndex=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map((e=>"image"===e.type?Rx.fromJSON(e):"barchart"===e.type?Tx.fromJSON(e):"columnchart"===e.type?Ax.fromJSON(e):"linechart"===e.type?jx.fromJSON(e):"piechart"===e.type?zx.fromJSON(e):void 0)).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map((e=>e.toJSON()))}clone(){return new Ux({activeMediaInfoIndex:this.activeMediaInfoIndex,description:this.description,mediaInfos:this.mediaInfos?H(this.mediaInfos):null,title:this.title})}};Q([ro()],Gx.prototype,"activeMediaInfoIndex",void 0),Q([ro({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gx.prototype,"description",void 0),Q([ro({types:[Vx]})],Gx.prototype,"mediaInfos",void 0),Q([sa("mediaInfos")],Gx.prototype,"readMediaInfos",null),Q([na("mediaInfos")],Gx.prototype,"writeMediaInfos",null),Q([ro({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gx.prototype,"title",void 0),Q([ro({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Gx.prototype,"type",void 0),Gx=Ux=Q([Ro("esri.popup.content.MediaContent")],Gx);var Bx,qx=Gx;let Hx=Bx=class extends X_{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new Bx({text:this.text})}};Q([ro({type:String,json:{write:!0}})],Hx.prototype,"text",void 0),Q([ro({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],Hx.prototype,"type",void 0),Hx=Bx=Q([Ro("esri.popup.content.TextContent")],Hx);var Wx=Hx;const $x={base:null,key:"type",typeMap:{attachment:Z_,media:qx,text:Wx,field:cx}};var Jx;let Xx=Jx=class extends Ko{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new Jx({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};Q([ro({type:String,json:{write:!0}})],Xx.prototype,"name",void 0),Q([ro({type:String,json:{write:!0}})],Xx.prototype,"title",void 0),Q([ro({type:String,json:{write:!0}})],Xx.prototype,"expression",void 0),Q([ro({type:["string","number"],json:{write:!0}})],Xx.prototype,"returnType",void 0),Xx=Jx=Q([Ro("esri.popup.ExpressionInfo")],Xx);var Kx,Yx=Xx;let Zx=Kx=class extends Ko{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new Kx({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};Q([ro({type:Boolean,json:{write:!0}})],Zx.prototype,"returnTopmostRaster",void 0),Q([ro({type:Boolean,json:{write:!0}})],Zx.prototype,"showNoDataRecords",void 0),Zx=Kx=Q([Ro("esri.popup.LayerOptions")],Zx);var Qx,eS=Zx;let tS=Qx=class extends Ko{constructor(e){super(e),this.field=null,this.order=null}clone(){return new Qx({field:this.field,order:this.order})}};Q([ro({type:String,json:{write:!0}})],tS.prototype,"field",void 0),Q([ro({type:["asc","desc"],json:{write:!0}})],tS.prototype,"order",void 0),tS=Qx=Q([Ro("esri.popup.support.RelatedRecordsInfoFieldOrder")],tS);var iS,rS=tS;let sS=iS=class extends Ko{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new iS({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?H(this.orderByFields):null})}};Q([ro({type:Boolean,json:{write:!0}})],sS.prototype,"showRelatedRecords",void 0),Q([ro({type:[rS],json:{write:!0}})],sS.prototype,"orderByFields",void 0),sS=iS=Q([Ro("esri.popup.RelatedRecordsInfo")],sS);var nS,oS=sS;let aS=nS=class extends(bw(jo)){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new nS({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};Q([ro()],aS.prototype,"active",void 0),Q([ro()],aS.prototype,"className",void 0),Q([ro()],aS.prototype,"disabled",void 0),Q([ro()],aS.prototype,"id",void 0),Q([ro()],aS.prototype,"indicator",void 0),Q([ro()],aS.prototype,"title",void 0),Q([ro()],aS.prototype,"type",void 0),Q([ro()],aS.prototype,"visible",void 0),aS=nS=Q([Ro("esri.support.actions.ActionBase")],aS);var lS,hS=aS;let cS=lS=class extends hS{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new lS({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};Q([ro()],cS.prototype,"image",void 0),cS=lS=Q([Ro("esri.support.Action.ActionButton")],cS);var uS,pS=cS;let dS=uS=class extends hS{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new uS({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};Q([ro()],dS.prototype,"image",void 0),Q([ro()],dS.prototype,"value",void 0),dS=uS=Q([Ro("esri.support.Action.ActionToggle")],dS);var fS,yS=dS;const gS=xh.ofType({key:"type",defaultKeyValue:"button",base:hS,typeMap:{button:pS,toggle:yS}}),mS={base:X_,key:"type",typeMap:{media:qx,custom:ex,text:Wx,attachments:Z_,fields:cx}},vS="esri.PopupTemplate",bS=Ne.getLogger(vS),wS=["attachments","fields","media","text"];let _S=fS=class extends Ko{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map((e=>Kn(mS,e))):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||mt(e)?e:(bS.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter((e=>-1!==wS.indexOf(e.type))).map((e=>e&&e.toJSON(r))),t.popupElements.forEach((e=>{"attachments"===e.type?this._writeAttachmentContent(t):"media"===e.type?this._writeMediaContent(e,t):"text"===e.type&&this._writeTextContent(e,t)}))):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const i=n?n.filter((e=>"fields"===e.type)):[],s=i.length&&i.every((e=>{var t;return null==(t=e.fieldInfos)?void 0:t.length}));t.fieldInfos=e.filter(Boolean).map((e=>{const t=e.toJSON(r);return s&&(t.visible=!1),t}))}if(n)for(const o of n)"fields"===o.type&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?H(e.toArray()):[];return new fS({actions:t,content:Array.isArray(this.content)?H(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?H(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?H(this.fieldInfos):null,layerOptions:this.layerOptions?H(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?H(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?H(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){await this._collectExpressionInfoFields(e,t,this.expressionInfos),d_(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=H(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach((e=>{const i=t.fieldInfos.find((t=>t.fieldName.toLowerCase()===e.fieldName.toLowerCase()));i?i.visible=!0:t.fieldInfos.push(e)})):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=H(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map((i=>"media"===i.type?(i.mediaInfos||!t||r.mediaInfos||(i.mediaInfos=t,r.mediaInfos=!0),qx.fromJSON(i)):"text"===i.type?(i.text||!e||r.description||(i.text=e,r.description=!0),Wx.fromJSON(i)):"attachments"===i.type?Z_.fromJSON(i):"fields"===i.type?cx.fromJSON(i):void 0)).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new Wx({text:e})):r.push(new cx),Array.isArray(t)&&t.length&&r.push(qx.fromJSON({mediaInfos:t})),i&&r.push(Z_.fromJSON({displayType:"list"})),r.length?r:e}_getContentElementFields(e){return e&&"attachments"!==e.type?"custom"===e.type?e.outFields||[]:"fields"===e.type?this._getFieldInfoFields(e.fieldInfos||this.fieldInfos):"media"===e.type?(e.mediaInfos||[]).reduce(((e,t)=>[...e,...this._getMediaInfoFields(t)]),[]):"text"===e.type?this._extractFieldNames(e.text):void 0:[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:h}=s,c=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(h),...n];return o&&c.push(o),a&&c.push(a),c}_getContentFields(e){return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce(((e,t)=>[...e,...this._getContentElementFields(t)]),[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map((i=>g_(e,t,i.expression))))}_getFieldInfoFields(e){return e?e.filter((e=>void 0===e.visible||!!e.visible)).map((e=>e.fieldName)).filter((e=>-1===e.indexOf("relationships/")&&-1===e.indexOf("expression/"))):[]}_getActionsFields(e){return e?e.toArray().reduce(((e,t)=>[...e,...this._getActionFields(t)]),[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s="button"===r||"toggle"===r?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return"string"==typeof e?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||"string"!=typeof e)return[];const t=e.match(/{[^}]*}/g);if(!t)return[];const i=/\{(\w+):.+\}/,r=t.filter((e=>!(0===e.indexOf("{relationships/")||0===e.indexOf("{expression/")))).map((e=>e.replace(i,"{$1}")));return r?r.map((e=>e.slice(1,-1))):[]}};Q([ro({type:gS})],_S.prototype,"actions",void 0),Q([ro()],_S.prototype,"content",void 0),Q([Ra("content")],_S.prototype,"castContent",null),Q([sa("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],_S.prototype,"readContent",null),Q([na("content",{popupElements:{type:xh.ofType($x)},showAttachments:{type:Boolean},mediaInfos:{type:xh.ofType(Vx)},description:{type:String}})],_S.prototype,"writeContent",null),Q([ro({type:[Yx],json:{write:!0}})],_S.prototype,"expressionInfos",void 0),Q([ro({type:[lx]})],_S.prototype,"fieldInfos",void 0),Q([na("fieldInfos")],_S.prototype,"writeFieldInfos",null),Q([ro({type:eS})],_S.prototype,"layerOptions",void 0),Q([na("layerOptions")],_S.prototype,"writeLayerOptions",null),Q([ro({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],_S.prototype,"lastEditInfoEnabled",void 0),Q([ro()],_S.prototype,"outFields",void 0),Q([ro()],_S.prototype,"overwriteActions",void 0),Q([ro()],_S.prototype,"returnGeometry",void 0),Q([ro({json:{type:String}})],_S.prototype,"title",void 0),Q([na("title")],_S.prototype,"writeTitle",null),Q([ro({type:oS,json:{write:!0}})],_S.prototype,"relatedRecordsInfo",void 0),_S=fS=Q([Ro(vS)],_S);var xS=_S;const SS=new ee({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let MS=0,TS=class extends Ko{constructor(e){super(e),this.id="sym"+MS++,this.type=null}set color(e){this._set("color",e)}readColor(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};Q([ro({type:SS.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:SS.write}}})],TS.prototype,"type",void 0),Q([ro({type:Rv,value:new Rv([0,0,0,1]),json:{write:{allowNull:!0}}})],TS.prototype,"color",null),Q([sa("color")],TS.prototype,"readColor",null),TS=Q([Ro("esri.symbols.Symbol")],TS);var IS,ES=TS;let AS=IS=class extends ES{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data.type){const i=this.data.primitiveOverrides;if(i){const r=i.map((i=>{const r=i.valueExpressionInfo;return g_(e,t,r.expression)}));await Promise.all(r)}}}clone(){return new IS({data:H(this.data)})}hash(){return De(JSON.stringify(this.data)).toString()}};Q([ro({json:{write:!1}})],AS.prototype,"color",void 0),Q([ro({json:{write:!0}})],AS.prototype,"data",void 0),Q([sa("data",["symbol"])],AS.prototype,"readData",null),Q([na("data")],AS.prototype,"writeData",null),Q([th({CIMSymbolReference:"cim"},{readOnly:!0})],AS.prototype,"type",void 0),AS=IS=Q([Ro("esri.symbols.CIMSymbol")],AS);var PS=AS;let CS=class extends Ko{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};Q([ro({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],CS.prototype,"enabled",void 0),Q([na("enabled")],CS.prototype,"writeEnabled",null),Q([ro({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],CS.prototype,"type",void 0),CS=Q([Ro("esri.symbols.Symbol3DLayer")],CS);var OS=CS;const kS=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function LS(e){return e?e/72*96:0}function RS(e){return e?72*e/96:0}function DS(e){if("string"==typeof e){if(kS.test(e)){const t=e.match(kS),i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s="-"===e.charAt(0),n="px"===r?RS(i):i;return s?-n:n}return console.warn("screenUtils.toPt: input not recognized!"),null}return e}function FS(e=0,t=0){return{x:e,y:t}}function jS(e=0,t=0){return[e,t]}function NS(e=0,t=0,i=0){return[e,t,i]}function zS(e){return e}function VS(e){return e}function US(e){return e}function GS(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}const BS={type:Rv,json:{type:[Yn],default:null,read:{source:["color","transparency"],reader:function(e,t){const i=null!=t.transparency?zv(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new Rv([r[0]||0,r[1]||0,r[2]||0,i]):null}},write:{target:{color:{type:[Yn]},transparency:{type:Yn}},writer:function(e,t){t.color=e.toJSON().slice(0,3);const i=Nv(e.a);0!==i&&(t.transparency=i)}}}},qS={type:Number,cast:DS,json:{write:!0}},HS={type:[Number],cast:e=>null!=e?e:Array.isArray(e)?e.map(DS):null,json:{read:!1,write:!1}};let WS=class extends Ko{constructor(e){super(e),this.color=new Rv([0,0,0,1]),this.extensionLength=0,this.size=RS(1)}clone(){}cloneProperties(){return{color:H(this.color),size:this.size,extensionLength:this.extensionLength}}};Q([ro({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],WS.prototype,"type",void 0),Q([ro(BS)],WS.prototype,"color",void 0),Q([ro(l(a({},qS),{json:{write:{overridePolicy:e=>({enabled:!!e})}}}))],WS.prototype,"extensionLength",void 0),Q([ro(qS)],WS.prototype,"size",void 0),WS=Q([Ro("esri.symbols.edges.Edges3D")],WS);var $S,JS=WS;let XS=$S=class extends JS{constructor(e){super(e),this.type="sketch"}clone(){return new $S(this.cloneProperties())}};Q([th({sketch:"sketch"},{readOnly:!0})],XS.prototype,"type",void 0),XS=$S=Q([Ro("esri.symbols.edges.SketchEdges3D")],XS);var KS,YS=XS;let ZS=KS=class extends JS{constructor(e){super(e),this.type="solid"}clone(){return new KS(this.cloneProperties())}};Q([th({solid:"solid"},{readOnly:!0})],ZS.prototype,"type",void 0),ZS=KS=Q([Ro("esri.symbols.support.SolidEdges3D")],ZS);const QS={types:{key:"type",base:JS,typeMap:{solid:ZS,sketch:YS}},json:{write:!0}};var eM;let tM=eM=class extends Ko{constructor(){super(...arguments),this.color=null}clone(){return new eM({color:m(this.color)?this.color.clone():null})}};Q([ro(BS)],tM.prototype,"color",void 0),tM=eM=Q([Ro("esri.symbols.support.Symbol3DMaterial")],tM);var iM,rM=tM;let sM=iM=class extends OS{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new iM({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:m(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};Q([th({Extrude:"extrude"},{readOnly:!0})],sM.prototype,"type",void 0),Q([ro({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],sM.prototype,"size",void 0),Q([ro({type:rM,json:{write:!0}})],sM.prototype,"material",void 0),Q([ro({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],sM.prototype,"castShadows",void 0),Q([ro(QS)],sM.prototype,"edges",void 0),sM=iM=Q([Ro("esri.symbols.ExtrudeSymbol3DLayer")],sM);var nM=sM;let oM=class extends ES{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};Q([th({esriSLS:"simple-line"},{readOnly:!0})],oM.prototype,"type",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],oM.prototype,"width",void 0),oM=Q([Ro("esri.symbols.LineSymbol")],oM);var aM,lM=oM;let hM=aM=class extends Ko{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){"web-map"===(null==r?void 0:r.origin)?t[i]="arrow":t[i]=e}set color(e){this._set("color",e)}readColor(e){return e&&null!=e[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){"web-map"===(null==r?void 0:r.origin)||(t[i]=e)}clone(){return new aM({color:H(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${null==(e=this.color)?void 0:e.hash()}.${this.style}`}};Q([ro({type:["begin","end","begin-end"],json:{write:!0}})],hM.prototype,"placement",void 0),Q([th({"line-marker":"line-marker"},{readOnly:!0}),ro({json:{origins:{"web-map":{write:!1}}}})],hM.prototype,"type",void 0),Q([ro({type:["arrow","circle","square","diamond","cross","x"]})],hM.prototype,"style",void 0),Q([na("style")],hM.prototype,"writeStyle",null),Q([ro({type:Rv,value:null,json:{write:{allowNull:!0}}})],hM.prototype,"color",null),Q([sa("color")],hM.prototype,"readColor",null),Q([na("color")],hM.prototype,"writeColor",null),hM=aM=Q([Ro("esri.symbols.LineSymbolMarker")],hM);var cM,uM=hM;const pM=new ee({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let dM=cM=class extends lM{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&"string"!=typeof e)return e;const o={};return null!=e&&(o.style=e),null!=t&&(o.color=t),null!=i&&(o.width=DS(i)),null!=r&&(o.cap=r),null!=s&&(o.join=s),null!=n&&(o.miterLimit=DS(n)),o}clone(){var e;return new cM({color:H(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:null==(e=this.marker)?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${null==(e=this.color)?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${null==(t=this.marker)?void 0:t.hash()}`}};Q([th({esriSLS:"simple-line"},{readOnly:!0})],dM.prototype,"type",void 0),Q([ro({type:pM.apiValues,json:{read:pM.read,write:pM.write}})],dM.prototype,"style",void 0),Q([ro({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:"round"!==e&&(null==i||null==i.origin)})}}})],dM.prototype,"cap",void 0),Q([ro({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:"round"!==e&&(null==i||null==i.origin)})}}})],dM.prototype,"join",void 0),Q([ro({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":uM}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],dM.prototype,"marker",void 0),Q([ro({type:Number,json:{read:!1,write:!1}})],dM.prototype,"miterLimit",void 0),dM=cM=Q([Ro("esri.symbols.SimpleLineSymbol")],dM);var fM=dM;let yM=class extends ES{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};Q([ro({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":fM}},json:{default:null,write:!0}})],yM.prototype,"outline",void 0),Q([ro({type:["simple-fill","picture-fill"],readOnly:!0})],yM.prototype,"type",void 0),yM=Q([Ro("esri.symbols.FillSymbol")],yM);var gM=yM;let mM=class extends Ko{constructor(e){super(e)}clone(){}};Q([ro({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],mM.prototype,"type",void 0),mM=Q([Ro("esri.symbols.patterns.Pattern3D")],mM);var vM,bM=mM;let wM=vM=class extends bM{constructor(e){super(e),this.type="style",this.style="solid"}clone(){return new vM({style:this.style})}};Q([ro({type:["style"]})],wM.prototype,"type",void 0),Q([ro({type:["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"],json:{read:!0,write:!0}})],wM.prototype,"style",void 0),wM=vM=Q([Ro("esri.symbols.patterns.StylePattern3D")],wM);var _M=wM;const xM={types:{key:"type",base:bM,typeMap:{style:_M}},json:{read:function(e,t,i){if(!e)return e;switch(e.type){case"style":{const t=new _M;return t.read(e,i),t}}},write:!0}},SM=new Rv("white");new Rv("black");const MM=new Rv([255,255,255,0]);var TM;let IM=TM=class extends rM{clone(){return new TM({color:m(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode})}};Q([th({multiply:"multiply",replace:"replace",tint:"tint"})],IM.prototype,"colorMixMode",void 0),IM=TM=Q([Ro("esri.symbols.support.Symbol3DFillMaterial")],IM);var EM,AM=IM;let PM=EM=class extends Ko{constructor(){super(...arguments),this.color=new Rv([0,0,0,1]),this.size=RS(1),this.stipplePattern=null,this.stippleOffColor=null}clone(){return new EM({color:m(this.color)?this.color.clone():null,size:this.size,stipplePattern:this.stipplePattern?this.stipplePattern.slice():null,stippleOffColor:this.stippleOffColor?this.stippleOffColor.clone():null})}};Q([ro(BS)],PM.prototype,"color",void 0),Q([ro(qS)],PM.prototype,"size",void 0),Q([ro(HS)],PM.prototype,"stipplePattern",void 0),Q([ro({type:Rv})],PM.prototype,"stippleOffColor",void 0),PM=EM=Q([Ro("esri.symbols.support.Symbol3DOutline")],PM);var CM,OM=PM;let kM=CM=class extends OS{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){return new CM({edges:m(this.edges)?this.edges.clone():null,enabled:this.enabled,material:m(this.material)?this.material.clone():null,pattern:m(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:m(this.outline)?this.outline.clone():null})}static fromSimpleFillSymbol(e){return new CM({material:{color:(e.color||MM).clone()},pattern:e.style&&"solid"!==e.style?new _M({style:e.style}):null,outline:e.outline?new OM({size:e.outline.width||0,color:(e.outline.color||SM).clone()}):null})}};Q([th({Fill:"fill"},{readOnly:!0})],kM.prototype,"type",void 0),Q([ro({type:AM,json:{write:!0}})],kM.prototype,"material",void 0),Q([ro(xM)],kM.prototype,"pattern",void 0),Q([ro({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],kM.prototype,"castShadows",void 0),Q([ro({type:OM,json:{write:!0}})],kM.prototype,"outline",void 0),Q([ro(QS)],kM.prototype,"edges",void 0),kM=CM=Q([Ro("esri.symbols.FillSymbol3DLayer")],kM);var LM,RM=kM;let DM=LM=class extends Ko{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return DS(e)}clone(){return new LM({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};Q([ro({type:["underline","line-through","none"],json:{default:"none",write:!0}})],DM.prototype,"decoration",void 0),Q([ro({type:String,json:{write:!0}})],DM.prototype,"family",void 0),Q([ro({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],DM.prototype,"size",void 0),Q([Ra("size")],DM.prototype,"castSize",null),Q([ro({type:["normal","italic","oblique"],json:{default:"normal",write:!0}})],DM.prototype,"style",void 0),Q([ro({type:["normal","bold","bolder","lighter"],json:{default:"normal",write:!0}})],DM.prototype,"weight",void 0),DM=LM=Q([Ro("esri.symbols.Font")],DM);var FM=DM;function jM(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=ai(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const i=li(e,t.portalItem.itemUrl);GM.test(i)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(i).path)}return qM(e,t&&t.portal)}function NM(e,t,i=0){if(!e)return e;!pi(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=ai(e);if(t){const i=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(i){const s=qM(i,t.portal);r=li(qM(r,t.portal),s,s),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=function(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?Ai(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}(r,t&&t.portal),pi(r)&&(r=hi(r)),null!=t&&t.resources&&null!=t&&t.portalItem&&!pi(r)&&!fi(r)&&0===i&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function zM(e,t,i){return jM(e,i)}function VM(e,t,i,r){const s=NM(e,r);void 0!==s&&(t[i]=s)}const UM=/\/items\/([^\/]+)\/resources\//,GM=/^\.\/resources\//;function BM(e){const t=m(e)?e.match(UM):null;return m(t)?t[1]:null}function qM(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`;return si(qt,`${qt.scheme}://${i}`)?Ai(e,t.portalHostname,i):Ai(e,i,t.portalHostname)}var HM,WM=Object.freeze({__proto__:null,fromJSON:jM,toJSON:NM,read:zM,write:VM,itemIdFromResourceUrl:BM});const $M=te()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let JM=HM=class extends Ko{constructor(e){super(e)}readHref(e,t,i){return e?jM(e,i):t.dataURI}writeHref(e,t,i,r){e&&(fi(e)?t.dataURI=e:(t.href=NM(e,r),pi(t.href)&&(t.href=hi(t.href))))}clone(){return new HM({href:this.href,primitive:this.primitive})}};Q([ro({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],JM.prototype,"href",void 0),Q([sa("href")],JM.prototype,"readHref",null),Q([na("href",{href:{type:String},dataURI:{type:String}})],JM.prototype,"writeHref",null),Q([th($M)],JM.prototype,"primitive",void 0),JM=HM=Q([Ro("esri.symbols.support.IconSymbol3DLayerResource")],JM);const XM="circle";var KM,YM=JM;let ZM=KM=class extends jo{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new KM({x:this.x,y:this.y})}};Q([ro({type:Number})],ZM.prototype,"x",void 0),Q([ro({type:Number})],ZM.prototype,"y",void 0),ZM=KM=Q([Ro("esri.symbols.support.Symbol3DAnchorPosition2D")],ZM);var QM,eT=ZM;const tT=Ne.getLogger("esri.symbols.IconSymbol3DLayer");let iT=QM=class extends OS{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new QM({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:m(this.material)?this.material.clone():null,outline:m(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||SM,i=rT(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||SM).clone()}:null;return new QM({size:e.size,resource:{primitive:oT(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||function(e){return 0===e.r&&0===e.g&&0===e.b}(e.color)?SM:e.color,i=rT(e);return new QM({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new QM({resource:{href:vi({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function rT(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=sT(e.xoffset),s=sT(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function sT(e){return isFinite(e)?e:0}Q([ro({type:rM,json:{write:!0}})],iT.prototype,"material",void 0),Q([ro({type:YM,json:{write:!0}})],iT.prototype,"resource",void 0),Q([th({Icon:"icon"},{readOnly:!0})],iT.prototype,"type",void 0),Q([ro(qS)],iT.prototype,"size",void 0),Q([th({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),ro({json:{default:"center"}})],iT.prototype,"anchor",void 0),Q([ro({type:ZM,json:{type:[Number],read:{reader:e=>new ZM({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],iT.prototype,"anchorPosition",void 0),Q([ro({type:OM,json:{write:!0}})],iT.prototype,"outline",void 0),iT=QM=Q([Ro("esri.symbols.IconSymbol3DLayer")],iT);const nT={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function oT(e){return nT[e]||(tT.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}var aT,lT=iT;let hT=aT=class extends OS{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=RS(1),this.stipplePattern=null,this.stippleOffColor=null}clone(){return new aT({enabled:this.enabled,material:m(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,stipplePattern:this.stipplePattern?this.stipplePattern.slice():null,stippleOffColor:this.stippleOffColor?this.stippleOffColor.clone():null})}static fromSimpleLineSymbol(e){return new aT({size:e.width||1,cap:e.cap||"butt",join:e.join||"miter",material:{color:(e.color||SM).clone()}})}};Q([ro({type:rM,json:{write:!0}})],hT.prototype,"material",void 0),Q([th({Line:"line"},{readOnly:!0})],hT.prototype,"type",void 0),Q([ro({type:["miter","bevel","round"],json:{write:!0,default:"miter"}})],hT.prototype,"join",void 0),Q([ro({type:["butt","square","round"],json:{write:!0,default:"butt"}})],hT.prototype,"cap",void 0),Q([ro(qS)],hT.prototype,"size",void 0),Q([ro(HS)],hT.prototype,"stipplePattern",void 0),Q([ro({type:Rv})],hT.prototype,"stippleOffColor",void 0),hT=aT=Q([Ro("esri.symbols.LineSymbol3DLayer")],hT);var cT,uT=hT;const pT=te()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let dT=cT=class extends Ko{clone(){return new cT({href:this.href,primitive:this.primitive})}};Q([ro({type:String,json:{read:zM,write:VM}})],dT.prototype,"href",void 0),Q([th(pT)],dT.prototype,"primitive",void 0),dT=cT=Q([Ro("esri.symbols.support.ObjectSymbol3DLayerResource")],dT);const fT="sphere";var yT,gT=dT;let mT=yT=class extends jo{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new yT({x:this.x,y:this.y,z:this.z})}};var vT;Q([ro({type:Number})],mT.prototype,"x",void 0),Q([ro({type:Number})],mT.prototype,"y",void 0),Q([ro({type:Number})],mT.prototype,"z",void 0),mT=yT=Q([Ro("esri.symbols.support.Symbol3DAnchorPosition3D")],mT);let bT=vT=class extends OS{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new vT({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:m(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};Q([ro({type:rM,json:{write:!0}})],bT.prototype,"material",void 0),Q([ro({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],bT.prototype,"castShadows",void 0),Q([ro({type:gT,json:{write:!0}})],bT.prototype,"resource",void 0),Q([th({Object:"object"},{readOnly:!0})],bT.prototype,"type",void 0),Q([ro({type:Number,json:{write:!0}})],bT.prototype,"width",void 0),Q([ro({type:Number,json:{write:!0}})],bT.prototype,"height",void 0),Q([ro({type:Number,json:{write:!0}})],bT.prototype,"depth",void 0),Q([th({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),ro({json:{default:"origin"}})],bT.prototype,"anchor",void 0),Q([ro({type:mT,json:{type:[Number],read:{reader:e=>new mT({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],bT.prototype,"anchorPosition",void 0),Q([ro({type:Number,json:{write:!0}})],bT.prototype,"heading",void 0),Q([ro({type:Number,json:{write:!0}})],bT.prototype,"tilt",void 0),Q([ro({type:Number,json:{write:!0}})],bT.prototype,"roll",void 0),Q([ro({readOnly:!0})],bT.prototype,"isPrimitive",null),bT=vT=Q([Ro("esri.symbols.ObjectSymbol3DLayer")],bT);var wT,_T=bT;let xT=wT=class extends OS{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}get size(){return this.width&&this.height?this.width===this.height?this.width:void 0:this.width?this.width:this.height?this.height:void 0}set size(e){this.width=e,this.height=e}readSize(e,t){return t.height||t.width?e:t.size}clone(){return new wT({enabled:this.enabled,material:m(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};Q([ro({type:rM,json:{write:!0}})],xT.prototype,"material",void 0),Q([ro({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],xT.prototype,"castShadows",void 0),Q([th({Path:"path"},{readOnly:!0})],xT.prototype,"type",void 0),Q([ro({type:Number})],xT.prototype,"size",null),Q([sa("size")],xT.prototype,"readSize",null),Q([ro({type:["circle","quad"],json:{write:!0,default:"circle"}})],xT.prototype,"profile",void 0),Q([ro({type:["miter","bevel","round"],json:{write:!0,default:"miter"}})],xT.prototype,"join",void 0),Q([ro({type:["none","butt","square","round"],json:{write:!0,default:"butt"}})],xT.prototype,"cap",void 0),Q([ro({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],xT.prototype,"width",void 0),Q([ro({type:Number,json:{write:!0}})],xT.prototype,"height",void 0),Q([ro({type:["center","bottom","top"],json:{write:!0,default:"center"}})],xT.prototype,"anchor",void 0),Q([ro({type:["heading","all"],json:{write:!0,default:"all"}})],xT.prototype,"profileRotation",void 0),xT=wT=Q([Ro("esri.symbols.PathSymbol3DLayer")],xT);var ST,MT=xT;let TT=ST=class extends Ko{constructor(){super(...arguments),this.color=new Rv([0,0,0,1]),this.size=0}clone(){return new ST({color:H(this.color),size:this.size})}};Q([ro(BS)],TT.prototype,"color",void 0),Q([ro(qS)],TT.prototype,"size",void 0),TT=ST=Q([Ro("esri.symbols.support.Symbol3DHalo")],TT);var IT,ET=TT;let AT=IT=class extends OS{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.material=null,this.text=void 0,this.type="text"}get font(){return this._get("font")||null}set font(e){e&&this._userSize&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s=l(a({},r),{textSymbol3D:!0});t.font=e.write({},s),delete t.font.size}get size(){return null!=this._userSize?this._userSize:this.font&&null!=this.font.size?this.font.size:9}set size(e){this._userSize=e,this.font&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){return new IT({enabled:this.enabled,font:this.font&&H(this.font),halo:this.halo&&H(this.halo),material:m(this.material)?this.material.clone():null,size:this.size,text:this.text})}static fromTextSymbol(e){const t=function(e,t){return e&&t>0?{color:H(e),size:t}:null}(e.haloColor,e.haloSize),i=e.font?e.font.clone():new FM;return new IT({size:i.size,font:i,halo:t,material:e.color?{color:e.color.clone()}:null,text:e.text})}};Q([ro({type:FM,json:{write:!0}})],AT.prototype,"font",null),Q([na("font")],AT.prototype,"writeFont",null),Q([ro({type:ET,json:{write:!0}})],AT.prototype,"halo",void 0),Q([ro({type:rM,json:{write:!0}})],AT.prototype,"material",void 0),Q([ro(qS),ro()],AT.prototype,"size",null),Q([ro({type:String,json:{write:!0}})],AT.prototype,"text",void 0),Q([th({Text:"text"},{readOnly:!0})],AT.prototype,"type",void 0),AT=IT=Q([Ro("esri.symbols.TextSymbol3DLayer")],AT);var PT,CT=AT;let OT=PT=class extends OS{constructor(e){super(e),this.color=kT.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new PT({color:H(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};Q([ro({type:Rv,nonNullable:!0,json:{type:[Yn],write:(e,t,i)=>t[i]=e.toArray(1),default:()=>kT.clone(),defaultEquals:e=>e.toCss(!0)===kT.toCss(!0)}})],OT.prototype,"color",void 0),Q([th({Water:"water"},{readOnly:!0})],OT.prototype,"type",void 0),Q([ro({type:["small","medium","large"],json:{write:!0,default:"medium"}})],OT.prototype,"waterbodySize",void 0),Q([ro({type:Number,json:{write:!0,default:null}})],OT.prototype,"waveDirection",void 0),Q([ro({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],OT.prototype,"waveStrength",void 0),OT=PT=Q([Ro("esri.symbols.WaterSymbol3DLayer")],OT);const kT=new Rv([0,119,190]);var LT,RT=OT;let DT=LT=class extends jo{constructor(){super(...arguments),this.portal=null}clone(){return new LT({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};Q([ro({type:String})],DT.prototype,"name",void 0),Q([ro({type:String})],DT.prototype,"styleUrl",void 0),Q([ro({type:String})],DT.prototype,"styleName",void 0),Q([ro({type:Yl})],DT.prototype,"portal",void 0),DT=LT=Q([Ro("esri.symbols.support.StyleOrigin")],DT);var FT,jT=DT;let NT=FT=class extends jo{clone(){return new FT({url:this.url})}};Q([ro({type:String})],NT.prototype,"url",void 0),NT=FT=Q([Ro("esri.symbols.support.Thumbnail")],NT);var zT=NT;const VT={icon:lT,object:_T,line:uT,path:MT,fill:RM,extrude:nM,text:CT,water:RT},UT=xh.ofType({base:OS,key:"type",typeMap:VT,errorContext:"symbol-layer"}),GT=Ne.getLogger("esri.symbols.Symbol3D");let BT=class extends ES{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||xh;this._set("symbolLayers",new i)}get color(){return null}set color(e){GT.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Og(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const t=jM(e.styleUrl,i);return new jT({styleUrl:t,name:e.name})}if(e.styleName&&e.name)return new jT({portal:i&&i.portal||Yl.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new oo("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let i=NM(e.styleUrl,r);pi(i)&&(i=hi(i)),t.styleOrigin={styleUrl:i,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!ii(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new oo("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof OS||e&&VT[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};Q([ro({json:{read:!1,write:!1}})],BT.prototype,"color",null),Q([ro({type:UT,nonNullable:!0,json:{write:!0}}),Ra(kg)],BT.prototype,"symbolLayers",null),Q([ro({type:jT})],BT.prototype,"styleOrigin",void 0),Q([sa("styleOrigin")],BT.prototype,"readStyleOrigin",null),Q([na("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],BT.prototype,"writeStyleOrigin",null),Q([ro({type:zT,json:{read:!1}})],BT.prototype,"thumbnail",void 0),Q([ro({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],BT.prototype,"type",void 0),BT=Q([Ro("esri.symbols.Symbol3D")],BT);var qT=BT;let HT=class extends Ko{constructor(e){super(e),this.visible=!0}clone(){}};Q([ro({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],HT.prototype,"type",void 0),Q([ro({readOnly:!0})],HT.prototype,"visible",void 0),HT=Q([Ro("esri.symbols.callouts.Callout3D")],HT);var WT,$T=HT;let JT=WT=class extends Ko{constructor(){super(...arguments),this.color=new Rv("white")}clone(){return new WT({color:H(this.color)})}};Q([ro(BS)],JT.prototype,"color",void 0),JT=WT=Q([Ro("esri.symbols.callouts.LineCallout3DBorder")],JT);var XT,KT=JT;Object.freeze({__proto__:null,get LineCallout3DBorder(){return JT},default:KT});let YT=XT=class extends $T{constructor(e){super(e),this.type="line",this.color=new Rv([0,0,0,1]),this.size=RS(1),this.border=null}get visible(){return this.size>0&&m(this.color)&&this.color.a>0}clone(){return new XT({color:H(this.color),size:this.size,border:H(this.border)})}};function ZT(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function QT(e){if(!e)return!1;if(!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!ZT(e)}function eI(e){return"point-3d"===e.type||"label-3d"===e.type}Q([th({line:"line"},{readOnly:!0})],YT.prototype,"type",void 0),Q([ro(BS)],YT.prototype,"color",void 0),Q([ro(qS)],YT.prototype,"size",void 0),Q([ro({type:KT,json:{write:!0}})],YT.prototype,"border",void 0),Q([ro({readOnly:!0})],YT.prototype,"visible",null),YT=XT=Q([Ro("esri.symbols.callouts.LineCallout3D")],YT);const tI={types:{key:"type",base:$T,typeMap:{line:YT}},json:{write:!0}};var iI;let rI=iI=class extends Ko{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new iI({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};Q([ro(qS)],rI.prototype,"screenLength",void 0),Q([ro({type:Number,json:{write:!0,default:0}})],rI.prototype,"minWorldLength",void 0),Q([ro({type:Number,json:{write:!0}})],rI.prototype,"maxWorldLength",void 0),rI=iI=Q([Ro("esri.symbols.support.Symbol3DVerticalOffset")],rI);var sI,nI=rI;const oI=xh.ofType({base:null,key:"type",typeMap:{text:CT}});let aI=sI=class extends qT{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new oI,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return QT(this)}hasVisibleVerticalOffset(){return ZT(this)}clone(){return new sI({styleOrigin:H(this.styleOrigin),symbolLayers:H(this.symbolLayers),thumbnail:H(this.thumbnail),callout:H(this.callout),verticalOffset:H(this.verticalOffset)})}static fromTextSymbol(e){return new sI({symbolLayers:[CT.fromTextSymbol(e)]})}};Q([ro({type:nI,json:{write:!0}})],aI.prototype,"verticalOffset",void 0),Q([ro(tI)],aI.prototype,"callout",void 0),Q([ro({json:{read:!1,write:!1}})],aI.prototype,"styleOrigin",void 0),Q([ro({type:oI})],aI.prototype,"symbolLayers",void 0),Q([th({LabelSymbol3D:"label-3d"},{readOnly:!0})],aI.prototype,"type",void 0),aI=sI=Q([Ro("esri.symbols.LabelSymbol3D")],aI);var lI,hI=aI;const cI=xh.ofType({base:null,key:"type",typeMap:{line:uT,path:MT}}),uI=xh.ofType({base:null,key:"type",typeMap:{line:uT,path:MT}});let pI=lI=class extends qT{constructor(e){super(e),this.symbolLayers=new cI,this.type="line-3d"}clone(){return new lI({styleOrigin:H(this.styleOrigin),symbolLayers:H(this.symbolLayers),thumbnail:H(this.thumbnail)})}static fromSimpleLineSymbol(e){return new lI({symbolLayers:[uT.fromSimpleLineSymbol(e)]})}};Q([ro({type:cI,json:{type:uI}})],pI.prototype,"symbolLayers",void 0),Q([th({LineSymbol3D:"line-3d"},{readOnly:!0})],pI.prototype,"type",void 0),pI=lI=Q([Ro("esri.symbols.LineSymbol3D")],pI);var dI=pI;let fI=class extends ES{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};Q([ro({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],fI.prototype,"angle",void 0),Q([ro({type:["simple-marker","picture-marker"],readOnly:!0})],fI.prototype,"type",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],fI.prototype,"xoffset",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],fI.prototype,"yoffset",void 0),Q([ro({type:Number,cast:e=>"auto"===e?e:DS(e),json:{write:!0}})],fI.prototype,"size",void 0),fI=Q([Ro("esri.symbols.MarkerSymbol")],fI);var yI,gI=fI;const mI=xh.ofType({base:null,key:"type",typeMap:{fill:RM}});let vI=yI=class extends qT{constructor(e){super(e),this.symbolLayers=new mI,this.type="mesh-3d"}clone(){return new yI({styleOrigin:H(this.styleOrigin),symbolLayers:H(this.symbolLayers),thumbnail:H(this.thumbnail)})}};Q([ro({type:mI})],vI.prototype,"symbolLayers",void 0),Q([th({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],vI.prototype,"type",void 0),vI=yI=Q([Ro("esri.symbols.MeshSymbol3D")],vI);var bI=vI;function wI(e,t){return function(e){return e&&("service"===e.origin||"portal-item"===e.origin)&&e.layer&&("feature"===e.layer.type||"stream"===e.layer.type)}(t)&&!pi(e)&&t.layer.parsedUrl?ci(t.layer.parsedUrl.path,"images",e):jM(e,t)}const _I={json:{read:{source:["imageData","url"],reader:function(e,t,i){return t.imageData?vi({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):wI(t.url,i)}},write:{writer(e,t,i,r){!function(e,t,i,r){if(fi(e)){const s=mi(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&VM(i.url,t,"url",r)}else VM(e,t,"url",r)}(e,t,this.source,r)}}}},xI={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=wI(t.url,i)),r}}}};var SI;let MI=SI=class extends gM{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),null!=i&&(s.width=DS(i)),null!=r&&(s.height=DS(r)),s}clone(){const e=new SI({color:H(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",H(this.source)),e}hash(){var e;return`${super.hash()}.${null==(e=this.color)?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};Q([th({esriPFS:"picture-fill"},{readOnly:!0})],MI.prototype,"type",void 0),Q([ro(_I)],MI.prototype,"url",void 0),Q([ro({type:Number,json:{write:!0}})],MI.prototype,"xscale",void 0),Q([ro({type:Number,json:{write:!0}})],MI.prototype,"yscale",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],MI.prototype,"width",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],MI.prototype,"height",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],MI.prototype,"xoffset",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],MI.prototype,"yoffset",void 0),Q([ro(xI)],MI.prototype,"source",void 0),MI=SI=Q([Ro("esri.symbols.PictureFillSymbol")],MI);var TI,II=MI;let EI=TI=class extends gI{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e&&null==e.imageData)return e;const r={};return e&&(r.url=e),null!=t&&(r.width=DS(t)),null!=i&&(r.height=DS(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new TI({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",H(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};Q([ro({json:{write:!1}})],EI.prototype,"color",void 0),Q([th({esriPMS:"picture-marker"},{readOnly:!0})],EI.prototype,"type",void 0),Q([ro(_I)],EI.prototype,"url",void 0),Q([ro(xI)],EI.prototype,"source",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],EI.prototype,"height",void 0),Q([sa("height",["height","size"])],EI.prototype,"readHeight",null),Q([ro({type:Number,cast:DS,json:{write:!0}})],EI.prototype,"width",void 0),Q([ro({json:{write:!1}})],EI.prototype,"size",void 0),EI=TI=Q([Ro("esri.symbols.PictureMarkerSymbol")],EI);var AI,PI=EI;const CI=xh.ofType({base:null,key:"type",typeMap:{icon:lT,object:_T,text:CT}}),OI=xh.ofType({base:null,key:"type",typeMap:{icon:lT,object:_T}});let kI=AI=class extends qT{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new CI,this.type="point-3d"}writeSymbolLayers(e,t,i,r){const s=e.filter((e=>"text"!==e.type));if(r&&r.messages&&s.length<e.length){const t=e.find((e=>"text"===e.type));r.messages.push(new Be("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PointSymbol3D",{symbolLayer:t}))}t[i]=s.map((e=>e.write({},r))).toArray()}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return QT(this)}hasVisibleVerticalOffset(){return ZT(this)}clone(){return new AI({verticalOffset:H(this.verticalOffset),callout:H(this.callout),styleOrigin:H(this.styleOrigin),symbolLayers:H(this.symbolLayers),thumbnail:H(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new AI({symbolLayers:[lT.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new AI({symbolLayers:[lT.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){if(e.data&&e.data.symbol){const t=e.data.symbol;if("CIMPointSymbol"===t.type&&t.callout)return new AI({symbolLayers:[lT.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}})}return new AI({symbolLayers:[lT.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new AI({symbolLayers:[CT.fromTextSymbol(e)]})}};Q([ro({type:nI,json:{write:!0}})],kI.prototype,"verticalOffset",void 0),Q([ro(tI)],kI.prototype,"callout",void 0),Q([ro({type:CI,json:{type:OI,origins:{"web-scene":{type:OI}}}})],kI.prototype,"symbolLayers",void 0),Q([na("web-scene","symbolLayers")],kI.prototype,"writeSymbolLayers",null),Q([th({PointSymbol3D:"point-3d"},{readOnly:!0})],kI.prototype,"type",void 0),kI=AI=Q([Ro("esri.symbols.PointSymbol3D")],kI);var LI,RI=kI;const DI=xh.ofType({base:null,key:"type",typeMap:{extrude:nM,fill:RM,icon:lT,line:uT,object:_T,text:CT,water:RT}}),FI=xh.ofType({base:null,key:"type",typeMap:{extrude:nM,fill:RM,icon:lT,line:uT,object:_T,water:RT}});let jI=LI=class extends qT{constructor(e){super(e),this.symbolLayers=new DI,this.type="polygon-3d"}writeSymbolLayers(e,t,i,r){const s=e.filter((e=>"text"!==e.type));if(r&&r.messages&&s.length<e.length){const t=e.find((e=>"text"===e.type));r.messages.push(new Be("symbol-layer:unsupported","Symbol layers of type 'text' cannot be persisted in PolygonSymbol3D",{symbolLayer:t}))}t[i]=s.map((e=>e.write({},r))).toArray()}clone(){return new LI({styleOrigin:H(this.styleOrigin),symbolLayers:H(this.symbolLayers),thumbnail:H(this.thumbnail)})}static fromJSON(e){const t=new LI;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.getItemAt(0).type&&"line"===t.symbolLayers.getItemAt(1).type){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&!1===e.symbolLayers[1].enable||(i.outline={size:r.size,color:m(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new LI({symbolLayers:[RM.fromSimpleFillSymbol(e)]})}};Q([ro({type:DI,json:{type:FI}})],jI.prototype,"symbolLayers",void 0),Q([na("web-scene","symbolLayers")],jI.prototype,"writeSymbolLayers",null),Q([th({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],jI.prototype,"type",void 0),jI=LI=Q([Ro("esri.symbols.PolygonSymbol3D")],jI);var NI,zI=jI;const VI=new ee({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let UI=NI=class extends gM{constructor(...e){super(...e),this.color=new Rv([0,0,0,.25]),this.outline=new fM,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e)return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new NI({color:H(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};Q([ro()],UI.prototype,"color",void 0),Q([ro()],UI.prototype,"outline",void 0),Q([th({esriSFS:"simple-fill"},{readOnly:!0})],UI.prototype,"type",void 0),Q([ro({type:VI.apiValues,json:{read:VI.read,write:VI.write}})],UI.prototype,"style",void 0),UI=NI=Q([Ro("esri.symbols.SimpleFillSymbol")],UI);var GI,BI=UI;const qI=new ee({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let HI=GI=class extends gI{constructor(...e){super(...e),this.color=new Rv([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new fM}normalizeCtorArgs(e,t,i,r){if(e&&"string"!=typeof e)return e;const s={};return e&&(s.style=e),null!=t&&(s.size=DS(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new GI({angle:this.angle,color:H(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${null==(e=this.outline)?void 0:e.hash()}`}};Q([ro()],HI.prototype,"color",void 0),Q([na("color")],HI.prototype,"writeColor",null),Q([th({esriSMS:"simple-marker"},{readOnly:!0})],HI.prototype,"type",void 0),Q([ro()],HI.prototype,"size",void 0),Q([ro({type:qI.apiValues,json:{read:qI.read,write:qI.write}})],HI.prototype,"style",void 0),Q([ro({type:String,json:{write:!0}})],HI.prototype,"path",null),Q([ro({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":fM}},json:{default:null,write:!0}})],HI.prototype,"outline",void 0),HI=GI=Q([Ro("esri.symbols.SimpleMarkerSymbol")],HI);var WI,$I=HI;let JI=WI=class extends ES{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new FM,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment=null,this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&"string"!=typeof e)return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&"string"!=typeof r?r.origin:t[i]=e}castLineWidth(e){return DS(e)}writeLineHeight(e,t,i,r){r&&"string"!=typeof r?r.origin:t[i]=e}clone(){return new WI({angle:this.angle,backgroundColor:H(this.backgroundColor),borderLineColor:H(this.borderLineColor),borderLineSize:this.borderLineSize,color:H(this.color),font:this.font&&this.font.clone(),haloColor:H(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};Q([ro({type:Rv,json:{write:!0}})],JI.prototype,"backgroundColor",void 0),Q([ro({type:Rv,json:{write:!0}})],JI.prototype,"borderLineColor",void 0),Q([ro({type:Number,json:{write:!0}})],JI.prototype,"borderLineSize",void 0),Q([ro({type:FM,json:{write:!0}})],JI.prototype,"font",void 0),Q([ro({type:["left","right","center","justify"],json:{write:!0}})],JI.prototype,"horizontalAlignment",void 0),Q([ro({type:Boolean,json:{write:!0}})],JI.prototype,"kerning",void 0),Q([ro({type:Rv,json:{write:!0}})],JI.prototype,"haloColor",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],JI.prototype,"haloSize",void 0),Q([ro({type:Boolean,json:{write:!0}})],JI.prototype,"rightToLeft",void 0),Q([ro({type:Boolean,json:{write:!0}})],JI.prototype,"rotated",void 0),Q([ro({type:String,json:{write:!0}})],JI.prototype,"text",void 0),Q([th({esriTS:"text"},{readOnly:!0})],JI.prototype,"type",void 0),Q([ro({type:["baseline","top","middle","bottom"],json:{write:!0}})],JI.prototype,"verticalAlignment",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],JI.prototype,"xoffset",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],JI.prototype,"yoffset",void 0),Q([ro({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],JI.prototype,"angle",void 0),Q([ro({type:Number,json:{write:!0}})],JI.prototype,"width",void 0),Q([ro({type:Number})],JI.prototype,"lineWidth",void 0),Q([na("lineWidth")],JI.prototype,"writeLineWidth",null),Q([Ra("lineWidth")],JI.prototype,"castLineWidth",null),Q([ro({type:Number})],JI.prototype,"lineHeight",void 0),Q([na("lineHeight")],JI.prototype,"writeLineHeight",null),JI=WI=Q([Ro("esri.symbols.TextSymbol")],JI);var XI,KI=JI;const YI=Ne.getLogger("esri.symbols.WebStyleSymbol");let ZI=XI=class extends ES{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new XI({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=await Promise.resolve().then((function(){return UN}));tt(t);const r=i.resolveWebStyleSymbol(this,{portal:this.portal},e,t);return r.catch((e=>{YI.error("#fetchSymbol()","Failed to create symbol from style",e)})),r}};Q([ro({json:{write:!1}})],ZI.prototype,"color",void 0),Q([ro({type:String,json:{write:!0}})],ZI.prototype,"styleName",void 0),Q([ro({type:Yl,json:{write:!1}})],ZI.prototype,"portal",void 0),Q([ro({type:String,json:{read:zM,write:VM}})],ZI.prototype,"styleUrl",void 0),Q([ro({type:zT,json:{read:!1}})],ZI.prototype,"thumbnail",void 0),Q([ro({type:String,json:{write:!0}})],ZI.prototype,"name",void 0),Q([th({styleSymbolReference:"web-style"},{readOnly:!0})],ZI.prototype,"type",void 0),ZI=XI=Q([Ro("esri.symbols.WebStyleSymbol")],ZI);var QI=ZI;function eE(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function tE(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const iE={base:ES,key:"type",typeMap:{"simple-fill":BI,"picture-fill":II,"picture-marker":PI,"simple-line":fM,"simple-marker":$I,text:KI,"label-3d":hI,"line-3d":dI,"mesh-3d":bI,"point-3d":RI,"polygon-3d":zI,"web-style":QI,cim:PS},errorContext:"symbol"},rE={base:ES,key:"type",typeMap:{"picture-marker":PI,"simple-marker":$I,text:KI,"web-style":QI,cim:PS},errorContext:"symbol"},sE=co({types:iE}),nE={base:ES,key:"type",typeMap:{"simple-fill":BI,"picture-fill":II,"picture-marker":PI,"simple-line":fM,"simple-marker":$I,text:KI,"line-3d":dI,"mesh-3d":bI,"point-3d":RI,"polygon-3d":zI,"web-style":QI,cim:PS},errorContext:"symbol"},oE={base:ES,key:"type",typeMap:{text:KI,"label-3d":hI},errorContext:"symbol"},aE={base:ES,key:"type",typeMap:{"line-3d":dI,"mesh-3d":bI,"point-3d":RI,"polygon-3d":zI,"web-style":QI},errorContext:"symbol"},lE={base:ES,key:"type",typeMap:{"label-3d":hI},errorContext:"symbol"},hE=Kn(iE);let cE=0;function uE(){return++cE}var pE;let dE=pE=class extends Ko{constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:uE(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&m(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{geometry:m(this.geometry)?this.geometry.toJSON():null,symbol:m(this.symbol)?this.symbol.toJSON():null,attributes:a({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}clone(){return new pE(this.cloneProperties())}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}cloneProperties(){return{attributes:H(this.attributes),geometry:H(this.geometry),layer:this.layer,popupTemplate:this.popupTemplate&&this.popupTemplate.clone(),sourceLayer:this.sourceLayer,symbol:H(this.symbol),visible:this.visible}}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};"attributes"===e&&(s.attributeName=r),this.layer.graphicChanged(s)}};Q([ro({value:null})],dE.prototype,"attributes",null),Q([ro({value:null,types:mw,json:{read:dw}})],dE.prototype,"geometry",null),Q([ro({type:Boolean})],dE.prototype,"isAggregate",void 0),Q([ro()],dE.prototype,"layer",void 0),Q([ro({type:xS})],dE.prototype,"popupTemplate",void 0),Q([ro()],dE.prototype,"sourceLayer",void 0),Q([ro({value:null,types:iE})],dE.prototype,"symbol",null),Q([ro({type:Boolean,value:!0})],dE.prototype,"visible",null),dE=pE=Q([Ro("esri.Graphic")],dE),(dE||(dE={})).generateUID=uE;var fE=dE;const yE={statsWorker:()=>import("./statsWorker.b8418b96.js"),geometryEngineWorker:()=>import("./geometryEngineWorker.50fb03de.js"),CSVSourceWorker:()=>import("./CSVSourceWorker.7fb45fc6.js"),EdgeProcessingWorker:()=>import("./EdgeProcessingWorker.03361800.js"),ElevationSamplerWorker:()=>import("./ElevationSamplerWorker.90c8856f.js"),FeatureServiceSnappingSourceWorker:()=>import("./FeatureServiceSnappingSourceWorker.7cdd05a4.js"),GeoJSONSourceWorker:()=>import("./GeoJSONSourceWorker.8139c6b9.js"),LercWorker:()=>import("./LercWorker.57e4e9aa.js"),MemorySourceWorker:()=>import("./MemorySourceWorker.77351359.js"),PBFDecoderWorker:()=>import("./PBFDecoderWorker.4f11e4bd.js"),Pipeline:()=>import("./Pipeline.b33e4c06.js"),PointCloudWorker:()=>import("./PointCloudWorker.7d8a49df.js"),RasterWorker:()=>import("./RasterWorker.16c197af.js"),SceneLayerWorker:()=>import("./SceneLayerWorker.ba0eca02.js"),WFSSourceWorker:()=>import("./WFSSourceWorker.70baa879.js"),WorkerTileHandler:()=>import("./WorkerTileHandler.85b0b208.js")};var gE;!function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"}(gE||(gE={}));let mE=0;function vE(){return mE++}function bE(e){return e?"string"==typeof e?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function wE(e,t,i,r){if(t.type===gE.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==gE.INVOKE&&t.type!==gE.RESPONSE)return void e.postMessage(t);let s;!function(e){return e&&"object"==typeof e&&("result"in e||"transferList"in e)}(i)?(s=xE(r),t.data=i):(s=xE(i.transferList),t.data=i.result),s?e.postMessage(t,s):e.postMessage(t)}function _E(e){if(!e)return null;const t=e.data;return t?"string"==typeof t?JSON.parse(t):t:null}function xE(e){if(!e||!e.length)return null;if(y("esri-workers-arraybuffer-transfer"))return e;const t=e.filter((e=>!function(e){return e instanceof ArrayBuffer||e&&e.constructor&&"ArrayBuffer"===e.constructor.name}(e)));return t.length?t:null}const{CLOSE:SE,ABORT:ME,INVOKE:TE,RESPONSE:IE,OPEN_PORT:EE,ON:AE}=gE;class PE{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===gE.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class CE{constructor(e,t){this._port=e,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new PE((e=>this._onInvokeMessage(e))),this._client=t.client,this._onMessage=this._onMessage.bind(this),this._channel=t.channel,this._schedule=t.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(e){const t=new MessageChannel;let i;i="function"==typeof e?new e:"default"in e&&"function"==typeof e.default?new e.default:e;const r=new CE(t.port1,{channel:t,client:i});return"object"==typeof i&&"remoteClient"in i&&(i.remoteClient=r),CE.clients.set(r,i),t.port2}static loadWorker(e){const t=yE[e];return t?t():Promise.resolve(null)}close(){this._post({type:SE}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,t,i){const r=i&&i.signal,s=i&&i.transferList;if(!this._port)return Promise.reject(new Be("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:t}));const n=vE();return new Promise(((i,o)=>{const a=at(r,(()=>{var e;const t=this._outJobs.get(n);t&&(this._outJobs.delete(n),null==(e=t.abortHandle)||e.remove(),this._post({type:ME,jobId:n}),o(Qe()))})),l={resolve:i,reject:o,abortHandle:a,debugInfo:e};this._outJobs.set(n,l),this._post({type:TE,jobId:n,methodName:e,abortable:null!=r},t,s)}))}on(e,t){const i=new MessageChannel;function r(e){t(e.data)}return this._port.postMessage({type:gE.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",r),i.port1.start(),{remove(){i.port1.postMessage({type:gE.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",r)}}}openPort(){const e=new MessageChannel;return this._post({type:EE,port:e.port2}),e.port1}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach((e=>{var t;null==(t=e.abortHandle)||t.remove(),e.reject(Qe(`Worker closing, aborting job calling '${e.debugInfo}'`))})),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(e){m(this._schedule)?this._schedule((()=>this._processMessage(e))):this._processMessage(e)}_processMessage(e){const t=_E(e);if(t)switch(t.type){case IE:this._onResponseMessage(t);break;case TE:this._invokeQueue.push(t);break;case ME:this._onAbortMessage(t);break;case SE:this._onCloseMessage();break;case EE:this._onOpenPortMessage(t);break;case AE:this._onOnMessage(t)}}_onAbortMessage(e){const t=this._inJobs,i=e.jobId,r=t.get(i);this._invokeQueue.push(e),r&&(r.controller&&r.controller.abort(),t.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&CE.clients.get(this)===e&&e.destroy(),CE.clients.delete(this),e&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:t,jobId:i,data:r,abortable:s}=e,n=s?et():null,o=this._inJobs;let a,l=this._client,h=l[t];try{if(!h&&t&&-1!==t.indexOf(".")){const e=t.split(".");for(let t=0;t<e.length-1;t++)l=l[e[t]],h=l[e[t+1]]}if("function"!=typeof h)throw new TypeError(`${t} is not a function`);a=h.call(l,r,{client:this,signal:n?n.signal:null})}catch(c){return void this._post({type:IE,jobId:i,error:bE(c)})}mt(a)?(o.set(i,{controller:n,promise:a}),a.then((e=>{o.has(i)&&(o.delete(i),this._post({type:IE,jobId:i},e))}),(e=>{o.has(i)&&(o.delete(i),ht(e)||this._post({type:IE,jobId:i,error:bE(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:IE,jobId:i},a)}_onOpenPortMessage(e){new CE(e.port,{client:this._client})}_onOnMessage(e){const{port:t}=e,i=this._client.on(e.eventType,(e=>{t.postMessage(e)})),r=$e(e.port,"message",(e=>{_E(e).type===gE.CLOSE&&(r.remove(),i.remove(),t.close())}))}_onResponseMessage(e){var t;const{jobId:i,error:r,data:s}=e,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);n.delete(i),null==(t=o.abortHandle)||t.remove(),r?o.reject(Be.fromJSON(JSON.parse(r))):o.resolve(s)}_post(e,t,i){return wE(this._port,e,t,i)}}CE.kernelInfo={revision:Ni,version:"4.20",buildDate:"20210707"},CE.clients=new Map;const OE=Ne.getLogger("esri.core.workers.Connection");class kE{constructor(){this._clients=new Array,this._clientPromises=new Array,this._clientIdx=0}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,t){return new Promise(((i,r)=>{let s=!0;const n=e=>{tt(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length;for(let o=0;o<e.length;++o){const s=e[o];mt(s)?this._clientPromises[o]=s.then((e=>(this._clients[o]=new CE(e,t),n(i),this._clients[o])),(()=>(n(r),null))):(this._clients[o]=new CE(s,t),this._clientPromises[o]=Promise.resolve(this._clients[o]),n(i))}}))}broadcast(e,t,i){const r=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const n=this._clientPromises[s];r[s]=n.then((r=>r.invoke(e,t,i)))}return r}close(){for(const e of this._clientPromises)e.then((e=>e.close()));this._clients.length=0,this._clientPromises.length=0}getAvailableClient(){let e;for(let t=0;t<this._clients.length;++t){const i=this._clients[t];if(i){if(!i.isBusy())return Promise.resolve(i)}else e=e||[],e.push(this._clientPromises[t])}return e?Promise.race(e):(this._clientIdx=(this._clientIdx+1)%this._clients.length,Promise.resolve(this._clients[this._clientIdx]))}invoke(e,t,i){let r=null;return Array.isArray(i)?(OE.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),r={transferList:i}):r=i,this.closed?Promise.reject(new Error("Connection closed")):this.getAvailableClient().then((i=>i.invoke(e,t,r)))}on(e,t){return Promise.all(this._clientPromises).then((()=>_r(this._clients.map((i=>i.on(e,t))))))}openPorts(){return new Promise((e=>{const t=new Array(this._clientPromises.length);let i=t.length;for(let r=0;r<this._clientPromises.length;++r)this._clientPromises[r].then((s=>{t[r]=s.openPort(),0==--i&&e(t)}))}))}get test(){return{numClients:this._clients.length}}}const LE={};class RE{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach((t=>{this[t]=(...i)=>e[t](...i)}))}}const DE=h.MutationObserver||h.WebKitMutationObserver,FE=function(){let e;if(h.process&&h.process.nextTick)e=e=>{h.process.nextTick(e)};else if(h.Promise)e=e=>{h.Promise.resolve().then(e)};else if(DE){const t=[],i=document.createElement("div");new DE((()=>{for(;t.length>0;)t.shift()()})).observe(i,{attributes:!0}),e=e=>{t.push(e),i.setAttribute("queueStatus","1")}}return e}(),jE=(()=>{const e=h.MessageEvent;try{new e("message",{data:null})}catch{return(e,t={})=>{const{data:i,bubbles:r=!1,cancelable:s=!1}=t,n=document.createEvent("Event");return n.initEvent(e,r,s),n.data=i,n}}return(t,i)=>new e(t,i)})();class NE{constructor(){this._dispatcher=new RE,this._workerPostMessage({type:gE.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){FE((()=>{this._workerMessageHandler(jE("message",{data:e}))}))}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,i){this._dispatcher.addEventListener(e,t,i)}removeEventListener(e,t,i){this._dispatcher.removeEventListener(e,t,i)}_workerPostMessage(e){FE((()=>{this.dispatchEvent(jE("message",{data:e}))}))}async _workerMessageHandler(e){const t=_E(e);if(t&&t.type===gE.OPEN){const{modulePath:e,jobId:i}=t;let r=await CE.loadWorker(e);r||(r=await import(e));const s=CE.connect(r);this._workerPostMessage({type:gE.OPENED,jobId:i,data:s})}}}const zE=Ne.getLogger("esri.core.workers"),{HANDSHAKE:VE}=gE;let UE,GE;const BE="Failed to create Worker. Fallback to execute module in main thread";async function qE(){if(!y("esri-workers"))return HE(new NE);if(!UE&&!GE)try{const e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.replace('"{CONFIGURATION}"',`'${function(){let e;if(null!=Z.default){const t=a({},Z);delete t.default,e=JSON.parse(JSON.stringify(t))}else e=JSON.parse(JSON.stringify(Z));e.assetsPath=ai(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=le(),e.has={"csp-restrictions":y("csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":y("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":y("esri-2d-query-centroid-enabled"),"featurelayer-pbf":y("featurelayer-pbf"),"esri-atomics":y("esri-atomics"),"esri-shared-array-buffer":y("esri-shared-array-buffer"),"esri-tiles-debug":y("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":y("esri-workers-arraybuffer-transfer"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=ai(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=ai(e.workers.workerPath):e.workers.workerPath=ai(gr("esri/core/workers/RemoteClient.js"));const t=Z.workers.loaderConfig,i=function(e){var t;const i={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:a({},e.has),map:a({},e.map),packages:e.packages&&e.packages.concat()||[],paths:a({},e.paths)};return e.hasOwnProperty("async")||(i.async=!0),e.hasOwnProperty("isDebug")||(i.isDebug=!1),e.baseUrl||(i.baseUrl=LE.baseUrl),null==(t=LE.packages)||t.forEach((e=>{!function(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}(i.packages,e)})),i}({baseUrl:null==t?void 0:t.baseUrl,locale:le(),has:a({"csp-restrictions":y("csp-restrictions"),"dojo-test-sniff":0,"host-webworker":1},null==t?void 0:t.has),map:a({},null==t?void 0:t.map),paths:a({},null==t?void 0:t.paths),packages:(null==t?void 0:t.packages)||[]}),r={version:"4.20",buildDate:ji,revision:Ni};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}()}'`);UE=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(ehe){GE=ehe||{}}let e;if(UE)try{e=new Worker(UE,{name:"esri-worker-"+WE++})}catch(ehe){zE.warn(BE,GE),e=new NE}else zE.warn(BE,GE),e=new NE;return HE(e)}async function HE(e){return new Promise((t=>{function i(s){const n=_E(s);n&&n.type===VE&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(t){t.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),zE.warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new NE).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)}))}let WE=0;const $E=Ne.getLogger("esri.core.workers"),{ABORT:JE,INVOKE:XE,OPEN:KE,OPENED:YE,RESPONSE:ZE}=gE;class QE{constructor(e,t){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=t,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",(e=>{e.preventDefault(),$E.error(e)}))}static async create(e){const t=await qE();return new QE(t,e)}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:i}=t,r=vE();return new Promise(((t,s)=>{const n={resolve:t,reject:s,abortHandle:at(i,(()=>{this._outJobs.delete(r),this._post({type:JE,jobId:r})}))};this._outJobs.set(r,n),this._post({type:KE,jobId:r,modulePath:e})}))}_onMessage(e){const t=_E(e);if(t)switch(t.type){case YE:this._onOpenedMessage(t);break;case ZE:this._onResponseMessage(t);break;case JE:this._onAbortMessage(t);break;case XE:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,i=e.jobId,r=t.get(i);r&&(r.controller&&r.controller.abort(),t.delete(i))}_onInvokeMessage(e){const{methodName:t,jobId:i,data:r,abortable:s}=e,n=s?et():null,o=this._inJobs,a=Vi[t];let l;try{if("function"!=typeof a)throw new TypeError(`${t} is not a function`);l=a.call(null,r,{signal:n?n.signal:null})}catch(h){return void this._post({type:ZE,jobId:i,error:bE(h)})}mt(l)?(o.set(i,{controller:n,promise:l}),l.then((e=>{o.has(i)&&(o.delete(i),this._post({type:ZE,jobId:i},e))}),(e=>{o.has(i)&&(o.delete(i),e||(e={message:"Error encountered at method"+t}),ht(e)||this._post({type:ZE,jobId:i,error:bE(e||{message:`Error encountered at method ${t}`})}))}))):this._post({type:ZE,jobId:i},l)}_onOpenedMessage(e){var t;const{jobId:i,data:r}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),null==(t=s.abortHandle)||t.remove(),s.resolve(r))}_onResponseMessage(e){var t;const{jobId:i,error:r,data:s}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),null==(t=n.abortHandle)||t.remove(),r?n.reject(Be.fromJSON(JSON.parse(r))):n.resolve(s))}_post(e,t,i){return wE(this.worker,e,t,i)}}let eA=y("esri-workers-debug")?1:y("host-browser")?navigator.hardwareConcurrency-1:0;eA||(eA=y("safari")&&y("mac")||y("trident")?7:2);let tA=0;const iA=[];function rA(e,t){return sA(e,{client:t})}async function sA(e,t){const i=new kE;return await i.open(e,t),i}async function nA(e,t={}){if("string"!=typeof e)throw new Be("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(y("host-webworker")&&!y("esri-workers")&&(i="local"),"local"===i){let i=await CE.loadWorker(e);i||(i=await import(e)),tt(t.signal);const r=t.client||i;return sA([CE.connect(i)],l(a({},t),{client:r}))}if(await aA(),tt(t.signal),"dedicated"===i){const i=tA++%eA;return sA([await iA[i].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const i=Math.min(t.maxNumWorkers,eA);if(i<eA){const r=new Array(i);for(let s=0;s<i;++s){const i=tA++%eA;r[s]=iA[i].open(e,t)}return sA(r,t)}}return sA(iA.map((i=>i.open(e,t))),t)}let oA=null;async function aA(){if(oA)return oA;et();const e=[];for(let t=0;t<eA;t++){const i=QE.create(t).then((e=>(iA[t]=e,e)));e.push(i)}return oA=Promise.all(e),oA}const lA={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},hA={xsmall:544,small:768,medium:992,large:1200};function cA(e,t){return t?lA[e].valueToClassName[t].split(" "):[]}const uA=e=>{let t=class extends e{constructor(...e){super(...e),this._breakpointsHandles=new Mh,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=hA}initialize(){this._breakpointsHandles.add(Rh(this,["breakpoints","size"],this._updateClassNames))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)}set breakpoints(e){if(e===this._get("breakpoints"))return;const t=function(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){const e=JSON.stringify(hA,null,2);console.warn("provided breakpoints are not valid, using defaults:"+e)}e=t?e:hA,this._set("breakpoints",a({},e))}_updateClassNames(){if(!this.container)return;const e=Cs.acquire(),t=Cs.acquire();let i,r=!1;for(i in lA){const s=this[i],n=lA[i].getValue({viewSize:this.size,breakpoints:this.breakpoints});s!==n&&(r=!0,this[i]=n,cA(i,s).forEach((e=>t.push(e))),cA(i,n).forEach((t=>e.push(t))))}r&&(this._applyClassNameChanges(e,t),Cs.release(e),Cs.release(t))}_applyClassNameChanges(e,t){const i=this.container;i&&(t.forEach((e=>i.classList.remove(e))),e.forEach((e=>i.classList.add(e))))}_removeActiveClassNames(){const e=this.container;if(!e)return;let t;for(t in lA)cA(t,this[t]).forEach((t=>e.classList.remove(t)))}};return Q([ro()],t.prototype,"breakpoints",null),Q([ro()],t.prototype,"orientation",void 0),Q([ro()],t.prototype,"widthBreakpoint",void 0),Q([ro()],t.prototype,"heightBreakpoint",void 0),t=Q([Ro("esri.views.BreakpointsOwner")],t),t};let pA=class extends jo{constructor(){super(...arguments),this.items=new xh,this._watchUpdatingTracking=new Hv,this._callbacks=new Map,this._projector=Yu(),this._hiddenProjector=Yu()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(this.items,(e=>{e.added.map((e=>{const t=()=>e.render();this._callbacks.set(e,t),this._projector.append(this.surface,t)})),e.removed.map((e=>{const t=this._projector.detach(this._callbacks.get(e));this.surface.removeChild(t.domNode),this._callbacks.delete(e)}))}))}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach((e=>this._projector.detach(e))),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const e=r.domNode.getBoundingClientRect();n.left=e.left,n.top=e.top,n.right=e.right,n.bottom=e.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some((e=>e.visible))}renderCanvas(e){if(!this.items.some((e=>e.visible)))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach((e=>{t.save(),e.renderCanvas(t),t.restore()})),t.restore()}};Q([ro({readOnly:!0})],pA.prototype,"surface",void 0),Q([ro({readOnly:!0})],pA.prototype,"items",void 0),Q([ro({readOnly:!0})],pA.prototype,"needsRender",null),Q([ro({readOnly:!0})],pA.prototype,"_watchUpdatingTracking",void 0),Q([ro({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],pA.prototype,"updating",void 0),pA=Q([Ro("esri.views.overlay.ViewOverlay")],pA);var dA=pA;function fA(e,t,i,r){let s=null,n=1e3;"number"==typeof t?(n=t,r=i):(s=null!=t?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},h=(...e)=>{s&&s.apply(r,e),o=e,n?a||(a=setTimeout(l,n)):l()};return h.remove=()=>{a&&(clearTimeout(a),a=0)},h.forceUpdate=()=>{a&&(clearTimeout(a),l())},h.hasPendingUpdates=()=>!!a,h}function yA(e){return new Aa({wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${e.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`})}const gA=yA(Fa),mA=yA(ja),vA=yA(Na),bA=new Aa({wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${Fa.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`});function wA(e){return e&&e===ja?mA:e&&e===Na?vA:gA}function _A(e){return e&&(_a(e)||e===mA)?mA:e&&(Sa(e)||e===vA)?vA:gA}function xA(e){return e&&(_a(e)||e===mA)?ja:e&&(Sa(e)||e===vA)?Na:Fa}function SA(e){return wa(e)?ja:xa(e)?Na:Fa}const MA=Fa.radius*Math.PI/200,TA=/UNIT\[([^\]]+)\]\]$/i,IA=aa,EA=/UNIT\[([^\]]+)\]/i,AA=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),PA=te()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),CA=e=>e*e,OA=e=>e*e*e,kA={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:CA(.001)},"square-centimeters":{inBaseUnits:CA(.01)},"square-decimeters":{inBaseUnits:CA(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:CA(1e3)},"square-inches":{inBaseUnits:CA(.0254)},"square-feet":{inBaseUnits:CA(.3048)},"square-yards":{inBaseUnits:CA(.9144)},"square-miles":{inBaseUnits:CA(1609.344)},"square-us-feet":{inBaseUnits:CA(1200/3937)},acres:{inBaseUnits:.0015625*CA(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*OA(.001)},"cubic-centimeters":{inBaseUnits:1e3*OA(.01)},"cubic-decimeters":{inBaseUnits:1e3*OA(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*OA(1e3)},"cubic-inches":{inBaseUnits:1e3*OA(.0254)},"cubic-feet":{inBaseUnits:1e3*OA(.3048)},"cubic-yards":{inBaseUnits:1e3*OA(.9144)},"cubic-miles":{inBaseUnits:1e3*OA(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},LA=function(){const e={};for(const t in kA)for(const i in kA[t].units)e[i]=t;return e}();function RA(e){const t=LA[e];if(t)return t;throw new Error("unknown measure")}function DA(e,t=null){return t=t||RA(e),kA[t].baseUnit===e}function FA(e,t,i){if(t===i)return e;const r=RA(t);if(r!==RA(i))throw new Error("incompatible units");const s=DA(t,r)?e:function(e,t,i){return e*kA[i].units[t].inBaseUnits}(e,t,r);return DA(i,r)?s:function(e,t,i){return e/kA[i].units[t].inBaseUnits}(s,i,r)}function jA(e,t,i){return FA(e,t,"meters")/(i*Math.PI/180)}function NA(e){return PA.fromJSON(e.toLowerCase())||null}function zA(e){if(e&&"object"==typeof e&&!function(e){return!(_a(e)||Sa(e))}(e))return 1;const t=VA(e);return t>1e5?1:t}function VA(e,t=Fa.metersPerDegree){return UA(e,!0)||t}function UA(e,t=!1){let i,r,s=null;if(null!=e&&("object"==typeof e?(i=e.wkid,r=e.wkt):"number"==typeof e?i=e:"string"==typeof e&&(r=e)),i){if(wa(i))return ja.metersPerDegree;if(xa(i))return Na.metersPerDegree;s=IA.values[IA[i]],!s&&t&&AA.has(i)&&(s=MA)}else if(r)if(-1!==r.search(/^PROJCS/i)){const e=TA.exec(r);e&&e[1]&&(s=parseFloat(e[1].split(",")[1]))}else if(-1!==r.search(/^GEOCCS/i)){const e=EA.exec(r);e&&e[1]&&(s=parseFloat(e[1].split(",")[1]))}return s}function GA(e){let t,i,r=null;if(null!=e&&("object"==typeof e?(t=e.wkid,i=e.wkt):"number"==typeof e?t=e:"string"==typeof e&&(i=e)),t)r=IA.units[IA[t]];else if(i&&-1!==i.search(/^PROJCS/i)){let e=TA.exec(i);e&&e[1]&&(e=/[\\"\\']{1}([^\\"\\']+)/.exec(e[1]),r=e&&e[1])}return r?NA(r):null}const BA={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},qA={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},HA=te()(BA),WA=te()(qA);te()(a(a({},BA),qA));const $A=["B","kB","MB","GB","TB"];var JA;const XA={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let KA=JA=class extends Ko{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=function(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find((e=>e.name===i));return s?function(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find((e=>e.name===t));return r&&r.value||null}({tagName:r,tags:s.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return XA[t]||null}clone(){return new JA({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};Q([ro({type:String})],KA.prototype,"contentType",void 0),Q([ro()],KA.prototype,"exifInfo",void 0),Q([ro({readOnly:!0})],KA.prototype,"orientationInfo",null),Q([ro({type:Yn})],KA.prototype,"id",void 0),Q([ro({type:String})],KA.prototype,"globalId",void 0),Q([ro({type:String})],KA.prototype,"keywords",void 0),Q([ro({type:String})],KA.prototype,"name",void 0),Q([ro({json:{read:!1}})],KA.prototype,"parentGlobalId",void 0),Q([ro({json:{read:!1}})],KA.prototype,"parentObjectId",void 0),Q([ro({type:Yn})],KA.prototype,"size",void 0),Q([ro({json:{read:!1}})],KA.prototype,"url",void 0),KA=JA=Q([Ro("esri.layers.support.AttachmentInfo")],KA);var YA,ZA=KA;let QA=YA=class extends Ko{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new YA(H({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};Q([ro({type:[String],json:{write:!0}})],QA.prototype,"attachmentTypes",void 0),Q([ro({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],QA.prototype,"attachmentsWhere",void 0),Q([ro({type:[String],json:{write:!0}})],QA.prototype,"keywords",void 0),Q([ro({type:[Number],json:{write:!0}})],QA.prototype,"globalIds",void 0),Q([ro({json:{write:!0}})],QA.prototype,"name",void 0),Q([ro({type:Number,json:{read:{source:"resultRecordCount"}}})],QA.prototype,"num",void 0),Q([ro({type:[Number],json:{write:!0}})],QA.prototype,"objectIds",void 0),Q([ro({type:Boolean,json:{default:!1,write:!0}})],QA.prototype,"returnMetadata",void 0),Q([ro({type:[Number],json:{write:!0}})],QA.prototype,"size",void 0),Q([ro({type:Number,json:{read:{source:"resultOffset"}}})],QA.prototype,"start",void 0),Q([na("start"),na("num")],QA.prototype,"writeStart",null),Q([ro({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],QA.prototype,"where",void 0),QA=YA=Q([Ro("esri.rest.support.AttachmentQuery")],QA),QA.from=qn(QA);var eP=QA;const tP=Ne.getLogger("esri.widgets.Feature.support.featureUtils"),iP=/href=(""|'')/gi,rP=/(\{([^\{\r\n]+)\})/g,sP=/\'/g,nP=/^\s*expression\//i,oP=/(\n)/gi,aP=/[\u00A0-\u9999<>\&]/gim,lP=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,hP=/^(?:mailto:|tel:)/,cP="relationships/",uP=Me("short-date-short-time");function pP(e){if(!v(e))return e.get("sourceLayer")||e.get("layer")}async function dP(e,t){return"function"==typeof e?e.call(null,t):e}function fP(e=""){if(e)return!hP.test(e.trim().toLowerCase())}function yP(e,t){if(!function(e){return nP.test(e)}(t)||!e)return null;const i=t.replace(nP,"").toLowerCase();let r;return e.some((e=>e.name.toLowerCase()===i&&(r=e,!0))),r}function gP(e,t){const i=yP(t,null==e?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function mP(e,t){const i=vP(t,e);return i?i.name:e}function vP(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function bP(e){return`${e}`.trim()}function wP({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?_P({formattedAttributes:t,template:MP(r,a(a(a({},t),s),e),i),fieldInfoMap:n}):""}function _P({formattedAttributes:e,template:t,fieldInfoMap:i}){return bP(function(e){return e.replace(iP,"")}(Le(Le(t,(e=>function(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}(e,i))),e)))}function xP(e,t=!1){const i=a({},e);return Object.keys(i).forEach((e=>function(e,t,i=!1){const r=t[e];if("string"==typeof r){const s="%27",n=(i?encodeURIComponent(r):r).replace(sP,s);t[e]=n}}(e,i,t))),i}function SP(e,t){return e.replace(rP,((e,i,r)=>{const s=vP(t,r);return s?`{${s.name}}`:i}))}function MP(e,t,i){const r=SP(e,i);return r?r.replace(lP,((e,i,r)=>function(e,t,i){return Le(e,xP(i,(t=bP(t))&&"{"!==t[0]))}(e,i||r,t))):r}function TP(e,t){const i=t.fieldInfos,r=t.fieldName,s=IP(i,r),n=null==s?void 0:s.clone(),o=t.preventPlacesFormatting,h=vP(t.layer,r);if(n&&h&&"date"===h.type){const e=n.format||new nx;e.dateFormat=e.dateFormat||"short-date-short-time",n.format=e}const c=n&&n.format;return"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,c))||null==e||null==c?e:o?Ce(e,l(a({},Pe(c)),{minimumFractionDigits:0,maximumFractionDigits:20})):c.format(e)}function IP(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i||(r=e,0)))),r}function EP(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)?(r.forEach((e=>{if("fields"===e.type){const i=e&&e.fieldInfos;i&&t.push(...i)}})),t):t}function AP(e){return e.replace(aP,(e=>`&#${e.charCodeAt(0)};`))}function PP(e){return"string"==typeof e?e.replace(oP,'<br class="esri-text-new-line" />'):e}function CP(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(null==t)return"";const a=function({fieldName:e,value:t,graphic:i,layer:r}){if(LP(e))return null;if(!r||"function"!=typeof r.getFieldDomain)return null;const s=r.getFieldDomain(e,{feature:i});return s&&"coded-value"===s.type?s.getName(t):null}({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=function({fieldName:e,graphic:t,layer:i}){if(LP(e))return null;if(!i||"function"!=typeof i.getFeatureType)return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return TP(t,{fieldInfos:r,fieldName:i,layer:n});const h=n&&n.fieldsIndex;return h&&h.isDateField(i)?Te(t,uP):PP(t)}function OP({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o=a({},t);return null==n||n.forEach((e=>function(e,t){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach((i=>RP({attributes:e,graphic:i,relatedInfo:t}))),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach((i=>RP({attributes:e,graphic:i,relatedInfo:t}))))}(o,e))),Object.keys(o).forEach((t=>{const n=o[t];o[t]=CP({fieldName:t,fieldInfos:e,fieldInfoMap:s,layer:i,value:n,graphic:r})})),o}async function kP({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t)return;if("function"==typeof i.load&&await i.load(s),!e.attributes)return;const n=e.attributes[i.objectIdField];if(null==n)return;const o=[n],l=await t.getRequiredFields(i.fieldsIndex),h=W_(l,e),c=h?[]:l,u=t.returnGeometry||await async function(e){var t;if(null==(t=e.expressionInfos)||!t.length)return!1;const i=await i_(),{arcadeUtils:{hasGeometryFunctions:r}}=i;return r(e)}(t);if(h&&!u)return;const p=await async function(e,t){var i,r;const{layer:s,graphic:n,outFields:o,objectIds:a,returnGeometry:l,spatialReference:h}=e,c=a[0];if("number"!=typeof c&&"string"!=typeof c){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:s,graphic:n,objectId:c,requiredFields:o};return tP.warn(e,t),null}if(null==(i=s.capabilities)||null==(r=i.operations)||!r.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:s,graphic:n,requiredFields:o,returnGeometry:l};return tP.warn(e,t),null}const u=s.createQuery();return u.objectIds=a,u.outFields=null!=o&&o.length?o:[s.objectIdField],u.returnGeometry=!!l,u.outSpatialReference=h,(await s.queryFeatures(u,t)).features[0]}({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:u,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes=a(a({},e.attributes),p.attributes)))}function LP(e=""){return!!e&&-1!==e.indexOf(cP)}function RP({attributes:e,graphic:t,relatedInfo:i}){e&&t&&i&&Object.keys(t.attributes).forEach((r=>{const s=function(e){return e?`${cP}${e.layerId}/${e.fieldName}`:""}({layerId:i.relation.id.toString(),fieldName:r});e[s]=t.attributes[r]}))}const DP={editing:!1,operations:{add:!0,update:!0,delete:!0}},FP=xh.ofType(ZA);let jP=class extends Jv{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=a({},DP),this.activeAttachmentInfo=null,this.attachmentInfos=new FP,this.graphic=null,this.mode="view",this.handles.add([Rh(this,"graphic",(()=>this._graphicChanged()))])}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return a(a({},DP),e)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||"function"!=typeof e.queryAttachments)throw new Be("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new eP({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then((e=>e[i]||s)).catch((()=>s));this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new Be("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new Be("invalid-abilities","addAttachment(): add abilities are required.");if(!t||"function"!=typeof t.addAttachment)throw new Be("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then((e=>this._queryAttachment(e.objectId))),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new Be("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new Be("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new Be("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then((()=>e)),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new Be("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new Be("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new Be("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex((e=>e===t));if(!i||"function"!=typeof i.updateAttachment)throw new Be("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then((e=>this._queryAttachment(e.objectId))),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new Be("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new eP({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then((e=>e[i][0]))}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((()=>{})))}_setAttachmentLayer(){const{graphic:e}=this,t=pP(e);this._attachmentLayer=t?"scene"===t.type&&m(t.associatedLayer)?t.associatedLayer:t:null}};Q([ro()],jP.prototype,"abilities",void 0),Q([Ra("abilities")],jP.prototype,"castAbilities",null),Q([ro()],jP.prototype,"activeAttachmentInfo",void 0),Q([ro({readOnly:!0,type:FP})],jP.prototype,"attachmentInfos",void 0),Q([ro({type:fE})],jP.prototype,"graphic",void 0),Q([ro()],jP.prototype,"mode",void 0),Q([ro({readOnly:!0})],jP.prototype,"state",null),Q([ro({readOnly:!0})],jP.prototype,"supportsResizeAttachments",null),jP=Q([Ro("esri.widgets.Attachments.AttachmentsViewModel")],jP);var NP=jP;const zP={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},VP="esri-attachments",UP="esri-attachments__loader-container",GP="esri-attachments__loader",BP="esri-attachments__container",qP="esri-attachments__container--list",HP="esri-attachments__container--preview",WP="esri-attachments__actions",$P="esri-attachments__delete-button",JP="esri-attachments__add-attachment-button",XP="esri-attachments__error-message",KP="esri-attachments__items",YP="esri-attachments__item",ZP="esri-attachments__item-button",QP="esri-attachments__item-mask",eC="esri-attachments__item-mask--icon",tC="esri-attachments__image",iC="esri-attachments__image--resizable",rC="esri-attachments__label",sC="esri-attachments__filename",nC="esri-attachments__item-chevron-icon",oC="esri-attachments__item-link",aC="esri-attachments__item-link-overlay",lC="esri-attachments__item-link-overlay-icon",hC="esri-attachments__item-add-icon",cC="esri-attachments__form-node",uC="esri-attachments__file-fieldset",pC="esri-attachments__file-label",dC="esri-attachments__file-name",fC="esri-attachments__file-input",yC="esri-attachments__metadata",gC="esri-attachments__metadata-fieldset",mC="esri-attachments__progress-bar",vC="esri-widget",bC="esri-button",wC="esri-button--disabled",_C="esri-button--secondary",xC="esri-button--tertiary",SC="esri-button--third",MC="esri-button--small",TC="esri-button--half",IC="esri-widget__content--empty",EC="esri-icon-right",AC="esri-icon-left",PC="esri-icon-plus",CC=window.CSS;let OC=class extends xy{constructor(e,t){super(e,t),this.abilities=null,this.displayType="list",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new NP,this.visibleElements=a({},zP),this._supportsImageOrientation=CC&&CC.supports&&CC.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own(Hh(this,"viewModel.attachmentInfos","change",(()=>this.scheduleRender())),Rh(this,"viewModel.mode",(()=>this._modeChanged())))}castVisibleElements(e){return a(a({},zP),e)}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new Be("attachments:add-attachment",this.messages.addErrorMessage,e)),e}))}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then((e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e))).catch((e=>{throw this._set("submitting",!1),this._set("error",new Be("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e}))}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then((t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t))).catch((e=>{throw this._set("submitting",!1),this._set("error",new Be("attachments:update-attachment",this.messages.updateErrorMessage,e)),e}))}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return Iy("div",{class:this.classes(VP,vC)},e?this.renderProgressBar():null,"loading"===i?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?Iy("div",{key:"error-message",class:XP},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return"add"===e?this.renderAddForm():"edit"===e?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return Iy("div",{class:UP,key:"loader"},Iy("div",{class:GP}))}renderProgressBar(){return this.visibleElements.progressBar?Iy("div",{class:mC,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?Iy("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(bC,xC,MC,TC,e&&wC)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?Iy("button",{type:"submit",disabled:i,class:this.classes(bC,_C,MC,TC,{[wC]:i})},this.messages.add):null,n=t?Iy("span",{key:"file-name",class:dC},t.name):null,o=Iy("form",{bind:this,afterCreate:uu,afterRemoved:cu,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Iy("fieldset",{class:uC},n,Iy("label",{class:this.classes(pC,bC,_C)},t?this.messages.changeFile:this.messages.selectFile,Iy("input",{class:fC,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return Iy("div",{key:"add-form-container",class:cC},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,h=s||!r,c=l.editing&&l.operations.delete&&t.deleteButton?Iy("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:t=>this._submitDeleteAttachment(t,e),class:this.classes(bC,MC,xC,$P,{[wC]:s})},this.messages.delete):null,u=l.editing&&l.operations.update&&t.updateButton?Iy("button",{disabled:h,key:"update-button",type:"submit",class:this.classes(bC,MC,SC,{[wC]:h})},this.messages.update):null,p=this.visibleElements.cancelUpdateButton?Iy("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(bC,MC,xC,SC,{[wC]:s})},this.messages.cancel):null,d=r?Iy("span",{key:"file-name",class:dC},r.name):null,f=l.editing&&l.operations.update?Iy("fieldset",{key:"file",class:uC},d,Iy("label",{class:this.classes(pC,bC,_C)},this.messages.changeFile,Iy("input",{class:fC,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,y=Iy("fieldset",{key:"size",class:gC},Iy("label",null,function(e,t){let i=0===t?0:Math.floor(Math.log(t)/Math.log(1024));i=mv(i,0,$A.length-1);const r=Ce(t/1024**i,{maximumFractionDigits:2});return Le(e.units.bytes[$A[i]],{fileSize:r})}(this.messagesUnits,o))),g=Iy("fieldset",{key:"content-type",class:gC},Iy("label",null,n)),m=Iy("form",{bind:this,afterCreate:uu,afterRemoved:cu,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Iy("div",{class:yC},y,g),f,Iy("div",{class:WP},c,p,u));return Iy("div",{key:"edit-form-container",class:cC},Iy("a",{class:oC,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),Iy("div",{class:aC},Iy("span",{class:lC},Iy("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Iy("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Iy("path",{fill:"none",d:"M0 0h32v32H0z"}))))),m)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},h=-1===n.indexOf("?")?"?":"&",c=o?`${n}${h}w=${t}`:function(e){const t=gr("esri/themes/base/images/files/");return e?"text/plain"===e?`${t}text-32.svg`:"application/pdf"===e?`${t}pdf-32.svg`:"text/csv"===e?`${t}csv-32.svg`:"application/gpx+xml"===e?`${t}gpx-32.svg`:"application/x-dwf"===e?`${t}cad-32.svg`:"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?`${t}code-32.svg`:"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?`${t}zip-32.svg`:-1!==e.indexOf("image/")?`${t}image-32.svg`:-1!==e.indexOf("audio/")?`${t}sound-32.svg`:-1!==e.indexOf("video/")?`${t}video-32.svg`:-1!==e.indexOf("msexcel")||-1!==e.indexOf("ms-excel")||-1!==e.indexOf("spreadsheetml")?`${t}excel-32.svg`:-1!==e.indexOf("msword")||-1!==e.indexOf("ms-word")||-1!==e.indexOf("wordprocessingml")?`${t}word-32.svg`:-1!==e.indexOf("powerpoint")||-1!==e.indexOf("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}(r),u={[eC]:!o},p={[iC]:i};return Iy("div",{class:this.classes(u,QP)},Iy("img",{styles:l,alt:s,src:c,class:this.classes(p,tC)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:"list"===t?48:400}),a=r.editing?Iy("span",{"aria-hidden":"true",class:this.classes(nC,hu()?AC:EC)}):null,l=[o,Iy("label",{class:rC},Iy("span",{class:sC},s||this.messages.noTitle),a)],h=r.editing?Iy("button",{key:"details-button",bind:this,class:ZP,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):Iy("a",{key:"details-link",class:ZP,href:n,target:"_blank"},l);return Iy("li",{class:YP,key:e},h)}renderAttachmentContainer(){const{displayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[qP]:"preview"!==e,[HP]:"preview"===e},a=s.editing&&s.operations.add&&i.addButton?Iy("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(bC,xC,JP),type:"button"},Iy("span",{"aria-hidden":"true",class:this.classes(hC,PC)}),this.messages.add):null,l=n?Iy("ul",{class:KP},r.toArray().map((t=>this.renderAttachmentInfo({attachmentInfo:t,displayType:e})))):Iy("div",{class:IC},this.messages.noAttachments);return Iy("div",{key:"attachments-container",class:this.classes(BP,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};Q([eh("viewModel.abilities")],OC.prototype,"abilities",void 0),Q([ro()],OC.prototype,"displayType",void 0),Q([eh("viewModel.graphic")],OC.prototype,"graphic",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],OC.prototype,"label",void 0),Q([ro(),Sy("esri/widgets/Attachments/t9n/Attachments")],OC.prototype,"messages",void 0),Q([ro(),Sy("esri/core/t9n/Units")],OC.prototype,"messagesUnits",void 0),Q([ro({readOnly:!0})],OC.prototype,"selectedFile",void 0),Q([ro({readOnly:!0})],OC.prototype,"submitting",void 0),Q([ro({readOnly:!0})],OC.prototype,"error",void 0),Q([ro({type:NP})],OC.prototype,"viewModel",void 0),Q([ro()],OC.prototype,"visibleElements",void 0),Q([Ra("visibleElements")],OC.prototype,"castVisibleElements",null),OC=Q([Ro("esri.widgets.Attachments")],OC);var kC=OC;let LC=class extends NP{constructor(e){super(e),this.description=null,this.title=null}};Q([ro()],LC.prototype,"description",void 0),Q([ro()],LC.prototype,"title",void 0),LC=Q([Ro("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],LC);var RC=LC;const DC="esri-widget__heading";function FC(e,t){const i=`h${mv(Math.ceil(e.level),1,6)}`;return delete e.level,Iy(i,l(a({},e),{class:lu(DC,e.class)}),t)}const jC="esri-feature-element-info",NC="esri-feature-element-info__title",zC="esri-feature-element-info__description";let VC=class extends xy{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return Iy("div",{class:jC},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?Iy(FC,{level:this.headingLevel,class:NC},e):null}renderDescription(){const{description:e}=this;return e?Iy("div",{key:"description",class:zC},e):null}};Q([ro()],VC.prototype,"description",void 0),Q([ro()],VC.prototype,"headingLevel",void 0),Q([ro()],VC.prototype,"title",void 0),VC=Q([Ro("esri.widgets.Feature.support.FeatureElementInfo")],VC);var UC=VC;const GC="esri-feature-attachments";let BC=class extends xy{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new kC,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new RC}initialize(){this._featureElementInfo=new UC,Rh(this,["viewModel.description","viewModel.title","headingLevel"],(()=>this._setupFeatureElementInfo())),Rh(this,"viewModel.graphic",(e=>this.attachmentsWidget.graphic=e))}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var e;const{attachmentsWidget:t}=this;return Iy("div",{class:GC},null==(e=this._featureElementInfo)?void 0:e.render(),null==t?void 0:t.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};Q([ro({readOnly:!0})],BC.prototype,"attachmentsWidget",void 0),Q([eh("viewModel.description")],BC.prototype,"description",void 0),Q([eh("attachmentsWidget.displayType")],BC.prototype,"displayType",void 0),Q([eh("viewModel.graphic")],BC.prototype,"graphic",void 0),Q([ro()],BC.prototype,"headingLevel",void 0),Q([eh("viewModel.title")],BC.prototype,"title",void 0),Q([ro({type:RC})],BC.prototype,"viewModel",void 0),BC=Q([Ro("esri.widgets.Feature.FeatureAttachments")],BC);var qC=BC;let HC=class extends($v(jo)){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(Rh(this,"creator",(e=>{this._destroyContent(),this._createContent(e)})))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(dP(i,{graphic:t}).catch((()=>null)),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=dP(e,{graphic:t}).catch((()=>null));this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};Q([ro({readOnly:!0})],HC.prototype,"created",void 0),Q([ro()],HC.prototype,"creator",void 0),Q([ro()],HC.prototype,"destroyer",void 0),Q([ro({type:fE})],HC.prototype,"graphic",void 0),Q([ro({readOnly:!0})],HC.prototype,"state",null),HC=Q([Ro("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],HC);var WC=HC;const $C="esri-feature-content",JC="esri-feature-content__loader-container",XC="esri-feature-content__loader";let KC=class extends xy{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll("a")).forEach((e=>{fP(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))}}renderLoading(){return Iy("div",{class:JC,key:"loader"},Iy("div",{class:XC}))}renderCreated(){var e;const t=null==(e=this.viewModel)?void 0:e.created;return t?t instanceof HTMLElement?Iy("div",{key:t,bind:t,afterCreate:this._attachToNode}):zy(t)?Iy("div",{key:t},!t.destroyed&&t.render()):Iy("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}render(){var e;const t=null==(e=this.viewModel)?void 0:e.state;return Iy("div",{class:$C},"loading"===t?this.renderLoading():this.renderCreated())}_attachToNode(e){e.appendChild(this)}};Q([eh("viewModel.creator")],KC.prototype,"creator",void 0),Q([eh("viewModel.graphic")],KC.prototype,"graphic",void 0),Q([ro({type:WC})],KC.prototype,"viewModel",void 0),KC=Q([Ro("esri.widgets.Feature.FeatureContent")],KC);var YC=KC;let ZC=class extends jo{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return null==t||t.forEach((t=>{if(t.hasOwnProperty("visible")&&!t.visible)return;const r=t.clone();r.label=gP(r,e),i.push(r)})),i}};Q([ro()],ZC.prototype,"attributes",void 0),Q([ro({type:[Yx]})],ZC.prototype,"expressionInfos",void 0),Q([ro()],ZC.prototype,"description",void 0),Q([ro({type:[lx]})],ZC.prototype,"fieldInfos",void 0),Q([ro({readOnly:!0})],ZC.prototype,"formattedFieldInfos",null),Q([ro()],ZC.prototype,"title",void 0),ZC=Q([Ro("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],ZC);var QC=ZC;const eO=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function tO(e,t){if("string"!=typeof t||!t)return t;const i=function(e){let t=null;return eO.some((i=>(i.pattern.test(e)&&(t=i),!!t))),t}(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=Le(Le(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a="_blank"===i.target?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const iO="esri-feature-fields",rO="esri-feature-fields__field-header",sO="esri-feature-fields__field-data",nO="esri-feature-fields__field-data--date",oO="esri-widget__table";let aO=class extends xy{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new QC,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new UC,Rh(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo()))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?null==i[r]?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a="number"!=typeof n||o?tO(this.messagesURIUtils,n):this._forceLTR(n),l={[nO]:o};return Iy("tr",{key:`fields-element-info-row-${r}-${t}`},Iy("th",{key:`fields-element-info-row-header-${r}-${t}`,class:rO,innerHTML:s}),Iy("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(sO,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e.length?Iy("table",{class:oO,summary:this.messages.fieldsSummary},Iy("tbody",null,e.map(((e,t)=>this.renderFieldInfo(e,t))))):null}render(){var e;return Iy("div",{class:iO},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};Q([eh("viewModel.attributes")],aO.prototype,"attributes",void 0),Q([eh("viewModel.description")],aO.prototype,"description",void 0),Q([eh("viewModel.expressionInfos")],aO.prototype,"expressionInfos",void 0),Q([eh("viewModel.fieldInfos")],aO.prototype,"fieldInfos",void 0),Q([eh("viewModel.title")],aO.prototype,"title",void 0),Q([ro({type:QC})],aO.prototype,"viewModel",void 0),Q([ro(),Sy("esri/widgets/Feature/t9n/Feature")],aO.prototype,"messages",void 0),Q([ro(),Sy("esri/widgets/support/t9n/uriUtils")],aO.prototype,"messagesURIUtils",void 0),aO=Q([Ro("esri.widgets.Feature.FeatureFields")],aO);var lO=aO;const hO={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},cO={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function uO(e,t,i){const r=new Date(e.getTime());if(t&&i){const e=cO[i],{getter:s,setter:n,multiplier:o}=e;r[n](r[s]()+t*o)}return r}function pO(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}var dO;let fO=dO=class extends Ko{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return yO}static get empty(){return gO}readEnd(e,t){return null!=t.end?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(dO.allTime)}get isEmpty(){return this.equals(dO.empty)}readStart(e,t){return null!=t.start?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new dO({end:this.end,start:this.start})}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=k(this.start,(t=>pO(t,e))),i=k(this.end,(t=>uO(pO(t,e),1,e)));return new dO({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return dO.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=O(this.start,-1/0,(e=>e.getTime())),i=O(this.end,1/0,(e=>e.getTime())),r=O(e.start,-1/0,(e=>e.getTime())),s=O(e.end,1/0,(e=>e.getTime()));let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const e=new dO;return e.start=n===-1/0?null:new Date(n),e.end=o===1/0?null:new Date(o),e}return dO.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new dO,{start:r,end:s}=this;return m(r)&&(i.start=uO(r,e,t)),m(s)&&(i.end=uO(s,e,t)),i}equals(e){if(!e)return!1;const t=m(this.start)?this.start.getTime():this.start,i=m(this.end)?this.end.getTime():this.end,r=m(e.start)?e.start.getTime():e.start,s=m(e.end)?e.end.getTime():e.end;return t===r&&i===s}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return yO.clone();const t=m(this.start)&&m(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=m(this.end)&&m(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new dO({start:t,end:i})}};Q([ro({type:Date,json:{write:{allowNull:!0}}})],fO.prototype,"end",void 0),Q([sa("end")],fO.prototype,"readEnd",null),Q([na("end")],fO.prototype,"writeEnd",null),Q([ro({readOnly:!0,json:{read:!1}})],fO.prototype,"isAllTime",null),Q([ro({readOnly:!0,json:{read:!1}})],fO.prototype,"isEmpty",null),Q([ro({type:Date,json:{write:{allowNull:!0}}})],fO.prototype,"start",void 0),Q([sa("start")],fO.prototype,"readStart",null),Q([na("start")],fO.prototype,"writeStart",null),fO=dO=Q([Ro("esri.TimeExtent")],fO);const yO=new fO,gO=new fO({start:void 0,end:void 0});var mO=fO;const vO=new ee({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var bO;const wO=new ee({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let _O=bO=class extends Ko{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch(ehe){}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch(ehe){}return i?wO.fromJSON(i.fieldValueType):null}clone(){return new bO({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};Q([ro({type:String,json:{write:!0}})],_O.prototype,"alias",void 0),Q([ro({type:[String,Number],json:{write:{allowNull:!0}}})],_O.prototype,"defaultValue",void 0),Q([ro()],_O.prototype,"description",void 0),Q([sa("description")],_O.prototype,"readDescription",null),Q([ro({types:Qw,json:{read:{reader:e_},write:!0}})],_O.prototype,"domain",void 0),Q([ro({type:Boolean,json:{write:!0}})],_O.prototype,"editable",void 0),Q([ro({type:Yn,json:{write:!0}})],_O.prototype,"length",void 0),Q([ro({type:String,json:{write:!0}})],_O.prototype,"name",void 0),Q([ro({type:Boolean,json:{write:!0}})],_O.prototype,"nullable",void 0),Q([th(vO)],_O.prototype,"type",void 0),Q([ro()],_O.prototype,"valueType",void 0),Q([sa("valueType",["description"])],_O.prototype,"readValueType",null),_O=bO=Q([Ro("esri.layers.support.Field")],_O);var xO,SO=_O;let MO=xO=class extends Ko{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new xO({mapLayerId:e,gdbVersion:t})}};var TO;Q([th({mapLayer:"map-layer"})],MO.prototype,"type",void 0),Q([ro({type:Yn,json:{write:!0}})],MO.prototype,"mapLayerId",void 0),Q([ro({type:String,json:{write:!0}})],MO.prototype,"gdbVersion",void 0),MO=xO=Q([Ro("esri.layers.support.source.MapLayerSource")],MO);let IO=TO=class extends Ko{constructor(e){super(e),this.type="query-table"}clone(){var e;const{workspaceId:t,query:i,oidFields:r,spatialReference:s,geometryType:n}=this,o={workspaceId:t,query:i,oidFields:r,spatialReference:null!=(e=null==s?void 0:s.clone())?e:void 0,geometryType:n};return new TO(o)}};var EO;Q([th({queryTable:"query-table"})],IO.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],IO.prototype,"workspaceId",void 0),Q([ro({type:String,json:{write:!0}})],IO.prototype,"query",void 0),Q([ro({type:String,json:{write:!0}})],IO.prototype,"oidFields",void 0),Q([ro({type:Aa,json:{write:!0}})],IO.prototype,"spatialReference",void 0),Q([th(ow)],IO.prototype,"geometryType",void 0),IO=TO=Q([Ro("esri.layers.support.source.QueryTableDataSource")],IO);let AO=EO=class extends Ko{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new EO({workspaceId:e,dataSourceName:t})}};var PO;Q([th({raster:"raster"})],AO.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],AO.prototype,"dataSourceName",void 0),Q([ro({type:String,json:{write:!0}})],AO.prototype,"workspaceId",void 0),AO=EO=Q([Ro("esri.layers.support.source.RasterDataSource")],AO);let CO=PO=class extends Ko{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new PO({workspaceId:e,gdbVersion:t,dataSourceName:i})}};var OO,kO;Q([th({table:"table"})],CO.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],CO.prototype,"workspaceId",void 0),Q([ro({type:String,json:{write:!0}})],CO.prototype,"gdbVersion",void 0),Q([ro({type:String,json:{write:!0}})],CO.prototype,"dataSourceName",void 0),CO=PO=Q([Ro("esri.layers.support.source.TableDataSource")],CO);const LO=te()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let RO=OO=class extends Ko{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return FO()(e,t,i)}castLeftTableSource(e){return Kn(NO(),e)}readRightTableSource(e,t,i){return FO()(e,t,i)}castRightTableSource(e){return Kn(NO(),e)}clone(){var e,t;const{leftTableKey:i,rightTableKey:r,leftTableSource:s,rightTableSource:n,joinType:o}=this,a={leftTableKey:i,rightTableKey:r,leftTableSource:null!=(e=null==s?void 0:s.clone())?e:void 0,rightTableSource:null!=(t=null==n?void 0:n.clone())?t:void 0,joinType:o};return new OO(a)}};Q([th({joinTable:"join-table"})],RO.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],RO.prototype,"leftTableKey",void 0),Q([ro({type:String,json:{write:!0}})],RO.prototype,"rightTableKey",void 0),Q([ro({json:{write:!0}})],RO.prototype,"leftTableSource",void 0),Q([sa("leftTableSource")],RO.prototype,"readLeftTableSource",null),Q([Ra("leftTableSource")],RO.prototype,"castLeftTableSource",null),Q([ro({json:{write:!0}})],RO.prototype,"rightTableSource",void 0),Q([sa("rightTableSource")],RO.prototype,"readRightTableSource",null),Q([Ra("rightTableSource")],RO.prototype,"castRightTableSource",null),Q([th(LO)],RO.prototype,"joinType",void 0),RO=OO=Q([Ro("esri.layers.support.source.JoinTableDataSource")],RO);let DO=null;function FO(){return DO||(DO=co({types:NO()})),DO}let jO=null;function NO(){return jO||(jO={key:"type",base:null,typeMap:{"data-layer":VO,"map-layer":MO}}),jO}const zO={key:"type",base:null,typeMap:{"join-table":RO,"query-table":IO,raster:AO,table:CO}};let VO=kO=class extends Ko{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new kO({fields:e,dataSource:t})}};var UO;Q([th({dataLayer:"data-layer"})],VO.prototype,"type",void 0),Q([ro({type:[SO],json:{write:!0}})],VO.prototype,"fields",void 0),Q([ro({types:zO,json:{write:!0}})],VO.prototype,"dataSource",void 0),VO=kO=Q([Ro("esri.layers.support.source.DataLayerSource")],VO),VO.from=qn(VO);const GO=new ee({upperLeft:"upper-left",lowerLeft:"lower-left"});let BO=UO=class extends Ko{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new UO(H({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};Q([ro({type:Ol,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],BO.prototype,"extent",void 0),Q([ro({type:["view","edit"],json:{write:!0}})],BO.prototype,"mode",void 0),Q([ro({type:String,json:{read:GO.read,write:GO.write}})],BO.prototype,"originPosition",void 0),Q([ro({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],BO.prototype,"tolerance",void 0),BO=UO=Q([Ro("esri.rest.support.QuantizationParameters")],BO);var qO,HO=BO;const WO=new ee({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete"});let $O=qO=class extends Ko{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(t.statisticParameters=H(e))}clone(){return new qO({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:H(this.statisticParameters)})}};Q([ro({type:Number,json:{write:!0}})],$O.prototype,"maxPointCount",void 0),Q([ro({type:Number,json:{write:!0}})],$O.prototype,"maxRecordCount",void 0),Q([ro({type:Number,json:{write:!0}})],$O.prototype,"maxVertexCount",void 0),Q([ro({type:String,json:{write:!0}})],$O.prototype,"onStatisticField",void 0),Q([ro({type:String,json:{write:!0}})],$O.prototype,"outStatisticFieldName",void 0),Q([ro({type:String,json:{read:{source:"statisticType",reader:WO.read},write:{target:"statisticType",writer:WO.write}}})],$O.prototype,"statisticType",void 0),Q([ro({type:Object})],$O.prototype,"statisticParameters",void 0),Q([na("statisticParameters")],$O.prototype,"writeStatisticParameters",null),$O=qO=Q([Ro("esri.rest.support.StatisticDefinition")],$O);var JO,XO=$O;const KO=new ee({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),YO=new ee({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ZO=JO=class extends Ko{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.datumTransformation=null,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.units=null,this.where=null}static from(e){return Un(JO,e)}castDatumTransformation(e){return"number"==typeof e||"object"==typeof e?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const t in e){const r=e[t];Array.isArray(r)?i[t]=r.map((e=>e instanceof Date?e.getTime():e)):r instanceof Date?i[t]=r.getTime():i[t]=r}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new JO(H({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,datumTransformation:this.datumTransformation,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:m(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,units:this.units,where:this.where}))}};ZO.MAX_MAX_RECORD_COUNT_FACTOR=5,Q([ro({json:{write:!0}})],ZO.prototype,"aggregateIds",void 0),Q([ro({type:Boolean,json:{write:!0}})],ZO.prototype,"cacheHint",void 0),Q([ro({json:{write:!0}})],ZO.prototype,"datumTransformation",void 0),Q([Ra("datumTransformation")],ZO.prototype,"castDatumTransformation",null),Q([ro({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],ZO.prototype,"distance",void 0),Q([ro({type:VO,json:{write:!0}})],ZO.prototype,"dynamicDataSource",void 0),Q([ro({type:String,json:{write:!0}})],ZO.prototype,"formatOf3DObjects",void 0),Q([ro({type:String,json:{write:!0}})],ZO.prototype,"gdbVersion",void 0),Q([ro({types:mw,json:{read:dw,write:!0}})],ZO.prototype,"geometry",void 0),Q([ro({type:Number,json:{write:!0}})],ZO.prototype,"geometryPrecision",void 0),Q([ro({type:[String],json:{write:!0}})],ZO.prototype,"groupByFieldsForStatistics",void 0),Q([ro({type:String,json:{write:!0}})],ZO.prototype,"having",void 0),Q([ro({type:Date})],ZO.prototype,"historicMoment",void 0),Q([na("historicMoment")],ZO.prototype,"writeHistoricMoment",null),Q([ro({type:Number,json:{write:!0}})],ZO.prototype,"maxAllowableOffset",void 0),Q([ro({type:Number,cast:e=>e<1?1:e>JO.MAX_MAX_RECORD_COUNT_FACTOR?JO.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],ZO.prototype,"maxRecordCountFactor",void 0),Q([ro({type:["xyFootprint"],json:{write:!0}})],ZO.prototype,"multipatchOption",void 0),Q([ro({type:Number,json:{read:{source:"resultRecordCount"}}})],ZO.prototype,"num",void 0),Q([ro({json:{write:!0}})],ZO.prototype,"objectIds",void 0),Q([ro({type:[String],json:{write:!0}})],ZO.prototype,"orderByFields",void 0),Q([ro({type:[String],json:{write:!0}})],ZO.prototype,"outFields",void 0),Q([ro({type:Aa,json:{name:"outSR",write:!0}})],ZO.prototype,"outSpatialReference",void 0),Q([ro({type:[XO],json:{write:{enabled:!0,overridePolicy(){return{enabled:m(this.outStatistics)&&this.outStatistics.length>0}}}}})],ZO.prototype,"outStatistics",void 0),Q([ro({json:{write:!0}})],ZO.prototype,"parameterValues",void 0),Q([na("parameterValues")],ZO.prototype,"writeParameterValues",null),Q([ro({type:il,json:{write:!0}})],ZO.prototype,"pixelSize",void 0),Q([ro({type:HO,json:{write:!0}})],ZO.prototype,"quantizationParameters",void 0),Q([ro({type:[Object],json:{write:!0}})],ZO.prototype,"rangeValues",void 0),Q([ro({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],ZO.prototype,"relationParameter",void 0),Q([ro({type:String,json:{write:!0}})],ZO.prototype,"resultType",void 0),Q([ro({type:Boolean,json:{default:!1,write:!0}})],ZO.prototype,"returnCentroid",void 0),Q([ro({type:Boolean,json:{default:!1,write:!0}})],ZO.prototype,"returnDistinctValues",void 0),Q([ro({type:Boolean,json:{default:!0,write:!0}})],ZO.prototype,"returnExceededLimitFeatures",void 0),Q([ro({type:Boolean,json:{write:!0}})],ZO.prototype,"returnGeometry",void 0),Q([ro({type:Boolean,json:{default:!1,write:!0}})],ZO.prototype,"returnQueryGeometry",void 0),Q([ro({type:Boolean,json:{default:!1,write:!0}})],ZO.prototype,"returnM",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ZO.prototype,"returnZ",void 0),Q([ro({type:Aa,json:{write:!0}})],ZO.prototype,"sourceSpatialReference",void 0),Q([th(KO,{ignoreUnknown:!1,name:"spatialRel"})],ZO.prototype,"spatialRelationship",void 0),Q([ro({type:Number,json:{read:{source:"resultOffset"}}})],ZO.prototype,"start",void 0),Q([na("start"),na("num")],ZO.prototype,"writeStart",null),Q([ro({type:String,json:{write:!0}})],ZO.prototype,"sqlFormat",void 0),Q([ro({type:String,json:{write:!0}})],ZO.prototype,"text",void 0),Q([ro({type:mO,json:{write:!0}})],ZO.prototype,"timeExtent",void 0),Q([th(YO,{ignoreUnknown:!1}),ro({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],ZO.prototype,"units",void 0),Q([ro({type:String,json:{write:{overridePolicy(e){return{enabled:null!=e||this.start>0}}}}})],ZO.prototype,"where",void 0),Q([na("where")],ZO.prototype,"writeWhere",null),ZO=JO=Q([Ro("esri.rest.support.Query")],ZO);var QO,ek=ZO;let tk=QO=class extends Ko{constructor(e){super(e),this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}clone(){return new QO(H({dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};Q([ro({type:VO,json:{write:!0}})],tk.prototype,"dynamicDataSource",void 0),Q([ro({type:String,json:{write:!0}})],tk.prototype,"gdbVersion",void 0),Q([ro({type:Number,json:{write:!0}})],tk.prototype,"geometryPrecision",void 0),Q([ro({type:Date})],tk.prototype,"historicMoment",void 0),Q([na("historicMoment")],tk.prototype,"_writeHistoricMoment",null),Q([ro({type:Number,json:{write:!0}})],tk.prototype,"maxAllowableOffset",void 0),Q([ro({type:[Number],json:{write:!0}})],tk.prototype,"objectIds",void 0),Q([ro({type:[String],json:{write:!0}})],tk.prototype,"orderByFields",void 0),Q([ro({type:[String],json:{write:!0}})],tk.prototype,"outFields",void 0),Q([ro({type:Aa,json:{read:{source:"outSR"},write:{target:"outSR"}}})],tk.prototype,"outSpatialReference",void 0),Q([ro({json:{write:!0}})],tk.prototype,"relationshipId",void 0),Q([ro({type:Number,json:{read:{source:"resultOffset"}}})],tk.prototype,"start",void 0),Q([na("start"),na("num")],tk.prototype,"writeStart",null),Q([ro({type:Number,json:{read:{source:"resultRecordCount"}}})],tk.prototype,"num",void 0),Q([ro({json:{write:!0}})],tk.prototype,"returnGeometry",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],tk.prototype,"returnM",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],tk.prototype,"returnZ",void 0),Q([ro({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],tk.prototype,"where",void 0),tk=QO=Q([Ro("esri.rest.support.RelationshipQuery")],tk),tk.from=qn(tk);var ik=tk;function rk(e,t){return t?l(a({},t),{query:a(a({},e),t.query)}):{query:e}}function sk(e){return"string"==typeof e?$t(e):e}function nk(e,t,i){const r={};for(const s in e){if("declaredClass"===s)continue;const n=e[s];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[s]=[];for(let e=0;e<n.length;e++)r[s][e]=nk(n[e])}else if("object"==typeof n)if(n.toJSON){const e=n.toJSON(i&&i[s]);r[s]=t?e:JSON.stringify(e)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}function ok(e){const t={};for(const i in e){if("declaredClass"===i)continue;const r=e[i];if(null!=r&&"function"!=typeof r)if(Array.isArray(r)){t[i]=[];for(let e=0;e<r.length;e++)t[i][e]=ok(r[e])}else"object"==typeof r?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}function ak(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function lk(e,t){const i={};for(const r of e){const{parentObjectId:e,parentGlobalId:s,attachmentInfos:n}=r;for(const r of n){const{id:n}=r,o=Yt(Gi(`${t}/${e}/attachments/${n}`)),a=ZA.fromJSON(r);a.set({url:o,parentObjectId:e,parentGlobalId:s}),i[e]?i[e].push(a):i[e]=[a]}}return i}async function hk(e,t,i){const r=sk(e);return function(e,t,i){let r={query:ok(a(l(a({},e.query),{f:"json"}),ak(t)))};return i&&(r=l(a(a({},i),r),{query:a(a({},i.query),r.query)})),$i(e.path+"/queryAttachments",r)}(r,eP.from(t),a({},i)).then((e=>lk(e.data.attachmentGroups,r.path)))}const ck={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new nw({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:Aa.WebMercator}),minus180Line:new nw({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:Aa.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new nw({paths:[[[180,-180],[180,180]]],spatialReference:Aa.WGS84}),minus180Line:new nw({paths:[[[-180,-180],[-180,180]]],spatialReference:Aa.WGS84})}};function uk(e,t){return Math.ceil((e-t)/(2*t))}function pk(e,t){const i=dk(e);for(const r of i)for(const e of r)e[0]+=t;return e}function dk(e){return pw(e)?e.rings:e.paths}function fk(e){const t=(null==e?void 0:e.isWebMercator)?102100:4326;return[ck[t].minX,ck[t].maxX]}async function yk(e,t,i){const r="string"==typeof e?$t(e):e,s=t[0].spatialReference,n=fw(t[0]),o=l(a({},i),{query:l(a({},r.query),{f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify((h=t,{geometryType:fw(h[0]),geometries:h.map((e=>e.toJSON()))}))})});var h;return function(e,t,i){const r=gw(t);return e.map((e=>{const t=r.fromJSON(e);return t.spatialReference=i,t}))}((await $i(r.path+"/simplify",o)).data,n,s)}const gk=Ne.getLogger("esri.geometry.support.normalizeUtils");function mk(e){return"polygon"===e[0].type}function vk(e){return"polyline"===e[0].type}function bk(e,t){if(!(e instanceof nw||e instanceof rw)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw gk.error(e),new Be(e)}const i=dk(e),r=[];for(const s of i){const e=[];r.push(e),e.push([s[0][0],s[0][1]]);for(let i=0;i<s.length-1;i++){const r=s[i][0],n=s[i][1],o=s[i+1][0],a=s[i+1][1],l=Math.sqrt((o-r)*(o-r)+(a-n)*(a-n)),h=(a-n)/l,c=(o-r)/l,u=l/t;if(u>1){for(let a=1;a<=u-1;a++){const i=a*t,s=c*i+r,o=h*i+n;e.push([s,o])}const i=(l+Math.floor(u-1)*t)/2,s=c*i+r,o=h*i+n;e.push([s,o])}e.push([o,a])}}return function(e){return"polygon"===e.type}(e)?new rw({rings:r,spatialReference:e.spatialReference}):new nw({paths:r,spatialReference:e.spatialReference})}function wk(e,t,i){if(t){e=Ka(bk(e,1e6),!0)}return i&&(e=pk(e,i)),e}function _k(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const i=uk(r,t);e[0]=r+i*(-2*t)}else if(r<i){const t=uk(r,i);e[0]=r+t*(-2*i)}}else{const r=e.x;if(r>t){const i=uk(r,t);e=e.clone().offset(i*(-2*t),0)}else if(r<i){const t=uk(r,i);e=e.clone().offset(t*(-2*i),0)}}return e}async function xk(e,t,i){if(!Array.isArray(e))return xk([e],t);const r=t?t.url:Z.geometryServiceUrl;let s,n,o,h,c,u,p,d,f=0;const y=[],g=[];for(const a of e)if(v(a))g.push(a);else if(s||(s=a.spatialReference,n=ya(s),o=s.isWebMercator,u=o?102100:4326,h=ck[u].maxX,c=ck[u].minX,p=ck[u].plus180Line,d=ck[u].minus180Line),n)if("mesh"===a.type)g.push(a);else if("point"===a.type)g.push(_k(a.clone(),h,c));else if("multipoint"===a.type){const e=a.clone();e.points=e.points.map((e=>_k(e,h,c))),g.push(e)}else if("extent"===a.type){const e=a.clone()._normalize(!1,!1,n);g.push(e.rings?new rw(e):e)}else if(a.extent){const e=a.extent,t=uk(e.xmin,c)*(2*h);let i=0===t?a.clone():pk(a.clone(),t);e.offset(t,0),e.intersects(p)&&e.xmax!==h?(f=e.xmax>f?e.xmax:f,i=wk(i,o),y.push(i),g.push("cut")):e.intersects(d)&&e.xmin!==c?(f=e.xmax*(2*h)>f?e.xmax*(2*h):f,i=wk(i,o,360),y.push(i),g.push("cut")):g.push(i)}else g.push(a.clone());else g.push(a);let b=uk(f,h),w=-90;const _=b,x=new nw;for(;b>0;){const e=360*b-180;x.addPath([[e,w],[e,-1*w]]),w*=-1,b--}if(y.length>0&&_>0){const t=function(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=dk(n);for(let e=0;e<o.length;e++){const t=o[e];t.some((i=>{if(i[0]<180)return!0;{let i=0;for(let e=0;e<t.length;e++){const r=t[e][0];i=r>i?r:i}i=Number(i.toFixed(9));const r=-360*uk(i,180);for(let s=0;s<t.length;s++){const t=n.getPoint(e,s);n.setPoint(e,s,t.clone().offset(r,0))}return!0}}))}if(s===i){if(mk(e))for(const t of dk(n))e[s]=e[s].addRing(t);else if(vk(e))for(const t of dk(n))e[s]=e[s].addPath(t)}else i=s,e[s]=n}return e}(y,await async function(e,t,i,r){const s="string"==typeof e?$t(e):e,n=t[0].spatialReference,o=l(a({},r),{query:l(a({},s.query),{f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:fw(t[0]),geometries:t}),cutter:JSON.stringify(i)})}),h=await $i(s.path+"/cut",o),{cutIndexes:c,geometries:u=[]}=h.data;return{cutIndexes:c,geometries:u.map((e=>{const t=dw(e);return t.spatialReference=n,t}))}}(r,y,x,i)),s=[],n=[];for(let i=0;i<g.length;i++){const r=g[i];if("cut"!==r)n.push(r);else{const r=t.shift(),a=e[i];m(a)&&"polygon"===a.type&&a.rings&&a.rings.length>1&&r.rings.length>=a.rings.length?(s.push(r),n.push("simplify")):n.push(o?Xa(r):r)}}if(!s.length)return n;const h=await yk(r,s,i),c=[];for(let e=0;e<n.length;e++){const t=n[e];"simplify"!==t?c.push(t):c.push(o?Xa(h.shift()):h.shift())}return c}const S=[];for(let a=0;a<g.length;a++){const e=g[a];if("cut"!==e)S.push(e);else{const e=y.shift();S.push(!0===o?Xa(e):e)}}return Promise.resolve(S)}function Sk(e,t){const i=ya(t);if(i){const[t,r]=i.valid,s=r-t;if(e<t)for(;e<t;)e+=s;if(e>r)for(;e>r;)e-=s}return e}const Mk=y("esri-text-decoder")?new TextDecoder("utf-8"):null,Tk=y("safari")||y("ios")?6:y("ff")?12:32;class Ik{constructor(e,t,i=0,r=(e?e.byteLength:0)){this._tag=0,this._dataType=99,this.init(e,t,i,r)}init(e,t,i,r){this._data=e,this._dataView=t,this._pos=i,this._end=r}clone(){return new Ik(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(e){this._pos=e}nextTag(e){for(;;){if(this._pos===this._end)return!1;const t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const e=this.getUInt32();return e>>>1^-(1&e)|0}getSInt64(){return this._decodeSVarint()}getBool(){const e=0!==this._data[this._pos];return this._skip(1),e}getEnum(){return this._decodeVarint()}getFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),i}getSFixed64(){const e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),i}getDouble(){const e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}getFixed32(){const e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}getSFixed32(){const e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}getFloat(){const e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}getString(){const e=this._getLength(),t=this._pos,i=this._toString(this._data,t,t+e);return this._skip(e),i}getBytes(){const e=this._getLength(),t=this._pos,i=this._toBytes(this._data,t,t+e);return this._skip(e),i}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(e,t,i,r){const s=this.getMessage(),n=e(s,t,i,r);return s.release(),n}processMessage(e){const t=this.getMessage(),i=e(t);return t.release(),i}getMessage(){const e=this._getLength(),t=Ik.pool.acquire();return t.init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),t}release(){Ik.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(e){this._skip(e)}_skip(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}_decodeVarint(){const e=this._data;let t,i=this._pos,r=0;if(this._end-i>=10)do{if(t=e[i++],r|=127&t,0==(128&t))break;if(t=e[i++],r|=(127&t)<<7,0==(128&t))break;if(t=e[i++],r|=(127&t)<<14,0==(128&t))break;if(t=e[i++],r|=(127&t)<<21,0==(128&t))break;if(t=e[i++],r+=268435456*(127&t),0==(128&t))break;if(t=e[i++],r+=34359738368*(127&t),0==(128&t))break;if(t=e[i++],r+=4398046511104*(127&t),0==(128&t))break;if(t=e[i++],r+=562949953421312*(127&t),0==(128&t))break;if(t=e[i++],r+=72057594037927940*(127&t),0==(128&t))break;if(t=e[i++],r+=0x8000000000000000*(127&t),0==(128&t))break;throw new Error("Varint too long!")}while(0);else{let s=1;for(;i!==this._end&&(t=e[i],0!=(128&t));)++i,r+=(127&t)*s,s*=128;if(i===this._end)throw new Error("Varint overrun!");++i,r+=t*s}return this._pos=i,r}_decodeSVarint(){const e=this._decodeVarint();return e%2?-(e+1)/2:e/2}_getLength(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(e,t,i){if((i=Math.min(this._end,i))-t>Tk&&Mk){const r=e.subarray(t,i);return Mk.decode(r)}let r="",s="";for(let n=t;n<i;++n){const t=e[n];128&t?s+="%"+t.toString(16):(r+=decodeURIComponent(s)+String.fromCharCode(t),s="")}return s.length&&(r+=decodeURIComponent(s)),r}_toBytes(e,t,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,t,i-t)}}Ik.pool=new Gr(Ik,null,(e=>{e._data=null,e._dataView=null}));class Ek{constructor(e=[],t=[],i=!1){this.lengths=null!=e?e:[],this.coords=null!=t?t:[],this.hasIndeterminateRingOrder=i}get isPoint(){return 0===this.lengths.length}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const r=this.lengths[i];for(let i=0;i<r;i++)e(this.coords[2*(i+t)],this.coords[2*(i+t)+1]);t+=r}}clone(){return new Ek(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class Ak{constructor(e=null,t={},i,r){this.displayId=0,this.geohashX=0,this.geohashY=0,this.geometry=e,t&&(this.attributes=t),i&&(this.centroid=i),null!=r&&(this.objectId=r)}get hasGeometry(){return!(!this.geometry||!this.geometry.coords||!this.geometry.coords.length)}weakClone(){const e=new Ak(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}}class Pk{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new Pk;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}const Ck=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class Ok{constructor(e){this.options=e,this.geometryTypes=Ck,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new Pk}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e||!e.features||!e.hasZ||!this.options.sourceSpatialReference||!e.spatialReference||fa(e.spatialReference,this.options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const t=zA(this.options.sourceSpatialReference)/zA(e.spatialReference);if(1!==t)for(const i of e.features){if(!i.geometry||!i.geometry.coords)continue;const e=i.geometry.coords;for(let i=2;i<e.length;i+=3)e[i]*=t}}addFeature(e,t){e.features.push(t)}createFeature(){return new Ak}createSpatialReference(){return{wkid:0}}createGeometry(){return new Ek}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce(((e,t)=>e+t),0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new Ek}}const kk=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],Lk=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],Rk=["upperLeft","lowerLeft"];function Dk(e){return e>=kk.length?null:kk[e]}function Fk(e){return e>=Lk.length?null:Lk[e]}function jk(e){return e>=Rk.length?null:Rk[e]}function Nk(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function zk(e,t,i){const r=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const i=e.getUInt32(),s=e.pos()+i;let n=0;for(;e.pos()<s;)t.addCoordinatePoint(r,e.getSInt64(),n++);break}case 1:case 2:default:e.skip()}return r}function Vk(e,t,i){const r=t.createGeometry(i),s=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const i=e.getUInt32(),s=e.pos()+i;let n=0;for(;e.pos()<s;)t.addLength(r,e.getUInt32(),n++);break}case 3:{const i=e.getUInt32(),n=e.pos()+i;let o=0;for(t.allocateCoordinates(r);e.pos()<n;)t.addCoordinate(r,e.getSInt64(),o),o++,o===s&&(o=0);break}case 1:default:e.skip()}return r}function Uk(e){const t=new Ek;let i="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const i=e.getUInt32(),r=e.pos()+i;for(;e.pos()<r;)t.lengths.push(e.getUInt32());break}case 3:{const i=e.getUInt32(),r=e.pos()+i;for(;e.pos()<r;)t.coords.push(e.getSInt64());break}case 1:i=Ck[e.getEnum()];break;default:e.skip()}return{queryGeometry:t,queryGeometryType:i}}function Gk(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function Bk(e){const t={type:Dk(0)};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=Dk(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=Fk(e.getEnum());break;case 5:e.skip();break;case 6:t.defaultValue=e.getString();break;default:e.skip()}return t}function qk(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.isSystemMaintained=e.getBool();break;default:e.skip()}return t}function Hk(e,t,i,r){const s=t.createFeature(i);let n=0;for(;e.next();)switch(e.tag()){case 1:{const t=r[n++].name;s.attributes[t]=e.processMessage(Gk);break}case 2:s.geometry=e.processMessageWithArgs(Vk,t,i);break;case 4:s.centroid=e.processMessageWithArgs(zk,t,i);break;default:e.skip()}return s}function Wk(e){const t=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function $k(e){const t=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function Jk(e){const t={originPosition:jk(0)};for(;e.next();)switch(e.tag()){case 1:t.originPosition=jk(e.getEnum());break;case 2:t.scale=e.processMessage(Wk);break;case 3:t.translate=e.processMessage($k);break;default:e.skip()}return t}function Xk(e){const t={};for(;e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function Kk(e,t){const i=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:i.wkid=e.getUInt32();break;case 5:i.wkt=e.getString();break;case 2:i.latestWkid=e.getUInt32();break;case 3:i.vcsWkid=e.getUInt32();break;case 4:i.latestVcsWkid=e.getUInt32();break;default:e.skip()}return i}function Yk(e,t){const i=t.createFeatureResult();i.geometryType=Nk(t,0);let r=!1;for(;e.next();)switch(e.tag()){case 1:i.objectIdFieldName=e.getString();break;case 3:i.globalIdFieldName=e.getString();break;case 4:i.geohashFieldName=e.getString();break;case 5:i.geometryProperties=e.processMessage(Xk);break;case 7:i.geometryType=Nk(t,e.getEnum());break;case 8:i.spatialReference=e.processMessageWithArgs(Kk,t);break;case 10:i.hasZ=e.getBool();break;case 11:i.hasM=e.getBool();break;case 12:i.transform=e.processMessage(Jk);break;case 9:{const t=e.getBool();i.exceededTransferLimit=t;break}case 13:t.addField(i,e.processMessage(Bk));break;case 15:r||(t.prepareFeatures(i),r=!0),t.addFeature(i,e.processMessageWithArgs(Hk,t,i,i.fields));break;case 2:i.uniqueIdField=e.processMessage(qk);break;case 6:default:e.skip()}return t.finishFeatureResult(i),i}function Zk(e,t){const i={};let r=null;for(;e.next();)switch(e.tag()){case 4:r=e.processMessageWithArgs(Uk);break;case 1:i.featureResult=e.processMessageWithArgs(Yk,t);break;case 2:case 3:default:e.skip()}return m(r)&&i.featureResult&&t.addQueryGeometry(i,r),i}function Qk(e,t){const i=function(e,t){try{const i=2,r=new Ik(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)switch(r.tag()){case i:s.queryResult=r.processMessageWithArgs(Zk,t);break;default:r.skip()}return s}catch(i){throw new Be("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const e=r.objectIdFieldName;for(const t of r.features)t.attributes&&(t.objectId=t.attributes[e])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function eL(e,t,i){if(v(t)||v(i)||i.vcsWkid||fa(t,i))return null;const r=zA(t)/zA(i);if(1===r)return null;switch(e){case"point":case"esriGeometryPoint":return e=>function(e,t){e&&null!=e.z&&(e.z*=t)}(e,r);case"polyline":case"esriGeometryPolyline":return e=>function(e,t){if(e)for(const i of e.paths)for(const e of i)e.length>2&&(e[2]*=t)}(e,r);case"polygon":case"esriGeometryPolygon":return e=>function(e,t){if(e)for(const i of e.rings)for(const e of i)e.length>2&&(e[2]*=t)}(e,r);case"multipoint":case"esriGeometryMultipoint":return e=>function(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}(e,r);default:return null}}function tL(e,t,i){if(null==e.hasM||e.hasZ)for(const r of t)for(const e of r)e.length>2&&(e[2]*=i)}function iL(e,t,i){if(!e&&!t||!i)return;const r=zA(i);rL(e,i,r),rL(t,i,r)}function rL(e,t,i){if(e)for(const r of e)sL(r.geometry,t,i)}function sL(e,t,i){if(!e||!e.spatialReference||fa(e.spatialReference,t))return;const r=zA(e.spatialReference)/i;if(1!==r)if("x"in e)null!=e.z&&(e.z*=r);else if("rings"in e)tL(e,e.rings,r);else if("paths"in e)tL(e,e.paths,r);else if("points"in e&&(null==e.hasM||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}function nL(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=eL(i.geometryType,t,e.outSpatialReference);if(r)for(const s of i.features)r(s.geometry)}const oL="Layer does not support extent calculation.";function aL(e,t){const i=e.geometry,r=e.toJSON(),s=r;if(m(i)&&(s.geometry=JSON.stringify(i),s.geometryType=fw(i),s.inSR=i.spatialReference.wkid||JSON.stringify(i.spatialReference)),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(null!=t&&t.returnCountOnly||null!=t&&t.returnExtentOnly||null!=t&&t.returnIdsOnly)?delete s.outFields:-1!==r.outFields.indexOf("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?s.outSR=r.outSR.wkid||JSON.stringify(r.outSR):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const e=r.timeExtent,{start:t,end:i}=e;null==t&&null==i||(s.time=t===i?t:`${null==t?"null":t},${null==i?"null":i}`),delete r.timeExtent}return s}async function lL(e,t,i,r){const s=m(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await fL(e,t,"json",r);return nL(t,i,s.data),s}async function hL(e,t,i,r){if(m(t.timeExtent)&&t.timeExtent.isEmpty)return Promise.resolve({data:i.createFeatureResult()});const s=await cL(e,t,r),n=s;return n.data=Qk(s.data,i),n}function cL(e,t,i){return fL(e,t,"pbf",i)}function uL(e,t,i){return m(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):fL(e,t,"json",i,{returnIdsOnly:!0})}function pL(e,t,i){return m(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):fL(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function dL(e,t,i){return m(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):fL(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(oL);if(t.hasOwnProperty("count"))throw new Error(oL);return e}))}function fL(e,t,i,r={},s={}){const n="string"==typeof e?$t(e):e,o=t.geometry?[t.geometry]:[];return r.responseType="pbf"===i?"array-buffer":"json",xk(o,null,r).then((e=>{const o=e&&e[0];m(o)&&((t=t.clone()).geometry=o);const h=ok(a(a(l(a({},n.query),{f:i}),s),aL(t,s)));return $i(ci(n.path,"query"),l(a({},r),{query:a(a({},h),r.query)}))}))}var yL=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",executeQuery:lL,executeQueryForCount:pL,executeQueryForExtent:dL,executeQueryForIds:uL,executeQueryPBF:hL,executeQueryPBFBuffer:cL,queryToQueryStringParameters:aL,runQuery:fL});const gL=new ee({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let mL=class extends Ko{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){const i=Aa.fromJSON(t.spatialReference),r=[];for(let s=0;s<e.length;s++){const t=e[s],n=fE.fromJSON(t),o=t.geometry&&t.geometry.spatialReference;m(n.geometry)&&!o&&(n.geometry.spatialReference=i),r.push(n)}return r}writeGeometryType(e,t,i,r){if(e)return void gL.write(e,t,i,r);const{features:s}=this;if(s)for(const n of s)if(n&&m(n.geometry))return void gL.write(n.geometry.type,t,i,r)}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=dw(e);return!i&&t.spatialReference&&(r.spatialReference=Aa.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i)for(const r of i)if(r&&m(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}toJSON(e){const t=this.write(null);if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const t=e&&e[i];r.geometry=t&&t.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=this.features,o=this._getQuantizationFunction(this.geometryType,(e=>Math.round((e-r)/t)),(e=>Math.round((s-e)/i)));for(let a=0,l=n.length;a<l;a++)o(n[a].geometry)||(n.splice(a,1),a--,l--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=this._getHydrationFunction(e,(e=>e*n+r),(e=>s-e*o));for(const{geometry:l}of t)m(l)&&a(l);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const a=e[o];if(o>0){const e=t(a[0]),o=i(a[1]);e===r&&o===s||(n.push([e-r,o-s]),r=e,s=o)}else r=t(a[0]),s=i(a[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return"point"===e?e=>(e.x=t(e.x),e.y=i(e.y),e):"polyline"===e||"polygon"===e?e=>{const r=pw(e)?e.rings:e.paths,s=[];for(let n=0,o=r.length;n<o;n++){const e=r[n],o=this._quantizePoints(e,t,i);o&&s.push(o)}return s.length>0?(pw(e)?e.rings=s:e.paths=s,e):null}:"multipoint"===e?e=>{const r=this._quantizePoints(e.points,t,i);return r.length>0?(e.points=r,e):null}:"extent"===e?e=>e:null}_getHydrationFunction(e,t,i){return"point"===e?e=>{e.x=t(e.x),e.y=i(e.y)}:"polyline"===e||"polygon"===e?e=>{const r=pw(e)?e.rings:e.paths;let s,n;for(let o=0,a=r.length;o<a;o++){const e=r[o];for(let r=0,o=e.length;r<o;r++){const o=e[r];r>0?(s+=o[0],n+=o[1]):(s=o[0],n=o[1]),o[0]=t(s),o[1]=i(n)}}}:"extent"===e?e=>{e.xmin=t(e.xmin),e.ymin=i(e.ymin),e.xmax=t(e.xmax),e.ymax=i(e.ymax)}:"multipoint"===e?e=>{const r=e.points;let s,n;for(let o=0,a=r.length;o<a;o++){const e=r[o];o>0?(s+=e[0],n+=e[1]):(s=e[0],n=e[1]),e[0]=t(s),e[1]=i(n)}}:void 0}};Q([ro({type:String,json:{write:!0}})],mL.prototype,"displayFieldName",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],mL.prototype,"exceededTransferLimit",void 0),Q([ro({type:[fE],json:{write:!0}})],mL.prototype,"features",void 0),Q([sa("features")],mL.prototype,"readFeatures",null),Q([ro({type:[SO],json:{write:!0}})],mL.prototype,"fields",void 0),Q([ro({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:gL.read}}})],mL.prototype,"geometryType",void 0),Q([na("geometryType")],mL.prototype,"writeGeometryType",null),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],mL.prototype,"hasM",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],mL.prototype,"hasZ",void 0),Q([ro({types:mw,json:{write:!0}})],mL.prototype,"queryGeometry",void 0),Q([sa("queryGeometry")],mL.prototype,"readQueryGeometry",null),Q([ro({type:Aa,json:{write:!0}})],mL.prototype,"spatialReference",void 0),Q([na("spatialReference")],mL.prototype,"writeSpatialReference",null),Q([ro({json:{write:!0}})],mL.prototype,"transform",void 0),mL=Q([Ro("esri.rest.support.FeatureSet")],mL),mL.prototype.toJSON.isDefaultToJSON=!0,mL||(mL={});var vL=mL,bL=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:vL});function wL(e,t){return e?t?4:3:t?3:2}const _L=Ne.getLogger("esri.tasks.support.optimizedFeatureSet"),xL={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},SL=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},ML=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},TL=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},IL=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function EL(e,t,i,r){if(e){if(i)return t&&r?IL:ML;if(t&&r)return TL}else if(t&&r)return ML;return SL}function AL({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function PL({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function CL({scale:e,translate:t},i){return i*e[0]+t[0]}function OL({scale:e,translate:t},i){return t[1]-i*e[1]}function kL(e,t,i){return e?t?i?zL(e):DL(e):i?jL(e):LL(e):null}function LL(e){const t=e.coords;return{x:t[0],y:t[1]}}function RL(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function DL(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function FL(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function jL(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function NL(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function zL(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function VL(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function UL(e,t){return e&&t?VL:e?FL:t?NL:RL}function GL(e,t,i,r,s){const n=UL(i,r);for(const o of t){const{geometry:t,attributes:i}=o;let r;t&&(r=n(new Ek,t)),e.push(new Ak(r,i,null,i[s]))}return e}function BL(e,t,i){if(!e)return null;const r=wL(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const t=[];for(let i=0;i<r;i++)t.push(e.coords[n+i]);s.push(t)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function qL(e,t,i,r,s){const n=wL(i,r);for(const o of t){const t=o.geometry,i=o.attributes;let r;t&&(r=HL(new Ek,t,n)),e.push(new Ak(r,i,null,i[s]))}return e}function HL(e,t,i=wL(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let e=0;e<i;e++)r[s++]=n[e];return e}function WL(e,t,i){if(!e)return null;const r=wL(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const e=[];for(let t=0;t<l;t++){const t=[];for(let e=0;e<r;e++)t.push(s[a++]);e.push(t)}o.push(e)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function $L(e,t,i,r,s){const n=wL(i,r);for(const o of t){const t=o.geometry,i=o.attributes;let r;t&&(r=JL(new Ek,t,n)),e.push(new Ak(r,i,null,i[s]))}return e}function JL(e,t,i=wL(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const e of o)for(let t=0;t<i;t++)s[n++]=e[t];r.push(o.length)}return e}function XL(e,t,i){if(!e)return null;const r=wL(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const e=[];for(let t=0;t<l;t++){const t=[];for(let e=0;e<r;e++)t.push(s[a++]);e.push(t)}o.push(e)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function KL(e,t,i,r,s){for(const n of t){const t=n.geometry,o=n.centroid,a=n.attributes;let l;t&&(l=YL(new Ek,t,i,r)),o?e.push(new Ak(l,a,RL(new Ek,o),a[s])):e.push(new Ak(l,a,null,a[s]))}return e}function YL(e,t,i=t.hasZ,r=t.hasM){return ZL(e,t.rings,i,r),e}function ZL(e,t,i,r){const s=wL(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const e of l)for(let t=0;t<s;t++)o[a++]=e[t];n.push(l.length)}return e}const QL=[],eR=[];function tR(e,t,i,r,s){QL[0]=e;const[n]=iR(eR,QL,t,i,r,s);return QL.length=eR.length=0,n}function iR(e,t,i,r,s,n){if(e.length=0,!i){for(const i of t){const t=i.attributes[n];e.push(new Ak(null,i.attributes,null,t))}return e}switch(i){case"esriGeometryPoint":return GL(e,t,r,s,n);case"esriGeometryMultipoint":return qL(e,t,r,s,n);case"esriGeometryPolyline":return $L(e,t,r,s,n);case"esriGeometryPolygon":return KL(e,t,r,s,n);default:_L.error("convertToFeatureSet:unknown-geometry",new Be(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function rR(e,t,i,r,s,n){const o=e.length;switch(i){case"esriGeometryPoint":GL(e,t,r,s,n);break;case"esriGeometryMultipoint":qL(e,t,r,s,n);break;case"esriGeometryPolyline":$L(e,t,r,s,n);break;case"esriGeometryPolygon":KL(e,t,r,s,n);break;default:_L.error("convertToFeatureSet:unknown-geometry",new Be(`Unable to parse unknown geometry type '${i}'`))}for(let a=0;a<t.length;a++)e[a+o].geometryType=i,e[a+o].insertAfter=t[a].insertAfter,e[a+o].groupId=t[a].groupId;return e}function sR(e,t,i,r){eR[0]=e,aR(QL,eR,t,i,r);const s=QL[0];return QL.length=eR.length=0,s}function nR(e,t,i){if(!e)return null;const r=new Ek;return"hasZ"in e&&null==t&&(t=e.hasZ),"hasM"in e&&null==i&&(i=e.hasM),cw(e)?UL(null!=t?t:null!=e.z,null!=i?i:null!=e.m)(r,e):pw(e)?YL(r,e,t,i):uw(e)?JL(r,e,wL(t,i)):hw(e)?HL(r,e,wL(t,i)):void _L.error("convertFromGeometry:unknown-geometry",new Be(`Unable to parse unknown geometry type '${e}'`))}function oR(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(!s)return null;switch(t){case"esriGeometryPoint":{let e=LL;return i&&r?e=zL:i?e=DL:r&&(e=jL),e(s)}case"esriGeometryMultipoint":return BL(s,i,r);case"esriGeometryPolyline":return WL(s,i,r);case"esriGeometryPolygon":return XL(s,i,r);default:return void _L.error("convertToGeometry:unknown-geometry",new Be(`Unable to parse unknown geometry type '${t}'`))}}function aR(e,t,i,r,s){switch(e.length=0,i){case"esriGeometryPoint":return function(e,t,i,r){let s=LL;i&&r?s=zL:i?s=DL:r&&(s=jL);for(const n of t){const{geometry:t,attributes:i}=n,r=t?s(t):null;e.push({attributes:i,geometry:r})}return e}(e,t,r,s);case"esriGeometryMultipoint":return function(e,t,i,r){for(const s of t){const{geometry:t,attributes:n}=s;let o;t&&(o=BL(t,i,r)),e.push({attributes:n,geometry:o})}return e}(e,t,r,s);case"esriGeometryPolyline":return function(e,t,i,r){for(const s of t){const{geometry:t,attributes:n}=s;let o;t&&(o=WL(t,i,r)),e.push({attributes:n,geometry:o})}return e}(e,t,r,s);case"esriGeometryPolygon":return function(e,t,i,r){for(const s of t){const{geometry:t,attributes:n,centroid:o}=s;let a;if(t&&(a=XL(t,i,r)),o){const t=LL(o);e.push({attributes:n,centroid:t,geometry:a})}else e.push({attributes:n,geometry:a})}return e}(e,t,r,s);default:_L.error("convertToFeatureSet:unknown-geometry",new Be(`Unable to parse unknown geometry type '${i}'`))}return e}function lR(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:h,uniqueIdField:c,queryGeometry:u,queryGeometryType:p}=e,d={features:aR([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:c,queryGeometry:oR(u,p,!1,!1)};return r&&(d.transform=r),h&&(d.exceededTransferLimit=h),n&&(d.hasM=n),o&&(d.hasZ=o),d}function hR(e,t){const i=new Pk,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:h,transform:c,fields:u}=e;return u&&(i.fields=u),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&iR(i.features,n,l,s,r,i.objectIdFieldName),h&&(i.exceededTransferLimit=h),r&&(i.hasM=r),s&&(i.hasZ=s),c&&(i.transform=c),i):(_L.error(new Be("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function cR(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)n.geometry&&mR(n.geometry,n.geometry,r,s,t),n.centroid&&mR(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function uR(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const t=r[o],a=t.weakClone();a.geometry=new Ek,pR(a.geometry,t.geometry,s,n,i,e),t.centroid&&(a.centroid=new Ek,pR(a.centroid,t.centroid,s,n,"esriGeometryPoint",e)),r[o]=a}return t.transform=e,t}function pR(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=xL[s],{coords:h,lengths:c}=t,u=wL(i,r),p=wL(i&&o,r&&a),d=EL(i,r,o,a);if(!c.length)return d(e.coords,h,0,0,AL(n,h[0]),PL(n,h[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=u,e;let f,y,g,m,v=0,b=0,w=b;for(const _ of c){if(_<l)continue;let t=0;b=w,g=f=AL(n,h[v]),m=y=PL(n,h[v+1]),d(e.coords,h,b,v,g,m),t++,v+=u,b+=p;for(let i=1;i<_;i++,v+=u)g=AL(n,h[v]),m=PL(n,h[v+1]),g===f&&m===y||(d(e.coords,h,b,v,g-f,m-y),b+=p,t++,f=g,y=m);t>=l&&(e.lengths.push(t),w=b)}return e.coords.length=w,e.coords.length?e:null}function dR(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=xL[s],{coords:h,lengths:c}=t,u=wL(i,r),p=wL(i&&o,r&&a),d=EL(i,r,o,a);if(!c.length)return d(e.coords,h,0,0,h[0],h[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=u,e;let f=0;const y=n*n;for(const g of c){if(g<l){f+=g*u;continue}const t=e.coords.length/p,i=f,r=f+(g-1)*u;d(e.coords,h,e.coords.length,i,h[i],h[i+1]),yR(e.coords,h,u,y,d,i,r),d(e.coords,h,e.coords.length,r,h[r],h[r+1]);const s=e.coords.length/p-t;s>=l?e.lengths.push(s):e.coords.length=t*p,f+=g*u}return e.coords.length?e:null}function fR(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],h=e[r+1];let c=o,u=a,p=l-c,d=h-u;if(0!==p||0!==d){const e=((s-c)*p+(n-u)*d)/(p*p+d*d);e>1?(c=l,u=h):e>0&&(c+=p*e,u+=d*e)}return p=s-c,d=n-u,p*p+d*d}function yR(e,t,i,r,s,n,o){let a,l=r,h=0;for(let c=n+i;c<o;c+=i)a=fR(t,c,n,o),a>l&&(h=c,l=a);l>r&&(h-n>i&&yR(e,t,i,r,s,n,h),s(e,t,e.length,h,t[h],t[h+1]),o-h>i&&yR(e,t,i,r,s,h,o))}function gR(e,t,i,r){if(!t||!t.coords||!t.coords.length)return null;const s=wL(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=s){const i=e[t],r=e[t+1];n=Math.min(n,i),a=Math.max(a,i),o=Math.min(o,r),l=Math.max(l,r)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function mR(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?IL:ML:r?ML:SL,l=wL(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,CL(s,n[0]),OL(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[h,c]=s.scale;let u=0;for(let p=0;p<o.length;p++){const t=o[p];e.lengths[p]=t;let i=CL(s,n[u]),r=OL(s,n[u+1]);a(e.coords,n,u,u,i,r),u+=l;for(let s=1;s<t;s++,u+=l)i+=n[u]*h,r-=n[u+1]*c,a(e.coords,n,u,u,i,r)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function vR(e,t,i,r,s,n){const o=wL(i,r),a=EL(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let h=0;h<l.length;h+=o)a(e.coords,l,e.coords.length,h,l[h],l[h+1]);return e}function bR(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const i=n+e[r*(t+a)],l=o+e[r*(t+a)+1],h=(i-n)*(l+o);n=i,o=l,s+=h}return.5*s}function wR(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=bR(i,s,r[o],t),s+=o;return Math.abs(n)}function _R(e,t){const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const e=s[o];let a=r[t*n],l=r[t*n+1];for(let s=1;s<e;s++){const e=a+r[t*(n+s)],o=l+r[t*(n+s)+1];i.coords[t*(n+s)]=e,i.coords[t*(n+s)+1]=o,a=e,l=o}n+=e}return i}function xR(e,t){return t}function SR(e,t,i,r){switch(i){case 0:return ER(e,t+r,0);case 1:return"lowerLeft"===e.originPosition?ER(e,t+r,1):function({translate:e,scale:t},i,r){return e[r]-i*t[r]}(e,t+r,1)}}function MR(e,t,i,r){switch(i){case 2:return ER(e,t,2);default:return SR(e,t,i,r)}}function TR(e,t,i,r){switch(i){case 2:return ER(e,t,3);default:return SR(e,t,i,r)}}function IR(e,t,i,r){switch(i){case 3:return ER(e,t,3);default:return MR(e,t,i,r)}}function ER({translate:e,scale:t},i,r){return e[r]+i*t[r]}class AR{constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=xR,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=eL(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(t)for(const i of e.features)t(i.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const i=e.fields.map((e=>e.name));this.AttributesConstructor=function(){for(const e of i)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,i)=>this.addCoordinatePoint(e,t,i),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,i)=>this.addCoordinatePolygon(e,t,i),this.createGeometry=e=>this.createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,i)=>this.addCoordinatePolyline(e,t,i),this.createGeometry=e=>this.createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,i)=>this.addCoordinateMultipoint(e,t,i),this.createGeometry=e=>this.createMultipointGeometry(e);break;default:e.geometryType}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this.AttributesConstructor}}allocateCoordinates(){}addLength(e,t,i){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:i,queryGeometryType:r}=t,s=oR(mR(i.clone(),i,!1,!1,this.transform),r,!1,!1);e.queryGeometryType=r,e.queryGeometry=a({},s)}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}transformPathLikeValue(e,t){let i=0;return t<=1&&(i=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,i)}addCoordinatePolyline(e,t,i){this.dehydratedAddPointsCoordinate(e.paths,t,i)}addCoordinatePolygon(e,t,i){this.dehydratedAddPointsCoordinate(e.rings,t,i)}addCoordinateMultipoint(e,t,i){0===i&&e.points.push([]);const r=this.transformPathLikeValue(t,i);e.points[e.points.length-1].push(r)}createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}dehydratedAddPointsCoordinate(e,t,i){0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const r=this.transformPathLikeValue(t,i),s=e[e.length-1];0===i&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),s.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=r}deriveApplyTransform(e){const{hasZ:t,hasM:i}=e;return t&&i?IR:t?MR:i?TR:SR}}async function PR(e,t,i={},r){const s=ok(a(a(l(a({},e.query),{f:"json"}),r),function(e,t){const i=e.toJSON();return i.objectIds&&(i.objectIds=i.objectIds.join(",")),i.orderByFields&&(i.orderByFields=i.orderByFields.join(",")),!i.outFields||null!=t&&t.returnCountOnly?delete i.outFields:-1!==i.outFields.indexOf("*")?i.outFields="*":i.outFields=i.outFields.join(","),i.outSpatialReference&&(i.outSR=i.outSR.wkid||JSON.stringify(i.outSR.toJSON()),delete i.outSpatialReference),i.dynamicDataSource&&(i.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i}(t,r)));return $i(e.path+"/queryRelatedRecords",l(a({},i),{query:a(a({},i.query),s)}))}async function CR(e,t,i){t=ik.from(t);return async function(e,t,i){const r=await PR(e,t,i),s=r.data,n=s.geometryType,o=s.spatialReference,h={};for(const a of s.relatedRecordGroups){const e={fields:void 0,objectIdFieldName:void 0,geometryType:n,spatialReference:o,hasZ:!!s.hasZ,hasM:!!s.hasM,features:a.relatedRecords};if(null!=a.objectId)h[a.objectId]=e;else for(const t in a)a.hasOwnProperty(t)&&"relatedRecords"!==t&&(h[a[t]]=e)}return l(a({},r),{data:h})}(sk(e),t,i).then((e=>{const t=e.data,i={};return Object.keys(t).forEach((e=>i[e]=vL.fromJSON(t[e]))),i}))}async function OR(e,t,i){t=ik.from(t);return async function(e,t,i){const r=await PR(e,t,i,{returnCountOnly:!0}),s=r.data,n={};for(const o of s.relatedRecordGroups)null!=o.objectId&&(n[o.objectId]=o.count);return l(a({},r),{data:n})}(sk(e),t,a({},i)).then((e=>e.data))}const kR="Layer does not support extent calculation.";function LR(e,t,i,r={},s={}){const n="string"==typeof e?$t(e):e,o=t.geometry?[t.geometry]:[];return r.responseType="pbf"===i?"array-buffer":"json",xk(o,null,r).then((e=>{const o=e&&e[0];m(o)&&((t=t.clone()).geometry=o);const h=ok(a(a(l(a({},n.query),{f:i}),s),function(e,t){var i,r;const s=e.geometry,n=e.toJSON(),o=n;if(m(s)&&(o.geometry=JSON.stringify(s),o.geometryType=fw(s),o.inSR=s.spatialReference.wkid||JSON.stringify(s.spatialReference)),null!=(i=n.topFilter)&&i.groupByFields&&(o.topFilter.groupByFields=n.topFilter.groupByFields.join(",")),null!=(r=n.topFilter)&&r.orderByFields&&(o.topFilter.orderByFields=n.topFilter.orderByFields.join(",")),n.topFilter&&(o.topFilter=JSON.stringify(o.topFilter)),n.objectIds&&(o.objectIds=n.objectIds.join(",")),n.orderByFields&&(o.orderByFields=n.orderByFields.join(",")),n.outFields&&!(null!=t&&t.returnCountOnly||null!=t&&t.returnExtentOnly||null!=t&&t.returnIdsOnly)?-1!==n.outFields.indexOf("*")?o.outFields="*":o.outFields=n.outFields.join(","):delete o.outFields,n.outSR?o.outSR=n.outSR.wkid||JSON.stringify(n.outSR):s&&n.returnGeometry&&(o.outSR=o.inSR),n.returnGeometry&&delete n.returnGeometry,n.timeExtent){const e=n.timeExtent,{start:t,end:i}=e;null==t&&null==i||(o.time=t===i?t:`${null==t?"null":t},${null==i?"null":i}`),delete n.timeExtent}return o}(t,s)));return $i(ci(n.path,"queryTopFeatures"),l(a({},r),{query:a(a({},h),r.query)}))}))}var RR;let DR=RR=class extends Ko{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new RR({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};Q([ro({type:[String],json:{write:!0}})],DR.prototype,"groupByFields",void 0),Q([ro({type:Number,json:{write:!0}})],DR.prototype,"topCount",void 0),Q([ro({type:[String],json:{write:!0}})],DR.prototype,"orderByFields",void 0),DR=RR=Q([Ro("esri.rest.support.TopFilter")],DR);var FR,jR=DR;const NR=new ee({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),zR=new ee({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let VR=FR=class extends Ko{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new FR(H({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};Q([ro({type:Boolean,json:{write:!0}})],VR.prototype,"cacheHint",void 0),Q([ro({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],VR.prototype,"distance",void 0),Q([ro({types:mw,json:{read:dw,write:!0}})],VR.prototype,"geometry",void 0),Q([ro({type:Number,json:{write:!0}})],VR.prototype,"geometryPrecision",void 0),Q([ro({type:Number,json:{write:!0}})],VR.prototype,"maxAllowableOffset",void 0),Q([ro({type:Number,json:{read:{source:"resultRecordCount"}}})],VR.prototype,"num",void 0),Q([ro({json:{write:!0}})],VR.prototype,"objectIds",void 0),Q([ro({type:[String],json:{write:!0}})],VR.prototype,"orderByFields",void 0),Q([ro({type:[String],json:{write:!0}})],VR.prototype,"outFields",void 0),Q([ro({type:Aa,json:{read:{source:"outSR"},write:{target:"outSR"}}})],VR.prototype,"outSpatialReference",void 0),Q([ro({type:String,json:{write:!0}})],VR.prototype,"resultType",void 0),Q([ro({json:{write:!0}})],VR.prototype,"returnGeometry",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],VR.prototype,"returnM",void 0),Q([ro({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],VR.prototype,"returnZ",void 0),Q([ro({type:Number,json:{read:{source:"resultOffset"}}})],VR.prototype,"start",void 0),Q([na("start"),na("num")],VR.prototype,"writeStart",null),Q([ro({type:String,json:{read:{source:"spatialRel",reader:NR.read},write:{target:"spatialRel",writer:NR.write}}})],VR.prototype,"spatialRelationship",void 0),Q([ro({type:mO,json:{write:!0}})],VR.prototype,"timeExtent",void 0),Q([ro({type:jR,json:{write:!0}})],VR.prototype,"topFilter",void 0),Q([ro({type:String,json:{read:zR.read,write:{writer:zR.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],VR.prototype,"units",void 0),Q([ro({type:String,json:{write:!0}})],VR.prototype,"where",void 0),VR=FR=Q([Ro("esri.rest.support.TopFeaturesQuery")],VR),VR.from=qn(VR);var UR=VR;async function GR(e,t,i,r){const s=sk(e),n=a({},r),{data:o}=await async function(e,t,i,r){const s=await LR(e,t,"json",r);return nL(t,i,s.data),s}(s,UR.from(t),i,n);return vL.fromJSON(o)}async function BR(e,t,i){const r=sk(e);return(await async function(e,t,i){return m(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):LR(e,t,"json",i,{returnIdsOnly:!0})}(r,UR.from(t),a({},i))).data.objectIds}async function qR(e,t,i){const r=sk(e),s=await async function(e,t,i){return m(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):LR(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(kR);if(t.hasOwnProperty("count"))throw new Error(kR);return e}))}(r,UR.from(t),a({},i));return{count:s.data.count,extent:Ol.fromJSON(s.data.extent)}}async function HR(e,t,i){const r=sk(e);return(await function(e,t,i){return m(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):LR(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}(r,UR.from(t),a({},i))).data.count}let WR=class extends jo{constructor(...e){super(...e),this.requestOptions=null,this.url=null}normalizeCtorArgs(e,t){return"string"!=typeof e?e:a({url:e},t)}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?$t(e):null}_encode(e,t,i){const r={};for(const s in e){if("declaredClass"===s)continue;const n=e[s];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[s]=[];for(let e=0;e<n.length;e++)r[s][e]=this._encode(n[e])}else if("object"==typeof n)if(n.toJSON){const e=n.toJSON(i&&i[s]);r[s]=t?e:JSON.stringify(e)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}};Q([ro({readOnly:!0})],WR.prototype,"parsedUrl",null),Q([ro()],WR.prototype,"requestOptions",void 0),Q([ro({type:String})],WR.prototype,"url",void 0),WR=Q([Ro("esri.tasks.Task")],WR);var $R=WR;let JR=class extends $R{constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}execute(e,t){return this.executeJSON(e,t).then((i=>this.featureSetFromJSON(e,i,t)))}async executeJSON(e,t){var i;const r=a(a({},this.requestOptions),t),s=this._normalizeQuery(e),n=null!=(null==(i=e.outStatistics)?void 0:i[0]),o=y("featurelayer-pbf-statistics"),l=!n||o;let h;if("pbf"===this.format&&l)try{h=await async function(e,t,i){const r=sk(e),s=a({},i),n=ek.from(t),o=!n.quantizationParameters,{data:l}=await hL(r,n,new AR({sourceSpatialReference:n.sourceSpatialReference,applyTransform:o}),s);return l}(this.url,s,r)}catch(c){if("query:parsing-pbf"!==c.name)throw c;this.format="json"}return"json"!==this.format&&l||(h=await async function(e,t,i){const r=sk(e),s=a({},i),n=ek.from(t),{data:o}=await lL(r,n,n.sourceSpatialReference,s);return o}(this.url,s,r)),this._normalizeFields(h.fields),h}async featureSetFromJSON(e,t,i){if(!(this._queryIs3DObjectFormat(e)&&m(this.infoFor3D)&&t.features&&t.features.length))return vL.fromJSON(t);const{meshFeatureSetFromJSON:r}=await lt(import("./meshFeatureSet.c1e93d7f.js"),i);return r(e,this.infoFor3D,t)}executeForCount(e,t){const i=a(a({},this.requestOptions),t),r=this._normalizeQuery(e);return async function(e,t,i){return pL(sk(e),ek.from(t),a({},i)).then((e=>e.data.count))}(this.url,r,i)}executeForExtent(e,t){const i=a(a({},this.requestOptions),t),r=this._normalizeQuery(e);return async function(e,t,i){return dL(sk(e),ek.from(t),a({},i)).then((e=>({count:e.data.count,extent:Ol.fromJSON(e.data.extent)})))}(this.url,r,i)}executeForIds(e,t){const i=a(a({},this.requestOptions),t),r=this._normalizeQuery(e);return async function(e,t,i){return uL(sk(e),ek.from(t),a({},i)).then((e=>e.data.objectIds))}(this.url,r,i)}executeRelationshipQuery(e,t){e=ik.from(e);const i=a(a({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),CR(this.url,e,i)}executeRelationshipQueryForCount(e,t){e=ik.from(e);const i=a(a({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),OR(this.url,e,i)}executeAttachmentQuery(e,t){const i=a(a({},this.requestOptions),t);return hk(this.url,e,i)}executeTopFeaturesQuery(e,t){const i=a(a({},this.requestOptions),t);return GR(this.parsedUrl,e,this.sourceSpatialReference,i)}executeForTopIds(e,t){const i=a(a({},this.requestOptions),t);return BR(this.parsedUrl,e,i)}executeForTopExtents(e,t){const i=a(a({},this.requestOptions),t);return qR(this.parsedUrl,e,i)}executeForTopCount(e,t){const i=a(a({},this.requestOptions),t);return HR(this.parsedUrl,e,i)}_normalizeQuery(e){let t=ek.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?VO.from(e.dynamicDataSource):this.dynamicDataSource),m(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if("3D_glb"===e.id){t.formatOf3DObjects=e.id;break}"3D_gltf"!==e.id||t.formatOf3DObjects||(t.formatOf3DObjects=e.id)}if(!t.formatOf3DObjects)throw new Be("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(v(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,v(t.outFields)&&(t.outFields=[]);const{originX:i,originY:r,originZ:s,translationX:n,translationY:o,translationZ:a,scaleX:l,scaleY:h,scaleZ:c,rotationX:u,rotationY:p,rotationZ:d,rotationDeg:f}=this.infoFor3D.transformFieldRoles;t.outFields.push(i,r,s,n,o,a,l,h,c,u,p,d,f)}}return t}_normalizeFields(e){if(m(this.fieldsIndex)&&m(e))for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(e){return m(this.infoFor3D)&&e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}};Q([ro({type:VO})],JR.prototype,"dynamicDataSource",void 0),Q([ro()],JR.prototype,"fieldsIndex",void 0),Q([ro()],JR.prototype,"format",void 0),Q([ro()],JR.prototype,"gdbVersion",void 0),Q([ro()],JR.prototype,"infoFor3D",void 0),Q([ro()],JR.prototype,"sourceSpatialReference",void 0),JR=Q([Ro("esri.tasks.QueryTask")],JR);var XR=JR;const KR=Ne.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),YR=new Map;function ZR(e){if(!LP(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function QR(e,t){const i=function(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some((t=>t.id===parseInt(e,10)&&(i=t,!0))),i}(e,t);if(!i)return;const r=`${t.url}/${i.relatedTableId}`;return{url:r,queryTask:new XR({url:r,sourceSpatialReference:t.spatialReference}),relation:i,relatedFields:[],outStatistics:[]}}async function eD(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,queryTask:o,relation:a,relatedFields:l,outStatistics:h}=t,c=function({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some((t=>(`${t.relatedTableId}`===i&&t.id===e.id&&(r=t),!!r))),r}({originRelationship:a,relationships:n.relationships,layerId:s});if(c.relationshipTableId&&c.keyFieldInRelationshipTable){const t=(await function(e,t,i,r){const s=new ik;return s.outFields=["*"],s.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}(e,c,i,r))[e.attributes[i.objectIdField]];if(!t)return null;const s=t.features.map((e=>e.attributes[n.objectIdField]));if((null==h?void 0:h.length)>0&&n.supportsStatistics){const e=new ek;e.where=function(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}(n.objectIdField,s,1e3),e.outFields=l,e.outStatistics=h;return pt({features:Promise.resolve(t),statsFeatures:o.execute(e)})}}const u=null==c?void 0:c.keyField;if(u){const i=R_(function(e,t){if(null!=e){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}(n.fields,u)),s=function(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}(e.attributes,a.keyField),l=i?`${u}=${s}`:`${u}='${s}'`,h=o.execute(new ek({where:l,outFields:t.relatedFields}),r),c=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?o.execute(new ek({where:l,outFields:t.relatedFields,outStatistics:t.outStatistics}),r):null,p={features:h};return c&&(p.statsFeatures=c),pt(p)}return null}function tD({relatedInfos:e,layer:t},i){const r={};return e.forEach(((e,s)=>{const{relation:n}=e;if(!n){const e=new Be("relation-required","A relation is required on a layer to retrieve related records.");throw KR.error(e),e}const{relatedTableId:o}=n;if("number"!=typeof o){const e=new Be("A related table ID is required on a layer to retrieve related records.");throw KR.error(e),e}const a=`${t.url}/${o}`,l=YR.get(a),h=l||function(e,t){return $i(e,{query:{f:"json"},signal:t&&t.signal})}(a,i);l||YR.set(a,h),r[s]=h})),pt(r)}let iD=class extends jo{constructor(e){super(e),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return null==t?void 0:t.map((t=>{if(!t)return null;if(t.title=wP({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:t.title}),t.caption=wP({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:t.caption}),t.altText=wP({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:t.altText}),"image"===t.type){const{value:e}=t;return this._setImageValue({value:e,formattedAttributes:i,layer:n}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){const{value:r}=t;return this._setChartValue({value:r,chartType:t.type,attributes:e,formattedAttributes:i,layer:n}),t}return null})).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const e=SP(o,s);i.sourceURL=_P({formattedAttributes:r,template:e,fieldInfoMap:t})}if(n){const e=SP(n,s);i.linkURL=_P({formattedAttributes:r,template:e,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:h}=t;if(t.fields=function(e,t){return e&&e.map((e=>mP(e,t)))}(l,n),h&&(t.normalizeField=mP(h,n)),!l.some((e=>!!(null!=r[e]||LP(e)&&a.size))))return;const c=null==o?void 0:o.fieldInfos;l.forEach((e=>{if(LP(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:c,fieldName:e,formattedAttributes:r,chartType:s,value:t})]);const n=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:e,fieldInfos:c});t.series.push(n)}))}_getRelatedChartInfos(e){var t;const{fieldInfos:i,fieldName:r,formattedAttributes:s,chartType:n,value:o}=e,a=[],l=ZR(r),{layerId:h,fieldName:c}=l,u=null==(t=this.relatedInfos)?void 0:t.get(h.toString());if(!u)return a;const{relatedFeatures:p,relation:d}=u;if(!d||!p)return a;const{cardinality:f}=d;return p.forEach((e=>{const{attributes:t}=e;t&&Object.keys(t).forEach((e=>{e===c&&a.push(this._getChartOption({value:o,attributes:t,formattedAttributes:s,fieldName:r,chartType:n,relatedFieldName:e,fieldInfos:i}))}))})),"one-to-many"===f||"many-to-many"===f?a:[a[0]]}_getTooltip({label:e,value:t,chartType:i}){return"pie-chart"===i?e:`${e}: ${t}`}_getChartOption(e){var t;const{value:i,attributes:r,formattedAttributes:s,fieldName:n,relatedFieldName:o,fieldInfos:a,chartType:l}=e,{layer:h}=this,{normalizeField:c,tooltipField:u}=i,p=c?LP(c)?r[ZR(c).fieldName]:r[c]:null,d=o&&void 0!==r[o]?r[o]:void 0!==r[n]?r[n]:s[n],f=void 0===d?null:d&&p?d/p:d,y=new gx({value:f});if(LP(n)){const e=ZR(n),t=ZR(u),i=t?t.fieldName:null,s=TP(f,{fieldInfos:a,fieldName:o,layer:h,preventPlacesFormatting:!!p}),c=e?e.label||e.fieldName:o,d=i&&void 0!==r[i]?r[i]:c;return y.tooltip=this._getTooltip({label:d,value:s,chartType:l}),y}const g=IP(a,n),m=mP(n,h),v=u&&void 0!==s[u]?s[u]:gP(g||new lx({fieldName:m}),null==(t=this.popupTemplate)?void 0:t.expressionInfos),b=s[m];return y.tooltip=this._getTooltip({label:v,value:b,chartType:l}),y}};Q([ro()],iD.prototype,"activeMediaInfoIndex",void 0),Q([ro({readOnly:!0})],iD.prototype,"activeMediaInfo",null),Q([ro()],iD.prototype,"attributes",void 0),Q([ro()],iD.prototype,"description",void 0),Q([ro()],iD.prototype,"fieldInfoMap",void 0),Q([ro()],iD.prototype,"formattedAttributes",void 0),Q([ro()],iD.prototype,"expressionAttributes",void 0),Q([ro({readOnly:!0})],iD.prototype,"formattedMediaInfos",null),Q([ro()],iD.prototype,"layer",void 0),Q([ro({readOnly:!0})],iD.prototype,"formattedMediaInfoCount",null),Q([ro()],iD.prototype,"mediaInfos",void 0),Q([ro()],iD.prototype,"popupTemplate",void 0),Q([ro()],iD.prototype,"relatedInfos",void 0),Q([ro()],iD.prototype,"title",void 0),iD=Q([Ro("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],iD);var rD=iD,sD=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],nD=[{name:"default",colors:[].concat(sD.slice(30,39),sD.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const oD=new Map([["ar",()=>import("./ar.285b9536.js").then((function(e){return e.a}))],["bs-ba",()=>import("./bs_BA.ce27de1e.js").then((function(e){return e.b}))],["ca-es",()=>import("./ca_ES.5f442b79.js").then((function(e){return e.c}))],["cs-cz",()=>import("./cs_CZ.3110cdc5.js").then((function(e){return e.c}))],["da-dk",()=>import("./da_DK.dc783804.js").then((function(e){return e.d}))],["de-de",()=>import("./de_DE.338c6729.js").then((function(e){return e.d}))],["de-ch",()=>import("./de_CH.94eb9940.js").then((function(e){return e.d}))],["el-gr",()=>import("./el_GR.0cc4640c.js").then((function(e){return e.e}))],["en-us",()=>import("./en_US.0fc83034.js").then((function(e){return e.e}))],["en-ca",()=>import("./en_CA.0a90e701.js").then((function(e){return e.e}))],["es-es",()=>import("./es_ES.a600db62.js").then((function(e){return e.e}))],["et-ee",()=>import("./et_EE.6cea8dea.js").then((function(e){return e.e}))],["fi-fi",()=>import("./fi_FI.b69b6aea.js").then((function(e){return e.f}))],["fr-fr",()=>import("./fr_FR.eb45115a.js").then((function(e){return e.f}))],["he-il",()=>import("./he_IL.8c82007b.js").then((function(e){return e.h}))],["hr-hr",()=>import("./hr_HR.70bba819.js").then((function(e){return e.h}))],["hu-hu",()=>import("./hu_HU.7ceab283.js").then((function(e){return e.h}))],["id-id",()=>import("./id_ID.f9729bcb.js").then((function(e){return e.i}))],["it-it",()=>import("./it_IT.d31fcfed.js").then((function(e){return e.i}))],["ja-jp",()=>import("./ja_JP.9addbfbb.js").then((function(e){return e.j}))],["ko-kr",()=>import("./ko_KR.65c14c43.js").then((function(e){return e.k}))],["lt-lt",()=>import("./lt_LT.d76e7026.js").then((function(e){return e.l}))],["lv-lv",()=>import("./lv_LV.f1026799.js").then((function(e){return e.l}))],["nb-no",()=>import("./nb_NO.994da14a.js").then((function(e){return e.n}))],["nl-nl",()=>import("./nl_NL.35f2fcc1.js").then((function(e){return e.n}))],["pl-pl",()=>import("./pl_PL.3cf156fd.js").then((function(e){return e.p}))],["pt-br",()=>import("./pt_BR.19588f13.js").then((function(e){return e.p}))],["pt-pt",()=>import("./pt_PT.49f79715.js").then((function(e){return e.p}))],["ro-ro",()=>import("./ro_RO.1cc28591.js").then((function(e){return e.r}))],["ru-ru",()=>import("./ru_RU.7f24e5a9.js").then((function(e){return e.r}))],["sk-sk",()=>import("./sk_SK.dd99008f.js").then((function(e){return e.s}))],["sl-sl",()=>import("./sl_SL.d8d4dbe4.js").then((function(e){return e.s}))],["sr-rs",()=>import("./sr_RS.a46e26bb.js").then((function(e){return e.s}))],["sv-se",()=>import("./sv_SE.669852f8.js").then((function(e){return e.s}))],["th-th",()=>import("./th_TH.b6984004.js").then((function(e){return e.t}))],["tr-tr",()=>import("./tr_TR.dcb7aa69.js").then((function(e){return e.t}))],["uk-ua",()=>import("./uk_UA.b5400967.js").then((function(e){return e.u}))],["vi-vn",()=>import("./vi_VN.3130161a.js").then((function(e){return e.v}))],["zh-cn",()=>import("./zh_Hans.49eaeb7b.js").then((function(e){return e.z}))],["zh-hk",()=>import("./zh_Hant.8eb63b64.js").then((function(e){return e.z}))],["zh-tw",()=>import("./zh_Hant.8eb63b64.js").then((function(e){return e.z}))]]);function aD(e){return e?oD.has(e.toLowerCase())?e.toLowerCase():function(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of oD.keys())if(r.startsWith(t)){i=r;break}return i}(e)||"en-us":"en-us"}let lD,hD;const cD="esri-feature-media",uD="esri-feature-media__container",pD="esri-feature-media__item-container",dD="esri-feature-media__item",fD="esri-feature-media__item-title",yD="esri-feature-media__item-caption",gD="esri-feature-media__previous",mD="esri-feature-media__previous-icon",vD="esri-feature-media__previous-icon--rtl",bD="esri-feature-media__next",wD="esri-feature-media__next-icon",_D="esri-feature-media__next-icon--rtl",xD="esri-feature-media__chart",SD="esri-feature-media__button",MD="esri-feature-media__icon",TD="esri-icon-left-triangle-arrow",ID="esri-icon-right-triangle-arrow";let ED=class extends xy{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new rD,this.messages=null}initialize(){this._featureElementInfo=new UC,this.own(Rh(this,["viewModel.activeMediaInfo","viewModel.activeMediaInfoIndex"],(()=>this._setupMediaRefreshTimer())),Rh(this,["viewModel.description","viewModel.title"],(()=>this._setupFeatureElementInfo())))}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return Iy("div",{bind:this,class:cD,onkeyup:this._handleMediaKeyup},null==(e=this._featureElementInfo)?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Iy("div",{key:"media-element-container",class:uD},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:h,linkURL:c}=s,u=fP(c)?"_blank":"_self",p="_blank"===u?"noreferrer":"",d=n?t:null,f=Iy("img",{alt:o||a,key:`media-${l}-${i}-${r}-${d?d.timestamp:0}`,src:d?d.sourceURL:h});return(c?Iy("a",{title:a,href:c,rel:p,target:u},f):null)||f}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return Iy("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:xD,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?"image"===e.type?this.renderImageMediaInfo(e):-1!==e.type.indexOf("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?Iy("div",{key:"media-title",class:fD,innerHTML:e.title}):null,i=e.caption?Iy("div",{key:"media-caption",class:yD,innerHTML:e.caption}):null;return Iy("div",{key:"media-container",class:pD},Iy("div",{key:"media-item-container",class:dD},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t="previous"===e,i=t?this.messages.previous:this.messages.next,r=t?this.classes(SD,gD):this.classes(SD,bD),s=t?this.classes(MD,mD,TD):this.classes(MD,wD,ID),n=t?this.classes(MD,vD,ID):this.classes(MD,_D,TD);return Iy("button",{type:"button",key:t?"media-previous":"media-next",title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:t?this._previous:this._next},Iy("span",{"aria-hidden":"true",class:s}),Iy("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getChartDependencies(e){const t=await async function(e=le()){if(e=aD(e),lD&&e===hD)return lD;lD=import("./index.bc55434a.js").then((function(e){return e.i})),hD=e;try{const[t,i]=await Promise.all([lD,oD.get(hD)()]);hD===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return lD=null,hD=null,null}return lD}(),{activeMediaInfo:i}=this.viewModel;this._renderChart({chartDiv:e,mediaInfo:i,chartsModule:t})}_handleMediaKeyup(e){const t=Ke(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{chartsModule:t,chartDiv:i,mediaInfo:r}=e,{value:s,type:n}=r,{am4core:o}=t,a=function(e,t="default"){const i=nD.find((e=>e.name===t));return i?i.colors.map((t=>e.color(t))):null}(o);vu()&&o.useTheme(t.am4themes_dark),o.useTheme(t.am4themes_animated),o.useTheme((function(e){e instanceof o.ColorSet&&a&&(e.list=a)}));const l="pie-chart"===n?this._createPieChart(e):this._createXYChart(e);i.setAttribute("aria-label",r.altText||r.title),l.data=s.series.map((e=>({tooltip:e.tooltip,value:e.value}))).filter((e=>"pie-chart"!==n||e.value>0))}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=hu();const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value="value",o.dataFields.category="tooltip",this._customizeChartTooltip(o.tooltip,r),n}_getMinSeriesValue(e){let t=0;return e.forEach((e=>t=Math.min(e.value,t))),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new o.ValueAxis),h=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),h.wrap=!0;const c=e.series.push(new o.ColumnSeries);c.dataFields.valueY="value",c.dataFields.categoryX="tooltip",e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dx=a.tooltip.contentWidth}));const l=e.xAxes.push(new o.ValueAxis),h=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),h.wrap=!0;const c=e.series.push(new o.ColumnSeries);c.dataFields.valueX="value",c.dataFields.categoryY="tooltip",e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category="tooltip",a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",(()=>{a.tooltip.dy=-a.tooltip.contentHeight}));const l=e.yAxes.push(new o.ValueAxis),h=l.renderer.labels.template;l.renderer.minLabelPosition=.05,l.renderer.maxLabelPosition=.95,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),h.wrap=!0;const c=e.series.push(new o.LineSeries);c.dataFields.categoryX="tooltip",c.dataFields.valueY="value",e.cursor=new o.XYCursor,s.series.length>15&&(e.scrollbarX=new n.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=hu(),"column-chart"===s&&this._createColumnChart(a,e),"bar-chart"===s&&this._createBarChart(a,e),"line-chart"===s&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval((()=>{this._updateMediaInfoTimestamp(i.sourceURL)}),r);this._refreshTimer=s}_getImageSource(e,t){const i=-1!==e.indexOf("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};Q([eh("viewModel.attributes")],ED.prototype,"attributes",void 0),Q([eh("viewModel.activeMediaInfoIndex")],ED.prototype,"activeMediaInfoIndex",void 0),Q([eh("viewModel.description")],ED.prototype,"description",void 0),Q([eh("viewModel.fieldInfoMap")],ED.prototype,"fieldInfoMap",void 0),Q([eh("viewModel.layer")],ED.prototype,"layer",void 0),Q([eh("viewModel.mediaInfos")],ED.prototype,"mediaInfos",void 0),Q([eh("viewModel.popupTemplate")],ED.prototype,"popupTemplate",void 0),Q([eh("viewModel.relatedInfos")],ED.prototype,"relatedInfos",void 0),Q([eh("viewModel.title")],ED.prototype,"title",void 0),Q([ro({type:rD})],ED.prototype,"viewModel",void 0),Q([ro(),Sy("esri/widgets/Feature/t9n/Feature")],ED.prototype,"messages",void 0),ED=Q([Ro("esri.widgets.Feature.FeatureMedia")],ED);var AD,PD=ED;let CD=AD=class extends Ko{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new AD({minValue:this.minValue,maxValue:this.maxValue})}};Q([ro({type:Number,json:{write:!0}})],CD.prototype,"minValue",void 0),Q([ro({type:Number,json:{write:!0}})],CD.prototype,"maxValue",void 0),CD=AD=Q([Ro("esri.renderer.support.AuthoringInfoClassBreakInfo")],CD);var OD,kD=CD;let LD=OD=class extends Ko{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new OD({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:H(this.classBreakInfos)})}};Q([ro({type:String,json:{write:!0}})],LD.prototype,"field",void 0),Q([ro({type:String,json:{write:!0}})],LD.prototype,"normalizationField",void 0),Q([ro({type:String,json:{write:!0}})],LD.prototype,"label",void 0),Q([ro({type:[kD],json:{write:!0}})],LD.prototype,"classBreakInfos",void 0),LD=OD=Q([Ro("esri.renderers.support.AuthoringInfoFieldInfo")],LD);var RD,DD=LD;const FD=new ee({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),jD=new ee({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),ND={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},zD=["high-to-low","above-and-below","centered-on","extremes"],VD=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],UD=["seconds","minutes","hours","days","months","years"];let GD=RD=class extends Ko{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new RD({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};Q([ro({types:ND,json:{write:!0}})],GD.prototype,"endTime",void 0),Q([Ra("endTime")],GD.prototype,"castEndTime",null),Q([ro({type:String,json:{write:!0}})],GD.prototype,"field",void 0),Q([ro({type:Number,json:{write:!0}})],GD.prototype,"maxSliderValue",void 0),Q([ro({type:Number,json:{write:!0}})],GD.prototype,"minSliderValue",void 0),Q([ro({types:ND,json:{write:!0}})],GD.prototype,"startTime",void 0),Q([Ra("startTime")],GD.prototype,"castStartTime",null),Q([ro({type:FD.apiValues,value:null,json:{type:FD.jsonValues,read:FD.read,write:FD.write}})],GD.prototype,"style",null),Q([ro({type:VD,value:null,json:{type:VD,origins:{"web-scene":{type:zD,write:{writer:(e,t)=>{zD.indexOf(e)>-1&&(t.theme=e)}}}},write:!0}})],GD.prototype,"theme",null),Q([ro({type:jD.apiValues,json:{type:jD.jsonValues,read:jD.read,write:jD.write}})],GD.prototype,"type",void 0),Q([ro({type:UD,json:{type:UD,write:!0}})],GD.prototype,"units",void 0),GD=RD=Q([Ro("esri.renderers.support.AuthoringInfoVisualVariable")],GD);var BD=GD;let qD=class extends Ko{constructor(e){super(e),this.type=null}};Q([ro({readOnly:!0,json:{read:!1,write:!0}})],qD.prototype,"type",void 0),qD=Q([Ro("esri.rest.support.ColorRamp")],qD);var HD,WD=qD;let $D=HD=class extends WD{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new HD({fromColor:H(this.fromColor),toColor:H(this.toColor),algorithm:this.algorithm})}};Q([th({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],$D.prototype,"algorithm",void 0),Q([ro({type:Rv,json:{type:[Yn],write:!0}})],$D.prototype,"fromColor",void 0),Q([ro({type:Rv,json:{type:[Yn],write:!0}})],$D.prototype,"toColor",void 0),Q([ro({type:["algorithmic"]})],$D.prototype,"type",void 0),$D=HD=Q([Ro("esri.rest.support.AlgorithmicColorRamp")],$D);var JD,XD=$D;let KD=JD=class extends WD{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new JD({colorRamps:H(this.colorRamps)})}};Q([ro({type:[XD],json:{write:!0}})],KD.prototype,"colorRamps",void 0),Q([ro({type:["multipart"]})],KD.prototype,"type",void 0),KD=JD=Q([Ro("esri.rest.support.MultipartColorRamp")],KD);var YD=KD;const ZD={key:"type",base:WD,typeMap:{algorithmic:XD,multipart:YD}};function QD(e){return e&&e.type?"algorithmic"===e.type?XD.fromJSON(e):"multipart"===e.type?YD.fromJSON(e):null:null}var eF;const tF=new ee({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),iF=new ee({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),rF=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let sF=eF=class extends Ko{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return QD(e)}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new eF({classificationMethod:this.classificationMethod,colorRamp:H(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:H(this.field1),field2:H(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map((e=>e.clone())),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme})}};Q([ro({type:tF.apiValues,value:null,json:{type:tF.jsonValues,read:tF.read,write:tF.write,origins:{"web-document":{default:"manual",type:tF.jsonValues,read:tF.read,write:tF.write}}}})],sF.prototype,"classificationMethod",null),Q([ro({types:ZD,json:{write:!0}})],sF.prototype,"colorRamp",void 0),Q([sa("colorRamp")],sF.prototype,"readColorRamp",null),Q([ro({type:[String],value:null,json:{write:!0}})],sF.prototype,"fields",null),Q([ro({type:DD,value:null,json:{write:!0}})],sF.prototype,"field1",null),Q([ro({type:DD,value:null,json:{write:!0}})],sF.prototype,"field2",null),Q([ro({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],sF.prototype,"focus",null),Q([ro({type:Number,value:null,json:{type:Yn,write:!0}})],sF.prototype,"numClasses",null),Q([ro({type:rF,json:{type:rF,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],sF.prototype,"lengthUnit",void 0),Q([ro({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],sF.prototype,"maxSliderValue",void 0),Q([ro({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],sF.prototype,"minSliderValue",void 0),Q([ro({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],sF.prototype,"statistics",null),Q([ro({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],sF.prototype,"standardDeviationInterval",null),Q([ro({type:iF.apiValues,value:null,json:{type:iF.jsonValues,read:iF.read,write:iF.write}})],sF.prototype,"type",null),Q([ro({type:[BD],json:{write:!0}})],sF.prototype,"visualVariables",void 0),Q([ro({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],sF.prototype,"univariateSymbolStyle",null),Q([ro({type:["high-to-low","above-and-below","above","below","90-10"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],sF.prototype,"univariateTheme",null),sF=eF=Q([Ro("esri.renderers.support.AuthoringInfo")],sF);var nF=sF;const oF=new ee({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary"},{ignoreUnknown:!0});let aF=class extends Ko{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};Q([ro({type:nF,json:{write:!0}})],aF.prototype,"authoringInfo",void 0),Q([ro({type:oF.apiValues,readOnly:!0,json:{type:oF.jsonValues,read:!1,write:{writer:oF.write,ignoreOrigin:!0}}})],aF.prototype,"type",void 0),aF=Q([Ro("esri.renderers.Renderer")],aF);var lF,hF=aF;let cF=lF=class extends Ko{constructor(){super(...arguments),this.title=null}clone(){return new lF({title:this.title})}};Q([ro({type:String,json:{write:!0}})],cF.prototype,"title",void 0),cF=lF=Q([Ro("esri.renderers.support.LegendOptions")],cF);var uF,pF=cF;let dF=uF=class extends pF{constructor(){super(...arguments),this.showLegend=null}clone(){return new uF({title:this.title,showLegend:this.showLegend})}};Q([ro({type:Boolean,json:{write:!0}})],dF.prototype,"showLegend",void 0),dF=uF=Q([Ro("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],dF);var fF=dF;const yF=Ne.getLogger("esri.renderers.visualVariables.VisualVariable"),gF=new ee({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let mF=class extends Ko{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(yF.error(".field: field must be a string value"),null):Ln(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};Q([ro()],mF.prototype,"index",void 0),Q([ro({type:gF.apiValues,readOnly:!0,json:{read:gF.read,write:gF.write}})],mF.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],mF.prototype,"field",void 0),Q([Ra("field")],mF.prototype,"castField",null),Q([ro({type:String,json:{write:!0}})],mF.prototype,"valueExpression",void 0),Q([ro({type:String,json:{write:!0}})],mF.prototype,"valueExpressionTitle",void 0),Q([ro({readOnly:!0})],mF.prototype,"arcadeRequired",null),Q([ro({type:fF,json:{write:!0}})],mF.prototype,"legendOptions",void 0),mF=Q([Ro("esri.renderers.visualVariables.VisualVariable")],mF);var vF,bF=mF;let wF=vF=class extends Ko{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=null==e?0:e}clone(){return new vF({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};Q([ro({type:Rv,json:{type:[Yn],write:!0}})],wF.prototype,"color",void 0),Q([ro({type:String,json:{write:!0}})],wF.prototype,"label",void 0),Q([ro({type:Number,json:{write:{allowNull:!0}}})],wF.prototype,"value",void 0),Q([na("value")],wF.prototype,"writeValue",null),wF=vF=Q([Ro("esri.renderers.visualVariables.support.ColorStop")],wF);var _F,xF=wF;let SF=_F=class extends bF{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new _F({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};Q([ro({readOnly:!0})],SF.prototype,"cache",null),Q([ro({type:["color"],json:{type:["colorInfo"]}})],SF.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],SF.prototype,"normalizationField",void 0),Q([ro({type:[xF],json:{write:!0}})],SF.prototype,"stops",null),SF=_F=Q([Ro("esri.renderers.visualVariables.ColorVariable")],SF);var MF,TF=SF;let IF=MF=class extends Ko{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return zv(t.transparency)}writeOpacity(e,t,i){t[i]=Nv(e)}clone(){return new MF({label:this.label,opacity:this.opacity,value:this.value})}};Q([ro({type:String,json:{write:!0}})],IF.prototype,"label",void 0),Q([ro({type:Number,json:{type:Yn,write:{target:"transparency"}}})],IF.prototype,"opacity",void 0),Q([sa("opacity",["transparency"])],IF.prototype,"readOpacity",null),Q([na("opacity")],IF.prototype,"writeOpacity",null),Q([ro({type:Number,json:{write:!0}})],IF.prototype,"value",void 0),IF=MF=Q([Ro("esri.renderers.visualVariables.support.OpacityStop")],IF);var EF,AF=IF;let PF=EF=class extends bF{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)),this._set("stops",e)}clone(){return new EF({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map((e=>e.clone())),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};Q([ro({readOnly:!0})],PF.prototype,"cache",null),Q([ro({type:["opacity"],json:{type:["transparencyInfo"]}})],PF.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],PF.prototype,"normalizationField",void 0),Q([ro({type:[AF],json:{write:!0}})],PF.prototype,"stops",null),PF=EF=Q([Ro("esri.renderers.visualVariables.OpacityVariable")],PF);var CF,OF=PF;let kF=CF=class extends bF{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const e=`visualVariables[${this.index}]`;r.messages.push(new Be("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:e+".valueExpressionTitle",context:r}))}}clone(){return new CF({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};Q([ro({readOnly:!0})],kF.prototype,"cache",null),Q([ro({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],kF.prototype,"axis",void 0),Q([ro({type:["rotation"],json:{type:["rotationInfo"]}})],kF.prototype,"type",void 0),Q([ro({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],kF.prototype,"rotationType",void 0),Q([ro({type:String,json:{write:!0}})],kF.prototype,"valueExpressionTitle",void 0),Q([na("web-scene","valueExpressionTitle")],kF.prototype,"writeValueExpressionTitleWebScene",null),kF=CF=Q([Ro("esri.renderers.visualVariables.RotationVariable")],kF);var LF,RF=kF;let DF=LF=class extends Ko{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new LF({label:this.label,size:this.size,value:this.value})}};Q([ro({type:String,json:{write:!0}})],DF.prototype,"label",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],DF.prototype,"size",void 0),Q([ro({type:Number,json:{write:!0}})],DF.prototype,"value",void 0),DF=LF=Q([Ro("esri.renderers.visualVariables.support.SizeStop")],DF);var FF,jF=DF;let NF=FF=class extends fF{constructor(){super(...arguments),this.customValues=null}clone(){return new FF({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};Q([ro({type:[Number],json:{write:!0}})],NF.prototype,"customValues",void 0),NF=FF=Q([Ro("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],NF);var zF=NF;function VF(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function UF(e){return null!=e&&!isNaN(e)&&isFinite(e)}function GF(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}const BF={inches:FA(1,"meters","inches"),feet:FA(1,"meters","feet"),"us-feet":FA(1,"meters","us-feet"),yards:FA(1,"meters","yards"),miles:FA(1,"meters","miles"),"nautical-miles":FA(1,"meters","nautical-miles"),millimeters:FA(1,"meters","millimeters"),centimeters:FA(1,"meters","centimeters"),decimeters:FA(1,"meters","decimeters"),meters:FA(1,"meters","meters"),kilometers:FA(1,"meters","kilometers"),"decimal-degrees":1/jA(1,"meters",Fa.radius)},qF=Ne.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),HF=new fE,WF=Math.PI,$F=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function JF(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"color"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.ColorVariable"!==r.declaredClass)return void qF.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s="number"==typeof t,n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:h,hasExpression:c}=r.cache;let u=r.cache.compiledFunc;if(!l&&!c){const e=r.stops;return e&&e[0]&&e[0].color}if("number"!=typeof a)if(c){if(!m(i)||!m(i.arcade))return void qF.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),o=t.createExecContext(n,s);if(!u){const e=t.createSyntaxTree(r.valueExpression);u=t.createFunction(e),r.cache.compiledFunc=u}a=t.executeFunction(u,o)}else o&&(a=o[l]);const p=r.normalizationField,d=o?parseFloat(o[p]):void 0;if(null!=a&&(!p||s||!isNaN(d)&&0!==d)){isNaN(d)||s||(a/=d);const e=ij(a,h);if(e){const t=e[0],s=e[1],n=t===s?r.stops[t].color:Rv.blendColors(r.stops[t].color,r.stops[s].color,e[2],m(i)?i.color:void 0);return new Rv(n)}}}function XF(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"opacity"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.OpacityVariable"!==r.declaredClass)return void qF.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s="number"==typeof t,n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:h,hasExpression:c}=r.cache;let u=r.cache.compiledFunc;if(!l&&!c){const e=r.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof a)if(c){if(v(i)||v(i.arcade))return void qF.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),o=t.createExecContext(n,s);if(!u){const e=t.createSyntaxTree(r.valueExpression);u=t.createFunction(e),r.cache.compiledFunc=u}a=t.executeFunction(u,o)}else o&&(a=o[l]);const p=r.normalizationField,d=o?parseFloat(o[p]):void 0;if(null!=a&&(!p||s||!isNaN(d)&&0!==d)){isNaN(d)||s||(a/=d);const e=ij(a,h);if(e){const t=e[0],i=e[1];if(t===i)return r.stops[t].opacity;{const s=r.stops[t].opacity;return s+(r.stops[i].opacity-s)*e[2]}}}}function KF(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"rotation"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.RotationVariable"!==r.declaredClass)return void qF.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n="heading"===s&&"arithmetic"===r.rotationType?90:0,o="heading"===s&&"arithmetic"===r.rotationType?-1:1,a="number"==typeof t?null:t,l=a&&a.attributes,h=r.field,{hasExpression:c}=r.cache;let u=r.cache.compiledFunc,p=0;if(!h&&!c)return p;if(c){if(v(i)||v(i.arcade))return void qF.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,s=t.getViewInfo(e),n=t.createExecContext(a,s);if(!u){const e=t.createSyntaxTree(r.valueExpression);u=t.createFunction(e),r.cache.compiledFunc=u}p=t.executeFunction(u,n)}else l&&(p=l[h]||0);return p="number"!=typeof p||isNaN(p)?null:n+o*p,p}function YF(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.filter((e=>"size"===e.type))[0]:e;if(!r)return;if("esri.renderers.visualVariables.SizeVariable"!==r.declaredClass)return void qF.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=ej(function(e,t,i){const r="number"==typeof t,s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const t=m(i)?i.scale:void 0,r=m(i)?i.view:void 0;o=null==t||"3d"===r?function(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}(e):t}else if(!r)switch(e.inputValueType){case"expression":{if(v(i)||v(i.arcade))return void qF.error("Use of arcade expressions requires an arcade context");const t={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},r=i.arcade.arcadeUtils,n=r.getViewInfo(t),a=r.createExecContext(s,n);if(!l){const t=r.createSyntaxTree(e.valueExpression);l=r.createFunction(t),e.cache.compiledFunc=l}o=r.executeFunction(l,a);break}case"field":n&&(o=n[e.field]);break;case"unknown":o=null}if(!UF(o))return null;if(r||!e.normalizationField)return o;const h=n?parseFloat(n[e.normalizationField]):null;return UF(h)&&0!==h?o/h:null}(r,t,i),r,t,i,r.cache.ipData);return null==s||isNaN(s)?0:s}function ZF(e,t,i){return null==e?null:VF(e)?YF(e,t,i):UF(e)?e:null}function QF(e,t,i){return UF(i)&&e>i?i:UF(t)&&e<t?t:e}function ej(e,t,i,r,s){switch(t.transformationType){case"additive":return function(e,t,i,r){return e+(ZF(t.minSize,i,r)||t.minDataValue)}(e,t,i,r);case"constant":return function(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return null==s&&(s=e.minSize),ZF(s,t,i)}(t,i,r);case"clamped-linear":return function(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=ZF(t.minSize,i,r),o=ZF(t.maxSize,i,r),a=m(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if("area"===t.scaleBy&&a){const e="circle"===a,t=e?WF*(n/2)**2:n*n,i=t+s*((e?WF*(o/2)**2:o*o)-t);return e?2*Math.sqrt(i/WF):Math.sqrt(i)}return n+s*(o-n)}(e,t,i,r);case"proportional":return function(e,t,i,r){const s=m(r)?r.shape:void 0,n=e/t.minDataValue,o=ZF(t.minSize,i,r),a=ZF(t.maxSize,i,r);let l=null;return l="circle"===s?2*Math.sqrt(n*(o/2)**2):"square"===s||"diamond"===s||"image"===s?Math.sqrt(n*o**2):n*o,QF(l,o,a)}(e,t,i,r);case"stops":return function(e,t,i,r,s){const[n,o,a]=ij(e,s);if(n===o)return ZF(t.stops[n].size,i,r);{const e=ZF(t.stops[n].size,i,r);return e+(ZF(t.stops[o].size,i,r)-e)*a}}(e,t,i,r,s);case"real-world-size":return function(e,t,i,r){const s=(m(r)&&r.resolution?r.resolution:1)*BF[t.valueUnit],n=ZF(t.minSize,i,r),o=ZF(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l="area"===a?2*Math.sqrt(e/WF)/s:"radius"===a||"distance"===a?2*e/s:e/s,QF(l,n,o)}(e,t,i,r);case"identity":return e;case"unknown":return null}}function tj(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&"3d"===i||t))return null;const s={scale:t,view:i};let n=ZF(e.minSize,HF,s),o=ZF(e.maxSize,HF,s);if(null!=n||null!=o){if(n>o){const e=o;o=n,n=e}return{minSize:n,maxSize:o}}}function ij(e,t){if(!t)return;let i=0,r=t.length-1;return t.some(((t,s)=>e<t?(r=s,!0):(i=s,!1))),[i,r,(e-t[i])/(t[r]-t[i])]}function rj(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const e=s.useSymbolValue?"symbol-value":YF(s,t,i);switch(s.axis){case"width":r[0]=e;break;case"depth":r[1]=e;break;case"height":r[2]=e;break;case"width-and-depth":r[0]=e,r[1]=e;break;case"all":case void 0:case null:r[0]=e,r[1]=e,r[2]=e;break;default:s.axis}}return r}var sj,nj=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getAllSizes:rj,getColor:JF,getOpacity:XF,getRotationAngle:KF,getSize:YF,getSizeForValue:ej,getSizeFromNumberOrVariable:ZF,getSizeRangeAtScale:tj,getVisualVariableValues:function(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach((e=>{const s=JF(e,t,i);r.push({variable:e,value:s})})),n.forEach((e=>{const s=XF(e,t,i);r.push({variable:e,value:s})})),a.forEach((e=>{const s=KF(e,t,i);r.push({variable:e,value:s})})),o.forEach((e=>{const s=YF(e,t,i);r.push({variable:e,value:s})})),r.filter((e=>null!=e.value))},viewScaleRE:$F});const oj=Ne.getLogger("esri.renderers.visualVariables.SizeVariable"),aj=new ee({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),lj=new ee({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function hj(e){if(null!=e)return"string"==typeof e||"number"==typeof e?DS(e):"size"===e.type?VF(e)?e:(delete(e=a({},e)).type,new uj(e)):void 0}function cj(e,t,i){if("object"!=typeof e)return e;const r=new uj;return r.read(e,i),r}let uj=sj=class extends bF{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:$F.test(this.valueExpression)}}set expression(e){oj.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===e?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){VF(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),VF(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return GF(this)}set maxDataValue(e){e&&this.stops&&(oj.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(oj.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return hj(e)}readMaxSize(e,t,i){return cj(e,0,i)}set minDataValue(e){e&&this.stops&&(oj.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(oj.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return hj(e)}readMinSize(e,t,i){return cj(e,0,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter((e=>!!e))).sort(((e,t)=>e.value-t.value)):e&&(oj.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return function(e,t){const i=t||GF(e),r=e.valueUnit||"unknown";return"unknown"===i?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===r?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"}(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if("$view.scale"===e){if(r&&r.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;r.messages.push(new Be("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?lj.read(e):null}clone(){return new sj({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:VF(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:VF(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((e=>e.clone())),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if("clamped-linear"===this.transformationType){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if("stops"===this.transformationType){const e=this.stops,t=e.map((e=>e.size)).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map((e=>e.value||0))}};Q([ro({readOnly:!0})],uj.prototype,"cache",null),Q([ro({type:aj.apiValues,json:{type:aj.jsonValues,origins:{"web-map":{read:!1}},read:aj.read,write:aj.write}})],uj.prototype,"axis",void 0),Q([ro({type:String,value:null,json:{read:!1}})],uj.prototype,"expression",null),Q([ro()],uj.prototype,"index",null),Q([ro({type:String,readOnly:!0})],uj.prototype,"inputValueType",null),Q([ro({type:zF,json:{write:!0}})],uj.prototype,"legendOptions",void 0),Q([ro({type:Number,value:null,json:{write:!0}})],uj.prototype,"maxDataValue",null),Q([ro({type:Number,value:null,json:{write:!0}})],uj.prototype,"maxSize",null),Q([Ra("maxSize")],uj.prototype,"castMaxSize",null),Q([sa("maxSize")],uj.prototype,"readMaxSize",null),Q([ro({type:Number,value:null,json:{write:!0}})],uj.prototype,"minDataValue",null),Q([ro({type:Number,value:null,json:{write:!0}})],uj.prototype,"minSize",null),Q([Ra("minSize")],uj.prototype,"castMinSize",null),Q([sa("minSize")],uj.prototype,"readMinSize",null),Q([ro({type:String,json:{write:!0}})],uj.prototype,"normalizationField",void 0),Q([ro({readOnly:!0})],uj.prototype,"arcadeRequired",null),Q([ro({type:String})],uj.prototype,"scaleBy",void 0),Q([ro({type:[jF],value:null,json:{write:!0}})],uj.prototype,"stops",null),Q([ro({type:["outline"],json:{write:!0}})],uj.prototype,"target",void 0),Q([ro({type:String,readOnly:!0})],uj.prototype,"transformationType",null),Q([ro({type:["size"],json:{type:["sizeInfo"]}})],uj.prototype,"type",void 0),Q([ro({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],uj.prototype,"useSymbolValue",void 0),Q([ro({type:String,json:{write:!0}})],uj.prototype,"valueExpression",void 0),Q([sa("valueExpression",["valueExpression","expression"])],uj.prototype,"readValueExpression",null),Q([na("web-scene","valueExpression")],uj.prototype,"writeValueExpressionWebScene",null),Q([ro({type:["radius","diameter","area","width","distance"],json:{write:!0}})],uj.prototype,"valueRepresentation",void 0),Q([ro({type:lj.apiValues,json:{write:lj.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],uj.prototype,"valueUnit",void 0),Q([sa("valueUnit")],uj.prototype,"readValueUnit",null),uj=sj=Q([Ro("esri.renderers.visualVariables.SizeVariable")],uj);var pj=uj;const dj=Ne.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),fj={color:TF,size:pj,opacity:OF,rotation:RF},yj=new ee({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),gj=/^\[([^\]]+)\]$/i;let mj=class extends jo{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter((e=>!!e)))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some((e=>!!e.target))&&e.sort(((e,t)=>{let i=null;return i=e.target===t.target?0:e.target?1:-1,i}));for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(gj),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map((e=>{const t=yj.read(e.type),r=fj[t];r||(dj.warn(`Unknown variable type: ${t}`),i&&i.messages&&i.messages.push(new oo("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:i})));const s=new r;return s.read(e,i),s}))}writeVariables(e,t){const i=[];for(const r of e){const e=r.toJSON(t);e&&i.push(e)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};Q([ro()],mj.prototype,"visualVariables",null),mj=Q([Ro("esri.renderers.visualVariables.VisualVariableFactory")],mj);var vj=mj;const bj={base:bF,key:"type",typeMap:{opacity:OF,color:TF,rotation:RF,size:pj}},wj=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new vj}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,i){return this._vvFactory.readVariables(e,t,i)}writeVisualVariables(e,t,i,r){t[i]=this._vvFactory.writeVariables(e,r)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const e of this.visualVariables)if(e.arcadeRequired)return!0;return!1}hasVisualVariables(e,t){return e?!!this.getVisualVariablesForType(e,t):!!(this.getVisualVariablesForType("size",t)||this.getVisualVariablesForType("color",t)||this.getVisualVariablesForType("opacity",t)||this.getVisualVariablesForType("rotation",t))}getVisualVariablesForType(e,t){const i=this.visualVariables;if(!i)return;const r=i.filter((i=>i.type===e&&("string"==typeof t?i.target===t:!1!==t||!i.target)));return r&&0===r.length?void 0:r}async collectVVRequiredFields(e,t){let i=[];this.visualVariables&&(i=i.concat(this.visualVariables));for(const r of i)r&&(r.field&&f_(e,t,r.field),r.normalizationField&&f_(e,t,r.normalizationField),r.valueExpression&&await g_(e,t,r.valueExpression))}};return Q([ro({types:[bj],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),Q([sa("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),Q([na("visualVariables")],t.prototype,"writeVisualVariables",null),t=Q([Ro("esri.renderers.mixins.VisualVariablesMixin")],t),t};function _j(e,t=!1,i=!1,r=!0){if(!e)return{symbol:null};let s;if(tE(e)||e instanceof QI)s=e.clone();else if("cim"===e.type)s=RI.fromCIMSymbol(e);else if(e instanceof fM)s=dI.fromSimpleLineSymbol(e);else if(e instanceof $I)s=RI.fromSimpleMarkerSymbol(e);else if(e instanceof PI)s=RI.fromPictureMarkerSymbol(e);else if(e instanceof BI)s=zI.fromSimpleFillSymbol(e);else{if(!(e instanceof KI))return{error:new Be("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};s=r?hI.fromTextSymbol(e):RI.fromTextSymbol(e)}if(t&&(s.id=e.id),i&&tE(s))for(let n=0;n<s.symbolLayers.length;++n)s.symbolLayers.getItemAt(n)._ignoreDrivers=!0;return{symbol:s}}function xj(e,t,i,r){const s=function(e,t,i){if(!e)return null;if(i&&"web-scene"===i.origin&&!(e instanceof qT)&&!(e instanceof QI)){const r="cim"!==e.type?_j(e):{symbol:null,error:new Be("symbol-conversion:unsupported-cim-symbol","CIM symbol is unsupported in web scenes",{symbol:e})};return r.symbol?r.symbol.write(t,i):(i.messages&&i.messages.push(new Be("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:i,error:r.error})),null)}return i&&"web-map"===i.origin&&"web-style"===e.type?(i.messages&&i.messages.push(new Be("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in webmaps. Use CIMSymbol instead when working with WebMap in MapView.`,{symbol:e,context:i})),null):e.write(t,i)}(e,{},r);s&&(t[i]=s)}function Sj(e,t){return sE(e,null,t)}var Mj;let Tj=Mj=class extends Ko{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new Mj({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};Q([ro({type:String,json:{write:!0}})],Tj.prototype,"description",void 0),Q([ro({type:String,json:{write:!0}})],Tj.prototype,"label",void 0),Q([ro({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Tj.prototype,"minValue",void 0),Q([ro({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Tj.prototype,"maxValue",void 0),Q([ro({types:nE,json:{origins:{"web-scene":{types:aE,write:xj}},write:xj}})],Tj.prototype,"symbol",void 0),Tj=Mj=Q([Ro("esri.renderers.support.ClassBreakInfo")],Tj);var Ij=Tj;const Ej={types:nE,json:{write:{writer:xj},origins:{"web-scene":{types:aE,write:{writer:xj}}}}},Aj={types:{base:ES,key:"type",typeMap:{"simple-fill":iE.typeMap["simple-fill"],"picture-fill":iE.typeMap["picture-fill"],"polygon-3d":iE.typeMap["polygon-3d"]}},json:{write:{writer:xj},origins:{"web-scene":{type:zI,write:{writer:xj}}}}};var Pj;const Cj=Ne.getLogger("esri.renderers.ClassBreaksRenderer"),Oj="percent-of-total",kj="field",Lj=new ee({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:Oj,esriNormalizeByField:kj}),Rj=qn(Ij);let Dj=Pj=class extends(wj(hF)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map((e=>{const t=new Ij;return t.read(e,i),null==t.minValue&&(t.minValue=r),null==t.maxValue&&(t.maxValue=t.minValue),r=t.maxValue,t}))}writeClassBreakInfos(e,t,i,r){const s=e.map((e=>e.write({},r)));this._areClassBreaksConsecutive()&&s.forEach((e=>delete e.classMinValue)),t[i]=s}castField(e){return null==e?e:"function"==typeof e?(Cj.error(".field: field must be a string value"),null):Ln(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=null!=this.normalizationTotal;return t||i?(e=(t?kj:i&&Oj)||null,t&&i&&Cj.warn("warning: both normalizationField and normalizationTotal are set!")):e!==kj&&e!==Oj||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r="number"==typeof e?new Ij({minValue:e,maxValue:t,symbol:hE(i)}):Rj(H(e)),this.classBreakInfos.push(r),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]===e&&i[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(v(t)||v(t.arcade))&&Cj.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(v(t)||v(t.arcade))&&(i=l(a({},i),{arcade:await i_()}));const r=this.getBreakIndex(e,i);return-1!==r?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(v(t)||v(t.arcade)))return void Cj.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(v(t)||v(t.arcade))){const e=await i_(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),i=l(a({},i),{arcade:e})}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new Pj({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:H(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:H(this.visualVariables),legendOptions:H(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map((i=>i.collectRequiredFields(e,t))),g_(e,t,this.valueExpression)];f_(e,t,this.field),f_(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=S(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const e=a.createSyntaxTree(this.valueExpression);o=a.createFunction(e),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const e=this.normalizationTotal,t=parseFloat(i[this.normalizationField]);if("log"===r)s=Math.log(s)*Math.LOG10E;else if(r!==Oj||isNaN(e)){if(r===kj&&!isNaN(t)){if(isNaN(s)||isNaN(t))return-1;s/=t}}else s=s/e*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};Q([ro(Aj)],Dj.prototype,"backgroundFillSymbol",void 0),Q([ro({type:[Ij]})],Dj.prototype,"classBreakInfos",void 0),Q([sa("classBreakInfos")],Dj.prototype,"readClassBreakInfos",null),Q([na("classBreakInfos")],Dj.prototype,"writeClassBreakInfos",null),Q([ro({type:String,json:{write:!0}})],Dj.prototype,"defaultLabel",void 0),Q([ro(Ej)],Dj.prototype,"defaultSymbol",void 0),Q([ro({type:String,json:{write:!0}})],Dj.prototype,"field",void 0),Q([Ra("field")],Dj.prototype,"castField",null),Q([ro({type:Boolean})],Dj.prototype,"isMaxInclusive",void 0),Q([ro({type:pF,json:{write:!0}})],Dj.prototype,"legendOptions",void 0),Q([ro({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Dj.prototype,"minValue",null),Q([ro({type:String,json:{write:!0}})],Dj.prototype,"normalizationField",void 0),Q([ro({type:Number,cast:e=>Rn(e),json:{write:!0}})],Dj.prototype,"normalizationTotal",void 0),Q([ro({type:Lj.apiValues,value:null,json:{type:Lj.jsonValues,read:Lj.read,write:Lj.write}})],Dj.prototype,"normalizationType",null),Q([th({classBreaks:"class-breaks"})],Dj.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],Dj.prototype,"valueExpression",void 0),Q([ro({type:String,json:{write:!0}})],Dj.prototype,"valueExpressionTitle",void 0),Dj=Pj=Q([Ro("esri.renderers.ClassBreaksRenderer")],Dj);var Fj=Dj;class jj{constructor(e,t,i){this._namespace=e,this._storage=t,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",i&&(this._storage.registerRemoveFunc(this._namespace,i),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(e,t,i,r=0){this._storage.put(this._namespace+e,t,i,r)}get(e){const t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}pop(e){const t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}updateSize(e,t,i){this._storage.updateSize(this._namespace+e,t,i)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class Nj{constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new Us,this._users=new Us}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}put(e,t,i,r){const s=this._db.get(e);if(s&&(this._size-=s.size,this._db.delete(e),s.entry!==t&&this._notifyRemoved(e,s.entry)),i>this._maxSize)return void this._notifyRemoved(e,t);if(void 0===t)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return void console.warn("Refusing to cache entry with invalid size "+i);const n=1+Math.max(r,-3)- -3;this._db.set(e,{entry:t,size:i,lifetime:n,lives:n}),this._size+=i,this._checkSizeLimit()}updateSize(e,t,i){const r=this._db.get(e);if(r&&r.entry===t){if(this._size-=r.size,i>this._maxSize)return this._db.delete(e),void this._notifyRemoved(e,t);r.size=i,this._size+=i,this._checkSizeLimit()}}pop(e){const t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}get(e){const t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}getStats(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach(((e,r)=>{const s=e.lifetime;i[s]=(i[s]||0)+e.size,this._users.forAll((i=>{const s=i.namespace;if(r.startsWith(s)){const i=t[s]||0;t[s]=i+e.size}}))}));const r={};this._users.forAll((e=>{const i=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){const s=t[i]||0;t[i]=s,r[i]=Math.round(100*e.hitRate)+"%"}else r[i]="0%"}));const s=Object.keys(t);s.forEach((e=>t[e]=t[e]/this._size*100)),s.sort(((e,i)=>t[i]-t[e])),s.forEach((i=>e[i]=Math.round(t[i])+"% / "+r[i]));for(let n=i.length-1;n>=0;--n){const t=i[n];t&&(e["Priority "+(n+-3-1)]=Math.round(t/this.size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){this._db.forEach(((t,i)=>{i.startsWith(e)&&(this._size-=t.size,this._db.delete(i),this._notifyRemoved(i,t.entry))}))}clearAll(){this._db.forEach(((e,t)=>this._notifyRemoved(t,e.entry))),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemoved(e,t){this._removeFuncs.forAll((i=>{e.startsWith(i[0])&&i[1](t)}))}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[e,t]of this._db)if(this._db.delete(e),t.lives<=1?(this._size-=t.size,this._notifyRemoved(e,t.entry)):(--t.lives,this._db.set(e,t)),this._size<=.9*this.maxSize)return}}class zj{constructor(e,t){this._storage=new Nj,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t,i){this._storage.put(e,t,i,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}}var Vj;const Uj=Ne.getLogger("esri.renderers.DictionaryRenderer"),Gj={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Bj=Vj=class extends(wj(hF)){constructor(e){super(e),this._ongoingRequests=new Map,this._symbolCache=new zj(100),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){null!=r&&r.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new Vj({config:H(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:H(this.fieldMap),url:H(this.url),visualVariables:H(this.visualVariables)})}async getSymbolAsync(e,t){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(t));try{i=await this._dictionaryPromise}catch(p){if(ht(p))return this._dictionaryPromise=null,null}const r={};if(this.fieldMap)for(const d of this._symbolFields){const t=this.fieldMap[d];if(t&&null!==e.attributes[t]&&void 0!==e.attributes[t]){const i=""+e.attributes[t];r[d]=i}else r[d]=""}const s=i(r,t);if(!s||"string"!=typeof s)return null;const n=De(s).toString(),o=this._symbolCache.get(n);if(o)return o.catch((()=>{this._symbolCache.pop(n)})),o;const a=s.split(";"),l=[],h=[];for(const d of a)if(d&&0!==d.length)if(-1===d.indexOf("po:"))if(-1!==d.indexOf("|"))for(const e of d.split("|"))this._itemNames.has(e)&&l.push(e);else this._itemNames.has(d)&&l.push(d);else{const e=d.substr(3).split("|");if(3===e.length){const t=e[0],i=e[1];let r=e[2];if("DashTemplate"===i)r=r.split(" ").map((e=>Number(e)));else if("Color"===i){const e=new Rv(r).toRgba();r=[e[0],e[1],e[2],255*e[3]]}else r=Number(r);h.push({primitiveName:t,propertyName:i,value:r})}}const c=!m(e.geometry)||!e.geometry.hasZ&&"point"===e.geometry.type,u=this._cimPartsToCIMSymbol(l,h,c,t);return this._symbolCache.put(n,u,1),u}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await g_(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void Uj.error("no valid URL!");const t=m(e)?e.abortOptions:null,i=$i(this.url+"/resources/styles/dictionary-info.json",a({responseType:"json",query:{f:"json"}},t)),[{data:r}]=await Promise.all([i,i_()]);if(!r)throw this._dictionaryPromise=null,new Be("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const e=this.config;for(const t in e)o[t]=e[t]}if(n.configuration)for(const a of n.configuration)o.hasOwnProperty(a.name)||(o[a.name]=a.value);const h=[];if(m(e)&&e.fields&&this.fieldMap)for(const c of this._symbolFields){const t=this.fieldMap[c],i=e.fields.filter((e=>e.name===t));i.length>0&&h.push(l(a({},i[0]),{name:c}))}return this._dictionaryPromise=((e,t,i,r)=>n_.create(e,t,i,r,["$feature","$view"]))(s,m(e)?e.spatialReference:null,h,o).then((e=>{const t={scale:0};return(i,r)=>{const s=e.repurposeFeature({geometry:null,attributes:i});return t.scale=m(r)?r.scale:void 0,e.evaluate({$feature:s,$view:t})}})).catch((e=>(Uj.error("Creating dictinoary expression failed:",e),null))),this._dictionaryPromise}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._symbolFields}async _getSymbolPart(e,t){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const i=$i(this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,e),a({responseType:"json",query:{f:"json"}},t));this._ongoingRequests.set(e,i);try{return(await i).data}catch(ia){return this._ongoingRequests.delete(e),Promise.reject(ia)}}_combineSymbolParts(e,t,i){if(!e||0===e.length)return null;const r=a({},e[0]);if(e.length>1){r.symbolLayers=[];for(const t of e){const e=t;r.symbolLayers.unshift(...e.symbolLayers)}}return i&&(r.callout=Gj),{type:"CIMSymbolReference",symbol:r,primitiveOverrides:t}}async _cimPartsToCIMSymbol(e,t,i,r){const s=new Array(e.length);for(let o=0;o<e.length;o++)s[o]=this._getSymbolPart(e[o],r);const n=await Promise.all(s);return new PS({data:this._combineSymbolParts(n,t,i)})}};Q([ro({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],Bj.prototype,"config",void 0),Q([ro({type:Object,json:{write:!0}})],Bj.prototype,"fieldMap",void 0),Q([ro({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],Bj.prototype,"scaleExpression",void 0),Q([na("scaleExpression")],Bj.prototype,"writeData",null),Q([ro({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],Bj.prototype,"scaleExpressionTitle",void 0),Q([ro({type:String,json:{write:!0}})],Bj.prototype,"url",void 0),Q([na("visualVariables")],Bj.prototype,"writeVisualVariables",null),Bj=Vj=Q([Ro("esri.renderers.DictionaryRenderer")],Bj);var qj,Hj=Bj,Wj=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Hj});const $j=Ne.getLogger("esri.renderers.support.AttributeColorInfo");let Jj=qj=class extends Ko{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?($j.error(".field: field must be a string value"),null):Ln(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new qj({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};Q([ro({type:Rv,json:{type:[Number],write:!0}})],Jj.prototype,"color",void 0),Q([ro({type:String,json:{write:!0}})],Jj.prototype,"field",void 0),Q([Ra("field")],Jj.prototype,"castField",null),Q([ro({type:String,json:{write:!0}})],Jj.prototype,"label",void 0),Q([ro({type:String,json:{write:!0}})],Jj.prototype,"valueExpression",void 0),Q([ro({type:String,json:{write:!0}})],Jj.prototype,"valueExpressionTitle",void 0),Jj=qj=Q([Ro("esri.renderers.support.AttributeColorInfo")],Jj);var Xj,Kj=Jj;let Yj=Xj=class extends Ko{constructor(){super(...arguments),this.unit=null}clone(){return new Xj({unit:this.unit})}};Q([ro({type:String,json:{write:!0}})],Yj.prototype,"unit",void 0),Yj=Xj=Q([Ro("esri.renderers.support.DotDensityLegendOptions")],Yj);var Zj,Qj=Yj;let eN=Zj=class extends(wj(hF)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new Rv([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new fM,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new BI({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Zj({attributes:H(this.attributes),backgroundColor:H(this.backgroundColor),dotBlendingEnabled:H(this.dotBlendingEnabled),dotShape:H(this.dotShape),dotSize:H(this.dotSize),dotValue:H(this.dotValue),legendOptions:H(this.legendOptions),outline:H(this.outline),referenceScale:H(this.referenceScale),visualVariables:H(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map((e=>e.field||e.valueExpression||""))}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await g_(e,t,i.valueExpression),i.field&&e.add(i.field)}};Q([ro({type:[Kj],json:{write:!0}})],eN.prototype,"attributes",void 0),Q([ro({type:Rv,json:{write:!0}})],eN.prototype,"backgroundColor",void 0),Q([ro({type:Boolean}),eh("dotBlendingEnabled")],eN.prototype,"blendDots",void 0),Q([ro({type:Boolean,json:{write:!0}})],eN.prototype,"dotBlendingEnabled",void 0),Q([ro({type:String,json:{write:!1}})],eN.prototype,"dotShape",void 0),Q([ro({type:Number,json:{write:!1}})],eN.prototype,"dotSize",void 0),Q([ro({type:Qj,json:{write:!0}})],eN.prototype,"legendOptions",void 0),Q([ro({type:fM,json:{default:null,write:!0}})],eN.prototype,"outline",void 0),Q([ro({type:Number,json:{write:!0}})],eN.prototype,"dotValue",void 0),Q([ro({type:Number}),eh("dotValue")],eN.prototype,"referenceDotValue",void 0),Q([ro({type:Number,json:{write:!0}})],eN.prototype,"referenceScale",void 0),Q([ro({type:Number,json:{write:!0}})],eN.prototype,"seed",void 0),Q([th({dotDensity:"dot-density"})],eN.prototype,"type",void 0),eN=Zj=Q([Ro("esri.renderers.DotDensityRenderer")],eN);var tN,iN=eN;let rN=tN=class extends Ko{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new tN({color:this.color,ratio:this.ratio})}};Q([ro({type:Rv,json:{write:!0}})],rN.prototype,"color",void 0),Q([ro({type:Number,json:{write:!0}})],rN.prototype,"ratio",void 0),rN=tN=Q([Ro("esri.renderers.support.HeatmapColorStop")],rN);var sN,nN=rN;let oN=sN=class extends hF{constructor(e){super(e),this.blurRadius=10,this.colorStops=[new nN({ratio:0,color:new Rv("rgba(255, 140, 0, 0)")}),new nN({ratio:.75,color:new Rv("rgba(255, 140, 0, 1)")}),new nN({ratio:.9,color:new Rv("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.maxPixelIntensity=100,this.minPixelIntensity=0,this.type="heatmap"}async collectRequiredFields(e,t){const i=this.field;i&&"string"==typeof i&&f_(e,t,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new sN({blurRadius:this.blurRadius,colorStops:H(this.colorStops),field:this.field,maxPixelIntensity:this.maxPixelIntensity,minPixelIntensity:this.minPixelIntensity})}};Q([ro({type:Number,json:{write:!0}})],oN.prototype,"blurRadius",void 0),Q([ro({type:[nN],json:{write:!0}})],oN.prototype,"colorStops",void 0),Q([ro({type:String,json:{write:!0}})],oN.prototype,"field",void 0),Q([ro({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:null==i})}}})],oN.prototype,"fieldOffset",void 0),Q([ro({type:Number,json:{write:!0}})],oN.prototype,"maxPixelIntensity",void 0),Q([ro({type:Number,json:{write:!0}})],oN.prototype,"minPixelIntensity",void 0),Q([th({heatmap:"heatmap"})],oN.prototype,"type",void 0),oN=sN=Q([Ro("esri.renderers.HeatmapRenderer")],oN);var aN,lN=oN;let hN=aN=class extends(wj(hF)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map((i=>i.collectRequiredFields(e,t))))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return this.getSymbols().reduce(((e,t)=>e+JSON.stringify(t)),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new aN({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:H(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};Q([ro({type:String,json:{write:!0}})],hN.prototype,"description",void 0),Q([ro({type:String,json:{write:!0}})],hN.prototype,"label",void 0),Q([ro(Ej)],hN.prototype,"symbol",void 0),Q([th({simple:"simple"})],hN.prototype,"type",void 0),hN=aN=Q([Ro("esri.renderers.SimpleRenderer")],hN);var cN=hN;const uN=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function pN(e){return e instanceof jo}function dN(e){return e instanceof xh?Object.keys(e.items):pN(e)?Tr(e).keys():e?Object.keys(e):[]}function fN(e,t){return e instanceof xh?e.items[t]:e[t]}function yN(e){return e?e.declaredClass:null}function gN(e,t){const i=e.diff;if(i&&"function"==typeof i)return i(e,t);const r=dN(e),s=dN(t);if(0===r.length&&0===s.length)return;if(!r.length||!s.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter((e=>-1===r.indexOf(e))),o=r.filter((e=>-1===s.indexOf(e))),a=r.filter((i=>s.indexOf(i)>-1&&fN(e,i)!==fN(t,i))).concat(n,o).sort(),l=yN(e);if(l&&uN.indexOf(l)>-1&&a.length)return{type:"complete",oldValue:e,newValue:t};let h;const c=pN(e)&&pN(t);for(const u of a){const r=fN(e,u),s=fN(t,u);let n;(c||"function"!=typeof r&&"function"!=typeof s)&&r!==s&&(null==r&&null==s||(n=i&&i[u]&&"function"==typeof i[u]?i[u](r,s):"object"==typeof r&&"object"==typeof s&&yN(r)===yN(s)?gN(r,s):{type:"complete",oldValue:r,newValue:s},m(n)&&(m(h)?h.diff[u]=n:h={type:"partial",diff:{[u]:n}})))}return h}function mN(e,t){if(v(e))return!1;const i=t.split(".");let r=e;for(const s of i){if("complete"===r.type)return!0;if("partial"!==r.type)return!1;{const e=r.diff[s];if(!e)return!1;r=e}}return!0}function vN(e,t){for(const i of t)if(mN(e,i))return!0;return!1}function bN(e,t){if("function"!=typeof e&&"function"!=typeof t&&(e||t))return!e||!t||"object"==typeof e&&"object"==typeof t&&yN(e)!==yN(t)?{type:"complete",oldValue:e,newValue:t}:gN(e,t)}function wN(e){if(v(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const e of t.added)if(!wN(e))return!1;for(const e of t.removed)if(!wN(e))return!1;for(const e of t.changed)if(!wN(e))return!1;return!0}case"partial":for(const t in e.diff)if(!wN(e.diff[t]))return!1;return!0}}var _N;let xN=_N=class extends Ko{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new _N({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};Q([ro({type:String,json:{write:!0}})],xN.prototype,"description",void 0),Q([ro({type:String,json:{write:!0}})],xN.prototype,"label",void 0),Q([ro({types:nE,json:{origins:{"web-scene":{types:aE,write:xj}},write:xj}})],xN.prototype,"symbol",void 0),Q([ro({type:[String,Number],json:{type:String,write:{writer:(e,t)=>{t.value=null==e?void 0:e.toString()}}}})],xN.prototype,"value",void 0),xN=_N=Q([Ro("esri.renderers.support.UniqueValueInfo")],xN);var SN=xN;function MN(e,t){return e&&(t=t||h.location.hostname)?null!=t.match(TN)||null!=t.match(EN)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(IN)||null!=t.match(AN)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const TN=/^devext.arcgis.com$/,IN=/^qaext.arcgis.com$/,EN=/^[\w-]*\.mapsdevext.arcgis.com$/,AN=/^[\w-]*\.mapsqa.arcgis.com$/,PN=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,TN,IN,/^jsapps.esri.com$/,EN,AN],CN={};function ON(e,t,i){const r=t.portal||Yl.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return CN[n]||(CN[n]=function(e,t,i){return t.load(i).then((()=>{const r=new Rl({disableExtraQuery:!0,query:`owner:${jN} AND type:${NN} AND typekeywords:"${e}"`});return t.queryItems(r,i)})).then((({results:t})=>{let r=null;const s=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t)if(e.typeKeywords.some((e=>e.toLowerCase()===s))&&e.type===NN&&e.owner===jN){r=e;break}if(!r)throw new Be("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return r.load(i)}))}(e,r,i).then((e=>(s=e,e.fetchData()))).then((t=>({data:t,baseUrl:s.itemUrl,styleName:e})))),CN[n]}function kN(e,t,i){return e.styleUrl?function(e,t){return FN(e,t).then((t=>({data:t.data,baseUrl:Ti(e),styleUrl:e})))}(e.styleUrl,i):e.styleName?ON(e.styleName,t,i):Promise.reject(new Be("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function LN(e,t,i,r){return e.name?e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,i){const r=zN.replace(/\{SymbolName\}/gi,e.name);return FN(r,i).then((e=>Sj(DN(e.data),{portal:t.portal,url:$t(Ti(r)),origin:"portal-item"})))}(e,t,r):kN(e,t,r).then((s=>RN(s,e.name,t,i,r))):Promise.reject(new Be("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function RN(e,t,i,r,s){const n=e.data,o={portal:i.portal,url:$t(e.baseUrl),origin:"portal-item"},a=n.items.find((e=>e.name===t));if(!a){const e=`The symbol name '${t}' could not be found`;return Promise.reject(new Be("symbolstyleutils:symbol-name-not-found",e,{symbolName:t}))}let l=jM(function(e,t){if("cimRef"===t)return e.cimRef;if(e.formatInfos&&!y("enable-feature:force-wosr"))for(const i of e.formatInfos)if("gltf"===i.type)return i.href;return e.webRef}(a,r),o),c=a.thumbnail&&a.thumbnail.href;const u=a.thumbnail&&a.thumbnail.imageData;var p;p=p||h.location.hostname,PN.some((e=>{var t;return null!=(null==(t=p)?void 0:t.match(e))}))&&(l=MN(l),c=MN(c));const d={portal:i.portal,url:$t(Ti(l)),origin:"portal-item"};return FN(l,s).then((s=>{const n=Sj("cimRef"===r?DN(s.data):s.data,d);if(n&&tE(n)){if(c){const e=jM(c,o);n.thumbnail=new zT({url:e})}else u&&(n.thumbnail=new zT({url:`data:image/png;base64,${u}`}));e.styleUrl?n.styleOrigin=new jT({portal:i.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(n.styleOrigin=new jT({portal:i.portal,styleName:e.styleName,name:t}))}return n}))}function DN(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function FN(e,t){const i=a({responseType:"json",query:{f:"json"}},t);return $i(hi(e),i)}const jN="esri_en",NN="Style",zN="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var VN,UN=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",fetchStyle:kN,fetchSymbolFromStyle:RN,resolveWebStyleSymbol:LN,styleNameFromItem:function(e){for(const t of e.typeKeywords)if(/^Esri.*Style$/.test(t)&&"Esri Style"!==t)return t}});const GN=Ne.getLogger("esri.renderers.UniqueValueRenderer"),BN=qn(SN);let qN=VN=class extends(wj(hF)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let i=!1;const r={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<t.length;s++){const n=e.find((e=>e.value===t[s].value));n?bN(n,t[s])?(r.changed.push({type:"complete",oldValue:n,newValue:t[s]}),i=!0):r.unchanged.push({oldValue:n,newValue:t[s]}):(r.added.push(t[s]),i=!0)}for(let s=0;s<e.length;s++)t.find((t=>t.value===e[s].value))||(r.removed.push(e[s]),i=!0);return i?r:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return null==e||"function"==typeof e?e:Ln(e)}writeField(e,t,i,r){"string"==typeof e?t[i]=e:r&&r.messages?r.messages.push(new Be("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):GN.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||Yl.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=jM(t.styleUrl,i);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=NM(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?GN.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void GN.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i="object"==typeof e?BN(e):new SN({value:e,symbol:hE(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)GN.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(v(t)||v(t.arcade))&&(i=l(a({},i),{arcade:await i_()})),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(v(t)||v(t.arcade)))return void GN.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(v(i)||v(i.arcade))){const e=await i_(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),i=l(a({},i),{arcade:e})}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new VN({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:H(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:H(this.visualVariables),legendOptions:H(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:H(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=H(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(H(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map((i=>i.collectRequiredFields(e,t))),g_(e,t,this.valueExpression)];f_(e,t,this.field),f_(e,t,this.field2),f_(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return kN(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach((i=>{const r=new QI({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new SN({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s})),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach((e=>this._valueInfoMap[e.value+""]=e))}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=S(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const e=a.createSyntaxTree(this.valueExpression);o=a.createFunction(e),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if("function"!=typeof t&&this.field2){const e=this.field2,s=this.field3,n=[];t&&n.push(i[t]),e&&n.push(i[e]),s&&n.push(i[s]),r=n.join(this.fieldDelimiter||"")}else"function"==typeof t?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new VN(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||Yl.getDefault());const r=i.populateFromStyle();return r.catch((t=>{GN.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),r}static fromStyleUrl(e,t){const i=new VN(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch((t=>{GN.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),r}};Q([ro({readOnly:!0})],qN.prototype,"_cache",null),Q([th({uniqueValue:"unique-value"})],qN.prototype,"type",void 0),Q([ro(Aj)],qN.prototype,"backgroundFillSymbol",void 0),Q([ro({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],qN.prototype,"field",void 0),Q([Ra("field")],qN.prototype,"castField",null),Q([na("field")],qN.prototype,"writeField",null),Q([ro({type:String,json:{write:!0}})],qN.prototype,"field2",void 0),Q([ro({type:String,json:{write:!0}})],qN.prototype,"field3",void 0),Q([ro({type:String,json:{write:!0}})],qN.prototype,"valueExpression",void 0),Q([ro({type:String,json:{write:!0}})],qN.prototype,"valueExpressionTitle",void 0),Q([ro({type:pF,json:{write:!0}})],qN.prototype,"legendOptions",void 0),Q([ro({type:String,json:{write:!0}})],qN.prototype,"defaultLabel",void 0),Q([ro($(a({},Ej),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],qN.prototype,"defaultSymbol",null),Q([ro({type:String,json:{write:!0}})],qN.prototype,"fieldDelimiter",void 0),Q([ro({type:Yl,readOnly:!0})],qN.prototype,"portal",void 0),Q([sa("portal",["styleName"])],qN.prototype,"readPortal",null),Q([ro({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],qN.prototype,"styleOrigin",void 0),Q([sa("styleOrigin",["styleName","styleUrl"])],qN.prototype,"readStyleOrigin",null),Q([na("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],qN.prototype,"writeStyleOrigin",null),Q([ro({type:[SN],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],qN.prototype,"uniqueValueInfos",null),qN=VN=Q([Ro("esri.renderers.UniqueValueRenderer")],qN);var HN=qN;const WN={key:"type",base:hF,typeMap:{heatmap:lN,simple:cN,"unique-value":HN,"class-breaks":Fj,"dot-density":iN,dictionary:Hj},errorContext:"renderer"},$N={key:"type",base:hF,typeMap:{simple:cN,"unique-value":HN,"class-breaks":Fj},errorContext:"renderer"};function JN(e,t,i,r){const s=function(e,t){return e?function(e,t){if(!t||"web-scene"!==t.origin)return!0;switch(e.type){case"simple":case"unique-value":case"class-breaks":return!0;case"heatmap":case"dictionary":case"dot-density":default:return!1}}(e,t)?e.write({},t):(t.messages&&t.messages.push(new Be("renderer:unsupported",`Renderer of type '${e.declaredClass}' are not supported in scenes.`,{renderer:e,context:t})),null):null}(e,r);s&&X(i,s,t)}function XN(e,t){return YN(e,null,t)}const KN=co({types:WN});function YN(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(i&&i.messages&&i.messages.push(new oo("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):KN(e,t,i):null}class ZN{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(7),this._values=new Map}clone(e){const t=new ZN,i=this._originStores[0];i&&i.forEach(((e,i)=>{t.set(i,H(e),0)}));for(let r=2;r<7;r++){const i=this._originStores[r];i&&i.forEach(((i,s)=>{e&&e.has(s)||t.set(s,H(i),r)}))}return t}get(e,t){const i=void 0===t?this._values:this._originStores[t];return i?i.get(e):void 0}keys(e){const t=null==e?this._values:this._originStores[e];return t?[...t.keys()]:[]}set(e,t,i=6){let r=this._originStores[i];if(r||(r=new Map,this._originStores[i]=r),r.set(e,t),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const r=this._values.get(e);return this._values.set(e,t),this._propertyOriginMap.set(e,i),r!==t}return!1}delete(e,t=6){const i=this._originStores[t];if(!i)return;const r=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===t){this._values.delete(e);for(let i=t-1;i>=0;i--){const t=this._originStores[i];if(t&&t.has(e)){this._values.set(e,t.get(e)),this._propertyOriginMap.set(e,i);break}}}return r}has(e,t){const i=void 0===t?this._values:this._originStores[t];return!!i&&i.has(e)}revert(e,t){for(;t>0&&!this.has(e,t);)--t;const i=this._originStores[t],r=i&&i.get(e),s=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,t),s!==r}originOf(e){return this._propertyOriginMap.get(e)||0}forEach(e){this._values.forEach(e)}}const QN=e=>{let t=class extends e{constructor(...e){super(...e);const t=Tr(this),i=t.metadatas,r=t.store,s=new ZN;t.store=s,r.keys().forEach((e=>{s.set(e,r.get(e),0)})),Object.keys(i).forEach((e=>{t.internalGet(e)&&s.set(e,t.internalGet(e),0)}))}read(e,t){Go(this,e,t)}getAtOrigin(e,t){const i=ez(this),r=bs(t);if("string"==typeof e)return i.get(e,r);const s={};return e.forEach((e=>{s[e]=i.get(e,r)})),s}originOf(e){return ws(this.originIdOf(e))}originIdOf(e){return ez(this).originOf(e)}revert(e,t){const i=ez(this),r=bs(t),s=Tr(this);let n;n="string"==typeof e?"*"===e?i.keys(r):[e]:e,n.forEach((e=>{s.invalidate(e),i.revert(e,r),s.commit(e)}))}};return t=Q([Ro("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function ez(e){return Tr(e).store}let tz=class extends(QN(jo)){};tz=Q([Ro("esri.core.ReadOnlyMultiOriginJSONSupport")],tz);const iz=e=>{let t=class extends e{constructor(...e){super(...e)}clear(e,t="user"){return rz(this).delete(e,bs(t))}write(e={},t){return $o(this,e=e||{},t),e}setAtOrigin(e,t,i){Tr(this).setAtOrigin(e,t,bs(i))}removeOrigin(e){const t=rz(this),i=bs(e),r=t.keys(i);for(const s of r)t.originOf(s)===i&&t.set(s,t.get(s,i),6)}updateOrigin(e,t){const i=rz(this),r=bs(t),s=this.get(e);for(let n=r+1;n<7;++n)i.delete(e,n);i.set(e,s,r)}toJSON(e){return this.write({},e)}};return t=Q([Ro("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function rz(e){return Tr(e).store}const sz=e=>{let t=class extends(iz(QN(e))){constructor(...e){super(...e)}};return t=Q([Ro("esri.core.MultiOriginJSONSupport")],t),t};let nz=class extends(sz(jo)){};var oz;nz=Q([Ro("esri.core.MultiOriginJSONSupport")],nz);let az=oz=class extends Ko{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new oz({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};Q([ro({type:String,json:{write:!0}})],az.prototype,"expression",void 0),Q([ro({type:String,json:{write:!0}})],az.prototype,"name",void 0),Q([ro({type:["boolean"],json:{write:!0}})],az.prototype,"returnType",void 0),Q([ro({type:String,json:{write:!0}})],az.prototype,"title",void 0),az=oz=Q([Ro("esri.form.ExpressionInfo")],az);var lz=az;let hz=class extends Ko{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};Q([ro({type:String,json:{write:!0}})],hz.prototype,"description",void 0),Q([ro({type:String,json:{write:!0}})],hz.prototype,"label",void 0),Q([ro()],hz.prototype,"type",void 0),Q([ro({type:String,json:{write:!0}})],hz.prototype,"visibilityExpression",void 0),hz=Q([Ro("esri.form.elements.Element")],hz);var cz,uz=hz;let pz=cz=class extends Ko{constructor(e){super(e),this.type=null}clone(){return new cz({type:this.type})}};Q([ro({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],pz.prototype,"type",void 0),pz=cz=Q([Ro("esri.form.elements.inputs.AttachmentInput")],pz);var dz,fz=pz;let yz=dz=class extends uz{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new dz({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};Q([ro({type:String,json:{write:!0}})],yz.prototype,"attachmentKeyword",void 0),Q([ro({type:Boolean,json:{write:!0}})],yz.prototype,"editable",void 0),Q([ro({type:fz,json:{read:{source:"inputType"},write:{target:"inputType"}}})],yz.prototype,"input",void 0),Q([ro({type:["attachment"],json:{read:!1,write:!0}})],yz.prototype,"type",void 0),yz=dz=Q([Ro("esri.form.elements.AttachmentElement")],yz);var gz=yz;let mz=class extends Ko{constructor(e){super(e),this.type=null}};Q([ro()],mz.prototype,"type",void 0),mz=Q([Ro("esri.form.elements.inputs.Input")],mz);var vz=mz;let bz=class extends vz{constructor(e){super(e),this.maxLength=null,this.minLength=0}};Q([ro({type:Number,json:{write:!0}})],bz.prototype,"maxLength",void 0),Q([ro({type:Number,json:{write:!0}})],bz.prototype,"minLength",void 0),bz=Q([Ro("esri.form.elements.inputs.TextInput")],bz);var wz,_z=bz;let xz=wz=class extends _z{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new wz({maxLength:this.maxLength,minLength:this.minLength})}};Q([ro({type:["barcode-scanner"],json:{read:!1,write:!0}})],xz.prototype,"type",void 0),xz=wz=Q([Ro("esri.form.elements.inputs.BarcodeScannerInput")],xz);var Sz,Mz=xz;let Tz=Sz=class extends vz{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new Sz({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};Q([ro({type:String,json:{write:!0}})],Tz.prototype,"noValueOptionLabel",void 0),Q([ro({type:Boolean,json:{write:!0}})],Tz.prototype,"showNoValueOption",void 0),Q([ro({type:["combo-box"],json:{read:!1,write:!0}})],Tz.prototype,"type",void 0),Tz=Sz=Q([Ro("esri.form.elements.inputs.ComboBoxInput")],Tz);var Iz,Ez=Tz;function Az(e){return null!=e?new Date(e):null}function Pz(e){return e?e.getTime():null}let Cz=Iz=class extends vz{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return Az(t.max)}writeMax(e,t){t.max=Pz(e)}readMin(e,t){return Az(t.min)}writeMin(e,t){t.min=Pz(e)}clone(){return new Iz({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};Q([ro({type:Boolean,json:{write:!0}})],Cz.prototype,"includeTime",void 0),Q([ro({type:Date,json:{type:Number,write:!0}})],Cz.prototype,"max",void 0),Q([sa("max")],Cz.prototype,"readMax",null),Q([na("max")],Cz.prototype,"writeMax",null),Q([ro({type:Date,json:{type:Number,write:!0}})],Cz.prototype,"min",void 0),Q([sa("min")],Cz.prototype,"readMin",null),Q([na("min")],Cz.prototype,"writeMin",null),Q([ro({type:["datetime-picker"],json:{read:!1,write:!0}})],Cz.prototype,"type",void 0),Cz=Iz=Q([Ro("esri.form.elements.inputs.DateTimePickerInput")],Cz);var Oz,kz=Cz;let Lz=Oz=class extends vz{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new Oz({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};Q([ro({type:String,json:{write:!0}})],Lz.prototype,"noValueOptionLabel",void 0),Q([ro({type:Boolean,json:{write:!0}})],Lz.prototype,"showNoValueOption",void 0),Q([ro({type:["radio-buttons"],json:{read:!1,write:!0}})],Lz.prototype,"type",void 0),Lz=Oz=Q([Ro("esri.form.elements.inputs.RadioButtonsInput")],Lz);var Rz,Dz=Lz;let Fz=Rz=class extends vz{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Rz({offValue:this.offValue,onValue:this.onValue})}};Q([ro({type:[String,Number],json:{write:!0}})],Fz.prototype,"offValue",void 0),Q([ro({type:[String,Number],json:{write:!0}})],Fz.prototype,"onValue",void 0),Q([ro({type:["switch"],json:{read:!1,write:!0}})],Fz.prototype,"type",void 0),Fz=Rz=Q([Ro("esri.form.elements.inputs.SwitchInput")],Fz);var jz,Nz=Fz;let zz=jz=class extends _z{constructor(e){super(e),this.type="text-area"}clone(){return new jz({maxLength:this.maxLength,minLength:this.minLength})}};Q([ro({type:["text-area"],json:{read:!1,write:!0}})],zz.prototype,"type",void 0),zz=jz=Q([Ro("esri.form.elements.inputs.TextAreaInput")],zz);var Vz,Uz=zz;let Gz=Vz=class extends _z{constructor(e){super(e),this.type="text-box"}clone(){return new Vz({maxLength:this.maxLength,minLength:this.minLength})}};Q([ro({type:["text-box"],json:{read:!1,write:!0}})],Gz.prototype,"type",void 0),Gz=Vz=Q([Ro("esri.form.elements.inputs.TextBoxInput")],Gz);const Bz={base:vz,key:"type",typeMap:{"barcode-scanner":Mz,"combo-box":Ez,"datetime-picker":kz,"radio-buttons":Dz,switch:Nz,"text-area":Uz,"text-box":Gz}};var qz;let Hz=qz=class extends uz{constructor(e){super(e),this.domain=null,this.editable=!0,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field"}clone(){return new qz({description:this.description,domain:this.domain,editable:this.editable,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,visibilityExpression:this.visibilityExpression})}};Q([ro({types:Qw,json:{read:{reader:e_},write:!0}})],Hz.prototype,"domain",void 0),Q([ro({type:Boolean,json:{write:!0}})],Hz.prototype,"editable",void 0),Q([ro({type:String,json:{write:!0}})],Hz.prototype,"fieldName",void 0),Q([ro({type:String,json:{write:!0}})],Hz.prototype,"hint",void 0),Q([ro({types:Bz,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Hz.prototype,"input",void 0),Q([ro({type:String,json:{write:!0}})],Hz.prototype,"requiredExpression",void 0),Q([ro({type:String,json:{read:!1,write:!0}})],Hz.prototype,"type",void 0),Hz=qz=Q([Ro("esri.form.elements.FieldElement")],Hz);var Wz,$z=Hz;let Jz=Wz=class extends uz{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Wz({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:H(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};Q([ro({type:Number,json:{write:!0}})],Jz.prototype,"displayCount",void 0),Q([ro({type:["list"],json:{write:!0}})],Jz.prototype,"displayType",void 0),Q([ro({type:Boolean,json:{write:!0}})],Jz.prototype,"editable",void 0),Q([ro({type:[rS],json:{write:!0}})],Jz.prototype,"orderByFields",void 0),Q([ro({type:Number,json:{write:!0}})],Jz.prototype,"relationshipId",void 0),Q([ro({type:["relationship"],json:{read:!1,write:!0}})],Jz.prototype,"type",void 0),Jz=Wz=Q([Ro("esri.form.elements.RelationshipElement")],Jz);var Xz,Kz=Jz;function Yz(e){return{typesWithGroup:{base:uz,key:"type",typeMap:{attachment:gz,field:$z,group:e,relationship:Kz}},typesWithoutGroup:{base:uz,key:"type",typeMap:{attachment:gz,field:$z,relationship:Kz}}}}function Zz(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>r[e.type].fromJSON(e)))}function Qz(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter((e=>r[e.type])).map((e=>e.toJSON()))}function eV(e,t,i=!0){return e?e.map((e=>Kn(i?t.typesWithGroup:t.typesWithoutGroup,e))):null}let tV=Xz=class extends uz{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return eV(e,iV,!1)}readElements(e,t){return Zz(t.formElements,iV,!1)}writeElements(e,t){t.formElements=Qz(e,iV,!1)}clone(){return new Xz({description:this.description,elements:H(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};Q([ro({json:{write:!0}})],tV.prototype,"elements",void 0),Q([Ra("elements")],tV.prototype,"castElements",null),Q([sa("elements",["formElements"])],tV.prototype,"readElements",null),Q([na("elements")],tV.prototype,"writeElements",null),Q([ro({type:["collapsed","expanded"],json:{write:!0}})],tV.prototype,"initialState",void 0),Q([ro({type:String,json:{read:!1,write:!0}})],tV.prototype,"type",void 0),tV=Xz=Q([Ro("esri.form.elements.GroupElement")],tV);const iV=Yz(tV);var rV;const sV=Yz(tV);let nV=rV=class extends Ko{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return eV(e,sV)}readElements(e,t){return Zz(t.formElements,sV)}writeElements(e,t){t.formElements=Qz(e,sV)}clone(){return new rV({description:this.description,expressionInfos:H(this.expressionInfos),elements:H(this.elements),title:this.title})}};Q([ro({type:String,json:{write:!0}})],nV.prototype,"description",void 0),Q([ro({json:{write:!0}})],nV.prototype,"elements",void 0),Q([Ra("elements")],nV.prototype,"castElements",null),Q([sa("elements",["formElements"])],nV.prototype,"readElements",null),Q([na("elements")],nV.prototype,"writeElements",null),Q([ro({type:[lz],json:{write:!0}})],nV.prototype,"expressionInfos",void 0),Q([ro({type:String,json:{write:!0}})],nV.prototype,"title",void 0),nV=rV=Q([Ro("esri.form.FormTemplate")],nV);var oV,aV=nV;const lV=te()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),hV=lV.jsonValues.slice();fs(hV,"orthometric");const cV=te()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let uV=oV=class extends Ko{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return lV.write(e,t,i)}readHeightModel(e,t,i){return lV.read(e)||(i&&i.messages&&i.messages.push(function(e,t){return new oo("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}(e,{context:i})),null)}readHeightUnit(e,t,i){return cV.read(e)||(i&&i.messages&&i.messages.push(pV(e,{context:i})),null)}readHeightUnitService(e,t,i){return NA(e)||cV.read(e)||(i&&i.messages&&i.messages.push(pV(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new oV({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=function(e){return VA(e)>=(e instanceof Aa?xA(e).metersPerDegree:1e5)?"meters":GA(e)}(t);return new oV({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t=a({origin:"web-scene"},t),super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new oV;return t.read(e,{origin:"web-scene"}),t}};function pV(e,t){return new oo("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}Q([ro({type:lV.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:hV,default:"ellipsoidal"}}}})],uV.prototype,"heightModel",void 0),Q([na("web-scene","heightModel")],uV.prototype,"writeHeightModel",null),Q([sa(["web-scene","service"],"heightModel")],uV.prototype,"readHeightModel",null),Q([ro({type:cV.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:cV.jsonValues,write:cV.write}}}})],uV.prototype,"heightUnit",void 0),Q([sa("web-scene","heightUnit")],uV.prototype,"readHeightUnit",null),Q([sa("service","heightUnit")],uV.prototype,"readHeightUnitService",null),Q([ro({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],uV.prototype,"vertCRS",void 0),Q([sa("service","vertCRS",["vertCRS","ellipsoid","geoid"])],uV.prototype,"readVertCRS",null),uV=oV=Q([Ro("esri.geometry.HeightModelInfo")],uV);var dV=uV;let fV=0;const yV=Ne.getLogger("esri.layers.graphics.sources.MemorySource");let gV=class extends(ra.LoadableMixin(Zo(xh))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=m(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;null==(e=this._connection)||e.close(),this._connection=null}get workerGeometryType(){var e;const t=null==(e=this.layer)?void 0:e.geometryType;return t?this._geometryTypeRequiresClientGraphicMapping(t)?"polygon":t:null}applyEdits(e){return this.load().then((()=>this._applyEdits(e)))}openPorts(){return this.load().then((()=>this._connection.openPorts()))}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);nL(e,this.layer.spatialReference,i);const r=vL.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const e=n.attributes[s],t=this._idToClientGraphic.get(e);t&&(n.geometry=t.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new Be("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return nL(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t)))}queryObjectIds(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t)))}queryExtent(e,t={}){return this.load(t).then((()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t))).then((e=>({count:e.count,extent:Ol.fromJSON(e.extent)})))}querySnapping(e,t={}){return this.load(t).then((()=>this._connection.invoke("querySnapping",e,t)))}async _applyEdits(e){if(!this._connection)throw new Be("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=e=>"objectId"in e&&null!=e.objectId?e.objectId:"attributes"in e&&null!=e.attributes[t]?e.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const h of e.deleteFeatures){const e=n(h);null!=e&&r.push(e)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures)for(const h of e.updateFeatures)if(s.push(this._serializeFeature(h)),o){const e=n(h);null!=e&&o.set(e,h)}iL(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if("mesh"!==this.layerOrSourceGeometryType||v(e))return;const i=[];for(const{geometry:r}of e)!m(r)||"mesh"!==r.type||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const t=e.get(i.objectId);null!=t&&this._addIdToClientGraphic(t)}for(const e of t.deleteResults)e.success&&this._idToClientGraphic.delete(e.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new Be("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const s=e[n],o=this._serializeFeature(s);!r&&m(s.geometry)&&(r=s.geometry.type),i[n]=o,t.set(`${o.uid}`,s)}const s=this;return{features:i,inferredGeometryType:r,finish(e){const i=s.sourceJSON.objectIdField;for(const r in e){const n=e[r],o=t.get(r);o&&(o.attributes||(o.attributes={}),-1===n?delete o.attributes[i]:o.attributes[i]=n,s._addIdToClientGraphic(o))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];null!=i&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return null!=(e=null==(t=this.layer)?void 0:t.geometryType)?e:null==(i=this.sourceJSON)?void 0:i.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return"mesh"===e||"multipatch"===e||"extent"===e}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(fV++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return v(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?rw.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await nA("MemorySourceWorker",{strategy:y("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a="defaults"===this.layer.originOf("spatialReference");await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.on("before-changes",(e=>{yV.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),e.preventDefault()}));const h={features:l.features,fields:t&&t.map((e=>e.toJSON())),geometryType:aw.toJSON(this.workerGeometryType),hasM:"mesh"!==this.layerOrSourceGeometryType&&s,hasZ:"mesh"===this.layerOrSourceGeometryType||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},c=await this._connection.invoke("load",h,{signal:e});for(const p of c.warnings)yV.warn(p.message,{layer:this.layer,warning:p});c.featureErrors.length&&yV.warn(`Encountered ${c.featureErrors.length} validation errors while loading features`,c.featureErrors);const u=c.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(u.geometryType=aw.toJSON(l.inferredGeometryType)),this.sourceJSON=u,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(c.assignedObjectIds)}};Q([function(e){return(t,i)=>{t[i]=e}}({Type:fE,ensureType:qn(fE)})],gV.prototype,"itemType",void 0),Q([ro()],gV.prototype,"type",void 0),Q([ro({constructOnly:!0})],gV.prototype,"layer",void 0),Q([ro({readOnly:!0})],gV.prototype,"workerGeometryType",null),Q([ro()],gV.prototype,"sourceJSON",void 0),gV=Q([Ro("esri.layers.graphics.sources.MemorySource")],gV);var mV=gV;const vV=e=>{let t=class extends e{get apiKey(){var e;return this._isOverridden("apiKey")?this._get("apiKey"):function(e){return"portalItem"in e}(this)?null==(e=this.portalItem)?void 0:e.apiKey:null}set apiKey(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return Q([ro({type:String})],t.prototype,"apiKey",null),t=Q([Ro("esri.layers.mixins.APIKeyMixin")],t),t},bV=["MapServer","ImageServer","FeatureServer","SceneServer","StreamServer","VectorTileServer"],wV=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${bV.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),_V=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${bV.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),xV=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function SV(e){return!!wV.test(e)}function MV(e){const t=$t(e),i=t.path.match(wV)||t.path.match(_V);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:IV(-1!==a?s.slice(a+1):s),serverType:n,sublayer:null!=o&&""!==o?parseInt(o,10):null,url:{path:r}}}function TV(e){const t=$t(e).path.match(xV);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function IV(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function EV(e,t){const i=[];if(e){const t=MV(e);m(t)&&t.title&&i.push(t.title)}if(t){const e=IV(t);i.push(e)}if(2===i.length){if(-1!==i[0].toLowerCase().indexOf(i[1].toLowerCase()))return i[0];if(-1!==i[1].toLowerCase().indexOf(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function AV(e){if(!e)return!1;const t=-1!==(e=e.toLowerCase()).indexOf(".arcgis.com/"),i=-1!==e.indexOf("//services")||-1!==e.indexOf("//tiles")||-1!==e.indexOf("//features");return t&&i}function PV(e,t){return e?Ei(Oi(e,t)):e}function CV(e){let{url:t}=e;if(!t)return{url:t};t=Oi(t,e.logger);const i=$t(t),r=MV(i.path);let s;if(m(r))null!=r.sublayer&&null==e.layer.layerId&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const e=TV(i.path);m(e)&&(t=e.serviceUrl,s=e.sublayerId)}return{url:Ei(t),layerId:s}}function OV(e,t,i,r,s){VM(t,r,"url",s),r.url&&null!=e.layerId&&(r.url=ci(r.url,i,e.layerId.toString()))}function kV(e){if(!e)return!1;const t=e.toLowerCase(),i=-1!==t.indexOf("/services/"),r=-1!==t.indexOf("/mapserver/wmsserver"),s=-1!==t.indexOf("/imageserver/wmsserver"),n=-1!==t.indexOf("/wmsserver");return i&&(r||s||n)}const LV=e=>{let t=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const e=MV(this.url);if(m(e)&&e.title)return e.title}return this._get("title")||""}set title(e){this._set("title",e)}set url(e){this._set("url",PV(e,Ne.getLogger(this.declaredClass)))}};return Q([ro()],t.prototype,"title",null),Q([ro({type:String})],t.prototype,"url",null),t=Q([Ro("esri.layers.mixins.ArcGISService")],t),t},RV=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return Q([ro({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{default:"normal",read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),Q([ro()],t.prototype,"effect",void 0),t=Q([Ro("esri.layers.mixins.BlendLayer")],t),t},DV=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return Q([ro({type:Object,json:{write:!0}})],t.prototype,"customParameters",void 0),t=Q([Ro("esri.layers.mixins.CustomParametersMixin")],t),t},FV={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,VectorTileLayer:!0,WMS:!0,KML:!0,RasterDataLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};var jV;let NV=jV=class extends Ko{async collectRequiredFields(e,t){return g_(e,t,this.expression)}clone(){return new jV({expression:this.expression,title:this.title})}};Q([ro({type:String,json:{write:!0}})],NV.prototype,"expression",void 0),Q([ro({type:String,json:{write:!0}})],NV.prototype,"title",void 0),NV=jV=Q([Ro("esri.layers.support.FeatureExpressionInfo")],NV);var zV=NV;function VV(e){return 1/(BF[e]||1)}const UV=function(){const e=Object.keys(BF);return e.sort(),e}();var GV;const BV=te()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),qV=new ee({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let HV=GV=class extends Ko{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write(null,r),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):m(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new GV({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}};Q([ro({type:zV,json:{write:!0}})],HV.prototype,"featureExpressionInfo",void 0),Q([sa("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],HV.prototype,"readFeatureExpressionInfo",null),Q([na("featureExpressionInfo",{featureExpressionInfo:{type:zV},"featureExpression.value":{type:[0]}})],HV.prototype,"writeFeatureExpressionInfo",null),Q([ro({type:BV.apiValues,nonNullable:!0,json:{type:BV.jsonValues,read:BV.read,write:{writer:BV.write,isRequired:!0}}})],HV.prototype,"mode",null),Q([ro({type:Number,json:{write:!0}})],HV.prototype,"offset",void 0),Q([ro({type:UV,json:{type:String,read:qV.read,write:qV.write}})],HV.prototype,"unit",null),HV=GV=Q([Ro("esri.layers.support.ElevationInfo")],HV);var WV=HV;const $V={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},JV={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},XV={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},KV={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:VM}}},YV={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},ZV={value:null,type:WV,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function QV(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const eU={type:Number,json:{origins:{"web-document":{default:1,write:!0,read:!0},"portal-item":{write:!0}}}},tU=l(a({},eU),{json:l(a({},eU.json),{origins:{"web-document":l(a({},eU.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&"service"!==i.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?zv(t.layerDefinition.drawingInfo.transparency):void 0:zv(t.drawingInfo.transparency)}})}),iU={type:mO,readOnly:!0,get(){var e,t;if(null==(e=this.layer)||!e.timeInfo)return null;const i=null==(t=this.view)?void 0:t.timeExtent,r=this.layer.timeExtent,s=this.layer.useViewTime?i&&r?i.intersection(r):i||r:r;if(!s||s.isEmpty)return s;const n=this.layer.timeOffset,o=n?s.offset(-n.value,n.unit):s,a=this._get("timeExtent");return o.equals(a)?a:o}},rU={type:Ol,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=Ol.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(i.spatialReference=Aa.fromJSON(t.spatialReference)),i}}}},read:!1}},sU={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},nU={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},oU={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},aU=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(e,t,i,r){(r&&"ground"===r.layerContainerType||e&&Wo(this,i,{},r))&&(t[i]=e)}writeOperationalLayerType(e,t,i,r){!e||r&&"tables"===r.layerContainerType||(t.layerType=e)}writeTitle(e,t){t.title=e||"Layer"}read(e,t){t&&(t.layer=this),function(e,t,i,r=Uo){var s;const n=l(a({},r),{messages:[]});i(n),null==(s=n.messages)||s.forEach((t=>{"warning"!==t.type||e.loaded?r&&r.messages&&r.messages.push(t):e.loadWarnings.push(t)}))}(this,0,(t=>super.read(e,t)),t)}write(e,t){if(t&&t.origin){const e=`${t.origin}/${t.layerContainerType||"operational-layers"}`,i=FV[e];let r=i&&i[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(r=!1),!r)return t.messages&&t.messages.push(new Be("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const i=super.write(e,l(a({},t),{layer:this})),r=!!t&&!!t.messages&&!!t.messages.filter((e=>e instanceof Be&&"web-document-write:property-required"===e.name)).length;return!this.url&&r?null:i}beforeSave(){}};return Q([ro({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),Q([ro({json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}})],t.prototype,"listMode",void 0),Q([na("listMode")],t.prototype,"writeListMode",null),Q([ro({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),Q([na("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),Q([ro(eU)],t.prototype,"opacity",void 0),Q([ro({type:String,json:{write:{ignoreOrigin:!0,allowNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,allowNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),Q([na("title")],t.prototype,"writeTitle",null),Q([ro({type:Boolean,json:{name:"visibility",origins:{"web-document":{name:"visibility",default:!0},"portal-item":{name:"visibility",read:{source:["visible","visibility"]}}}}})],t.prototype,"visible",void 0),t=Q([Ro("esri.layers.mixins.OperationalLayer")],t),t},lU=Ne.getLogger("esri.layers.mixins.PortalLayer"),hU=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var e;null==(e=this.portalItem)||e.destroy(),this.portalItem=null}set portalItem(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}readPortalItem(e,t,i){if(t.itemId)return new Hg({id:t.itemId,portal:i&&i.portal})}writePortalItem(e,t){e&&e.id&&(t.itemId=e.id)}async loadFromPortal(e,t){if(this.portalItem&&this.portalItem.id)try{const i=await import("./layersLoader.a28ebfdd.js").then((function(e){return e.l}));return tt(t),await i.load({instance:this,supportedTypes:e.supportedTypes,validateItem:e.validateItem,supportsData:e.supportsData},t)}catch(ehe){throw ht(ehe)||lU.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${ehe}`),ehe}}async finishLoadEditablePortalLayer(e){this._set("userHasEditingPrivileges",await this.fetchUserHasEditingPrivileges(e).catch((e=>(st(e),!0))))}async fetchUserHasEditingPrivileges(e){const t=this.url?null==Ui?void 0:Ui.findCredential(this.url):null;if(!t)return!0;const i=cU.credential===t?cU.user:await this.fetchEditingUser(e);return cU.credential=t,cU.user=i,v(i)||null==i.privileges||i.privileges.includes("features:user:edit")}async fetchEditingUser(e){var t,i;const r=null==(t=this.portalItem)||null==(i=t.portal)?void 0:i.user;if(r)return r;const s=Ui.findServerInfo(this.url);if(null==s||!s.owningSystemUrl)return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Yl.getDefault();if(o&&o.loaded&&hi(o.restUrl)===hi(n))return o.user;const a=`${n}/community/self`,l=m(e)?e.signal:null,h=await Rg($i(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return h.ok?Hl.fromJSON(h.value.data):null}read(e,t){t&&(t.layer=this),super.read(e,t)}write(e,t){const i=t&&t.portal,r=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Yl.getDefault());return i&&r&&!ii(r.restUrl,i.restUrl)?(t.messages&&t.messages.push(new Be("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save the scene, set the layer.portalItem to null or save the scene to the same portal as the item associated with the layer`,{layer:this})),null):super.write(e,l(a({},t),{layer:this}))}};return Q([ro({type:Hg})],t.prototype,"portalItem",null),Q([sa("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),Q([na("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),Q([ro()],t.prototype,"resourceReferences",void 0),Q([ro({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=Q([Ro("esri.layers.mixins.PortalLayer")],t),t},cU={credential:null,user:null},uU=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshInterval=0}refresh(){this.emit("refresh")}};return Q([ro({type:Number,cast:e=>e>=.1?e:e<=0?0:.1,json:{write:!0,origins:{"web-document":{write:!0}}}})],t.prototype,"refreshInterval",void 0),t=Q([Ro("esri.layers.mixins.RefreshableLayer")],t),t},pU=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get scaleRangeId(){return`${this.minScale},${this.maxScale}`}};return Q([ro({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),Q([ro({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),Q([ro({readOnly:!0})],t.prototype,"scaleRangeId",null),t=Q([Ro("esri.layers.mixins.ScaleRangeLayer")],t),t},dU=te()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var fU;let yU=fU=class extends Ko{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return function(e,t,i){return 0===e?0:e*hO[t]/hO[i]}(this.value,this.unit,"milliseconds")}clone(){return new fU({value:this.value,unit:this.unit})}};Q([ro({type:Number,json:{write:!0},nonNullable:!0})],yU.prototype,"value",void 0),Q([ro({type:dU.apiValues,json:{type:dU.jsonValues,read:dU.read,write:dU.write},nonNullable:!0})],yU.prototype,"unit",void 0),yU=fU=Q([Ro("esri.TimeInterval")],yU);var gU,mU=yU;let vU=gU=class extends Ko{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new gU({respectsDaylightSaving:e,timezone:t})}};Q([ro({type:Boolean,json:{write:!0}})],vU.prototype,"respectsDaylightSaving",void 0),Q([sa("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],vU.prototype,"readRespectsDaylightSaving",null),Q([ro({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],vU.prototype,"timezone",void 0),vU=gU=Q([Ro("esri.layers.support.TimeReference")],vU);var bU,wU=vU;let _U=bU=class extends Ko{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new mO({start:i,end:r})}writeFullTimeExtent(e,t){e&&m(e.start)&&m(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new mU({value:t.timeInterval,unit:dU.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new mU({value:t.defaultTimeInterval,unit:dU.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new bU({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:H(n),fullTimeExtent:H(o),trackIdField:a,useTime:l})}};Q([ro({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],_U.prototype,"cumulative",void 0),Q([ro({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],_U.prototype,"endField",void 0),Q([ro({type:mO,json:{write:{enabled:!0,allowNull:!0}}})],_U.prototype,"fullTimeExtent",void 0),Q([sa("fullTimeExtent",["timeExtent"])],_U.prototype,"readFullTimeExtent",null),Q([na("fullTimeExtent")],_U.prototype,"writeFullTimeExtent",null),Q([ro({type:Boolean,json:{write:!0}})],_U.prototype,"hasLiveData",void 0),Q([ro({type:mU,json:{write:{enabled:!0,allowNull:!0}}})],_U.prototype,"interval",void 0),Q([sa("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],_U.prototype,"readInterval",null),Q([na("interval")],_U.prototype,"writeInterval",null),Q([ro({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],_U.prototype,"startField",void 0),Q([ro({type:wU,json:{write:{enabled:!0,allowNull:!0}}})],_U.prototype,"timeReference",void 0),Q([ro({type:String,json:{write:{enabled:!0,allowNull:!0}}})],_U.prototype,"trackIdField",void 0),Q([ro({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],_U.prototype,"useTime",void 0),_U=bU=Q([Ro("esri.layers.support.TimeInfo")],_U);var xU=_U;const SU=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const i=t.timeInfo.exportOptions;if(!i)return null;const r=i.timeOffset,s=dU.fromJSON(i.timeOffsetUnits);return r&&s?new mU({value:r,unit:s}):null}set timeInfo(e){c_(e,this.fieldsIndex),this._set("timeInfo",e)}};return Q([ro({type:mO,json:{write:!1}})],t.prototype,"timeExtent",void 0),Q([ro({type:mU})],t.prototype,"timeOffset",void 0),Q([sa("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),Q([ro({value:null,type:xU,json:{write:!0,origins:{"web-document":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),Q([ro({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=Q([Ro("esri.layers.mixins.TemporalLayer")],t),t};var MU;let TU=MU=class extends Ko{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new MU({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};Q([ro({constructOnly:!0})],TU.prototype,"name",void 0),Q([ro({constructOnly:!0})],TU.prototype,"fields",void 0),Q([ro({constructOnly:!0})],TU.prototype,"isAscending",void 0),Q([ro({constructOnly:!0})],TU.prototype,"isUnique",void 0),Q([ro({constructOnly:!0})],TU.prototype,"description",void 0),TU=MU=Q([Ro("esri.layers.support.FeatureIndex")],TU);let IU=class extends Ko{constructor(){super(...arguments),this.type=null}};Q([ro({type:["selection","cluster"],readOnly:!0,json:{read:!1,write:!0}})],IU.prototype,"type",void 0),IU=Q([Ro("esri.layers.support.FeatureReduction")],IU);var EU,AU=IU;let PU=EU=class extends Ko{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new EU({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};Q([ro({type:String,json:{write:!0}})],PU.prototype,"statisticType",void 0),Q([ro({type:String,json:{write:!0}})],PU.prototype,"onStatisticField",void 0),Q([ro({type:String,json:{write:!0}})],PU.prototype,"onStatisticValueExpression",void 0),PU=EU=Q([Ro("esri.layers.support.OutStatistic")],PU);var CU,OU=PU;let kU=CU=class extends Ko{constructor(){super(...arguments),this.name=null}clone(){return new CU({name:this.name,outStatistic:this.outStatistic.clone()})}};Q([ro({type:String,json:{write:!0}})],kU.prototype,"name",void 0),Q([ro({type:OU,json:{write:!0}})],kU.prototype,"outStatistic",void 0),kU=CU=Q([Ro("esri.layers.support.AggregateField")],kU);var LU=kU;const RU="__begin__",DU=new RegExp(RU,"ig"),FU=new RegExp("__end__","ig"),jU=new RegExp("^"+RU,"i"),NU=new RegExp("__end__$","i");function zU(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=function(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(e.labelExpression),t.type="conventional"),t}function VU(e){const t=zU(e);if(!t)return null;switch(t.type){case"conventional":return function(e){const t=e.match(GU);return t&&t[1].trim()||null}(t.expression);case"arcade":return WU(t.expression)}return null}function UU(e){let t;return e?(t=Le(e,(e=>RU+'$feature["'+e+'"]__end__')),t=jU.test(t)?t.replace(jU,""):'"'+t,t=NU.test(t)?t.replace(NU,""):t+'"',t=t.replace(DU,'" + ').replace(FU,' + "')):t='""',t}const GU=/^\s*\{([^}]+)\}\s*$/i;const BU=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,qU=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,HU=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function WU(e){if(!e)return null;let t=BU.exec(e)||qU.exec(e);return t?t[1]||t[3]:(t=HU.exec(e),t?t[2]:null)}var $U;let JU=$U=class extends Ko{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?UU(t.value):e}writeExpression(e,t,i){null!=this.value&&(e=UU(this.value)),t[i]=e}clone(){return new $U({expression:this.expression,title:this.title,value:this.value})}};Q([ro({type:String,json:{write:{allowNull:!0}}})],JU.prototype,"expression",void 0),Q([sa("expression",["expression","value"])],JU.prototype,"readExpression",null),Q([na("expression")],JU.prototype,"writeExpression",null),Q([ro({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],JU.prototype,"title",void 0),Q([ro({json:{read:!1,write:!1}})],JU.prototype,"value",void 0),JU=$U=Q([Ro("esri.layers.support.LabelExpressionInfo")],JU);var XU=JU;const KU=[252,146,31,255],YU=[153,153,153,255],ZU={type:"esriSMS",style:"esriSMSCircle",size:6,color:KU,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},QU={type:"esriSLS",style:"esriSLSSolid",width:.75,color:KU},eG={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},tG=$I.fromJSON(ZU),iG=fM.fromJSON(QU),rG=BI.fromJSON(eG),sG=KI.fromJSON({type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0});function nG(e){if(v(e))return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return tG;case"polyline":return iG;case"polygon":case"extent":return rG}return null}const oG=$I.fromJSON({type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5}),aG=fM.fromJSON({type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5}),lG=BI.fromJSON({type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null});var hG;const cG=new ee({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function uG(e){return!e||"service"!==e.origin&&!pG(e.layer)}function pG(e){return"map-image"===(null==e?void 0:e.type)}function dG(e){var t,i;return!!pG(e)&&!(null==(t=e.capabilities)||null==(i=t.exportMap)||!i.supportsArcadeExpressionForLabeling)}let fG=hG=class extends Ko{constructor(e){super(e),this.type="label",this.name=null,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.maxScale=0,this.minScale=0,this.symbol=sG,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=function(e,t,i){switch(t){case"=":return e==i;case"<>":return e!=i;case">":return e>i;case">=":return e>=i;case"<":return e<i;case"<=":return e<=i}return!1};try{if(null==e)return!0;const r=e.split(" ");if(3===r.length)return i(t[r[0]],r[1],r[2]);if(7===r.length){const e=i(t[r[0]],r[1],r[2]),s=r[3],n=i(t[r[4]],r[5],r[6]);switch(s){case"AND":return e&&n;case"OR":return e||n}}return!1}catch(ia){console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)e=function(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const t=WU(this.labelExpressionInfo.expression);t&&(e="["+t+"]")}null!=e&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(null==e&&null!=this.labelExpression&&uG(r))e=new XU({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return zU(this)}getLabelExpressionArcade(){return function(e){const t=zU(e);if(!t)return null;switch(t.type){case"conventional":return UU(t.expression);case"arcade":return t.expression}return null}(this)}getLabelExpressionSingleField(){return VU(this)}hash(){return JSON.stringify(this)}clone(){return new hG({deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:H(this.labelExpressionInfo),labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,symbol:H(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};Q([ro({type:String,json:{write:!0}})],fG.prototype,"name",void 0),Q([ro({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],fG.prototype,"deconflictionStrategy",void 0),Q([ro({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&"service"===(null==i?void 0:i.origin)&&dG(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],fG.prototype,"labelExpression",void 0),Q([sa("labelExpression")],fG.prototype,"readLabelExpression",null),Q([na("labelExpression")],fG.prototype,"writeLabelExpression",null),Q([ro({type:XU,json:{write:{overridePolicy:(e,t,i)=>function(e){return uG(e)||dG(e.layer)}(i)?{allowNull:!0}:{enabled:!1}}}})],fG.prototype,"labelExpressionInfo",void 0),Q([na("labelExpressionInfo")],fG.prototype,"writeLabelExpressionInfo",null),Q([ro({type:cG.apiValues,json:{type:cG.jsonValues,read:cG.read,write:cG.write}})],fG.prototype,"labelPlacement",void 0),Q([ro({type:Number})],fG.prototype,"maxScale",void 0),Q([na("maxScale")],fG.prototype,"writeMaxScale",null),Q([ro({type:Number})],fG.prototype,"minScale",void 0),Q([na("minScale")],fG.prototype,"writeMinScale",null),Q([ro({types:oE,json:{origins:{"web-scene":{types:lE,write:xj,default:null}},write:xj,default:null}})],fG.prototype,"symbol",void 0),Q([ro({type:Boolean,json:{write:!0}})],fG.prototype,"useCodedValues",void 0),Q([ro({type:String,json:{write:!0}})],fG.prototype,"where",void 0),fG=hG=Q([Ro("esri.layers.support.LabelClass")],fG);var yG,gG=fG;let mG=yG=class extends Ko{constructor(e){super(e),this.type="cluster",this.clusterRadius=DS("80px"),this.clusterMinSize=DS("12px"),this.clusterMaxSize=DS("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new yG({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:H(this.labelingInfo),labelsVisible:this.labelsVisible,fields:H(this.fields),popupEnabled:this.popupEnabled,popupTemplate:H(this.popupTemplate)})}};Q([ro({type:["cluster"],readOnly:!0,json:{write:!0}})],mG.prototype,"type",void 0),Q([ro({type:Number,cast:e=>"auto"===e?e:DS(e),json:{write:!0}})],mG.prototype,"clusterRadius",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],mG.prototype,"clusterMinSize",void 0),Q([ro({type:Number,cast:DS,json:{write:!0}})],mG.prototype,"clusterMaxSize",void 0),Q([ro(JV)],mG.prototype,"popupEnabled",void 0),Q([ro({type:xS,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],mG.prototype,"popupTemplate",void 0),Q([ro({types:rE})],mG.prototype,"symbol",void 0),Q([ro({type:[gG],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],mG.prototype,"labelingInfo",void 0),Q([ro(XV)],mG.prototype,"labelsVisible",void 0),Q([ro({type:[LU],json:{write:!0}})],mG.prototype,"fields",void 0),mG=yG=Q([Ro("esri.layers.support.FeatureReductionCluster")],mG);var vG,bG=mG;let wG=vG=class extends AU{constructor(e){super(e),this.type="selection"}clone(){return new vG}};Q([ro({type:["selection"]})],wG.prototype,"type",void 0),wG=vG=Q([Ro("esri.layers.support.FeatureReductionSelection")],wG);var _G=wG;const xG={key:"type",base:AU,typeMap:{selection:_G}};function SG(e,t){const i=(t=t.layerDefinition||t).featureReduction;if(i)switch(i.type){case"selection":return _G.fromJSON(i);case"cluster":return bG.fromJSON(i)}return null}function MG(e,t,i,r){const s=function(e,t,i){return e?"selection"!==e.type?(i.messages&&i.messages.push(new Be("featureReduction:unsupported",`FeatureReduction of type '${e.declaredClass}' are not supported in scenes.`,{featureReduction:e,context:i})),null):e.write(t,i):null}(e,{},r);s&&X(i,s,t)}const TG=new ee({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let IG=class extends Ko{constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}writeDrawingTool(e,t){t.drawingTool=TG.toJSON(e)}writePrototype(e,t){t.prototype=q(H(e),!0)}writeThumbnail(e,t){t.thumbnail=q(H(e))}};Q([ro({json:{write:!0}})],IG.prototype,"name",void 0),Q([ro({json:{write:!0}})],IG.prototype,"description",void 0),Q([ro({json:{read:TG.read,write:TG.write}})],IG.prototype,"drawingTool",void 0),Q([na("drawingTool")],IG.prototype,"writeDrawingTool",null),Q([ro({json:{write:!0}})],IG.prototype,"prototype",void 0),Q([na("prototype")],IG.prototype,"writePrototype",null),Q([ro({json:{write:!0}})],IG.prototype,"thumbnail",void 0),Q([na("thumbnail")],IG.prototype,"writeThumbnail",null),IG=Q([Ro("esri.layers.support.FeatureTemplate")],IG);var EG=IG;let AG=class extends Ko{constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(r.type){case"range":t[i]=Zw.fromJSON(r);break;case"codedValue":t[i]=Ww.fromJSON(r);break;case"inherited":t[i]=Xw.fromJSON(r)}}return t}writeDomains(e,t){const i={};for(const r in e)e.hasOwnProperty(r)&&(i[r]=e[r]&&e[r].toJSON());q(i),t.domains=i}readTemplates(e){return e&&e.map((e=>new EG(e)))}writeTemplates(e,t){t.templates=e&&e.map((e=>e.toJSON()))}};Q([ro({json:{write:!0}})],AG.prototype,"id",void 0),Q([ro({json:{write:!0}})],AG.prototype,"name",void 0),Q([ro({json:{write:!0}})],AG.prototype,"domains",void 0),Q([sa("domains")],AG.prototype,"readDomains",null),Q([na("domains")],AG.prototype,"writeDomains",null),Q([ro({json:{write:!0}})],AG.prototype,"templates",void 0),Q([sa("templates")],AG.prototype,"readTemplates",null),Q([na("templates")],AG.prototype,"writeTemplates",null),AG=Q([Ro("esri.layers.support.FeatureType")],AG);var PG=AG;function CG(e){return"date"===e.type||"esriFieldTypeDate"===e.type}class OG{constructor(e){if(this.fields=e,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this.dateFields=[],!e)return;const t=[];for(const i of e){const e=i&&i.name;if(e){const r=kG(e);this._fieldsMap.set(e,i),this._fieldsMap.set(r,i),t.push(r),CG(i)&&(this.dateFields.push(i),this._dateFieldsSet.add(i))}}t.sort(),this.uid=t.join(",")}destroy(){this._fieldsMap.clear()}has(e){return null!=this.get(e)}get(e){return null!=e?this._fieldsMap.get(e)||this._fieldsMap.get(kG(e)):void 0}isDateField(e){return this._dateFieldsSet.has(this.get(e))}normalizeFieldName(e){const t=this.get(e);if(t)return t.name}}function kG(e){return e.toLowerCase().trim()}const LG=Ne.getLogger("esri.layers.support.fieldProperties");function RG(){return{fields:{type:[SO],value:null},fieldsIndex:{readOnly:!0,get(){return new OG(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||LG.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return p_(this.fieldsIndex,e)}}}}let DG=class extends Ko{constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};Q([ro({type:String,json:{read:{source:"shapeAreaFieldName"}}})],DG.prototype,"shapeAreaField",void 0),Q([ro({type:String,json:{read:{source:"shapeLengthFieldName"}}})],DG.prototype,"shapeLengthField",void 0),Q([ro({type:String,json:{read:e=>HA.read(e)||WA.read(e)}})],DG.prototype,"units",void 0),DG=Q([Ro("esri.layers.support.GeometryFieldsInfo")],DG);var FG=DG;const jG=/\[([^\[\]]+)\]/gi;function NG(e,t,i){return e?e.map((e=>{const r=new gG;if(r.read(e,i),r.labelExpression){const e=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;r.labelExpression=r.labelExpression.replace(jG,((t,i)=>`[${function(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const e=t[r].name;if(e.toLowerCase()===i)return e}return e}(i,e)}]`))}return r})):null}let zG=class extends Ko{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new xh}};Q([ro({type:String,json:{write:!0}})],zG.prototype,"floorField",void 0),Q([ro({json:{read:!1,write:!1}})],zG.prototype,"viewAllMode",void 0),Q([ro({json:{read:!1,write:!1}})],zG.prototype,"viewAllLevelIds",void 0),zG=Q([Ro("esri.layers.support.LayerFloorInfo")],zG);var VG=zG;const UG=new ee({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),GG=new ee({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let BG=class extends Ko{constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};Q([ro({json:{read:UG.read,write:UG.write}})],BG.prototype,"cardinality",void 0),Q([ro({json:{read:!0,write:!0}})],BG.prototype,"composite",void 0),Q([ro({json:{read:!0,write:!0}})],BG.prototype,"id",void 0),Q([ro({json:{read:!0,write:!0}})],BG.prototype,"keyField",void 0),Q([ro({json:{read:!0,write:!0}})],BG.prototype,"keyFieldInRelationshipTable",void 0),Q([ro({json:{read:!0,write:!0}})],BG.prototype,"name",void 0),Q([ro({json:{read:!0,write:!0}})],BG.prototype,"relatedTableId",void 0),Q([ro({json:{read:!0,write:!0}})],BG.prototype,"relationshipTableId",void 0),Q([ro({json:{read:GG.read,write:GG.write}})],BG.prototype,"role",void 0),BG=Q([Ro("esri.layers.support.Relationship")],BG);var qG=BG;async function HG(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&"unique-value"===r.type&&r.styleOrigin){const s=await Rg(r.populateFromStyle());if(tt(i),!1===s.ok){const i=s.error;t&&t.messages&&t.messages.push(new oo("renderer:style-reference",`Failed to create unique value renderer from style reference: ${i.message}`,{error:i,context:t})),e.clear("renderer",t.origin)}}}const WG=["oid","global-id"],$G=["oid","global-id","guid"];function JG({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=function({editFieldsInfo:e,fields:t,objectIdField:i},r){return function(e,t){const i=e;return t&&(e=e.filter((e=>-1===t.indexOf(e.type)))),e===i&&(e=e.slice()),e.sort(YG),e}(t,(null==r?void 0:r.ignoreFieldTypes)||iB).map((t=>new lx({fieldName:t.name,isEditable:QG(t,e),label:t.alias,format:eB(t),visible:KG(t,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:null==r?void 0:r.visibleFieldNames})})))}({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=function(e){const t=function({displayField:e,fields:t}){return e||(t&&t.length?v_(t,"name-or-title")||v_(t,"unique-identifier")||v_(t,"type-or-category")||function(e){for(const t of e){if(!t||!t.name)continue;const e=t.name.toLowerCase();if(e.indexOf("name")>-1||e.indexOf("title")>-1)return t.name}return null}(t):null)}(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}({titleBase:s,fields:i,displayField:e}),l=[new cx,new Z_];return new xS({title:a,content:l,fieldInfos:o})}const XG=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],KG=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!(ZG(e.name,t)||i&&e.name===i||WG.indexOf(e.type)>-1||XG.some((t=>t.test(e.name))));function YG(e,t){return"oid"===e.type?-1:"oid"===t.type?1:tB(e)?-1:tB(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function ZG(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return-1!==[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].indexOf(e.toLowerCase())}function QG(e,t){return e.editable&&-1===$G.indexOf(e.type)&&!ZG(e.name,t)}function eB(e){switch(e.type){case"small-integer":case"integer":case"single":return new nx({digitSeparator:!0,places:0});case"double":return new nx({digitSeparator:!0,places:2});case"date":return new nx({dateFormat:"long-month-day-year"});default:return null}}function tB(e){return"name"===(e.name&&e.name.toLowerCase())||("name"===(e.alias&&e.alias.toLowerCase())||void 0)}const iB=["geometry","blob","raster","guid","xml"],rB=new ee({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),sB={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},nB="FeatureLayer",oB=Ne.getLogger("esri.layers.FeatureLayer");function aB(e){return e&&e instanceof xh}function lB(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function hB(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}const cB=RG();function uB(e,t,i){const r=!(null==i||!i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let pB=class extends(RV(SU(pU(uU(LV(aU(hU(sz(DV(vV(Mw))))))))))){constructor(...e){super(...e),this._handles=new Mh,this.capabilities=null,this.charts=null,this.copyright=null,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Aa.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(xh.ofType(TU)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;null==(e=this.source)||e.destroy(),this._handles=M(this._handles)}normalizeCtorArgs(e,t){return"string"==typeof e?a({url:e},t):e}load(e){const t=m(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then((e=>this._initLayerProperties(e))));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(st).then((async()=>{if(this.url&&null==this.layerId&&/FeatureServer|MapServer\/*$/i.test(this.url)){const e=await this._fetchFirstLayerId(t);null!=e&&(this.layerId=e)}if(!this.url&&!this._hasMemorySource())throw new Be("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))})).then((()=>this.finishLoadEditablePortalLayer(e)));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{attachment:this._readAttachmentCapabilities(t.attachmentProperties),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges}set editingEnabled(e){null!=e?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:null!=i.lastEditDate?new Date(i.lastEditDate):null}:null}readFeatureReduction(e,t){return SG(0,t)}writeWebSceneFeatureReduction(e,t,i,r){MG(e,t,"layerDefinition.featureReduction",r)}readIsTable(e,t){return"Table"===(t=t&&t.layerDefinition||t).type||!t.geometryType}writeIsTable(e,t,i,r){null!=r&&r.writeLayerSchema&&X(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields)for(const i of t.fields)if("esriFieldTypeGlobalID"===i.type)return i.name}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields)for(const i of t.fields)if("esriFieldTypeOID"===i.type)return i.name}get parsedUrl(){const e=this.url?$t(this.url):null;return null!=e&&(null!=this.dynamicDataSource?e.path=ci(e.path,"dynamicLayer"):null!=this.layerId&&(e.path=ci(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){l_(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const e=YN(r,t,i)||void 0;return e||oB.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),e}if(t.defaultSymbol)return t.types&&t.types.length?new HN({defaultSymbol:dB(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map((e=>({id:e.id,symbol:dB(e.symbol,e,i)})))}):new cN({symbol:dB(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(aB(t)&&this._resetMemorySource(t),aB(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof xh?new mV({layer:this,items:e}):e:null}readSource(e,t){const i=vL.fromJSON(t.featureSet);return new mV({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map((e=>EG.fromJSON(e))),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const e=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?EV(this.url,i):i;let t=i;if(!t&&this.url){const e=MV(this.url);m(e)&&(t=e.title)}if(!t)return;return"item-title-and-service-name"===this.sublayerTitleMode&&e&&e!==t&&(t=e+" - "+t),IV(t)}if("item-title"===this.sublayerTitleMode&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const e=t.fields.find((e=>e.name.toLowerCase()===i));e&&(i=e.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map((e=>(e=PG.fromJSON(e),this._fixTemplates(e.templates,r),this._fixTemplates(e.templates,s),e)))}set url(e){const t=CV({layer:this,url:e,nonStandardUrlAllowed:!0,logger:oB});this._set("url",t.url),null!=t.layerId&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){OV(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&null!=t.layerDefinition.defaultVisibility?!!t.layerDefinition.defaultVisibility:null!=t.visibility?!!t.visibility:void 0}addAttachment(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("addAttachment"in this.source))throw new Be(nB,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)}))}updateAttachment(e,t,i){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("updateAttachment"in this.source))throw new Be(nB,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)}))}async applyEdits(e,t){const i=await import("./editingSupport.edb52b5a.js");return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return JG(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await lt(import("./FeatureLayerSource.0741ccbb.js"),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new ek,t=this.get("capabilities.data");e.dynamicDataSource=this.dynamicDataSource,e.gdbVersion=this.gdbVersion,e.historicMoment=this.historicMoment,e.returnGeometry=!0,t&&(t.supportsZ&&null!=this.returnZ&&(e.returnZ=this.returnZ),t.supportsM&&null!=this.returnM&&(e.returnM=this.returnM)),e.outFields=["*"],e.where=this.definitionExpression||"1=1";const{timeOffset:i,timeExtent:r}=this;return e.timeExtent=null!=i&&null!=r?r.offset(-i.value,i.unit):r||null,e.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then((()=>this._checkAttachmentSupport(e))).then((()=>{if(!("deleteAttachments"in this.source))throw new Be(nB,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)}))}fetchRecomputedExtents(e){return this.load({signal:null==e?void 0:e.signal}).then((()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new Be(nB,"Layer source does not support fetchUpdates capability")}))}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(null==r)return null;let s=null;return i.some((e=>{const{id:t}=e;return null!=t&&(t.toString()===r.toString()&&(s=e),!!s)})),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const t=r.domains&&r.domains[e];if(t&&"inherited"!==t.type)return t}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=eP.from(e),this.load().then((()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new Be(nB,"this layer doesn't support attachments");const{attachmentTypes:t,objectIds:i,globalIds:r,num:s,size:n,start:o,where:a}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const l=i&&i.length>1,h=t&&t.length,c=r&&r.length,u=n&&n.length;if(l||h||c||u||s||o||a)throw new Be(nB,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(i&&i.length||a))throw new Be(nB,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new Be(nB,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)}))}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(ek.from(e)||this.createQuery(),t))).then((e=>{if(null!=e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}))}queryObjectIds(e,t){return this.load().then((()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(ek.from(e)||this.createQuery(),t);throw new Be(nB,"Layer source does not support queryObjectIds capability")}))}queryFeatureCount(e,t){return this.load().then((()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(ek.from(e)||this.createQuery(),t);throw new Be(nB,"Layer source does not support queryFeatureCount capability")}))}queryExtent(e,t){return this.load().then((()=>{if(this.source.queryExtent)return this.source.queryExtent(ek.from(e)||this.createQuery(),t);throw new Be(nB,"Layer source does not support queryExtent capability")}))}queryRelatedFeatures(e,t){return this.load().then((()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(ik.from(e),t);throw new Be(nB,"Layer source does not support queryRelatedFeatures capability")}))}queryRelatedFeaturesCount(e,t){return this.load().then((()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(ik.from(e),t);throw new Be(nB,"Layer source does not support queryRelatedFeaturesCount capability")}))}queryTopFeatures(e,t){return this.load().then((()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(UR.from(e),t).then((e=>{if(null!=e&&e.features)for(const t of e.features)t.layer=t.sourceLayer=this;return e}));throw new Be(nB,"Layer source does not support queryTopFeatures capability")}))}queryTopObjectIds(e,t){return this.load().then((()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(UR.from(e),t);throw new Be(nB,"Layer source does not support queryTopObjectIds capability")}))}queryTopFeaturesExtent(e,t){return this.load().then((()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(UR.from(e),t);throw new Be(nB,"Layer source does not support queryTopExtents capability")}))}queryTopFeatureCount(e,t){return this.load().then((()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(UR.from(e),t);throw new Be(nB,"Layer source does not support queryFeatureCount capability")}))}read(e,t){const i=e.featureCollection;if(i){const e=i.layers;e&&1===e.length&&(super.read(e[0],t),null!=i.showLegend&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&"service"===t.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var i,r;const s=(t=l(a({},t),{writeLayerSchema:null!=(i=null==(r=t)?void 0:r.writeLayerSchema)?i:this._hasMemorySource()})).origin,n=t.layerContainerType,o=t.messages;if(this.isTable){if("web-scene"===s||"web-map"===s&&"tables"!==n)return o&&o.push(new Be("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Table source cannot be written to web scenes and web maps`,{layer:this})),null;if(this._hasMemorySource())return o&&o.push(new Be("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using an in-memory Table source cannot be written to web scenes and web maps`,{layer:this})),null}else if(this.loaded&&"web-map"===s&&"tables"===n)return o&&o.push(new Be("layer:unsupported",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a non-table source cannot be written to tables in web maps`,{layer:this})),null;return super.write(e,t)}_readEditingEnabled(e,t,i){var r;let s=null==(r=e.layerDefinition)?void 0:r.capabilities;return s?this._hasEditingCapability(s):(s=e.capabilities,t&&"web-map"===(null==i?void 0:i.origin)&&!this._hasMemorySource()&&s?this._hasEditingCapability(s):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map((e=>e.trim())).includes("editing")}_writeEditingEnabled(e,t,i,r){if(!e){var s,n;const e=null!=(s=this.capabilities)&&null!=(n=s.operations)&&n.supportsSync?"Query,Sync":"Query";X("layerDefinition.capabilities",e,t),!i||null!=r&&r.writeLayerSchema||(t.capabilities=e)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new Be(nB,`feature is missing the identifying attribute ${i}`)):Promise.reject(new Be(nB,"'attributes' are required on a feature to query attachments")):Promise.reject(new Be(nB,"A feature is required to add/delete/update attachments")):Promise.reject(new Be(nB,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return $i(this.url,{query:l(a({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:e}).then((e=>{const t=e.data;if(t)return Array.isArray(t.layers)&&t.layers.length>0?t.layers[0].id:Array.isArray(t.tables)&&t.tables.length>0?t.tables[0].id:void 0}))}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),l_(this.renderer,this.fieldsIndex),c_(this.timeInfo,this.fieldsIndex),HG(this,{origin:"service"})}_verifyFields(){const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||-1!==e.search(/\/FeatureServer\//i)||this.fields&&this.fields.some((function(e){return"geometry"===e.type}))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach((e=>{const i=e.prototype&&e.prototype.attributes;i&&t&&delete i[t]}))}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new Be("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new Be("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach((e=>{e.layer=this,e.sourceLayer=this})),this._handles.add([e.on("after-add",(e=>{e.item.layer=this,e.item.sourceLayer=this})),e.on("after-remove",(e=>{e.item.layer=null,e.item.sourceLayer=null}))],"fl-source")}_resetMemorySource(e){e.forEach((e=>{e.layer=null,e.sourceLayer=null})),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAttachmentCapabilities(e){const t={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1};return e&&Array.isArray(e)&&e.forEach((e=>{const i=sB[e.name];i&&(t[i]=!!e.isEnabled)})),t}_readDataCapabilities(e){return{isVersioned:lB(e,"isDataVersioned",!1),supportsAttachment:lB(e,"hasAttachments",!1),supportsM:lB(e,"hasM",!1),supportsZ:lB(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:lB(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map((e=>e.trim())):[],r=-1!==i.indexOf("editing");let s=r&&-1!==i.indexOf("create"),n=r&&-1!==i.indexOf("delete"),o=r&&-1!==i.indexOf("update");const a=-1!==i.indexOf("changetracking");return r&&!(s||n||o)&&(s=n=o=!0),{supportsCalculate:lB(t,"supportsCalculate",!1),supportsTruncate:lB(t,"supportsTruncate",!1),supportsValidateSql:lB(t,"supportsValidateSql",!1),supportsAdd:s,supportsDelete:n,supportsEditing:r,supportsChangeTracking:a,supportsQuery:-1!==i.indexOf("query"),supportsQueryAttachments:lB(t.advancedQueryCapabilities,"supportsQueryAttachments",!1),supportsResizeAttachments:lB(t,"supportsAttachmentsResizing",!1),supportsSync:-1!==i.indexOf("sync"),supportsUpdate:o,supportsExceedsLimitStatistics:lB(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var t;const i=e.advancedQueryCapabilities,r=e.ownershipBasedAccessControlForFeatures,s=e.archivingInfo,n=null==(t=this.url)?void 0:t.includes("MapServer"),o=!y("mapserver-pbf-enabled")&&n&&this.version<10.81,a=(e.supportedQueryFormats||"").split(",").reduce(((e,t)=>{const i=t.toLowerCase().trim();return i&&e.add(i),e}),new Set);return{supportsStatistics:lB(i,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:lB(i,"supportsPercentileStatistics",!1),supportsCentroid:lB(i,"supportsReturningGeometryCentroid",!1),supportsDistance:lB(i,"supportsQueryWithDistance",!1),supportsDistinct:lB(i,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:lB(i,"supportsReturningQueryExtent",!1),supportsGeometryProperties:lB(i,"supportsReturningGeometryProperties",!1),supportsHavingClause:lB(i,"supportsHavingClause",!1),supportsOrderBy:lB(i,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:lB(i,"supportsPagination",!1),supportsQuantization:lB(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:lB(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:lB(e,"supportsReturningQueryGeometry",!1),supportsResultType:lB(i,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:lB(i,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:lB(i,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:lB(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:lB(i,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:lB(r,"allowOthersToQuery",!0),supportsHistoricMoment:lB(s,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!o&&a.has("pbf"),supportsDisjointSpatialRelationship:lB(i,"supportsDisjointSpatialRel",!1),supportsCacheHint:lB(i,"supportsQueryWithCacheHint",!1),maxRecordCountFactor:hB(e,"maxRecordCountFactor",void 0),maxRecordCount:hB(e,"maxRecordCount",void 0),standardMaxRecordCount:hB(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:hB(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=lB(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:lB(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:lB(e,"allowGeometryUpdates",!0),supportsGlobalId:lB(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:lB(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:lB(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:lB(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:lB(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:lB(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:lB(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:lB(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:lB(t,"allowOthersToUpdate",!0)}}};Q([ro({readOnly:!0,json:{read:!1}})],pB.prototype,"capabilities",void 0),Q([sa("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],pB.prototype,"readCapabilities",null),Q([ro({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],pB.prototype,"charts",void 0),Q([ro({readOnly:!0})],pB.prototype,"createQueryVersion",null),Q([ro({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],pB.prototype,"copyright",void 0),Q([ro({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],pB.prototype,"displayField",void 0),Q([ro({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],pB.prototype,"definitionExpression",void 0),Q([ro({types:iE,readOnly:!0})],pB.prototype,"defaultSymbol",void 0),Q([ro({type:VO})],pB.prototype,"dynamicDataSource",void 0),Q([ro({readOnly:!0})],pB.prototype,"editFieldsInfo",void 0),Q([ro({type:Boolean})],pB.prototype,"editingEnabled",null),Q([sa(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],pB.prototype,"readEditingEnabled",null),Q([sa("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],pB.prototype,"readEditingEnabledFromWebMap",null),Q([na(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],pB.prototype,"writeEditingEnabled",null),Q([na("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],pB.prototype,"writeEditingEnabledToWebMap",null),Q([ro({readOnly:!0})],pB.prototype,"editingInfo",void 0),Q([sa("editingInfo")],pB.prototype,"readEditingInfo",null),Q([ro(ZV)],pB.prototype,"elevationInfo",void 0),Q([ro({types:{key:"type",base:AU,typeMap:{selection:_G,cluster:bG}},json:{write:{target:"layerDefinition.featureReduction"}}})],pB.prototype,"featureReduction",void 0),Q([sa("featureReduction",["layerDefinition.featureReduction"])],pB.prototype,"readFeatureReduction",null),Q([na("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:xG}})],pB.prototype,"writeWebSceneFeatureReduction",null),Q([ro(l(a({},cB.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{read:!0},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:uB}}}}}))],pB.prototype,"fields",void 0),Q([ro(cB.fieldsIndex)],pB.prototype,"fieldsIndex",void 0),Q([ro({type:VG,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],pB.prototype,"floorInfo",void 0),Q([ro({type:aV,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],pB.prototype,"formTemplate",void 0),Q([ro({type:Ol,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],pB.prototype,"fullExtent",void 0),Q([ro()],pB.prototype,"gdbVersion",void 0),Q([ro({readOnly:!0,type:FG,json:{read:{source:"geometryProperties"}}})],pB.prototype,"geometryFieldsInfo",void 0),Q([ro({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:rB.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:uB,writer(e,t,i){const r=e?rB.toJSON(e):null;r&&X(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:rB.read}}})],pB.prototype,"geometryType",void 0),Q([ro({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],pB.prototype,"hasM",void 0),Q([ro({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],pB.prototype,"hasZ",void 0),Q([ro({readOnly:!0,type:dV})],pB.prototype,"heightModelInfo",void 0),Q([ro({type:Date})],pB.prototype,"historicMoment",void 0),Q([ro(sU)],pB.prototype,"id",void 0),Q([ro({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],pB.prototype,"infoFor3D",void 0),Q([ro({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],pB.prototype,"isTable",void 0),Q([sa("service","isTable",["type","geometryType"]),sa("isTable",["layerDefinition.type","layerDefinition.geometryType"])],pB.prototype,"readIsTable",null),Q([na("web-map","isTable")],pB.prototype,"writeIsTable",null),Q([ro(XV)],pB.prototype,"labelsVisible",void 0),Q([ro({type:[gG],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:NG},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:NG},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],pB.prototype,"labelingInfo",void 0),Q([ro(tU)],pB.prototype,"opacity",void 0),Q([ro({type:Number,json:{origins:{service:{read:{source:"id"}}},read:!1}})],pB.prototype,"layerId",void 0),Q([ro(YV)],pB.prototype,"legendEnabled",void 0),Q([ro({type:["show","hide"]})],pB.prototype,"listMode",void 0),Q([ro(nU)],pB.prototype,"minScale",void 0),Q([sa("service","minScale",["minScale","effectiveMinScale"])],pB.prototype,"readMinScale",null),Q([ro(oU)],pB.prototype,"maxScale",void 0),Q([sa("service","maxScale",["maxScale","effectiveMaxScale"])],pB.prototype,"readMaxScale",null),Q([ro({type:String})],pB.prototype,"globalIdField",void 0),Q([sa("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),sa("service","globalIdField",["globalIdField","fields"])],pB.prototype,"readGlobalIdFieldFromService",null),Q([ro({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:uB}}}}})],pB.prototype,"objectIdField",void 0),Q([sa("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),sa("service","objectIdField",["objectIdField","fields"])],pB.prototype,"readObjectIdFieldFromService",null),Q([ro({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],pB.prototype,"operationalLayerType",void 0),Q([ro(cB.outFields)],pB.prototype,"outFields",void 0),Q([ro({readOnly:!0})],pB.prototype,"parsedUrl",null),Q([ro({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],pB.prototype,"path",void 0),Q([ro(JV)],pB.prototype,"popupEnabled",void 0),Q([ro({type:xS,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],pB.prototype,"popupTemplate",void 0),Q([ro({readOnly:!0})],pB.prototype,"defaultPopupTemplate",null),Q([ro({type:[qG],readOnly:!0})],pB.prototype,"relationships",void 0),Q([ro({types:WN,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:$N,write:{target:"layerDefinition.drawingInfo.renderer",writer:JN}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:null==i?void 0:i.writeLayerSchema}),writer:JN}}})],pB.prototype,"renderer",null),Q([sa("service","renderer",["drawingInfo.renderer","defaultSymbol"]),sa("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],pB.prototype,"readRenderer",null),Q([ro()],pB.prototype,"sourceJSON",void 0),Q([ro({type:Boolean})],pB.prototype,"returnM",void 0),Q([ro({type:Boolean})],pB.prototype,"returnZ",void 0),Q([ro($V)],pB.prototype,"screenSizePerspectiveEnabled",void 0),Q([ro()],pB.prototype,"source",null),Q([Ra("source")],pB.prototype,"castSource",null),Q([sa("portal-item","source",["featureSet"]),sa("web-map","source",["featureSet"])],pB.prototype,"readSource",null),Q([ro({readOnly:!0})],pB.prototype,"serviceDefinitionExpression",void 0),Q([sa("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],pB.prototype,"readServiceDefinitionExpression",null),Q([ro({type:Aa,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],pB.prototype,"spatialReference",void 0),Q([ro({type:Number})],pB.prototype,"subtypeCode",void 0),Q([ro({type:[EG]})],pB.prototype,"templates",void 0),Q([sa("templates",["editFieldsInfo","creatorField","editorField","templates"])],pB.prototype,"readTemplates",null),Q([ro({type:xU})],pB.prototype,"timeInfo",void 0),Q([ro()],pB.prototype,"title",void 0),Q([sa("service","title",["name"]),sa("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],pB.prototype,"readTitle",null),Q([sa("web-map","title",["layerDefinition.name","title"])],pB.prototype,"readTitleFromWebMap",null),Q([ro({type:String})],pB.prototype,"sublayerTitleMode",void 0),Q([ro({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],pB.prototype,"trackIdField",void 0),Q([ro({json:{read:!1}})],pB.prototype,"type",void 0),Q([ro({type:String})],pB.prototype,"typeIdField",void 0),Q([sa("service","typeIdField"),sa("typeIdField",["layerDefinition.typeIdField"])],pB.prototype,"readTypeIdField",null),Q([ro({type:[PG]})],pB.prototype,"types",void 0),Q([sa("service","types",["types"]),sa("types",["layerDefinition.types"])],pB.prototype,"readTypes",null),Q([ro({readOnly:!0,json:{write:!1}})],pB.prototype,"serverGens",void 0),Q([ro({type:xh.ofType(TU),readOnly:!0})],pB.prototype,"indexes",void 0),Q([ro(KV)],pB.prototype,"url",null),Q([na("url")],pB.prototype,"writeUrl",null),Q([ro({readOnly:!0})],pB.prototype,"userIsAdmin",void 0),Q([ro({json:{origins:{service:{read:!0}},read:!1}})],pB.prototype,"version",void 0),Q([sa("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],pB.prototype,"readVersion",null),Q([ro({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],pB.prototype,"visible",void 0),Q([sa("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],pB.prototype,"readVisible",null),pB=Q([Ro("esri.layers.FeatureLayer")],pB);const dB=co({types:nE});var fB=pB,yB=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:fB});const gB=["$datastore","$map","$layer","$aggregatedfeatures"],mB=Ne.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");async function vB({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||"2d"!==(null==t?void 0:t.type))return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function bB({expressionAttributes:e,info:t,arcadeUtils:i,spatialReference:r,map:s,graphic:n,view:o}){const h=`expression/${t.name}`,c=i.createSyntaxTree(t.expression),u=gB.filter((e=>i.hasVariable(c,e)));await i.loadScriptDependencies(c,!0,u);const p=i.getViewInfo({spatialReference:r}),d=i.createExecContext(n,p);d.useAsync=!0,function({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o}){i.forEach((i=>{const h=i.toLowerCase(),c={map:n,spatialReference:s.sr};if("$map"===h&&(r.vars[h]=t.convertMapToFeatureSetCollection(c)),"$layer"===h&&(r.vars[h]=t.convertFeatureLayerToFeatureSet(o.sourceLayer,s.sr)),"$datastore"===h&&(r.vars[h]=t.convertServiceUrlToWorkspace(o.sourceLayer.url,s.sr)),"$aggregatedfeatures"===h){const i=o.layer,{fields:n,objectIdField:c,geometryType:u,spatialReference:p,displayField:d}=i,f=new fB(l(a({fields:n,objectIdField:c,geometryType:u,spatialReference:p,displayField:d},"feature"===i.type?{templates:i.templates,typeIdField:i.typeIdField,types:i.types}:null),{source:e}));r.vars[h]=t.convertFeatureLayerToFeatureSet(f,s.sr)}}))}({aggregatedFeatures:await vB({graphic:n,view:o}),arcadeUtils:i,featureSetVars:u,context:d,viewInfo:p,map:s,graphic:n});const f=i.createFunction(c,d),y=await i.executeAsyncFunction(f,d).catch((e=>mB.error("arcade-execution-error",{error:e,graphic:n,expressionInfo:t})));e[h]="string"==typeof y?PP(AP(y)):Array.isArray(y)?function(e){return`<ul class="esri-widget__list">${e.map((e=>`<li>${"string"==typeof e?PP(AP(e)):e}</li>`)).join("")}</ul>`}(y):y&&"esri.arcade.Dictionary"===y.declaredClass?function(e){return`<table class="esri-widget__table">${e.keys().map((t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${"string"==typeof i?PP(AP(i)):i}</td></tr>`})).join("")}</table>`}(y):y}async function wB({popupTemplate:e,spatialReference:t,graphic:i,map:r,view:s}){const n=e.expressionInfos,o=[],a={};if(!n||!n.length)return a;const l=await import("./arcadeUtils.af916cf9.js").then((function(e){return e.aq}));for(const h of n)o.push(bB({expressionAttributes:a,info:h,arcadeUtils:l,spatialReference:t,map:r,graphic:i,view:s}));return await pt(o),a}const _B="esri.widgets.FeatureViewModel",xB=Ne.getLogger(_B);let SB=class extends jo{constructor(e){super(e),this._handles=new Mh,this._featureAbortController=null,this.graphicChangedThrottled=fA(this.graphicChanged,1,this),this._expressionAttributes=null,this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._handles.add(Rh(this,["graphic","_effectivePopupTemplate"],(()=>this.graphicChangedThrottled())))}destroy(){this._clear(),this._cancelFeatureQuery(),this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return m(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function(e,t){const i=new Map;return e&&e.forEach((e=>{const r=mP(e.fieldName,t);e.fieldName=r,i.set(r.toLowerCase(),e)})),i}(EP(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return pP(this.graphic)}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){void 0!==e?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){void 0!==e?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof rD&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof rD&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof rD&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async graphicChanged(){this._cancelFeatureQuery(),this._clear();const{graphic:e}=this;if(!e)return;const t=et();this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(ehe){xB.error("error","error loading popupTemplate for graphic",{error:ehe,graphic:e})}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.map(((e,t)=>"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):void 0)):"string"==typeof e?this._compileText(new Wx({text:e}),0).text:e}_destroyContentViewModels(){this.contentViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("contentViewModels",[])}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new RC(a({graphic:i},this._compileTitleAndDesc({title:s,description:r}))),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new WC({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:wP({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:wP({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_compileFields(e,t){const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s=e.clone(),n=(null==e?void 0:e.fieldInfos)||(null==i?void 0:i.fieldInfos),o=null==i?void 0:i.expressionInfos,l=a(a({},r.global),r.content[t]),{description:h,title:c}=s,u=new QC(a({attributes:l,expressionInfos:o,fieldInfos:n},this._compileTitleAndDesc({title:c,description:h})));return this.contentViewModels[t]=u,s.fieldInfos=u.formattedFieldInfos.slice(0),s}_compileMedia(e,t){const{graphic:i,_fieldInfoMap:r,_effectivePopupTemplate:s,relatedInfos:n,_sourceLayer:o,_expressionAttributes:l}=this,{attributes:h}=i,c=this.formattedAttributes.global,u=e.clone(),{description:p,mediaInfos:d,title:f}=u,y=new rD(a({activeMediaInfoIndex:u.activeMediaInfoIndex||0,attributes:h,layer:o,fieldInfoMap:r,formattedAttributes:c,expressionAttributes:l,mediaInfos:d,popupTemplate:s,relatedInfos:n},this._compileTitleAndDesc({title:f,description:p})));return u.mediaInfos=y.formattedMediaInfos.slice(0),this.contentViewModels[t]=y,u}_compileText(e,t){const i=e.clone(),{graphic:r,_fieldInfoMap:s,_sourceLayer:n,_expressionAttributes:o}=this;if(i&&i.text){const{attributes:e}=r,t=this.formattedAttributes.global;i.text=wP({attributes:e,fieldInfoMap:s,globalAttributes:t,expressionAttributes:o,layer:n,text:i.text})}return this.contentViewModels[t]=new WC({graphic:r,creator:i.text}),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=null==t?void 0:t.editFieldsInfo;return r&&s?function(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if("number"==typeof o){const e=t[s];return{type:"edit",date:Te(o,uP),user:e}}const a=t[r];if("number"==typeof a){const e=t[i];return{type:"create",date:Te(a,uP),user:e}}return null}(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r;return wP({attributes:n,fieldInfoMap:t,globalAttributes:this.formattedAttributes.global,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this;return dP(null==e?void 0:e.title,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this;return dP(null==e?void 0:e.content,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:h}}=await pt({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await kP({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:c}}=await pt({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:wB({popupTemplate:this._effectivePopupTemplate,spatialReference:n,graphic:r,map:o,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=c,this._set("formattedAttributes",this._createFormattedAttributes(l,c)),this._set("title",this._compileTitle(h)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createFormattedAttributes(e,t){const{_effectivePopupTemplate:i,graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o}=this,l=null==i?void 0:i.fieldInfos,h=a(a({},r.attributes),t),c={global:OP({fieldInfos:l,graphic:r,attributes:h,layer:n,fieldInfoMap:o,relatedInfos:s}),content:[]};return Array.isArray(e)&&e.forEach(((e,t)=>{"fields"===e.type&&e.fieldInfos&&(c.content[t]=OP({fieldInfos:e.fieldInfos,graphic:r,attributes:h,layer:n,fieldInfoMap:o,relatedInfos:s}))})),c}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,EP(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=m(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter((e=>e&&LP(e.fieldName)));if(!o||!o.length)return;t.forEach((e=>this._configureRelatedInfo(e,n)));const a=await tD({relatedInfos:r,layer:n},i);Object.keys(a).forEach((e=>{var t;const i=r.get(e.toString()),s=null==(t=a[e])?void 0:t.value;i&&s&&(i.layerInfo=s.data)}));const l=await function({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach(((t,n)=>{t.layerInfo&&(s[n]=eD(e,t,i,r))})),pt(s)}({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach((e=>{var t;!function(e,t){if(!t)return;if(!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}(null==(t=l[e])?void 0:t.value,r.get(e.toString()))}))}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=ZR(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||QR(s,t);o&&(function({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new XO({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};Q([ro()],SB.prototype,"_featureAbortController",void 0),Q([ro({readOnly:!0})],SB.prototype,"_effectivePopupTemplate",null),Q([ro({readOnly:!0})],SB.prototype,"_fieldInfoMap",null),Q([ro({readOnly:!0})],SB.prototype,"_sourceLayer",null),Q([ro({readOnly:!0})],SB.prototype,"content",void 0),Q([ro({readOnly:!0})],SB.prototype,"contentViewModels",void 0),Q([ro({type:Boolean})],SB.prototype,"defaultPopupTemplateEnabled",void 0),Q([ro({readOnly:!0})],SB.prototype,"formattedAttributes",void 0),Q([ro({type:fE,value:null})],SB.prototype,"graphic",null),Q([ro({readOnly:!0})],SB.prototype,"lastEditInfo",void 0),Q([ro()],SB.prototype,"relatedInfos",void 0),Q([ro()],SB.prototype,"spatialReference",null),Q([ro({readOnly:!0})],SB.prototype,"title",void 0),Q([ro()],SB.prototype,"map",null),Q([ro({readOnly:!0})],SB.prototype,"waitingForContent",null),Q([ro()],SB.prototype,"view",void 0),SB=Q([Ro(_B)],SB);var MB=SB;const TB=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=e=>zy(e)&&!e.destroyed?Iy("div",{key:e},e.render()):e instanceof HTMLElement?Iy("div",{key:e,bind:e,afterCreate:this._attachToNode}):function(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(e)?Iy("div",{key:e,bind:e.domNode,afterCreate:this._attachToNode}):null}_attachToNode(e){e.appendChild(this)}};return t=Q([Ro("esri.widgets.Feature.ContentMixin")],t),t},IB="esri-icon-loading-indicator esri-rotating",EB="esri-widget",AB="esri-feature",PB="esri-feature__size-container",CB="esri-feature__title",OB="esri-feature__main-container",kB="esri-feature__content-element",LB="esri-feature__text",RB="esri-feature__last-edited-info",DB="esri-feature__loading-container",FB="esri-feature__loading-spinner",jB={title:!0,content:!0,lastEditedInfo:!0};let NB=class extends(TB(xy)){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=a({},jB),this.map=null,this.view=null,this.viewModel=new MB}initialize(){this.own(Rh(this,"viewModel.contentViewModels",(()=>this._setupContentWidgets())))}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return a(a({},jB),e)}render(){const{waitingForContent:e}=this.viewModel;return Iy("div",{class:this.classes(AB,EB)},Iy("div",{class:PB},this.renderTitle(),e?this.renderLoading():this.renderContentContainer()))}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderLoading(){return Iy("div",{key:"loading-container",class:DB},Iy("span",{class:this.classes(IB,FB)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?Iy("div",{class:OB},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?Iy(FC,{level:this.headingLevel,class:CB,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?Iy("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if("string"==typeof e){const e=this._contentWidgets[0];return!e||e.destroyed?null:Iy("div",{key:`${t}-content`},e.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if("boolean"!=typeof i.content&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return"loading"===i||r.length>0?Iy("div",{key:this._buildKey("attachments-element",e),class:this.classes(kB)},t.render()):null}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Iy("div",{key:this._buildKey("custom-element",t),class:kB},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Iy("div",{key:this._buildKey("fields-element",e),class:kB},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Iy("div",{key:this._buildKey("media-element",e),class:kB},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=Ve("edit"===i.type?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,{date:r,user:s});return Iy("div",{key:"edit-info-element",class:this.classes(RB,kB)},n)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Iy("div",{key:this._buildKey("text-element",t),class:this.classes(kB,LB)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidgets(){this._contentWidgets.forEach((e=>{e.viewModel=null,e&&!e.destroyed&&e.destroy()})),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach(((i,s)=>{"attachments"===i.type&&(this._contentWidgets[s]=new qC({displayType:i.displayType,headingLevel:t.title?e+1:e,viewModel:r[s]})),"fields"===i.type&&(this._contentWidgets[s]=new lO({viewModel:r[s]})),"media"===i.type&&(this._contentWidgets[s]=new PD({viewModel:r[s]})),"text"===i.type&&(this._contentWidgets[s]=new YC({viewModel:r[s]})),"custom"===i.type&&(this._contentWidgets[s]=new YC({viewModel:r[s]}))}),this);else{const e=r[0];e&&!e.destroyed&&(this._contentWidgets[0]=new YC({viewModel:e}))}this.scheduleRender()}};Q([eh("viewModel.graphic")],NB.prototype,"graphic",void 0),Q([eh("viewModel.defaultPopupTemplateEnabled")],NB.prototype,"defaultPopupTemplateEnabled",void 0),Q([ro()],NB.prototype,"headingLevel",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],NB.prototype,"label",void 0),Q([ro(),Sy("esri/widgets/Feature/t9n/Feature")],NB.prototype,"messages",void 0),Q([ro(),Sy("esri/widgets/support/t9n/uriUtils")],NB.prototype,"messagesURIUtils",void 0),Q([eh("viewModel.spatialReference")],NB.prototype,"spatialReference",void 0),Q([eh("viewModel.title")],NB.prototype,"title",void 0),Q([ro()],NB.prototype,"visibleElements",void 0),Q([Ra("visibleElements")],NB.prototype,"castVisibleElements",null),Q([eh("viewModel.map")],NB.prototype,"map",void 0),Q([eh("viewModel.view")],NB.prototype,"view",void 0),Q([ro({type:MB})],NB.prototype,"viewModel",void 0),NB=Q([Ro("esri.widgets.Feature")],NB);var zB=NB;let VB=class extends sh.EventedAccessor{constructor(e){super(e),this._anchorHandles=new Mh,this.location=null,this.screenLocation=null,this.screenLocationEnabled=!1,this.view=null,this._anchorHandles.add([Dh(this,["screenLocationEnabled","location","view.size","view.stationary"],(()=>this._updateScreenPointAndHandle())),Dh(this,["view","view.ready"],(()=>this._wireUpView()))])}destroy(){this.view=null,this._anchorHandles&&this._anchorHandles.destroy(),this._anchorHandles=null,this._viewpointHandle=null}_wireUpView(){const e="view";if(this._anchorHandles.remove(e),this._viewpointHandle=null,!this.get("view.ready"))return;this._setScreenLocation();const{view:t}=this,i=qh(t,"3d"===t.type?"camera":"viewpoint",(()=>this._viewpointChange()));this._anchorHandles.add(i,e),this._viewpointHandle=i,this._toggleWatchingViewpoint()}_viewpointChange(){this._setScreenLocation(),this.emit("view-change")}_updateScreenPointAndHandle(){this._setScreenLocation(),this._toggleWatchingViewpoint()}_toggleWatchingViewpoint(){const{_viewpointHandle:e,location:t,screenLocationEnabled:i}=this;e&&(t&&i?e.resume():e.pause())}_setScreenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this,r=this.get("view.ready"),s=i&&r&&m(e)?t.toScreen(e):null;this._set("screenLocation",s)}};Q([ro()],VB.prototype,"location",void 0),Q([ro({readOnly:!0})],VB.prototype,"screenLocation",void 0),Q([ro()],VB.prototype,"screenLocationEnabled",void 0),Q([ro()],VB.prototype,"view",void 0),VB=Q([Ro("esri.widgets.support.AnchorElementViewModel")],VB);var UB=VB;let GB=class extends UB{constructor(e){super(e),this.visible=!1}};Q([ro()],GB.prototype,"visible",void 0),GB=Q([Ro("esri.widgets.CompassViewModel")],GB);var BB=GB;const qB="esri-spinner",HB="esri-spinner--start",WB="esri-spinner--finish";let $B=class extends xy{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new BB,this.visible=!1}initialize(){this.own([Dh(this,"visible",(e=>this._visibleChange(e)))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;i&&i.catch((()=>{})).then((()=>this.hide()))}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r={[HB]:e&&i,[WB]:!e&&i},s=this._getPositionStyles();return Iy("div",{class:this.classes(qB,r),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=gt(this._animationDelay);this._animationPromise=t,t.catch((()=>{})).then((()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)}))}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(!t||v(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};Q([eh("viewModel.location")],$B.prototype,"location",void 0),Q([eh("viewModel.view")],$B.prototype,"view",void 0),Q([ro({type:BB})],$B.prototype,"viewModel",void 0),Q([eh("viewModel.visible")],$B.prototype,"visible",void 0),$B=Q([Ro("esri.widgets.Spinner")],$B);var JB=$B;class XB{constructor(e,t){this._storage=new Nj,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}put(e,t){this._storage.put(e,t,1,1)}pop(e){return this._storage.pop(e)}get(e){return this._storage.get(e)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}function KB(e,t,i,r){return function(e){return"function"==typeof e}(e)?e(t,i,r):e}function YB(e){return[e.r,e.g,e.b,e.a]}function ZB(e,t,i){const r=e=>{let t=e.length;for(;t--;)if(-1===" /-,\n".indexOf(e.charAt(t)))return!1;return!0},s=[];let n=0,o=-1;do{if(o=t.indexOf("[",n),o>=n){if(o>n){const e=t.substr(n,o-n);s.push([e,null,r(e)])}if(n=o+1,o=t.indexOf("]",n),o>=n){if(o>n){const i=e[t.substr(n,o-n)];i&&s.push([null,i,!1])}n=o+1}}}while(-1!==o);if(n<t.length-1){const e=t.substr(n);s.push([e,null,r(e)])}return e=>{let t="",r=null;for(const i of s){const[s,n,o]=i;if(s)o?r=s:(r&&(t+=r,r=null),t+=s);else{const i=e.attributes[n];i&&(r&&(t+=r,r=null),t+=i)}}return QB(t,i)}}function QB(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function eq(e,t,i,r,s,n,o=!0){const a=t/s,l=i/n,h=Math.ceil(a/2),c=Math.ceil(l/2);for(let u=0;u<n;u++)for(let i=0;i<s;i++){const p=4*(i+(o?n-u-1:u)*s);let d=0,f=0,y=0,g=0,m=0,v=0,b=0;const w=(u+.5)*l;for(let r=Math.floor(u*l);r<(u+1)*l;r++){const s=Math.abs(w-(r+.5))/c,n=(i+.5)*a,o=s*s;for(let l=Math.floor(i*a);l<(i+1)*a;l++){let i=Math.abs(n-(l+.5))/h;const s=Math.sqrt(o+i*i);s>=-1&&s<=1&&(d=2*s*s*s-3*s*s+1,d>0&&(i=4*(l+r*t),b+=d*e[i+3],y+=d,e[i+3]<255&&(d=d*e[i+3]/250),g+=d*e[i],m+=d*e[i+1],v+=d*e[i+2],f+=d))}}r[p]=g/f,r[p+1]=m/f,r[p+2]=v/f,r[p+3]=b/y}}function tq(e){return e?{r:e[0],g:e[1],b:e[2],a:e[3]/255}:{r:0,g:0,b:0,a:0}}function iq(e){var t;return null==(t=e.data)?void 0:t.symbol}function rq(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type}function sq(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type}function nq(e){return"CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type}function oq(e){return"CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type}function aq(e){const t=iq(e);if("CIMTextSymbol"===t.type)return t.height;let i=0;if(t.symbolLayers)for(const r of t.symbolLayers)rq(r)&&r.size>i?i=r.size:sq(r)&&r.width>i?i=r.width:nq(r);return i}function lq(e,t,i){const r=iq(e),s=aq(e);0!==s?hq(r,t/s,!1,i):function(e,t){if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":i.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":i.width=t}}else e.height=t}(r,t)}function hq(e,t,i,r){if("CIMTextSymbol"!==e.type){if(i&&e.effects)for(const i of e.effects)uq(i,t);if(e.symbolLayers)for(const i of e.symbolLayers)switch(i.type){case"CIMPictureMarker":case"CIMVectorMarker":cq(i,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":null!=r&&r.preserveOutlineWidth||(i.width*=t);break;case"CIMPictureFill":i.height*=t,i.offsetX*=t,i.offsetY*=t;break;case"CIMHatchFill":hq(i.lineSymbol,t,!0,l(a({},r),{preserveOutlineWidth:!1})),i.offsetX*=t,i.offsetY*=t,i.separation*=t}}else e.height*=t}function cq(e,t,i){if(e.markerPlacement&&function(e,t){switch(oq(e)&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map((e=>e*t));e.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset*=t,e.placementTemplate&&e.placementTemplate.length){const i=e.placementTemplate.map((e=>e*t));e.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":e.startPointOffset*=t;break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine*=t;break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition*=t,e.endPosition*=t;break;case"CIMMarkerPlacementPolygonCenter":e.offsetX*=t,e.offsetY*=t;break;case"CIMMarkerPlacementInsidePolygon":e.offsetX*=t,e.offsetY*=t,e.stepX*=t,e.stepY*=t}}(e.markerPlacement,t),e.offsetX*=t,e.offsetY*=t,e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size*=t,"CIMVectorMarker"===e.type&&e.markerGraphics)for(const r of e.markerGraphics)e.scaleSymbolsProportionally||hq(r.symbol,t,!0,i)}function uq(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width*=t;break;case"CIMGeometricEffectBuffer":e.size*=t;break;case"CIMGeometricEffectCut":e.beginCut*=t,e.endCut*=t,e.middleCut*=t;break;case"CIMGeometricEffectDashes":if(e.customEndingOffset*=t,e.offsetAlongLine*=t,e.dashTemplate&&e.dashTemplate.length){const i=e.dashTemplate.map((e=>e*t));e.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length*=t;break;case"CIMGeometricEffectMove":e.offsetX*=t,e.offsetY*=t;break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset*=t;break;case"CIMGeometricEffectRegularPolygon":e.radius*=t;break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth*=t,e.length*=t,e.toWidth*=t;break;case"CIMGeometricEffectWave":e.amplitude*=t,e.period*=t}}function pq(e){const t=[];return dq(iq(e),t),t.length?new Rv(tq(t[0])):null}function dq(e,t){let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(i.symbolLayers)for(const s of i.symbolLayers)if(!(s.colorLocked||r&&(sq(s)||rq(s)&&s.markerPlacement&&oq(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":s.markerGraphics.forEach((e=>{dq(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":fq(t,s.color);break;case"CIMHatchFill":dq(s.lineSymbol,t)}}function fq(e,t){for(const i of e)if(i.join(".")===t.join("."))return;e.push(t)}function yq(e,t){t instanceof Rv||(t=new Rv(t)),gq(iq(e),t)}function gq(e,t){let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(i.symbolLayers)for(const s of i.symbolLayers){if(s.colorLocked)continue;if(r&&(sq(s)||rq(s)&&s.markerPlacement&&oq(s.markerPlacement)))continue;const e=t.toArray(0);switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":break;case"CIMVectorMarker":s.markerGraphics.forEach((e=>{gq(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":s.color=e;break;case"CIMHatchFill":gq(s.lineSymbol,t)}}}const mq="simple-marker",vq=new XB(1e3);function bq(e){const t=e.style;let i=null;if(e)switch(e.type){case mq:"cross"!==t&&"x"!==t&&(i=e.color);break;case"simple-fill":"solid"===t?i=e.color:"none"!==t&&(i={type:"pattern",x:0,y:0,src:gr(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case"picture-fill":i={type:"pattern",src:e.url,width:LS(e.width)*e.xscale,height:LS(e.height)*e.yscale,x:LS(e.xoffset),y:LS(e.yoffset)};break;case"text":i=e.color;break;case"cim":i=pq(e)}return i}function wq(e,t){const i=e+"-"+t;return void 0!==vq.get(i)?Promise.resolve(vq.get(i)):$i(e,{responseType:"image"}).then((e=>{const r=e.data,s=r.naturalWidth,n=r.naturalHeight,o=document.createElement("canvas");o.width=s,o.height=n;const a=o.getContext("2d");a.fillStyle=t,a.fillRect(0,0,s,n),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const l=o.toDataURL();return vq.put(i,l),l}))}function _q(e){if(!e)return null;let t;switch(e.type){case"simple-fill":case"picture-fill":case mq:t=_q(e.outline);break;case"simple-line":{const i=LS(e.width);"none"!==e.style&&0!==i&&(t={color:e.color,style:xq(e.style),width:i,cap:e.cap,join:"miter"===e.join?LS(e.miterLimit):e.join});break}default:t=null}return t}const xq=function(){const e={};return function(t){if(e[t])return e[t];const i=t.replace(/-/g,"");return e[t]=i,i}}(),Sq=new Rv([128,128,128]),Mq=/\/resource\/(.*?)\.svg$/,Tq=new Rv("white");function Iq(e){if(!e)return 0;if(tE(e)){const t=function(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1);return"outline"in i?R(i,"outline","size"):void 0}(e);return m(t)?t:0}const t=_q(e);return t&&RS(t.width)||0}function Eq(e){if(v(e)||!("symbolLayers"in e)||v(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some((e=>"object"===e.type));case"line-3d":return e.symbolLayers.some((e=>"path"===e.type));case"polygon-3d":return e.symbolLayers.some((e=>"object"===e.type||"extrude"===e.type));default:return!1}}function Aq(e,t){const i=t.resource.href;return!y("esri-canvas-svg-support")&&e.styleOrigin&&Mq.test(i)?i.replace(Mq,"/resource/png/$1.png"):i}function Pq(e,t){if(null==t)return e;const i=e.toRgba();return i[3]=i[3]*t,new Rv(i)}function Cq(e,t,i){e&&(t||null!=i)&&(t&&(t=new Rv(t)),tE(e)?function(e,t,i){const r=e.symbolLayers;if(!r)return;const s=e=>{const r=m(e)?e:null;return Pq(t=t||r||null!=i&&Tq,i)};r.forEach((e=>{if("object"!==e.type||null==e.resource.href||t)if("water"===e.type)e.color=s(e.color);else{const t=m(e.material)?e.material.color:null,r=s(t);v(e.material)?e.material=new rM({color:r}):e.material.color=r,null!=i&&"outline"in e&&m(e.outline)&&m(e.outline.color)&&(e.outline.color=Pq(e.outline.color,i))}}))}(e,t,i):eE(e)&&function(e,t,i){(t=t||e.color)&&(e.color=Pq(t,i)),null!=i&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=Pq(e.outline.color,i))}(e,t,i))}async function Oq(e,t){const i=e.symbolLayers;i&&await Lg(i,(async e=>async function(e,t){switch(e.type){case"extrude":!function(e,t){e.size="number"==typeof t[2]?t[2]:0}(e,t);break;case"icon":case"line":case"text":!function(e,t){const i=kq(t);m(i)&&(e.size=i)}(e,t);break;case"path":!function(e,t){const i=Lq(t,Mm,[e.width,void 0,e.height]);e.width=Rq(t[0],e.width,1,i),e.height=Rq(t[2],e.height,1,i)}(e,t);break;case"object":await async function(e,t){const{resourceSize:i,symbolSize:r}=await async function(e){const t=await import("./symbolLayerUtils.306f3dd5.js"),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(null!=o[l]){a=o[l]/i[l];break}for(let l=0;l<3;l++)null==o[l]&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}(e),s=Lq(t,i,r);e.width=Rq(t[0],r[0],i[0],s),e.depth=Rq(t[1],r[1],i[1],s),e.height=Rq(t[2],r[2],i[2],s)}(e,t)}}(e,t)))}function kq(e){for(const t of e)if("number"==typeof t)return t;return null}function Lq(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return null!=i[r]?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}function Rq(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return null!=t?t:i;default:return e}}async function Dq(e,t){if(e&&t)return tE(e)?Oq(e,t):void(eE(e)&&function(e,t){const i=kq(t);if(!v(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=i,e.height=i*t):(e.width=i*t,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}(e,t))}function Fq(e,t,i){if(e&&null!=t)if(tE(e)){const r=e.symbolLayers;r&&r.forEach((e=>{if(e&&"object"===e.type)switch(i){case"tilt":e.tilt=t;break;case"roll":e.roll=t;break;default:e.heading=t}}))}else eE(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle=t))}let jq=null;function Nq(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function zq(e,t={}){const i="horizontal"===t.align,r=i?75:24,s=i?24:75,{width:n=r,height:o=s,gradient:a=!0}=t,l=window.devicePixelRatio,h=n*l,c=o*l,u=document.createElement("canvas");u.width=h,u.height=c,u.style.width=`${n}px`,u.style.height=`${o}px`;const p=u.getContext("2d"),d=i?h:0,f=i?0:c;if(a){const t=p.createLinearGradient(0,0,d,f),i=e.length,r=1===i?0:1/(i-1);e.forEach(((e,i)=>t.addColorStop(i*r,e.toString()))),p.fillStyle=t,p.fillRect(0,0,h,c)}else{const t=i?h/e.length:h,r=i?c:c/e.length;let s=0,n=0;for(const o of e)p.fillStyle=o.toString(),p.fillRect(s,n,t,r),s=i?s+t:0,n=i?0:n+r}const y=document.createElement("div");return y.style.width=`${n}px`,y.style.height=`${o}px`,y.appendChild(u),y}async function Vq(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:i}=await import("./previewWebStyleSymbol.056fe90d.js");return i(e,Vq,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await Promise.resolve().then((function(){return RTe}));return i(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await import("./previewSymbol2D.8573b129.js");return i(e,t)}case"cim":{const{previewCIMSymbol:i}=await import("./previewCIMSymbol.3d04715a.js");return i(e,t)}default:return}}function Uq(e){return e&&"opacity"in e?e.opacity*Uq(e.parent):1}async function Gq(e,t){var i,r;if(!e)return;const s=e.sourceLayer,n=null!=(i=m(t)&&null!=(r=t.useSourceLayer)&&r?s:e.layer)?i:s,o=Uq(n);if(m(e.symbol)&&(!m(t)||!0!==t.ignoreGraphicSymbol)){const i="web-style"===e.symbol.type?await e.symbol.fetchSymbol(m(t)?t.abortOptions:null):e.symbol.clone();return Cq(i,null,o),i}const l=m(t)&&t.renderer||n&&"renderer"in n&&n.renderer;let h=l&&"getSymbolAsync"in l?await l.getSymbolAsync(e,t):null;if(!h)return;if(h="web-style"===h.type?await h.fetchSymbol(m(t)?t.abortOptions:null):h.clone(),!("visualVariables"in l)||!l.visualVariables||!l.visualVariables.length)return Cq(h,null,o),h;if("arcadeRequiredForVisualVariables"in l&&l.arcadeRequiredForVisualVariables&&(v(t)||v(t.arcade))){const e=a({},t);e.arcade=await i_(),t=e}const c=await Promise.resolve().then((function(){return nj})),u=[],p=[],d=[],f=[];for(const a of l.visualVariables)switch(a.type){case"color":u.push(a);break;case"opacity":p.push(a);break;case"rotation":f.push(a);break;case"size":a.target||d.push(a)}const y=!!u.length&&u[u.length-1],g=y?c.getColor(y,e,t):null,b=!!p.length&&p[p.length-1];let w=b?c.getOpacity(b,e,t):null;if(null!=o&&(w=null!=w?w*o:o),Cq(h,g,w),d.length){const i=c.getAllSizes(d,e,t);await Dq(h,i)}for(const a of f)Fq(h,c.getRotationAngle(a,e,t),a.axis);return h}class Bq{constructor(e=(e=>e.values().next().value)){this._peeker=e,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(0===this._items.size)return;let e;for(e of this._items);return e}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(e){this.contains(e)||this._items.add(e)}contains(e){return this._items.has(e)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(e),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(e),e}remove(e){this._items.delete(e)}filter(e){return this._items.forEach((t=>{e(t)||this._items.delete(t)})),this}}const qq=y("mac")?"Meta":"Ctrl",Hq={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let RCe=48;RCe<58;RCe++)Hq[RCe]=String.fromCharCode(RCe);for(let RCe=1;RCe<25;RCe++)Hq[111+RCe]=`F${RCe}`;for(let RCe=65;RCe<91;RCe++)Hq[RCe]=[String.fromCharCode(RCe+32),String.fromCharCode(RCe)];function Wq(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class $q{constructor(e,t=[]){this.eventType=e,this.keyModifiers=t}matches(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const t=e.modifiers;for(const i of this.keyModifiers)if(!t.has(i))return!1;return!0}}const Jq=Ne.getLogger("esri.views.input.InputHandler");class Xq{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const t=this._incoming[e];for(const e of t)this._incomingEventMatches.push(e.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((e=>e.eventType))),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?Jq.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((e=>this._handleEvent(e))),e.setUninstallCallback((()=>this._onUninstall())),this._manager=e)}onUninstall(){}registerIncoming(e,t,i){let r;"function"==typeof t?(i=t,r=[]):r=t||[];const s="string"==typeof e?new $q(e,r):e,n=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=e=>{const t=this._incoming[e.match.eventType];if(t){const i=t.indexOf(e);t.splice(i,1),n(),this._manager&&this._manager.updateDependencies()}},a=new Kq(s,i,{onPause:o,onRemove:o,onResume:e=>{const t=this._incoming[e.match.eventType];t&&-1===t.indexOf(e)&&(t.push(e),n(),this._manager&&this._manager.updateDependencies())}});let l=this._incoming[s.eventType];return l||(l=[],this._incoming[s.eventType]=l),l.push(a),n(),this._manager&&this._manager.updateDependencies(),a}registerOutgoing(e){if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);const t=new Yq(e,{onEmit:(e,t,i,r)=>{this._manager.emit(e.eventType,t,i,r)},onRemove:e=>{delete this._outgoing[e.eventType],this._manager.updateDependencies()}});return this._outgoing[e]=t,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),t}startCapturingPointer(e){this._manager.setPointerCapture(e,!0)}stopCapturingPointer(e){this._manager.setPointerCapture(e,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Jq.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){const t=this._incoming[e.type];if(t)for(const i of t)if(i.match.matches(e)&&(i.callback(e),e.shouldStopPropagation()))break}}class Kq{constructor(e,t,i){this.match=e,this._callback=t,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class Yq{constructor(e,t){this.eventType=e,this._removed=!1,this._handler=t}emit(e,t,i){this._removed||this._handler.onEmit(this,e,t,i)}remove(){this._removed=!0,this._handler.onRemove(this)}}class Zq extends Xq{constructor(e){super(!0),this._onChange=e,this._value="mouse",this.registerIncoming("pointer-down",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler=this.registerIncoming("pointer-move",(e=>{const t="touch"===e.data.native.pointerType;this._setValue(t?"touch":"mouse")})),this._moveHandler.pause()}_setValue(e){e!==this._value&&("touch"===e?this._moveHandler.resume():this._moveHandler.pause(),this._value=e,this._onChange(e))}}const Qq=Ne.getLogger("esri.views.input.InputManager");let eH=class extends jo{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=qq,this.latestPointerType="mouse",this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null}get hasPendingInputs(){return this._handlers.some((e=>e.handler.hasPendingInputs))}installHandlers(e,t,i=iH.INTERNAL){if(this._nameToGroup[e])return void Qq.error("There is already an InputHandler group registered under the name `"+e+"`");if(0===t.length)return void Qq.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map((e=>({handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null})))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const e=r.handlers[s];this._handlers.push(e),e.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(t,i,r,s,n)=>{this._emitInputEvent(e.priorityIndex+1,t,i,r,n,s)},setPointerCapture:(t,i)=>{this._setPointerCapture(r,e,t,i)},setEventCallback:t=>{e.eventCallback=t},setUninstallCallback:t=>{e.uninstallCallback=t},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach((e=>{e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Qq.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return void 0!==this._nameToGroup[e]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const e=this._handlers[i];e.priorityIndex=i,this._handlersPriority.push(e)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s)for(const t of r.handler.outgoingEventTypes)if(e.has(t)){s=!0;break}if(s)for(const i of r.handler.incomingEventMatches){e.add(i.eventType);for(const e of i.keyModifiers)Wq(e)||t.add(e)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointerType(e){this._set("latestPointerType",e)}_onEventReceived(e,t){if("pointer-capture-lost"===e){const e=t;this._pointerCaptures.delete(e.native.pointerId)}this._updateKeyModifiers(e,t);const i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const e=new Set;this._activeKeyModifiers.forEach((t=>{e.add(t)})),this._activeKeyModifiers=e,i=!0}},s=(e,t)=>{t&&!this._activeKeyModifiers.has(e)?(r(),this._activeKeyModifiers.add(e)):!t&&this._activeKeyModifiers.has(e)&&(r(),this._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){const i=t.key;this._keyModifiers.has(i)&&s(i,"key-down"===e)}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerTypeHandler=new Zq((e=>this._setLatestPointerType(e))),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,iH.INTERNAL),this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler],iH.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),1===n.size&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),0===n.size&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter((e=>!e.removed)),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=void 0!==r?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=void 0!==s&&s,l={event:new tH(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new Bq,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(null==r||!this._stoppedPropagationEventIds.has(r))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){null!=r&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation((()=>this._continuePropagation())))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new Bq;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const e of t.handler.incomingEventMatches){if(i.eventType!==e.eventType)continue;const t=i.keyModifiers.filter((t=>-1!==e.keyModifiers.indexOf(t)));if(t.length===i.keyModifiers.length!=(t.length===e.keyModifiers.length))return i.keyModifiers.length>e.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let e=0;for(;e<t.length&&this._compareHandlerPriority(i,t[e])>=0;)e++;t.splice(e,0,i)}return t}get debug(){const e=e=>{const t=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=t};return{injectEvent:(t,i)=>{e((()=>{this._onEventReceived(t,i)}))},disablePointerCapture:e}}};Q([ro({readOnly:!0})],eH.prototype,"hasPendingInputs",null),Q([ro()],eH.prototype,"eventSource",void 0),Q([ro()],eH.prototype,"recognizers",void 0),Q([ro({readOnly:!0})],eH.prototype,"latestPointerType",void 0),eH=Q([Ro("esri.views.input.InputManager")],eH);class tH{constructor(e,t,i,r,s){this.type=e,this.data=t,this.timestamp=i,this.modifiers=r,this.cancelable=s,this._propagationState=0,this._resumeCallback=null}stopPropagation(){this._propagationState|=1}shouldStopPropagation(){return 0!=(1&this._propagationState)}async(e){this._propagationState|=2;const t=(e,t)=>{this._propagationState&=-3;const i=this._resumeCallback;if(this._resumeCallback=null,i&&i(),t)throw e;return e};return("function"==typeof e?e():e).then((e=>t(e,!1)),(e=>t(e,!0)))}shouldPausePropagation(e){return!!(2&this._propagationState)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}const iH={DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};function rH(e){return e&&"function"==typeof e.highlight}function sH(e,t,i){return v(e)||e>i&&(0===t||e<t)}const nH="esri-icon-zoom-in-magnifying-glass",oH="esri-icon-trash",aH="esri-icon-table",lH=new pS({id:"zoom-to-feature",title:"{messages.zoom}",className:nH}),hH=new pS({id:"remove-selected-feature",title:"{messages.remove}",className:oH}),cH=new pS({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:nH}),uH=new pS({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:aH}),pH=Ne.getLogger("esri.widgets.Popup.PopupViewModel"),dH=function(e){const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new Be("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new Be("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new Be("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new Be("trigger-action:invalid-action","Action is disabled"));if(o===lH.id)return async function(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=fH(e);if(!n){const e=new Be("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});return pH.error(e),Promise.reject(e)}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&"point"===a.type&&function(e,t){if("3d"!==(null==t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let t=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then((e=>{t=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((()=>{const t=new Be("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});pH.error(t)})),t}return!0}(i,r);lH.active=!0,lH.disabled=!0,await e.view.goTo({target:n,scale:l?o:void 0}),lH.active=!1,lH.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}(s.viewModel);if(o===cH.id)return async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new Be("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw pH.error(e),e}if(!t.isAggregate){const e=new Be("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw pH.error(e),e}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],cH.active=!0,cH.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),cH.active=!1,cH.disabled=!1}(s.viewModel);if(o===uH.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===hH.id){s.close();const{selectedFeature:e}=s;if(!e)return Promise.reject(new Be(`trigger-action:${hH.id}`,"selectedFeature is required",{selectedFeature:e}));const{sourceLayer:t}=e;return t?t.remove(e):i.graphics.remove(e),Promise.resolve()}return Promise.resolve()};function fH(e){const{selectedFeature:t,location:i,view:r}=e;return r?"3d"===r.type?t||i:e.get("selectedFeature.geometry")||i:null}const yH=e=>{let t=class extends e{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}};return Q([ro()],t.prototype,"goToOverride",void 0),Q([ro()],t.prototype,"view",void 0),t=Q([Ro("esri.widgets.support.GoTo")],t),t},gH=xh.ofType({key:"type",defaultKeyValue:"button",base:hS,typeMap:{button:pS,toggle:yS}}),mH="esri.widgets.Popup.PopupViewModel",vH=Ne.getLogger(mH);let bH=class extends(yH(UB)){constructor(e){super(e),this._handles=new Mh,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new gH,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new fE({symbol:new BI({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some((e=>e.waitingForContent))}initialize(){this._handles.add([Rh(this,["autoOpenEnabled","view"],(()=>this._autoOpenEnabledChange())),this.on("view-change",(()=>this._autoClose())),Dh(this,["highlightEnabled","selectedFeature","visible","view"],(()=>this._highlightFeature())),Dh(this,"view.animation.state",(e=>this._animationStateChange(e))),Dh(this,"location",(e=>this._locationChange(e))),Dh(this,"selectedFeature",(e=>this._selectedFeatureChange(e))),Dh(this,["selectedFeatureIndex","featureCount","featuresPerPage"],(()=>this._selectedFeatureIndexChange())),Dh(this,["featurePage","selectedFeatureIndex","featureCount","featuresPerPage, featureViewModels"],(()=>this._setGraphicOnFeatureViewModels())),Dh(this,"featureViewModels",(()=>this._featureViewModelsChange())),this.on("trigger-action",(e=>dH({event:e,view:this.view}))),Gh(this,"waitingForResult",(()=>this._waitingForResultChange()),!0),Dh(this,["features","view","view.map","view.spatialReference"],(()=>this._updateFeatureVMs())),Dh(this,["view.scale"],this._viewScaleChange),Gh(this,"visible",(()=>this.browseClusterEnabled=!1)),Dh(this,"browseClusterEnabled",(e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing()))])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new gH;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&("function"==typeof n.getEffectivePopupTemplate&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,h=a&&a.overwriteActions?l:l?l.concat(o):o;return h&&h.filter(Boolean).forEach((t=>e.add(t))),e}get defaultActions(){var e;const t=this._get("defaultActions")||new gH;return t.removeAll(),t.addMany(null!=(e=this.selectedFeature)&&e.isAggregate?[cH.clone(),uH.clone()]:[lH.clone()]),t}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&-1===s?this.selectedFeatureIndex=0:n&&-1!==s||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Xa(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((e=>{this._pendingPromises.add(e);e.then((t=>{this._pendingPromises.has(e)&&this._updateFeatures(t),this._updatePendingPromises(e)}),(()=>this._updatePendingPromises(e)))})),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return-1===t?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=fH(this);if(!t){const i=new Be("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return vH.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const t=new Be("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return vH.error(t),Promise.reject(t)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t=l(a({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{visible:!0}),{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location),this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function(e){e.features=e.features.filter((e=>e.isAggregate))})(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){await async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new Be("displayClusterExtent:invalid-view","View must be 2d MapView.",{view:i});throw pH.error(e),e}if(!t.isAggregate){const e=new Be("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw pH.error(e),e}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}(this),await async function(e){const{selectedFeature:t,view:i}=e;if("2d"!==(null==i?void 0:i.type)){const e=new Be("browseAggregateFeatures:invalid-view","View must be 2d MapView.",{view:i});throw pH.error(e),e}if(!t.isAggregate){const e=new Be("browseAggregateFeatures:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw pH.error(e),e}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],uH.active=!0,uH.disabled=!0;const{features:o}=await s.queryFeatures(n);uH.active=!1,uH.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}(this)}_animationStateChange(e){this.zoomToLocation||(lH.disabled="waiting-for-target"===e)}_clearBrowsedClusterGraphics(){var e;const t=null==(e=this.view)?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){var e;(null!=(e=this.selectedFeature)&&e.isAggregate||this.browseClusterEnabled)&&(this.browseClusterEnabled=!1,this.visible=!1)}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(null===i)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach(((t,i)=>{t&&!t.graphic&&(t.graphic=e[n+i])}))}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled){if(this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),e.isAggregate)return;return e.symbol=await Gq(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature)}!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then((()=>{this.location=r.center.clone()})):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:i}=e,r=Promise.resolve(t),s=i.map((e=>e.promise));this.promises=[r,...s]}))}_destroyFeatureVMs(){this.featureViewModels.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(null!=e&&e.isAggregate||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach(((t,i)=>{if(!t)return;let n=null;if(r.some(((e,i)=>(e&&e.graphic===t&&(n=e,r.splice(i,1)),!!n))),n)s[i]=n;else{var o,a;const r=new MB({defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(o=this.view)?void 0:o.spatialReference,graphic:t===e?t:null,map:null==(a=this.view)?void 0:a.map,view:this.view});s[i]=r}})),r.forEach((e=>e&&!e.destroyed&&e.destroy())),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const i=this.view.on("click",(e=>{"mouse"===e.pointerType&&0!==e.button||this._fetchFeaturesAndOpen(e)}),iH.WIDGET);t.add(i,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=et(),{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch((()=>{})).then((()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")})),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then((e=>{const{clientOnlyGraphics:t,promisesPerLayerView:s,location:n}=e,o=[Promise.resolve(t),...s.map((e=>e.promise))];return r.popup.open({location:n||i,promises:o}),e}))}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return v(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}async _highlightFeature(){const e="highlight";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;let{layer:n,sourceLayer:o}=t;if("map-notes"!==(null==o?void 0:o.type)&&"subtype-group"!==(null==o?void 0:o.type)||(n=o),!(n&&n instanceof Mw))return;const a=this._getLayerView(r,n);this._highlightPromise=a;const l=await a;if(!(l&&rH(l)&&this._highlightPromise===a&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const h="objectIdField"in n&&n.objectIdField,c=t.attributes,u=c&&h&&c[h],p=l.highlight(u||t);this._handles.add(p,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter((e=>-1===t.indexOf(e)));this.features=t.concat(i)}};Q([ro()],bH.prototype,"featurePage",void 0),Q([ro()],bH.prototype,"isLoadingFeature",null),Q([ro({type:gH})],bH.prototype,"actions",void 0),Q([ro({readOnly:!0})],bH.prototype,"active",null),Q([ro({readOnly:!0})],bH.prototype,"allActions",null),Q([ro({type:Boolean})],bH.prototype,"defaultPopupTemplateEnabled",void 0),Q([ro()],bH.prototype,"autoCloseEnabled",void 0),Q([ro()],bH.prototype,"autoOpenEnabled",void 0),Q([ro()],bH.prototype,"browseClusterEnabled",void 0),Q([ro()],bH.prototype,"content",void 0),Q([ro({type:gH,readOnly:!0})],bH.prototype,"defaultActions",null),Q([ro({readOnly:!0})],bH.prototype,"featureCount",null),Q([ro()],bH.prototype,"features",null),Q([ro()],bH.prototype,"featuresPerPage",void 0),Q([ro({readOnly:!0})],bH.prototype,"featureViewModels",void 0),Q([ro()],bH.prototype,"highlightEnabled",void 0),Q([ro()],bH.prototype,"includeDefaultActions",void 0),Q([ro({type:il})],bH.prototype,"location",null),Q([ro({readOnly:!0})],bH.prototype,"pendingPromisesCount",null),Q([ro({readOnly:!0})],bH.prototype,"selectedClusterBoundaryFeature",void 0),Q([ro({readOnly:!0})],bH.prototype,"waitingForResult",null),Q([ro({readOnly:!0})],bH.prototype,"promiseCount",null),Q([ro()],bH.prototype,"promises",null),Q([ro({value:null,readOnly:!0})],bH.prototype,"selectedFeature",null),Q([ro({value:-1})],bH.prototype,"selectedFeatureIndex",null),Q([ro({readOnly:!0})],bH.prototype,"selectedFeatureViewModel",null),Q([ro({readOnly:!0})],bH.prototype,"state",null),Q([ro()],bH.prototype,"title",void 0),Q([ro()],bH.prototype,"updateLocationEnabled",void 0),Q([ro()],bH.prototype,"view",void 0),Q([ro()],bH.prototype,"visible",void 0),Q([ro()],bH.prototype,"zoomFactor",void 0),Q([ro()],bH.prototype,"zoomToLocation",void 0),Q([ro()],bH.prototype,"centerAtLocation",null),bH=Q([Ro(mH)],bH);var wH=bH;const _H="selected-index",xH="popup-spinner",SH="esri-icon-left-triangle-arrow",MH="esri-icon-right-triangle-arrow",TH="esri-icon-maximize",IH="esri-icon-dock-bottom",EH="esri-icon-dock-left",AH="esri-icon-dock-right",PH="esri-icon-close",CH="esri-icon-minimize",OH="esri-icon-check-mark",kH="esri-icon-loading-indicator",LH="esri-icon-default-action",RH="esri-icon-handle-horizontal",DH="esri-rotating",FH="esri-popup",jH="esri-widget",NH="esri-popup__main-container",zH="esri-popup__loading-container",VH="esri-popup--is-collapsible",UH="esri-popup--is-collapsed",GH="esri-popup--shadow",BH="esri-popup--is-docked",qH="esri-popup--is-docked-top-left",HH="esri-popup--is-docked-top-center",WH="esri-popup--is-docked-top-right",$H="esri-popup--is-docked-bottom-left",JH="esri-popup--is-docked-bottom-center",XH="esri-popup--is-docked-bottom-right",KH="esri-popup--aligned-top-center",YH="esri-popup--aligned-bottom-center",ZH="esri-popup--aligned-top-left",QH="esri-popup--aligned-bottom-left",eW="esri-popup--aligned-top-right",tW="esri-popup--aligned-bottom-right",iW="esri-popup--feature-menu-open",rW="esri-popup--actions-menu-open",sW="esri-popup--feature-updated",nW="esri-popup__header",oW="esri-popup__header-buttons",aW="esri-popup__header-container",lW="esri-popup__header-container--button",hW="esri-popup__header-title",cW="esri-popup__content",uW="esri-popup__footer",pW="esri-popup__footer--has-pagination",dW="esri-popup__footer--has-actions",fW="esri-popup__footer--has-actions-menu",yW="esri-popup__button",gW="esri-popup__button--disabled",mW="esri-popup__button--dock",vW="esri-popup__icon",bW="esri-popup__icon--dock-icon",wW="esri-popup__inline-actions-container",_W="esri-popup__actions-menu-button",xW="esri-popup__actions",SW="esri-popup__action",MW="esri-popup__action-image",TW="esri-popup__action-text",IW="esri-popup__action-toggle",EW="esri-popup__action-toggle--on",AW="esri-popup__pointer",PW="esri-popup__pointer-direction",CW="esri-popup__navigation",OW="esri-popup__pagination-previous",kW="esri-popup__pagination-next",LW="esri-popup__pagination-previous-icon",RW="esri-popup__pagination-previous-icon--rtl",DW="esri-popup__pagination-next-icon",FW="esri-popup__pagination-next-icon--rtl",jW="esri-popup__feature-menu",NW="esri-popup__feature-menu-list",zW="esri-popup__feature-menu-item",VW="esri-popup__feature-menu-viewport",UW="esri-popup__feature-menu-header",GW="esri-popup__feature-menu-item--selected",BW="esri-popup__feature-menu-button",qW="esri-popup__feature-menu-title",HW="esri-popup__feature-menu-observer",WW="esri-popup__feature-menu-loader",$W={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},JW="esri-popup";function XW(e,t){return void 0===t?`${JW}__${e}`:`${JW}__${e}-${t}`}const KW="esri.widgets.Popup",YW=Ne.getLogger(KW),ZW={closeButton:!0,featureNavigation:!0};let QW=class extends(TB(xy)){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new Mh,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([e])=>{null!=e&&e.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback),this._displaySpinnerThrottled=fA((()=>this._displaySpinner()),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new wH,this.visible=null,this.visibleElements=a({},ZW),this._addSelectedFeatureIndexHandle(),this.own([Dh(this,"viewModel.screenLocation",(()=>this._positionContainer())),Dh(this,["viewModel.active","dockEnabled"],(()=>this._toggleScreenLocationEnabled())),Dh(this,"viewModel.screenLocation",((e,t)=>{!!e!=!!t&&this.reposition()})),Dh(this,["viewModel.view.padding","viewModel.view.size","viewModel.active","viewModel.location","alignment"],(()=>this.reposition())),Dh(this,"spinnerEnabled",(e=>this._spinnerEnabledChange(e))),Dh(this,"viewModel.view.size",((e,t)=>this._updateDockEnabledForViewSize(e,t))),Dh(this,"viewModel.view",((e,t)=>this._viewChange(e,t))),Dh(this,"viewModel.view.ready",((e,t)=>this._viewReadyChange(e,t))),Dh(this,["viewModel.waitingForResult","viewModel.location"],(()=>{this._hideSpinner(),this._displaySpinnerThrottled()})),Dh(this,"selectedFeatureWidget.viewModel.title",(e=>this._setTitleFromFeatureWidget(e))),Dh(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],(()=>this._setContentFromFeatureWidget())),Gh(this,"collapsed",(()=>{var e,t;"xsmall"===(null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()})),Hh(this,"viewModel.allActions","change",(()=>this._watchActions())),Rh(this,"viewModel.allActions",(()=>this._watchActions())),Dh(this,"viewModel.featureViewModels",(()=>this._featureMenuViewportScrollTop()))])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(e=this._handles)||e.destroy(),this._unobserveFeatureMenuObserver(),null==(t=this._featureMenuIntersectionObserver)||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s;return!!(this.selectedFeatureWidget?(null==(e=this.selectedFeatureWidget)||null==(t=e.viewModel)?void 0:t.waitingForContent)||(null==(i=this.selectedFeatureWidget)||null==(r=i.viewModel)?void 0:r.content):null==(s=this.viewModel)?void 0:s.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||$W}set dockOptions(e){const t=a({},$W),i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s=a(a({},t),e),n=a(a({},t.breakpoint),r),{breakpoint:o}=s;!0===o?s.breakpoint=n:"object"==typeof o&&(s.breakpoint=a(a({},n),o)),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s=l(a({},t),{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new zB({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return a(a({},ZW),e)}blur(){const{active:e}=this.viewModel;e||YW.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||YW.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var t,i;this._handles.remove(_H);const r=!!e&&!!e.featureMenuOpen,s=!!e&&!!e.actionsMenuOpen,n={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:s,featureMenuOpen:r};"xsmall"===(null==(t=this.viewModel)||null==(i=t.view)?void 0:i.widthBreakpoint)&&(n.collapsed=!0),this.set(n),this.viewModel.open(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var e,t,i,r;const{actionsMenuOpen:s,dockEnabled:n,featureMenuVisible:o,dividedActions:a,currentAlignment:l,currentDockPosition:h}=this,{active:c}=this.viewModel,{menuActions:u}=a,p=c&&u.length>1&&s,d=c&&n,f=c&&!n,y=null==(e=this.selectedFeature)||null==(t=e.layer)?void 0:t.title,g=null==(i=this.selectedFeature)||null==(r=i.layer)?void 0:r.id,m={[KH]:"top-center"===l,[YH]:"bottom-center"===l,[ZH]:"top-left"===l,[QH]:"bottom-left"===l,[eW]:"top-right"===l,[tW]:"bottom-right"===l,[BH]:d,[GH]:f,[qH]:"top-left"===h,[HH]:"top-center"===h,[WH]:"top-right"===h,[$H]:"bottom-left"===h,[JH]:"bottom-center"===h,[XH]:"bottom-right"===h,[iW]:o,[rW]:p};return Iy("div",{class:this.classes(FH,m),role:"presentation","data-layer-title":y,"data-layer-id":g,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},c?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Iy("span",{"aria-hidden":"true",class:this.classes(vW,kH,DH)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Iy("div",{key:XW("loading-container"),role:"presentation",class:zH,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=hu(),t={[MH]:e,[RW]:e,[SH]:!e,[LW]:!e};return Iy("span",{"aria-hidden":"true",class:this.classes(vW,t)})}renderPreviousButton(){const{messages:e}=this;return Iy("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(yW,OW),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=hu(),t={[SH]:e,[FW]:e,[MH]:!e,[DW]:!e};return Iy("span",{"aria-hidden":"true",class:this.classes(vW,t)})}renderNextButton(){const{messages:e}=this;return Iy("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(yW,kW),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return Iy("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(yW,BW),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[CH]:e,[bW]:!e,[AH]:!e&&("top-right"===t||"bottom-right"===t),[EH]:!e&&("top-left"===t||"bottom-left"===t),[TH]:!e&&"top-center"===t,[IH]:!e&&"bottom-center"===t};return Iy("span",{"aria-hidden":"true",class:this.classes(i,vW)})}renderDockButton(){var e,t,i;const{dockEnabled:r,messages:s}=this,n=null==(e=this.viewModel)||null==(t=e.view)?void 0:t.widthBreakpoint,o=r?s.undock:s.dock;return"xsmall"!==n&&null!=(i=this.dockOptions)&&i.buttonEnabled?Iy("div",{role:"button","aria-label":o,title:o,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(yW,mW)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[lW]:i},o=Iy(FC,{level:this.headingLevel,class:hW,innerHTML:e}),a=i?Iy("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(aW,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed},o):Iy("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(aW,n)},o);return e?a:null}renderCloseIcon(){return Iy("span",{"aria-hidden":"true",class:this.classes(vW,PH)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?Iy("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:yW,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return Iy("header",{class:nW},this.renderTitle(),Iy("div",{class:oW},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?Iy("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:cW},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?Iy("div",{key:XW("actions-menu-button"),class:this.classes(yW,_W),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},Iy("span",{"aria-hidden":"true",class:RH})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s,inlineActions:n}=r;return s.length&&i?Iy("ul",{id:e,role:"menu","aria-labelledby":t,key:XW("actions"),class:xW,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(((e,t)=>this.renderAction({action:e,index:t+n.length,type:"menu-item"})))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(((e,t)=>this.renderAction({action:e,index:t,type:"inline"})))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?Iy("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:wW},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Iy("section",{key:XW("navigation"),class:this.classes(CW)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[pW]:e,[dW]:s,[fW]:n};return e||s?Iy("div",{key:XW("feature-buttons"),class:this.classes(uW,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=Ve(e.selectedFeatures,{total:t.length});return Iy("section",{key:XW("menu"),class:jW},Iy("strong",{class:UW},r),Iy("nav",{bind:this,class:VW,"data-node-ref":"_featureMenuViewportNode",afterCreate:uu},this.renderFeatureMenu(),Iy("div",{class:HW,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?Iy("div",{class:WW},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:Iy("div",{key:XW("pointer"),class:AW,role:"presentation"},Iy("div",{class:this.classes(PW,GH)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:h}=this.viewModel,c="bottom-left"===t||"bottom-center"===t||"bottom-right"===t||"top-left"===i||"top-center"===i||"top-right"===i,u="top-left"===t||"top-center"===t||"top-right"===t||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,p={[GH]:e,[VH]:n,[UH]:a};return Iy("div",{class:this.classes(NH,jH,p),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":h?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},c?this.renderFooter():null,c?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),u?this.renderFooter():null,u?this.renderFeatureMenuContainer():null)}renderContent(){var e;const t=null==(e=this.viewModel)?void 0:e.content;return t?"string"==typeof t?Iy("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}renderActionText(e){return Iy("span",{key:"text",class:TW},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[kH]:e.active,[DH]:e.active,[vW]:!!t,[MW]:!e.active&&!!i};return t&&(r[t]=!e.active),Iy("span",{key:"icon","aria-hidden":"true",class:this.classes(vW,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,index:i,type:r}=e,s=this._getActionTitle(t),n={[SW]:"toggle"!==t.type,[IW]:"toggle"===t.type,[EW]:"toggle"===t.type&&t.value,[gW]:t.disabled},o=[this.renderActionIcon(t),this.renderActionText(s)],a="menu-item"===r?Iy("li",{key:t.uid,role:"menuitem",tabIndex:0,title:s,"aria-label":s,class:this.classes(yW,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o):Iy("div",{key:t.uid,role:"button",tabIndex:0,title:s,"aria-label":s,class:this.classes(yW,n),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":i,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return t.visible?a:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[GW]:o},l=o?Iy("span",{key:XW(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:OH}):null,h=Iy("span",{innerHTML:e.title||r.untitled});return Iy("li",{role:"menuitem",tabIndex:-1,key:XW(`feature-menu-feature-${s}`),class:this.classes(a,zW),bind:this,"data-feature-index":t,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},Iy("span",{class:qW},h,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?Iy("ol",{class:NW,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter((e=>!!e.graphic)).map(((e,t)=>this.renderFeatureMenuItem(e,t)))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=null==i?void 0:i.attributes,o="zoom-to-feature"===s?Ve(e.title,{messages:t}):"remove-selected-feature"===s?Ve(e.title,{messages:r}):"zoom-to-clustered-features"===s||"browse-clustered-features"===s?Ve(e.title,{messages:t}):e.title;return o&&n?Ve(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:LH;return n&&i?Ve(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=null==t?void 0:t.attributes,{image:r}=e;return r&&i?Ve(r,i):r}_createFeatureUpdatedAnimation(){return pu("enter",sW)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if("number"!=typeof e)return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach((e=>{this._handles.add(Dh(e,["active","className","disabled","id","title","image","visible"],(()=>this.scheduleRender())),t)}))}_divideActions(){const{allActions:e}=this.viewModel,t=this._getInlineActionCount(),i=null===t,r=0===t;return{inlineActions:i?e.slice(0):r?new xh:e.slice(0,t),menuActions:i?new xh:r?e.slice(0):e.slice(t)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(e){const{selectedFeatureWidget:t}=this;t&&(this.viewModel.title=e||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){"Escape"===Ke(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){"Escape"===Ke(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_handleFeatureMenuItemKeyup(e){const t=Ke(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=Ke(e),{_actionsMenuNode:i}=this,r=e.currentTarget["data-action-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleMainKeyup(e){const t=Ke(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}_addSelectedFeatureIndexHandle(){const e=Dh(this,"viewModel.selectedFeatureIndex",((e,t)=>this._selectedFeatureIndexUpdated(e,t)));this._handles.add(e,_H)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return"right"===s&&r.x+i/2>n.width-o.right||"left"===s&&r.x-i/2<o.left||"top"===s&&r.y-t<o.top||"bottom"===s&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if("auto"!==e)return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(v(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,h=l?a(l.getPropertyValue("max-height")):0,c=l?a(l.getPropertyValue("height")):0,{height:u,width:p}=i.getBoundingClientRect(),d=p+t,f=Math.max(u,h,c)+t,y=this._isOutsideView({popupHeight:f,popupWidth:d,screenLocation:n,side:"right",view:o}),g=this._isOutsideView({popupHeight:f,popupWidth:d,screenLocation:n,side:"left",view:o}),m=this._isOutsideView({popupHeight:f,popupWidth:d,screenLocation:n,side:"top",view:o}),b=this._isOutsideView({popupHeight:f,popupWidth:d,screenLocation:n,side:"bottom",view:o});return g?m?"bottom-right":"top-right":y?m?"bottom-left":"top-left":m?b?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return"function"==typeof e?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return hu()&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return"function"==typeof e?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(e=this.dockOptions)?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var t;if("auto"!==e)return e;const i=null==(t=this.viewModel)?void 0:t.view,r=hu()?"top-left":"top-right";if(!i)return r;const s=i.padding||{left:0,right:0,top:0,bottom:0},n=i.width-s.left-s.right,{breakpoints:o}=i;return o&&n<=o.xsmall?"bottom-center":r}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:h}=this.view;return"bottom-center"===s?{top:t+n-h.top,left:e-o-h.left}:"top-left"===s?{bottom:a+n-h.bottom,right:l+n-h.right}:"bottom-left"===s?{top:t+n-h.top,right:l+n-h.right}:"top-right"===s?{bottom:a+n-h.bottom,left:e+n-h.left}:"bottom-right"===s?{top:t+n-h.top,left:e+n-h.left}:"top-center"===s?{bottom:a+n-h.bottom,left:e-o-h.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(v(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:void 0!==n.top?`${n.top}px`:"auto",left:void 0!==n.left?`${n.left}px`:"auto",bottom:void 0!==n.bottom?`${n.bottom}px`:"auto",right:void 0!==n.right?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const e=this.get("viewModel.view");this._wireUpView(e)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var t,i;const r=e.breakpoint,s=null==(t=this.viewModel)||null==(i=t.view)?void 0:i.ui;if(!s)return!1;const{width:n,height:o}=s;if(isNaN(n)||isNaN(o))return!1;const a=r.hasOwnProperty("width")&&n<=r.width,l=r.hasOwnProperty("height")&&o<=r.height;return a||l}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?Ve(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,xH),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new JB({view:e}),e.ui.add(this._spinner,{key:xH,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget["data-action-index"],i=this.viewModel.allActions.getItemAt(t);i&&"toggle"===i.type&&(i.value=!i.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(t)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};Q([ro({readOnly:!0})],QW.prototype,"actionsMenuId",null),Q([ro({readOnly:!0})],QW.prototype,"actionsMenuButtonId",null),Q([ro({readOnly:!0})],QW.prototype,"featureMenuId",null),Q([ro({readOnly:!0})],QW.prototype,"titleId",null),Q([ro({readOnly:!0})],QW.prototype,"contentId",null),Q([ro({readOnly:!0})],QW.prototype,"hasContent",null),Q([ro({readOnly:!0})],QW.prototype,"featureNavigationVisible",null),Q([ro({readOnly:!0})],QW.prototype,"collapsible",null),Q([ro({readOnly:!0})],QW.prototype,"featureMenuVisible",null),Q([ro({readOnly:!0})],QW.prototype,"contentCollapsed",null),Q([ro({readOnly:!0})],QW.prototype,"dividedActions",null),Q([eh("viewModel.actions")],QW.prototype,"actions",void 0),Q([ro()],QW.prototype,"actionsMenuOpen",null),Q([ro()],QW.prototype,"alignment",void 0),Q([eh("viewModel.autoCloseEnabled")],QW.prototype,"autoCloseEnabled",void 0),Q([eh("viewModel.autoOpenEnabled")],QW.prototype,"autoOpenEnabled",void 0),Q([eh("viewModel.defaultPopupTemplateEnabled")],QW.prototype,"defaultPopupTemplateEnabled",void 0),Q([eh("viewModel.content")],QW.prototype,"content",void 0),Q([ro()],QW.prototype,"collapsed",void 0),Q([ro()],QW.prototype,"collapseEnabled",void 0),Q([ro({readOnly:!0})],QW.prototype,"currentAlignment",null),Q([ro({readOnly:!0})],QW.prototype,"currentDockPosition",null),Q([ro()],QW.prototype,"dockOptions",null),Q([ro()],QW.prototype,"dockEnabled",void 0),Q([eh("viewModel.featureCount")],QW.prototype,"featureCount",void 0),Q([ro()],QW.prototype,"featureMenuOpen",void 0),Q([eh("viewModel.features")],QW.prototype,"features",void 0),Q([eh("viewModel.goToOverride")],QW.prototype,"goToOverride",void 0),Q([ro()],QW.prototype,"headingLevel",void 0),Q([eh("viewModel.highlightEnabled")],QW.prototype,"highlightEnabled",void 0),Q([eh("viewModel.location")],QW.prototype,"location",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],QW.prototype,"label",void 0),Q([ro()],QW.prototype,"maxInlineActions",void 0),Q([ro(),Sy("esri/widgets/Popup/t9n/Popup")],QW.prototype,"messages",void 0),Q([ro(),Sy("esri/t9n/common")],QW.prototype,"messagesCommon",void 0),Q([eh("viewModel.promises")],QW.prototype,"promises",void 0),Q([eh("viewModel.selectedFeature")],QW.prototype,"selectedFeature",void 0),Q([eh("viewModel.selectedFeatureIndex")],QW.prototype,"selectedFeatureIndex",void 0),Q([ro({readOnly:!0})],QW.prototype,"selectedFeatureWidget",null),Q([ro()],QW.prototype,"spinnerEnabled",void 0),Q([eh("viewModel.title")],QW.prototype,"title",void 0),Q([eh("viewModel.updateLocationEnabled")],QW.prototype,"updateLocationEnabled",void 0),Q([eh("viewModel.view")],QW.prototype,"view",void 0),Q([ro({type:wH}),Ny(["triggerAction","trigger-action"])],QW.prototype,"viewModel",void 0),Q([eh("viewModel.visible")],QW.prototype,"visible",void 0),Q([ro()],QW.prototype,"visibleElements",void 0),Q([Ra("visibleElements")],QW.prototype,"castVisibleElements",null),Q([Fy()],QW.prototype,"_close",null),Q([Fy()],QW.prototype,"_toggleDockEnabled",null),Q([Fy()],QW.prototype,"_toggleFeatureMenu",null),Q([Fy()],QW.prototype,"_toggleActionsMenu",null),Q([Fy()],QW.prototype,"_triggerAction",null),Q([Fy()],QW.prototype,"_selectFeature",null),Q([Fy()],QW.prototype,"_next",null),Q([Fy()],QW.prototype,"_previous",null),QW=Q([Ro(KW)],QW);var e$=QW;const t$=[0,0];function i$(e){e&&(oh(e),e.parentNode&&e.parentNode.removeChild(e))}const r$=e=>{let t=class extends e{constructor(...e){super(...e),this._freqInfo={freq:16,time:750},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([this.watch("cursor",(e=>{const t=this.surface;t&&t.setAttribute("data-cursor",e)})),this.watch("interacting",(e=>{const t=this.surface;t&&t.setAttribute("data-interacting",e.toString())}))])}initialize(){this.handles.add(this.watch("ui",((e,t)=>this._handleUIChange(e,t)))),this._wireUI(this.ui),this.handles.add([this.on("focus",(()=>this.notifyChange("focused"))),this.on("blur",(()=>this.notifyChange("focused")))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(e){const t=this._get("container");if(t===e)return;const i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),i$(this.root),this._set("root",null),lh(this.userContent,t),i$(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");const t=document.createElement("div");t.className="esri-view-user-storage",lh(e,t),e.appendChild(t),this._set("userContent",t);const r=document.createElement("div");r.className="esri-view-root",e.insertBefore(r,e.firstChild),this._set("root",r);const s=document.createElement("div");s.className="esri-view-surface",s.setAttribute("role","application"),s.tabIndex=0,r.appendChild(s),this._set("surface",s);const n=new dA;r.appendChild(n.surface),this._set("overlay",n),n.watch("needsRender",(e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=en({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add(Rh(this,"size",(e=>{const[t,i]=e,r="esri-view-surface--inset-outline";t>=document.body.clientWidth||i>=document.body.clientHeight?s.classList.add(r):s.classList.remove(r)})),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get popup(){return this._get("popup")||new e$({view:this})}set popup(e){const t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(e,t,i){const r=this.position;return e-=r[0],t-=r[1],i?(i[0]=e,i[1]=t):i=[e,t],i}containerToPage(e,t,i){const r=this.position;return e+=r[0],t+=r[1],i?(i[0]=e,i[1]=t):i=[e,t],i}_handleUIChange(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}_wireUI(e){this.handles.remove("ui"),e&&(e.view=this,this.handles.add([Rh(this,"root",(t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null})),Rh(this,"popup",((t,i)=>{const r="popup";i&&e.remove(i,r),t&&(t.view=e.view,e.add(t,{key:r,position:"manual"}))}))],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=16,e.time=750,this.handles.add([(()=>{const t=()=>{e.freq=16,e.time=750};return window.addEventListener("resize",t),{remove(){window.removeEventListener("resize",t)}}})(),en({prepare:e=>{const t=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,t&&(i.freq=16,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const r=this._position();i.freq=r||t?16:Math.min(750,2*i.freq),!t&&i.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,i=e?e.clientHeight:0;if(0===t||0===i)return this.suspended||this._set("suspended",!0),!1;const r=this.width,s=this.height;return t===r&&i===s?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",i),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:r,oldHeight:s,width:t,height:i}),!0)}_position(){const e=this.container,t=this.position,i=function(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return t$[0]=i.left+t.pageXOffset,t$[1]=i.top+t.pageYOffset,t$}(e);return!(t&&i[0]===t[0]&&i[1]===t[1]||(this._set("position",[i[0],i[1]]),0))}forceDOMReadyCycle(){}};return Q([ro({value:null,cast:e=>nh(e)})],t.prototype,"container",null),Q([ro({readOnly:!0})],t.prototype,"focused",null),Q([ro({readOnly:!0})],t.prototype,"height",void 0),Q([ro({type:e$})],t.prototype,"popup",null),Q([ro({type:dA})],t.prototype,"overlay",void 0),Q([ro({readOnly:!0})],t.prototype,"position",void 0),Q([ro({readOnly:!0})],t.prototype,"resizing",void 0),Q([ro({readOnly:!0})],t.prototype,"root",void 0),Q([ro({value:null,readOnly:!0})],t.prototype,"size",null),Q([ro({readOnly:!0})],t.prototype,"surface",void 0),Q([ro({readOnly:!0})],t.prototype,"suspended",void 0),Q([ro()],t.prototype,"ui",void 0),Q([ro({readOnly:!0})],t.prototype,"userContent",void 0),Q([ro({readOnly:!0})],t.prototype,"width",void 0),Q([ro()],t.prototype,"widthBreakpoint",void 0),t=Q([Ro("esri.views.DOMContainer")],t),t};function s$(e){return e&&"focus"in e}function n$(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function o$(e,t){return Fm(e,Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10])),e}class a${constructor(e,t){this.min=e,this.max=t,this.range=t-e}ndiff(e,t=0){return Math.ceil((e-t)/this.range)*this.range+t}_normalize(e,t,i,r=0,s=!1){return(i-=r)<e?i+=this.ndiff(e-i):i>t&&(i-=this.ndiff(i-t)),s&&i===t&&(i=e),i+r}normalize(e,t=0,i=!1){return this._normalize(this.min,this.max,e,t,i)}clamp(e,t=0){return mv(e-t,this.min,this.max)+t}monotonic(e,t,i){return e<t?t:t+this.ndiff(e-t,i)}minimalMonotonic(e,t,i){return this._normalize(e,e+this.range,t,i)}center(e,t,i){return t=this.monotonic(e,t,i),this.normalize((e+t)/2,i)}diff(e,t,i){return this.monotonic(e,t,i)-e}shortestSignedDiff(e,t){e=this.normalize(e);const i=(t=this.normalize(t))-e,r=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(i)<Math.abs(r)?i:r}contains(e,t,i){return t=this.minimalMonotonic(e,t),(i=this.minimalMonotonic(e,i))>e&&i<t}}function l$(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}l$(new a$(0,2*Math.PI));const h$=l$(new a$(-Math.PI,Math.PI)),c$=l$(new a$(0,360));var u$;let p$=u$=class extends Ko{constructor(...e){super(...e),this.position=new il([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const s={position:e};return null!=t&&(s.heading=t),null!=i&&(s.tilt=i),null!=r&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=Rn(e.x||0),s.y=Rn(e.y||0),s.z=e.hasZ?Rn(e.z||0):e.z,t[i]=s.write(null,r)}readPosition(e,t){const i=new il;return i.read(e,t),i.x=Rn(i.x||0),i.y=Rn(i.y||0),i.z=i.hasZ?Rn(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}clone(){return new u$({position:this.position.clone(),heading:this.heading,tilt:this.tilt,fov:this.fov})}};Q([ro({type:il,json:{write:{isRequired:!0}}})],p$.prototype,"position",void 0),Q([na("position")],p$.prototype,"writePosition",null),Q([sa("position")],p$.prototype,"readPosition",null),Q([ro({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Ra((e=>c$.normalize(Rn(e))))],p$.prototype,"heading",void 0),Q([ro({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Ra((e=>mv(Rn(e),-180,180)))],p$.prototype,"tilt",void 0),Q([ro({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],p$.prototype,"fov",void 0),p$=u$=Q([Ro("esri.Camera")],p$);var d$,f$=p$;let y$=d$=class extends Ko{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new d$({rotation:this.rotation,scale:this.scale,targetGeometry:m(this.targetGeometry)?this.targetGeometry.clone():null,camera:m(this.camera)?this.camera.clone():null})}};function g$(){return{enabled:!this.camera}}Q([ro({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:g$}}}}})],y$.prototype,"rotation",void 0),Q([Ra("rotation")],y$.prototype,"castRotation",null),Q([ro({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:g$}}}}})],y$.prototype,"scale",void 0),Q([ro({types:mw,json:{read:dw,write:!0,origins:{"web-scene":{read:dw,write:{overridePolicy:g$}}}}})],y$.prototype,"targetGeometry",void 0),Q([ro({type:f$,json:{write:!0}})],y$.prototype,"camera",void 0),y$=d$=Q([Ro("esri.Viewpoint")],y$);var m$=y$;function v$(e=U$){return[e[0],e[1],e[2],e[3]]}function b$(e){return[e[0],e[1],e[2],e[3]]}function w$(e,t,i,r,s=v$()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function _$(e,t=v$()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function x$(e,t){return new Ol({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function S$(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function M$(e,t,i=e){if("length"in t)!function(e){return 4===e.length}(t)?2!==t.length&&3!==t.length||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1])):(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}return i}function T$(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const e=t[l];s=Math.min(s,e[0]),n=Math.min(n,e[1]),o=Math.max(o,e[0]),a=Math.max(a,e[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function I$(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function E$(e){return e[0]>=e[2]?0:e[2]-e[0]}function A$(e){return e[1]>=e[3]?0:e[3]-e[1]}function P$(e){return E$(e)*A$(e)}function C$(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function O$(e,t){return L$(e,t[0],t[1])}function k$(e,t){return L$(e,t.x,t.y)}function L$(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function R$(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function D$(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function F$(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function j$(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function N$(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function z$(e){return e?N$(e,V$):v$(V$)}const V$=[1/0,1/0,-1/0,-1/0],U$=[0,0,0,0];var G$;let B$=G$=class extends Ko{constructor(e){super(e),this.level=0,this.levelValue=null,this.resolution=0,this.scale=0}clone(){return new G$({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})}};Q([ro({type:Yn,json:{write:!0}})],B$.prototype,"level",void 0),Q([ro({type:String,json:{write:!0}})],B$.prototype,"levelValue",void 0),Q([ro({type:Number,json:{write:!0}})],B$.prototype,"resolution",void 0),Q([ro({type:Number,json:{write:!0}})],B$.prototype,"scale",void 0),B$=G$=Q([Ro("esri.layers.support.LOD")],B$);var q$,H$=B$;const W$=new ee({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let $$=q$=class extends Ko{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=Aa.WebMercator,numLODs:n=24}=e;if(!Ma(s)){const e=[];if(i)for(let t=0;t<i.length;t++){const r=i[t];e.push({level:t,scale:r,resolution:r})}else{let t=5e-4;for(let i=n-1;i>=0;i--)e.unshift({level:i,scale:t,resolution:t}),t*=2}return new q$({dpi:96,lods:e,origin:new il(0,0,s),size:[r,r],spatialReference:s})}const o=ya(s),a=e.origin?new il({x:e.origin.x,y:e.origin.y,spatialReference:s}):new il(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=1/(39.37*VA(s)*96),h=[];if(i)for(let c=0;c<i.length;c++){const e=i[c],t=e*l;h.push({level:c,scale:e,resolution:t})}else{let e=ga(s)?512/r*591657527.5917094:256/r*591657527.591555;const i=Math.ceil(n/t);h.push({level:0,scale:e,resolution:e*l});for(let r=1;r<i;r++){const i=e/2**t,s=i*l;h.push({level:r,scale:i,resolution:s}),e=i}}return new q$({dpi:96,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=ya(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return il.fromJSON(a({spatialReference:t.spatialReference},e))}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach((e=>{r.push(e.scale),t=e.scale>t?e.scale:t,i=e.scale<i?e.scale:i,this._levelToLOD[e.level]=e}))),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[0]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const i=t[r],s=t[r+1];if(i<=e)return r;if(s===e)return r+1;if(i>e&&s<e)return r+Math.log(i/e)/Math.log(i/s)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if("number"==typeof t)n=t,o=i;else if(fa(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const e=Wa(t,this.spatialReference);if(!e)return null;n=e.x,o=e.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:v$()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=0){let i=this.lodAt(e.level);if(!i&&1===t){const t=this.lods[this.lods.length-1];t.level<e.level&&(i=t)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=v$()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return q$.fromJSON(this.write({}))}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};Q([ro({type:Number,json:{write:!0}})],$$.prototype,"compressionQuality",void 0),Q([ro({type:Number,json:{write:!0}})],$$.prototype,"dpi",void 0),Q([ro({type:String,json:{read:W$.read,write:W$.write,origins:{"web-scene":{read:!1,write:!1}}}})],$$.prototype,"format",void 0),Q([ro({readOnly:!0})],$$.prototype,"isWrappable",null),Q([ro({type:il,json:{write:!0}})],$$.prototype,"origin",void 0),Q([sa("origin")],$$.prototype,"readOrigin",null),Q([ro({type:[H$],value:null,json:{write:!0}})],$$.prototype,"lods",null),Q([ro({readOnly:!0})],$$.prototype,"minScale",void 0),Q([ro({readOnly:!0})],$$.prototype,"maxScale",void 0),Q([ro({readOnly:!0})],$$.prototype,"scales",void 0),Q([ro({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],$$.prototype,"size",void 0),Q([sa("size",["rows","cols"])],$$.prototype,"readSize",null),Q([na("size",{cols:{type:Yn},rows:{type:Yn}})],$$.prototype,"writeSize",null),Q([ro({type:Aa,json:{write:!0}})],$$.prototype,"spatialReference",void 0),$$=q$=Q([Ro("esri.layers.support.TileInfo")],$$);var J$=$$;const X$=e=>{let t=class extends e{async fetchPopupFeatures(e,t){await this.when();const{location:i,queryArea:r,layerViewsAndGraphics:s,clientOnlyGraphics:n}=await this._prepareFetchPopupFeatures(e,t),o=Promise.resolve(n),a=this._queryLayerPopupFeatures({queryArea:r,layerViewsAndGraphics:s,options:t});return{location:i,clientOnlyGraphics:n,allGraphicsPromise:dt([o,...a.map((e=>e.promise))]).then(cs),promisesPerLayerView:a}}_queryLayerPopupFeatures({queryArea:e,layerViewsAndGraphics:t,options:i}){return t.map((({layerView:t,graphics:r})=>{const s={clientGraphics:r,event:m(i)?i.event:null,signal:m(i)?i.signal:null,defaultPopupTemplateEnabled:!!m(i)&&!!i.defaultPopupTemplateEnabled},n=t.fetchPopupFeatures(e,s);return{layerView:t,promise:n}}))}_isValidPopupGraphic(e,t){return e&&!!e.getEffectivePopupTemplate(m(t)&&t.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(e,t){const{clientGraphics:i,queryArea:r,location:s}=await this._popupHitTestGraphics(e,t),n=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:o,clientOnlyGraphics:a}=this._graphicsPerFetchPopupLayerView(i,n);return{clientOnlyGraphics:a,layerViewsAndGraphics:o,queryArea:r,location:s}}async _popupHitTestGraphics(e,t){const{results:i,mapPoint:r}=await this.popupHitTest(e),s=i.filter((e=>this._isValidPopupGraphic(e.graphic,t))),n=s.length?s[0].mapPoint:null;return{clientGraphics:s.map((e=>e.graphic)),queryArea:r,location:r||n}}_getFetchPopupLayerViews(){const e=[];return this.allLayerViews.forEach((t=>{this._isValidPopupLayerView(t)&&e.push(t)})),m(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&e.push(this.graphicsView),e.reverse()}_isValidPopupLayerView(e){return m(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}_graphicsPerFetchPopupLayerView(e,t){const i=[],r=new Map,s=t.map((e=>{const t=[];return"layer"in e?r.set(e.layer,t):r.set(e.graphics,t),{layerView:e,graphics:t}}));for(const n of e){const e=r.get(n.layer)||r.get(n.sourceLayer)||null;e?e.push(n):i.push(n)}return{layerViewsAndGraphics:s,clientOnlyGraphics:i}}};return t=Q([Ro("esri.views.PopupView")],t),t},K$=xh.ofType(fE);Ne.getLogger("esri.support.GraphicsCollection");let Y$=class extends K${constructor(e){super(e),this.on("before-add",(e=>{e.item||e.preventDefault()})),this.on("after-add",(e=>this._own(e.item))),this.on("after-remove",(({item:e})=>{e.layer=null}))}destroy(){this._unownAll()}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._unownAll(),this._set("owner",e),this._ownAll())}_createNewInstance(e){return new K$(e)}_ownAll(){this.items.forEach((e=>this._own(e)))}_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_unownAll(){this.items.forEach((e=>this._unown(e)))}_unown(e){e.layer===this.owner&&(e.layer=null)}};Q([ro()],Y$.prototype,"owner",null),Y$=Q([Ro("esri.support.GraphicsCollection")],Y$);const Z$=(e="graphics")=>({type:Y$,cast:kg,set(t){const i=Og(t,this._get(e),Y$);i.owner=this,this._set(e,i)}});var Q$=Y$;let eJ=class extends jo{constructor(e){super(e),this.view=null,this.baseLayerViews=new xh,this.referenceLayerViews=new xh,this._loadingHandle=Rh(this,"view.map.basemap",(e=>{e&&e.load().catch((()=>{}))}))}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){return!(this.view&&this.view.suspended||!(this.view&&this.view.map&&this.view.map.basemap)||this.view.map.basemap.loaded)}};function tJ(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function iJ(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}Q([ro({constructOnly:!0})],eJ.prototype,"view",void 0),Q([ro({readOnly:!0})],eJ.prototype,"baseLayerViews",void 0),Q([ro({readOnly:!0})],eJ.prototype,"referenceLayerViews",void 0),Q([ro({readOnly:!0})],eJ.prototype,"suspended",null),Q([ro({type:Boolean,readOnly:!0})],eJ.prototype,"updating",null),eJ=Q([Ro("esri.views.BasemapView")],eJ);const rJ=Ne.getLogger("esri.views.LayerViewManager");class sJ{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=et(),this._deferred=ut(),this._started=!1,this.done=!1,ot(this._controller.signal,(()=>{const t=new Be("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{var r,s;let n,o;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)n=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new Be("layer:view-not-supported","No layerview implementation was found");const r=await this.layerViewImporter.importLayerView(t);tt(e),n="default"in r?new r.default({layer:t,view:i}):new r({layer:t,view:i})}const a=()=>{o=I(o),n.destroyed||n.destroy(),n.layer=null,n.parent=null,n.view=null,this.done=!0};o=ot(e,a),tt(e);try{await n.when()}catch(ia){throw a(),ia}if(!(null==(r=this._map)||null==(s=r.allLayers)?void 0:s.includes(t)))return a(),void this._deferred.reject(new Be("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=n,t.emit("layerview-create",{view:i,layerView:n}),i.emit("layerview-create",{layer:t,layerView:n}),this.done=!0,this._deferred.resolve(n)}catch(ia){t.emit("layerview-create-error",{view:i,error:ia}),i.emit("layerview-create-error",{layer:t,error:ia}),this.done=!0,this._deferred.reject(new Be("layerview:create-error","layerview creation failed",{layer:t,error:ia}))}}}let nJ=class extends Jv{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Hv,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var e;const t=null==(e=this.view.map)?void 0:e.allLayers;if(t)for(const i of t)this.layerViewImporter.hasLayerViewModule(i)&&this.layerViewImporter.importLayerView(i)},this._reschedule=()=>(v(this._workPromise)&&(this._workPromise=ut()),this.handles.remove("reschedule"),this.handles.add(Qs(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var e,t,i;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),v(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const s=new Kv({getCollections:()=>this._rootCollectionNames.map((e=>this.get(e))),getChildrenFunction:e=>e&&"layers"in e?e.layers:null});if(!s)return this._workPromise.resolve(),void(this._workPromise=null);for(const a of s)this._createLayerView(a);this._refreshCollections();for(const[a,l]of this._layerLayerViewInfoMap)s.includes(a)||(this._layerLayerViewInfoMap.delete(l.layer),l.destroy());const n=s.filter((e=>"group"===e.type)).map((e=>e.layers)),o=[null==r||null==(e=r.ground)?void 0:e.layers,null==r||null==(t=r.basemap)?void 0:t.baseLayers,null==r||null==(i=r.basemap)?void 0:i.referenceLayers,null==r?void 0:r.layers,...n].filter((e=>!!e));this.handles.add(o.map((e=>this._watchUpdatingTracking.addOnCollectionChange(e,this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([Hh(this,"view.map.allLayers","change",this._preloadLayerViewModules,this._preloadLayerViewModules),Rh(this.view,["map.basemap","map.ground","map.layers","ready"],this._reschedule,!0)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return m(this._workPromise)||this._watchUpdatingTracking.updating||tJ(this._layerLayerViewInfoMap,(e=>!e.done))}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new Be("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const e=this._layerLayerViewInfoMap.get(s);if(!e||!e.layerView)continue;const n=e.layerView;n.layer=s,n.parent=i,t.getItemAt(r)!==n&&t.splice(r,0,n),s.layers&&this._populateLayerViewsOwners(s.layers,n.layerViews,n),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new sJ(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{var i,r;t&&(ht(t)||"cancelled:layerview-create"===t.name)||rJ.error(`Failed to create layerview for layer title:'${null!=(i=e.title)?i:"no title"}', id:'${null!=(r=e.id)?r:"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};Q([ro()],nJ.prototype,"_workPromise",void 0),Q([ro({readOnly:!0})],nJ.prototype,"_watchUpdatingTracking",void 0),Q([ro({readOnly:!0})],nJ.prototype,"_layersToLayerViews",null),Q([ro({readOnly:!0})],nJ.prototype,"_rootCollectionNames",null),Q([ro()],nJ.prototype,"layerViewImporter",void 0),Q([ro()],nJ.prototype,"supportsGround",void 0),Q([ro({readOnly:!0})],nJ.prototype,"updating",null),Q([ro({readOnly:!0})],nJ.prototype,"updatingRemaining",null),Q([ro({constructOnly:!0})],nJ.prototype,"view",void 0),nJ=Q([Ro("esri.views.LayerViewManager")],nJ);var oJ=nJ;let aJ=class extends jo{constructor(e){super(e),this.factor=1.5,this.offset=FS(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};Q([ro({type:Number})],aJ.prototype,"factor",void 0),Q([ro({nonNullable:!0})],aJ.prototype,"offset",void 0),Q([ro()],aJ.prototype,"position",void 0),Q([ro({type:Number,range:{min:0}})],aJ.prototype,"size",void 0),Q([ro()],aJ.prototype,"maskUrl",void 0),Q([ro()],aJ.prototype,"maskEnabled",void 0),Q([ro()],aJ.prototype,"overlayUrl",void 0),Q([ro()],aJ.prototype,"overlayEnabled",void 0),Q([ro({readOnly:!0})],aJ.prototype,"version",null),Q([ro({type:Boolean})],aJ.prototype,"visible",void 0),aJ=Q([Ro("esri.views.Magnifier")],aJ);var lJ=aJ;const hJ=e=>{let t=class extends e{constructor(){super(...arguments),this.refreshTimestamp=null,this.refreshDebounced=wt((async(e,t)=>{let i;"number"==typeof e?i=e:(i=Date.now(),t=e),this._set("refreshTimestamp",i),this.doRefresh&&await this.doRefresh(t).catch((e=>{ht(e)||Ne.getLogger(this.declaredClass).error(e)}))}),2e3)}refresh(e=Date.now()){this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh().catch((e=>{ht(e)||Ne.getLogger(this.declaredClass).error(e)}))}};return Q([ro()],t.prototype,"layer",void 0),Q([eh("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),Q([ro({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),t=Q([Ro("esri.layers.mixins.RefreshableLayerView")],t),t};function cJ(e){return"refresh"in e}let uJ=class extends sh.EventedAccessor{constructor(){super(...arguments),this._handles=new Mh,this._currentTick=0}initialize(){this._handles.add([this.view.allLayerViews.on("after-changes",(()=>{this.notifyChange("tickInterval"),this._handles.remove("layerViewsUpdating"),this._handles.add(this._getLayerViewHandles(),"layerViewsUpdating")})),this.watch("tickInterval",(()=>this._restartTicking())),this.watch("view.ready",(()=>this._restartTicking()))]),this._restartTicking()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null,this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)}get tickInterval(){const e=this.view.allLayerViews.filter((e=>cJ(e)));return this._getCommonInterval(e)}_restartTicking(){this._currentTick=0,this._intervalID&&clearInterval(this._intervalID),this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval((()=>{const e=Date.now();this._currentTick+=this.tickInterval,this.view.allLayerViews.forEach((t=>{if(cJ(t)){const i=Math.round(6e4*t.refreshInterval),r=this._currentTick%i==0,s=e-t.refreshTimestamp<5400;i&&r&&!s&&(t.refresh(e),this.emit("refresh",{layerView:t,timestamp:e,trigger:"interval"}))}}))}),this.tickInterval))}_getLayerViewHandles(){const e=[],t=()=>this.notifyChange("tickInterval");return this.view.allLayerViews.forEach((i=>{cJ(i)&&i.layer&&e.push(i.watch("refreshInterval",t),i.layer.on("refresh",(()=>{const e=Date.now();i.refresh(e),this.emit("refresh",{layerView:i,timestamp:e,trigger:"layer-refresh"})})))})),e}_getCommonInterval(e){const t=(e,i)=>isNaN(e)||isNaN(i)?0:i<=0?e:t(i,e%i);return e.toArray().reduce(((e,i)=>t(Math.round(6e4*i.refreshInterval),e)),0)}};Q([ro()],uJ.prototype,"view",void 0),Q([ro({readOnly:!0})],uJ.prototype,"tickInterval",null),uJ=Q([Ro("esri.views.RefreshManager")],uJ);var pJ=uJ;const dJ=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],fJ={};function yJ(e){return!!fJ[e]}dJ.forEach((e=>{fJ[e]=!0}));class gJ{constructor(e){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((({handler:e,priority:t},i)=>this.inputManager.installHandlers(i,[e],t)))}disconnect(){this.inputManager&&this.handlers.forEach(((e,t)=>this.inputManager.uninstallHandlers(t))),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(e,t,i,r){const s=Array.isArray(e)?e:e.split(",");if(!function(e){for(const t of e)if(!yJ(t))return!1;return!0}(s))return s.some(yJ)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let n,o;Array.isArray(t)?o=t:(n=t,o=[]),"function"==typeof i?n=i:r=i,r=null!=r?r:iH.DEFAULT;const a=this.createUniqueGroupName(),l=new mJ(this.view,s,o,n);this.handlers.set(a,{handler:l,priority:r});for(const h of s){const e=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,e+1)}return this.inputManager&&this.inputManager.installHandlers(a,[l],r),{remove:()=>this.removeHandler(a,s)}}hasHandler(e){return!!this.handlerCounts.get(e)}removeHandler(e,t){if(this.handlers.has(e)){this.handlers.delete(e);for(const e of t){const t=this.handlerCounts.get(e);void 0===t?console.error("Trying to remove handler for event that has no handlers registered: ",e):1===t?this.handlerCounts.delete(e):this.handlerCounts.set(e,t-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class mJ extends Xq{constructor(e,t,i,r){super(!0),this.view=e;for(const s of t)switch(s){case"click":this.registerIncoming("click",i,(e=>r(this.wrapClick(e))));break;case"double-click":this.registerIncoming("double-click",i,(e=>r(this.wrapDoubleClick(e))));break;case"immediate-click":this.registerIncoming("immediate-click",i,(e=>r(this.wrapImmediateClick(e))));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,(e=>r(this.wrapImmediateDoubleClick(e))));break;case"hold":this.registerIncoming("hold",i,(e=>r(this.wrapHold(e))));break;case"drag":this.registerIncoming("drag",i,(e=>{const t=this.wrapDrag(e);t&&r(t)}));break;case"key-down":this.registerIncoming("key-down",i,(e=>r(this.wrapKeyDown(e))));break;case"key-up":this.registerIncoming("key-up",i,(e=>r(this.wrapKeyUp(e))));break;case"pointer-down":this.registerIncoming("pointer-down",i,(e=>r(this.wrapPointer(e,"pointer-down"))));break;case"pointer-move":this.registerIncoming("pointer-move",i,(e=>r(this.wrapPointer(e,"pointer-move"))));break;case"pointer-up":this.registerIncoming("pointer-up",i,(e=>r(this.wrapPointer(e,"pointer-up"))));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,(e=>r(this.wrapPointerDrag(e))));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,(e=>r(this.wrapMouseWheel(e))));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,(e=>r(this.wrapPointer(e,"pointer-enter"))));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,(e=>r(this.wrapPointer(e,"pointer-leave"))));break;case"gamepad":this.registerIncoming("gamepad",i,(e=>{r(this.wrapGamepad(e))}));break;case"focus":this.registerIncoming("focus",i,(e=>{r(this.wrapFocus(e))}));break;case"blur":this.registerIncoming("blur",i,(e=>{r(this.wrapBlur(e))}))}}wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o,eventId:a}=e.data,{cancelable:l,timestamp:h}=e;return{type:"click",pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:h,screenPoint:FS(s,n),mapPoint:this.getMapPoint(s,n),eventId:a,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o,eventId:a}=e.data,{cancelable:l,timestamp:h}=e;return{type:"double-click",pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:h,mapPoint:this.getMapPoint(s,n),eventId:a,cancelable:l,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o,eventId:a}=e.data,l=o.pointerId,{cancelable:h,timestamp:c}=e;return{type:"immediate-click",pointerId:l,pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:c,mapPoint:this.getMapPoint(s,n),eventId:a,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapImmediateDoubleClick(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o,eventId:a}=e.data,l=o.pointerId,{cancelable:h,timestamp:c}=e;return{type:"immediate-double-click",pointerId:l,pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:c,mapPoint:this.getMapPoint(s,n),eventId:a,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapHold(e){const{pointerType:t,button:i,buttons:r,x:s,y:n,native:o}=e.data,{cancelable:a,timestamp:l}=e;return{type:"hold",pointerType:t,button:i,buttons:r,x:s,y:n,native:o,timestamp:l,mapPoint:this.getMapPoint(s,n),cancelable:a,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}getMapPoint(e,t){return this.view.toMap(FS(e,t),{exclude:[]})}wrapDrag(e){const t=e.data,{x:i,y:r}=t.center,{action:s,pointerType:n,button:o}=t;if("start"===s&&(this.latestDragStart=t),!this.latestDragStart)return;const a=t.pointer.native,l=t.buttons,{cancelable:h,timestamp:c}=e,u={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===s&&(this.latestDragStart=void 0),{type:"drag",action:s,x:i,y:r,origin:u,pointerType:n,button:o,buttons:l,radius:t.radius,angle:Mv(t.angle),native:a,timestamp:c,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyDown(e){const{key:t,repeat:i,native:r}=e.data,{cancelable:s,timestamp:n}=e;return{type:"key-down",key:t,repeat:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapKeyUp(e){const{key:t,native:i}=e.data,{cancelable:r,timestamp:s}=e;return{type:"key-up",key:t,native:i,timestamp:s,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointer(e,t){const{x:i,y:r,button:s,buttons:n,native:o,eventId:a}=e.data,l=o.pointerId,h=o.pointerType,{cancelable:c,timestamp:u}=e;return{type:t,x:i,y:r,pointerId:l,pointerType:h,button:s,buttons:n,native:o,timestamp:u,eventId:a,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapPointerDrag(e){const{x:t,y:i,buttons:r,native:s,eventId:n}=e.data.currentEvent,{button:o}=e.data.startEvent,a=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,h=e.data.action,c={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:u,timestamp:p}=e;return{type:"pointer-drag",x:t,y:i,pointerId:a,pointerType:l,button:o,buttons:r,action:h,origin:c,native:s,timestamp:p,eventId:n,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapMouseWheel(e){const{cancelable:t,data:i,timestamp:r}=e,{x:s,y:n,deltaY:o,native:a}=i;return{type:"mouse-wheel",x:s,y:n,deltaY:o,native:a,timestamp:r,cancelable:t,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}wrapGamepad(e){const{action:t,state:i,device:r}=e.data,{cancelable:s,timestamp:n}=e,{buttons:o,axes:a}=i;return{type:"gamepad",device:r,timestamp:n,action:t,buttons:o,axes:a,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:t=>e.async(t),preventDefault:()=>e.preventDefault()}}}function vJ(e,t){const i=e.view;i&&(t&&i.ready&&i.activeTool!==e?(i.activeTool=e,s$(i)&&i.focus()):t||i.activeTool!==e||(i.activeTool=null))}function bJ(e){return!1!==e.visible&&!1!==e.editable&&(null==e.hasEditableFlag||e.hasEditableFlag(1))}function wJ(e){return FS(e.x,e.y)}function _J(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return FS(t.clientX-i.left,t.clientY-i.top)}function xJ(e,t){return t instanceof Event?_J(e,t):wJ(t)}function SJ(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;case"key-down":case"key-up":case"gamepad":case"focus":case"blur":default:return!1}return!1}class MJ{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToActiveTool=null,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":TJ(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!IJ(e))break;const r=wJ(e),s=this._intersect(r,e.pointerType,t.forEachTool);if(v(s))break;const n=this._findToolAndManipulatorByKey(s,t.forEachTool,EJ),o=w(n,(e=>e.manipulator)),a=w(n,(e=>e.tool));!(m(o)&&m(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,a,e),m(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:s,start:r}),1===this._grabbedManipulators.size&&(this._revertToActiveTool=t.activeTool,t.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",screenPoint:r}),i());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!IJ(e))break;const r=this._grabbedManipulators.get(e.pointerId),s=this._draggedManipulators.get(e.pointerId),n=w(r||s,(({key:e})=>e)),o=this._findManipulatorByKey(n,t.forEachTool);if(v(o))break;const a=wJ(e);a.x=mv(a.x,0,t.view.width),a.y=mv(a.y,0,t.view.height);const l=(r||s).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(o.dragging=!0,s?o.events.emit("drag",{action:"update",start:l,screenPoint:a}):o.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:n,start:l}));break;case"end":o.dragging=!1,s&&o.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const r=wJ(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findToolAndManipulatorByKey(s,t.forEachTool,EJ);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((e=>{if((!m(n)||n.tool!==e||!e.selectionManagementDisabled)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),v(n))break;const{manipulator:o,tool:a}=n;if(!o.interactive)break;o.selectable&&!a.selectionManagementDisabled&&(o.selected=!o.selected,a.manipulatorSelectionChanged&&a.manipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const r=wJ(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findManipulatorByKey(s,t.forEachTool);if(v(n)||!n.interactive)break;const o=e.native.shiftKey;n.events.emit(e.type,{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o}),i();break}case"double-click":{const r=wJ(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findManipulatorByKey(s,t.forEachTool);if(v(n)||!n.interactive)break;const o=e.native.shiftKey;n.events.emit("double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}case"immediate-double-click":{const r=wJ(e),s=this._intersect(r,e.pointerType,t.forEachTool),n=this._findManipulatorByKey(s,t.forEachTool);if(v(n)||!n.interactive)break;const o=e.native.shiftKey;n.events.emit("immediate-double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:o,stopPropagation:i});break}}this._updateCursor(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",screenPoint:wJ(i)}),this._grabbedManipulators.forEach((({key:i},r)=>{i.tool===t&&t.manipulators.findById(i.manipulatorId)===e&&this._grabbedManipulators.delete(r)}))}_handlePointerEnd(e,t){const i=w(this._grabbedManipulators.get(e.pointerId),(({key:e})=>e)),r=this._findManipulatorByKey(i,t.forEachTool);if(m(r)&&!r.dragging){const s=m(t.creatingTool)&&t.creatingTool===i.tool;1!==this._grabbedManipulators.size||0!==this._draggedManipulators.size||s||(t.setActiveTool(this._revertToActiveTool),this._revertToActiveTool=null),r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",screenPoint:wJ(e)})),this._grabbedManipulators.delete(e.pointerId)}}_cursorFromMap(e,t){let i=null;return tJ(e,(({key:e})=>{const r=this._findManipulatorByKey(e,t);return!!(m(r)&&r.interactive&&"cursor"in r&&r.cursor)&&(i=r.cursor,!0)})),i}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}clearPointers(e,t,i=!0,r){const s=t=>t.tool===e&&(v(r)||t.manipulatorId===r);this._grabbedManipulators.forEach((({key:e},i)=>{if(s(e)){this._grabbedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);m(r)&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",screenPoint:null}))}})),this._draggedManipulators.forEach((({key:e},i)=>{if(s(e)){this._draggedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);m(r)&&(r.dragging=!1,r.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:e},i)=>{if(s(e)){this._hoveredManipulators.delete(i);const r=this._findManipulatorByKey(e,t);m(r)&&(r.hovering=!1)}})),this._updateCursor(t)}_intersect(e,t,i){let r=null;return i((i=>{if(null==i.manipulators||!bJ(i))return!1;const s=i.manipulators.intersect(e,t);return!v(s)&&(r={manipulatorId:s.id,tool:i},!0)})),r}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition(FS(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!TJ(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(wJ(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,r){const s=this._intersect(e,i,r);let n=this._findManipulatorByKey(s,r);const o=w(this._hoveredManipulators.get(t),(({key:e})=>e)),a=this._findManipulatorByKey(o,r);m(n)&&!n.interactive&&(n=null),a!==n&&(m(a)&&(a.hovering=!1),m(n)?(n.hovering=!0,this._hoveredManipulators.set(t,{key:s})):this._hoveredManipulators.delete(t),this._updateCursor(r))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,EJ)?EJ.manipulator:null}_findToolAndManipulatorByKey(e,t,i){return v(e)?null:(i.tool=null,i.manipulator=null,t((t=>{if(t!==e.tool||null==t.manipulators||!bJ(t))return!1;const r=t.manipulators.findById(e.manipulatorId);return!!m(r)&&(i.manipulator=r,i.tool=t,!0)})),i.manipulator?i:null)}}function TJ(e){return"mouse"===e}function IJ(e){return"mouse"!==e.pointerType||0===e.button}const EJ={manipulator:null,tool:null},AJ=Ne.getLogger("esri.views.ToolViewManager"),PJ="manipulators";let CJ=class extends Jv{constructor(e){super(e),this._creatingTool=null,this._manipulatorState=new MJ,this.tools=function(){const e=new xh;return e.on("after-add",(e=>{const t=e.item;t.view&&t.view.ready&&t.attach()})),e.on("after-remove",(e=>{const t=e.item;vJ(t,!1),t.destroyed||t.detach()})),e}(),this.cursor=null,this._forEachTool=e=>{if(!m(this._creatingTool)||!e(this._creatingTool))for(const t of this.tools.items)if(e(t))return}}initialize(){this.handles.add([this.view.on(dJ,(e=>{this._handleInputEvent(e)}),iH.TOOL),this.tools.on("before-add",(e=>{const t=e.item;null==t||this.tools.includes(t)?e.preventDefault():null==t.created||t.created||(AJ.error("tools","Tool can not be added to view before it has been created"),e.preventDefault())})),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this._forEachTool((e=>e.destroy()))}set activeTool(e){!m(e)||this.view.ready?(function(e,t,i){const r=e.activeTool;t!==r&&(m(r)&&r.deactivate&&r.deactivate(),i(t),m(t)&&t.activate&&t.activate())}(this,e,(t=>{this._set("activeTool",t),this._removeIncompleteTools(e),this._forEachTool((e=>{const t=v(this.activeTool)||e===this.activeTool;e.setEditableFlag&&e.setEditableFlag(1,t);const i=bJ(e);!v(this.activeTool)&&i||this._manipulatorState.clearPointers(e,this._forEachTool,!i)})),this._updateCursor()})),this._creatingTool!==e&&this._rejectCreatingTool()):AJ.error("#activeTool=","cannot set active tool while view is not ready")}get updating(){return this.updatingHandles.updating||this.tools.some((e=>e.updating))}async createTool(e,t,i){const r="Tool creation was interrupted by another tool being created",{abortHandle:s,tool:n}=await this.updatingHandles.addPromise((async()=>{await this.view.whenReady(),tt(i,r);const s=ot(i,(()=>this.activeTool=null)),n=function(e){return v(e)?{}:"function"==typeof e?e():e}(t),o=new e(l(a({},n),{view:this.view}));return await o.whenCreationStarted(),tt(i,r),{abortHandle:s,tool:o}})());return this._rejectCreatingTool(r),this._creatingTool=n,n.attach(),this._refreshToolWatchers(),vJ(n,!0),await n.when(),m(s)&&s.remove(),this._creatingTool=null,tt(i,r),this.tools.add(n),n instanceof jo&&null!=n.completed&&jh(n,"completed").then((()=>{vJ(n,!1)})),n}attach(){this._forEachTool((e=>e.attach())),"3d"===this.view.type?this.handles.add([this.view.state.watch("camera",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this.forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))}))],PJ):this.handles.add(this.view.watch("extent",(()=>{this.forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){this.activeTool=null,this._forEachTool((e=>{e.detach(),e.destroy()})),this.tools.removeAll(),this.handles.remove(PJ)}forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i=l(a({},e),{stopPropagation:()=>{t=!0,e.stopPropagation()}});m(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&!1!==e.visible&&e.handleInputEvent&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},creatingTool:this._creatingTool,view:this.view}),!t&&m(this.activeTool)&&this.activeTool.handleInputEventAfter&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove("tools"),this._forEachTool((e=>{if(e instanceof jo){const t=Dh(e,["cursor","visible","editable"],(()=>{bJ(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()}));this.handles.add(t,"tools")}e.manipulators&&this.handles.add(e.manipulators.on("change",(t=>{t.removed.forEach((({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){let e=null;this._forEachTool((t=>null!=t.cursor&&!1!==t.visible&&(e=t.cursor,!0))),e||(e=this._manipulatorState.cursor),this._get("cursor")!==e&&this._set("cursor",e)}_rejectCreatingTool(e){const t=this._creatingTool;v(t)||(this._manipulatorState.clearPointers(t,this._forEachTool),t.rejectCreation&&t.rejectCreation(Qe(e)),vJ(t,!1),"destroyed"!==t.toolState&&t.destroy(),this._creatingTool=null,this._refreshToolWatchers())}_removeIncompleteTools(e){this.tools.filter((t=>(v(e)||t!==e)&&null!=t.completed&&!t.completed)).forEach((e=>{this.tools.remove(e)}))}};Q([ro({constructOnly:!0,nonNullable:!0})],CJ.prototype,"view",void 0),Q([ro({value:null})],CJ.prototype,"activeTool",null),Q([ro({readOnly:!0,type:xh})],CJ.prototype,"tools",void 0),Q([ro({readOnly:!0})],CJ.prototype,"cursor",void 0),Q([ro({readOnly:!0})],CJ.prototype,"updating",null),CJ=Q([Ro("esri.views.ToolViewManager")],CJ);var OJ=CJ;let kJ=class extends jo{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown","standard"===e.mapping?this._detectedDeviceType="standard":LJ.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return RJ[this.deviceType]}};Q([ro({nonNullable:!0,readOnly:!0})],kJ.prototype,"nativeIndex",void 0),Q([ro({type:String,readOnly:!0})],kJ.prototype,"deviceType",null),Q([ro({type:Number,readOnly:!0})],kJ.prototype,"axisThreshold",null),kJ=Q([Ro("esri.views.input.gamepad.GamepadInputDevice")],kJ);const LJ=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),RJ={standard:.15,spacemouse:.025,unknown:0};var DJ=kJ;let FJ=class extends jo{constructor(...e){super(...e),this.devices=new xh,this.enabledFocusMode="document"}};Q([ro({type:xh.ofType(DJ),readOnly:!0})],FJ.prototype,"devices",void 0),Q([ro({type:["document","view","none"]})],FJ.prototype,"enabledFocusMode",void 0),FJ=Q([Ro("esri.views.input.gamepad.GamepadSettings")],FJ);var jJ=FJ;let NJ=class extends jo{constructor(){super(...arguments),this.gamepad=new jJ}};Q([ro({readOnly:!0})],NJ.prototype,"gamepad",void 0),NJ=Q([Ro("esri.views.input.Input")],NJ);var zJ=NJ;let VJ=class extends jo{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};Q([ro({type:Boolean,nonNullable:!0})],VJ.prototype,"enabled",void 0),Q([ro({type:DJ})],VJ.prototype,"device",void 0),Q([ro({type:["pan","zoom"],nonNullable:!0})],VJ.prototype,"mode",void 0),Q([ro({type:["forward-down","forward-up"],nonNullable:!0})],VJ.prototype,"tiltDirection",void 0),Q([ro({type:Number,nonNullable:!0})],VJ.prototype,"velocityFactor",void 0),VJ=Q([Ro("esri.views.navigation.gamepad.GamepadSettings")],VJ);var UJ=VJ;let GJ=class extends jo{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new UJ,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};Q([ro({type:Boolean})],GJ.prototype,"browserTouchPanEnabled",void 0),Q([ro({type:UJ,nonNullable:!0})],GJ.prototype,"gamepad",void 0),Q([ro({type:Boolean})],GJ.prototype,"momentumEnabled",void 0),Q([ro({type:Boolean})],GJ.prototype,"mouseWheelZoomEnabled",void 0),GJ=Q([Ro("esri.views.navigation.Navigation")],GJ);var BJ=GJ;function qJ(e,t,i){const r=WJ(e),s=t,n=function(e,t,i){if(!HJ(e)||!HJ(t))return 4;if(null==e||null==t)return 0;if(!i&&e.heightUnit!==t.heightUnit)return 1;if(e.heightModel!==t.heightModel)return 2;switch(e.heightModel){case"gravity-related-height":return 0;case"ellipsoidal":return e.vertCRS===t.vertCRS?0:3;default:return 4}}(r,s,i);{let t=null;if(r){const s=dV.deriveUnitFromSR(r,e.spatialReference).heightUnit;i||s===r.heightUnit||(t=new Be("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${s})`,{horizontalUnit:s}))}if(!function(e){return"heightModelInfo"in e&&null!=e.heightModelInfo||null!=e.spatialReference||!XJ(e)}(e)||4===n||t)return new Be("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:t})}{let e=null;switch(n){case 1:{const t=r.heightUnit||"unknown",i=s.heightUnit||"unknown";e=new Be("layerview:incompatible-height-unit",`The vertical units of the layer (${t}) must match the vertical units of the scene (${i})`,{layerUnit:t,sceneUnit:i});break}case 2:{const t=r.heightModel||"unknown",i=s.heightModel||"unknown";e=new Be("layerview:incompatible-height-model",`The height model of the layer (${t}) must match the height model of the scene (${i})`,{layerHeightModel:t,sceneHeightModel:i});break}case 3:{const t=r.vertCRS||"unknown",i=s.vertCRS||"unknown";e=new Be("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${t}) must match the vertical datum of the scene (${i})`,{layerDatum:t,sceneDatum:i});break}}if(e)return new Be("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:e})}return null}function HJ(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function WJ(e){const t=e.url&&MV(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&m(t)&&"ImageServer"===t.serverType||!$J(e)||!e.heightModelInfo?XJ(e)?dV.deriveUnitFromSR(ZJ,e.spatialReference):null:e.heightModelInfo}function $J(e){return"heightModelInfo"in e}function JJ(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;case"imagery":case"map-image":case"map-notes":case"tile":case"vector-tile":case"scene":case null:default:return!1}}function XJ(e){return JJ(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):YJ(e)}function KJ(e){return null!=e.layers||YJ(e)||JJ(e)||$J(e)}function YJ(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":case"slice":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"direct-line-measurement":case"area-measurement":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"line-of-sight":case"map-image":case"map-notes":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}const ZJ=new dV({heightModel:"gravity-related-height"});var QJ;const eX=Ne.getLogger("esri.views.support.DefaultsFromMap");let tX=QJ=class extends jo{constructor(){super(...arguments),this._handles=new Mh,this._waitTask=null,this._extentProjectController=null,this._spatialReferenceCandidates=null,this._extentCandidates=null,this.logDebugInformation=!1,this.isSpatialReferenceDone=!1,this.isTileInfoDone=!1,this.isHeightModelInfoSearching=!1,this.spatialReference=null,this.extent=null,this.heightModelInfo=null,this.vcsWkid=null,this.latestVcsWkid=null,this.mapCollectionPaths=QJ.DefaultMapCollectionPaths.slice(),this.tileInfo=null}initialize(){this.watch("mapCollectionPaths",(()=>{this._running&&(this.reset(),this.start())}))}destroy(){this._set("view",null),this._handles&&(this._handles.destroy(),this._handles=null),this._cancelLoading()}get _running(){return!!(this._handles&&this._handles.size>0)}reset(){this._handles.removeAll(),this._set("isSpatialReferenceDone",!1),this._set("isTileInfoDone",!1),this._set("isHeightModelInfoSearching",!1),this._set("spatialReference",null),this._set("extent",null),this._set("heightModelInfo",null),this._set("vcsWkid",null),this._set("latestVcsWkid",null),this._set("tileInfo",null),this._spatialReferenceCandidates=null,this._extentCandidates=null}start(){this._handles.removeAll();const e=this._updateLayerChange.bind(this);for(const t of this.mapCollectionPaths)this._handles.add(Hh(this.view,`map.${t}`,"change",e,e,e,!0));this._handles.add(Fh(this,"isSpatialReferenceDone",(()=>this._updateTileInfo()),!0))}_ownerNameFromCollectionName(e){const t=e.lastIndexOf(".");return-1===t?"view":"view."+e.slice(0,t)}_ensureLoadedOwnersFromCollectionName(e){const t=this._ownerNameFromCollectionName(e).split(".");let i;for(let r=0;r<t.length&&(i=this.get(t.slice(0,r+1).join(".")),i);r++)if(i.load&&!i.isFulfilled())return{collectionName:e,owner:null,loading:i.load().catch((()=>{}))};return{collectionName:e,owner:i}}_cancelLoading(){this._waitTask=null,this._extentProjectController&&(this._extentProjectController.abort(),this._extentProjectController=null)}_updateWhen(e){let t=!0,i=!1;const r=e.catch((()=>{})).then((()=>{t?i=!0:r===this._waitTask&&this._update()}));return t=!1,i||(this._waitTask=r),i}_updateLayerChange(){this.isSpatialReferenceDone&&!this.spatialReference&&this._set("isSpatialReferenceDone",!1),this._update()}_update(){if(this._cancelLoading(),this.view){if(!this.isSpatialReferenceDone){this._debugLog("Starting search for spatial reference...");const e=this._processMapCollections((e=>this._processSpatialReferenceSource(e)));if(this._debugLog(`Search ended with status '${rX(e)}'`),0!==e){let e=null,t=this._spatialReferenceCandidates;if(!t||t.length<1?(e=this.defaultSpatialReference,this._debugLog(`No spatial reference found, locking to default (${iX(e)})`)):(this.defaultSpatialReference&&t.length>1&&t.findIndex((e=>e.equals(this.defaultSpatialReference)))>-1&&(t=[this.defaultSpatialReference]),e=t[0],this._debugLog(`Locking to ${iX(e)}`)),this._set("spatialReference",e),e)if(this.extent)this._set("isSpatialReferenceDone",!0);else{const t=this.logDebugInformation;this.logDebugInformation=!1,this._processMapCollections((t=>this._findExtent(t,e))),this.logDebugInformation=t,this._projectExtentCandidate().catch((()=>{})).then((()=>this._set("isSpatialReferenceDone",!0)))}else this._set("isSpatialReferenceDone",!0)}}if(null==this.heightModelInfo&&this.view.isHeightModelInfoRequired){this._debugLog("Starting search for height model info...");const e=this._processMapCollections((e=>this._processHeightModelInfoSource(e)),(e=>KJ(e)));this._debugLog(`Search ended with status ${rX(e)}`),this._set("isHeightModelInfoSearching",0===e)}this._updateTileInfo()}}_processMapCollections(e,t){this._preloadMapCollections(t);let i=2;return this._forAllMapCollectionSources((e=>{if(2!==i)return!1;const{collectionName:t}=e;return this._debugLog(`Processing collection ${t}...`),!(e.loading&&!this._updateWhen(e.loading)&&(this._debugLog(`Collection ${e.collectionName} owner is loading -> wait`),i=0,1))}),(r=>2===i&&(null==t||t(r)?!r.load||r.isFulfilled()||this._updateWhen(r.load())?!((!r.load||r.isResolved())&&e(r)&&(i=1,1)):(this._debugLog(`Source ${r.id} is loading -> wait`),i=0,!1):(this._debugLog(`Source ${r.id} is skipped due to predicate`),!1)))),i}_preloadMapCollections(e){let t=10;const i=this.logDebugInformation;this.logDebugInformation=!1,this._forAllMapCollectionSources((()=>!0),(r=>0!==t&&!(null!=e&&!e(r)||(r.load&&!r.isFulfilled()&&(this.logDebugInformation=i,this._debugLog(`Pre-loading source ${r.id}`),this.logDebugInformation=!1,r.load().catch((()=>{})),t--),0)))),this.logDebugInformation=i}_forAllMapCollectionSources(e,t){for(const i of this.mapCollectionPaths){const r=`map.${i}`,s=this._ensureLoadedOwnersFromCollectionName(r);if(!1===e(s))continue;const n=s.owner;if(!n||n.isRejected&&n.isRejected()){this._debugLog(`Collection ${r} owner is invalid or rejected -> skip`);continue}const o=this.view.get(r);o?this._forEachSource(o,t):this._debugLog(`Collection ${r} does not exist -> skip`)}}_forEachSource(e,t){for(const i of e.items)!1!==t(i)&&"layers"in i&&i.layers&&this._forEachSource(i.layers,t)}_processSpatialReferenceSource(e){let t=this._getSupportedSpatialReferences(e);return 0!==t.length&&(this._spatialReferenceCandidates?(t=function(e,t,i){return e&&t?i?e.filter((function(e){return t.findIndex((function(t){return i(e,t)}))>-1})):e.filter((function(e){return t.indexOf(e)>-1})):[]}(t,this._spatialReferenceCandidates,((e,t)=>e.equals(t))),t.length>0?this._spatialReferenceCandidates=t:this._debugLog(`Layer ${e.id} is ignored because its supported spatial\n          references are not compatible with the previous candidates`)):this._spatialReferenceCandidates=t,1===this._spatialReferenceCandidates.length)}_findExtent(e,t){const i="fullExtents"in e&&e.fullExtents||(e.fullExtent?[e.fullExtent]:[]),r=i.find((e=>e.spatialReference.equals(t)));if(r)return this._set("extent",r),!0;if(this._getSupportedSpatialReferences(e).length>0){const t=i.map((t=>({extent:t,layer:e}))),r=this._extentCandidates||[];this._extentCandidates=r.concat(t)}return!1}async _projectExtentCandidate(){if(!this._extentCandidates||!this._extentCandidates.length)return;const e=this.spatialReference,t=this._extentCandidates.find((t=>Ha(t.extent.spatialReference,e)));if(t)this._set("extent",Wa(t.extent,e));else{const t=this._extentCandidates[0];this._extentProjectController=et();const i=await import("./geometryServiceUtils.c0e09eb3.js");try{const r=await i.projectGeometry(t.extent,e,t.layer.portalItem,this._extentProjectController.signal);this._set("extent",r)}catch{}this._extentProjectController=null}}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return this._debugLog(`Layer ${e.id} is ignored because it does not have any spatial references`),[];const i=t.filter((t=>this.view.isSpatialReferenceSupported(t,e,(e=>this._debugLog(e)))));return 0===i.length?this._debugLog(`Layer ${e.id} has spatial references but none of them are supported (or layer doesn't require locking)`):this._debugLog(`Layer ${e.id} has spatial references. Resulting candidate set: ${i.map(iX).join(", ")}`),i}_processHeightModelInfoSource(e){const t=WJ(e);return!!t&&(this._set("heightModelInfo",t),this._set("isHeightModelInfoSearching",!1),e.spatialReference&&(this._set("vcsWkid",e.spatialReference.vcsWkid),this._set("latestVcsWkid",e.spatialReference.latestVcsWkid)),!0)}_updateTileInfo(){if(null!=this.tileInfo)return;if(!this.view.isTileInfoRequired())return void this._set("isTileInfoDone",!0);if(!this.isSpatialReferenceDone)return;const e=this.get("view.map");if(!e)return void this._debugLog("updateTileInfo: no map");const t=e.basemap,i=e.get("layers.0");let r=null;if(t&&"failed"!==t.loadStatus){if(!t.loaded)return this._updateWhen(t.load()),void this._debugLog("updateTileInfo: basemap still loading");const e=t&&t.get("baseLayers.0");if(e&&"failed"!==e.loadStatus){if(!e.loaded)return this._updateWhen(e.load()),void this._debugLog("updateTileInfo: first basemap layer still loading");r="tileInfo"in e&&e.tileInfo}else{if(!i||"failed"===i.loadStatus)return this._debugLog("updateTileInfo: no tileInfo"),void this._set("isTileInfoDone",!0);if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");r="tileInfo"in i&&i.tileInfo}}else if(i&&"failed"!==i.loadStatus){if(!i.loaded)return this._updateWhen(i.load()),void this._debugLog("updateTileInfo: first operational layer still loading");r="tileInfo"in i&&i.tileInfo}r&&!r.spatialReference.equals(this.spatialReference)&&(r=null),this._debugLog(`updateTileInfo: setting ${r}`),this._set("tileInfo",r),this._set("isTileInfoDone",!0)}_debugLog(e){this.logDebugInformation&&eX.info(e)}};function iX(e){return e?JSON.stringify(e.toJSON()):"undefined"}function rX(e){switch(e){case 0:return"Waiting";case 1:return"Found";case 2:return"Exhausted"}}tX.DefaultMapCollectionPaths=["basemap.baseLayers","layers","ground.layers","basemap.referenceLayers"],Q([ro()],tX.prototype,"logDebugInformation",void 0),Q([ro({readOnly:!0})],tX.prototype,"isSpatialReferenceDone",void 0),Q([ro({readOnly:!0})],tX.prototype,"isTileInfoDone",void 0),Q([ro({readOnly:!0})],tX.prototype,"isHeightModelInfoSearching",void 0),Q([ro({constructOnly:!0})],tX.prototype,"view",void 0),Q([ro({readOnly:!0})],tX.prototype,"spatialReference",void 0),Q([ro({readOnly:!0})],tX.prototype,"extent",void 0),Q([ro({readOnly:!0})],tX.prototype,"heightModelInfo",void 0),Q([ro({readOnly:!0})],tX.prototype,"vcsWkid",void 0),Q([ro({readOnly:!0})],tX.prototype,"latestVcsWkid",void 0),Q([ro()],tX.prototype,"mapCollectionPaths",void 0),Q([ro()],tX.prototype,"defaultSpatialReference",void 0),Q([ro({readOnly:!0})],tX.prototype,"tileInfo",void 0),tX=QJ=Q([Ro("esri.views.support.DefaultsFromMap")],tX);var sX,nX=tX;const oX=Ne.getLogger("esri.views.View");let aX=sX=class extends($v(sh.EventedMixin(Zo(jo)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new Kv({getCollections:()=>{var e,t,i;return[null==(e=this.basemapView)?void 0:e.baseLayerViews,null==(t=this.groundView)?void 0:t.layerViews,this.layerViews,null==(i=this.basemapView)?void 0:i.referenceLayerViews]},getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.defaultsFromMap=new nX({view:this}),this.fatalError=null,this.extent=null,this.graphics=new Q$,this.navigating=!1,this.layerViews=new xh,this.magnifier=new lJ,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.renderContext=null,this.input=new zJ,this.navigation=new BJ,this.layerViewManager=null,this.refreshManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new gJ(this),this.persistableViewModels=new xh,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(this.watch("preconditionsReady",(e=>{e?(this._currentSpatialReference=this.spatialReference,sX.views.add(this)):(this._currentSpatialReference=null,sX.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager.clear(),this.toolViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),this.toolViewManager.attach())}),!0))}initialize(){let e;this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,jh(this,"ready"))))),this.basemapView=new eJ({view:this}),this.layerViewManager=new oJ({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.refreshManager=new pJ({view:this}),this.toolViewManager=new OJ({view:this}),this._resetInitialViewPropertiesFromContent(),Rh(this.defaultsFromMap,"isSpatialReferenceDone",(t=>{const i=!!(this.map&&this.map.allLayers.length>0);if(t&&!this.spatialReference&&i||!e){if(t&&!this.spatialReference&&i&&!e){const t=e=gt(this.spatialReferenceWarningDelay);e.then((()=>{t===e&&oX.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})).catch((()=>{}))}}else e=null}),!0)}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics.destroy(),this.graphics=null,this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),this.toolViewManager.destroy(),this.toolViewManager=null,this.refreshManager.destroy(),this.refreshManager=null,this.layerViewManager.destroy(),this.layerViewManager=null,this.basemapView.destroy(),this.basemapView=null,this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,null==e||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return oX.error("#toMap()","Not implemented on this instance of View"),null}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!ra.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}set map(e){var t;e!==this._get("map")&&(null!=(t=e)&&t.destroyed&&(oX.warn("#map","The provided map is already destroyed",{map:e}),e=null),ra.isLoadable(e)&&e.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){this._userSpatialReference=e,this._set("spatialReference",e)}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap&&this.defaultsFromMap.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return m(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){return this.get("defaultsFromMap.spatialReference")}getDefaultHeightModelInfo(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null}importLayerView(e){throw new Be("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}isSpatialReferenceSupported(e,t,i){return!0}isTileInfoRequired(){return!1}when(e,t){return this.isResolved()&&!this.ready&&oX.warn("#when()",'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.'),super.when(e,t)}forceReadyCycle(){this.ready&&(this._readyCycleForced=!0,Bh(this,"preconditionsReady",(()=>this._readyCycleForced=!1)))}createTool(e,t,i){return this.toolViewManager.createTool(e,t,i)}tryFatalErrorRecovery(){this.fatalError=null}_resetInitialViewPropertiesFromContent(){if(!this.defaultsFromMap)return;const e=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset(),this._currentSpatialReference=null,this.notifyChange("spatialReference"),this.handles.remove("defaultsFromMap"),this.handles.add([Dh(this,"spatialReference",((t,i)=>{fa(t,i)||e()})),Dh(this,"initialExtentRequired",e),Qs(e)],"defaultsFromMap")}};aX.views=new xh,Q([eh("toolViewManager.activeTool")],aX.prototype,"activeTool",void 0),Q([ro({readOnly:!0})],aX.prototype,"allLayerViews",void 0),Q([ro()],aX.prototype,"groundView",void 0),Q([ro()],aX.prototype,"animation",void 0),Q([ro()],aX.prototype,"basemapView",void 0),Q([ro()],aX.prototype,"defaultsFromMap",void 0),Q([ro()],aX.prototype,"fatalError",void 0),Q([ro({type:Ol})],aX.prototype,"extent",void 0),Q([ro(Z$())],aX.prototype,"graphics",void 0),Q([ro({readOnly:!0,type:dV,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"]})],aX.prototype,"heightModelInfo",null),Q([ro({readOnly:!0})],aX.prototype,"interacting",null),Q([ro({readOnly:!0})],aX.prototype,"navigating",void 0),Q([ro({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","initialExtentRequired","initialExtent","defaultsFromMap.isSpatialReferenceDone","defaultsFromMap.isTileInfoDone"]})],aX.prototype,"preconditionsReady",null),Q([ro({type:xh,readOnly:!0})],aX.prototype,"layerViews",void 0),Q([ro({type:lJ})],aX.prototype,"magnifier",void 0),Q([ro({value:null,type:jw})],aX.prototype,"map",null),Q([ro()],aX.prototype,"padding",void 0),Q([ro({readOnly:!0})],aX.prototype,"ready",void 0),Q([ro({type:Aa})],aX.prototype,"spatialReference",null),Q([ro()],aX.prototype,"spatialReferenceWarningDelay",void 0),Q([ro()],aX.prototype,"stationary",null),Q([ro({readOnly:!0})],aX.prototype,"supportsGround",void 0),Q([ro({type:mO})],aX.prototype,"timeExtent",void 0),Q([eh("toolViewManager.tools")],aX.prototype,"tools",void 0),Q([ro()],aX.prototype,"toolViewManager",void 0),Q([ro({readOnly:!0})],aX.prototype,"type",void 0),Q([ro({type:Number})],aX.prototype,"scale",void 0),Q([ro({readOnly:!0})],aX.prototype,"updating",void 0),Q([ro({readOnly:!0})],aX.prototype,"initialExtentRequired",void 0),Q([ro({readOnly:!0,type:Ol})],aX.prototype,"initialExtent",null),Q([ro()],aX.prototype,"cursor",null),Q([ro()],aX.prototype,"renderContext",void 0),Q([ro({readOnly:!0})],aX.prototype,"input",void 0),Q([ro({type:BJ,nonNullable:!0})],aX.prototype,"navigation",void 0),Q([ro()],aX.prototype,"layerViewManager",void 0),Q([ro()],aX.prototype,"width",void 0),Q([ro()],aX.prototype,"height",void 0),Q([ro({readOnly:!0})],aX.prototype,"resizing",void 0),Q([ro({value:null,readOnly:!0})],aX.prototype,"size",null),Q([ro({readOnly:!0})],aX.prototype,"suspended",void 0),Q([ro({readOnly:!0})],aX.prototype,"viewEvents",void 0),Q([ro({readOnly:!0})],aX.prototype,"persistableViewModels",void 0),Q([ro()],aX.prototype,"_isValid",void 0),Q([ro()],aX.prototype,"_readyCycleForced",void 0),Q([ro()],aX.prototype,"_currentSpatialReference",void 0),aX=sX=Q([Ro("esri.views.View")],aX);var lX=aX;let hX=class extends Qo{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise(((e,t)=>this._dfd={resolve:e,reject:t})))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new Be("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=mt(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};Q([ro({readOnly:!0})],hX.prototype,"done",null),Q([ro({readOnly:!0,type:String})],hX.prototype,"state",void 0),Q([ro()],hX.prototype,"target",void 0),hX=Q([Ro("esri.views.ViewAnimation")],hX),(hX||(hX={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};var cX=hX;function uX(e,t,i,r){const s=3*e,n=3*(i-e)-s,o=1-s-n,a=3*t,l=3*(r-t)-a,h=1-a-l;function c(e){return((o*e+n)*e+s)*e}function u(e){return(3*o*e+2*n)*e+s}return function(e,t=1e-6){return function(e){return((h*e+l)*e+a)*e}(function(e,t){let i,r,s,n,o,a;for(s=e,a=0;a<8;a++){if(n=c(s)-e,Math.abs(n)<t)return s;if(o=u(s),Math.abs(o)<1e-6)break;s-=n/o}if(i=0,r=1,s=e,s<i)return i;if(s>r)return r;for(;i<r;){if(n=c(s),Math.abs(n-e)<t)return s;e>n?i=s:r=s,s=.5*(r-i)+i}return s}(e,t))}}const pX=/^cubic-bezier\((.*)\)/,dX={};function fX(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function yX(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function gX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=i[0],c=i[1],u=i[2],p=i[3],d=i[4],f=i[5];return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*u+n*p,e[3]=s*u+o*p,e[4]=r*d+n*f+a,e[5]=s*d+o*f+l,e}function mX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=Math.sin(i),c=Math.cos(i);return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*-h+n*c,e[3]=s*-h+o*c,e[4]=a,e[5]=l,e}function vX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=i[0],c=i[1];return e[0]=r*h,e[1]=s*h,e[2]=n*c,e[3]=o*c,e[4]=a,e[5]=l,e}function bX(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=i[0],c=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*h+n*c+a,e[5]=s*h+o*c+l,e}function wX(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function _X(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function xX(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}dX.ease=uX(.25,.1,.25,1),dX.linear=uX(0,0,1,1),dX.easeIn=dX["ease-in"]=uX(.42,0,1,1),dX.easeOut=dX["ease-out"]=uX(0,0,.58,1),dX.easeInOut=dX["ease-in-out"]=uX(.42,0,.58,1);const SX=gX,MX=xX;function TX(){return[1,0,0,1,0,0]}function IX(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function EX(e,t){return e[0]=t[0],e[1]=t[1],e}function AX(e,t,i){return e[0]=t,e[1]=i,e}function PX(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function CX(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function OX(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function kX(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function LX(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function RX(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function DX(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function FX(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function jX(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function NX(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function zX(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function VX(e){const t=e[0],i=e[1];return t*t+i*i}function UX(e,t){return e[0]=-t[0],e[1]=-t[1],e}function GX(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function BX(e,t){return e[0]*t[0]+e[1]*t[1]}function qX(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function HX(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function WX(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function $X(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function JX(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function XX(e,t){return e[0]===t[0]&&e[1]===t[1]}Object.freeze({__proto__:null,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:fX,set:function(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e},invert:yX,determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:gX,rotate:mX,scale:vX,translate:bX,fromRotation:wX,fromScaling:_X,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},subtract:xX,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],h=t[1],c=t[2],u=t[3],p=t[4],d=t[5];return Math.abs(i-l)<=Am*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-h)<=Am*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-c)<=Am*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(n-u)<=Am*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-p)<=Am*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-d)<=Am*Math.max(1,Math.abs(a),Math.abs(d))},mul:SX,sub:MX}),Object.freeze({__proto__:null,create:TX,clone:IX,fromValues:function(e,t,i,r,s,n){return[e,t,i,r,s,n]},createView:function(e,t){return new Float64Array(e,t,6)}});const KX=zX,YX=CX,ZX=OX,QX=kX,eK=jX,tK=NX,iK=VX;function rK(){return[0,0]}function sK(e){return[e[0],e[1]]}function nK(e,t){return[e,t]}function oK(e){const t=[0,0],i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function aK(e,t){return new Float64Array(e,t,2)}function lK(){return[0,0]}function hK(){return nK(1,1)}function cK(){return nK(1,0)}function uK(){return nK(0,1)}Object.freeze({__proto__:null,copy:EX,set:AX,add:PX,subtract:CX,multiply:OX,divide:kX,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:LX,max:RX,round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:DX,scaleAndAdd:FX,distance:jX,squaredDistance:NX,length:zX,squaredLength:VX,negate:UX,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:GX,dot:BX,cross:qX,lerp:HX,random:function(e,t){t=t||1;const i=2*Pm()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},transformMat2:WX,transformMat2d:$X,transformMat3:function(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e},transformMat4:function(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e},rotate:JX,angle:function(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:XX,equals:function(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Am*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Am*Math.max(1,Math.abs(r),Math.abs(n))},len:KX,sub:YX,mul:ZX,div:QX,dist:eK,sqrDist:tK,sqrLen:iK});const pK=[0,0],dK=hK(),fK=cK(),yK=uK();Object.freeze({__proto__:null,create:rK,clone:sK,fromValues:nK,fromArray:oK,createView:aK,zeros:lK,ones:hK,unitX:cK,unitY:uK,ZEROS:pK,ONES:dK,UNIT_X:fK,UNIT_Y:yK});const gK=180/Math.PI;function mK(e,t,i,r){return r&&i&&!r.equals(i)&&Ha(r,i)&&r.isWebMercator?r.isWebMercator?function(e,t){let i=t[1];return i>89.99999?i=89.99999:i<-89.99999&&(i=-89.99999),i=Math.sin(km(i)),AX(e,km(t[0])*Fa.radius,.5*Fa.radius*Math.log((1+i)/(1-i)))}(e,t):function(e,t,i){const r=Lm(t[0]/Fa.radius);return AX(e,i?r:r-360*Math.floor((r+180)/360),Lm(.5*Math.PI-2*Math.atan(Math.exp(-1*t[1]/Fa.radius))))}(e,t):EX(e,t)}function vK(e){return e.wkid?e:e.spatialReference||Aa.WGS84}function bK(e,t){return t.type?AX(e,t.x,t.y):EX(e,t)}function wK(e){return VA(e)}function _K(e,t){return Math.max(e.width/t[0],e.height/t[1])*function(e){return Ma(e)?39.37*wK(e)*96:1}(e.spatialReference)}async function xK(e,t,i,r){let s,n;if(!e)return null;if(Array.isArray(e)&&!e.length)return null;if(xh.isCollection(e)&&(e=e.toArray()),Array.isArray(e)&&e.length&&"object"==typeof e[0]){const s=e.every((e=>"attributes"in e)),n=e.some((e=>!e.geometry));let o=e;if(s&&n&&t&&t.allLayerViews){const i=new Map;for(const t of e){const e=t.layer,r=i.get(e)||[],s=t.attributes[e.objectIdField];null!=s&&r.push(s),i.set(e,r)}const r=[];i.forEach(((e,i)=>{const s=t.allLayerViews.find((e=>e.layer.id===i.id));if("queryFeatures"in s){const t=i.createQuery();t.objectIds=e,t.returnGeometry=!0,r.push(s.queryFeatures(t))}}));const s=await Promise.all(r),n=[];for(const e of s)if(e&&e.features&&e.features.length)for(const t of e.features)m(t.geometry)&&n.push(t.geometry);o=n}for(const e of o)r=await xK(e,t,i,r);return r}if(Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1])s=new il(e);else if(e instanceof Ca)s=e;else if("geometry"in e)if(e.geometry)s=e.geometry;else if(e.layer){const i=e.layer,r=t.allLayerViews.find((e=>e.layer.id===i.id));if("queryFeatures"in r){const t=i.createQuery();t.objectIds=[e.attributes[i.objectIdField]],t.returnGeometry=!0;s=R(await r.queryFeatures(t),"features",0,"geometry")}}if(v(s))return null;if(n="point"===s.type?new Ol({xmin:s.x,ymin:s.y,xmax:s.x,ymax:s.y,spatialReference:s.spatialReference}):s.extent,!n)return null;const o=Ha(n,i);if(!n.spatialReference.equals(i)&&o)n=Wa(n,i);else if(!o)return null;return r?r.union(n):n.clone()}async function SK(e,t){if(!e||!t)return new m$({targetGeometry:new il,scale:0,rotation:0});let i=t.spatialReference;const{constraints:r,padding:s,viewpoint:n,size:o}=t,a=[s?o[0]-s.left-s.right:o[0],s?o[1]-s.top-s.bottom:o[1]];let l=null;e instanceof m$?l=e:e.viewpoint?l=e.viewpoint:e.target&&"esri.Viewpoint"===e.target.declaredClass&&(l=e.target);let h=null;l&&l.targetGeometry?h=l.targetGeometry:e instanceof Ol?h=e:(e||e&&("center"in e||"extent"in e||"target"in e))&&(h=await xK(e.center,t,i)||await xK(e.extent,t,i)||await xK(e.target,t,i)||await xK(e,t,i)),!h&&n&&n.targetGeometry?h=n.targetGeometry:!h&&t.extent&&(h=t.extent);const c=vK(h);if(i||(i=vK(t.spatialReference||t.extent||h)),!Ha(h,i)&&c&&!c.equals(i))return null;const u=bK([0,0],h.center?h.center:h),p=new il(mK(u,u,c,i),i);let d=null;d=l&&m(l.targetGeometry)&&"point"===l.targetGeometry.type?l.scale:e.hasOwnProperty("scale")&&e.scale?e.scale:e.hasOwnProperty("zoom")&&-1!==e.zoom&&r&&r.effectiveLODs?r.zoomToScale(e.zoom):Array.isArray(h)||"point"===h.type||"extent"===h.type&&0===h.width&&0===h.height?t.extent&&Ha(t.extent,i)?_K(Wa(t.extent,i),a):t.extent?_K(t.extent,a):n.scale:Ha(h.extent,i)?_K(Wa(h.extent,i),a):_K(h.extent,a);const f=function(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&e.layer&&e.layer.minScale&&e.layer.maxScale){const t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every((e=>"layer"in e))){let t=0,i=0;for(const r of e){const e=r.layer;e&&e.minScale&&e.maxScale&&(t=e.minScale<t?e.minScale:t,i=e.maxScale>i?e.maxScale:i)}return t&&i?{min:t,max:i}:null}}}(e);f&&(f.min&&f.min>d?d=f.min:f.max&&f.max<d&&(d=f.max));let y=0;l?y=l.rotation:e.hasOwnProperty("rotation")?y=e.rotation:n&&(y=n.rotation);let g=new m$({targetGeometry:p,scale:d,rotation:y});return r&&(g=r.fit(g),r.constrainByGeometry(g),r.rotationEnabled||(g.rotation=y)),g}function MK(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function TK(e,t,i){return i?AX(e,.5*(t[0]-i.right+i.left),.5*(t[1]-i.bottom+i.top)):DX(e,t,.5)}const IK=function(){const e=[0,0];return function(t,i,r){const s=i.targetGeometry;bK(e,s);const n=.5*PK(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();const EK=function(){const e=[0,0];return function(t,i,r){return YX(t,function(e,t){return DX(e,t,.5)}(t,i),TK(e,i,r))}}(),AK=function(){const e=[1,0,0,1,0,0],t=[0,0];return function(i,r,s,n){const o=PK(r),a=CK(r);return AX(t,o,o),_X(e,t),mX(e,e,a),bX(e,e,EK(t,s,n)),bX(e,e,[0,n.top-n.bottom]),AX(i,e[4],e[5])}}();function PK(e){return e.scale*function(e){return m(e)&&Ma(e.spatialReference)?1/(39.37*wK(e.spatialReference)*96):1}(e.targetGeometry)}function CK(e){return km(e.rotation)||0}const OK=function(){const e=[0,0],t=[0,0],i=[0,0];return function(r,s,n,o,a,l){return UX(e,s),DX(t,n,.5*l),AX(i,1/o*l,-1/o*l),fX(r),bX(r,r,t),a&&mX(r,r,a),vX(r,r,i),bX(r,r,e),r}}(),kK=function(){const e=[0,0];return function(t,i,r,s){const n=PK(i),o=CK(i);return bK(e,i.targetGeometry),OK(t,e,r,n,o,s)}}(),LK=function(){const e=[0,0];return function(t,i,r,s){const n=PK(i);return bK(e,i.targetGeometry),OK(t,e,r,n,0,s)}}();function RK(e){if(e.isWrappable){const t=ya(e);return t.valid[1]-t.valid[0]}return 0}const DK=function(){const e=[0,0],t=[0,0],i=[0,0,0];return function(r,s,n){CX(e,r,s),GX(e,e),CX(t,r,n),GX(t,t),qX(i,e,t);let o=Math.acos(BX(e,t)/(zX(e)*zX(t)))*gK;return i[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),FK=function(){const e=[0,0];return function(t,i,r,s){const n=t.targetGeometry;return MK(t,i),AK(e,i,r,s),n.x+=e[0],n.y+=e[1],t}}(),jK=function(){const e=[0,0];return function(t,i,r){MK(t,i);const s=t.targetGeometry,n=vK(r),o=vK(s);return bK(e,r),mK(e,e,n,o),s.x=e[0],s.y=e[1],t}}(),NK=function(){const e=[0,0];return function(t,i,r,s,n){n||(n="center"),YX(e,r,s),DX(e,e,.5);const o=e[0],a=e[1];switch(n){case"center":AX(e,0,0);break;case"left":AX(e,-o,0);break;case"top":AX(e,0,a);break;case"right":AX(e,o,0);break;case"bottom":AX(e,0,-a);break;case"top-left":AX(e,-o,a);break;case"bottom-left":AX(e,-o,-a);break;case"top-right":AX(e,o,a);break;case"bottom-right":AX(e,o,-a)}return WK(t,i,e),t}}();function zK(e,t,i){return MK(e,t),e.rotation+=i,e}const VK=function(){const e=[0,0];return function(t,i,r,s,n){return MK(t,i),isNaN(r)||0===r||(qK(e,s,i,n),t.scale=i.scale*r,HK(e,e,t,n),WK(t,t,AX(e,e[0]-s[0],s[1]-e[1]))),t}}();function UK(e,t,i){return MK(e,t),e.scale=i,e}const GK=function(){const e=[0,0];return function(t,i,r,s,n,o){return MK(t,i),isNaN(r)||0===r||(qK(e,n,i,o),t.scale=i.scale*r,t.rotation+=s,HK(e,e,t,o),WK(t,t,AX(e,e[0]-n[0],n[1]-e[1]))),t}}(),BK=function(){const e=[0,0],t=[0,0];return function(i,r,s,n,o,a,l){return EK(t,a,l),PX(e,o,t),n?GK(i,r,s,n,e,a):VK(i,r,s,e,a)}}(),qK=function(){const e=[1,0,0,1,0,0];return function(t,i,r,s){return $X(t,i,function(e,t,i,r){return kK(e,t,i,r),yX(e,e)}(e,r,s,1))}}(),HK=function(){const e=[1,0,0,1,0,0];return function(t,i,r,s){return $X(t,i,kK(e,r,s,1))}}(),WK=function(){const e=[0,0],t=[1,0,0,1,0,0];return function(i,r,s){MK(i,r);const n=PK(r),o=i.targetGeometry;return wX(t,CK(r)),vX(t,t,nK(n,n)),$X(e,s,t),o.x+=e[0],o.y+=e[1],i}}();class $K{constructor(e,t,i,r){const s=e.targetGeometry,n=t.targetGeometry;r?"string"==typeof r&&(r=function(e){let t=dX[e]||null;if(!t){const i=pX.exec(e);if(i){const e=i[1].split(",").map((e=>parseFloat(e.trim())));4!==e.length||e.some((e=>isNaN(e)))||(t=uX.apply(uX,e))}}return t}(r)||dX.ease):r=dX.ease,this.easing=r,this.duration=i,this.sCenterX=s.x,this.sCenterY=s.y,this.sScale=e.scale,this.sRotation=e.rotation,this.tCenterX=n.x,this.tCenterY=n.y,this.tScale=t.scale,this.tRotation=t.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}applyRatio(e,t){const i=this.easing(t);let r,s,n,o;t>=1?(r=this.tCenterX,s=this.tCenterY,n=this.tRotation,o=this.tScale):(r=this.sCenterX+i*this.dCenterX,s=this.sCenterY+i*this.dCenterY,n=this.sRotation+i*this.dRotation,o=this.sScale+i*this.dScale),e.targetGeometry.x=r,e.targetGeometry.y=s,e.scale=o,e.rotation=n}}let JK=class extends jo{constructor(e){super(e),this.duration=200,this.transition=null,this.easing=dX.ease,this.view=null,this.viewpoint=null,this.viewpoint=new m$({targetGeometry:new il,scale:0,rotation:0}),this._updateTask=en({postRender:this._postRender.bind(this)}),this._updateTask.pause()}destroy(){this._updateTask.remove(),this._updateTask=null}animate(e,t,i){this.stop();MK(this.viewpoint,t),this.transition=new $K(this.viewpoint,e.target,i&&i.duration||this.duration,i&&i.easing||this.easing);const r=()=>{this.animation===e&&this._updateTask&&("finished"===e.state&&(this.transition.applyRatio(this.viewpoint,1),this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())),this.animation=null,this.updateFunction=null)};return e.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}animateContinous(e,t){this.stop(),this.updateFunction=t,this.viewpoint=e;const i=new cX({target:e.clone()}),r=()=>{this.animation===i&&this._updateTask&&(this.animation=null,this.updateFunction=null)};return i.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=i,i}stop(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}_postRender(e){const t=this.animation;if(t&&t.state!==cX.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{const e=(performance.now()-this._startTime)/this.transition.duration,t=e>=1;this.transition.applyRatio(this.viewpoint,e),t&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}};Q([ro()],JK.prototype,"animation",void 0),Q([ro()],JK.prototype,"duration",void 0),Q([ro()],JK.prototype,"transition",void 0),Q([ro()],JK.prototype,"easing",void 0),Q([ro()],JK.prototype,"view",void 0),Q([ro()],JK.prototype,"viewpoint",void 0),JK=Q([Ro("esri.views.2d.AnimationManager")],JK);var XK=JK;class KK{constructor(e){this.view=e,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.updateEnabled=!0,this.animationInProgress=!1,this.prepare=()=>{this._updateParameters.state=this.view.state,this._updateParameters.stationary=this.view.stationary,this._updateParameters.pixelRatio=window.devicePixelRatio,this._updateParameters.renderingOptions=this.view.renderingOptions},this.update=()=>{if(this._updateRequested=!1,!this.updateEnabled)return;const{basemapView:e,graphicsView:t,labelManager:i,layerViews:r,state:{id:s}}=this.view;e.baseLayerViews.forEach(this._updateLayerView,this),r.forEach(this._updateLayerView,this),e.referenceLayerViews.forEach(this._updateLayerView,this),m(i)&&(i.lastUpdateId!==s&&(i.viewChange(),i.lastUpdateId=s),i.updateRequested&&i.processUpdate(this._updateParameters)),m(t)&&(t.lastUpdateId!==s&&(t.viewChange(),t.lastUpdateId=s),t.updateRequested&&t.processUpdate(this._updateParameters)),this.animationInProgress||this._updateRequested||this._frameTaskHandle.pause()}}destroy(){this.stop()}start(){this.stationary=this.view.stationary,this._updateParameters={state:this.view.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:this.view.renderingOptions},this._stationaryHandle=this.view.watch("stationary",(e=>{this.stationary=e,this.requestFrame()})),this._frameTaskHandle=en(this)}stop(){this._frameTaskHandle&&(this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}requestUpdate(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}requestFrame(){this._frameTaskHandle&&this._frameTaskHandle.resume()}_updateLayerView(e){const t=this.view.state,i=e.lastUpdateId;null!=i&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),i!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}}function YK(){return Promise.all([import("./webgl.18dd7d0b.js"),import("./mapViewDeps.85c9188d.js")])}const ZK=()=>YK().then((()=>import("./TileLayerView2D.dd9c2401.js"))),QK=()=>YK().then((()=>import("./FeatureLayerView2D.b022ed53.js").then((function(e){return e.F})))),eY={"base-dynamic":()=>YK().then((()=>import("./BaseDynamicLayerView2D.4f80c7ec.js"))),"base-tile":ZK,"bing-maps":ZK,csv:QK,"geo-rss":()=>YK().then((()=>import("./GeoRSSLayerView2D.cd31d022.js"))),feature:QK,geojson:QK,graphics:()=>YK().then((()=>import("./GraphicsLayerView2D.3a334f7d.js"))),group:()=>YK().then((()=>import("./GroupLayerView2D.537fe58b.js"))),imagery:()=>YK().then((()=>import("./ImageryLayerView2D.08e41d57.js"))),"imagery-tile":()=>YK().then((()=>import("./ImageryTileLayerView2D.337a7dc5.js"))),kml:()=>YK().then((()=>import("./KMLLayerView2D.75b12649.js"))),"map-image":()=>YK().then((()=>import("./MapImageLayerView2D.3cb66af9.js"))),"map-notes":()=>YK().then((()=>import("./MapNotesLayerView2D.7039a1f5.js"))),"ogc-feature":()=>YK().then((()=>import("./OGCFeatureLayerView2D.ca2b9f73.js"))),"open-street-map":ZK,route:()=>YK().then((()=>import("./RouteLayerView2D.c3df17b9.js"))),stream:()=>YK().then((()=>import("./StreamLayerView2D.5d4e7ba3.js"))),"subtype-group":()=>YK().then((()=>import("./SubtypeGroupLayerView2D.c9910ab0.js"))),tile:ZK,"vector-tile":()=>YK().then((()=>import("./VectorTileLayerView2D.b20bcbe1.js"))),wcs:()=>YK().then((()=>import("./ImageryTileLayerView2D.337a7dc5.js"))),"web-tile":ZK,wfs:QK,wms:()=>YK().then((()=>import("./WMSLayerView2D.8b2ea96a.js"))),wmts:()=>YK().then((()=>import("./WMTSLayerView2D.2c1457c6.js"))),slice:null,"base-elevation":null,"building-scene":null,"direct-line-measurement":null,"area-measurement":null,elevation:null,"integrated-mesh":null,"line-of-sight":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};const tY=e=>m(eY[e.type]),iY=e=>{const t=eY[e.type];if(!m(t))throw function(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Be(`${i}:view-not-supported`,`${t} is not supported in 2D`)}(e);return t(e)};function rY(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function sY(e,t,i,r,s,n,o,a,l,h,c,u,p,d,f,y,g){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=h,e[9]=c,e[10]=u,e[11]=p,e[12]=d,e[13]=f,e[14]=y,e[15]=g,e}function nY(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function oY(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function aY(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=t[9],p=t[10],d=t[11],f=t[12],y=t[13],g=t[14],m=t[15],v=i*a-r*o,b=i*l-s*o,w=i*h-n*o,_=r*l-s*a,x=r*h-n*a,S=s*h-n*l,M=c*y-u*f,T=c*g-p*f,I=c*m-d*f,E=u*g-p*y,A=u*m-d*y,P=p*m-d*g;let C=v*P-b*A+w*E+_*I-x*T+S*M;return C?(C=1/C,e[0]=(a*P-l*A+h*E)*C,e[1]=(s*A-r*P-n*E)*C,e[2]=(y*S-g*x+m*_)*C,e[3]=(p*x-u*S-d*_)*C,e[4]=(l*I-o*P-h*T)*C,e[5]=(i*P-s*I+n*T)*C,e[6]=(g*w-f*S-m*b)*C,e[7]=(c*S-p*w+d*b)*C,e[8]=(o*A-a*I+h*M)*C,e[9]=(r*I-i*A-n*M)*C,e[10]=(f*x-y*w+m*v)*C,e[11]=(u*w-c*x-d*v)*C,e[12]=(a*T-o*E-l*M)*C,e[13]=(i*E-r*T+s*M)*C,e[14]=(y*b-f*_-g*v)*C,e[15]=(c*_-u*b+p*v)*C,e):null}function lY(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=t[8],p=t[9],d=t[10],f=t[11],y=t[12],g=t[13],m=t[14],v=t[15];let b=i[0],w=i[1],_=i[2],x=i[3];return e[0]=b*r+w*a+_*u+x*y,e[1]=b*s+w*l+_*p+x*g,e[2]=b*n+w*h+_*d+x*m,e[3]=b*o+w*c+_*f+x*v,b=i[4],w=i[5],_=i[6],x=i[7],e[4]=b*r+w*a+_*u+x*y,e[5]=b*s+w*l+_*p+x*g,e[6]=b*n+w*h+_*d+x*m,e[7]=b*o+w*c+_*f+x*v,b=i[8],w=i[9],_=i[10],x=i[11],e[8]=b*r+w*a+_*u+x*y,e[9]=b*s+w*l+_*p+x*g,e[10]=b*n+w*h+_*d+x*m,e[11]=b*o+w*c+_*f+x*v,b=i[12],w=i[13],_=i[14],x=i[15],e[12]=b*r+w*a+_*u+x*y,e[13]=b*s+w*l+_*p+x*g,e[14]=b*n+w*h+_*d+x*m,e[15]=b*o+w*c+_*f+x*v,e}function hY(e,t,i){const r=i[0],s=i[1],n=i[2];let o,a,l,h,c,u,p,d,f,y,g,m;return t===e?(e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15]):(o=t[0],a=t[1],l=t[2],h=t[3],c=t[4],u=t[5],p=t[6],d=t[7],f=t[8],y=t[9],g=t[10],m=t[11],e[0]=o,e[1]=a,e[2]=l,e[3]=h,e[4]=c,e[5]=u,e[6]=p,e[7]=d,e[8]=f,e[9]=y,e[10]=g,e[11]=m,e[12]=o*r+c*s+f*n+t[12],e[13]=a*r+u*s+y*n+t[13],e[14]=l*r+p*s+g*n+t[14],e[15]=h*r+d*s+m*n+t[15]),e}function cY(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function uY(e,t,i,r){let s,n,o,a,l,h,c,u,p,d,f,y,g,m,v,b,w,_,x,S,M,T,I,E,A=r[0],P=r[1],C=r[2],O=Math.sqrt(A*A+P*P+C*C);return O<Am?null:(O=1/O,A*=O,P*=O,C*=O,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],h=t[2],c=t[3],u=t[4],p=t[5],d=t[6],f=t[7],y=t[8],g=t[9],m=t[10],v=t[11],b=A*A*o+n,w=P*A*o+C*s,_=C*A*o-P*s,x=A*P*o-C*s,S=P*P*o+n,M=C*P*o+A*s,T=A*C*o+P*s,I=P*C*o-A*s,E=C*C*o+n,e[0]=a*b+u*w+y*_,e[1]=l*b+p*w+g*_,e[2]=h*b+d*w+m*_,e[3]=c*b+f*w+v*_,e[4]=a*x+u*S+y*M,e[5]=l*x+p*S+g*M,e[6]=h*x+d*S+m*M,e[7]=c*x+f*S+v*M,e[8]=a*T+u*I+y*E,e[9]=l*T+p*I+g*E,e[10]=h*T+d*I+m*E,e[11]=c*T+f*I+v*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function pY(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],h=t[8],c=t[9],u=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+h*r,e[5]=o*s+c*r,e[6]=a*s+u*r,e[7]=l*s+p*r,e[8]=h*s-n*r,e[9]=c*s-o*r,e[10]=u*s-a*r,e[11]=p*s-l*r,e}function dY(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],h=t[8],c=t[9],u=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-h*r,e[1]=o*s-c*r,e[2]=a*s-u*r,e[3]=l*s-p*r,e[8]=n*r+h*s,e[9]=o*r+c*s,e[10]=a*r+u*s,e[11]=l*r+p*s,e}function fY(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],h=t[4],c=t[5],u=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+h*r,e[1]=o*s+c*r,e[2]=a*s+u*r,e[3]=l*s+p*r,e[4]=h*s-n*r,e[5]=c*s-o*r,e[6]=u*s-a*r,e[7]=p*s-l*r,e}function yY(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function gY(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function mY(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function vY(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bY(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,h=n+n,c=r*a,u=r*l,p=r*h,d=s*l,f=s*h,y=n*h,g=o*a,m=o*l,v=o*h;return e[0]=1-(d+y),e[1]=u+v,e[2]=p-m,e[3]=0,e[4]=u-v,e[5]=1-(c+y),e[6]=f+g,e[7]=0,e[8]=p+m,e[9]=f-g,e[10]=1-(c+d),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}const wY=[0,0,0];function _Y(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,h=i*o,c=r*o,u=r*a,p=s*o,d=s*a,f=s*l,y=n*o,g=n*a,m=n*l;return e[0]=1-u-f,e[1]=c+m,e[2]=p-g,e[3]=0,e[4]=c-m,e[5]=1-h-f,e[6]=d+y,e[7]=0,e[8]=p+g,e[9]=d-y,e[10]=1-h-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xY(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),h=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*h,e[15]=0,e}function SY(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),h=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*h,e[15]=1,e}function MY(e,t,i,r){let s,n,o,a,l,h,c,u,p,d;const f=t[0],y=t[1],g=t[2],m=r[0],v=r[1],b=r[2],w=i[0],_=i[1],x=i[2];return Math.abs(f-w)<Am&&Math.abs(y-_)<Am&&Math.abs(g-x)<Am?nY(e):(c=f-w,u=y-_,p=g-x,d=1/Math.sqrt(c*c+u*u+p*p),c*=d,u*=d,p*=d,s=v*p-b*u,n=b*c-m*p,o=m*u-v*c,d=Math.sqrt(s*s+n*n+o*o),d?(d=1/d,s*=d,n*=d,o*=d):(s=0,n=0,o=0),a=u*o-p*n,l=p*s-c*o,h=c*n-u*s,d=Math.sqrt(a*a+l*l+h*h),d?(d=1/d,a*=d,l*=d,h*=d):(a=0,l=0,h=0),e[0]=s,e[1]=a,e[2]=c,e[3]=0,e[4]=n,e[5]=l,e[6]=u,e[7]=0,e[8]=o,e[9]=h,e[10]=p,e[11]=0,e[12]=-(s*f+n*y+o*g),e[13]=-(a*f+l*y+h*g),e[14]=-(c*f+u*y+p*g),e[15]=1,e)}function TY(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function IY(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function EY(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],h=e[7],c=e[8],u=e[9],p=e[10],d=e[11],f=e[12],y=e[13],g=e[14],m=e[15],v=t[0],b=t[1],w=t[2],_=t[3],x=t[4],S=t[5],M=t[6],T=t[7],I=t[8],E=t[9],A=t[10],P=t[11],C=t[12],O=t[13],k=t[14],L=t[15];return Math.abs(i-v)<=Am*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-b)<=Am*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(s-w)<=Am*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(n-_)<=Am*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(o-x)<=Am*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-S)<=Am*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-M)<=Am*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(h-T)<=Am*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(c-I)<=Am*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(u-E)<=Am*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(p-A)<=Am*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(d-P)<=Am*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(f-C)<=Am*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(y-O)<=Am*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(g-k)<=Am*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(m-L)<=Am*Math.max(1,Math.abs(m),Math.abs(L))}function AY(e){const t=Am,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],h=e[9],c=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+h*h))<=t&&Math.abs(1-(s*s+a*a+c*c))<=t}const PY=lY,CY=TY;Object.freeze({__proto__:null,copy:rY,set:sY,identity:nY,transpose:oY,invert:aY,adjoint:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=t[9],p=t[10],d=t[11],f=t[12],y=t[13],g=t[14],m=t[15];return e[0]=a*(p*m-d*g)-u*(l*m-h*g)+y*(l*d-h*p),e[1]=-(r*(p*m-d*g)-u*(s*m-n*g)+y*(s*d-n*p)),e[2]=r*(l*m-h*g)-a*(s*m-n*g)+y*(s*h-n*l),e[3]=-(r*(l*d-h*p)-a*(s*d-n*p)+u*(s*h-n*l)),e[4]=-(o*(p*m-d*g)-c*(l*m-h*g)+f*(l*d-h*p)),e[5]=i*(p*m-d*g)-c*(s*m-n*g)+f*(s*d-n*p),e[6]=-(i*(l*m-h*g)-o*(s*m-n*g)+f*(s*h-n*l)),e[7]=i*(l*d-h*p)-o*(s*d-n*p)+c*(s*h-n*l),e[8]=o*(u*m-d*y)-c*(a*m-h*y)+f*(a*d-h*u),e[9]=-(i*(u*m-d*y)-c*(r*m-n*y)+f*(r*d-n*u)),e[10]=i*(a*m-h*y)-o*(r*m-n*y)+f*(r*h-n*a),e[11]=-(i*(a*d-h*u)-o*(r*d-n*u)+c*(r*h-n*a)),e[12]=-(o*(u*g-p*y)-c*(a*g-l*y)+f*(a*p-l*u)),e[13]=i*(u*g-p*y)-c*(r*g-s*y)+f*(r*p-s*u),e[14]=-(i*(a*g-l*y)-o*(r*g-s*y)+f*(r*l-s*a)),e[15]=i*(a*p-l*u)-o*(r*p-s*u)+c*(r*l-s*a),e},determinant:function(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],h=e[8],c=e[9],u=e[10],p=e[11],d=e[12],f=e[13],y=e[14],g=e[15];return(t*o-i*n)*(u*g-p*y)-(t*a-r*n)*(c*g-p*f)+(t*l-s*n)*(c*y-u*f)+(i*a-r*o)*(h*g-p*d)-(i*l-s*o)*(h*y-u*d)+(r*l-s*a)*(h*f-c*d)},multiply:lY,translate:hY,scale:cY,rotate:uY,rotateX:pY,rotateY:dY,rotateZ:fY,fromTranslation:yY,fromScaling:gY,fromRotation:function(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],h=Math.sqrt(o*o+a*a+l*l);return h<Am?null:(h=1/h,o*=h,a*=h,l*=h,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:mY,fromYRotation:function(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:vY,fromRotationTranslation:bY,fromQuat2:function(e,t){const i=wY,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=r*r+s*s+n*n+o*o;return u>0?(i[0]=2*(a*o+c*r+l*n-h*s)/u,i[1]=2*(l*o+c*s+h*r-a*n)/u,i[2]=2*(h*o+c*n+a*s-l*r)/u):(i[0]=2*(a*o+c*r+l*n-h*s),i[1]=2*(l*o+c*s+h*r-a*n),i[2]=2*(h*o+c*n+a*s-l*r)),bY(e,t,i),e},getTranslation:function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},getScaling:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],h=t[9],c=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+h*h+c*c),e},getRotation:function(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e},fromRotationTranslationScale:function(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,h=n+n,c=o+o,u=s*l,p=s*h,d=s*c,f=n*h,y=n*c,g=o*c,m=a*l,v=a*h,b=a*c,w=r[0],_=r[1],x=r[2];return e[0]=(1-(f+g))*w,e[1]=(p+b)*w,e[2]=(d-v)*w,e[3]=0,e[4]=(p-b)*_,e[5]=(1-(u+g))*_,e[6]=(y+m)*_,e[7]=0,e[8]=(d+v)*x,e[9]=(y-m)*x,e[10]=(1-(u+f))*x,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],h=n+n,c=o+o,u=a+a,p=n*h,d=n*c,f=n*u,y=o*c,g=o*u,m=a*u,v=l*h,b=l*c,w=l*u,_=r[0],x=r[1],S=r[2],M=s[0],T=s[1],I=s[2],E=(1-(y+m))*_,A=(d+w)*_,P=(f-b)*_,C=(d-w)*x,O=(1-(p+m))*x,k=(g+v)*x,L=(f+b)*S,R=(g-v)*S,D=(1-(p+y))*S;return e[0]=E,e[1]=A,e[2]=P,e[3]=0,e[4]=C,e[5]=O,e[6]=k,e[7]=0,e[8]=L,e[9]=R,e[10]=D,e[11]=0,e[12]=i[0]+M-(E*M+C*T+L*I),e[13]=i[1]+T-(A*M+O*T+R*I),e[14]=i[2]+I-(P*M+k*T+D*I),e[15]=1,e},fromQuat:_Y,frustum:xY,perspective:function(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e},perspectiveFromFieldOfView:function(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),h=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*h*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},ortho:SY,lookAt:MY,targetTo:function(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],h=r[2];let c=s-i[0],u=n-i[1],p=o-i[2],d=c*c+u*u+p*p;d>0&&(d=1/Math.sqrt(d),c*=d,u*=d,p*=d);let f=l*p-h*u,y=h*c-a*p,g=a*u-l*c;return d=f*f+y*y+g*g,d>0&&(d=1/Math.sqrt(d),f*=d,y*=d,g*=d),e[0]=f,e[1]=y,e[2]=g,e[3]=0,e[4]=u*g-p*y,e[5]=p*f-c*g,e[6]=c*y-u*f,e[7]=0,e[8]=c,e[9]=u,e[10]=p,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},subtract:TY,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},exactEquals:IY,equals:EY,isOrthoNormal:AY,mul:PY,sub:CY});let OY,kY=null;function LY(){return!!kY}function RY(){return OY||(OY=import("./pe-wasm.fdd75db6.js").then((function(e){return e.p})).then((({default:e})=>e({locateFile:e=>gr(`esri/geometry/support/${e}`)}))).then((e=>{JY(e)})),OY)}var DY,FY,jY;!function(e){function t(e,t,i){kY.ensureCache.prepare();const r=YY(i),s=i===r,n=kY.ensureFloat64(r),o=kY._pe_geog_to_proj(kY.getPointer(e),t,n);return o&&ZY(i,t,n,s),o}function i(e,t,i){return r(e,t,i,0)}function r(e,t,i,r){kY.ensureCache.prepare();const s=YY(i),n=i===s,o=kY.ensureFloat64(s),a=kY._pe_proj_to_geog_center(kY.getPointer(e),t,o,r);return a&&ZY(i,t,o,n),a}e.geogToProj=t,e.projGeog=function(e,r,s,n){switch(n){case FY.PE_TRANSFORM_P_TO_G:return i(e,r,s);case FY.PE_TRANSFORM_G_TO_P:return t(e,r,s)}return 0},e.projToGeog=i,e.projToGeogCenter=r}(DY||(DY={})),function(e){e.init=function(){e.PE_BUFFER_MAX=kY.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=kY.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=kY.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=kY.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=kY.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=kY.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=kY.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=kY.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=kY.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=kY.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=kY.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=kY.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=kY.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=kY.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=kY.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=kY.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=kY.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=kY.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=kY.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=kY.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=kY.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=kY.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=kY.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=kY.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=kY.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=kY.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=kY.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=kY.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=kY.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=kY.PeDefs.prototype.PE_HORIZON_DELTA}}(FY||(FY={})),function(e){const t={},i={},r=e=>{if(e){const t=e.getType();switch(t){case FY.PE_TYPE_GEOGCS:e=kY.castObject(e,kY.PeGeogcs);break;case FY.PE_TYPE_PROJCS:e=kY.castObject(e,kY.PeProjcs);break;case FY.PE_TYPE_GEOGTRAN:e=kY.castObject(e,kY.PeGeogtran);break;default:t&FY.PE_TYPE_UNIT&&(e=kY.castObject(e,kY.PeUnit))}}return e};function s(e,i){let s=null,n=t[e];if(n||(n={},t[e]=n),n.hasOwnProperty(String(i)))s=n[i];else{const t=kY.PeFactory.prototype.factoryByType(e,i);kY.compare(t,kY.NULL)||(s=t,n[i]=s)}return s=r(s),s}e.initialize=function(){kY.PeFactory.prototype.initialize(null)},e.coordsys=function(e){return s(FY.PE_TYPE_COORDSYS,e)},e.factoryByType=s,e.fromString=function(e,t){let s=null,n=i[e];if(n||(n={},i[e]=n),n.hasOwnProperty(t))s=n[t];else{const i=kY.PeFactory.prototype.fromString(e,t);kY.compare(i,kY.NULL)||(s=i,n[t]=s)}return s=r(s),s},e.geogcs=function(e){return s(FY.PE_TYPE_GEOGCS,e)},e.geogtran=function(e){return s(FY.PE_TYPE_GEOGTRAN,e)},e.getCode=function(e){return kY.PeFactory.prototype.getCode(e)},e.projcs=function(e){return s(FY.PE_TYPE_PROJCS,e)},e.unit=function(e){return s(FY.PE_TYPE_UNIT,e)}}(jY||(jY={}));let NY=null;var zY,VY,UY,GY,BY,qY,HY,WY,$Y;function JY(e){function t(e,t,i){e[t]=i(e[t])}kY=e,FY.init(),zY.init(),BY.init(),HY.init(),WY.init(),NY=class extends kY.PeGCSExtent{destroy(){kY.destroy(this)}};const i=[kY.PeDatum,kY.PeGeogcs,kY.PeGeogtran,kY.PeObject,kY.PeParameter,kY.PePrimem,kY.PeProjcs,kY.PeSpheroid,kY.PeUnit];for(const n of i)t(n.prototype,"getName",(e=>function(){return e.call(this,new Array(FY.PE_NAME_MAX))}));for(const n of[kY.PeGeogtran,kY.PeProjcs])t(n.prototype,"getParameters",(e=>function(){const t=new Array(FY.PE_PARM_MAX);let i=e.call(this);for(let e=0;e<t.length;e++){const r=kY.getValue(i,"*");t[e]=r?kY.wrapPointer(r,kY.PeParameter):null,i+=Int32Array.BYTES_PER_ELEMENT}return t}));t(kY.PeHorizon.prototype,"getCoord",(e=>function(){const t=this.getSize();if(!t)return null;const i=[];return ZY(i,t,e.call(this)),i})),t(kY.PeGTlistExtendedEntry.prototype,"getEntries",(e=>{const t=kY._pe_getPeGTlistExtendedGTsSize();return function(){let i=null;const r=e.call(this);if(!kY.compare(r,kY.NULL)){i=[r];const e=this.getSteps();if(e>1){const s=kY.getPointer(r);for(let r=1;r<e;r++)i.push(kY.wrapPointer(s+t*r,kY.PeGTlistExtendedGTs))}}return i}}));const r=kY._pe_getPeHorizonSize(),s=e=>function(){let t=this._cache;if(t||(t=new Map,this._cache=t),t.has(e))return t.get(e);let i=null;const s=e.call(this);if(!kY.compare(s,kY.NULL)){i=[s];const e=s.getNump();if(e>1){const t=kY.getPointer(s);for(let s=1;s<e;s++)i.push(kY.wrapPointer(t+r*s,kY.PeHorizon))}}return t.set(e,i),i};t(kY.PeProjcs.prototype,"horizonGcsGenerate",s),t(kY.PeProjcs.prototype,"horizonPcsGenerate",s),kY.PeObject.prototype.toString=function(e=FY.PE_STR_OPTS_NONE){kY.ensureCache.prepare();const t=kY.getPointer(this),i=kY.ensureInt8(new Array(FY.PE_BUFFER_MAX));return kY.UTF8ToString(kY._pe_object_to_string_ext(t,e,i))}}function XY(e){if(!e)return;const t=kY.getClass(e);if(!t)return;const i=kY.getCache(t);if(!i)return;const r=kY.getPointer(e);r&&delete i[r]}function KY(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(kY.ensureInt8(r));return i}function YY(e){let t;return Array.isArray(e[0])?(t=[],e.forEach((e=>{t.push(e[0],e[1])}))):t=e,t}function ZY(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=kY.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const r=0===e.length;for(let s=0;s<t;s++)r&&(e[s]=new Array(2)),e[s][0]=kY.getValue(i,"double"),e[s][1]=kY.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}!function(e){let t;e.init=function(){e.PE_GTLIST_OPTS_COMMON=kY.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=kY._pe_getPeGTlistExtendedEntrySize()},e.getGTlist=function(e,i,r,s,n,o){let a=null;const l=new kY.PeInteger(o);try{const h=kY.PeGTlistExtended.prototype.getGTlist(e,i,r,s,n,l);if((o=l.val)&&(a=[h],o>1)){const e=kY.getPointer(h);for(let i=1;i<o;i++)a.push(kY.wrapPointer(e+t*i,kY.PeGTlistExtendedEntry))}}finally{kY.destroy(l)}return a}}(zY||(zY={})),(VY||(VY={})).destroy=function(e){if(e&&e.length){for(const t of e)XY(t),t.getEntries().forEach((e=>{XY(e);const t=e.getGeogtran();XY(t),t.getParameters().forEach(XY),[t.getGeogcs1(),t.getGeogcs2()].forEach((e=>{XY(e);const t=e.getDatum();XY(t),XY(t.getSpheroid()),XY(e.getPrimem()),XY(e.getUnit())}))}));kY.PeGTlistExtendedEntry.prototype.Delete(e[0])}},(UY||(UY={})).geogToGeog=function(e,t,i,r,s){kY.ensureCache.prepare();const n=YY(i),o=i===n,a=kY.ensureFloat64(n);let l=0;r&&(l=kY.ensureFloat64(r));const h=kY._pe_geog_to_geog(kY.getPointer(e),t,a,l,s);return h&&ZY(i,t,a,o),h},function(e){const t=(e,t,i,r,s,n)=>{let o,a;switch(kY.ensureCache.prepare(),e){case"dd":o=kY._pe_geog_to_dd,a=FY.PE_DD_MAX;break;case"ddm":o=kY._pe_geog_to_ddm,a=FY.PE_DDM_MAX;break;case"dms":o=kY._pe_geog_to_dms,a=FY.PE_DMS_MAX}let l=0;t&&(l=kY.getPointer(t));const h=YY(r),c=kY.ensureFloat64(h),u=KY(i,a),p=o(l,i,c,s,kY.ensureInt32(u));if(p)for(let d=0;d<i;d++)n[d]=kY.UTF8ToString(u[d]);return p},i=(e,t,i,r,s)=>{let n;switch(kY.ensureCache.prepare(),e){case"dd":n=kY._pe_dd_to_geog;break;case"ddm":n=kY._pe_ddm_to_geog;break;case"dms":n=kY._pe_dms_to_geog}let o=0;t&&(o=kY.getPointer(t));const a=r.map((e=>kY.ensureString(e))),l=kY.ensureInt32(a),h=kY.ensureFloat64(new Array(2*i)),c=n(o,i,l,h);return c&&ZY(s,i,h),c};e.geog_to_dms=function(e,i,r,s,n){return t("dms",e,i,r,s,n)},e.dms_to_geog=function(e,t,r,s){return i("dms",e,t,r,s)},e.geog_to_ddm=function(e,i,r,s,n){return t("ddm",e,i,r,s,n)},e.ddm_to_geog=function(e,t,r,s){return i("ddm",e,t,r,s)},e.geog_to_dd=function(e,i,r,s,n){return t("dd",e,i,r,s,n)},e.dd_to_geog=function(e,t,r,s){return i("dd",e,t,r,s)}}(GY||(GY={})),function(e){e.init=function(){e.PE_MGRS_STYLE_NEW=kY.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=kY.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=kY.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=kY.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=kY.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},e.geog_to_mgrs_extended=function(e,t,i,r,s,n,o){kY.ensureCache.prepare();let a=0;e&&(a=kY.getPointer(e));const l=YY(i),h=kY.ensureFloat64(l),c=KY(t,FY.PE_MGRS_MAX),u=kY.ensureInt32(c),p=kY._pe_geog_to_mgrs_extended(a,t,h,r,s,n,u);if(p)for(let d=0;d<t;d++)o[d]=kY.UTF8ToString(c[d]);return p},e.mgrs_to_geog_extended=function(e,t,i,r,s){kY.ensureCache.prepare();let n=0;e&&(n=kY.getPointer(e));const o=i.map((e=>kY.ensureString(e))),a=kY.ensureInt32(o),l=kY.ensureFloat64(new Array(2*t)),h=kY._pe_mgrs_to_geog_extended(n,t,a,r,l);return h&&ZY(s,t,l),h}}(BY||(BY={})),function(e){e.geog_to_usng=function(e,t,i,r,s,n,o){kY.ensureCache.prepare();let a=0;e&&(a=kY.getPointer(e));const l=YY(i),h=kY.ensureFloat64(l),c=KY(t,FY.PE_MGRS_MAX),u=kY.ensureInt32(c),p=kY._pe_geog_to_usng(a,t,h,r,s,n,u);if(p)for(let d=0;d<t;d++)o[d]=kY.UTF8ToString(c[d]);return p},e.usng_to_geog=function(e,t,i,r){kY.ensureCache.prepare();let s=0;e&&(s=kY.getPointer(e));const n=i.map((e=>kY.ensureString(e))),o=kY.ensureInt32(n),a=kY.ensureFloat64(new Array(2*t)),l=kY._pe_usng_to_geog(s,t,o,a);return l&&ZY(r,t,a),l}}(qY||(qY={})),function(e){e.init=function(){e.PE_UTM_OPTS_NONE=kY.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=kY.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=kY.PeNotationUtm.prototype.PE_UTM_OPTS_NS},e.geog_to_utm=function(e,t,i,r,s){kY.ensureCache.prepare();let n=0;e&&(n=kY.getPointer(e));const o=YY(i),a=kY.ensureFloat64(o),l=KY(t,FY.PE_UTM_MAX),h=kY.ensureInt32(l),c=kY._pe_geog_to_utm(n,t,a,r,h);if(c)for(let u=0;u<t;u++)s[u]=kY.UTF8ToString(l[u]);return c},e.utm_to_geog=function(e,t,i,r,s){kY.ensureCache.prepare();let n=0;e&&(n=kY.getPointer(e));const o=i.map((e=>kY.ensureString(e))),a=kY.ensureInt32(o),l=kY.ensureFloat64(new Array(2*t)),h=kY._pe_utm_to_geog(n,t,a,r,l);return h&&ZY(s,t,l),h}}(HY||(HY={})),function(e){const t=new Map;e.init=function(){e.PE_PCSINFO_OPTION_NONE=kY.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=kY.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=kY.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=kY.PePCSInfo.prototype.PE_POLE_POINT},e.generate=function(i,r=e.PE_PCSINFO_OPTION_DOMAIN){let s,n;return t.has(i)&&(n=t.get(i),n[r]&&(s=n[r])),s||(s=kY.PePCSInfo.prototype.generate(i,r),n||(n=[],t.set(i,n)),n[r]=s),s}}(WY||(WY={})),($Y||($Y={})).version_string=function(){return kY.PeVersion.prototype.version_string()};var QY=Object.freeze({__proto__:null,get _pe(){return kY},isLoaded:LY,isSupported:function(){return!!y("esri-wasm")},load:RY,get PeCSTransformations(){return DY},get PeDefs(){return FY},get PeFactory(){return jY},get PeGCSExtent(){return NY},get PeGTlistExtended(){return zY},get PeGTlistExtendedEntry(){return VY},get PeGTTransformations(){return UY},get PeNotationDms(){return GY},get PeNotationMgrs(){return BY},get PeNotationUsng(){return qY},get PeNotationUtm(){return HY},get PePCSInfo(){return WY},get PeVersion(){return $Y},_init:JY});const eZ=Math.PI/180,tZ=/SPHEROID\[([^\]]+)]/i,iZ=Fa.radius,rZ=Fa.eccentricitySquared,sZ={a1:iZ*rZ,a2:iZ*rZ*iZ*rZ,a3:iZ*rZ*rZ/2,a4:iZ*rZ*iZ*rZ*2.5,a5:iZ*rZ+iZ*rZ*rZ/2,a6:1-rZ},nZ={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Fa.radius,f:Fa.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Na.radius,f:Na.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:ja.radius,f:ja.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:ja.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let oZ=0;class aZ{constructor(e=null){this.uid=oZ++,e?(this._wkt=void 0!==e.wkt?e.wkt:null,this._wkid=void 0!==e.wkid?e.wkid:-1,this._isInverse=void 0!==e.isInverse&&!0===e.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(e){const t=new aZ;return t._wkt=e.wkt,t._wkid=e.wkid,t._isInverse=e.isInverse,t}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=oZ++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=oZ++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=oZ++}getInverse(){const e=new aZ;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}}class lZ{constructor(e){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const t of e.steps)t instanceof aZ?this.steps.push(t):this.steps.push(new aZ({wkid:t.wkid,wkt:t.wkt,isInverse:t.isInverse}))}static cacheKey(e,t){return[void 0!==e.wkid&&null!==e.wkid?e.wkid.toString():"-1",void 0!==e.wkt&&null!==e.wkt?e.wkt.toString():"",void 0!==t.wkid&&null!==t.wkid?t.wkid.toString():"-1",void 0!==t.wkt&&null!==t.wkt?t.wkt.toString():""].join(",")}static fromGE(e){const t=new lZ;let i="";for(const r of e.steps){const e=aZ.fromGE(r);t.steps.push(e),i+=e.uid.toString()+","}return t._cached_projection={},t._gtlistentry=null,t._chain=i,t}getInverse(){const e=new lZ;e.steps=[];for(let t=this.steps.length-1;t>=0;t--){const i=this.steps[t];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const t of this.steps)e+=t.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e),this._gtlistentry}assignCachedGe(e,t,i){this._cached_projection[lZ.cacheKey(e,t)]=i}getCachedGeTransformation(e,t){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=i);const r=this._cached_projection[lZ.cacheKey(e,t)];return void 0===r?null:r}}let hZ=null,cZ=null,uZ=null,pZ={};function dZ(){return!!hZ&&LY()}function fZ(){return!0}function yZ(e){return v(uZ)&&(uZ=Promise.all([RY(),Promise.resolve().then((function(){return UAe})).then((function(e){return e.g})),Promise.resolve().then((function(){return BAe}))])),uZ.then((([,t,{hydratedAdapter:i}])=>{tt(e),cZ=i,hZ=t.default,hZ._enableProjection(QY)}))}function gZ(e,t,i=null){return Array.isArray(e)?0===e.length?[]:mZ(cZ,e,e[0].spatialReference,t,i):mZ(cZ,[e],e.spatialReference,t,i)[0]}function mZ(e,t,i,r,s=null){if(v(i)||v(r))return t;if(wZ(i,r,s))return t.map((e=>function(e,t,i){if(!e)return e;if("x"in e){const r=new il;return SZ(e,t,r,i)?r:null}if("xmin"in e){const r=new Ol;return function(e,t,i,r,s=0){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:h,hasM:c}=e;return!!AZ(n,o,h?e.zmin:s,t,lQ,r)&&(i.xmin=lQ[0],i.ymin=lQ[1],h&&(i.zmin=lQ[2]),!!AZ(a,l,h?e.zmax:s,t,lQ,r)&&(i.xmax=lQ[0],i.ymax=lQ[1],h&&(i.zmax=lQ[2]),c&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,!0))}(e,t,r,i)?r:null}if("rings"in e){const r=new rw;return TZ(e,t,r,i)?r:null}if("paths"in e){const r=new nw;return function(e,t,i,r,s=0){const{paths:n,hasZ:o,hasM:a}=e,l=[];return!!OZ(n,o,a,t,l,r,s)&&(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,!0)}(e,t,r,i)?r:null}if("points"in e){const r=new gb;return function(e,t,i,r,s=0){const{points:n,hasZ:o,hasM:a}=e,l=[],h=n.length,c=[];for(const u of n)c.push(u[0],u[1],o?u[2]:s);if(!CZ(c,t,0,c,r,0,h))return!1;for(let u=0;u<h;++u){const e=3*u,t=c[e],i=c[e+1];o&&a?l.push([t,i,c[e+2],n[u][3]]):o?l.push([t,i,c[e+2]]):a?l.push([t,i,n[u][2]]):l.push([t,i])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,!0}(e,t,r,i)?r:null}return null}(e,i,r)));if(v(s)){const e=lZ.cacheKey(i,r);void 0!==pZ[e]?s=pZ[e]:(v(s=vZ(i,r,null))&&(s=new lZ),pZ[e]=s)}if(v(hZ))throw new bZ;return hZ._project(e,t,i,r,s)}function vZ(e,t,i=null){if(v(hZ))throw new bZ;if(v(e)||v(t))return null;const r=hZ._getTransformation(cZ,e,t,i,null==i?void 0:i.spatialReference);return null!==r?lZ.fromGE(r):null}class bZ extends Be{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function wZ(e,t,i){return!i&&(!!fa(e,t)||Ma(e)&&Ma(t)&&!!ZZ(e,t,iQ))}async function _Z(e,t,i,r){if(!dZ())if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!wZ(s,n,o))return yZ(r)}else if(!wZ(e,t,i))return yZ(r)}function xZ(e,t,i=t.spatialReference,r=0){return!v(i)&&SZ(e,e.spatialReference,t,i,r)}function SZ(e,t,i,r,s=0){lQ[0]=e.x,lQ[1]=e.y;const n=e.z;return lQ[2]=void 0!==n?n:s,!!CZ(lQ,t,0,lQ,r,0,1)&&(i.x=lQ[0],i.y=lQ[1],i.spatialReference=r,void 0===n?(i.z=void 0,i.hasZ=!1):(i.z=lQ[2],i.hasZ=!0),void 0===e.m?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),!0)}function MZ(e,t,i=t.spatialReference,r=0){return!v(i)&&TZ(e,e.spatialReference,t,i,r)}function TZ(e,t,i,r,s=0){const{rings:n,hasZ:o,hasM:a}=e,l=[];return!!OZ(n,o,a,t,l,r,s)&&(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,!0)}function IZ(e,t,i){return CZ(e,t,0,lQ,i.spatialReference,0,1)?(i.x=lQ[0],i.y=lQ[1],i.z=lQ[2],i):null}function EZ(e,t,i,r=0){lQ[0]=e.x,lQ[1]=e.y;const s=e.z;return lQ[2]=void 0!==s?s:r,CZ(lQ,e.spatialReference,0,t,i,0,1)}function AZ(e,t,i,r,s,n){return nQ[0]=e,nQ[1]=t,nQ[2]=i,CZ(nQ,r,0,s,n,0,1)}function PZ(e,t,i,r){return!(v(t)||v(r)||e.length<2)&&(2===e.length&&(nQ[0]=e[0],nQ[1]=e[1],nQ[2]=0,e=nQ),CZ(e,t,0,i,r,0,1))}function CZ(e,t,i,r,s,n,o=1){const a=ZZ(t,s,iQ);if(v(a))return!1;if(a===jZ){if(e===r&&i===n)return!0;const t=i+3*o;for(let s=i,o=n;s<t;s++,o++)r[o]=e[s];return!0}const l=i+3*o;for(let h=i,c=n;h<l;h+=3,c+=3)a(e,h,r,c);return!0}function OZ(e,t,i,r,s,n,o=0){const a=new Array;for(const h of e)for(const e of h)a.push(e[0],e[1],t?e[2]:o);if(!CZ(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const h of e){const e=new Array;for(const r of h)t&&i?e.push([a[l++],a[l++],a[l++],r[3]]):t?e.push([a[l++],a[l++],a[l++]]):i?(e.push([a[l++],a[l++],r[2]]),l++):(e.push([a[l++],a[l++]]),l++);s.push(e)}return!0}function kZ(e,t,i,r){return!(null==e||(fa(t,r)?(N$(i,e),0):(nQ[0]=e[0],nQ[1]=e[1],nQ[2]=0,!CZ(nQ,t,0,nQ,r,0,1)||(i[0]=nQ[0],i[1]=nQ[1],nQ[0]=e[2],nQ[1]=e[3],nQ[2]=0,!CZ(nQ,t,0,nQ,r,0,1)||(i[2]=nQ[0],i[3]=nQ[1],0)))))}function LZ(e,t,i,r){if(v(e)||v(r))return!1;const s=FZ(e,eQ),n=FZ(r,tQ);if(s===n&&!RZ(n)&&(0!==s||fa(e,r)))return nY(i),hY(i,i,t),!0;if(RZ(n)){let e=0,r=0;const o=YZ[s][11],a=YZ[11][n];return!v(o)&&!v(a)&&(o(t,0,oQ,0),a(oQ,0,aQ,0),e=rQ*oQ[0],r=rQ*oQ[1],DZ(r,e,i),i[12]=aQ[0],i[13]=aQ[1],i[14]=aQ[2],!0)}if(3===n&&(2===s||1===s)){const e=YZ[s][11];if(v(e))return!1;e(t,0,oQ,0);const r=rQ*oQ[1];VZ(oQ,0,aQ,0),nY(i),hY(i,i,aQ);const n=1/Math.cos(r);return cY(i,i,[n,n,1]),!0}return!1}function RZ(e){return 1===e||7===e||9===e}function DZ(e,t,i){const r=Math.sin(t),s=Math.cos(t),n=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function FZ(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=VA(e,1)),e.wkt===gA.wkt?t.spatialReferenceId=1:ma(e)?t.spatialReferenceId=2:ba(e)?t.spatialReferenceId=3:e.wkt===bA.wkt?t.spatialReferenceId=4:4490===e.wkid?t.spatialReferenceId=5:e.wkt===mA.wkt?t.spatialReferenceId=7:e.wkt===vA.wkt?t.spatialReferenceId=9:_a(e)?t.spatialReferenceId=8:Sa(e)?t.spatialReferenceId=10:t.spatialReferenceId=0)}function jZ(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function NZ(e,t,i,r){i[r++]=sQ*(e[t++]/Fa.radius),i[r++]=sQ*(Math.PI/2-2*Math.atan(Math.exp(-1*e[t++]/Fa.radius))),i[r]=e[t]}function zZ(e,t,i,r,s){const n=.4999999*Math.PI,o=mv(rQ*e[t+1],-n,n),a=Math.sin(o);i[r++]=rQ*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function VZ(e,t,i,r){zZ(e,t,i,r,Fa)}function UZ(e,t,i,r,s){const n=s+e[t+2],o=rQ*e[t+1],a=rQ*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function GZ(e,t,i,r){UZ(e,t,i,r,Na.radius)}function BZ(e,t,i,r){UZ(e,t,i,r,ja.radius)}function qZ(e,t,i,r){UZ(e,t,i,r,Fa.radius)}function HZ(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),h=Ev(a/(0===l?1:l)),c=Math.atan2(o,n);i[r++]=sQ*c,i[r++]=sQ*h,i[r]=l-s}function WZ(e,t,i,r){HZ(e,t,i,r,Na.radius)}function $Z(e,t,i,r){HZ(e,t,i,r,ja.radius)}function JZ(e,t,i,r){HZ(e,t,i,r,Fa.radius)}function XZ(e,t,i,r){!function(e,t,i,r,s){const n=rQ*e[t],o=rQ*e[t+1],a=e[t+2],l=Math.sin(o),h=Math.cos(o),c=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(c+a)*h*Math.cos(n),i[r++]=(c+a)*h*Math.sin(n),i[r++]=(c*(1-s.eccentricitySquared)+a)*l}(e,t,i,r,Fa)}function KZ(e,t,i,r){const s=sZ,n=e[t],o=e[t+1],a=e[t+2];let l,h,c,u,p,d,f,y,g,m,v,b,w,_,x,S,M,T,I,E,A;l=Math.abs(a),h=n*n+o*o,c=Math.sqrt(h),u=h+a*a,p=Math.sqrt(u),E=Math.atan2(o,n),d=a*a/u,f=h/u,_=s.a2/p,x=s.a3-s.a4/p,f>.3?(y=l/p*(1+f*(s.a1+_+d*x)/p),I=Math.asin(y),m=y*y,g=Math.sqrt(1-m)):(g=c/p*(1-d*(s.a5-_-f*x)/p),I=Math.acos(g),m=1-g*g,y=Math.sqrt(m)),v=1-Fa.eccentricitySquared*m,b=Fa.radius/Math.sqrt(v),w=s.a6*b,_=c-b*g,x=l-w*y,M=g*_+y*x,S=g*x-y*_,T=S/(w/v+M),I+=T,A=M+S*T/2,a<0&&(I=-I),i[r++]=sQ*E,i[r++]=sQ*I,i[r]=A}const YZ={2:{5:null,8:null,10:null,11:jZ,6:jZ,1:qZ,7:null,9:null,0:null,3:VZ,2:jZ,4:XZ},5:{5:jZ,8:null,10:null,11:jZ,6:jZ,1:qZ,7:null,9:null,0:null,3:null,2:null,4:XZ},8:{5:null,8:jZ,10:null,11:jZ,6:null,1:null,7:BZ,9:null,0:null,3:null,2:null,4:null},10:{5:null,8:null,10:jZ,11:jZ,6:null,1:null,7:null,9:GZ,0:null,3:null,2:null,4:null},3:{5:null,8:null,10:null,11:NZ,6:NZ,1:function(e,t,i,r){NZ(e,t,i,r),qZ(i,r,i,r)},7:null,9:null,0:null,3:jZ,2:NZ,4:function(e,t,i,r){NZ(e,t,i,r),XZ(i,r,i,r)}},4:{5:KZ,8:null,10:null,11:KZ,6:KZ,1:function(e,t,i,r){KZ(e,t,i,r),qZ(i,r,i,r)},7:null,9:null,0:null,3:function(e,t,i,r){KZ(e,t,i,r),VZ(i,r,i,r)},2:KZ,4:jZ},1:{5:JZ,8:null,10:null,11:JZ,6:JZ,1:jZ,7:null,9:null,0:null,3:function(e,t,i,r){JZ(e,t,i,r),VZ(i,r,i,r)},2:JZ,4:function(e,t,i,r){JZ(e,t,i,r),XZ(i,r,i,r)}},7:{5:null,8:$Z,10:null,11:$Z,6:null,1:null,7:jZ,9:null,0:null,3:null,2:null,4:null},9:{5:null,8:null,10:WZ,11:WZ,6:null,1:null,7:null,9:jZ,0:null,3:null,2:null,4:null},0:{5:null,8:null,10:null,11:null,6:null,1:null,7:null,9:null,0:jZ,3:null,2:null,4:null},11:{5:jZ,8:jZ,10:jZ,11:jZ,6:jZ,1:qZ,7:BZ,9:GZ,0:null,3:VZ,2:jZ,4:XZ},6:{5:null,8:null,10:null,11:jZ,6:jZ,1:qZ,7:null,9:null,0:null,3:null,2:jZ,4:XZ}};function ZZ(e,t,i=QZ()){return v(e)||v(t)?null:function(e,t,i){if(v(e)||v(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=FZ(e,i.source),s=FZ(t,i.dest);return 0===r&&0===s?fa(e,t)?i.projector=jZ:i.projector=null:i.projector=YZ[r][s],i}(e,t,i).projector}function QZ(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:jZ}}const eQ={spatialReference:null,spatialReferenceId:0},tQ={spatialReference:null,spatialReferenceId:0},iQ=QZ(),rQ=Sv(1),sQ=Mv(1),nQ=[0,0,0],oQ=[0,0,0],aQ=[0,0,0],lQ=[0,0,0];var hQ;const cQ=Ne.getLogger("esri.views.MapView");let uQ=hQ=class extends jo{constructor(e){super(e),this.geometry=null,this.spatialReference=null}get normalizedGeometry(){return this.geometry&&this.spatialReference?this.spatialReference.equals(this.geometry.spatialReference)?this.geometry:Ha(this.geometry,this.spatialReference)?Wa(this.geometry,this.spatialReference):dZ()?gZ(this.geometry,this.spatialReference):(cQ.error("#constraints.geometry","unsupported coordinate system. The source geometry cannot be projected to the view's coordinate system. The projection engine cannot be loaded.",{geometry:this.geometry}),null):null}constrain(e,t){if(!this.normalizedGeometry)return e;const i=e.targetGeometry;if("extent"===this.normalizedGeometry.type?sl(this.normalizedGeometry,i):hl(this.normalizedGeometry,i))return e;const{coordinate:r}=function(e,t){const{spatialReference:i}=t,r=[t.x,t.y];let s=Number.POSITIVE_INFINITY,n=0,o=0;const a=[0,0],l="extent"===e.type?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:e.rings;for(const h of l)for(let e=0;e<h.length-1;e++){wb(a,r,h,e);const t=jX(r,a);t<s&&(s=t,n=a[0],o=a[1])}return{coordinate:new il({x:n,y:o,spatialReference:i}),distance:s}}(this.normalizedGeometry,i);return r?(e.targetGeometry=r,e):e}clone(){var e,t;return new hQ({geometry:null==(e=this.geometry)?void 0:e.clone(),spatialReference:null==(t=this.spatialReference)?void 0:t.clone()})}};var pQ;Q([ro({constructOnly:!0})],uQ.prototype,"geometry",void 0),Q([ro({readOnly:!0})],uQ.prototype,"normalizedGeometry",null),Q([ro({constructOnly:!0})],uQ.prototype,"spatialReference",void 0),uQ=hQ=Q([Ro("esri.views.2d.constraints.GeometryConstraint")],uQ);let dQ=pQ=class extends jo{constructor(){super(...arguments),this.enabled=!0,this.rotationEnabled=!0}constrain(e,t){return this.enabled&&t?(this.rotationEnabled||(e.rotation=t.rotation),e):e}clone(){return new pQ({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}};Q([ro()],dQ.prototype,"enabled",void 0),Q([ro()],dQ.prototype,"rotationEnabled",void 0),dQ=pQ=Q([Ro("esri.views.2d.constraints.RotationConstraint")],dQ);var fQ,yQ=dQ;let gQ=fQ=class extends jo{constructor(e){super(e),this._lodByScale={},this._scales=[],this.effectiveLODs=null,this.effectiveMinZoom=-1,this.effectiveMaxZoom=-1,this.effectiveMinScale=0,this.effectiveMaxScale=0,this.lods=null,this.minZoom=-1,this.maxZoom=-1,this.minScale=0,this.maxScale=0,this.snapToZoom=!0}initialize(){let e,{lods:t,minScale:i,maxScale:r,minZoom:s,maxZoom:n}=this,o=-1,a=-1,l=!1,h=!1;if(0!==i&&0!==r&&i<r&&([i,r]=[r,i]),!t||!t.length)return this._set("effectiveMinScale",i),void this._set("effectiveMaxScale",r);t=t.map((e=>e.clone())),t.sort(((e,t)=>t.scale-e.scale)),t.forEach(((e,t)=>e.level=t));for(const c of t)!l&&i>0&&i>=c.scale&&(o=c.level,l=!0),!h&&r>0&&r>=c.scale&&(a=e?e.level:-1,h=!0),e=c;-1===s&&(s=0===i?0:o),-1===n&&(n=0===r?t.length-1:a),s=Math.max(s,0),s=Math.min(s,t.length-1),n=Math.max(n,0),n=Math.min(n,t.length-1),s>n&&([s,n]=[n,s]),i=t[s].scale,r=t[n].scale,t.splice(0,s),t.splice(n-s+1,t.length),t.forEach(((e,t)=>{this._lodByScale[e.scale]=e,this._scales[t]=e.scale})),this._set("effectiveLODs",t),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",n),this._set("effectiveMinScale",i),this._set("effectiveMaxScale",r)}constrain(e,t){if(t&&e.scale===t.scale)return e;const i=this.effectiveMinScale,r=this.effectiveMaxScale,s=e.targetGeometry,n=t&&t.targetGeometry,o=0!==r&&e.scale<r,a=0!==i&&e.scale>i;if(o||a){const o=a?i:r;if(n){const i=(o-t.scale)/(e.scale-t.scale);s.x=n.x+(s.x-n.x)*i,s.y=n.y+(s.y-n.y)*i}e.scale=o}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}fit(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);const t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}zoomToScale(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);const t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];const i=Math.round(e-.5),r=Math.round(e);return t[r]+(r-e)*(t[i]-t[r])}scaleToZoom(e){if(!this.effectiveLODs)return-1;const t=this._scales;let i,r;if(e>=t[0])return this.effectiveMinZoom;if(e<=t[t.length-1])return this.effectiveMaxZoom;for(let s=0;s<t.length-1;s++){if(i=t[s],r=t[s+1],r===e)return s+this.effectiveMinZoom+1;if(i>e&&r<e)return s+this.effectiveMinZoom+1-(e-r)/(i-r)}}snapToClosestScale(e){if(!this.effectiveLODs)return e;const t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}snapToNextScale(e,t=.5){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}snapToPreviousScale(e,t=2){if(!this.effectiveLODs)return e*t;const i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}clone(){return new fQ({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}_getClosestScale(e){return this._lodByScale[e]||(e=this._scales.reduce(((t,i)=>Math.abs(i-e)<=Math.abs(t-e)?i:t),this._scales[0])),this._lodByScale[e].scale}};Q([ro({readOnly:!0})],gQ.prototype,"effectiveLODs",void 0),Q([ro({readOnly:!0})],gQ.prototype,"effectiveMinZoom",void 0),Q([ro({readOnly:!0})],gQ.prototype,"effectiveMaxZoom",void 0),Q([ro({readOnly:!0})],gQ.prototype,"effectiveMinScale",void 0),Q([ro({readOnly:!0})],gQ.prototype,"effectiveMaxScale",void 0),Q([ro({type:[H$]})],gQ.prototype,"lods",void 0),Q([ro()],gQ.prototype,"minZoom",void 0),Q([ro()],gQ.prototype,"maxZoom",void 0),Q([ro()],gQ.prototype,"minScale",void 0),Q([ro()],gQ.prototype,"maxScale",void 0),Q([ro()],gQ.prototype,"snapToZoom",void 0),gQ=fQ=Q([Ro("esri.views.2d.constraints.ZoomConstraint")],gQ);var mQ=gQ;const vQ={base:null,key:"type",typeMap:{extent:Ol,polygon:rw}};let bQ=class extends sh.EventedAccessor{constructor(){super(...arguments),this.lods=null,this.minScale=0,this.maxScale=0,this.minZoom=-1,this.maxZoom=-1,this.rotationEnabled=!0,this.snapToZoom=!0}initialize(){this.watch(["_zoom","_rotation"],this.emit.bind(this,"update"),!0)}destroy(){this.view=null,this._set("_zoom",null),this._set("_rotation",null)}set geometry(e){e?this._set("geometry",e):this._set("geometry",null)}get _defaultLODs(){const e=this.get("view.defaultsFromMap.tileInfo"),t=this.get("view.spatialReference");return e&&t&&e.spatialReference.equals(t)?e.lods:null}get _geometry(){return new uQ({geometry:this.geometry,spatialReference:this.view.spatialReference})}get _rotation(){return new yQ({rotationEnabled:this.rotationEnabled})}get _zoom(){return new mQ({lods:this.lods||this._defaultLODs,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale,snapToZoom:this.snapToZoom})}canZoomInTo(e){const t=this.effectiveMaxScale;return 0===t||e>=t}canZoomOutTo(e){const t=this.effectiveMinScale;return 0===t||e<=t}constrain(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),e}constrainByGeometry(e){return this._geometry.constrain(e)}fit(e){return this._zoom.fit(e)}zoomToScale(e){return this._zoom.zoomToScale(e)}scaleToZoom(e){return this._zoom.scaleToZoom(e)}snapScale(e){return this._zoom.snapToClosestScale(e)}snapToNextScale(e){return this._zoom.snapToNextScale(e)}snapToPreviousScale(e){return this._zoom.snapToPreviousScale(e)}};Q([ro({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],bQ.prototype,"effectiveLODs",void 0),Q([ro({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],bQ.prototype,"effectiveMinScale",void 0),Q([ro({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],bQ.prototype,"effectiveMaxScale",void 0),Q([ro({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],bQ.prototype,"effectiveMinZoom",void 0),Q([ro({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],bQ.prototype,"effectiveMaxZoom",void 0),Q([ro({types:vQ,value:null})],bQ.prototype,"geometry",null),Q([ro({type:[H$]})],bQ.prototype,"lods",void 0),Q([ro()],bQ.prototype,"minScale",void 0),Q([ro()],bQ.prototype,"maxScale",void 0),Q([ro()],bQ.prototype,"minZoom",void 0),Q([ro()],bQ.prototype,"maxZoom",void 0),Q([ro()],bQ.prototype,"rotationEnabled",void 0),Q([ro()],bQ.prototype,"snapToZoom",void 0),Q([ro()],bQ.prototype,"view",void 0),Q([ro()],bQ.prototype,"_defaultLODs",null),Q([ro({type:uQ})],bQ.prototype,"_geometry",null),Q([ro({type:yQ})],bQ.prototype,"_rotation",null),Q([ro({readOnly:!0,type:mQ})],bQ.prototype,"_zoom",null),bQ=Q([Ro("esri.views.2d.MapViewConstraints")],bQ);var wQ=bQ;function _Q(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function xQ(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function SQ(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)xQ(e,t,i,a*n)}function MQ(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function TQ(e,t,i,r,s,n,o,a,l,h){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=h,e}function IQ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function EQ(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function AQ(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=c*o-a*h,p=-c*n+a*l,d=h*n-o*l;let f=i*u+r*p+s*d;return f?(f=1/f,e[0]=u*f,e[1]=(-c*r+s*h)*f,e[2]=(a*r-s*o)*f,e[3]=p*f,e[4]=(c*i-s*l)*f,e[5]=(-a*i+s*n)*f,e[6]=d*f,e[7]=(-h*i+r*l)*f,e[8]=(o*i-r*n)*f,e):null}function PQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=t[8],p=i[0],d=i[1],f=i[2],y=i[3],g=i[4],m=i[5],v=i[6],b=i[7],w=i[8];return e[0]=p*r+d*o+f*h,e[1]=p*s+d*a+f*c,e[2]=p*n+d*l+f*u,e[3]=y*r+g*o+m*h,e[4]=y*s+g*a+m*c,e[5]=y*n+g*l+m*u,e[6]=v*r+b*o+w*h,e[7]=v*s+b*a+w*c,e[8]=v*n+b*l+w*u,e}function CQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=t[8],p=i[0],d=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=p*r+d*o+h,e[7]=p*s+d*a+c,e[8]=p*n+d*l+u,e}function OQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],c=t[7],u=t[8],p=Math.sin(i),d=Math.cos(i);return e[0]=d*r+p*o,e[1]=d*s+p*a,e[2]=d*n+p*l,e[3]=d*o-p*r,e[4]=d*a-p*s,e[5]=d*l-p*n,e[6]=h,e[7]=c,e[8]=u,e}function kQ(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function LQ(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function RQ(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],h=t[9],c=t[10],u=c*o-a*h,p=-c*n+a*l,d=h*n-o*l,f=i*u+r*p+s*d;if(!f)return null;const y=1/f;return e[0]=u*y,e[1]=(-c*r+s*h)*y,e[2]=(a*r-s*o)*y,e[3]=p*y,e[4]=(c*i-s*l)*y,e[5]=(-a*i+s*n)*y,e[6]=d*y,e[7]=(-h*i+r*l)*y,e[8]=(o*i-r*n)*y,e}function DQ(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8],u=t[9],p=t[10],d=t[11],f=t[12],y=t[13],g=t[14],m=t[15],v=i*a-r*o,b=i*l-s*o,w=i*h-n*o,_=r*l-s*a,x=r*h-n*a,S=s*h-n*l,M=c*y-u*f,T=c*g-p*f,I=c*m-d*f,E=u*g-p*y,A=u*m-d*y,P=p*m-d*g;let C=v*P-b*A+w*E+_*I-x*T+S*M;return C?(C=1/C,e[0]=(a*P-l*A+h*E)*C,e[1]=(l*I-o*P-h*T)*C,e[2]=(o*A-a*I+h*M)*C,e[3]=(s*A-r*P-n*E)*C,e[4]=(i*P-s*I+n*T)*C,e[5]=(r*I-i*A-n*M)*C,e[6]=(y*S-g*x+m*_)*C,e[7]=(g*w-f*S-m*b)*C,e[8]=(f*x-y*w+m*v)*C,e):null}function FQ(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function jQ(e){const t=Am,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],h=e[7],c=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+h*h))<=t&&Math.abs(1-(s*s+a*a+c*c))<=t}Object.freeze({__proto__:null,create:_Q,clone:function(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},fromValues:function(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o},createView:function(e,t){return new Float32Array(e,t,6)},transform:xQ,transformMany:SQ});const NQ=PQ,zQ=FQ;function VQ(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function UQ(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function GQ(){return new Float32Array(2)}function BQ(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function qQ(){return GQ()}function HQ(){return BQ(1,1)}function WQ(){return BQ(1,0)}function $Q(){return BQ(0,1)}Object.freeze({__proto__:null,fromMat4:MQ,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},set:TQ,identity:IQ,transpose:EQ,invert:AQ,adjoint:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],c=t[8];return e[0]=o*c-a*h,e[1]=s*h-r*c,e[2]=r*a-s*o,e[3]=a*l-n*c,e[4]=i*c-s*l,e[5]=s*n-i*a,e[6]=n*h-o*l,e[7]=r*l-i*h,e[8]=i*o-r*n,e},determinant:function(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],h=e[8];return t*(h*n-o*l)+i*(-h*s+o*a)+r*(l*s-n*a)},multiply:PQ,translate:CQ,rotate:OQ,scale:kQ,scaleByVec2:LQ,fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,h=i*o,c=r*o,u=r*a,p=s*o,d=s*a,f=s*l,y=n*o,g=n*a,m=n*l;return e[0]=1-u-f,e[3]=c-m,e[6]=p+g,e[1]=c+m,e[4]=1-h-f,e[7]=d-y,e[2]=p-g,e[5]=d+y,e[8]=1-h-u,e},normalFromMat4Legacy:RQ,normalFromMat4:DQ,projection:function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)},add:function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},subtract:FQ,multiplyScalar:function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},multiplyScalarAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],h=e[7],c=e[8],u=t[0],p=t[1],d=t[2],f=t[3],y=t[4],g=t[5],m=t[6],v=t[7],b=t[8];return Math.abs(i-u)<=Am*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-p)<=Am*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-d)<=Am*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(n-f)<=Am*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-y)<=Am*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-g)<=Am*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-m)<=Am*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(h-v)<=Am*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(c-b)<=Am*Math.max(1,Math.abs(c),Math.abs(b))},isOrthoNormal:jQ,mul:NQ,sub:zQ}),Object.freeze({__proto__:null,create:VQ,clone:UQ,fromValues:function(e,t,i,r,s,n,o,a,l){const h=new Float32Array(9);return h[0]=e,h[1]=t,h[2]=i,h[3]=r,h[4]=s,h[5]=n,h[6]=o,h[7]=a,h[8]=l,h},createView:function(e,t){return new Float32Array(e,t,9)}});const JQ=qQ(),XQ=HQ(),KQ=WQ(),YQ=$Q();function ZQ(e){return function(e){return e instanceof Float32Array&&e.length>=2}(e)||function(e){return Array.isArray(e)&&e.length>=2}(e)}var QQ;Object.freeze({__proto__:null,create:GQ,clone:function(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:BQ,createView:function(e,t){return new Float32Array(e,t,2)},zeros:qQ,ones:HQ,unitX:WQ,unitY:$Q,ZEROS:JQ,ONES:XQ,UNIT_X:KQ,UNIT_Y:YQ});const e0=[0,0];let t0=QQ=class extends Ko{constructor(e){super(e),this._viewpoint2D={center:[0,0],rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new Ol,this.id=0,this.inverseTransform=[1,0,0,1,0,0],this.resolution=0,this.rotation=0,this.scale=0,this.transform=[1,0,0,1,0,0],this.transformNoRotation=[1,0,0,1,0,0],this.displayMat3=VQ(),this.displayViewMat3=VQ(),this.viewMat3=VQ(),this.viewMat2d=_Q(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=MK(i,e.viewpoint),this._set("size",EX(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new QQ({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return ZQ(t)?$X(e,t,this.inverseTransform):(e0[0]=t,e0[1]=i,$X(e,e0,this.inverseTransform))}toScreen(e,t,i){return ZQ(t)?$X(e,t,this.transform):(e0[0]=t,e0[1]=i,$X(e,e0,this.transform))}toScreenNoRotation(e,t,i){return ZQ(t)?$X(e,t,this.transformNoRotation):(e0[0]=t,e0[1]=i,$X(e,e0,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return OK(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new m$({targetGeometry:new il(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=PK(o),this.rotation=r,this.scale=i,this.spatialReference=t,EX(this.center,e);const a=0!==n[0]?2/n[0]:0,l=0!==n[1]?-2/n[1]:0;TQ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const h=IQ(this.viewMat3),c=BQ(n[0]/2,n[1]/2),u=BQ(-n[0]/2,-n[1]/2),p=km(r);CQ(h,h,c),OQ(h,h,p),CQ(h,h,u),PQ(this.displayViewMat3,this.displayMat3,h);const d=fX(this.viewMat2d);return bX(d,d,c),mX(d,d,p),bX(d,d,u),IK(this.extent,o,n),kK(this.transform,o,n,s),yX(this.inverseTransform,this.transform),LK(this.transformNoRotation,o,n,s),this.worldScreenWidth=function(e,t){return Math.round(RK(e)/t)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};Q([ro({readOnly:!0})],t0.prototype,"id",void 0),Q([ro({value:1,json:{write:!0}})],t0.prototype,"pixelRatio",null),Q([ro({json:{write:!0}})],t0.prototype,"size",null),Q([ro({type:m$,json:{write:!0}})],t0.prototype,"viewpoint",null),t0=QQ=Q([Ro("esri.views.2d.ViewState")],t0);var i0=t0;let r0=class extends jo{constructor(){super(...arguments),this.left=0,this.top=0,this.right=0,this.bottom=0}};Q([ro()],r0.prototype,"left",void 0),Q([ro()],r0.prototype,"top",void 0),Q([ro()],r0.prototype,"right",void 0),Q([ro()],r0.prototype,"bottom",void 0),r0=Q([Ro("esri.views.2d.PaddedViewState.Padding")],r0);let s0=class extends i0{constructor(...e){super(...e),this.paddedViewState=new i0,this._updateContent=(()=>{const e=[0,0];return()=>{const t=this._get("size"),i=this._get("padding");if(!t||!i)return;const r=this.paddedViewState;AX(e,i.left+i.right,i.top+i.bottom),CX(e,t,e),EX(r.size,e);const s=r.viewpoint;s&&(this.viewpoint=s)}})(),this.watch(["size","padding"],this._updateContent,!0),this.padding=new r0,this.size=[0,0]}set padding(e){this._set("padding",e||new r0)}set viewpoint(e){if(e){const t=e.clone();this.paddedViewState.viewpoint=e,FK(t,e,this._get("size"),this._get("padding"));const i=this._viewpoint2D,r=t.targetGeometry;i.center[0]=r.x,i.center[1]=r.y,i.rotation=t.rotation,i.scale=t.scale,i.spatialReference=r.spatialReference,this._update()}}};Q([ro()],s0.prototype,"paddedViewState",void 0),Q([ro({type:r0})],s0.prototype,"padding",null),Q([ro()],s0.prototype,"viewpoint",null),s0=Q([Ro("esri.views.2d.PaddedViewState")],s0);var n0=s0;class o0{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class a0{constructor(e){this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new Bq(e.peeker),this.process=e.process;const t=e.scheduler;e.priority&&m(t)&&(this._task=t.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach((t=>e.push(t))),this._controllers.clear(),e.forEach((e=>e.abort())),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach(((t,i)=>e(i)))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._isPaused||(this._isPaused=!0,this._cancelNext())}push(e,t){const i=this.get(e);if(i)return i;const r=et();let s=null;t&&(s=ot(t,(()=>r.abort())));const n=()=>{o.remove(),m(s)&&s.remove(),this._deferreds.delete(e),this._controllers.delete(e),this._queue.remove(e),this._processingItems.delete(e),this._scheduleNext()},o=at(r.signal,(()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),n(),a.reject(Qe())})),a=ut();return this._deferreds.set(e,a),this._controllers.set(e,r),a.promise.then(n,n),this._queue.push(e),this._scheduleNext(),a.promise}last(){return this._queue.last()}peek(){return this._queue.peek()}popLast(){return this._queue.popLast()}reset(){const e=[];this._processingItems.forEach((t=>e.push(t))),this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get running(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_scheduleNext(){this._task||this._isPaused||this._schedule||(this._schedule=Qs((()=>{this._schedule=null,this._next()})))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(v(e))return;let t;const i=et(),r=new o0(e,i);this._processingItems.set(e,r);try{t=this.process(e,i.signal)}catch(s){this._processError(r,s)}mt(t)?(r.promise=t,t.then((e=>this._processResult(r,e)),(e=>this._processError(r,e)))):this._processResult(r,t)}get test(){return{update:e=>this.runTask(e)}}}const l0=new Set,h0=[],c0=new Map,u0=[0,0];let p0=class extends jo{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:t}=this;this._queue=new a0({concurrency:e,process:(e,i)=>{const r=this._keyToItem.get(e);return t(r,{signal:i})},peeker:e=>e.values().next().value})}destroy(){this.clear(),this._queue.destroy(),this._queue=null}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause()}push(e,t){const i=e.key.id+"-"+t;if(this.has(i))return this.get(i);const r=this._queue.push(i),s=()=>{this._keyToItem.delete(i),this.notifyChange("updating")};return this._keyToItem.set(i,e),r.then(s,s),this.notifyChange("updating"),r}reset(){this._queue.reset(),this.notifyChange("updating")}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),s=this.tileInfoView.getTileScale(t.key);c0.has(s)||(c0.set(s,[]),i=Math.max(s,i),r=Math.min(s,r)),c0.get(s).push(t.key),l0.add(s)}));let s=this.state.scale;c0.has(s)||(function(e,t){e.length=0,t.forEach((t=>e.push(t)))}(h0,l0),h0.sort(),s=h0.reduce(((e,t)=>Math.abs(t-s)<Math.abs(e-s)?t:e),h0[0])),s=Math.min(s,i),s=Math.max(s,r);const n=c0.get(s),o=t.getClosestInfoForScale(s),a=o.getColumnForX(this.state.center[0]),l=o.getRowForY(this.state.center[1]);return n.sort(((e,t)=>{const i=o.denormalizeCol(e.col,e.world),r=o.denormalizeCol(t.col,t.world);return Math.sqrt((a-i)*(a-i)+(l-e.row)*(l-e.row))-Math.sqrt((a-r)*(a-r)+(l-t.row)*(l-t.row))})),l0.clear(),c0.clear(),n[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,i=this.state.center;let r=Number.POSITIVE_INFINITY,s=null;return e.forEach((e=>{const n=this._keyToItem.get(e);t.getTileCoords(u0,n.key);const o=jX(u0,i);o<r&&(r=o,s=n.key)})),s.id}};Q([ro({constructOnly:!0})],p0.prototype,"concurrency",void 0),Q([ro({constructOnly:!0})],p0.prototype,"process",void 0),Q([ro()],p0.prototype,"state",void 0),Q([ro({constructOnly:!0})],p0.prototype,"strategy",void 0),Q([ro({constructOnly:!0})],p0.prototype,"tileInfoView",void 0),Q([ro({readOnly:!0})],p0.prototype,"updating",null),p0=Q([Ro("esri.views.2d.tiling.PagedTileQueue")],p0);class d0{constructor(e,t,i,r){this.set(e,t,i,r)}static getId(e,t,i,r){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${i}/${r}`}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}acquire(e,t,i,r){this.set(e,t,i,r)}contains(e){const t=e.level-this.level;return this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new d0(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,i,r){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,i,r,s]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(i),this.col=parseFloat(r),this.world=parseFloat(s)}else this.level=+e,this.row=+t,this.col=+i,this.world=+r||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new d0(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,t=this.row<<1,i=this.col<<1,r=this.world;return[new d0(e,t,i,r),new d0(e,t,i+1,r),new d0(e,t+1,i,r),new d0(e,t+1,i+1,r)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}function f0(e,t){return[e,t]}function y0(e,t,i){return e[0]=t,e[1]=i,e}d0.pool=new Gr(d0,null,null,25,50);const g0=new d0("0/0/0/0");class m0{constructor(e,t,i,r,s,n,o,a,l,h,c,u){this.level=e,this.resolution=t,this.scale=i,this.origin=r,this.first=s,this.last=n,this.size=o,this.norm=a,this.worldStart=l,this.worldEnd=h,this.worldSize=c,this.wrap=u}static create(e,t,i){const r=ya(e.spatialReference),s=f0(e.origin.x,e.origin.y),n=f0(e.size[0]*t.resolution,e.size[1]*t.resolution),o=f0(-1/0,-1/0),a=f0(1/0,1/0),l=f0(1/0,1/0);let h,c,u,p;return i&&(y0(o,Math.max(0,Math.floor((i.xmin-s[0])/n[0])),Math.max(0,Math.floor((s[1]-i.ymax)/n[1]))),y0(a,Math.max(0,Math.floor((i.xmax-s[0])/n[0])),Math.max(0,Math.floor((s[1]-i.ymin)/n[1]))),y0(l,a[0]-o[0]+1,a[1]-o[1]+1)),e.isWrappable?(h=f0(Math.ceil(Math.round((r.valid[1]-r.valid[0])/t.resolution)/e.size[0]),l[1]),c=f0(Math.floor((r.origin[0]-s[0])/n[0]),o[1]),u=f0(h[0]+c[0]-1,a[1]),p=!0):(c=o,u=a,h=l,p=!1),new m0(t.level,t.resolution,t.scale,s,o,a,l,n,c,u,h,p)}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){return this.origin[0]+e*this.norm[0]}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,i=!1){g0.set(t);const r=i?g0.col:this.denormalizeCol(g0.col,g0.world),s=g0.row;return function(e,t,i,r,s){e[0]=t,e[1]=i,e[2]=r,e[3]=s}(e,this.getXForColumn(r),this.getYForRow(s+1),this.getXForColumn(r+1),this.getYForRow(s)),e}getTileCoords(e,t,i=!1){g0.set(t);const r=i?g0.col:this.denormalizeCol(g0.col,g0.world);return Array.isArray(e)?y0(e,this.getXForColumn(r),this.getYForRow(g0.row)):(e.x=this.getXForColumn(r),e.y=this.getYForRow(g0.row)),e}}class v0{constructor(){this.spans=[]}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}forEach(e,t){const{spans:i,lodInfo:r}=this,{level:s}=r;if(0!==i.length)for(const{row:n,colFrom:o,colTo:a}of i)for(let i=o;i<=a;i++)e.call(t,s,n,r.normalizeCol(i),r.getWorldForColumn(i))}}v0.pool=new Gr(v0);class b0{constructor(e,t,i){this.row=e,this.colFrom=t,this.colTo=i}}const w0=new d0("0/0/0/0");class _0{constructor(e,t,i,r,s,n,o,a){this.x=e,this.ymin=t,this.ymax=i,this.invM=r,this.leftAdjust=s,this.rightAdjust=n,this.leftBound=o,this.rightBound=a}static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[i,r]=e,[s,n]=t,o=s-i,a=n-r,l=0!==a?o/a:0,h=(Math.ceil(r)-r)*l,c=(Math.floor(r)-r)*l;return new _0(i,Math.floor(r),Math.ceil(n),l,o<0?h:c,o<0?c:h,o<0?s:i,o<0?i:s)}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const x0=[[0,0],[0,0],[0,0],[0,0]];class S0{constructor(e,t){this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};const i=e.lods.slice();i.sort((function(e,t){return t.scale-e.scale}));const r=this._lodInfos=i.map((i=>m0.create(e,i,t)));i.forEach(((e,t)=>{this._infoByLevel[e.level]=r[t],this._infoByScale[e.scale]=r[t],this.scales[t]=e.scale}),this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,i=!1){w0.set(t);const r=this._infoByLevel[w0.level];return r?r.getTileBounds(e,w0,i):e}getTileCoords(e,t,i=!1){w0.set(t);const r=this._infoByLevel[w0.level];return r?r.getTileCoords(e,w0,i):e}getTileCoverage(e,t=192,i="closest"){const r="closest"===i?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),s=v0.pool.acquire(r),n=this._wrap;let o,a,l,h=1/0,c=-1/0;const u=s.spans;x0[0][0]=x0[0][1]=x0[1][1]=x0[3][0]=-t,x0[1][0]=x0[2][0]=e.size[0]+t,x0[2][1]=x0[3][1]=e.size[1]+t;for(const y of x0)e.toMap(y,y),y[0]=r.getColumnForX(y[0]),y[1]=r.getRowForY(y[1]);const p=[];let d=3;for(let y=0;y<4;y++){if(x0[y][1]===x0[d][1]){d=y;continue}const e=_0.create(x0[y],x0[d]);h=Math.min(e.ymin,h),c=Math.max(e.ymax,c),void 0===p[e.ymin]&&(p[e.ymin]=[]),p[e.ymin].push(e),d=y}if(null==h||null==c||c-h>100)return null;let f=[];for(o=h;o<c;){null!=p[o]&&(f=f.concat(p[o])),a=1/0,l=-1/0;for(let e=f.length-1;e>=0;e--){const t=f[e];a=Math.min(a,t.getLeftCol()),l=Math.max(l,t.getRightCol())}if(a=Math.floor(a),l=Math.floor(l),o>=r.first[1]&&o<=r.last[1])if(n)if(r.size[0]<r.worldSize[0]){const e=Math.floor(l/r.worldSize[0]);for(let t=Math.floor(a/r.worldSize[0]);t<=e;t++)u.push(new b0(o,Math.max(r.getFirstColumnForWorld(t),a),Math.min(r.getLastColumnForWorld(t),l)))}else u.push(new b0(o,a,l));else a>r.last[0]||l<r.first[0]||(a=Math.max(a,r.first[0]),l=Math.min(l,r.last[0]),u.push(new b0(o,a,l)));o+=1;for(let e=f.length-1;e>=0;e--){const t=f[e];t.ymax>=o?t.incrRow():f.splice(e,1)}}return s}getTileParentId(e){w0.set(e);const t=this._infoByLevel[w0.level],i=this._lodInfos.indexOf(t)-1;return i<0?null:(this._getTileIdAtLOD(w0,this._lodInfos[i],w0),w0.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){w0.set(t);const i=this._infoByLevel[w0.level],r=e.lodInfo;if(r.resolution>i.resolution){this._getTileIdAtLOD(w0,r,w0);const t=r.denormalizeCol(w0.col,w0.world);for(const i of e.spans)if(i.row===w0.row&&i.colFrom<=t&&i.colTo>=t)return!0}if(r.resolution<i.resolution){const[t,s,n,o]=e.spans.reduce(((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e)),[1/0,-1/0,1/0,-1/0]),a=i.denormalizeCol(w0.col,w0.world),l=r.getColumnForX(i.getXForColumn(a)),h=r.getRowForY(i.getYForRow(w0.row)),c=r.getColumnForX(i.getXForColumn(a+1))-1,u=r.getRowForY(i.getYForRow(w0.row+1))-1;return!(l>o||c<n||h>s||u<t)}const s=r.denormalizeCol(w0.col,w0.world);return e.spans.some((e=>e.row===w0.row&&e.colFrom<=s&&e.colTo>=s))}normalizeBounds(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){const t=ya(this.tileInfo.spatialReference),r=-i*(t.valid[1]-t.valid[0]);e[0]+=r,e[2]+=r}return e}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let i=1;i<t.length-1;i++)if(e>t[i]+1e-6)return this._infoByScale[t[i-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce(((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t),t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let i=t.length-1;i>=0;i--)if(e<t[i])return i===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[i]].level+(t[i]-e)/(t[i]-t[i+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}_getTileIdAtLOD(e,t,i){const r=this._infoByLevel[i.level];return e.set(i),t.resolution<r.resolution?null:(t.resolution===r.resolution||(e.level=t.level,e.col=Math.floor(i.col*r.resolution/t.resolution+.01),e.row=Math.floor(i.row*r.resolution/t.resolution+.01)),e)}}const M0=new Set,T0=[],I0=new Map,E0=[0,0];let A0=class extends jo{constructor(e){super(e),this._keyToItem=new Map,this.concurrency=6,this.strategy="scale-first",this.tileInfoView=null}initialize(){const{concurrency:e,process:t,strategy:i}=this;this._queue=new a0({concurrency:e,process:(e,i)=>{const r=this._keyToItem.get(e);return t(r,{signal:i})},peeker:"scale-first"===i?e=>this._peekByScaleFirst(e):e=>this._peekByCenterFirst(e)})}destroy(){this.clear(),this._queue.destroy(),this._queue=null}get length(){return this._queue?this._queue.length:0}get onGoingCount(){return this._keyToItem.size}get updating(){return this.length>0||this.onGoingCount>0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}has(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}isOngoing(e){const t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const i=this._queue.push(t),r=()=>{this._keyToItem.delete(t),this.notifyChange("updating")};return this._keyToItem.set(t,e),i.then(r,r),this.notifyChange("updating"),i}reset(){this._queue.reset()}resume(){this._queue.resume()}_peekByScaleFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView;let i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((e=>{const t=this._keyToItem.get(e),s=this.tileInfoView.getTileScale(t.key);I0.has(s)||(I0.set(s,[]),i=Math.max(s,i),r=Math.min(s,r)),I0.get(s).push(t.key),M0.add(s)}));let s=this.state.scale;I0.has(s)||(function(e,t){e.length=0,t.forEach((t=>e.push(t)))}(T0,M0),T0.sort(),s=T0.reduce(((e,t)=>Math.abs(t-s)<Math.abs(e-s)?t:e),T0[0])),s=Math.min(s,i),s=Math.max(s,r);const n=I0.get(s),o=t.getClosestInfoForScale(s),a=o.getColumnForX(this.state.center[0]),l=o.getRowForY(this.state.center[1]);return n.sort(((e,t)=>{const i=o.denormalizeCol(e.col,e.world),r=o.denormalizeCol(t.col,t.world);return Math.sqrt((a-i)*(a-i)+(l-e.row)*(l-e.row))-Math.sqrt((a-r)*(a-r)+(l-t.row)*(l-t.row))})),M0.clear(),I0.clear(),n[0].id}_peekByCenterFirst(e){if(!this.state)return e.values().next().value;const t=this.tileInfoView,i=this.state.center;let r=Number.POSITIVE_INFINITY,s=null;return e.forEach((e=>{const n=this._keyToItem.get(e);t.getTileCoords(E0,n.key);const o=jX(E0,i);o<r&&(r=o,s=n.key)})),s.id}};Q([ro({constructOnly:!0})],A0.prototype,"concurrency",void 0),Q([ro({constructOnly:!0})],A0.prototype,"process",void 0),Q([ro()],A0.prototype,"state",void 0),Q([ro({constructOnly:!0})],A0.prototype,"strategy",void 0),Q([ro({constructOnly:!0})],A0.prototype,"tileInfoView",void 0),Q([ro({readOnly:!0})],A0.prototype,"updating",null),A0=Q([Ro("esri.views.2d.tiling.TileQueue")],A0);var P0=A0;class C0{constructor(e,t,i){this.maxSize=e,this.tileInfoView=t,this.removedFunc=i,this._tilePerId=new Map,this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const t=this._tilePerId.get(e);if(!t)return null;const i=t.key.level,r=this._tileKeysPerLevel[i];O0(this._tilePerId,e);for(let s=0;s<r.length;s++)if(r[s].id===e){r.splice(s,1);break}return t.visible=!0,t}add(e){e.visible=!1;const t=e.key,i=t.id;if(this._tilePerId.has(i))return;this._tilePerId.set(i,e);const r=t.level;this._tileKeysPerLevel[r]||(this._tileKeysPerLevel[r]=[]),this._tileKeysPerLevel[r].push(t)}prune(e,t,i){let r=this._tilePerId.size;if(r<=this.maxSize)return;let s=this._tileKeysPerLevel.length-1;for(;r>this.maxSize&&s>=0;)s!==e&&(r=this._pruneAroundCenterTile(r,t,i,s)),s--;r>this.maxSize&&(r=this._pruneAroundCenterTile(r,t,i,e))}_pruneAroundCenterTile(e,t,i,r){const s=this._tileKeysPerLevel[r];if(!s||0===s.length)return e;const{size:n,origin:o}=this.tileInfoView.tileInfo,a=i*n[0],l=i*n[1],h=[0,0],c=[0,0];for(s.sort(((e,i)=>(h[0]=o.x+a*(e.col+.5),h[1]=o.y-l*(e.row+.5),c[0]=o.x+a*(i.col+.5),c[1]=o.y-l*(i.row+.5),NX(h,t)-NX(c,t))));s.length>0;){const t=s.pop();if(this._removeTile(t.id),--e===this.maxSize)break}return e}_removeTile(e){const t=this._tilePerId.get(e);this.removedFunc&&this.removedFunc(t),O0(this._tilePerId,e)}}function O0(e,t){e.delete(t)}const k0=new d0(0,0,0,0),L0=new Map,R0=[],D0=[];class F0{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this.resampling=null==e.resampling||!!e.resampling,e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new C0(e.cacheSize,this.tileInfoView,(e=>{this.releaseTile(e)})))}destroy(){this.tileIndex.clear()}update(e){const{resampling:t,tileIndex:i}=this,r=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(D0.length=0,R0.length=0,L0.clear(),!r)return;const{minScale:s,maxScale:n}=this.tileInfoView.tileInfo,{spans:o,lodInfo:a}=r,{level:l}=a,{scale:h,center:c,resolution:u}=e.state,p=!e.stationary&&h>this._previousScale;if(this._previousScale=h,this.tiles.length=0,!t&&(h>s||h<n))return this.tiles.length=0,L0.clear(),i.forEach((e=>{this.releaseTile(e)})),i.clear(),D0.length=0,R0.length=0,L0.clear(),v0.pool.release(r),!0;i.forEach((e=>e.visible=!0));let d=0,f=0;if(o.length>0)for(const{row:g,colFrom:m,colTo:v}of o)for(let e=m;e<=v;e++){d++;const t=k0.set(l,g,a.normalizeCol(e),a.getWorldForColumn(e)).id;if(i.has(t)){const e=i.get(t);e.isReady?(L0.set(t,e),f++):p||this._addParentTile(t,L0)}else{let e;if(this._tileCache&&this._tileCache.has(t)){if(e=this._tileCache.pop(t),this.tileIndex.set(t,e),e.isReady){L0.set(t,e),f++;continue}}else e=this.acquireTile(k0),this.tileIndex.set(t,e);p||this._addParentTile(t,L0)}}const y=f===d;i.forEach(((e,t)=>{if(k0.set(t),L0.has(t))return;const i=this.tileInfoView.intersects(r,k0),s="purge"===this.cachePolicy?k0.level!==l:k0.level>l;!i||!p&&y?!s&&i||R0.push(t):e.isReady?D0.push(t):s&&R0.push(t)}));for(const g of D0){const e=i.get(g);e&&e.isReady&&L0.set(g,e)}for(const g of R0){const e=i.get(g);this._tileCache?this._tileCache.add(e):this.releaseTile(e),i.delete(g)}return L0.forEach((e=>this.tiles.push(e))),i.forEach((e=>{L0.has(e.key.id)||(e.visible=!1)})),this._tileCache&&this._tileCache.prune(l,c,u),v0.pool.release(r),L0.clear(),y}clear(e=!0){const{tileIndex:t}=this;e&&t.forEach((e=>{this.releaseTile(e)})),t.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,t){let i=e,r=null;for(;i=this.tileInfoView.getTileParentId(i),i;)if(this.tileIndex.has(i)){if(r=this.tileIndex.get(i),r&&r.isReady){t.has(r.key.id)||t.set(r.key.id,r);break}}else if(this._tileCache&&this._tileCache.has(i)&&(r=this._tileCache.pop(i),this.tileIndex.set(i,r),r&&r.isReady)){t.has(r.key.id)||t.set(r.key.id,r);break}}}class j0{constructor(){this._names=new Map}begin(e){this._names.has(e)||(this._names.set(e,!1),-1!==e.indexOf("Brush")&&this.record("Esri.FirstDraw"),performance.mark(`Esri.${e}.Start`))}end(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark(`Esri.${e}.End`))}record(e){this._names.has(e)||(this._names.set(e,!0),performance.mark(`Esri.${e}`))}}const N0=Ne.getLogger("esri.views.MapView");let z0=class extends(X$(lX)){constructor(e){super(e),this._stationaryTimer=null,this.frameTask=new KK(this),this.featuresTilingScheme=null,this.fullOpacity=1,this.graphicsView=null,this.initialExtent=null,this.labelManager=null,this.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},this.resizeAlign="center",this.supportsGround=!1,this.timeline=new j0,this.type="2d",this.constraints=new wQ,this.padding={top:0,right:0,bottom:0,left:0};const t=this.handles,i=()=>this.notifyChange("updating");t.add([this.watch("viewpoint",(()=>{this._lastStationaryEventTimestamp=performance.now(),this._flipStationary(160)}),!0),this.on("resize",(e=>this._resizeHandler(e))),this.watch("animationManager.animation",(e=>{this.animation=e})),this.allLayerViews.on("change",(()=>{i(),t.remove("map-view-base-layerViewsUpdating"),t.add(this.allLayerViews.map((e=>e.watch("updating",i))),"map-view-base-layerViewsUpdating")}))],"map-view-base")}destroy(){this.destroyed||(this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null)}set animation(e){const t=this._get("animation");if(e===t)return;if(t&&t.stop(),!e||e.isFulfilled())return void this._set("animation",null);this._set("animation",e),this.frameTask.animationInProgress=!0;const i=()=>{e===this._get("animation")&&(this._set("animation",null),this.frameTask.requestFrame()),this.frameTask.animationInProgress=!1};e.when(i,i)}get center(){if(!this.ready)return this._get("center");const{center:e,spatialReference:t}=this.state.paddedViewState;return new il({x:e[0],y:e[1],spatialReference:t})}set center(e){if(null==e)return;if(!this._normalizeInput(e))return void N0.error("#center",`incompatible spatialReference ${JSON.stringify(e.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");const t=this.viewpoint;jK(t,t,e),this.viewpoint=t}set constraints(e){const t=this._get("constraints");t&&(this.handles.remove("map-view-base-constraints"),t.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add(e.on("update",(()=>{this.ready&&this.state&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint))})),"map-view-base-constraints"))}get extent(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")}set extent(e){if(null==e)return;const t=this._normalizeInput(e);if(!t)return void N0.error("#center",`incompatible spatialReference ${JSON.stringify(e.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`);if(!t.width||!t.height)return void N0.error("#extent","invalid extent size");if(!this.ready)return this._set("extent",t),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");const i=this.viewpoint;(function(e,t,i,r,s){jK(e,t,i.center),e.scale=_K(i,r),s&&s.constraints&&s.constraints.constrain(e)})(i,i,t,this.size,{constraints:this.constraints}),this.viewpoint=i}get initialExtentRequired(){const{extent:e,center:t,scale:i,viewpoint:r,zoom:s}=this;return!(this.get("map.initialViewProperties.viewpoint")||e||t&&(0!==i||-1!==s)||r)}get padding(){return this.ready?this.state.padding:this._get("padding")}set padding(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}get resolution(){return this.state?this.state.resolution:0}get rotation(){return this.ready?this.state.rotation:this._get("rotation")}set rotation(e){if(isNaN(e))return;if(!this.ready)return void this._set("rotation",e);const t=this.viewpoint;(function(e,t,i){MK(e,t),e.rotation=i})(t,t,e),this.viewpoint=t}get scale(){return this.ready?this.state.scale:this._get("scale")}set scale(e){if(!e||isNaN(e))return;if(!this.ready){this._set("scale",e),this._set("zoom",-1);const t=this._get("extent");return t&&(this._set("extent",null),this._set("center",t.center)),void this.notifyChange("initialExtentRequired")}const t=this.viewpoint;UK(t,t,e),this.viewpoint=t}get stationary(){return!(this.animation||this.navigating||this._get("resizing")||this._stationaryTimer)}get updating(){return!this.destroyed&&(!0===this.get("layerViewManager.updating")||!0===this.get("labelManager.updating")||!0===this.get("graphicsView.updating")||this.allLayerViews.some((e=>!e.destroyed&&!("layerViews"in e)&&!0===e.updating)))}get viewpoint(){if(!this.ready)return this._get("viewpoint");const e=this.state.paddedViewState;return e&&e.viewpoint.clone()}set viewpoint(e){if(null==e)return;const t=this._normalizeInput(e);if(!t)return void(!e.scale||isNaN(e.scale)?N0.error("#viewpoint",`invalid scale value of ${e.scale}`):v(e.targetGeometry)?N0.error("#viewpoint","geometry not defined"):N0.error("#viewpoint",`incompatible spatialReference ${JSON.stringify(e.targetGeometry.spatialReference)} with view's spatialReference ${JSON.stringify(this.spatialReference)}`));if(!this.ready)return this._set("viewpoint",t),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");const i=new m$({targetGeometry:new il,scale:0,rotation:0});MK(i,t),this.constraints.constrain(i,this.state.paddedViewState.viewpoint),this.state.viewpoint=i,this.frameTask.requestFrame(),this._set("viewpoint",i)}get zoom(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")}set zoom(e){if(null==e)return;if(!this.ready){this.notifyChange("initialExtentRequired"),this._set("zoom",e),this._set("scale",0);const t=this._get("extent");t&&(this._set("extent",null),this._set("center",t.center))}if(!this.constraints.effectiveLODs)return;const t=this.viewpoint;UK(t,t,this.constraints.zoomToScale(e)),this.viewpoint=t,this._set("zoom",this.constraints.scaleToZoom(this.scale))}goTo(e,t){if(e)return this.animation&&(this.animation=null),this._createAnimation(),Uh(this,"ready",t&&t.signal).then((()=>{const i=a({animate:!0},t),r=function(e,t){return SK(e,t)}(e,this);return this.animation.update(r),this._gotoTask={},i.animate?this._gotoAnimated(r,i):this._gotoImmediate(r,i)}));N0.error("#goTo()","target cannot be null or undefined")}hitTest(e){return Promise.reject("Should be implemented by subclasses")}popupHitTest(e){return this.hitTest(e).then((t=>l(a({},t),{mapPoint:this.toMap(e)})))}toMap(e){if(!this.ready)return null;const[t,i]=this.state.toMap([0,0],[e.x,e.y]),r=this.spatialReference;return new il({x:t,y:i,spatialReference:r})}isTileInfoRequired(){return!0}toScreen(e){if(!this.ready)return null;const t=this._normalizeInput(e),i=[t.x,t.y];return this.state.toScreen(i,i),FS(i[0],i[1])}pixelSizeAt(){return this.ready?this.state.resolution:(N0.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}requestUpdate(){this.ready&&this.frameTask.requestUpdate()}getDefaultSpatialReference(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||null}isSpatialReferenceSupported(e,t){return!(!t&&!this._get("ready"))||null!==this._getDefaultViewpoint()}importLayerView(e){return iY(e)}hasLayerViewModule(e){return tY(e)}_createAnimation(){return this.animation&&!this.animation.done||(this.animation=new cX),this.animation}_cancellableGoTo(e,t,i){const r=()=>e===this._gotoTask,s=i.then((()=>{r()&&(this.animation=null)})).catch((e=>{throw r()&&(this.animation=null,t.done||(t.stop(),this.frameTask.animationInProgress=!1)),e})),n=new Promise((e=>e(s)));return t.when().catch((()=>{r()&&n.cancel&&n.cancel()})),n}_gotoImmediate(e,t){const i=this._gotoTask,r=this.animation,s=e.then((e=>{if(tt(t),i!==this._gotoTask)throw new Be("view:goto-interrupted","Goto was interrupted");this.viewpoint=r.target=e,r.finish()}));return this._cancellableGoTo(i,r,s)}_gotoAnimated(e,t){const i=this._gotoTask,r=this.animation,s=e.then((e=>{if(tt(t),i!==this._gotoTask)throw new Be("view:goto-interrupted","Goto was interrupted");return r.update(e),this.animationManager.animate(r,this.viewpoint,t),r.when().then((()=>{}),(()=>{}))}));return this._cancellableGoTo(i,r,s)}_resizeHandler(e){const t=this.state;if(!t)return;let i=this.state.paddedViewState.viewpoint;const r=this.state.paddedViewState.size.concat();t.size=[e.width,e.height],NK(i,i,r,this.state.paddedViewState.size,this.resizeAlign),i=this.constraints.constrain(i,null),this.state.viewpoint=i}_startup(){const e=this._getDefaultViewpoint();this.constraints.view=this,this.constraints.fit(e),this._set("animationManager",new XK({view:this})),this._set("state",new n0({padding:this._get("padding"),size:this.size,viewpoint:e})),this._set("featuresTilingScheme",new S0(J$.create({spatialReference:this.spatialReference,size:512,numLODs:36}))),this._set("ready",!0),this.frameTask&&this.frameTask.start()}_teardown(){this.frameTask&&this.frameTask.stop(),this._set("ready",!1),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null);const{center:[e,t],spatialReference:i,rotation:r,scale:s}=this.state.paddedViewState,n=new il({x:e,y:t,spatialReference:i});this._set("viewpoint",null),this._set("extent",null),this._set("center",n),this._set("zoom",-1),this._set("rotation",r),this._set("scale",s),this._set("spatialReference",i),this.constraints.view=null,this.animationManager.destroy(),this._set("animationManager",null),this._set("state",null),this.animation=null}_flipStationary(e){return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((()=>{this._stationaryTimer=null;const e=performance.now()-this._lastStationaryEventTimestamp;e<160&&(this._stationaryTimer=this._flipStationary(e))}),e)),this._stationaryTimer}_normalizeInput(e,t=this.spatialReference){const i=e&&e.targetGeometry||e;return t?i?t.equals(i.spatialReference)?e:Ha(i,t)?function(e){return e&&"esri.Viewpoint"===e.declaredClass}(e)?(e.targetGeometry=Wa(i,t),e):Wa(i,t):null:null:e}_getDefaultViewpoint(){const e=this.constraints,t={zoom:this._get("zoom"),scale:this._get("scale"),center:this._normalizeInput(this._get("center")),extent:this._normalizeInput(this._get("extent")),rotation:this._get("rotation"),viewpoint:this._normalizeInput(this._get("viewpoint")),spatialReference:this._userSpatialReference};e.effectiveLODs?-1!==t.zoom&&(t.scale=e.zoomToScale(t.zoom)):t.zoom=-1;let i=null,r=null,s=0;const n=t.viewpoint&&t.viewpoint.rotation,o=t.viewpoint&&t.viewpoint.targetGeometry;m(o)&&("extent"===o.type?i=o:"point"===o.type&&(r=o,s=t.viewpoint.scale));const a=this._normalizeInput(this.get("map.initialViewProperties.viewpoint.targetGeometry.extent")),l=this._normalizeInput(this.initialExtent),h=t.extent||i||a||l,c=t.center||r||h&&h.center,u=this.get("map.initialViewProperties.viewpoint.scale"),p=t.scale||s||u||h&&_K(h,this.size),d=this.get("map.initialViewProperties.viewpoint.rotation"),f=t.rotation||n||d||0;return c&&p?new m$({targetGeometry:c,scale:p,rotation:f}):null}};Q([ro()],z0.prototype,"_stationaryTimer",void 0),Q([ro()],z0.prototype,"animation",null),Q([ro({readOnly:!0})],z0.prototype,"animationManager",void 0),Q([ro({value:null,type:il,dependsOn:["state.id","ready"]})],z0.prototype,"center",null),Q([ro({type:wQ})],z0.prototype,"constraints",null),Q([ro({value:null,type:Ol,dependsOn:["state.id","ready"]})],z0.prototype,"extent",null),Q([ro({readOnly:!0})],z0.prototype,"featuresTilingScheme",void 0),Q([ro()],z0.prototype,"fullOpacity",void 0),Q([ro()],z0.prototype,"graphicsView",void 0),Q([ro({type:Ol})],z0.prototype,"initialExtent",void 0),Q([ro({dependsOn:["map.initialViewProperties?.viewpoint"]})],z0.prototype,"initialExtentRequired",null),Q([ro()],z0.prototype,"labelManager",void 0),Q([ro({value:{top:0,right:0,bottom:0,left:0},cast:e=>a({top:0,right:0,bottom:0,left:0},e)})],z0.prototype,"padding",null),Q([ro({type:Object})],z0.prototype,"renderingOptions",void 0),Q([ro()],z0.prototype,"resizeAlign",void 0),Q([ro({readOnly:!0,dependsOn:["state.id"]})],z0.prototype,"resolution",null),Q([ro({value:0,type:Number,dependsOn:["state.id","ready"]})],z0.prototype,"rotation",null),Q([ro({value:0,type:Number,dependsOn:["state.id","ready"]})],z0.prototype,"scale",null),Q([ro({type:Aa,dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],z0.prototype,"spatialReference",void 0),Q([ro({readOnly:!0})],z0.prototype,"state",void 0),Q([ro({dependsOn:["animation","navigating","resizing","_stationaryTimer"]})],z0.prototype,"stationary",null),Q([ro({readOnly:!0})],z0.prototype,"supportsGround",void 0),Q([ro({type:j0,readOnly:!0})],z0.prototype,"timeline",void 0),Q([ro({readOnly:!0})],z0.prototype,"type",void 0),Q([ro({readOnly:!0,dependsOn:["layerViewManager.updating","labelManager.updating","graphicsView?.updating"]})],z0.prototype,"updating",null),Q([ro({value:null,type:m$,dependsOn:["state.id","ready"]})],z0.prototype,"viewpoint",null),Q([ro({value:-1,dependsOn:["state.id"]})],z0.prototype,"zoom",null),z0=Q([Ro("esri.views.MapViewBase")],z0);var V0=z0;function U0(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}class G0 extends Xq{constructor(e,t){super(!0),this.view=e,this.registerIncoming("double-click",t,(e=>this._handleDoubleClick(e,t)))}_handleDoubleClick(e,t){U0(e.data,"primary")&&(e.stopPropagation(),t?this.view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this.view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}}class B0 extends Xq{constructor(e,t,i){super(!0),this.view=e,this.pointerType=t,this.registerIncoming("double-tap-drag",i,(e=>this._handleDoubleTapDrag(e)))}_handleDoubleTapDrag(e){const{data:t}=e,{pointerType:i}=t;if(i!==this.pointerType)return;e.stopPropagation();const{action:r,delta:s}=t,{view:n}=this,{mapViewNavigation:o}=n;switch(r){case"begin":{const{scale:e}=n;this._startScale=e,this._currentScale=e,this._previousDelta=s,o.begin();break}case"update":{if(this._previousDelta.y===s.y)return;this._previousDelta=s;const e=1.015**s.y,t=this._startScale*e,i=t/this._currentScale;o.setViewpointImmediate(i),this._currentScale=t;break}case"end":{const{constraints:e}=n,{effectiveLODs:t,snapToZoom:i}=e;if(!i||!t)return void o.end();const r=e.snapScale(this._currentScale),a=(s.y>0?Math.max(r,e.snapToPreviousScale(this._startScale)):Math.min(r,e.snapToNextScale(this._startScale)))/this._currentScale;o.zoom(a);break}}}}class q0{constructor(e){this.callbacks=e,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(e){const t=e.data,i=t.pointers.size;switch(t.action){case"start":this.currentCount=i,this.emitStart(e);break;case"added":this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(e);break;case"update":this.emitUpdate(e);break;case"removed":this.startEvent&&this.emitEnd(this.previousEvent),this.currentCount=i,this.emitStart(e);break;case"end":this.emitEnd(e),this.currentCount=0}this.previousEvent=e}emitStart(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)}emitUpdate(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)}emitEnd(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null}}class H0 extends Xq{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t,this.registerIncoming("drag",i,(e=>this._handleDrag(e))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const r=this.view.mapViewNavigation;this.dragEventSeparator=new q0({start:(e,t)=>{r.pan.begin(this.view,t.data),t.stopPropagation()},update:(e,t)=>{r.pan.update(this.view,t.data),t.stopPropagation()},end:(e,t)=>{r.pan.end(this.view,t.data),t.stopPropagation()},condition:(e,t)=>1===e&&U0(t.data,this.pointerAction)})}_handleDrag(e){const t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}class W0 extends Xq{constructor(e,t,i){super(!0),this.view=e,this.pointerAction=t;const r=this.view.mapViewNavigation;this.dragEventSeparator=new q0({start:(e,t)=>{r.rotate.begin(this.view,t.data),t.stopPropagation()},update:(e,t)=>{r.rotate.update(this.view,t.data),t.stopPropagation()},end:(e,t)=>{r.rotate.end(),t.stopPropagation()},condition:(e,t)=>1===e&&U0(t.data,this.pointerAction)}),this.registerIncoming("drag",i,(e=>this.dragEventSeparator.handle(e)))}}function $0(e){let t=e*e;return e<0&&(t*=-1),t}class J0 extends Xq{constructor(e){super(!0),this.view=e,this.frameTask=null,this.watchHandles=new Mh,this.currentDevice=null,this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.handle=this.registerIncoming("gamepad",(e=>this.handleEvent(e))),this.handle.pause()}onInstall(e){super.onInstall(e),this.watchHandles.add([Rh(this.view.navigation.gamepad,"enabled",(e=>{e?(this.handle.resume(),this.frameTask||(this.frameTask=en({update:e=>this.frameUpdate(e.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null))}))])}onUninstall(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),super.onUninstall()}handleEvent(e){const t=this.view.navigation.gamepad.device;t&&e.data.device!==t||this.currentDevice&&this.currentDevice!==e.data.device||("end"===e.data.action?(this.currentDevice=null,function(e){e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0}(this.transformation)):(this.currentDevice=e.data.device,function(e,t,i){const r=i,s=e.state,n=e.device,o="forward-down"===t.tiltDirection?1:-1;"standard"===n.deviceType?(r.translation[0]=$0(s.axes[0]),r.translation[1]=$0(s.axes[1]),r.translation[2]=$0(s.buttons[7])-$0(s.buttons[6]),r.heading=$0(s.axes[2]),r.tilt=$0(s.axes[3])):"spacemouse"===n.deviceType&&(r.translation[0]=1.2*$0(s.axes[0]),r.translation[1]=1.2*$0(s.axes[1]),r.translation[2]=2*-$0(s.axes[2]),r.heading=1.2*$0(s.axes[5]),r.tilt=1.2*$0(s.axes[3])),r.tilt*=o,Um(r.translation,r.translation,1)}(e.data,this.view.navigation.gamepad,this.transformation)))}frameUpdate(e){const t=this.transformation;if(function(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}(t))return;const i=this.view.viewpoint.clone(),r=this.view.navigation.gamepad.velocityFactor,s=K0*r*e;WK(i,i,[t.translation[0]*s,-t.translation[1]*s]);const n=1+t.translation[2]*Y0*e,o=this.view.constraints.rotationEnabled?-t.heading*X0*e:0,a=this.view.size,l=[a[0]/2,a[1]];GK(i,i,n,o,l,a);const h=this.view.constraints.constrain(i,this.view.viewpoint);this.view.viewpoint=h}}const X0=.06,K0=.7,Y0=6e-4;class Z0 extends Xq{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._pressed=!1,this._keyMap={[t.left]:"left",[t.right]:"right",[t.up]:"up",[t.down]:"down"},this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",i,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",i,(()=>this._handleBlur()))}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,t){const i=this._keyMap[e.data.key];if(this._pressed=null!=i,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),i){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}class Q0 extends Xq{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._pressed=!1,this._keyToDirection={[t.clockwiseOption1]:"clockwise",[t.clockwiseOption2]:"clockwise",[t.counterClockwiseOption1]:"counterClockwise",[t.counterClockwiseOption2]:"counterClockwise",[t.resetOption1]:"reset",[t.resetOption2]:"reset"},this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),this.registerIncoming("key-up",i,(e=>this._handleKeyUp(e))),this.registerIncoming("blur",i,(()=>this._handleBlur()))}_handleKeyDown(e){e.data.repeat||this._handleKey(e,!0)}_handleKeyUp(e){this._handleKey(e,!1)}_handleBlur(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}_handleKey(e,t){const i=e.modifiers;if(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)return;const r=this._keyToDirection[e.data.key];if(this._pressed=null!=r,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),r){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}class e1 extends Xq{constructor(e,t,i){super(!0),this.view=e,this.keys=t,this._keysToZoomAction={},this.registerIncoming("key-down",i,(e=>this._handleKeyDown(e))),t.zoomIn.forEach((e=>this._keysToZoomAction[e]=0)),t.zoomOut.forEach((e=>this._keysToZoomAction[e]=1))}_handleKeyDown(e){this._handleKey(e)}_handleKey(e){const t=e.modifiers;if(t.size>0&&!t.has("Shift"))return;const{key:i}=e.data;if(!(i in this._keysToZoomAction))return;const r=this._keysToZoomAction[i],{mapViewNavigation:s}=this.view;let n=null;switch(r){case 0:n=s.zoomIn();break;case 1:n=s.zoomOut();break;default:return}s.begin(),n.then((()=>s.end())),e.stopPropagation()}}class t1 extends Xq{constructor(e,t){super(!0),this.view=e,this._canZoom=!0,this.registerIncoming("mouse-wheel",t,(e=>this._handleMouseWheel(e)))}_handleMouseWheel(e){if(!this.view.navigation.mouseWheelZoomEnabled)return;if(e.preventDefault(),e.stopPropagation(),!this._canZoom)return;const t=this.view.mapViewNavigation,{x:i,y:r,deltaY:s}=e.data,n=1/.6**(1/60*s),o=t.zoom(n,[i,r]);o&&(this._canZoom=!1,o.catch((()=>{})).then((()=>{this._canZoom=!0,t.end()})))}}class i1 extends Xq{constructor(e){super(!0),this.view=e,this.registerIncoming("drag",(e=>this._handleDrag(e))),this.registerIncoming("pointer-down",(()=>this.stopMomentumNavigation()));const t=this.view.mapViewNavigation;this.dragEventSeparator=new q0({start:(e,i)=>{t.pinch.begin(this.view,i.data),i.stopPropagation()},update:(e,i)=>{t.pinch.update(this.view,i.data),i.stopPropagation()},end:(e,i)=>{t.pinch.end(this.view),i.stopPropagation()},condition:e=>e>=2})}_handleDrag(e){this.dragEventSeparator.handle(e)}stopMomentumNavigation(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}function r1(e){const t=e.native;return t?{buttons:t.buttons.map((e=>e.pressed?e.value?e.value:1:0)),axes:t.axes.map((t=>function(e,t){const i=Math.abs(e);return i<t?0:wv(e)*(i-t)/(1-t)}(t,e.axisThreshold)))}:{buttons:[],axes:[]}}class s1{constructor(e,t){this.element=e,this.input=t,this._hasEventListeners=!1,this.onConnectGamepad=e=>{this.connectGamepad(e.gamepad)},this.onDisconnectGamepad=e=>{const t=e.gamepad,i=t.index,r=this.inputDevices[i];r&&(this.emitGamepadEvent(t,r1(r),!1),this.inputDevices.splice(i,1),this.latestUpdate.splice(i,1),this.input.gamepad.devices.remove(r),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const i="getGamepads"in window.navigator,r=window.isSecureContext;this.supported=i&&r,this.supported&&(this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this.callback=e}connectGamepad(e){const t=new DJ(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this.startPolling():this.stopPolling()}startPolling(){null==this.frameTask&&(this.frameTask=en({update:()=>this.readGamepadState()}))}stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}readGamepadState(){const e=document.hasFocus(),t=this.element.contains(document.activeElement),i="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!t;this.forEachGamepad((e=>{const t=this.inputDevices[e.index];if(!t)return;const r=this.latestUpdate[e.index],s=r1(t),n=i||function(e){for(let t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(let t=0;t<e.buttons.length;t++)if(0!==e.buttons[t])return!1;return!0}(s);if(r){if(r.timestamp===e.timestamp)return;if(!r.active&&n)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}(r.state,s))return}this.emitGamepadEvent(e,s,!n)}))}forEachGamepad(e){const t=window.navigator.getGamepads();for(let i=0;i<t.length;i++){const r=t[i];this.validate(r)&&e(r)}}emitGamepadEvent(e,t,i){const r=this.latestUpdate[e.index],s=r&&r.active;if(!s&&!i)return;const n=!s&&i?"start":s&&i?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:i},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:n})}validate(e){if(!e)return!1;if(!e.connected)return!1;for(let t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}const n1=y("trident"),o1=y("edge"),a1=y("chrome"),l1=y("ff"),h1=y("safari"),c1="esri-view-surface--touch-none",u1="esri-view-surface--touch-pan";class p1{constructor(e,t){this.input=t,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new s1(e,this.input),this._gamepadSource.onEvent=e=>this._callback("gamepad",e)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((e=>{this._releasePointerCaptureSafe(e)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const t in this._active)if(!e||!e.has(t)){const e=this._active[t];this._element.removeEventListener(d1[t],e),delete this._active[t]}e&&e.forEach((e=>{if(!this._active[e]&&d1[e]){const t=(this._eventHandlers[e]||this._handleDefault).bind(this,e);this._element.addEventListener(d1[e],t),this._active[e]=t}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}setPointerCapture(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?c1:u1),this._element.classList.add(this._browserTouchPanningEnabled?u1:c1)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(c1),this._element.classList.remove(u1),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(mr){}}_updateNormalizedPointerLikeEvent(e,t){const i=_J(this._element,e);return p1.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),t.x=i.x,t.y=i.y,t}_handleKey(e,t){const i=function(e){if(void 0!==e.key)return Ke(e);const t=Hq[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}(t);i&&"key-up"===e&&this._keyDownState.delete(i);const r={native:t,key:i,repeat:i&&this._keyDownState.has(i)};i&&"key-down"===e&&this._keyDownState.add(r.key),this._callback(e,r)}_handlePointer(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,t){const i=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,t){let i=t.deltaY;switch(t.deltaMode){case 0:(n1||o1)&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}n1||o1?i*=.7:a1||h1?i*=.6:l1&&(i*=1.375);const r=Math.abs(i);if(r>100){const e=.02;i=i/r*200/(1+Math.exp(-e*(r-100)))}const s=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:i});this._callback(e,s)}_handlePointerCaptureLost(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}_handleDefault(e,t){const i={native:t};t.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){"Alt"===e.key&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}}p1.test={disableSubpixelCoordinates:!1};const d1={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class f1 extends Xq{constructor(){super(!0),this.registerIncoming("context-menu",(e=>{e.data.native.preventDefault()}))}}function y1(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}const g1=250,m1=10,v1=350,b1=35;class w1 extends Xq{constructor(e=g1,t=m1,i=v1,r=b1,s=He){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=r,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach((e=>{null!=e.doubleClickTimeout&&(e.doubleClickTimeout.remove(),e.doubleClickTimeout=null)}))}get hasPendingInputs(){return tJ(this._pointerState,(e=>null!=e.doubleClickTimeout))}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_handleImmediateClick(e){const t=e.data,i=this._pointerId(t),r=this._pointerState.get(i);if(r){const s="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;y1(r.event.data,t)>s?(this._clearDoubleClickTimeout(i,!0),this._startClick(e)):(this._clearDoubleClickTimeout(i,!1),this._doubleClick.emit(r.event.data,void 0,r.event.modifiers))}else this._startClick(e)}_startClick(e){const t=this._pointerId(e.data),i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(t,{event:e,doubleClickTimeout:this._clock.setTimeout((()=>this._doubleClickTimeoutExceeded(t)),i)}),this.refreshHasPendingInputs()}_handlePointerDrag(e){const t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)}_handleDrag(e){const t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)}_clearDoubleClickTimeout(e,t){const i=this._pointerState.get(e);i&&(i.doubleClickTimeout.remove(),i.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}}class _1 extends Xq{constructor(e=g1,t=m1,i=v1,r=b1,s=He){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=r,this._clock=s,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=FS(0,0),this._pointerState=new Map,this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new q0({start:(e,t)=>this._dragStart(e,t),update:(e,t)=>this._dragUpdate(t),end:(e,t)=>this._dragEnd(t)}),this.registerIncoming("drag",(e=>this._dragEventSeparator.handle(e))),this.registerIncoming("pointer-down",(e=>this._handlePointerDown(e))),this.registerIncoming("pointer-up",(()=>this._handlePointerUp()))}onUninstall(){this._pointerState.forEach((e=>{null!=e.doubleTapTimeout&&(e.doubleTapTimeout.remove(),e.doubleTapTimeout=null)}))}get hasPendingInputs(){return tJ(this._pointerState,(e=>null!=e.doubleTapTimeout))}_clearPointerDown(e){const t=this._pointerState.get(e);t&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs())}_createDoubleTapDragData(e,t,i){const{button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}=i;return{action:e,delta:t,button:r,buttons:s,pointer:n,pointers:o,pointerType:a,timestamp:l}}_dragStart(e,t){if(!this._doubleTapDragReady||1!==e)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:i,modifiers:r}=t,{center:s}=i;this._dragStartCenter=s;const n=this._createDoubleTapDragData("begin",FS(0,0),i);this._doubleTapDrag.emit(n,void 0,r),t.stopPropagation()}_dragUpdate(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:r}=t,s=FS(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("update",s,t);this._doubleTapDrag.emit(n,void 0,i),e.stopPropagation()}_dragEnd(e){if(!this._doubleTapDragActive)return;const{data:t,modifiers:i}=e,{center:r}=t,s=FS(r.x-this._dragStartCenter.x,r.y-this._dragStartCenter.y),n=this._createDoubleTapDragData("end",s,t);this._doubleTapDrag.emit(n,void 0,i),this._doubleTapDragActive=!1,e.stopPropagation()}_handlePointerDown(e){const{data:t}=e,i=this._pointerId(t),r=this._pointerState.get(i),{pointerType:s}=t.native;if(r){const n="touch"===s?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(i),y1(r.event.data,t)>n?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}_handlePointerUp(){this._doubleTapDragReady=!1}_pointerId(e){const{native:t}=e,{pointerId:i,button:r,pointerType:s}=t;return"mouse"===s?`${i}:${r}`:`${s}`}_storePointerDown(e){const{data:t}=e,{pointerType:i}=t.native,r=this._pointerId(t),s="touch"===i?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay,n=this._clock.setTimeout((()=>this._clearPointerDown(r)),s);this._pointerState.set(r,{event:e,doubleTapTimeout:n}),this.refreshHasPendingInputs()}}class x1 extends Xq{constructor(e){super(!1),this.navigationTouch=e,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this.handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this.handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this.handlePointerUpAndPointerLost.bind(this))}createPayload(e,t,i,r){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:r,pointers:T1(this.activePointerMap),pointer:t,angle:i.angle,radius:i.radius,center:i.center}}addPointer(e){const t=e.native.pointerId,i=M1(this.activePointerMap).angle,r={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,r);const s=I1(r,S1(this.activePointerMap));r.initialAngle=s,r.lastAngle=s,this.updatePointerAngles(i)}updatePointer(e){if(e&&null==e.x&&null==e.y)return;const t=e.native.pointerId,i=this.activePointerMap.get(t);i?i.event=e:this.addPointer(e)}removePointer(e){const t=M1(this.activePointerMap).angle;this.activePointerMap.delete(e),this.updatePointerAngles(t)}updatePointerAngles(e){const t=M1(this.activePointerMap);this.activePointerMap.forEach((i=>{i.initialAngle=I1(i,t)-e,i.lastAngle=I1(i,t)-e}))}emitEvent(e,t,i){const r=M1(this.activePointerMap);this.drag.emit(this.createPayload(e,t,r,i),void 0,this.startStateModifiers)}handlePointerUpAndPointerLost(e){const t=e.data.native.pointerId,i=e.timestamp;this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this.updatePointer(e.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",e.data,i),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.removePointer(t)):(this.removePointer(t),this.emitEvent("removed",e.data,e.timestamp)))}handlePointerDrag(e){const t=e.data,i=t.currentEvent,r=e.timestamp;switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(i.native.pointerId)?(this.updatePointer(i),!this.isCurrentDragSuppressed&&this.emitEvent("update",i,r)):(this.addPointer(i),this.emitEvent("added",i,r),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(i),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",i,r))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function S1(e){const t=[];return e.forEach((e=>{t.push(FS(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:FS()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){const[i,r]=e,[s,n]=[r.x-i.x,r.y-i.y];return t.radius=Math.sqrt(s*s+n*n)/2,t.center.x=(i.x+r.x)/2,t.center.y=(i.y+r.y)/2,t}let i=0,r=0;for(let b=0;b<e.length;b++)i+=e[b].x,r+=e[b].y;i/=e.length,r/=e.length;const s=e.map((e=>e.x-i)),n=e.map((e=>e.y-r));let o=0,a=0,l=0,h=0,c=0,u=0,p=0;for(let b=0;b<s.length;b++){const e=s[b],t=n[b],i=e*e,r=t*t;o+=i,a+=r,l+=e*t,h+=i*e,c+=r*t,u+=e*r,p+=t*i}const d=.5*(h+u),f=.5*(c+p),y=o*a-l*l,g=(d*a-f*l)/y,m=(o*f-l*d)/y,v=FS(g+i,m+r);return{radius:Math.sqrt(g*g+m*m+(o+a)/e.length),center:v}}(t)}function M1(e){const t=S1(e);let i=0;return e.forEach((e=>{let r=I1(e,t),s=r-e.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;r=e.lastAngle+s,e.lastAngle=r;const n=r-e.initialAngle;i+=n})),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function T1(e){const t=new Map;return e.forEach(((e,i)=>t.set(i,e.event))),t}function I1(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var E1;!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(E1||(E1={}));class A1 extends Xq{constructor(e=g1,t=m1,i=v1,r=b1,s=He){super(!1),this.maximumDoubleClickDelay=e,this.maximumDoubleClickDistance=t,this.maximumDoubleTouchDelay=i,this.maximumDoubleTouchDistance=r,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")}))}onUninstall(){this._pointerState.forEach((e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=this._pointerId(t);if(!this._pointerState.has(i)){const e={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(i,e),this.startCapturingPointer(t.native)}}_handlePointerLoss(e,t){const i=e.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s&&"pointer-up"===t&&s.downButton===i.native.button){const t=s.immediateDoubleClick;if(t){t.timeoutHandle.remove();const r="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;y1(t,e.data)>r?this._startImmediateDoubleClick(e,s):(this._immediateDoubleClick.emit(e.data,void 0,t.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,s)}}_startImmediateDoubleClick(e,t){const i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((()=>this._removeState(e.data)),i)}}_pointerId(e){const t=e.native;return"mouse"===t.pointerType?`${t.pointerId}:${t.button}`:`${t.pointerType}`}_removeState(e){const t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}const P1=300,C1=1.5,O1=6,k1=6,L1=500;class R1 extends Xq{constructor(e=P1,t=C1,i=O1,r=k1,s=L1,n=He){super(!1),this.maximumClickDelay=e,this.movementUntilMouseDrag=t,this.movementUntilPenDrag=i,this.movementUntilTouchDrag=r,this.holdDelay=s,this._clock=n,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",(e=>{this._handlePointerLoss(e,"pointer-up")})),this.registerIncoming("pointer-capture-lost",(e=>{this._handlePointerLoss(e,"pointer-capture-lost")})),this.registerIncoming("pointer-cancel",(e=>{this._handlePointerLoss(e,"pointer-cancel")})),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach((e=>{null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),super.onUninstall()}_handlePointerDown(e){const t=e.data,i=t.native.pointerId;let r=null;0===this._pointerState.size&&(r=this._clock.setTimeout((()=>{const t=this._pointerState.get(i);if(t){if(!t.isDragging){const i=t.previousEvent;this._pointerHold.emit(i,void 0,e.modifiers),t.holdEmitted=!0}t.holdTimeout=null}}),this.holdDelay));const s={startEvent:t,previousEvent:t,startTimestamp:e.timestamp,isDragging:!1,downButton:t.native.button,holdTimeout:r,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(t.native),this._moveHandle.resume(),this._pointerState.size>1&&this.startDragging(e)}_createPointerDragData(e,t,i){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:i}}_handlePointerMove(e){const t=e.data,i=t.native.pointerId,r=this._pointerState.get(i);r&&(r.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",r,t),void 0,r.modifiers):function(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}(t,r.startEvent)>this._getDragThreshold(t.native.pointerType)&&this.startDragging(e),r.previousEvent=t)}_getDragThreshold(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;case"mouse":default:return this.movementUntilMouseDrag}}startDragging(e){const t=e.data,i=t.native.pointerId;this._pointerState.forEach((r=>{null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging||(r.modifiers=e.modifiers,r.isDragging=!0,i===r.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",r,t)):this._pointerDrag.emit(this._createPointerDragData("start",r,r.previousEvent),e.timestamp))}))}_handlePointerLoss(e,t){const i=e.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(null!=s.holdTimeout&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,"pointer-up"===t?i:s.previousEvent),void 0,s.modifiers):"pointer-up"===t&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this.maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(r),this.stopCapturingPointer(i.native),0===this._pointerState.size&&this._moveHandle.pause())}}const D1="Ctrl",F1={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},j1={zoomIn:["=","+"],zoomOut:["-","_"]},N1={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"};let z1=class extends jo{constructor(){super(...arguments),this._handles=new Mh}initialize(){this._handles.add([Nh(this.view,"ready",(()=>this._disconnect())),Fh(this.view,"ready",(()=>this._connect()))])}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect()}_disconnect(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)}_connect(){const e=this.view.surface,t=new p1(e,this.view.input),i=[new A1,new R1,new w1,new x1(this.view.navigation),new _1],r=new eH({eventSource:t,recognizers:i});r.installHandlers("prevent-context-menu",[new f1],iH.INTERNAL),r.installHandlers("navigation",[new i1(this.view),new J0(this.view),new t1(this.view),new G0(this.view),new G0(this.view,[D1]),new H0(this.view,"primary"),new Z0(this.view,F1),new e1(this.view,j1),new Q0(this.view,N1),new W0(this.view,"secondary"),new B0(this.view,"touch")],iH.INTERNAL),this.view.viewEvents.connect(r),this._source=t,this._inputManager=r,Rh(this.view.navigation,"browserTouchPanEnabled",(e=>{this._source.browserTouchPanningEnabled=!e}))}get test(){return{inputManager:this._inputManager}}};Q([ro()],z1.prototype,"view",void 0),z1=Q([Ro("esri.views.2d.input.MapViewInputManager")],z1);var V1=z1;let U1=0,G1=class extends jo{constructor(){super(...arguments),this.color=new Rv([0,255,255]),this.haloOpacity=1,this.fillOpacity=.25}get version(){return U1++}};Q([ro({readOnly:!0})],G1.prototype,"version",null),Q([ro({type:Rv})],G1.prototype,"color",void 0),Q([ro({type:Rv})],G1.prototype,"haloColor",void 0),Q([ro()],G1.prototype,"haloOpacity",void 0),Q([ro()],G1.prototype,"fillOpacity",void 0),G1=Q([Ro("esri.views.2d.support.HighlightOptions")],G1);var B1=G1;function q1(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=Q1(e,t.padding),a=function(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){null!=e.area.x&&(i.x=Math.floor(e.area.x)),null!=e.area.y&&(i.y=Math.floor(e.area.y));const r=null!=e.area.width?Math.floor(e.area.width):null,s=null!=e.area.height?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,null!=r&&null!=s)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(null==r&&null!=s){const e=Math.min(i.width,r);i.height=e/i.width*i.height,i.width=e}else if(null!=r&&null==s){const e=Math.min(i.height,s);i.width=e/i.height*i.width,i.height=e}}return function(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const e=Math.floor(s.width/o),t=s.height-e;return{x:s.x,y:Math.floor(s.y+t/2),width:s.width,height:e}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}(function(e,t){if(!t||null==t.width||null==t.height)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const t=Math.floor(e.height*i);return e.x-=(t-e.width)/2,e.width=t,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}(i,e),t)}(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:h}=function(e,t){if(!e)return t;const i=e.width,r=e.height;if(null!=i&&null!=r)return{width:Math.floor(i),height:Math.floor(r)};if(null==i&&null==r)return t;const s=t.width/t.height;return null==r?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}(e,a),c=function(e){switch(e){case"png":case"jpg":case"jpeg":return e;case null:case void 0:default:return t2}}(i),u=i2[c];return{format:c,quality:mv(null!=r?r:u,0,100),area:a,width:l,height:h,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function H1(e,t,i,r){r.premultipliedAlpha&&function(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const e=t[r+3];if(e>0){const i=e/255;t[r+0]=t[r+0]/i,t[r+1]=t[r+1]/i,t[r+2]=t[r+2]/i}}}(e),i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.putImageData(e,0,0),r.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(s);const n=s.getImageData(0,0,e.width,e.height),o=function(e,t){const i=e2[t.format],r=t.quality/100;return e.toDataURL(i,r)}(i,t);return i.width=0,i.height=0,{dataUrl:o,data:n}}function W1(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(Z1)try{return new ImageData(e,t)}catch(qe){Z1=!1}return K1(e,t,i)}function $1(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(Z1)try{return new ImageData(e,t,i)}catch(Cv){Z1=!1}const s=K1(t,i,r);return s.data.set(e,0),s}function J1(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:h,height:c,data:u}=t,p=n/h,d=o/c,f=Math.ceil(p/2),y=Math.ceil(d/2),g=e.width;for(let m=0;m<c;m++)for(let e=0;e<h;e++){const t=4*(e+(a?c-m-1:m)*h);let n=0,o=0,v=0,b=0,w=0,_=0;const x=(m+.5)*d;for(let a=Math.floor(m*d);a<(m+1)*d;a++){const t=Math.abs(x-(a+.5))/y,h=(e+.5)*p,c=t*t;for(let u=Math.floor(e*p);u<(e+1)*p;u++){const e=Math.abs(h-(u+.5))/f,t=Math.sqrt(c+e*e);if(t>=1)continue;let p=2*t*t*t-3*t*t+1;const d=4*(r+u+(s+a)*g);_+=p*l[d+3],o+=p,!i&&l[d+3]<255&&(p=p*l[d+3]/255),v+=p*l[d],b+=p*l[d+1],w+=p*l[d+2],n+=p}}u[t]=v/n,u[t+1]=b/n,u[t+2]=w/n,u[t+3]=_/o}return t}function X1(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,h=Q1(e,i),c=h.left+h.right,u=h.top+h.bottom,p=r-c,d=s-u,f=Math.min(8,Math.min((2048-c)/p,(2048-u)/d));return f<1.5?e:l(a({},e),{framebufferWidth:Math.round(p*f)+c,framebufferHeight:Math.round(d*f)+u,pixelRatio:n*f,resample:{region:{x:Math.round((o.x-h.left)*f)+h.left,y:Math.round((o.y-h.top)*f)+h.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:s}})}function K1(e,t,i){return i||(Y1||(Y1=document.createElement("canvas"),Y1.width=1,Y1.height=1),i=Y1),i.getContext("2d").createImageData(e,t)}let Y1=null,Z1=!0;function Q1(e,t){return!t||e&&e.ignorePadding?r2:t}const e2={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},t2="png",i2={png:100,jpg:98,jpeg:98},r2={top:0,right:0,bottom:0,left:0};function s2(e,t={},i){if(!window.WebGLRenderingContext)return o2(e,a2),null;return n2(e,t,i)||(o2(e,l2),null)}function n2(e,t={},i){let r;switch(i){case"webgl":r=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case"webgl2":r=["webgl2"];break;default:r=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}let s=null;for(const n of r){try{s=e.getContext(n,t)}catch(Cv){}if(s)break}return s}function o2(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}const a2='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',l2='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>';let h2;function c2(){return h2||(h2=function(){const e={available:!1,version:0,majorPerformanceCaveat:!1,maxTextureSize:0,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1,supportsTextureFloat:!1,supportsColorBufferFloat:!1};if(void 0===typeof WebGLRenderingContext)return e;const t=document.createElement("canvas");if(!t)return e;let i=n2(t,{failIfMajorPerformanceCaveat:!0},"webgl");if(i||(i=n2(t,{},"webgl"),i&&(e.majorPerformanceCaveat=!0)),!i)return e;const r=i.getParameter(i.VERSION);if(!r)return e;const s=r.match(/^WebGL\s+([\d.]*)/);if(s){const t=parseFloat(s[1]);e.available=t>=.94;const r=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);r&&(e.supportsHighPrecisionFragment=r.precision>0),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0,e.supportsElementIndexUint=null!==i.getExtension("OES_element_index_uint"),e.supportsStandardDerivatives=null!==i.getExtension("OES_standard_derivatives"),e.supportsInstancedArrays=null!==i.getExtension("ANGLE_instanced_arrays"),e.supportsTextureFloat=null!==i.getExtension("OES_texture_float"),e.supportsColorBufferFloat=null!==i.getExtension("WEBGL_color_buffer_float")&&null!==i.getExtension("EXT_float_blend")}return e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.version=function(){if(void 0===typeof WebGL2RenderingContext)return!1;const e=document.createElement("canvas");return!!e&&!!n2(e,{},"webgl2")}()?2:1,e}()),h2}const u2={checkMajorWebPerformanceCaveat:!0};const p2="esri-component";let d2=class extends jo{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(p2),t&&t.classList.remove(p2),this._set("node",e))}castNode(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),nh(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};Q([ro({dependsOn:[]})],d2.prototype,"id",null),Q([ro()],d2.prototype,"node",null),Q([Ra("node")],d2.prototype,"castNode",null),Q([ro({readOnly:!0})],d2.prototype,"widget",void 0),d2=Q([Ro("esri.views.ui.Component")],d2);var f2=d2;const y2={left:0,top:0,bottom:0,right:0},g2={bottom:30,top:15,right:15,left:15},m2="esri-ui",v2="esri-ui-corner",b2="esri-ui-inner-container",w2="esri-ui-manual-container",_2="esri-ui-corner-container",x2="esri-ui-top-left",S2="esri-ui-top-right",M2="esri-ui-bottom-left",T2="esri-ui-bottom-right";function I2(e){return"object"!=typeof e||e instanceof f2||"declaredClass"in e||!("component"in e||"index"in e||"position"in e)?null:e}function E2(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let A2=class extends sh.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new Mh,this.view=null,this._initContainers()}initialize(){this._handles.add([Rh(this,"view.padding, container",this._applyViewPadding.bind(this)),Rh(this,"padding",this._applyUIPadding.bind(this))])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(m2),e.classList.add("calcite-theme-"+(vu()?"dark":"light")),this._attachContainers(e)),t&&(t.classList.remove(m2),E2(t,{top:"",bottom:"",left:"",right:""}),oh(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:a(a({},g2),e)}get width(){const e=this.get("view.width")||0;if(0===e)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach((e=>this.add(e,t)));const s=I2(e);s&&({index:i,position:t,component:e,key:r}=s),t&&"object"==typeof t&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map((e=>this.remove(e,t)));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map((e=>this.empty(e))).reduce(((e,t)=>e.concat(t))):"manual"===(e=e||"manual")?Array.prototype.slice.call(this._manualContainer.children).filter((e=>!e.classList.contains(v2))).map((e=>this.remove(e))):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach((e=>this.move(e,t))),!e)return;let i;const r=I2(e)||I2(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof f2||(e=new f2({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof f2?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||y2}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(b2),e.classList.add(_2);const t=document.createElement("div");t.classList.add(b2),t.classList.add(w2);const i=document.createElement("div");i.classList.add(x2),i.classList.add(v2),e.appendChild(i);const r=document.createElement("div");r.classList.add(S2),r.classList.add(v2),e.appendChild(r);const s=document.createElement("div");s.classList.add(M2),s.classList.add(v2),e.appendChild(s);const n=document.createElement("div");n.classList.add(T2),n.classList.add(v2),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=hu();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup=a({manual:t},this._cornerNameToContainerLookup)}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||"manual",r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);0!==r?r>=o.length?s.appendChild(t.node):ah(t.node,o[r]):s.firstChild?ah(t.node,s.firstChild):s.appendChild(t.node)}_applyViewPadding(){const e=this.container;e&&E2(e,this._toPxPosition(this._getViewPadding()))}_applyUIPadding(){const e=this._innerContainer;e&&E2(e,this._toPxPosition(this.padding))}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return 0===e?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some((r=>(t=r===e,t&&(i=r),t))),i}_findById(e){let t,i=null;return this._components.some((r=>(t=r.id===e,t&&(i=r),t))),i}_findByNode(e){let t,i=null;return this._components.some((r=>(t=r.node===e,t&&(i=r),t))),i}};Q([ro()],A2.prototype,"container",null),Q([ro()],A2.prototype,"height",null),Q([ro({value:g2})],A2.prototype,"padding",null),Q([Ra("padding")],A2.prototype,"castPadding",null),Q([ro()],A2.prototype,"view",void 0),Q([ro()],A2.prototype,"width",null),A2=Q([Ro("esri.views.ui.UI")],A2);var P2=A2;function C2(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function O2(e,t,i){i&&t&&(e.find((e=>e.layerView===t&&e.text===i))||e.push({text:i,layerView:t}))}const k2=[];let L2=class extends Jv{constructor(e){super(e),this.clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new xh,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const t=this.get("view.allLayerViews");t&&this.handles.add(t.map((e=>e.watch(["suspended","attributionVisible"],this._updateAttributionItems))),"suspension"),e&&e.removed&&e.removed.forEach((e=>{this._pendingAttributions.delete(e),this._fetchedAttributionData.delete(e)})),this._updateAttributionItems()},this._updateAttributionItems=()=>{const e=this.get("view.allLayerViews");k2.length=0,e?(e.forEach((e=>{if(e.suspended||!e.get("layer.attributionVisible"))return;const t=e.layer;if(C2(t,"user"))return void O2(k2,e,t.copyright);if(t.hasAttributionData){if(this._fetchedAttributionData.has(e)){const i=this._fetchedAttributionData.get(e);return void(i?O2(k2,e,this._getDynamicAttribution(i,this.view,t)):C2(t)&&O2(k2,e,t.copyright))}return void this._fetchAttributionData(e)}const i=t.get("portalItem.accessInformation");O2(k2,e,i||t.copyright)})),function(e,t){return e.length!==t.length||e.some(((e,i)=>e.text!==t[i].text))}(this.items,k2)&&(this.items.removeAll(),this.items.addMany(k2)),k2.length=0,this.notifyChange("state")):this.clear()},this.handles.add([Hh(this,"view.allLayerViews","change",this._allLayerViewsChange,this._allLayerViewsChange,this.clear),Vh(this,"view.stationary",(()=>this._updateAttributionItems()))])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Rg(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,function(e){return"bing-maps"===e.type}(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const e=i[s],n=e.coverageAreas;if(!n)return;for(const i of n){const n=i.bbox,o=i.zoomMin-(t&&i.zoomMin?1:0),a=i.zoomMax-(t&&i.zoomMax?1:0),l={extent:Xa({xmin:n[1],ymin:n[0],xmax:n[3],ymax:n[2],spatialReference:Aa.WGS84}),attribution:e.attribution||"",score:null!=i.score?i.score:100,id:s};for(let e=o;e<=a;e++)r[e]=r[e]||[],r[e].push(l)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||null==n||n<=-1)return"";const o=e[n],a=Wa(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter((e=>{const t=!l[e.id]&&a&&sl(e.extent,a);return t&&(l[e.id]=!0),t})).sort(((e,t)=>t.score-e.score||e.objectId-t.objectId)).map((e=>e.attribution)).join(", "):""}};Q([ro({readOnly:!0,type:xh})],L2.prototype,"items",void 0),Q([ro({readOnly:!0})],L2.prototype,"state",null),Q([ro()],L2.prototype,"view",void 0),L2=Q([Ro("esri.widgets.Attribution.AttributionViewModel")],L2);var R2=L2;const D2="esri-attribution esri-widget",F2="esri-widget__anchor",j2="esri-attribution__powered-by",N2="esri-attribution__sources",z2="esri-attribution--open",V2="esri-attribution__sources--open",U2="esri-attribution__link",G2="esri-icon-description",B2="esri-interactive";let q2=class extends xy{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this.iconClass=G2,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new R2}initialize(){this.own(Hh(this,"viewModel.items","change",(()=>this.scheduleRender())))}get attributionText(){return this.viewModel.items.reduce(((e,t)=>(-1===e.indexOf(t.text)&&e.push(t.text),e)),[]).join(this.itemDelimiter)}render(){const e={[z2]:this._isOpen};return Iy("div",{bind:this,class:this.classes(D2,e),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Iy("div",{class:j2},"Powered by"," ",Iy("a",{class:this.classes(U2,F2),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive(),i=t?0:-1,{attributionText:r}=this,s=t?"button":void 0,n={[V2]:e,[B2]:t};return Iy("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes(N2,n),innerHTML:r,role:s,tabIndex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth}_afterSourcesNodeUpdate(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>=r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const e=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,e&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive()&&(this._isOpen=!this._isOpen)}_isInteractive(){return this._isOpen||this._attributionTextOverflowed}};Q([ro({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],q2.prototype,"attributionText",null),Q([ro()],q2.prototype,"iconClass",void 0),Q([ro()],q2.prototype,"itemDelimiter",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],q2.prototype,"label",void 0),Q([ro(),Sy("esri/widgets/Attribution/t9n/Attribution")],q2.prototype,"messages",void 0),Q([eh("viewModel.view")],q2.prototype,"view",void 0),Q([ro({type:R2})],q2.prototype,"viewModel",void 0),Q([Fy()],q2.prototype,"_toggleState",null),q2=Q([Ro("esri.widgets.Attribution")],q2);var H2=q2;let W2=class extends(yH(jo)){constructor(e){super(e),this._handles=new Mh,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(Rh(this,"view",this._updateRotationWatcher))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){null!=e&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&("2d"===e.type?this._handles.add(Rh(this,"view.rotation",this._updateForRotation)):this._handles.add(Rh(this,"view.camera",this._updateForCamera)))}};Q([ro({readOnly:!0})],W2.prototype,"canShowNorth",null),Q([ro()],W2.prototype,"orientation",void 0),Q([ro({readOnly:!0})],W2.prototype,"state",null),Q([ro()],W2.prototype,"view",void 0),W2=Q([Ro("esri.widgets.CompassViewModel")],W2);var $2=W2;const J2="esri-compass esri-widget--button esri-widget",X2="esri-icon-font-fallback-text",K2="esri-compass__icon",Y2="esri-icon-dial",Z2="esri-icon-compass",Q2="esri-icon-locate-circled",e3="esri-interactive",t3="esri-disabled";let i3=class extends xy{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=Q2,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new $2}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i="disabled"===t,r="compass"==("rotation"===t?"rotation":"compass"),s=i?-1:0,n={[t3]:i,[e3]:!i},o={[Z2]:r,[Y2]:!r},{messages:a}=this;return Iy("div",{bind:this,class:this.classes(J2,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},Iy("span",{"aria-hidden":"true",class:this.classes(K2,o),styles:this._toRotationTransform(e)}),Iy("span",{class:X2},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};Q([eh("viewModel.goToOverride")],i3.prototype,"goToOverride",void 0),Q([ro()],i3.prototype,"iconClass",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],i3.prototype,"label",void 0),Q([ro(),Sy("esri/widgets/Compass/t9n/Compass")],i3.prototype,"messages",void 0),Q([eh("viewModel.view")],i3.prototype,"view",void 0),Q([ro({type:$2})],i3.prototype,"viewModel",void 0),Q([Fy()],i3.prototype,"_reset",null),i3=Q([Ro("esri.widgets.Compass")],i3);var r3=i3;let s3=class extends jo{constructor(e){super(e),this._handles=new Mh,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Fh(this,"view.inputManager",this._setNavigationMode.bind(this)))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};Q([ro({readOnly:!0})],s3.prototype,"state",null),Q([ro()],s3.prototype,"navigationMode",void 0),Q([ro()],s3.prototype,"view",void 0),s3=Q([Ro("esri.widgets.NavigationToggleViewModel")],s3);var n3=s3;const o3="esri-navigation-toggle esri-widget",a3="esri-navigation-toggle__button esri-widget--button",l3="esri-navigation-toggle__button--active",h3="esri-navigation-toggle__button--pan",c3="esri-navigation-toggle__button--rotate",u3="esri-navigation-toggle--horizontal",p3="esri-icon-rotate",d3="esri-icon-pan",f3="esri-icon-pan2",y3="esri-disabled";let g3=class extends xy{constructor(e,t){super(e,t),this.iconClass=f3,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new n3}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e="disabled"===this.get("viewModel.state"),t="pan"===this.get("viewModel.navigationMode"),i={[y3]:e,[u3]:"horizontal"===this.layout},r={[l3]:t},s={[l3]:!t},n=e?-1:0,o=this.messages.toggle;return Iy("div",{bind:this,class:this.classes(o3,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},Iy("div",{class:this.classes(a3,h3,r)},Iy("span",{class:d3})),Iy("div",{class:this.classes(a3,c3,s)},Iy("span",{class:p3})))}_toggle(){this.toggle()}};Q([ro()],g3.prototype,"iconClass",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],g3.prototype,"label",void 0),Q([ro({value:"vertical"})],g3.prototype,"layout",null),Q([ro(),Sy("esri/widgets/NavigationToggle/t9n/NavigationToggle")],g3.prototype,"messages",void 0),Q([eh("viewModel.view")],g3.prototype,"view",void 0),Q([ro({type:n3})],g3.prototype,"viewModel",void 0),Q([Fy()],g3.prototype,"_toggle",null),g3=Q([Ro("esri.widgets.NavigationToggle")],g3);var m3=g3;const v3="esri-widget--button esri-widget",b3="esri-disabled",w3="esri-interactive",_3="esri-icon-font-fallback-text",x3="esri-icon";let S3=class extends xy{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[b3]:!this.enabled,[w3]:this.enabled},i={[this.iconClass]:!!this.iconClass};return Iy("div",{bind:this,class:this.classes(v3,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Iy("span",{"aria-hidden":"true",role:"presentation",class:this.classes(x3,i)}),Iy("span",{class:_3},this.title))}_triggerAction(){this.action.call(this)}};Q([ro()],S3.prototype,"action",void 0),Q([ro()],S3.prototype,"enabled",void 0),Q([ro()],S3.prototype,"iconClass",void 0),Q([ro()],S3.prototype,"title",void 0),Q([Fy()],S3.prototype,"_triggerAction",null),S3=Q([Ro("esri.widgets.IconButton")],S3);var M3=S3;let T3=class extends jo{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}};Q([ro({readOnly:!0})],T3.prototype,"canZoomIn",null),Q([ro({readOnly:!0})],T3.prototype,"canZoomOut",null),Q([ro()],T3.prototype,"view",void 0),T3=Q([Ro("esri.widgets.Zoom.ZoomConditions2D")],T3);var I3=T3;let E3=class extends jo{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};Q([ro({readOnly:!0})],E3.prototype,"canZoomIn",null),Q([ro({readOnly:!0})],E3.prototype,"canZoomOut",null),Q([ro()],E3.prototype,"view",void 0),E3=Q([Ro("esri.widgets.Zoom.ZoomConditions3D")],E3);var A3=E3;let P3=class extends jo{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?"2d"===e.type?this._zoomConditions=new I3({view:e}):"3d"===e.type&&(this._zoomConditions=new A3({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():ct(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():ct(e.goTo({zoomFactor:.5}))}};Q([ro()],P3.prototype,"_zoomConditions",void 0),Q([ro({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],P3.prototype,"canZoomIn",void 0),Q([ro({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],P3.prototype,"canZoomOut",void 0),Q([ro({readOnly:!0})],P3.prototype,"state",null),Q([ro()],P3.prototype,"view",null),P3=Q([Ro("esri.widgets.Zoom.ZoomViewModel")],P3);var C3=P3;const O3="esri-zoom esri-widget",k3="esri-zoom--horizontal",L3="esri-icon-plus",R3="esri-icon-minus",D3="esri-icon-zoom-in-magnifying-glass";let F3=class extends xy{constructor(e,t){super(e,t),this.iconClass=D3,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new C3}initialize(){this._zoomInButton=new M3({action:this.zoomIn.bind(this),iconClass:L3}),this._zoomOutButton=new M3({action:this.zoomOut.bind(this),iconClass:R3})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[k3]:"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===e.state&&e.canZoomIn,this._zoomOutButton.enabled="ready"===e.state&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,Iy("div",{class:this.classes(O3,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};Q([ro()],F3.prototype,"iconClass",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],F3.prototype,"label",void 0),Q([ro({value:"vertical"})],F3.prototype,"layout",null),Q([ro(),Sy("esri/widgets/Zoom/t9n/Zoom")],F3.prototype,"messages",void 0),Q([eh("viewModel.view")],F3.prototype,"view",void 0),Q([ro({type:C3})],F3.prototype,"viewModel",void 0),F3=Q([Ro("esri.widgets.Zoom")],F3);var j3=F3;const N3="esri.views.ui.DefaultUI";Ne.getLogger(N3);let z3=class extends P2{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"},this.components=[]}initialize(){this._handles.add([Rh(this,"components",this._componentsWatcher.bind(this)),Rh(this,"view",this._updateViewAwareWidgets.bind(this))])}_add(e,t,i,r){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach((e=>{const t=this._find(e);t&&(this.remove(t),t.destroy())}))}_updateViewAwareWidgets(e){this.components.forEach((t=>{const i=this._find(t),r=i&&i.widget;(function(e){return e&&void 0!==e.view})(r)&&(r.view=e)}))}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(-1===e.indexOf("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(e){this.initialized&&e.forEach((e=>this.add(this._createComponent(e),this._defaultPositionLookup[e])))}_createComponent(e){const t=this._createWidget(e);if(t)return new f2({id:e,node:t})}_createWidget(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}_createAttribution(){return new H2({view:this.view})}_createCompass(){return new r3({view:this.view})}_createNavigationToggle(){return new m3({view:this.view})}_createZoom(){return new j3({view:this.view})}};Q([ro()],z3.prototype,"components",void 0),z3=Q([Ro(N3)],z3);var V3=z3;let U3=class extends V3{constructor(e){super(e),this.components=["attribution","zoom"]}};Q([ro()],U3.prototype,"components",void 0),U3=Q([Ro("esri.views.ui.2d.DefaultUI2D")],U3);var G3,B3=U3;let q3=G3=class extends Ko{constructor(e){super(e),this.color=new Rv([0,0,0,1])}clone(){return new G3(H({color:this.color}))}};Q([ro({type:Rv,json:{write:!0}})],q3.prototype,"color",void 0),q3=G3=Q([Ro("esri.webmap.background.ColorBackground")],q3);var H3=q3;const W3=Ne.getLogger("esri.views.MapView");let $3,J3,X3,K3,Y3,Z3;function Q3(e,t,i){if(e)if(Array.isArray(e)||xh.isCollection(e)){if(0===e.length)return;e.forEach((e=>Q3(e,t,i)))}else!function(e){return e instanceof fE}(e)?i.add(e):t.add(e)}let e5=class extends(uA(r$(V0))){constructor(e){super(e),this._magnifierView=null,this._stage=null,this._resolveWhenReady=[],this.rootLayerViews=new Kv({getCollections:()=>{var e,t;return[null==(e=this.basemapView)?void 0:e.baseLayerViews,this.layerViews,null==(t=this.basemapView)?void 0:t.referenceLayerViews]},getChildrenFunction:()=>null}),this.floors=new xh,this.graphicsView=null,this.highlightOptions=new B1,this.inputManager=new V1({view:this}),this.mapViewNavigation=null,this.supersampleScreenhotsEnabled=!1,this.ui=new B3,this.rendering=!1,aA()}destroy(){this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}get background(){return this.get("map.initialViewProperties.background")||null}set background(e){void 0===e?this._clearOverride("background"):this._override("background",e)}get textureManager(){return this._stage.painter.textureManager}get navigating(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}toMap(e){if(SJ(e)){const t=xJ(this,e);return super.toMap(t)}return super.toMap(e)}hitTest(e,t){const i=SJ(e)?xJ(this,e):e;if(!this.ready||isNaN(i.x)||isNaN(i.y))return Promise.resolve({screenPoint:i,results:[]});const r=this.toMap(i),s=[this.graphicsView];s.push.apply(s,this.allLayerViews.toArray().reverse());const n=new Set,o=new Set,a=new Set,l=new Set;return t&&(Q3(t&&t.include,n,a),Q3(t&&t.exclude,o,l)),Promise.all(s.map((e=>!e||!e.hitTest||a.size>0&&!e.layer||a.size>0&&e.layer&&!a.has(e.layer)||l.size>0&&e.layer&&l.has(e.layer)?null:e.hitTest(i.x,i.y)))).then((e=>({screenPoint:i,results:e.filter((e=>null!=e&&(!(n.size>0)||n.has(e))&&(!(o.size>0)||!o.has(e)))).map((e=>({mapPoint:r,graphic:e})))})))}takeScreenshot(e){return this.ready?this._stage.takeScreenshot(function(e,t){const i=q1(e,t),r=i.area,s=i.width/r.width,n=Q1(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,h=t.height-a,c=Math.floor(l*s+o),u=Math.floor(h*s+a),p=e&&e.layers?e.layers:[],d=i.ignoreBackground,f=i.ignorePadding;return{framebufferWidth:c,framebufferHeight:u,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:p,disableDecorations:i.disableDecorations,ignoreBackground:d,ignorePadding:f}}(e,this),this.allLayerViews):Promise.reject("Map view cannot be used before it is ready")}on(e,t,i,r){return this.inputManager&&this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}whenLayerView(e){return super.whenLayerView(e)}graphicChanged(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}whenReady(){return new Promise((e=>{this.ready?e(this):this._resolveWhenReady.push(e)}))}forceDOMReadyCycle(){this.forceReadyCycle()}validate(){let e=function(e){e=a(a({},u2),e);const t=c2();return t.available?e.checkMajorWebPerformanceCaveat&&t.majorPerformanceCaveat?new Be("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):t.supportsHighPrecisionFragment?t.supportsVertexShaderSamplers?t.supportsElementIndexUint?t.supportsStandardDerivatives?t.supportsInstancedArrays?null:new Be("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new Be("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new Be("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new Be("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new Be("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new Be("webgl:required","WebGL is required but not supported.")}({checkMajorWebPerformanceCaveat:!1});return y("safari")&&y("safari")<9&&(e=new Be("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:y("safari")})),m(e)?(W3.warn("#validate()",e.message),Promise.reject(e)):async function(){const[,{GraphicsView2D:e,GraphicContainer:t,LabelManager:i,MapViewNavigation:r,MagnifierView2D:s,Stage:n}]=await Promise.all([import("./webgl.18dd7d0b.js"),import("./mapViewDeps.85c9188d.js")]);J3=e,X3=t,K3=i,Y3=r,Z3=s,$3=n}()}_startup(){this.timeline.begin("MapView Startup"),super._startup(),this.graphics.owner=this;const e={disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},t=new $3(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenhotsEnabled,contextOptions:e,renderingOptions:this.renderingOptions,timeline:this.timeline}),i=new J3({view:this,graphics:this.graphics,requestUpdateCallback:()=>this.requestUpdate(),container:new X3(this.featuresTilingScheme)}),r=new Y3({view:this,animationManager:this.animationManager}),s=new K3({view:this});this._magnifierView=new Z3,this._magnifierView.magnifier=this.magnifier,this._stage=t,this.frameTask.graphicsView=i,this._set("graphicsView",i),this._set("mapViewNavigation",r),this._set("labelManager",s),this.handles.add([this.rootLayerViews.on("change",(()=>this._updateStageChildren())),t.on("post-render",(()=>this._set("rendering",t.renderRequested))),t.on("will-render",(()=>this._set("rendering",t.renderRequested))),t.on("webgl-error",(e=>this.fatalError=e.error)),Rh(this,"stationary",(e=>t.stationary=e),!0),Rh(this,"state.id",(()=>t.state=this.state),!0),Rh(this,"background",(e=>{t.background=e,this._magnifierView.background=e}),!0),Rh(this,"magnifier",(e=>this._magnifierView.magnifier=e),!0),Rh(this,"renderingOptions",(e=>t.renderingOptions=e),!0),Rh(this,"highlightOptions",(()=>t.highlightOptions=this.highlightOptions),!0)],"map-view"),t.state=this.state,this._updateStageChildren();const n=this._resolveWhenReady;this._resolveWhenReady=[],n.forEach((e=>e(this))),this.timeline.end("MapView Startup")}_teardown(){this.handles.remove("map-view"),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this.graphicsView.destroy(),this.mapViewNavigation.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,super._teardown()}_updateStageChildren(){this._stage.removeAllChildren(),this.rootLayerViews.forEach((e=>{this._stage.addChild(e.container)}));const e=this.graphicsView;this._stage.addChild(e.container),this._stage.addChild(this._magnifierView)}};Q([ro({type:H3})],e5.prototype,"background",null),Q([ro()],e5.prototype,"floors",void 0),Q([ro()],e5.prototype,"graphicsView",void 0),Q([ro({type:B1})],e5.prototype,"highlightOptions",void 0),Q([ro({readOnly:!0})],e5.prototype,"inputManager",void 0),Q([ro({readOnly:!0})],e5.prototype,"textureManager",null),Q([ro({readOnly:!0})],e5.prototype,"mapViewNavigation",void 0),Q([ro({type:Boolean})],e5.prototype,"navigating",null),Q([ro({type:Boolean,constructOnly:!0})],e5.prototype,"supersampleScreenhotsEnabled",void 0),Q([ro({type:B3})],e5.prototype,"ui",void 0),Q([ro({readOnly:!0})],e5.prototype,"rendering",void 0),Q([ro({constructOnly:!0})],e5.prototype,"renderCanvas",void 0),Q([ro({constructOnly:!0})],e5.prototype,"deactivatedWebGLExtensions",void 0),Q([ro({constructOnly:!0})],e5.prototype,"debugWebGLExtensions",void 0),e5=Q([Ro("esri.views.MapView")],e5);var t5=e5;const i5={id:"0/0/0",level:0,row:0,col:0,extent:null};let r5=class extends(RV(pU(uU(Mw)))){constructor(){super(...arguments),this.tileInfo=J$.create({spatialReference:Aa.WebMercator,size:256}),this.type="base-tile",this.fullExtent=new Ol(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,Aa.WebMercator),this.spatialReference=Aa.WebMercator}getTileBounds(e,t,i,r){const s=r||v$();return i5.level=e,i5.row=t,i5.col=i,i5.extent=s,this.tileInfo.updateTileInfo(i5),i5.extent=null,s}fetchTile(e,t,i,r={}){const{signal:s,timestamp:n}=r,o=this.getTileUrl(e,t,i),a={responseType:"image",signal:s};return null!=n&&(a.query={_ts:r.timestamp}),$i(o,a).then((e=>e.data))}getTileUrl(){throw new Be("basetilelayer:gettileurl-not-implemented","getTileUrl() is not implemented")}};Q([ro({type:J$})],r5.prototype,"tileInfo",void 0),Q([ro({type:["show","hide"]})],r5.prototype,"listMode",void 0),Q([ro({readOnly:!0,value:"base-tile"})],r5.prototype,"type",void 0),Q([ro()],r5.prototype,"fullExtent",void 0),Q([ro()],r5.prototype,"spatialReference",void 0),r5=Q([Ro("esri.layers.BaseTileLayer")],r5);var s5=r5;const n5=new ee({BingMapsAerial:"aerial",BingMapsRoad:"road",BingMapsHybrid:"hybrid"});let o5=class extends(RV(aU(sz(s5)))){constructor(e){super(e),this.type="bing-maps",this.tileInfo=new J$({size:[256,256],dpi:96,origin:{x:-20037508.342787,y:20037508.342787,spatialReference:Aa.WebMercator},spatialReference:Aa.WebMercator,lods:[{level:1,resolution:78271.5169639999,scale:295828763.795777},{level:2,resolution:39135.7584820001,scale:147914381.897889},{level:3,resolution:19567.8792409999,scale:73957190.948944},{level:4,resolution:9783.93962049996,scale:36978595.474472},{level:5,resolution:4891.96981024998,scale:18489297.737236},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.key=null,this.style="road",this.culture="en-US",this.region=null,this.portalUrl=null,this.hasAttributionData=!0}get bingMetadata(){return this._get("bingMetadata")}set bingMetadata(e){this._set("bingMetadata",e)}get copyright(){return m(this.bingMetadata)?this.bingMetadata.copyright:null}get operationalLayerType(){return n5.toJSON(this.style)}get bingLogo(){return m(this.bingMetadata)?this.bingMetadata.brandLogoUri:null}load(e){return this.key?this.addResolvingPromise(this._getMetadata()):this.portalUrl?this.addResolvingPromise(this._getPortalBingKey().then((()=>this._getMetadata()))):this.addResolvingPromise(Promise.reject(new Be("bingmapslayer:load","Bing layer must have bing key."))),Promise.resolve(this)}getTileUrl(e,t,i){if(!this.loaded||v(this.bingMetadata))return null;const r=this.bingMetadata.resourceSets[0].resources[0],s=r.imageUrlSubdomains[t%r.imageUrlSubdomains.length],n=this._getQuadKey(e,t,i);return r.imageUrl.replace("{subdomain}",s).replace("{quadkey}",n)}async fetchAttributionData(){return this.load().then((()=>v(this.bingMetadata)?null:{contributors:this.bingMetadata.resourceSets[0].resources[0].imageryProviders.map((e=>({attribution:e.attribution,coverageAreas:e.coverageAreas.map((e=>({zoomMin:e.zoomMin,zoomMax:e.zoomMax,score:1,bbox:[e.bbox[0],e.bbox[1],e.bbox[2],e.bbox[3]]})))})))}))}_getMetadata(){return $i(`https://dev.virtualearth.net/REST/v1/Imagery/Metadata/${{road:"roadOnDemand",aerial:"aerial",hybrid:"aerialWithLabelsOnDemand"}[this.style]}`,{responseType:"json",query:{include:"ImageryProviders",uriScheme:"https",key:this.key,suppressStatus:!0,output:"json",culture:this.culture,userRegion:this.region}}).then((e=>{const t=e.data;if(200!==t.statusCode)throw new Be("bingmapslayer:getmetadata",t.statusDescription);if(this.bingMetadata=t,0===this.bingMetadata.resourceSets.length)throw new Be("bingmapslayer:getmetadata","no bing resourcesets");if(0===this.bingMetadata.resourceSets[0].resources.length)throw new Be("bingmapslayer:getmetadata","no bing resources")})).catch((e=>{throw new Be("bingmapslayer:getmetadata",e.message)}))}_getPortalBingKey(){return $i(this.portalUrl,{responseType:"json",authMode:"no-prompt",query:{f:"json"}}).then((e=>{if(!e.data.bingKey)throw new Be("bingmapslayer:getportalbingkey","The referenced Portal does not contain a valid bing key");this.key=e.data.bingKey})).catch((e=>{throw new Be("bingmapslayer:getportalbingkey",e.message)}))}_getQuadKey(e,t,i){let r="";for(let s=e;s>0;s--){let e=0;const n=1<<s-1;0!=(i&n)&&(e+=1),0!=(t&n)&&(e+=2),r+=e.toString()}return r}};Q([ro({json:{read:!1,write:!1},value:null})],o5.prototype,"bingMetadata",null),Q([ro({json:{read:!1,write:!1},value:"bing-maps",readOnly:!0})],o5.prototype,"type",void 0),Q([ro({type:J$})],o5.prototype,"tileInfo",void 0),Q([ro({type:String,readOnly:!0,json:{read:!1,write:!1}})],o5.prototype,"copyright",null),Q([ro({type:String,json:{write:!1,read:!1}})],o5.prototype,"key",void 0),Q([ro({type:n5.apiValues,nonNullable:!0,json:{read:{source:"layerType",reader:n5.read}}})],o5.prototype,"style",void 0),Q([ro({type:["BingMapsAerial","BingMapsHybrid","BingMapsRoad"]})],o5.prototype,"operationalLayerType",null),Q([ro({type:String,json:{write:!1,read:!1}})],o5.prototype,"culture",void 0),Q([ro({type:String,json:{write:!1,read:!1}})],o5.prototype,"region",void 0),Q([ro({type:String,json:{write:!0,read:!0}})],o5.prototype,"portalUrl",void 0),Q([ro({type:Boolean,json:{write:!1,read:!1}})],o5.prototype,"hasAttributionData",void 0),Q([ro({type:String,readOnly:!0})],o5.prototype,"bingLogo",null),o5=Q([Ro("esri.layers.BingMapsLayer")],o5);var a5=o5,l5=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:a5});const h5={type:J$,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:c5}}}}};function c5(e,t,i,r){if(!e)return null;const{minScale:s,maxScale:n,minLOD:o,maxLOD:h}=t;if(null!=o&&null!=h)return r&&r.ignoreMinMaxLOD?J$.fromJSON(e):J$.fromJSON(l(a({},e),{lods:e.lods.filter((({level:e})=>null!=e&&e>=o&&e<=h))}));if(0!==s&&0!==n){const t=e=>Math.round(1e4*e)/1e4,i=s?t(s):1/0,r=n?t(n):-1/0;return J$.fromJSON(l(a({},e),{lods:e.lods.filter((e=>{const s=t(e.scale);return s<=i&&s>=r}))}))}return J$.fromJSON(e)}class u5{constructor(){this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}getAvailability(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;const i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,s=i>>3,n=this._tileAvailabilityBitSet;return s<0||s>n.length?"unknown":n[s]&1<<r?"available":"unavailable"}_updateFromData(e){const t=this.location.width,i=this.location.height;let r=!0,s=!0;const n=Math.ceil(t*i/8),o=new Uint8Array(n);let a=0;for(let l=0;l<e.length;l++){const t=l%8;e[l]?(s=!1,o[a]|=1<<t):r=!1,7===t&&++a}s?this._allAvailability="unavailable":r?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=o,this.byteSize+=o.length)}static fromDefinition(e,t){const i=e.service.request||$i,{row:r,col:s,width:n,height:o}=e,l={query:{f:"json"}};return t=t?a(a({},l),t):l,i(function(e){let t;if("vector-tile"===e.service.type)t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;else{const i=e.service.tileServers;t=`${i&&i.length?i[e.row%i.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}const i=e.service.query;return i&&(t=`${t}?${i}`),t}(e),t).then((e=>e.data)).catch((e=>{if(e&&e.details&&422===e.details.httpStatus)return{location:{top:r,left:s,width:n,height:o},valid:!0,data:ls(n*o,0)};throw e})).then((e=>{if(e.location&&(e.location.top!==r||e.location.left!==s||e.location.width!==n||e.location.height!==o))throw new Be("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:r,left:s,width:n,height:o}});return u5.fromJSON(e)}))}static fromJSON(e){u5.validateJSON(e);const t=new u5;return t.location=Object.freeze(H(e.location)),t._updateFromData(e.data),Object.freeze(t)}static validateJSON(e){if(!e||!e.location)throw new Be("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new Be("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new Be("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new Be("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new Be("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}function p5(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}var d5;const f5=Ne.getLogger("esri.layers.support.TilemapCache");let y5=d5=class extends jo{constructor(e){super(e),this._handles=new Mh,this._pendingTilemapRequests={},this._availableLevels={},this.levels=5,this.cacheByteSize=2097152,this.request=$i,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new zj(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],(()=>this._initializeTilemapDefinition())),Rh(this,"layer.tileInfo.lods",(e=>this._initializeAvailableLevels(e)),!0)]),this._initializeTilemapDefinition()}destroy(){this._handles&&(this._handles.destroy(),this._handles=null)}castLevels(e){return e<=2?(f5.error("Minimum levels for Tilemap is 3, but got ",e),3):e}get size(){return 1<<this.levels}fetchTilemap(e,t,i,r){if(!this._availableLevels[e])return Promise.reject(new Be("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const s=this._tmpTilemapDefinition,n=this._tilemapFromCache(e,t,i,s);if(n)return Promise.resolve(n);const o=r&&r.signal;return r=l(a({},r),{signal:null}),new Promise(((e,t)=>{ot(o,(()=>t(Qe())));const i=p5(s);let n=this._pendingTilemapRequests[i];if(!n){n=u5.fromDefinition(s,r).then((e=>(this._tilemapCache.put(i,e,e.byteSize),e)));const e=()=>delete this._pendingTilemapRequests[i];this._pendingTilemapRequests[i]=n,n.then(e,e)}n.then(e,t)}))}getAvailability(e,t,i){if(!this._availableLevels[e])return"unavailable";const r=this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition);return r?r.getAvailability(t,i):"unknown"}getAvailabilityUpsample(e,t,i,r){r.level=e,r.row=t,r.col=i;const s=this.layer.tileInfo;for(s.updateTileInfo(r);;){const e=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==e)return e;if(!s.upsampleTile(r))return"unavailable"}}fetchAvailability(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch((e=>e)).then((r=>{if(r instanceof u5){const s=r.getAvailability(t,i);return"unavailable"===s?Promise.reject(new Be("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):s}if(ht(r))throw r;return"unknown"})):Promise.reject(new Be("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`))}fetchAvailabilityUpsample(e,t,i,r,s){r.level=e,r.row=t,r.col=i;const n=this.layer.tileInfo;n.updateTileInfo(r);const o=this.fetchAvailability(e,t,i,s).catch((e=>{if(ht(e))throw e;if(n.upsampleTile(r))return this.fetchAvailabilityUpsample(r.level,r.row,r.col,r);throw e}));return this._fetchAvailabilityUpsamplePrefetch(r.id,e,t,i,s,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,i,r,s,n){if(!this._prefetchingEnabled)return;const o=`prefetch-${e}`;if(this._handles.has(o))return;const h=et();n.then((()=>h.abort()),(()=>h.abort()));let c=!1;const u={remove(){c||(c=!0,h.abort())}};if(this._handles.add(u,o),await function(e=1,t){const i=_t(),r=()=>{rt(t)?i.reject(Qe()):0===e?i():(--e,js((()=>r())))};return r(),i.promise}(10,h.signal).catch((()=>{})),c||(c=!0,this._handles.remove(o)),rt(h))return;const p={id:e,level:t,row:i,col:r},d=l(a({},s),{signal:h.signal}),f=this.layer.tileInfo;for(let a=0;d5._prefetches.length<d5._maxPrefetch&&f.upsampleTile(p);++a){const e=this.fetchAvailability(p.level,p.row,p.col,d);d5._prefetches.push(e);const t=()=>{d5._prefetches.removeUnordered(e)};e.then(t,t)}}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const e=this.layer.parsedUrl,t=e.query;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?Kt(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,i,r){r.level=e,r.row=t-t%this.size,r.col=i-i%this.size;const s=p5(r);return this._tilemapCache.get(s)}_initializeAvailableLevels(e){this._availableLevels={},e&&e.forEach((e=>this._availableLevels[e.level]=!0))}get test(){const e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:(t,i,r)=>!!e._tilemapFromCache(t,i,r,e._tmpTilemapDefinition)}}};y5._maxPrefetch=4,y5._prefetches=new Us({initialSize:d5._maxPrefetch}),Q([ro({constructOnly:!0,type:Number})],y5.prototype,"levels",void 0),Q([Ra("levels")],y5.prototype,"castLevels",null),Q([ro({readOnly:!0,type:Number})],y5.prototype,"size",null),Q([ro({constructOnly:!0,type:Number})],y5.prototype,"cacheByteSize",void 0),Q([ro({constructOnly:!0})],y5.prototype,"layer",void 0),Q([ro({constructOnly:!0})],y5.prototype,"request",void 0),y5=d5=Q([Ro("esri.layers.support.TilemapCache")],y5);const g5=e=>{let t=class extends e{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new y5({layer:this}):null}};return Q([ro({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),Q([ro()],t.prototype,"minScale",void 0),Q([sa("service","minScale")],t.prototype,"readMinScale",null),Q([ro()],t.prototype,"maxScale",void 0),Q([sa("service","maxScale")],t.prototype,"readMaxScale",null),Q([ro({type:Aa})],t.prototype,"spatialReference",void 0),Q([ro({readOnly:!0})],t.prototype,"supportsBlankTile",null),Q([ro(h5)],t.prototype,"tileInfo",void 0),Q([ro()],t.prototype,"tilemapCache",void 0),Q([sa("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),Q([ro()],t.prototype,"version",void 0),t=Q([Ro("esri.layers.mixins.ArcGISCachedService")],t),t};const m5=Ne.getLogger("esri.layers.support.SpriteSource");class v5{constructor(e,t,i,r){this.baseURL=e,this.devicePixelRatio=t,this.maxTextureSize=i,this._spriteImageFormat=r,this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded"}get spriteNames(){const e=[];for(const t in this._spritesData)e.push(t);return e.sort(),e}getSpriteInfo(e){return this._spritesData[e]}async load(e){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(e),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"}_loadSprites(e){this._isRetina=this.devicePixelRatio>1.15;const t=$t(this.baseURL),i=t.query?"?"+Kt(t.query):"",r=this._isRetina?"@2x":"",s=`${t.path}${r}.${this._spriteImageFormat}${i}`,n=`${t.path}${r}.json${i}`;return Promise.all([$i(n,e),$i(s,a({responseType:"image"},e))]).then((([e,i])=>{const r=Object.keys(e.data);if(!r||0===r.length||1===r.length&&"_ssl"===r[0]||!i||!i.data)return this._spritesData=this.image=null,this.width=this.height=0,Promise.resolve(null);this._spritesData=e.data;const s=i.data,n=Math.max(this.maxTextureSize,4096);if(s.width>n||s.height>n){const e=`Sprite resource for style ${t.path} is bigger than the maximum allowed of ${n} pixels}`;throw m5.error(e),new Be("SpriteSource",e)}this.width=s.width,this.height=s.height;const o=document.createElement("canvas"),a=o.getContext("2d");o.width=s.width,o.height=s.height,a.drawImage(s,0,0,s.width,s.height);const l=a.getImageData(0,0,s.width,s.height),h=new Uint8Array(l.data);let c;for(let t=0;t<h.length;t+=4)c=h[t+3]/255,h[t]=h[t]*c,h[t+1]=h[t+1]*c,h[t+2]=h[t+2]*c;this.image=h}))}}class b5{constructor(e){if(e instanceof y5)this._tilemapCache=e;else{if(!e||!("index"in e))throw new Error("Invalid tilemap!");this._tilemap=e.index}}dataKey(e,t){if(this._tilemapCache){const{level:i,row:r,col:s}=e,n=new d0(e);return this._tilemapCache.fetchAvailabilityUpsample(i,r,s,n,t).then((()=>(n.world=e.world,n))).catch((e=>{if(ht(e))throw e;return null}))}return this._getIndexedDataKey(e)}forEach(e,t,i,r,s){this._callback=s,this._maxLevel=t+e,this._forEach(this._tilemap,t,i,r)}_forEach(e,t,i,r){0!==e&&(this._callback(t,i,r),t!==this._maxLevel&&"object"==typeof e&&(this._forEach(e[0],t+1,2*i,2*r),this._forEach(e[1],t+1,2*i,2*r+1),this._forEach(e[2],t+1,2*i+1,2*r),this._forEach(e[3],t+1,2*i+1,2*r+1)))}_getIndexedDataKey(e){const t=[e];if(e.level<0||e.row<0||e.col<0||e.row>>e.level>0||e.col>>e.level>0)return Promise.resolve(null);let i=e;for(;0!==i.level;)i=new d0(i.level-1,i.row>>1,i.col>>1,i.world),t.push(i);let r,s,n=this._tilemap,o=t.pop();if(1===n)return Promise.resolve(o);for(;t.length;)if(r=t.pop(),s=(1&r.col)+((1&r.row)<<1),n){if(0===n[s]){o=null;break}if(1===n[s]){o=r;break}o=r,n=n[s]}return Promise.resolve(o)}}class w5{constructor(e,t,i){this.tileMapURL="",this.tilemapCache=null,this.parsedUrl=null,this.tileInfo=null,this.capabilities=null,this.tileIndex=null,this.fullExtent=null,this.name=e,this.sourceUrl=t,t&&(this.parsedUrl=$t(this.sourceUrl));const r=this.parsedUrl.path,s=this.parsedUrl.query?"?"+Kt(this.parsedUrl.query):"",n=H(i),o=n.tiles;t&&o.forEach(((e,t)=>{pi(e)||(o[t]=ci(r,e)+s)})),this.tileServers=o,i.tileMap&&(this.tileMapURL=ci(t,i.tileMap));const a=i.capabilities&&i.capabilities.split(",").map((e=>e.toLowerCase().trim())),l=!!i.exportTilesAllowed,h=!!a&&-1!==a.indexOf("tilemap"),c=l&&i.hasOwnProperty("maxExportTilesCount")?i.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:l,supportsTileMap:h},exportTiles:l?{maxExportTilesCount:+c}:null},this.tileInfo=c5(n.tileInfo,n,0,{ignoreMinMaxLOD:!0}),h&&(this.type="vector-tile",this.tilemapCache=new y5({layer:this}),this.tilemapCache&&(this.tileIndex=new b5(this.tilemapCache))),this.fullExtent=Ol.fromJSON(i.fullExtent)}getRefKey(e,t){return this.tileIndex?this.tileIndex.dataKey(e,t):Promise.resolve(e)}getSourceTileUrl(e,t,i){let r=this.tileServers[t%this.tileServers.length];return r=r.replace(/\{z\}/gi,e.toString()).replace(/\{y\}/gi,t.toString()).replace(/\{x\}/gi,i.toString()),r}isCompatibleWith(e){const t=this.tileInfo,i=e.tileInfo;if(!t.spatialReference.equals(i.spatialReference))return!1;if(!t.origin.equals(i.origin))return!1;if(Math.round(t.dpi)!==Math.round(i.dpi))return!1;const r=t.lods,s=i.lods,n=Math.min(r.length,s.length);for(let o=0;o<n;o++){const e=r[o],t=s[o];if(e.level!==t.level||Math.round(e.scale)!==Math.round(t.scale))return!1}return!0}}const _5=Z.defaults&&Z.defaults.io.corsEnabledServers;function x5(e){if(!e)return;const t=ui(e);_5&&-1===_5.indexOf(t)&&_5.push(t)}function S5(...e){let t;for(let i=0;i<e.length;++i)if(bi(e[i])){if(t){const r=t.split("://")[0];t=r+":"+e[i].trim()}}else t=pi(e[i])?e[i]:ci(t,e[i]);return Ei(t)}async function M5(e,t,i,r,s){let n,o,l;if(tt(s),"string"==typeof i){const e=hi(i);x5(e);const t=$t(e);l=await $i(t.path,a({query:{f:"json"},responseType:"json"},s)),n=e,o=e}else l={data:i},n=i.jsonUrl||null,o=r;const h=l.data;return l.ssl&&(n&&(n=n.replace(/^http:/i,"https:")),o&&(o=o.replace(/^http:/i,"https:"))),T5(h)?(e.styleUrl=n||null,async function(e,t,i,r){const s=i?Ti(i):Wt;e.styleBase=s,e.style=t,e.styleUrl&&x5(e.styleUrl),t["sprite-format"]&&"webp"===t["sprite-format"].toLowerCase()&&(e.spriteFormat="webp");const n=[];if(t.sources&&t.sources.esri){const i=t.sources.esri;i.url?await M5(e,"esri",S5(s,i.url),void 0,r):n.push(M5(e,"esri",i,s,r))}for(const o of Object.keys(t.sources))"esri"!==o&&"vector"===t.sources[o].type&&(t.sources[o].url?n.push(M5(e,o,S5(s,t.sources[o].url),void 0,r)):t.sources[o].tiles&&n.push(M5(e,o,t.sources[o],s,r)));await Promise.all(n)}(e,h,o,s)):function(e){return!T5(e)}(h)?e.sourceUrl?I5(e,h,o,!1,t,s):(e.sourceUrl=n||null,I5(e,h,o,!0,t,s)):Promise.reject("You must specify the URL or the JSON for a service or for a style.")}function T5(e){return!!e.sources}async function I5(e,t,i,r,s,n){const o=i?Ei(i)+"/":Wt,a=function(e,t){if(e.hasOwnProperty("tileInfo"))return e;const i={xmin:-20037507.067161843,ymin:-20037507.067161843,xmax:20037507.067161843,ymax:20037507.067161843,spatialReference:{wkid:102100}},r=512;let s=78271.51696400007,n=295828763.7957775;const o=[],a=e.hasOwnProperty("minzoom")?parseFloat(e.minzoom):0,l=e.hasOwnProperty("maxzoom")?parseFloat(e.maxzoom):22;for(let h=0;h<=l;h++)h>=a&&o.push({level:h,scale:n,resolution:s}),s/=2,n/=2;for(const h of e.tiles)x5(S5(t,h));return{capabilities:"TilesOnly",initialExtent:i,fullExtent:i,minScale:0,maxScale:0,tiles:e.tiles,tileInfo:{rows:r,cols:r,dpi:96,format:"pbf",origin:{x:-20037508.342787,y:20037508.342787},lods:o,spatialReference:{wkid:102100}}}}(t,o),l=new w5(s,o,a);if(!r&&e.primarySourceName in e.sourceNameToSource){const t=e.sourceNameToSource[e.primarySourceName];if(!t.isCompatibleWith(l))return Promise.resolve();null!=l.fullExtent&&(null!=t.fullExtent?t.fullExtent.union(l.fullExtent):t.fullExtent=l.fullExtent.clone()),t.tileInfo.lods.length<l.tileInfo.lods.length&&(t.tileInfo=l.tileInfo)}if(r?(e.sourceBase=o,e.source=t,e.validatedSource=a,e.primarySourceName=s,e.sourceUrl&&x5(e.sourceUrl)):x5(o),e.sourceNameToSource[s]=l,!e.style)return null==t.defaultStyles?Promise.reject():"string"==typeof t.defaultStyles?M5(e,"",S5(o,t.defaultStyles,"root.json"),void 0,n):M5(e,"",t.defaultStyles,S5(o,"root.json"),n)}function E5(e){return{origin:"portal-item",url:$t(e.itemUrl),portal:e.portal||Yl.getDefault(),portalItem:e,readResourcePaths:[]}}class A5{constructor(e,t){this.lockedSchemaPixelSize=e,this.isGCS=t}getLevelRowColumn(e){return this.isGCS?[e[0],e[1]>>1,e[2]>>1]:256===this.lockedSchemaPixelSize&&e[0]>0?[e[0]-1,e[1]>>1,e[2]>>1]:e}adjustLevel(e){return this.isGCS?e:256===this.lockedSchemaPixelSize?e>0?e-1:0:e}getShift(e,t){let i=0,r=0;return(256===this.lockedSchemaPixelSize||this.isGCS)&&(e[2]%2&&(i=t),e[1]%2&&(r=t)),[i,r]}getScale(e){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===e)return 1;return 2}static create256x256CompatibleTileInfo(e){if(!e)return null;if(256===e.size[0]&&256===e.size[1])return e;const t=e.spatialReference.isGeographic,i=[],r=e.lods.length;for(let s=0;s<r;s++){const r=e.lods[s],n=t?r.resolution:2*r.resolution;i.push(new H$({level:r.level,scale:r.scale,resolution:n}))}return new J$({size:[256,256],dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,origin:e.origin,spatialReference:e.spatialReference,lods:i})}static create512x512CompatibleTileInfo(e){if(!e)return null;if(256===e.size[0]||256===e.size[1])return null;const t=[],i=e.lods.length;for(let r=0;r<i;r++){const i=e.lods[r],s=.5*i.resolution;t.push(new H$({level:i.level,scale:i.scale,resolution:s}))}return new J$({size:[512,512],dpi:e.dpi,format:e.format,compressionQuality:e.compressionQuality,origin:e.origin,spatialReference:e.spatialReference,lods:t})}}const P5=1e-6;function C5(e,t){if(e===t)return!0;if(!e&&null!=t)return!1;if(null!=e&&!t)return!1;if(!e.spatialReference.equals(t.spatialReference)||e.dpi!==t.dpi)return!1;const i=e.origin,r=t.origin;if(Math.abs(i.x-r.x)>=P5||Math.abs(i.y-r.y)>=P5)return!1;let s,n;e.lods[0].scale>t.lods[0].scale?(s=e,n=t):(n=e,s=t);for(let o=s.lods[0].scale;o>=n.lods[n.lods.length-1].scale-P5;o/=2)if(Math.abs(o-n.lods[0].scale)<P5)return!0;return!1}function O5(e,t){if(e===t)return e;if(!e&&null!=t)return t;if(null!=e&&!t)return e;const i=e.size[0],r=e.format,s=e.dpi,n={x:e.origin.x,y:e.origin.y},o=e.spatialReference.toJSON(),a=e.lods[0].scale>t.lods[0].scale?e.lods[0]:t.lods[0],l=e.lods[e.lods.length-1].scale<=t.lods[t.lods.length-1].scale?e.lods[e.lods.length-1]:t.lods[t.lods.length-1],h=a.scale,c=a.resolution,u=l.scale,p=[];let d=h,f=c,y=0;for(;d>u;)p.push({level:y,resolution:f,scale:d}),y++,d/=2,f/=2;return new J$({size:[i,i],dpi:s,format:r||"pbf",origin:n,lods:p,spatialReference:o})}class k5{constructor(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}static i8816to32(e,t,i){return 255&e|(255&t)<<8|i<<16}}class L5{constructor(e){this._locations=new Map,this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._layoutInfo||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return 0===this._locations.size&&this._buildAttributesInfo(),this._locations}getLayoutInfo(){return this._layoutInfo||this._buildAttributesInfo(),this._layoutInfo}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,i,r,s){const n=this.getUniforms();for(const o of n){const{name:n,type:a,getValue:l}=o,h=l(i,t,r,s);if(null!==h)switch(a){case"float":e.setUniform1f(n,h);break;case"vec2":e.setUniform2fv(n,h);break;case"vec4":e.setUniform4fv(n,h)}}}encodeAttributes(e,t,i,r){const s=this.attributesInfo(),n=this.getEncodingInfos(),o=[];let a=0,l=0;for(const c of Object.keys(n)){var h;const u=n[c],{type:p,precisionFactor:d,isLayout:f}=s[c],y=f?i.getLayoutProperty(c):i.getPaintProperty(c),g=null==(h=y.interpolator)?void 0:h.getInterpolationRange(t);let m=0;for(const i of u){const{offset:s,bufferElementsToAdd:n}=i;if(n>0){for(let e=0;e<n;e++)o.push(0);a+=l,l=i.bufferElementsToAdd}const h=null!=r?r:y.getValue(g?g[m]:t,e);switch(p){case 0:case 1:o[a]|=this._encodeByte(h*(d||1),8*s);break;case 2:case 3:o[a]|=this._encodeShort(h*(d||1),8*s);break;case 4:case 5:o[a]|=this._encodeByte(h*(d||1),8*s),o[a]|=this._encodeByte(h*(d||1),8*s+8);break;case 6:case 7:o[a]|=this._encodeShort(h*(d||1),8*s),o[a]|=this._encodeShort(h*(d||1),8*s+16);break;case 8:case 9:o[a]|=this._encodeByte(h*(d||1),8*s),o[a]|=this._encodeByte(h*(d||1),8*s+8),o[a]|=this._encodeByte(h*(d||1),8*s+16),o[a]|=this._encodeByte(h*(d||1),8*s+24);break;case 10:o[a]=this._encodeColor(h);break;case 11:case 12:this._encodePattern(a,o,h);break;default:throw new Error("Unsupported encoding type")}m++}}return o}getAtributeState(e){let t=0;const i=3+2*e;return t|=this._bit(i),t|=this._bit(i+1)<<1,t}_buildAttributesInfo(){const e=[],t={},i={};let r=-1;const s=this.attributesInfo(),n=this.attributes();let o=-1;for(const c of n){o++;const n=this.getAtributeState(o);if(0===n||3===n)continue;const a=s[c],l=[];t[c]=l;const h=a.type;for(let t=0;t<n;t++){const{dataType:t,bytesPerElement:s,count:n,normalized:o}=L5._encodingInfo[h],a=s*n;let c=i[t],u=0;if(!c||c.count+n>4)r++,c={dataIndex:r,count:0,offset:0},4!==n&&(i[t]=c),e.push({location:-1,name:"a_data_"+r,count:n,type:t,normalized:o}),u=Math.ceil(Math.max(a/4,1));else{const t=e[c.dataIndex];t.count+=n,u=Math.ceil(Math.max(t.count*s/4,1))-Math.ceil(Math.max(c.offset/4,1))}l.push({dataIndex:c.dataIndex,offset:c.offset,bufferElementsToAdd:u}),c.offset+=a,c.count+=n}}for(const c of e)switch(c.type){case 5120:case 5121:c.count=4;case 5122:case 5123:c.count+=c.count%2}this._buildVertexBufferLayout(e);let a=0;const l=this._layoutInfo.geometry;for(const c of l)this._locations.set(c.name,a++);const h=this._layoutInfo.opacity;if(h)for(const c of h)this._locations.set(c.name,a++);this._buildShaderInfo(e,t),this._propertyEncodingInfo=t}_buildVertexBufferLayout(e){const t={},i=this.geometryInfo();let r=i[0].stride;if(0===e.length)t.geometry=i;else{const s=[];let n=r;for(const t of e)r+=R5(t.type)*t.count;for(const e of i){const t=a({},e);t.stride=r,s.push(t)}for(const t of e)s.push({name:t.name,count:t.count,type:t.type,offset:n,stride:r,normalized:t.normalized||!1,divisor:0}),n+=R5(t.type)*t.count;t.geometry=s}this.opacityInfo()&&(t.opacity=this.opacityInfo()),this._layoutInfo=t,this._stride=r}_buildShaderInfo(e,t){let i="\n",r="\n";const s=[];for(const l of e)i+=`attribute ${this._getType(l.count)} ${l.name};\n`;const n=this.attributes(),o=this.attributesInfo();let a=-1;for(const l of n){a++;const{name:e,type:n,precisionFactor:h,isLayout:c}=o[l],u=h&&1!==h?" * "+1/h:"",{bytesPerElement:p,count:d}=L5._encodingInfo[n],f=e=>`a_data_${e.dataIndex}${D5(d,e.offset,p)}`;switch(this.getAtributeState(a)){case 0:{const t=this._getType(d),o=`u_${e}`;s.push({name:o,type:t,getValue:(e,t,i,r)=>{const s=c?e.getLayoutValue(l,t):e.getPaintValue(l,t);if(11===n){const i=e.getDashKey(s,e.getLayoutValue("line-cap",t)),n=r.getMosaicItemPosition(i,!1);if(v(n))return null;const{tl:o,br:a}=n;return[o[0],a[1],a[0],o[1]]}if(12===n){const e=r.getMosaicItemPosition(s,-1===l.indexOf("line-"));if(v(e))return null;const{tl:t,br:i}=e;return[t[0],i[1],i[0],t[1]]}if(10===n){const e=s[3];return[e*s[0],e*s[1],e*s[2],e]}return s}}),i+=`uniform ${t} ${o};\n`,r+=`${t} ${e} = ${o};\n`}break;case 1:{const i=f(t[l][0]);r+=`${this._getType(d)} ${e} = ${i}${u};\n`}break;case 2:{const n=`u_t_${e}`;s.push({name:n,type:"float",getValue:(e,t,i,r)=>(c?e.getLayoutProperty(l):e.getPaintProperty(l)).interpolator.interpolationUniformValue(i,t)}),i+=`uniform float ${n};\n`;const o=f(t[l][0]),a=f(t[l][1]);r+=`${this._getType(d)} ${e} = mix(${o}${u}, ${a}${u}, ${n});\n`}}}this._shaderHeader=i,this._shaderMain=r,this._uniforms=s}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const t=255*e[3];return k5.i8888to32(e[0]*t,e[1]*t,e[2]*t,t)}_encodePattern(e,t,i){if(!i||!i.rect)return;const r=i.rect,s=i.width,n=i.height;t[e]=this._encodeShort(r.x+2,0),t[e]|=this._encodeShort(r.y+2+n,16),t[e+1]=this._encodeShort(r.x+2+s,0),t[e+1]|=this._encodeShort(r.y+2,16)}_encodeByte(e,t){return(255&e)<<t}_encodeShort(e,t){return(65535&e)<<t}}L5._encodingInfo={0:{dataType:5120,bytesPerElement:1,count:1,normalized:!1},1:{dataType:5121,bytesPerElement:1,count:1,normalized:!1},2:{dataType:5122,bytesPerElement:2,count:1,normalized:!1},3:{dataType:5123,bytesPerElement:2,count:1,normalized:!1},4:{dataType:5120,bytesPerElement:1,count:2,normalized:!1},5:{dataType:5121,bytesPerElement:1,count:2,normalized:!1},6:{dataType:5122,bytesPerElement:2,count:2,normalized:!1},7:{dataType:5123,bytesPerElement:2,count:2,normalized:!1},8:{dataType:5120,bytesPerElement:1,count:4,normalized:!1},9:{dataType:5121,bytesPerElement:1,count:4,normalized:!1},10:{dataType:5121,bytesPerElement:1,count:4,normalized:!0},11:{dataType:5123,bytesPerElement:2,count:4,normalized:!1},12:{dataType:5123,bytesPerElement:2,count:4,normalized:!1}};const R5=e=>{switch(e){case 5126:case 5124:case 5125:return 4;case 5122:case 5123:return 2;case 5120:case 5121:return 1}},D5=(e,t,i)=>{const r=t/i;if(1===e)switch(r){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===e)switch(r){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===e)switch(r){case 0:return".xyz";case 1:return".yzw"}return""};class F5 extends L5{constructor(e){super(e)}geometryInfo(){return F5.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return F5.ATTRIBUTES}attributesInfo(){return F5.ATTRIBUTES_INFO}}F5.ATTRIBUTES=[],F5.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}],F5.ATTRIBUTES_INFO={};class j5 extends L5{constructor(e){super(e)}geometryInfo(){return j5.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return j5.ATTRIBUTES}attributesInfo(){return j5.ATTRIBUTES_INFO}}j5.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"],j5.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],j5.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:1},"circle-color":{name:"color",type:10},"circle-opacity":{name:"opacity",type:1,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:1,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:10},"circle-stroke-opacity":{name:"stroke_opacity",type:1,precisionFactor:100},"circle-blur":{name:"blur",type:1,precisionFactor:32}};class N5 extends L5{constructor(e){super(e)}geometryInfo(){return N5.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return N5.ATTRIBUTES}attributesInfo(){return N5.ATTRIBUTES_INFO}}N5.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"],N5.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}],N5.ATTRIBUTES_INFO={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100},"fill-pattern":{name:"tlbr",type:12,isOptional:!0}};class z5 extends L5{constructor(e,t){super(e),this.usefillColor=t}geometryInfo(){return z5.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return this.usefillColor?z5.ATTRIBUTES_FILL:z5.ATTRIBUTES_OUTLINE}attributesInfo(){return this.usefillColor?z5.ATTRIBUTES_INFO_FILL:z5.ATTRIBUTES_INFO_OUTLINE}}z5.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"],z5.ATTRIBUTES_FILL=["fill-color","fill-opacity"],z5.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}],z5.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}},z5.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}};class V5 extends L5{constructor(e){super(e)}geometryInfo(){return V5.GEOMETRY_LAYOUT}opacityInfo(){return null}attributes(){return V5.ATTRIBUTES}attributesInfo(){return V5.ATTRIBUTES_INFO}}V5.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"],V5.GEOMETRY_LAYOUT=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_extrude_offset",count:4,type:5120,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_dir_normal",count:4,type:5120,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:12,stride:16,normalized:!1,divisor:0}],V5.ATTRIBUTES_INFO={"line-width":{name:"width",type:1,precisionFactor:2},"line-gap-width":{name:"gap_width",type:1,precisionFactor:2},"line-offset":{name:"offset",type:0,precisionFactor:2},"line-color":{name:"color",type:10},"line-opacity":{name:"opacity",type:1,precisionFactor:100},"line-blur":{name:"blur",type:1,precisionFactor:4},"line-pattern":{name:"tlbr",type:12,isOptional:!0},"line-dasharray":{name:"tlbr",type:11,isOptional:!0}};const U5=[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],G5=[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}];class B5 extends L5{constructor(e){super(e)}geometryInfo(){return U5}opacityInfo(){return G5}attributes(){return B5.ATTRIBUTES}attributesInfo(){return B5.ATTRIBUTES_INFO}}B5.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"],B5.ATTRIBUTES_INFO={"icon-color":{name:"color",type:10},"icon-opacity":{name:"opacity",type:1,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:10},"icon-halo-width":{name:"halo_width",type:1,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"icon-size":{name:"size",type:1,precisionFactor:32,isLayout:!0}};class q5 extends L5{constructor(e){super(e)}geometryInfo(){return U5}opacityInfo(){return G5}attributes(){return q5.ATTRIBUTES}attributesInfo(){return q5.ATTRIBUTES_INFO}}function H5(e){return"h"in e&&"s"in e&&"v"in e}function W5(e){return"l"in e&&"a"in e&&"b"in e}function $5(e){return"l"in e&&"c"in e&&"h"in e}q5.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"],q5.ATTRIBUTES_INFO={"text-color":{name:"color",type:10},"text-opacity":{name:"opacity",type:1,precisionFactor:100},"text-halo-color":{name:"halo_color",type:10},"text-halo-width":{name:"halo_width",type:1,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"text-size":{name:"size",type:1,isLayout:!0}};const J5=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],X5=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function K5(e,t){const i=[];let r,s;if(e[0].length!==t.length)throw"dimensions do not match";const n=e.length,o=e[0].length;let a=0;for(r=0;r<n;r++){for(a=0,s=0;s<o;s++)a+=e[r][s]*t[s];i.push(a)}return i}function Y5(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),i=K5(J5,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function Z5(e){const t=K5(X5,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function Q5(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function e9(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function t9(e){return Q5(Y5(e))}function i9(e){return Z5(e9(e))}function r9(e){return function(e){const t=e.l,i=e.a,r=e.b,s=Math.sqrt(i*i+r*r);let n=Math.atan2(r,i);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}(Q5(Y5(e)))}function s9(e){return Z5(e9(function(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}function n9(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:$5(e)?s9(e):W5(e)?i9(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?Z5(e):H5(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,s=r*i,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-s),o.g=Math.round(o.g+r-s),o.b=Math.round(o.b+r-s),o}(e):e}function o9(e){return H5(e)?e:function(e){const t=e.r,i=e.g,r=e.b,s=Math.max(t,i,r),n=s-Math.min(t,i,r);let o=s,a=0===n?0:s===t?(i-r)/n%6:s===i?(r-t)/n+2:(t-i)/n+4,l=0===n?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(n9(e))}function a9(e){return W5(e)?e:t9(n9(e))}function l9(e){return $5(e)?e:r9(n9(e))}function h9(e,t){const i=t9(e);return i.l*=1-t,i9(i)}const c9=Number.POSITIVE_INFINITY,u9=Math.PI,p9=2*u9,d9=128/u9,f9=u9/180,y9=1/Math.LN2;function g9(e,t){return(e%=t)>=0?e:e+t}function m9(e){return g9(e*d9,256)}function v9(e){return Math.log(e)*y9}function b9(e,t,i){return e*(1-i)+t*i}const w9={kind:"null"},_9={kind:"number"},x9={kind:"string"},S9={kind:"boolean"},M9={kind:"color"},T9={kind:"object"},I9={kind:"value"};function E9(e,t){return{kind:"array",itemType:e,n:t}}const A9=[w9,_9,x9,S9,M9,T9,E9(I9)];function P9(e){if("array"===e.kind){const t=P9(e.itemType);return"number"==typeof e.n?`array<${t}, ${e.n}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}function C9(e){if(null===e)return w9;if("string"==typeof e)return x9;if("boolean"==typeof e)return S9;if("number"==typeof e)return _9;if(e instanceof Rv)return M9;if(Array.isArray(e)){let t;for(const i of e){const e=C9(i);if(t){if(t!==e){t=I9;break}}else t=e}return E9(t||I9,e.length)}return"object"==typeof e?T9:I9}function O9(e,t){if("array"===t.kind)return"array"===e.kind&&(0===e.n&&"value"===e.itemType.kind||O9(e.itemType,t.itemType))&&("number"!=typeof t.n||t.n===e.n);if("value"===t.kind)for(const i of A9)if(O9(e,i))return!0;return t.kind===e.kind}function k9(e){if(null===e)return"";const t=typeof e;return"string"===t?e:"number"===t||"boolean"===t?String(e):e instanceof Rv?e.toString():JSON.stringify(e)}class L9{constructor(e){this.parent=e,this.vars={}}add(e,t){this.vars[e]=t}get(e){return this.vars[e]?this.vars[e]:this.parent?this.parent.get(e):null}}class R9{constructor(){this.type=I9}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new R9}evaluate(e,t){return null==e?void 0:e.id}}class D9{constructor(){this.type=x9}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new D9}evaluate(e,t){if(!e)return null;switch(e.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}}}class F9{constructor(){this.type=T9}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new F9}evaluate(e,t){return null==e?void 0:e.values}}class j9{constructor(){this.type=_9}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new j9}evaluate(e,t){return t}}class N9{constructor(e,t,i){this.lhs=e,this.rhs=t,this.compare=i,this.type=S9}static parse(e,t,i){if(3!==e.length&&4!==e.length)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(4===e.length)throw new Error(`"${e[0]}" collator not supported`);return new N9(y4(e[1],t),y4(e[2],t),i)}evaluate(e,t){return this.compare(this.lhs.evaluate(e,t),this.rhs.evaluate(e,t))}}class z9{constructor(e){this.arg=e,this.type=S9}static parse(e,t){if(2!==e.length)throw new Error('"!" expects 1 argument');return new z9(y4(e[1],t))}evaluate(e,t){return!this.arg.evaluate(e,t)}}class V9{constructor(e){this.args=e,this.type=S9}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(y4(e[r],t));return new V9(i)}evaluate(e,t){for(const i of this.args)if(!i.evaluate(e,t))return!1;return!0}}class U9{constructor(e){this.args=e,this.type=S9}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(y4(e[r],t));return new U9(i)}evaluate(e,t){for(const i of this.args)if(i.evaluate(e,t))return!0;return!1}}class G9{constructor(e){this.args=e,this.type=S9}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(y4(e[r],t));return new G9(i)}evaluate(e,t){for(const i of this.args)if(i.evaluate(e,t))return!1;return!0}}class B9{constructor(e,t,i){this.type=e,this.args=t,this.fallback=i}static parse(e,t,i){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let r;const s=[];for(let o=1;o<e.length-1;o+=2){const n=y4(e[o],t),a=y4(e[o+1],t,i);r||(r=a.type),s.push({condition:n,output:a})}const n=y4(e[e.length-1],t,i);return r||(r=n.type),new B9(r,s,n)}evaluate(e,t){for(const i of this.args)if(i.condition.evaluate(e,t))return i.output.evaluate(e,t);return this.fallback.evaluate(e,t)}}class q9{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let i;const r=[];for(let s=1;s<e.length;s++){const n=y4(e[s],t);i||(i=n.type),r.push(n)}return new q9(i,r)}evaluate(e,t){for(const i of this.args){const r=i.evaluate(e,t);if(null!==r)return r}return null}}class H9{constructor(e,t,i,r,s){this.type=e,this.input=t,this.labels=i,this.outputs=r,this.fallback=s}static parse(e,t){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let i;const r=y4(e[1],t),s=[],n={};let o;for(let a=2;a<e.length-1;a+=2){let r=e[a];Array.isArray(r)||(r=[r]);for(const e of r){const t=typeof e;if("string"!==t&&"number"!==t)throw new Error('"match" requires string or number literal as labels');if(o){if(t!==o)throw new Error('"match" requires labels to have the same type')}else o=t;n[e]=s.length}const l=y4(e[a+1],t);i||(i=l.type),s.push(l)}return new H9(i,r,n,s,y4(e[e.length-1],t))}evaluate(e,t){const i=this.input.evaluate(e,t);return(this.outputs[this.labels[i]]||this.fallback).evaluate(e,t)}}class W9{constructor(e,t,i,r,s){this.operator=e,this.type=t,this.interpolation=i,this.input=r,this.stops=s}static parse(e,t,i){const r=e[0];if(e.length<5)throw new Error(`"${r}" expects at least 4 arguments`);const s=e[1];if(!Array.isArray(s)||0===s.length)throw new Error(`"${s}" is not a valid interpolation`);switch(s[0]){case"linear":if(1!==s.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==s.length||"number"!=typeof s[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==s.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let e=1;e<5;e++){const t=s[e];if("number"!=typeof t||t<0||t>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${s[0]}"`)}if(e.length%2!=1)throw new Error(`"${r}" expects an even number of arguments`);const n=y4(e[2],t,_9);let o;"interpolate-hcl"===r||"interpolate-lab"===r?o=M9:i&&"value"!==i.kind&&(o=i);const a=[];for(let l=3;l<e.length;l+=2){const i=e[l];if("number"!=typeof i)throw new Error(`"${r}" requires stop inputs as literal numbers`);if(a.length&&a[a.length-1][0]>=i)throw new Error(`"${r}" requires strictly ascending stop inputs`);const s=y4(e[l+1],t,o);o||(o=s.type),a.push([i,s])}if(o&&o!==M9&&o!==_9&&("array"!==o.kind||o.itemType!==_9))throw new Error(`"${r}" cannot interpolate type ${P9(o)}`);return new W9(r,o,s,n,a)}evaluate(e,t){const i=this.stops;if(1===i.length)return i[0][1].evaluate(e,t);const r=this.input.evaluate(e,t);if(r<=i[0][0])return i[0][1].evaluate(e,t);if(r>=i[i.length-1][0])return i[i.length-1][1].evaluate(e,t);let s=0;for(;++s<i.length&&!(r<i[s][0]););const n=i[s-1][0],o=i[s][0],l=W9.interpolationRatio(this.interpolation,r,n,o),h=i[s-1][1].evaluate(e,t),c=i[s][1].evaluate(e,t);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(h)&&Array.isArray(c))return h.map(((e,t)=>b9(e,c[t],l)));if("color"===this.type.kind&&h instanceof Rv&&c instanceof Rv){const e=new Rv(h),t=new Rv(c);return new Rv([b9(e.r,t.r,l),b9(e.g,t.g,l),b9(e.b,t.b,l),b9(e.a,t.a,l)])}if("number"===this.type.kind&&"number"==typeof h&&"number"==typeof c)return b9(h,c,l);throw new Error(`"${this.operator}" cannot interpolate type ${P9(this.type)}`)}if("interpolate-hcl"===this.operator){const e=l9(h),t=l9(c),i=t.h-e.h,r=n9({h:e.h+l*(i>180||i<-180?i-360*Math.round(i/360):i),c:b9(e.c,t.c,l),l:b9(e.l,t.l,l)});return new Rv(a({a:b9(h.a,c.a,l)},r))}if("interpolate-lab"===this.operator){const e=a9(h),t=a9(c),i=n9({l:b9(e.l,t.l,l),a:b9(e.a,t.a,l),b:b9(e.b,t.b,l)});return new Rv(a({a:b9(h.a,c.a,l)},i))}throw new Error(`Unexpected operator "${this.operator}"`)}interpolationUniformValue(e,t){const i=this.stops;if(1===i.length)return 0;if(e>=i[i.length-1][0])return 0;let r=0;for(;++r<i.length&&!(e<i[r][0]););const s=i[r-1][0],n=i[r][0];return W9.interpolationRatio(this.interpolation,t,s,n)}getInterpolationRange(e){const t=this.stops;if(1===t.length){const e=t[0][0];return[e,e]}const i=t[t.length-1][0];if(e>=i)return[i,i];let r=0;for(;++r<t.length&&!(e<t[r][0]););return[t[r-1][0],t[r][0]]}static interpolationRatio(e,t,i,r){let s=0;return"linear"===e[0]?s=W9.exponentialInterpolationRatio(t,1,i,r):"exponential"===e[0]?s=W9.exponentialInterpolationRatio(t,e[1],i,r):"cubic-bezier"===e[0]&&(s=uX(e[1],e[2],e[3],e[4])(W9.exponentialInterpolationRatio(t,1,i,r),1e-5)),s<0?s=0:s>1&&(s=1),s}static exponentialInterpolationRatio(e,t,i,r){const s=r-i;if(0===s)return 0;const n=e-i;return 1===t?n/s:(t**n-1)/(t**s-1)}}class $9{constructor(e,t,i){this.type=e,this.input=t,this.stops=i}static parse(e,t){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const i=y4(e[1],t,_9);let r;const s=[];s.push([-1/0,y4(e[2],t)]);for(let n=3;n<e.length;n+=2){const i=e[n];if("number"!=typeof i)throw new Error('"step" requires stop inputs as literal numbers');if(s.length&&s[s.length-1][0]>=i)throw new Error('"step" requires strictly ascending stop inputs');const o=y4(e[n+1],t);r||(r=o.type),s.push([i,o])}return new $9(r,i,s)}evaluate(e,t){const i=this.stops;if(1===i.length)return i[0][1].evaluate(e,t);const r=this.input.evaluate(e,t);let s=0;for(;++s<i.length&&!(r<i[s][0]););return this.stops[s-1][1].evaluate(e,t)}}class J9{constructor(e,t){this.type=e,this.output=t}static parse(e,t,i){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const r=new L9(t);for(let n=1;n<e.length-1;n+=2){const i=e[n];if("string"!=typeof i)throw new Error(`"let" requires a string to define variable names - found ${i}`);r.add(i,y4(e[n+1],t))}const s=y4(e[e.length-1],r,i);return new J9(s.type,s)}evaluate(e,t){return this.output.evaluate(e,t)}}class X9{constructor(e,t){this.type=e,this.output=t}static parse(e,t,i){if(2!==e.length||"string"!=typeof e[1])throw new Error('"var" requires just one literal string argument');const r=t.get(e[1]);if(!r)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new X9(i||I9,r)}evaluate(e,t){return this.output.evaluate(e,t)}}class K9{constructor(e,t,i){this.type=e,this.index=t,this.array=i}static parse(e,t){if(3!==e.length)throw new Error('"at" expects 2 arguments');const i=y4(e[1],t,_9),r=y4(e[2],t);return new K9(r.type.itemType,i,r)}evaluate(e,t){const i=this.index.evaluate(e,t),r=this.array.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"at" index out of bounds');if(i!==Math.floor(i))throw new Error('"at" index must be an integer');return r[i]}}class Y9{constructor(e,t){this.key=e,this.obj=t,this.type=I9}static parse(e,t){let i,r;switch(e.length){case 2:return i=y4(e[1],t),new Y9(i);case 3:return i=y4(e[1],t),r=y4(e[2],t),new Y9(i,r);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,t){const i=this.key.evaluate(e,t);return this.obj?this.obj.evaluate(e,t)[i]:null==e?void 0:e.values[i]}}class Z9{constructor(e,t){this.key=e,this.obj=t,this.type=S9}static parse(e,t){let i,r;switch(e.length){case 2:return i=y4(e[1],t),new Z9(i);case 3:return i=y4(e[1],t),r=y4(e[2],t),new Z9(i,r);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,t){const i=this.key.evaluate(e,t);return this.obj?i in this.obj.evaluate(e,t):!(null==e||!e.values[i])}}class Q9{constructor(e,t){this.key=e,this.vals=t,this.type=S9}static parse(e,t){if(3!==e.length)throw new Error('"in" expects 2 arguments');return new Q9(y4(e[1],t),y4(e[2],t))}evaluate(e,t){const i=this.key.evaluate(e,t);return-1!==this.vals.evaluate(e,t).indexOf(i)}}class e4{constructor(e,t,i){this.item=e,this.array=t,this.from=i,this.type=_9}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const i=y4(e[1],t),r=y4(e[2],t);if(4===e.length){const s=y4(e[3],t,_9);return new e4(i,r,s)}return new e4(i,r)}evaluate(e,t){const i=this.item.evaluate(e,t),r=this.array.evaluate(e,t);if(this.from){const s=this.from.evaluate(e,t);if(s!==Math.floor(s))throw new Error('"index-of" index must be an integer');return r.indexOf(i,s)}return r.indexOf(i)}}class t4{constructor(e){this.arg=e,this.type=_9}static parse(e,t){if(2!==e.length)throw new Error('"length" expects 2 arguments');const i=y4(e[1],t);return new t4(i)}evaluate(e,t){const i=this.arg.evaluate(e,t);if("string"==typeof i)return i.length;if(Array.isArray(i))return i.length;throw new Error('"length" expects string or array')}}class i4{constructor(e,t,i,r){this.type=e,this.array=t,this.from=i,this.to=r}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const i=y4(e[1],t),r=y4(e[2],t,_9);if(r.type!==_9)throw new Error('"slice" index must return a number');if(4===e.length){const s=y4(e[3],t,_9);if(s.type!==_9)throw new Error('"slice" index must return a number');return new i4(i.type,i,r,s)}return new i4(i.type,i,r)}evaluate(e,t){const i=this.array.evaluate(e,t);if(!Array.isArray(i)&&"string"!=typeof i)throw new Error('"slice" input must be an array or a string');const r=this.from.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"slice" index out of bounds');if(r!==Math.floor(r))throw new Error('"slice" index must be an integer');if(this.to){const s=this.to.evaluate(e,t);if(s<0||s>=i.length)throw new Error('"slice" index out of bounds');if(s!==Math.floor(s))throw new Error('"slice" index must be an integer');return i.slice(r,s)}return i.slice(r)}}class r4{constructor(){this.type=S9}static parse(e){if(1!==e.length)throw new Error('"has-id" expects no arguments');return new r4}evaluate(e,t){return e&&void 0!==e.id}}class s4{constructor(e,t){this.args=e,this.calculate=t,this.type=_9}static parse(e,t,i){const r=e.slice(1).map((e=>y4(e,t)));return new s4(r,i)}evaluate(e,t){let i;return this.args&&(i=this.args.map((i=>i.evaluate(e,t)))),this.calculate(i)}}class n4{constructor(e,t){this.args=e,this.calculate=t,this.type=_9}static parse(e,t){const i=e.slice(1).map((e=>y4(e,t)));return new n4(i,n4.ops[e[0]])}evaluate(e,t){let i;return this.args&&(i=this.args.map((i=>i.evaluate(e,t)))),this.calculate(i)}}n4.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])};class o4{constructor(e){this.args=e,this.type=x9}static parse(e,t){return new o4(e.slice(1).map((e=>y4(e,t))))}evaluate(e,t){return this.args.map((i=>i.evaluate(e,t))).join("")}}class a4{constructor(e,t){this.arg=e,this.calculate=t,this.type=x9}static parse(e,t){if(2!==e.length)throw new Error(`${e[0]} expects 1 argument`);const i=y4(e[1],t);return new a4(i,a4.ops[e[0]])}evaluate(e,t){return this.calculate(this.arg.evaluate(e,t))}}a4.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()};class l4{constructor(e){this.args=e,this.type=M9}static parse(e,t){if(4!==e.length)throw new Error('"rgb" expects 3 arguments');const i=e.slice(1).map((e=>y4(e,t)));return new l4(i)}evaluate(e,t){const i=this._validate(this.args[0].evaluate(e,t)),r=this._validate(this.args[1].evaluate(e,t)),s=this._validate(this.args[2].evaluate(e,t));return new Rv({r:i,g:r,b:s})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class h4{constructor(e){this.args=e,this.type=M9}static parse(e,t){if(5!==e.length)throw new Error('"rgba" expects 4 arguments');const i=e.slice(1).map((e=>y4(e,t)));return new h4(i)}evaluate(e,t){const i=this._validate(this.args[0].evaluate(e,t)),r=this._validate(this.args[1].evaluate(e,t)),s=this._validate(this.args[2].evaluate(e,t)),n=this._validateAlpha(this.args[3].evaluate(e,t));return new Rv({r:i,g:r,b:s,a:n})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if("number"!=typeof e||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class c4{constructor(e){this.color=e,this.type=E9(_9,4)}static parse(e,t){if(2!==e.length)throw new Error('"to-rgba" expects 1 argument');const i=y4(e[1],t);return new c4(i)}evaluate(e,t){return new Rv(this.color.evaluate(e,t)).toRgba()}}class u4{constructor(e,t){this.type=e,this.args=t}static parse(e,t){const i=e[0];if(e.length<2)throw new Error(`${i} expects at least one argument`);let r,s=1;if("array"===i){if(e.length>2){switch(e[1]){case"string":r=x9;break;case"number":r=_9;break;case"boolean":r=S9;break;default:throw new Error('"array" type argument must be string, number or boolean')}s++}else r=I9;let t;if(e.length>3){if(t=e[2],null!==t&&("number"!=typeof t||t<0||t!==Math.floor(t)))throw new Error('"array" length argument must be a positive integer literal');s++}r=E9(r,t)}else switch(i){case"string":r=x9;break;case"number":r=_9;break;case"boolean":r=S9;break;case"object":r=T9}const n=[];for(;s<e.length;s++){const i=y4(e[s],t);n.push(i)}return new u4(r,n)}evaluate(e,t){let i;for(const r of this.args){const s=r.evaluate(e,t);if(i=C9(s),O9(i,this.type))return s}throw new Error(`Expected ${P9(this.type)} but got ${P9(i)}`)}}class p4{constructor(e,t){this.type=e,this.args=t}static parse(e,t){const i=e[0],r=p4.types[i];if(r===S9||r===x9){if(2!==e.length)throw new Error(`${i} expects one argument`)}else if(e.length<2)throw new Error(`${i} expects at least one argument`);const s=[];for(let n=1;n<e.length;n++){const i=y4(e[n],t);s.push(i)}return new p4(r,s)}evaluate(e,t){if(this.type===S9)return Boolean(this.args[0].evaluate(e,t));if(this.type===x9)return k9(this.args[0].evaluate(e,t));if(this.type===_9){for(const i of this.args){const r=Number(i.evaluate(e,t));if(!isNaN(r))return r}return null}if(this.type===M9){for(const i of this.args)try{const r=p4.toColor(i.evaluate(e,t));if(r instanceof Rv)return r}catch{}return null}}static toBoolean(e){return Boolean(e)}static toString(e){return k9(e)}static toNumber(e){const t=Number(e);if(isNaN(t))throw new Error(`"${e}" is not a number`);return t}static toColor(e){if(e instanceof Rv)return e;if("string"==typeof e){const t=Rv.fromString(e);if(t)return t;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return Rv.fromArray(e);throw new Error(`"${e}" is not a color`)}}p4.types={"to-boolean":S9,"to-color":M9,"to-number":_9,"to-string":x9};class d4{constructor(e){this.val=e,this.type=C9(e)}static parse(e){if(2!==e.length)throw new Error('"literal" expects 1 argument');return new d4(e[1])}evaluate(e,t){return this.val}}class f4{constructor(e){this.arg=e,this.type=x9}static parse(e,t){if(2!==e.length)throw new Error('"typeof" expects 1 argument');return new f4(y4(e[1],t))}evaluate(e,t){return P9(C9(this.arg.evaluate(e,t)))}}function y4(e,t,i){const r=typeof e;if("string"===r||"boolean"===r||"number"===r||null===e){if(i)switch(i.kind){case"string":"string"!==r&&(e=p4.toString(e));break;case"number":"number"!==r&&(e=p4.toNumber(e));break;case"color":e=p4.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");const s=e[0];if("string"!=typeof s)throw new Error("First element of expression must be a string");const n=g4[s];if(void 0===n)throw new Error(`Invalid expression operator "${s}"`);if(!n)throw new Error(`Unimplemented expression operator "${s}"`);return n.parse(e,t,i)}const g4={array:u4,boolean:u4,collator:null,format:null,image:null,literal:d4,number:u4,"number-format":null,object:u4,string:u4,"to-boolean":p4,"to-color":p4,"to-number":p4,"to-string":p4,typeof:f4,accumulated:null,"feature-state":null,"geometry-type":D9,id:R9,"line-progress":null,properties:F9,at:K9,get:Y9,has:Z9,in:Q9,"index-of":e4,length:t4,slice:i4,"!":z9,"!=":class extends N9{static parse(e,t){return N9.parse(e,t,((e,t)=>e!==t))}},"<":class extends N9{static parse(e,t){return N9.parse(e,t,((e,t)=>e<t))}},"<=":class extends N9{static parse(e,t){return N9.parse(e,t,((e,t)=>e<=t))}},"==":class extends N9{static parse(e,t){return N9.parse(e,t,((e,t)=>e===t))}},">":class extends N9{static parse(e,t){return N9.parse(e,t,((e,t)=>e>t))}},">=":class extends N9{static parse(e,t){return N9.parse(e,t,((e,t)=>e>=t))}},all:V9,any:U9,case:B9,coalesce:q9,match:H9,within:null,interpolate:W9,"interpolate-hcl":W9,"interpolate-lab":W9,step:$9,let:J9,var:X9,concat:o4,downcase:a4,"is-supported-script":null,"resolved-locale":null,upcase:a4,rgb:l4,rgba:h4,"to-rgba":c4,"-":class extends s4{static parse(e,t){switch(e.length){case 2:return s4.parse(e,t,(e=>-e[0]));case 3:return s4.parse(e,t,(e=>e[0]-e[1]));default:throw new Error('"-" expects 1 or 2 arguments')}}},"*":class extends s4{static parse(e,t){return s4.parse(e,t,(e=>{let t=1;for(const i of e)t*=i;return t}))}},"/":class extends s4{static parse(e,t){if(3===e.length)return s4.parse(e,t,(e=>e[0]/e[1]));throw new Error('"/" expects 2 arguments')}},"%":class extends s4{static parse(e,t){if(3===e.length)return s4.parse(e,t,(e=>e[0]%e[1]));throw new Error('"%" expects 2 arguments')}},"^":class extends s4{static parse(e,t){if(3===e.length)return s4.parse(e,t,(e=>e[0]**e[1]));throw new Error('"^" expects 1 or 2 arguments')}},"+":class extends s4{static parse(e,t){return s4.parse(e,t,(e=>{let t=0;for(const i of e)t+=i;return t}))}},abs:n4,acos:n4,asin:n4,atan:n4,ceil:n4,cos:n4,e:n4,floor:n4,ln:n4,ln2:n4,log10:n4,log2:n4,max:n4,min:n4,pi:n4,round:n4,sin:n4,sqrt:n4,tan:n4,zoom:j9,"heatmap-density":null,"has-id":r4,none:G9};class m4{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(mr){return console.log(mr.message),!0}}static createFilter(e){if(!e)return null;this.isLegacyFilter(e)&&(e=this.convertLegacyFilter(e));try{const t=y4(e,null,S9);return new m4(t)}catch(t){return console.log(t.message),null}}static isLegacyFilter(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":return!0;case"any":case"all":for(let t=1;t<e.length;t++)if(!this.isLegacyFilter(e[1]))return!1;return!0;case"none":return!0;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);case"!has":return!0;default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;const t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return m4.convertComparison("==",e[1],e[2]);case"!=":return m4.negate(m4.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return m4.convertComparison(t,e[1],e[2]);case"in":return m4.convertIn(e[1],e.slice(2));case"!in":return m4.negate(m4.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return m4.convertCombining(t,e.slice(1));case"has":return m4.convertHas(e[1]);case"!has":return m4.negate(m4.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,t,i){switch(t){case"$type":return[e,["geometry-type"],i];case"$id":return[e,["id"],i];default:return[e,["get",t],i]}}static convertIn(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}class v4{}v4.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},v4.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},v4.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},v4.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}},v4.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}},v4.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},v4.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},v4.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}},v4.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}},v4.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},v4.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}};class b4{constructor(e,t){let i;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":i=!0;break;case"array":i="number"===e.value;break;default:i=!1}if(null==t&&(t=e.default),Array.isArray(t)&&t.length>0&&g4[t[0]]){const i={number:_9,color:M9,string:x9,boolean:S9,enum:x9};try{const r=y4(t,null,"array"===e.type?E9(i[e.value]||I9,e.length):i[e.type]);this.getValue=this._buildExpression(r,e),this.isDataDriven=!0,r instanceof W9&&r.input instanceof j9&&(this.interpolator=r)}catch(s){console.log(s.message),this.getValue=this._buildSimple(e.default)}return}i&&"interval"===t.type&&(i=!1);const r=t&&t.stops&&t.stops.length>0;if(r)for(const n of t.stops)n[1]=this._validate(n[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(void 0!==t.default&&(t.default=this._validate(t.default,e)),r)switch(t.type){case"identity":this.getValue=this._buildIdentity(t,e);break;case"categorical":this.getValue=this._buildCategorical(t,e);break;default:this.getValue=i?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else r?this.getValue=i?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}_validate(e,t){if("number"===t.type){if(e<t.minimum)return t.minimum;if(e>t.maximum)return t.maximum}else"color"===t.type?e=b4._parseColor(e):"enum"===t.type?"string"==typeof e&&(e=t.values.indexOf(e)):"array"===t.type&&"enum"===t.value?e=e.map((i=>"string"==typeof e?t.values.indexOf(i):i)):"string"===t.type&&(e=k9(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,t){return(i,r)=>{try{const s=e.evaluate(r,i);return void 0===s?t.default:this._validate(s,t)}catch(s){return console.log(s.message),t.default}}}_buildIdentity(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),void 0!==s?this._validate(s,t):void 0!==e.default?e.default:t.default}}_buildCategorical(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),s=this._categorical(s,e.stops),void 0!==s?s:void 0!==e.default?e.default:t.default}}_buildInterval(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),"number"==typeof s?this._interval(s,e.stops):void 0!==e.default?e.default:t.default}}_buildInterpolate(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),"number"==typeof s?this._interpolate(s,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){const i=t.length;for(let r=0;r<i;r++)if(t[r][0]===e)return t[r][1]}_interval(e,t){const i=t.length;let r=0;for(let s=0;s<i&&t[s][0]<=e;s++)r=s;return t[r][1]}_interpolate(e,t,i){let r,s;const n=t.length;for(let o=0;o<n;o++){const i=t[o];if(!(i[0]<=e)){s=i;break}r=i}if(r&&s){const t=s[0]-r[0],n=e-r[0],o=1===i?n/t:(i**n-1)/(i**t-1);if(Array.isArray(r[1])){const e=r[1],t=s[1],i=[];for(let r=0;r<e.length;r++)i.push(b9(e[r],t[r],o));return i}return b9(r[1],s[1],o)}return r?r[1]:s?s[1]:void 0}static _isEmpty(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(e){return Array.isArray(e)?e:("string"==typeof e&&(e=new Rv(e)),e instanceof Rv?this._isEmpty(e)?void 0:Rv.toUnitRGBA(e):e)}}const w4=1e-30,_4=4294967295,x4=512,S4=8,M4=29,T4=8,I4={metrics:{width:15,height:17,left:0,top:-7,advance:14}},E4=0,A4=0,P4=0,C4=1,O4=2,k4=3,L4=4,R4=5,D4=6,F4=5,j4=6,N4=1,z4=2,V4=2,U4=1,G4=2,B4=4,q4=1.05,H4=6,W4=5,$4=6,J4=1.15,X4=2,K4=7,Y4=500,Z4=128,Q4=10;class e6{constructor(e,t,i,r){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=i,this.uid=r,e){case 0:this._layoutDefinition=v4.backgroundLayoutDefinition,this._paintDefinition=v4.backgroundPaintDefinition;break;case 1:this._layoutDefinition=v4.fillLayoutDefinition,this._paintDefinition=v4.fillPaintDefinition;break;case 2:this._layoutDefinition=v4.lineLayoutDefinition,this._paintDefinition=v4.linePaintDefinition;break;case 3:this._layoutDefinition=v4.symbolLayoutDefinition,this._paintDefinition=v4.symbolPaintDefinition;break;case 4:this._layoutDefinition=v4.circleLayoutDefinition,this._paintDefinition=v4.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=m4.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,i){let r;const s=this._layoutProperties[e];return s&&(r=s.getValue(t,i)),void 0===r&&(r=this._layoutDefinition[e].default),r}getPaintValue(e,t,i){let r;const s=this._paintProperties[e];return s&&(r=s.getValue(t,i)),void 0===r&&(r=this._paintDefinition[e].default),r}isPainterDataDriven(){const e=this._paintProperties;if(e)for(const t in e)if(e[t].isDataDriven)return!0;return!1}_parseLayout(e){const t={};for(const i in e){const r=this._layoutDefinition[i];r&&(t[i]=new b4(r,e[i]))}return t}_parsePaint(e){const t={};for(const i in e){const r=this._paintDefinition[i];r&&(t[i]=new b4(r,e[i]))}return t}computeAttributesKey(e,t,i,r){let s=0,n=0;for(const o of t){let e=3;if(!o||o!==r){const t=i[o],{isLayout:r,isOptional:s}=t,n=r?this.getLayoutProperty(o):this.getPaintProperty(o);e=null!=n&&n.interpolator?2:null!=n&&n.isDataDriven?1:s&&!n?3:0}n|=e<<s,s+=2}return n<<3|e}}class t6 extends e6{constructor(e,t,i,r){super(e,t,i,r),this.backgroundMaterial=new F5(this.computeAttributesKey(0,F5.ATTRIBUTES,F5.ATTRIBUTES_INFO))}}class i6 extends e6{constructor(e,t,i,r){super(e,t,i,r);const s=this.getPaintProperty("fill-color"),n=this.getPaintProperty("fill-opacity"),o=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=null==s?void 0:s.isDataDriven,this.hasDataDrivenOpacity=null==n?void 0:n.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||(null==o?void 0:o.isDataDriven);const a=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!a,this.hasDataDrivenOutlineColor=null==a?void 0:a.isDataDriven,this.hasDataDrivenOutline=a?a.isDataDriven:!!s&&s.isDataDriven,this.hasDataDrivenOutline=(a?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new N5(this.computeAttributesKey(1,N5.ATTRIBUTES,N5.ATTRIBUTES_INFO)),this.outlineMaterial=new z5(this.computeAttributesKey(2,this.outlineUsesFillColor?z5.ATTRIBUTES_FILL:z5.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?z5.ATTRIBUTES_INFO_FILL:z5.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}}class r6 extends e6{constructor(e,t,i,r){var s,n,o,a,l,h,c,u,p;super(e,t,i,r);const d=this.getPaintProperty("line-pattern");if(this.lineMaterial=new V5(this.computeAttributesKey(3,V5.ATTRIBUTES,V5.ATTRIBUTES_INFO,d?"line-dasharray":"")),this.hasDataDrivenLine=(null==(s=this.getPaintProperty("line-blur"))?void 0:s.isDataDriven)||(null==(n=this.getPaintProperty("line-color"))?void 0:n.isDataDriven)||(null==(o=this.getPaintProperty("line-gap-width"))?void 0:o.isDataDriven)||(null==(a=this.getPaintProperty("line-offset"))?void 0:a.isDataDriven)||(null==(l=this.getPaintProperty("line-opacity"))?void 0:l.isDataDriven)||(null==(h=this.getPaintProperty("line-pattern"))?void 0:h.isDataDriven)||(null==(c=this.getPaintProperty("line-dasharray"))?void 0:c.isDataDriven)||(null==(u=this.getLayoutProperty("line-cap"))?void 0:u.isDataDriven)||(null==(p=this.getPaintProperty("line-width"))?void 0:p.isDataDriven),this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const e=this.getPaintProperty("line-width");if(!e||"number"==typeof e&&.5*e<1.05){const e=this.getPaintProperty("line-offset");(!e||"number"==typeof e&&0===e)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,t){let i;switch(t){case 0:i="Butt";break;case 1:i="Round";break;case 2:i="Square";break;default:i="Butt"}return`dasharray-[${e.toString()}]-${i}`}}class s6 extends e6{constructor(e,t,i,r){var s,n,o,a,l,h,c,u,p,d,f,y;super(e,t,i,r),this.iconMaterial=new B5(this.computeAttributesKey(4,B5.ATTRIBUTES,B5.ATTRIBUTES_INFO)),this.textMaterial=new q5(this.computeAttributesKey(6,q5.ATTRIBUTES,q5.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=(null==(s=this.getPaintProperty("icon-color"))?void 0:s.isDataDriven)||(null==(n=this.getPaintProperty("icon-halo-blur"))?void 0:n.isDataDriven)||(null==(o=this.getPaintProperty("icon-halo-color"))?void 0:o.isDataDriven)||(null==(a=this.getPaintProperty("icon-halo-width"))?void 0:a.isDataDriven)||(null==(l=this.getPaintProperty("icon-opacity"))?void 0:l.isDataDriven)||(null==(h=this.getLayoutProperty("icon-size"))?void 0:h.isDataDriven),this.hasDataDrivenText=(null==(c=this.getPaintProperty("text-color"))?void 0:c.isDataDriven)||(null==(u=this.getPaintProperty("text-halo-blur"))?void 0:u.isDataDriven)||(null==(p=this.getPaintProperty("text-halo-color"))?void 0:p.isDataDriven)||(null==(d=this.getPaintProperty("text-halo-width"))?void 0:d.isDataDriven)||(null==(f=this.getPaintProperty("text-opacity"))?void 0:f.isDataDriven)||(null==(y=this.getLayoutProperty("text-size"))?void 0:y.isDataDriven)}}class n6 extends e6{constructor(e,t,i,r){super(e,t,i,r),this.circleMaterial=new j5(this.computeAttributesKey(5,j5.ATTRIBUTES,j5.ATTRIBUTES_INFO))}}class o6{constructor(e,t,i){var r,s,n,o,a;let l;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t),this.keepUpright=e.getLayoutValue("icon-keep-upright",t),this.optional=e.getLayoutValue("icon-optional",t),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=i?0:1),l=e.getLayoutProperty("icon-anchor"),null!=(r=l)&&r.isDataDriven?this._anchorProp=l:this.anchor=e.getLayoutValue("icon-anchor",t),l=e.getLayoutProperty("icon-offset"),null!=(s=l)&&s.isDataDriven?this._offsetProp=l:this.offset=e.getLayoutValue("icon-offset",t),l=e.getLayoutProperty("icon-padding"),null!=(n=l)&&n.isDataDriven?this._paddingProp=l:this.padding=e.getLayoutValue("icon-padding",t),l=e.getLayoutProperty("icon-rotate"),null!=(o=l)&&o.isDataDriven?this._rotateProp=l:this.rotate=e.getLayoutValue("icon-rotate",t),l=e.getLayoutProperty("icon-size"),null!=(a=l)&&a.isDataDriven?this._sizeProp=l:this.size=e.getLayoutValue("icon-size",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}}class a6{constructor(e,t,i){var r,s,n,o,a,l,h,c,u,p,d;let f;this.allowOverlap=e.getLayoutValue("text-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t),this.keepUpright=e.getLayoutValue("text-keep-upright",t),this.optional=e.getLayoutValue("text-optional",t),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=i?0:1),f=e.getLayoutProperty("text-anchor"),null!=(r=f)&&r.isDataDriven?this._anchorProp=f:this.anchor=e.getLayoutValue("text-anchor",t),f=e.getLayoutProperty("text-justify"),null!=(s=f)&&s.isDataDriven?this._justifyProp=f:this.justify=e.getLayoutValue("text-justify",t),f=e.getLayoutProperty("text-letter-spacing"),null!=(n=f)&&n.isDataDriven?this._letterSpacingProp=f:this.letterSpacing=e.getLayoutValue("text-letter-spacing",t),f=e.getLayoutProperty("text-line-height"),null!=(o=f)&&o.isDataDriven?this._lineHeightProp=f:this.lineHeight=e.getLayoutValue("text-line-height",t),f=e.getLayoutProperty("text-max-angle"),null!=(a=f)&&a.isDataDriven?this._maxAngleProp=f:this.maxAngle=e.getLayoutValue("text-max-angle",t),f=e.getLayoutProperty("text-max-width"),null!=(l=f)&&l.isDataDriven?this._maxWidthProp=f:this.maxWidth=e.getLayoutValue("text-max-width",t),f=e.getLayoutProperty("text-offset"),null!=(h=f)&&h.isDataDriven?this._offsetProp=f:this.offset=e.getLayoutValue("text-offset",t),f=e.getLayoutProperty("text-padding"),null!=(c=f)&&c.isDataDriven?this._paddingProp=f:this.padding=e.getLayoutValue("text-padding",t),f=e.getLayoutProperty("text-rotate"),null!=(u=f)&&u.isDataDriven?this._rotateProp=f:this.rotate=e.getLayoutValue("text-rotate",t),f=e.getLayoutProperty("text-size"),null!=(p=f)&&p.isDataDriven?this._sizeProp=f:this.size=e.getLayoutValue("text-size",t),f=e.getLayoutProperty("text-writing-mode"),null!=(d=f)&&d.isDataDriven?this._writingModeProp=f:this.writingMode=e.getLayoutValue("text-writing-mode",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}}class l6{constructor(e,t){if(this._style=e,this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,e.layers||(e.layers=[]),this.version=parseFloat(e.version),this.sprite=t?t.spriteUrl:e.sprite,this.glyphs=t?t.glyphsUrl:e.glyphs,this.layers=e.layers.map(((e,t,i)=>this._create(e,t,i))),this.layers){let e;for(let t=0;t<this.layers.length;t++)e=this.layers[t],this._layerByName[e.id.toLowerCase()]=e,this._uidToLayer.set(e.uid,e),0===e.type&&this.backgroundBucketIds.push(e.id)}this._identifyRefLayers()}isPainterDataDriven(e){const t=this._layerByName[e.toLowerCase()];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){const t=this._uidToLayer.get(e);return null!=t?t:null}getStyleLayerIndex(e){const t=this._layerByName[e.toLowerCase()];return t?this.layers.indexOf(t):-1}setStyleLayer(e,t){if(!e||!e.id)return;const i=this._style;null!=t&&t>=this.layers.length&&(t=this.layers.length-1);let r,s=!0;const n=this._layerByName[e.id.toLowerCase()];if(n){const o=this.layers.indexOf(n);t||(t=o),t===o?(s=!1,r=l6._recreateLayer(e,n),this.layers[t]=r,i.layers[t]=e):(this.layers.splice(o,1),i.layers.splice(o,1),r=this._create(e,t,this.layers),this.layers.splice(t,0,r),i.layers.splice(t,0,e))}else r=this._create(e,t,this.layers),!t||t>=this.layers.length?(this.layers.push(r),i.layers.push(e)):(this.layers.splice(t,0,r),i.layers.splice(t,0,e));this._layerByName[e.id.toLowerCase()]=r,this._uidToLayer.set(r.uid,r),s&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const t=this._layerByName[e.toLowerCase()];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){const t=this._layerByName[e.toLowerCase()];if(t){delete this._layerByName[e.toLowerCase()],this._uidToLayer.delete(t.uid);const i=this.layers.indexOf(t);this.layers.splice(i,1),this._style.layers.splice(i,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e.toLowerCase()]}getLayoutProperties(e){const t=this._layerByName[e.toLowerCase()];return t?t.layout:null}getPaintProperties(e){const t=this._layerByName[e.toLowerCase()];return t?t.paint:null}setPaintProperties(e,t){const i=this._layerByName[e.toLowerCase()];if(!i)return;const r={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:i.layout,paint:t},s=l6._recreateLayer(r,i),n=this.layers.indexOf(i);this.layers[n]=s,this._style.layers[n].paint=t,this._layerByName[i.id.toLowerCase()]=s,this._uidToLayer.set(i.uid,s)}setLayoutProperties(e,t){const i=this._layerByName[e.toLowerCase()];if(!i)return;const r={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:t,paint:i.paint},s=l6._recreateLayer(r,i),n=this.layers.indexOf(i);this.layers[n]=s,this._style.layers[n].layout=t,this._layerByName[i.id.toLowerCase()]=s,this._uidToLayer.set(i.uid,s)}setStyleLayerVisibility(e,t){const i=this._layerByName[e.toLowerCase()];if(!i)return;const r=i.layout||{};r.visibility=t;const s={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:r,paint:i.paint},n=l6._recreateLayer(s,i),o=this.layers.indexOf(i);this.layers[o]=n,this._style.layers[o].layout=r,this._layerByName[i.id.toLowerCase()]=n,this._uidToLayer.set(i.uid,n)}getStyleLayerVisibility(e){var t;const i=this._layerByName[e.toLowerCase()];if(!i)return"none";const r=i.layout;return null!=(t=null==r?void 0:r.visibility)?t:"visible"}_recomputeZValues(){const e=this.layers,t=1/(e.length+1);for(let i=0;i<e.length;i++)e[i].z=1-(1+i)*t}_identifyRefLayers(){const e=[],t=[];let i=0;for(const n of this.layers){const o=n.layout;if(1===n.type){var r;const t=n;let s=n.source+"|"+n.sourceLayer;s+=null!=(r="|"+(null==o?void 0:o.visibility))?r:"",s+="|"+n.minzoom,s+="|"+n.maxzoom,s+="|"+JSON.stringify(n.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(s+="|"+i),e.push({key:s,layer:n})}else if(2===n.type){var s;const e=n;let r=n.source+"|"+n.sourceLayer;r+=null!=(s="|"+(null==o?void 0:o.visibility))?s:"",r+="|"+n.minzoom,r+="|"+n.maxzoom,r+="|"+JSON.stringify(n.filter),r+="|"+(void 0!==o?o["line-cap"]:""),r+="|"+(void 0!==o?o["line-join"]:""),e.hasDataDrivenLine&&(r+="|"+i),t.push({key:r,layer:n})}++i}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){let t,i;e.sort(((e,t)=>e.key<t.key?-1:e.key>t.key?1:0));const r=e.length;for(let s=0;s<r;s++){const n=e[s];if(n.key===t)n.layer.refLayerId=i;else if(t=n.key,i=n.layer.id,1===n.layer.type){if(!n.layer.getPaintProperty("fill-outline-color"))for(let o=s+1;o<r;o++){const r=e[o];if(r.key!==t)break;if(r.layer.getPaintProperty("fill-outline-color")){e[s]=r,e[o]=n,i=r.layer.id;break}}}else if(2===n.layer.type){let o=n.layer;for(let a=s+1;a<r;a++){const r=e[a];if(r.key!==t)break;const l=r.layer;(o.canUseThinTessellation&&!l.canUseThinTessellation||!o.canUseThinTessellation&&(l.getPaintProperty("line-pattern")||l.getPaintProperty("line-dasharray")))&&(o=l,e[s]=r,e[a]=n,i=r.layer.id)}}}}_create(e,t,i){const r=1-(1+t)*(1/(i.length+1)),s=this._runningId++;switch(e.type){case"background":return new t6(0,e,r,s);case"fill":return new i6(1,e,r,s);case"line":return new r6(2,e,r,s);case"symbol":return new s6(3,e,r,s);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new n6(4,e,r,s)}throw new Error("Unknown vector tile layer")}static _recreateLayer(e,t){switch(e.type){case"background":return new t6(0,e,t.z,t.uid);case"fill":return new i6(1,e,t.z,t.uid);case"line":return new r6(2,e,t.z,t.uid);case"symbol":return new s6(3,e,t.z,t.uid);case"raster":throw new Error("Unsupported vector tile raster layer");case"circle":return new n6(4,e,t.z,t.uid)}}}let h6=class extends(RV(pU(g5(LV(aU(hU(sz(Mw)))))))){constructor(...e){super(...e),this._spriteSourceMap=new Map,this.currentStyleInfo=null,this.style=null,this.isReference=null,this.operationalLayerType="VectorTileLayer",this.type="vector-tile",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?a({url:e},t):e}destroy(){this._spriteSourceMap.clear()}async prefetchResources(e){await this.loadSpriteSource(h.devicePixelRatio||1,e)}load(e){const t=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},e).catch(st).then((async()=>{if(!this.portalItem||!this.portalItem.id)return;const t=`${this.portalItem.itemUrl}/resources/styles/root.json`;(await $i(t,l(a({},e),{query:{f:"json"}}))).data&&this.read({url:t},E5(this.portalItem))})).catch(st).then((()=>this._loadStyle(e)));return this.addResolvingPromise(t),Promise.resolve(this)}get attributionDataUrl(){const e=this.currentStyleInfo,t=e&&e.serviceUrl&&$t(e.serviceUrl);return t?this._getDefaultAttribution(t.path):null}get capabilities(){const e=this._getPrimarySource();return e?e.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}get fullExtent(){const e=this._getPrimarySource();return e?e.fullExtent:null}get parsedUrl(){return this.serviceUrl?$t(this.serviceUrl):null}get serviceUrl(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null}get spatialReference(){return this.tileInfo&&this.tileInfo.spatialReference||null}get styleUrl(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null}writeStyleUrl(e,t){e&&bi(e)&&(e=`https:${e}`),t.styleUrl=e}get tileIndexType(){const e=this._getPrimarySource();return e?e.type:""}get tileIndexUrl(){const e=this._getPrimarySource();return e?e.tileMapURL:""}get tileInfo(){var e;const t=[];for(const r in this.sourceNameToSource)t.push(this.sourceNameToSource[r]);let i=(null==(e=this._getPrimarySource())?void 0:e.tileInfo)||new J$;if(t.length>1)for(let r=0;r<t.length;r++)C5(i,t[r].tileInfo)&&(i=O5(i,t[r].tileInfo));return i}get tilemapCache(){const e=this._getPrimarySource();return e&&e.capabilities.operations.supportsTileMap?e.tilemapCache:null}get tileServers(){const e=this._getPrimarySource();return e?e.tileServers:[]}readVersion(e,t){return t.version?parseFloat(t.version):parseFloat(t.currentVersion)}get compatibleTileInfo256(){return A5.create256x256CompatibleTileInfo(this.tileInfo)}get compatibleTileInfo512(){return A5.create512x512CompatibleTileInfo(this.tileInfo)}async loadSpriteSource(e=1,t){if(!this._spriteSourceMap.has(e)){const i=c2(),r=new v5(this.styleRepository.sprite,e,i.maxTextureSize,this.currentStyleInfo.spriteFormat);await r.load(t),this._spriteSourceMap.set(e,r)}return Promise.resolve(this._spriteSourceMap.get(e))}async loadStyle(e,t){const i=e||this.style||this.url;if(this._loadingPromise&&"string"==typeof i&&this.url===i&&!rt(this._abortController))return this._loadingPromise;const r=this._abortController;r&&r.abort();const s=et();return this._loadingPromise=new Promise(((e,r)=>{const n={signal:s.signal};this._spriteSourceMap.clear(),this._getSourceAndStyle(i,n).then(e,r),ot(t,(()=>{s.abort()}))})),this._abortController=s,this._loadingPromise}getStyleLayerId(e){return this.styleRepository.getStyleLayerId(e)}getStyleLayerIndex(e){return this.styleRepository.getStyleLayerIndex(e)}getPaintProperties(e){return H(this.styleRepository.getPaintProperties(e))}setPaintProperties(e,t){const i=this.styleRepository.isPainterDataDriven(e);this.styleRepository.setPaintProperties(e,t);const r=this.styleRepository.isPainterDataDriven(e);this.emit("paint-change",{layer:e,paint:t,isDataDriven:i||r})}getStyleLayer(e){return H(this.styleRepository.getStyleLayer(e))}setStyleLayer(e,t){this.styleRepository.setStyleLayer(e,t),this.emit("style-layer-change",{layer:e,index:t})}deleteStyleLayer(e){this.styleRepository.deleteStyleLayer(e),this.emit("delete-style-layer",{layer:e})}getLayoutProperties(e){return H(this.styleRepository.getLayoutProperties(e))}setLayoutProperties(e,t){this.styleRepository.setLayoutProperties(e,t),this.emit("layout-change",{layer:e,layout:t})}setStyleLayerVisibility(e,t){this.styleRepository.setStyleLayerVisibility(e,t),this.emit("style-layer-visibility-change",{layer:e,visibility:t})}getStyleLayerVisibility(e){return this.styleRepository.getStyleLayerVisibility(e)}getTileUrl(e,t,i){let r=this.tileServers[t%this.tileServers.length];return r=r.replace(/\{z\}/gi,e.toString()).replace(/\{y\}/gi,t.toString()).replace(/\{x\}/gi,i.toString()),r}write(e,t){return t&&t.origin&&!this.styleUrl?(t.messages&&t.messages.push(new Be("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,{layer:this})),null):super.write(e,t)}async _getSourceAndStyle(e,t){if(!e)throw new Error("invalid style!");const i=await async function(e,t){const i={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[r,s]="string"==typeof e?[e,null]:[null,e.jsonUrl],n=r?$t(r):null;await M5(i,"esri",e,s,t);const o={layerDefinition:i.validatedSource,url:r,parsedUrl:n,serviceUrl:i.sourceUrl,style:i.style,styleUrl:i.styleUrl,spriteUrl:i.style.sprite&&S5(i.styleBase,i.style.sprite),spriteFormat:i.spriteFormat,glyphsUrl:i.style.glyphs&&S5(i.styleBase,i.style.glyphs),sourceNameToSource:i.sourceNameToSource,primarySourceName:i.primarySourceName};return x5(o.spriteUrl),x5(o.glyphsUrl),o}(e,t);"webp"===i.spriteFormat&&(await function(e){const t={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return new Promise((i=>{const r=new Image;r.onload=()=>{r.onload=r.onerror=null,i(r.width>0&&r.height>0)},r.onerror=()=>{r.onload=r.onerror=null,i(!1)},r.src="data:image/webp;base64,"+t[e]}))}("lossy")||(i.spriteFormat="png")),this._set("currentStyleInfo",a({},i)),"string"==typeof e?(this.url=e,this.style=null):(this.url=null,this.style=e),this._set("sourceNameToSource",i.sourceNameToSource),this._set("primarySourceName",i.primarySourceName),this._set("styleRepository",new l6(i.style,i)),this.read(i.layerDefinition,{origin:"service"}),this.emit("load-style",{})}_getDefaultAttribution(e){const t=e.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i),i=["OpenStreetMap_v2","OpenStreetMap_Daylight_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84","World_Contours_v2"];if(!t)return;const r=t[2]&&t[2].toLowerCase();if(!r)return;const s=t[1]||"";for(const n of i)if(n.toLowerCase().indexOf(r)>-1)return hi(`//static.arcgis.com/attribution/Vector${s}/${n}`)}_getPrimarySource(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null}async _loadStyle(e){return this._loadingPromise?this._loadingPromise:this.loadStyle(null,e)}};Q([ro({readOnly:!0})],h6.prototype,"attributionDataUrl",null),Q([ro({type:["show","hide"]})],h6.prototype,"listMode",void 0),Q([ro({readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"],json:{read:!1}})],h6.prototype,"capabilities",null),Q([ro({readOnly:!0})],h6.prototype,"currentStyleInfo",void 0),Q([ro({json:{read:!1},readOnly:!0,type:Ol})],h6.prototype,"fullExtent",null),Q([ro()],h6.prototype,"style",void 0),Q([ro({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],h6.prototype,"isReference",void 0),Q([ro({type:["VectorTileLayer"]})],h6.prototype,"operationalLayerType",void 0),Q([ro({readOnly:!0})],h6.prototype,"parsedUrl",null),Q([ro({readOnly:!0})],h6.prototype,"serviceUrl",null),Q([ro({type:Aa,readOnly:!0})],h6.prototype,"spatialReference",null),Q([ro({readOnly:!0})],h6.prototype,"styleRepository",void 0),Q([ro({readOnly:!0})],h6.prototype,"sourceNameToSource",void 0),Q([ro({readOnly:!0})],h6.prototype,"primarySourceName",void 0),Q([ro({type:String,readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],h6.prototype,"styleUrl",null),Q([na(["portal-item","web-document"],"styleUrl")],h6.prototype,"writeStyleUrl",null),Q([ro({json:{read:!1},readOnly:!0})],h6.prototype,"tileIndexType",null),Q([ro({json:{read:!1},readOnly:!0})],h6.prototype,"tileIndexUrl",null),Q([ro({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:J$})],h6.prototype,"tileInfo",null),Q([ro({json:{read:!1},readOnly:!0,type:y5})],h6.prototype,"tilemapCache",null),Q([ro({json:{read:!1},readOnly:!0})],h6.prototype,"tileServers",null),Q([ro({json:{read:!1},readOnly:!0,value:"vector-tile"})],h6.prototype,"type",void 0),Q([ro({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],h6.prototype,"url",void 0),Q([ro({readOnly:!0})],h6.prototype,"version",void 0),Q([sa("version",["version","currentVersion"])],h6.prototype,"readVersion",null),Q([ro({readOnly:!0})],h6.prototype,"compatibleTileInfo256",null),Q([ro({readOnly:!0})],h6.prototype,"compatibleTileInfo512",null),h6=Q([Ro("esri.layers.VectorTileLayer")],h6);var c6=h6,u6=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:c6});const p6={light:["streets","gray","topo","terrain","national-geographic","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]};let d6=null;async function f6(e){const t=e.field,i=e.normalizationField,r=e.valueExpression;let s=[];if(r){if(!d6){const{arcadeUtils:e}=await i_();d6=e}s=d6.extractFieldNames(r)}return t&&s.push(t),i&&s.push(i),s}function y6(e,t=p6){for(const i in t)if(t[i].indexOf(e)>-1)return i}function g6(e,t,i=!0){let r=null;return e&&("string"==typeof e?t.includes(e)&&(r=e):r=tb(e)),i?r||"gray":r}class m6{constructor(e){this.name=null,this.label=null,this.description=null,this.supportedBasemaps=null,this.basemapGroups=null,this.schemes=null;const{name:t,label:i,description:r,schemes:s}=e;this.name=t,this.label=i,this.description=r,this.schemes=s;const n=e.basemapGroups||p6;let o=[];if(n)for(const a in n)o=o.concat(n[a]);this.supportedBasemaps=o,this.basemapGroups=n}isBasemapSupported(e){const t=g6(e,this.supportedBasemaps);return!!(t&&this.supportedBasemaps.indexOf(t)>-1)}getRawSchemes(e){const{basemapId:t,basemapTheme:i}=function(e,t,i){let r=null,s=null;if(t&&(r=g6(t,e,!1),r)){const e=y6(r);m(e)&&(s=e)}return!r&&i&&(r="dark"===i?"dark-gray":"gray",s=i),r||s||(r="gray",s="light"),{basemapId:r,basemapTheme:s}}(this.supportedBasemaps,e.basemap,e.basemapTheme);let r=i;if(t){const e=y6(t,this.basemapGroups);m(e)&&(r=e)}let s=e.geometryType;"multipoint"===s?s="point":"mesh"===s&&(s="polygon");return{schemesInfo:H((this.schemes[s]||this.schemes.default)[r]),basemapId:t,basemapTheme:i}}}function v6(e,t){return Math.ceil(function(e){const t=e.width,i=e.height;let r=e.pixelSizeAt(e.toMap(FS(.5*t,.5*i),{exclude:[]}));if(r<=0&&(r=e.pixelSizeAt(e.toMap(FS(.5*t,.95*i),{exclude:[]})),r<=0)){const t=e.camera.position.clone();t.z=0,r=2*e.pixelSizeAt(t)}return r}(t)*LS(DS(e)))}const b6=function(e){const t=e.themeDictionary,i=new Map;for(const r in t){const e=t[r];i.set(r,new m6(e))}return i}({themeDictionary:{default:{name:"default",label:"Default",description:"Default theme for basic visualization of features.",schemes:{point:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,.25],width:"1px"},size:"8px"},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:"1px"},size:"8px"},{color:[255,255,255,1],outline:{color:[51,51,51,.25],width:"1px"},size:"8px"}]},dark:{primary:{color:[255,255,255,1],outline:{color:[92,92,92,.25],width:"1px"},size:"8px"},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:"1px"},size:"8px"},{color:[26,26,26,1],outline:{color:[178,178,178,.25],width:"1px"},size:"8px"}]}},polyline:{light:{primary:{color:[77,77,77,1],width:"2px"},secondary:[{color:[226,119,40,1],width:"2px"},{color:[255,255,255,1],width:"2px"}]},dark:{primary:{color:[255,255,255,1],width:"2px"},secondary:[{color:[226,119,40,1],width:"2px"},{color:[26,26,26,1],width:"2px"}]}},polygon:{light:{primary:{size:"12px",color:[227,139,79,1],outline:{color:[255,255,255,.25],width:"1px"},opacity:.8},secondary:[{size:"12px",color:[128,128,128,1],outline:{color:[255,255,255,.25],width:"1px"},opacity:.8},{size:"12px",color:[255,255,255,1],outline:{color:[128,128,128,.25],width:"1px"},opacity:.8}]},dark:{primary:{size:"12px",color:[227,139,79,1],outline:{color:[92,92,92,.25],width:"1px"},opacity:.8},secondary:[{size:"12px",color:[178,178,178,1],outline:{color:[92,92,92,.25],width:"1px"},opacity:.8},{size:"12px",color:[26,26,26,1],outline:{color:[128,128,128,.25],width:"1px"},opacity:.8}]}}}}}});function w6(e){const t=function(e){const t=e.theme;if(t)return t.getRawSchemes({basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme})}({basemap:e.basemap,geometryType:e.geometryType,basemapTheme:e.basemapTheme,theme:b6.get("default")});if(!t)return;const{schemesInfo:i,basemapId:r,basemapTheme:s}=t;return{primaryScheme:_6(e,i.primary),secondarySchemes:i.secondary.map((t=>_6(e,t))).filter(Boolean),basemapId:r,basemapTheme:s}}function _6(e,t){const i="mesh"!==e.geometryType&&e.worldScale?e.view:null;switch(e.geometryType){case"point":case"multipoint":{const e=t;return function(e,t){return{color:new Rv(e.color),outline:{color:new Rv(e.outline.color),width:e.outline.width},size:t?v6(e.size,t):e.size,opacity:1}}({color:e.color,outline:a({},e.outline),size:e.size},i)}case"polyline":{const e=t;return function(e,t){return{color:new Rv(e.color),width:t?v6(e.width,t):e.width,opacity:1}}({color:e.color,width:e.width},i)}case"polygon":{const e=t;return function(e,t){return{color:new Rv(e.color),outline:{color:new Rv(e.outline.color),width:e.outline.width},size:t?v6(e.size,t):e.size,opacity:e.opacity}}({size:e.size,color:e.color,outline:a({},e.outline),opacity:e.opacity},i)}case"mesh":{const e=t;return function(e){return{color:new Rv(e.color),opacity:e.opacity}}({color:e.color,opacity:e.opacity})}}}Object.freeze({__proto__:null,getThemes:function(e){return function(e,t){const i=[];return e.forEach((e=>{e.isBasemapSupported(t)&&i.push({name:e.name,label:e.label,description:e.description,basemaps:[...e.supportedBasemaps]})})),i}(b6,e)},getSchemes:w6,cloneScheme:function(e){if(!e)return;const t=a({},e);return t.color&&(t.color=new Rv(t.color)),"outline"in t&&t.outline&&(t.outline={color:t.outline.color&&new Rv(t.outline.color),width:t.outline.width}),t}});let x6=class extends(bw(Ko)){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};Q([ro()],x6.prototype,"autoNavigate",void 0),Q([ro()],x6.prototype,"filter",void 0),Q([ro()],x6.prototype,"getResults",void 0),Q([ro()],x6.prototype,"getSuggestions",void 0),Q([ro()],x6.prototype,"maxResults",void 0),Q([ro()],x6.prototype,"maxSuggestions",void 0),Q([ro()],x6.prototype,"minSuggestCharacters",void 0),Q([ro()],x6.prototype,"outFields",void 0),Q([ro()],x6.prototype,"placeholder",void 0),Q([ro()],x6.prototype,"popupEnabled",void 0),Q([ro()],x6.prototype,"popupTemplate",void 0),Q([ro()],x6.prototype,"prefix",void 0),Q([ro()],x6.prototype,"resultGraphicEnabled",void 0),Q([ro()],x6.prototype,"resultSymbol",void 0),Q([ro()],x6.prototype,"suggestionsEnabled",void 0),Q([ro()],x6.prototype,"suffix",void 0),Q([ro()],x6.prototype,"withinViewEnabled",void 0),Q([ro()],x6.prototype,"zoomScale",void 0),x6=Q([Ro("esri.widgets.Search.SearchSource")],x6);var S6=x6;function M6(e,t){const i=t||e.extent,r=e.width,s=VA(i&&i.spatialReference);return i&&r?i.width/r*s*39.37*96:0}function T6(e,t){const i=e.extent,r=e.width,s=function(e,t){return e/(39.37*VA(t)*96)}(t,i.spatialReference);return i.clone().expand(s*r/i.width)}const I6=Ne.getLogger("esri.widgets.Search.support.geometryUtils");function E6(e,t){var i,r;if(!t)return I6.error("missing-parameter: view is missing."),Promise.reject(new Be("searchgeometryutils:missing-parameter","view is missing."));if(!e)return I6.error("missing-parameter: point is missing."),Promise.reject(new Be("searchgeometryutils:missing-parameter","point is missing."));if(e.hasZ||"2d"===t.type)return Promise.resolve(e);const s=null==t||null==(i=t.map)?void 0:i.ground;return s&&s.layers.length?s.queryElevation(e,{cache:null==(r=t.basemapTerrain)?void 0:r.elevationQueryCache}).then((e=>e.geometry)):Promise.resolve(e)}function A6(e){if(v(e))return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":return e.getPoint(0);case"polyline":return e.getPoint(0,0)}return null}function P6(e,t,i){return v(e)?null:"extent"===e.type?e:"multipoint"===e.type||"polygon"===e.type||"polyline"===e.type?e.extent:"point"===e.type?O6(e,t,i):void 0}function C6(e,t,i){return v(e)||v(t)?null:O6(e.center,t,i)}function O6(e,t,i){const r=e.hasZ?e.z:void 0;return t&&t.map?(i?T6(t,i):t.extent).clone().centerAt(e).set({zmax:r,zmin:r}):new Ol({xmin:e.x-.25,ymin:e.y-.25,xmax:e.x+.25,ymax:e.y+.25,spatialReference:e.spatialReference,zmin:r,zmax:r})}const k6=/https?:\/\/services.*\.arcgis\.com/i,L6=/(?:\{([^}]+)\})/g,R6=Ne.getLogger("esri.widgets.Search.support.layerSearchUtils");function D6(e,t){const{exactMatch:i=!1,location:r,maxResults:s,spatialReference:n,source:o,sourceIndex:a,suggestResult:l,view:h}=e,{layer:c,filter:u,zoomScale:p}=o,d=h&&h.scale,f=j6(o,h),y=t&&t.signal;return z6(c).then((()=>{const e=c.popupTemplate;return e?e.getRequiredFields(c.fieldsIndex):null})).then((e=>{var t,g;const{objectIdField:v,returnZ:b}=c,w=U6(o);if(!B6(c,w))throw R6.error("invalid-field: displayField is invalid."),new Be("getResults():invalid-field","displayField is invalid.");const _=e&&e.length?e:[w],x=o.outFields||_,S=N6(x);if(-1!==x.indexOf(v)||S||x.push(v),!S&&!G6(c,x))throw R6.error("invalid-field: outField is invalid."),new Be("getResults():invalid-field","outField is invalid.");const M=c.createQuery(),{orderByFields:T}=o;if(T&&(M.orderByFields=T),n){M.outSpatialReference=n;const e=1/VA(n);e&&(M.maxAllowableOffset=e)}const I="mesh"===c.geometryType||"multipatch"===c.geometryType,E=(null==(t=c.capabilities)||null==(g=t.data)?void 0:g.supportsZ)&&!I;if(M.returnZ=E&&!1!==b,M.returnGeometry=!0,M.multipatchOption=I?"xyFootprint":null,x&&(M.outFields=x),r)M.geometry=r;else if(l.key)M.objectIds=[l.key];else{const e=o.searchFields||[w];if(!G6(c,e))throw R6.error("invalid-field: search field is invalid."),new Be("getResults():invalid-field","search field is invalid.");if(V6(c)&&(M.num=s),f&&(M.geometry=f),!l.text.trim())return[];const{prefix:t="",suffix:r=""}=o,n=W6(q6(`${t}${l.text}${r}`),c,e,u,i);if(!n)return[];M.where=n}return c.queryFeatures(M,{signal:y}).then((e=>function(e,t,i,r,s,n,o){return e.features.map((e=>function(e,t,i,r,s,n,o){const a=e.clone(),l=e.sourceLayer,h=l&&l.objectIdField,c=h&&e.attributes[h],u=$6(e,i.searchTemplate,s),p=P6(a.geometry,t,n),d="number"==typeof o?C6(H(p),t,o):p,f=e.clone();return m(d)&&(f.geometry=rw.fromExtent(d)),{extent:d,target:f,feature:a,key:c,name:u,sourceIndex:r}}(e,t,i,r,s,n,o)))}(e,h,o,a,w,d,p)))}))}function F6(e,t){const{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=e,{layer:l,filter:h}=i,c=t&&t.signal,u=j6(i,s);return z6(l).then((()=>{if(!V6(l))return[];const e=U6(i),t=i.searchFields||[e],s=[];i.suggestionTemplate?i.suggestionTemplate.replace(L6,((e,t)=>(s.push(t),e))):s.push(e);const p=N6(s);-1!==s.indexOf(l.objectIdField)||p||s.push(l.objectIdField);const d=B6(l,e),f=p||G6(l,s),y=G6(l,t);if(!d)throw R6.error("invalid-field: displayField is invalid."),new Be("getSuggestions():invalid-field","displayField is invalid.");if(!f)throw R6.error("invalid-field: outField is invalid."),new Be("getSuggestions():invalid-field","outField is invalid.");if(!y)throw R6.error("invalid-field: search field is invalid."),new Be("getSuggestions():invalid-field","search field is invalid.");const g=l.createQuery(),{orderByFields:m}=i;if(m&&(g.orderByFields=m),g.outSpatialReference=r,g.returnGeometry=!1,g.num=o,g.outFields=s,u&&(g.geometry=u),!n.trim())return[];const{prefix:v="",suffix:b=""}=i,w=W6(q6(`${v}${n}${b}`),l,t,h,!1);return w?(g.where=w,l.queryFeatures(g,{signal:c}).then((t=>function(e,t,i,r){return e.features.map((e=>function(e,t,i,r){const s=e.sourceLayer,{attributes:n}=e,{objectIdField:o}=s,a=n[o];return{text:$6(e,t.suggestionTemplate,r),key:a,sourceIndex:i}}(e,t,i,r)))}(t,i,a,e)))):[]}))}function j6(e,t){const{filter:i,withinViewEnabled:r}=e,s=t&&t.extent;return i&&i.geometry||(r&&s?s:void 0)}function N6(e){return e&&-1!==e.indexOf("*")}async function z6(e){e&&await e.load()}function V6(e){var t,i,r;return null!=(t=null==e||null==(i=e.capabilities)||null==(r=i.query)?void 0:r.supportsPagination)&&t}function U6(e){return e.displayField||e.layer.displayField||function(e){var t,i,r,s;return null!=(t=null==e||null==(i=e.fieldsIndex)||null==(r=i.fields)||null==(s=r.find((e=>"string"===e.type)))?void 0:s.name)?t:""}(e.layer)}function G6(e,t){return!(!e||!t)&&t.every((t=>B6(e,t)))}function B6(e,t){return!!e.getField(t)}function q6(e){return e.replace(/\'/g,"''")}function H6(e,t){const i=t&&t.where;return i?`(${e}) AND (${i})`:e}function W6(e,t,i,r,s){const{definitionExpression:n}=t;let o="";if(e){const n=k6.test(t.url)&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(e)?"N":"";i&&i.forEach((i=>{const a=t.getField(i),l="function"==typeof t.getFieldDomain&&t.getFieldDomain(i),h=(l&&"coded-value"===l.type?function(e,t,i){let r=null;const{codedValues:s}=e;return s&&s.some((e=>{const s=e.name,n=i?s:s.toLowerCase();return(i?t:t.toLowerCase())===n&&(r=e.code.toString(),!0)})),r}(l,e,s):null)||e||null;if(null!==h){const e=function(e,t,i,r,s){const n=t.type,o=t.name;if("string"===n||"date"===n||"global-id"===n)return H6(s?`${o} = ${i}'${e}'`:`UPPER(${o}) LIKE ${i}'%${e.toUpperCase()}%'`,r);if("oid"===n||"small-integer"===n||"integer"===n||"single"===n||"double"===n){const t=Number(e);return isNaN(t)?null:H6(`${o} = ${t}`,r)}return H6(`${o} = ${e}`,r)}(h,a,n,r,s);e&&(o+=function(e,t){return e?` OR (${t})`:`(${t})`}(o,e))}}))}return n?`(${n}) AND (${o})`:o}function $6(e,t,i){const r=e.sourceLayer,{attributes:s}=e,n="function"==typeof r.getFieldDomain&&r.getFieldDomain(i);if(t)return Ve(t,s);if(i&&s){const e=r.getField(i),t=function(e,t){return e[Object.keys(e).find((e=>e.toLowerCase()===t.toLowerCase()))]}(s,i);return null==t?"":n&&"coded-value"===n.type?function(e,t){let i=null;const{codedValues:r}=e;return r&&r.length&&r.some((e=>e.code===t&&(i=e.name,!0))),i}(n,t):"date"===(null==e?void 0:e.type)?Te(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}return""}var J6;let X6=J6=class extends S6{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>D6(a({source:this},e),t),this.getSuggestions=(e,t)=>F6(a({source:this},e),t)}set layer(e){this._set("layer",e),e&&e.load().catch((()=>{}))}get name(){return this._getLayerTitle()||""}set name(e){void 0!==e?this._override("name",e):this._clearOverride("name")}clone(){return new J6({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?H(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?H(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var e,t;return null!=(e=null==(t=this.layer.fieldsIndex.fields.find((e=>"string"===e.type)))?void 0:t.name)?e:""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map((t=>{const i=e.getField(t);return i&&i.alias||t})).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};Q([ro({json:{read:{source:"field.name"},write:{target:"field.name"}}})],X6.prototype,"displayField",void 0),Q([ro({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],X6.prototype,"exactMatch",void 0),Q([ro({value:null})],X6.prototype,"layer",null),Q([ro()],X6.prototype,"name",null),Q([ro({type:[String],json:{write:!0}})],X6.prototype,"orderByFields",void 0),Q([ro()],X6.prototype,"searchFields",void 0),Q([ro()],X6.prototype,"searchTemplate",void 0),Q([ro()],X6.prototype,"suggestionTemplate",void 0),X6=J6=Q([Ro("esri.widgets.Search.LayerSearchSource")],X6);var K6=X6;let Y6=class extends Ko{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};Q([ro({type:String,json:{write:!0}})],Y6.prototype,"address",void 0),Q([ro({type:Object,json:{write:!0}})],Y6.prototype,"attributes",void 0),Q([ro({type:Ol,json:{write:!0}})],Y6.prototype,"extent",void 0),Q([ro({type:il,json:{write:!0}})],Y6.prototype,"location",void 0),Q([ro({type:Number,json:{write:!0}})],Y6.prototype,"score",void 0),Y6=Q([Ro("esri.rest.support.AddressCandidate")],Y6);var Z6=Y6;const Q6={type:String,json:{read:{source:"token"},write:{target:"token"}}};let e7=class extends Ko{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};Q([ro({type:Object,json:{write:!0}})],e7.prototype,"address",void 0),Q([ro(Q6)],e7.prototype,"apiKey",void 0),Q([ro({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],e7.prototype,"categories",void 0),Q([ro({type:String,json:{write:!0}})],e7.prototype,"countryCode",void 0),Q([ro({type:Boolean,json:{write:!0}})],e7.prototype,"forStorage",void 0),Q([ro({type:il,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],e7.prototype,"location",void 0),Q([ro({type:String,json:{write:!0}})],e7.prototype,"locationType",void 0),Q([ro({type:String,json:{write:!0}})],e7.prototype,"magicKey",void 0),Q([ro({type:Number,json:{write:!0}})],e7.prototype,"maxLocations",void 0),Q([ro({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],e7.prototype,"outFields",void 0),Q([ro({type:Aa,json:{read:{source:"outSR"},write:{target:"outSR"}}})],e7.prototype,"outSpatialReference",void 0),Q([ro({type:Ol,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=i}}}})],e7.prototype,"searchExtent",void 0),e7=Q([Ro("esri.rest.support.AddressToLocationsParameters")],e7),e7.from=qn(e7);var t7=e7;async function i7(e,t,i){t=t7.from(t);const o=sk(e),h=t.toJSON(),{address:c}=h,u=((e,t)=>{var i={};for(var o in e)s.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&r)for(var o of r(e))t.indexOf(o)<0&&n.call(e,o)&&(i[o]=e[o]);return i})(h,["address"]),p=l(a(a({},c),u),{f:"json"}),d=rk(nk(a(a({},o.query),p)),i);return $i(`${o.path}/findAddressCandidates`,d).then(r7)}function r7({data:e}){if(!e)return[];const{candidates:t,spatialReference:i}=e;return t?t.map((e=>{if(!e)return;const{extent:t,location:r}=e,s=!t||function(e){return e&&"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax}(t);return function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y}(r)&&s?(t&&(t.spatialReference=i),r.spatialReference=i,Z6.fromJSON(e)):void 0})):[]}let s7=class extends Ko{constructor(e){super(e),this.addresses=null,this.categories=null,this.countryCode=null,this.locationType=null,this.outSpatialReference=null}};Q([ro({type:[Object],json:{read:{reader:e=>e&&e.records?e.records.map((e=>e.attributes)):null},write:{writer:(e,t)=>{const i=[];Array.isArray(e)&&e.forEach((e=>{i.push({attributes:e})})),t.addresses={records:i}}}}})],s7.prototype,"addresses",void 0),Q([ro({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],s7.prototype,"categories",void 0),Q([ro({type:String,json:{read:{source:"sourceCountry"},write:{target:"sourceCountry"}}})],s7.prototype,"countryCode",void 0),Q([ro({type:String,json:{write:!0}})],s7.prototype,"locationType",void 0),Q([ro({type:Aa,json:{read:{source:"outSR"},write:{target:"outSR"}}})],s7.prototype,"outSpatialReference",void 0),s7=Q([Ro("esri.rest.support.AddressesToLocationsParameters")],s7),s7.from=qn(s7);var n7=s7;function o7(e){const{data:t}=e;if(!t)return[];const{locations:i,spatialReference:r}=t;return i?i.map((e=>{const{location:t}=e;return t&&(t.spatialReference=r),Z6.fromJSON(e)})):[]}let a7=class extends Ko{constructor(e){super(e),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};Q([ro(Q6)],a7.prototype,"apiKey",void 0),Q([ro({type:il,json:{write:{writer:(e,t)=>{const i=e?e.clone().normalize():null,r=void 0!==i;t.location=r?i:null}}}})],a7.prototype,"location",void 0),Q([ro({type:String,json:{write:!0}})],a7.prototype,"locationType",void 0),Q([ro({type:Aa,json:{read:{source:"outSR"},write:{target:"outSR"}}})],a7.prototype,"outSpatialReference",void 0),a7=Q([Ro("esri.rest.support.LocationToAddressParameters")],a7),a7.from=qn(a7);var l7=a7;function h7({data:e}){if(!e)return;const{address:t,location:i}=e,r=t&&t.Match_addr||"";return Z6.fromJSON({address:r,attributes:t||{},location:i,score:100})}let c7=class extends Ko{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};Q([ro({type:Boolean,json:{write:!0}})],c7.prototype,"isCollection",void 0),Q([ro({type:String,json:{write:!0}})],c7.prototype,"magicKey",void 0),Q([ro({type:String,json:{write:!0}})],c7.prototype,"text",void 0),c7=Q([Ro("esri.rest.support.SuggestionCandidate")],c7);var u7=c7;let p7=class extends Ko{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};Q([ro(Q6)],p7.prototype,"apiKey",void 0),Q([ro({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],p7.prototype,"categories",void 0),Q([ro({type:String,json:{write:!0}})],p7.prototype,"countryCode",void 0),Q([ro({type:il,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],p7.prototype,"location",void 0),Q([ro({type:Number,json:{write:!0}})],p7.prototype,"maxSuggestions",void 0),Q([ro({type:Aa,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p7.prototype,"outSpatialReference",void 0),Q([ro({type:Ol,json:{write:{writer:(e,t)=>{const i=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(i)}}}})],p7.prototype,"searchExtent",void 0),Q([ro({type:String,json:{write:!0}})],p7.prototype,"text",void 0),p7=Q([Ro("esri.rest.support.SuggestLocationsParameters")],p7),p7.from=qn(p7);var d7=p7;function f7(e){const{data:t}=e;if(!t)return[];const{suggestions:i}=t;return i?i.map((e=>new u7(e))):[]}let y7=class extends $R{constructor(e){super(e),this.outSpatialReference=null,this.url=null}addressToLocations(e,t){!e.outSpatialReference&&this.outSpatialReference&&(e.outSpatialReference=this.outSpatialReference);const i=a(a({},this.requestOptions),t);return i7(this.url,e,i)}suggestLocations(e,t){const i=a(a({},this.requestOptions),t);return async function(e,t,i){const r=sk(e),s=l(a({},(t=d7.from(t)).toJSON()),{f:"json"}),n=rk(nk(a(a({},r.query),s)),i);return $i(`${r.path}/suggest`,n).then(f7)}(this.url,e,i)}addressesToLocations(e,t){!e.outSpatialReference&&this.outSpatialReference&&(e.outSpatialReference=this.outSpatialReference);const i=a(a({},this.requestOptions),t);return async function(e,t,i){t=n7.from(t);const r=sk(e),s=l(a({},t.toJSON()),{f:"json"}),n=rk(nk(a(a({},r.query),s)),i);return $i(`${r.path}/geocodeAddresses`,n).then(o7)}(this.url,e,i)}locationToAddress(e,t){!e.outSpatialReference&&this.outSpatialReference&&(e.outSpatialReference=this.outSpatialReference);const i=a(a({},this.requestOptions),t);return async function(e,t,i){t=l7.from(t);const r=sk(e),s=l(a({},t.toJSON()),{f:"json"}),n=rk(nk(a(a({},r.query),s)),i);return $i(`${r.path}/reverseGeocode`,n).then(h7)}(this.url,e,i)}};Q([ro({type:Aa})],y7.prototype,"outSpatialReference",void 0),Q([ro()],y7.prototype,"url",void 0),y7=Q([Ro("esri.tasks.Locator")],y7);var g7=y7;const m7="Single Line Input";function v7(e,t){return e.location?function(e,t){const{source:i,spatialReference:r,location:s,sourceIndex:n,view:o}=e,{apiKey:a,locator:l,zoomScale:h,defaultZoomScale:c}=i,u=o&&o.scale,p=t&&t.signal,d=new l7;return d.location=s,a&&(d.apiKey=a),r&&(d.outSpatialReference=r),l.locationToAddress(d,{signal:p}).then((e=>S7([e],{sourceIndex:n,scale:u,view:o,zoomScale:h,defaultZoomScale:c})))}(e,t):function(e,t){const{source:i,suggestResult:r,spatialReference:s,view:n,maxResults:o,sourceIndex:a}=e,l=i&&i.zoomScale,h=i&&i.defaultZoomScale;if(!r.text.trim())return Promise.resolve(null);const c=!r.key&&i.prefix?i.prefix:"",u=!r.key&&i.suffix?i.suffix:"",p=`${c}${r.text}${u}`,d=new t7,{apiKey:f,locator:y}=i,g=n&&n.scale,m=x7(i,n),v=t&&t.signal;if(f&&(d.apiKey=f),!y)return Promise.resolve(null);i.categories&&(d.categories=i.categories),i.locationType&&(d.locationType=i.locationType),s&&(d.outSpatialReference=s);const b=b7(n);b&&(d.location=b),d.maxLocations=o,m&&(d.searchExtent=m),i.countryCode&&(d.countryCode=i.countryCode);const{key:w}=r,_=`${w}`;return w&&(d.magicKey=_),d.address={},d.address[i.singleLineFieldName||m7]=p,i.outFields&&(d.outFields=i.outFields),y.addressToLocations(d,{signal:v}).then((e=>S7(e,{key:_,scale:g,sourceIndex:a,view:n,zoomScale:l,defaultZoomScale:h})))}(e,t)}function b7(e){const t=null==e?void 0:e.scale;return"number"==typeof t&&t<=3e5?e.get("extent.center"):null}function w7(e,t){const{source:i,spatialReference:r,view:s,suggestTerm:n,maxSuggestions:o,sourceIndex:a}=e,l=new d7,{apiKey:h,locator:c}=i,u=x7(i,s),p=t&&t.signal;if(!c)return Promise.resolve(null);h&&(l.apiKey=h),i.categories&&(l.categories=i.categories),r&&(l.outSpatialReference=r);const d=b7(s);if(d&&(l.location=d),!n.trim())return Promise.resolve(null);const{prefix:f="",suffix:y=""}=i,g=`${f}${n}${y}`;return l.text=g,u&&(l.searchExtent=u),l.maxSuggestions=o,i.countryCode&&(l.countryCode=i.countryCode),c.suggestLocations(l,{signal:p}).then((e=>function(e,t){return e.map((e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t)))}(e,a)))}function _7(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}function x7(e,t){const{filter:i,withinViewEnabled:r}=e,s=t&&t.scale,n=t&&t.extent;return P6(i&&i.geometry,t,s)||(r&&n?n:void 0)}function S7(e,t){return e.map((e=>function(e,t){const{key:i,scale:r,sourceIndex:s,view:n,zoomScale:o,defaultZoomScale:a}=t,{attributes:l,extent:h,location:c,address:u}=e,p=new fE({geometry:c,attributes:l}),d=h||c,f=P6(d,n,r),y="number"==typeof o?C6(f,n,o):"number"==typeof a&&"point"===d.type?C6(f,n,a):f,g=c?`${c.x},${c.y}`:"",v=u||g,b=p.clone();return m(y)&&(b.geometry=rw.fromExtent(y)),{extent:y,feature:p,target:b,key:i,name:v,sourceIndex:s}}(e,t)))}var M7;let T7=M7=class extends S6{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.locator=null,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.zoomScale=null,this.getResults=(e,t)=>v7(a({source:this},e),t),this.getSuggestions=(e,t)=>w7(a({source:this},e),t)}readLocator(e,t){const{url:i}=t;return i?new g7({url:i}):null}writeLocator(e,t){t.url=e?e.url:null}clone(){return new M7({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?H(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?H(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};Q([ro()],T7.prototype,"apiKey",void 0),Q([ro()],T7.prototype,"categories",void 0),Q([ro()],T7.prototype,"countryCode",void 0),Q([ro({json:{write:!0}})],T7.prototype,"defaultZoomScale",void 0),Q([ro({type:g7})],T7.prototype,"locator",void 0),Q([sa("locator",["url"])],T7.prototype,"readLocator",null),Q([na("locator")],T7.prototype,"writeLocator",null),Q([ro()],T7.prototype,"locationType",void 0),Q([ro({json:{write:!0}})],T7.prototype,"name",void 0),Q([ro({json:{write:!0}})],T7.prototype,"placeholder",void 0),Q([ro()],T7.prototype,"searchTemplate",void 0),Q([ro({json:{write:!0}})],T7.prototype,"singleLineFieldName",void 0),Q([ro({json:{read:{source:"suggest"},write:{target:"suggest"}}})],T7.prototype,"suggestionsEnabled",void 0),Q([ro({json:{write:!0}})],T7.prototype,"zoomScale",void 0),T7=M7=Q([Ro("esri.widgets.Search.LocatorSearchSource")],T7);var I7=T7;const E7=new ee({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});let A7=class extends Ko{constructor(e){super(e),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};Q([ro({type:String,json:{write:!0}})],A7.prototype,"deviationUnit",void 0),Q([ro({json:{read:{reader:e=>e?e.map((e=>dw(e))):null},write:{writer:(e,t)=>{t.geometries=e.map((e=>e.toJSON()))}}}})],A7.prototype,"geometries",void 0),Q([ro({type:Number,json:{write:!0}})],A7.prototype,"maxDeviation",void 0),A7=Q([Ro("esri.rest.support.GeneralizeParameters")],A7),A7.from=qn(A7);var P7=A7;const C7=new ee({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});function O7(e){const{geometries:t,deviationUnit:i,maxDeviation:r}=e.toJSON(),s={maxDeviation:r};return t&&t.length&&(s.geometries=JSON.stringify({geometryType:fw(t[0]),geometries:t}),s.sr=JSON.stringify(t[0].spatialReference)),C7.write(i,s,"deviationUnit"),s}let k7=class extends Ko{constructor(e){super(e),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};Q([ro({type:String,json:{write:!0}})],k7.prototype,"calculationType",void 0),Q([ro({type:Boolean,json:{write:!0}})],k7.prototype,"geodesic",void 0),Q([ro({json:{write:!0}})],k7.prototype,"lengthUnit",void 0),Q([ro({type:[nw],json:{read:{reader:e=>e?e.map((e=>dw(e))):null},write:{writer:(e,t)=>{t.polylines=e.map((e=>e.toJSON()))}}}})],k7.prototype,"polylines",void 0),k7=Q([Ro("esri.rest.support.LengthsParameters")],k7),k7.from=qn(k7);var L7=k7;const R7=new ee({preserveShape:"preserve-shape"});function D7(e){const{polylines:t,lengthUnit:i,geodesic:r,calculationType:s}=e.toJSON(),n={};n.polylines=JSON.stringify(t);const o=e.polylines[0].spatialReference;return n.sr=o.wkid?o.wkid:JSON.stringify(o.toJSON()),i&&(n.lengthUnit=i),r&&(n.geodesic=r),s&&(n.calculationType=R7.toJSON(s)),n}let F7=class extends Ko{constructor(e){super(e),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};Q([ro({type:Number,json:{write:!0}})],F7.prototype,"bevelRatio",void 0),Q([ro({json:{read:{reader:e=>e?e.map((e=>dw(e))):null},write:{writer:(e,t)=>{t.geometries=e.map((e=>e.toJSON()))}}}})],F7.prototype,"geometries",void 0),Q([ro({type:Number,json:{write:!0}})],F7.prototype,"offsetDistance",void 0),Q([ro({type:String,json:{write:!0}})],F7.prototype,"offsetHow",void 0),Q([ro({type:String,json:{write:!0}})],F7.prototype,"offsetUnit",void 0),F7=Q([Ro("esri.rest.support.OffsetParameters")],F7),F7.from=qn(F7);var j7=F7;const N7=new ee({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),z7=new ee({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});function V7(e){const{geometries:t,bevelRatio:i,offsetDistance:r,offsetHow:s,offsetUnit:n}=e.toJSON(),o={bevelRatio:i,offsetDistance:r};return t&&t.length&&(o.geometries=JSON.stringify({geometryType:fw(t[0]),geometries:t}),o.sr=JSON.stringify(t[0].spatialReference)),s&&(o.offsetHow=N7.toJSON(s)),n&&(o.offsetUnit=z7.toJSON(n)),o}function U7(e){return{geometryType:fw(e[0]),geometries:e.map((e=>e.toJSON()))}}function G7(e,t,i){const r=gw(t);return e.map((e=>{const t=r.fromJSON(e);return t.spatialReference=i,t}))}let B7=class extends Ko{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((function(e){return e.toJSON()})),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:fw(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(i.transformForward=this.transformForward),i}};Q([ro()],B7.prototype,"geometries",void 0),Q([ro({json:{read:{source:"outSR"}}})],B7.prototype,"outSpatialReference",void 0),Q([ro()],B7.prototype,"transformation",void 0),Q([ro()],B7.prototype,"transformForward",void 0),B7=Q([Ro("esri.rest.support.ProjectParameters")],B7);var q7=B7;const H7=qn(q7);async function W7(e,t,i){t=H7(t);const r=sk(e),s=a(l(a({},r.query),{f:"json"}),t.toJSON()),n=t.outSpatialReference,o=fw(t.geometries[0]),h=rk(s,i);return $i(r.path+"/project",h).then((({data:{geometries:e}})=>G7(e,o,n)))}let $7=class extends Ko{constructor(e){super(e),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};Q([ro({json:{read:{reader:e=>e?e.map((e=>dw(e))):null},write:{writer:(e,t)=>{t.geometries1=e.map((e=>e.toJSON()))}}}})],$7.prototype,"geometries1",void 0),Q([ro({json:{read:{reader:e=>e?e.map((e=>dw(e))):null},write:{writer:(e,t)=>{t.geometries2=e.map((e=>e.toJSON()))}}}})],$7.prototype,"geometries2",void 0),Q([ro({type:String,json:{write:!0}})],$7.prototype,"relation",void 0),Q([ro({type:String,json:{write:!0}})],$7.prototype,"relationParameter",void 0),$7=Q([Ro("esri.rest.support.RelationParameters")],$7),$7.from=qn($7);var J7=$7;const X7=new ee({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});function K7(e){const{geometries1:t,geometries2:i,relation:r,relationParameter:s}=e.toJSON(),n={};if(t&&t.length){n.geometries1=JSON.stringify({geometryType:fw(t[0]),geometries:t});const e=t[0].spatialReference;n.sr=e.wkid?e.wkid:JSON.stringify(e)}return i&&i.length>0&&(n.geometries2=JSON.stringify({geometryType:fw(i[0]),geometries:i})),r&&(n.relation=X7.toJSON(r)),s&&(n.relationParam=s),n}let Y7=class extends Ko{constructor(e){super(e),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};Q([ro({type:String,json:{write:!0}})],Y7.prototype,"extendHow",void 0),Q([ro({type:[nw],json:{read:{reader:e=>e?e.map((e=>dw(e))):null},write:{writer:(e,t)=>{t.polylines=e.map((e=>e.toJSON()))}}}})],Y7.prototype,"polylines",void 0),Q([ro({json:{read:{reader:e=>e?dw(e):null},write:{writer:(e,t)=>{t.trimExtendTo=e.toJSON()}}}})],Y7.prototype,"trimExtendTo",void 0),Y7=Q([Ro("esri.rest.support.TrimExtendParameters")],Y7),Y7.from=qn(Y7);var Z7=Y7;const Q7=new ee({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});function e8(e){const{extendHow:t,polylines:i,trimExtendTo:r}=e.toJSON(),s={};return s.extendHow=Q7.toJSON(t),i&&i.length&&(s.polylines=JSON.stringify(i),s.sr=JSON.stringify(i[0].spatialReference)),r&&(s.trimExtendTo=JSON.stringify(r)),s}const t8=Ne.getLogger("esri.widgets.support.geolocationUtils"),i8={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function r8(){return function(){const e=y("esri-geolocation");return e||t8.warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||t8.warn("insecure-context","Geolocation requires a secure origin."),e}()}function s8(e){return e||(e=i8),new Promise(((t,i)=>{setTimeout((()=>i(new Be("geolocation:timeout","getting the current geolocation position timed out"))),15e3),navigator.geolocation.getCurrentPosition(t,i,e)}))}function n8(e,t){const{position:i,view:r}=e;return function(e,t,i){if(!t)return Promise.resolve(e);const r=t.spatialReference;return r.isWGS84?Promise.resolve(e):r.isWebMercator?Promise.resolve(Xa(e)):function(e){if(Z.geometryServiceUrl)return Promise.resolve(Z.geometryServiceUrl);const t=Yl.getDefault();return t.load(e).catch((()=>{})).then((()=>t.get("helperServices.geometry.url")))}(i).then((t=>{if(!t)throw new Be("geometry-service:missing-url","Geometry service URL is missing");return W7(t,new q7({geometries:[e],outSpatialReference:r}),i).then((e=>e[0]))}))}(function(e){const t=e&&e.coords;return t?new il({longitude:t.longitude,latitude:t.latitude,z:t.altitude||null,spatialReference:{wkid:4326}}):null}(function(e){const t=e&&e.coords||{},i={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed};return e?{coords:i,timestamp:e.timestamp}:e}(i)),r,t)}function o8(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const a8="esri.widgets.Search.SearchViewModel",l8=Ne.getLogger(a8),h8=xh.ofType({key:e=>e.layer?"layer":"locator",base:S6,typeMap:{layer:K6,locator:I7}}),c8=Aa.WGS84,u8=/<(?:.|\s)*?>/g;let p8=class extends(yH(sh.EventedMixin(jo))){constructor(e){super(e),this._handles=new Mh,this._gotoController=null,this._searching=null,this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new h8,this.defaultSymbol=new PI({url:gr(y("trident")?"esri/images/search/search-symbol-32.png":"esri/images/search/search-symbol-32.svg"),size:24,width:24,height:24}),this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=1,this.popupEnabled=!0,this.popupTemplate=null,this.portal=Yl.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new h8,this.suggestionDelay=150,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await Pt("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new xS({title:e.searchResult,content:"{Match_addr}"})};e(),this._handles.add([Hh(this,["defaultSources","sources"],"change",(()=>this.notifyChange("allSources"))),Rh(this,["includeDefaultSources","view","portal"],(()=>this._update())),ce(e)])}destroy(){this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){return this.allSources.getItemAt(this.activeSourceIndex)||null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?-1:0}set activeSourceIndex(e){void 0!==e?this._override("activeSourceIndex",e):this._clearOverride("activeSourceIndex")}get allPlaceholder(){var e;return null==(e=this.messages)?void 0:e.allPlaceholder}set allPlaceholder(e){e?this._override("allPlaceholder",e):this._clearOverride("allPlaceholder")}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:i}=this,r="function"==typeof i?i.call(null,{sources:e,defaultSources:t}):i?t.concat(e):e,s=this._get("allSources")||new h8;return s.removeAll(),s.addMany(r.filter(Boolean)),s}get locationEnabled(){return this._get("locationEnabled")||r8()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=r8();if(e&&!t){const e=new Be("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});l8.error(e)}this._override("locationEnabled",e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:i}=this;if(-1===t)return i;const r=e.getItemAt(t);return r?r.placeholder:""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const i=this._createSuggestionForSearch(e),r=this.when().then((()=>this._getResultsFromSources(i,t).then((e=>{var r;if(null!=(r=null==t?void 0:t.signal)&&r.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:i.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(s,e,i);const n=this._getFirstResult(s.results),o=(i.location&&n?n.name:i.text).replace(u8,"");return this._set("searchTerm",o),(i.key&&"number"==typeof i.sourceIndex||i.location)&&this._set("selectedSuggestion",i),this._set("results",s.results),this._set("resultCount",s.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("search-complete",s),this._selectFirstResult(n).then((()=>s))})))).then((e=>(this._clearSearching(),e)),(e=>{throw this._clearSearching(),e}));return this._searching=r,this.notifyChange("state"),r}searchNearby(e){if(!this.locationEnabled){const e=new Be("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return l8.error(e),Promise.reject(e)}const t=s8().then((t=>n8({position:t,view:this.view},e))).then((t=>this.search(t,e)));return this._searching=t,this.notifyChange("state"),t.catch((()=>{})).then((()=>this._clearSearching())),t}select(e){if(this.clearGraphics(),!e){const t=new Be("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});return l8.error(t),Promise.reject(t)}const{view:t}=this,i=o8(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),r=this.allSources.getItemAt(i);if(!r){const e=new Be("select:missing-source","Cannot select without a source.",{source:r});return l8.error(e),Promise.reject(e)}const s=r instanceof K6?this._getLayerSourcePopupTemplate(r):r.popupTemplate,n=r.resultSymbol||this._getDefaultSymbol(e),o=o8(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,a=o8(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,l=o8(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,h=l?s||this.popupTemplate||this.defaultPopupTemplate:null,{feature:c}=e;if(!c){const e=new Be("select:missing-feature","Cannot select without a feature.",{feature:c});return l8.error(e),Promise.reject(e)}const{attributes:u,geometry:p,layer:d,sourceLayer:f}=c,y=A6(p);return pt({layerViewQuery:this._getLayerView(c),elevationQuery:t&&m(y)?E6(y,t).catch((()=>y)):Promise.resolve(y)}).then((s=>{const y=s.layerViewQuery.value,g=s.elevationQuery.value;n instanceof KI&&(n.text=e.name);const v=t&&a?e.target||e.extent:null;return(m(v)?this._goToSearchResult(v):Promise.resolve()).then((()=>{var s;const a=y?c:new fE({geometry:p,symbol:n,attributes:u,layer:d,sourceLayer:f,popupTemplate:h}),m=l&&(null==(s=this.view)?void 0:s.popup),v=m&&a.getEffectivePopupTemplate(m.defaultPopupTemplateEnabled);return v&&t.popup.open({features:[a],location:g}),y&&rH(y)&&!v&&this._highlightFeature({graphic:a,layerView:y}),!y&&o&&t&&t.graphics.push(a),this._set("selectedResult",e),this._set("resultGraphic",a),this.emit("select-result",{result:e,source:r,sourceIndex:i}),e}))}))}suggest(e,t,i){const r=e||this.searchTerm;return this.emit("suggest-start",{searchTerm:r}),this._suggestTimer(t,i).then((()=>this._suggestImmediate(r,i).then((e=>(this._set("suggestions",e.results),this._set("suggestionCount",e.results.reduce(((e,t)=>e+t.results.length),0)),this.emit("suggest-complete",e),e)))))}async when(){await Bh(this,"updating")}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const i=this._updatingPromise=pt([null==e?void 0:e.load(),null==t?void 0:t.when()]);if(this.destroyed)return;if(this.notifyChange("updating"),await i,i!==this._updatingPromise)return}this._updatingPromise=null,this.notifyChange("updating");const i=jh(this,"messages");this.destroyed||(this._handles.add(i),await i,this._updateDefaultSources())}_clearSearching(){this._searching=null,this.notifyChange("state")}_convertHelperServices(){var e,t;const i=null==(e=this.portal)||null==(t=e.helperServices)?void 0:t.geocode;return i?i.map((e=>{var t;if(!1===e.placefinding)return;const i=Z.apiKey&&_7(e.url)?{url:"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer"}:null,r=I7.fromJSON(a(a({},e),i)),s=null==(t=r.locator)?void 0:t.url;if(_7(s)||function(e){return!!e&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(e)}(s)||function(e){return!!e&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e)}(s)){const e=r.outFields||["Addr_type","Match_addr","StAddr","City"],t=r.placeholder||this.messages.placeholder,i="number"==typeof r.defaultZoomScale?r.defaultZoomScale:2500;r.set({singleLineFieldName:"SingleLine",outFields:e,placeholder:t,defaultZoomScale:i})}return r.singleLineFieldName?r:void 0})).filter(Boolean):[]}_getLayerSources(e,t){var i;const r=null==(i=this.view)?void 0:i.map;return e.map((e=>{const i=r.findLayerById(e.id);if(!i)return;const s=this._getLayerJSON(e),n=K6.fromJSON(s);return n.placeholder=t,this._getLayer(i,s).then((e=>{n.layer=e})),n})).filter(Boolean).toArray()}_getTableSources(e,t){var i;const r=null==(i=this.view)?void 0:i.map;return e.map((e=>{const i=r.findTableById(e.id);if(!i)return;const s=this._getLayerJSON(e),n=K6.fromJSON(s);return n.placeholder=t,this._getLayer(i,s).then((e=>{n.layer=e})),n})).filter(Boolean).toArray()}_convertApplicationProperties(){var e,t,i;const r=null==(e=this.view)?void 0:e.map,s=null==r||null==(t=r.applicationProperties)||null==(i=t.viewing)?void 0:i.search;if(!s)return[];const{enabled:n,hintText:o,layers:a,tables:l}=s;return n?[...this._getLayerSources(a,o),...this._getTableSources(l,o)]:[]}_getSubLayer(e,t){return e.load().then((()=>{if(!e.allSublayers)return Promise.reject();const i=e.allSublayers.find((e=>e.id===t.subLayer));return i?i.createFeatureLayer():Promise.reject()}))}async _getBuildingSubLayer(e,t){await e.load();const i=e.allSublayers.find((e=>e.id===t.subLayer));return"building-component"!==(null==i?void 0:i.type)?Promise.reject():(await i.load(),null==i.associatedLayer?Promise.reject():(await i.associatedLayer.load(),i))}_getLayer(e,t){return"feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type?Promise.resolve(e):"map-image"===e.type?this._getSubLayer(e,t).catch((()=>{const t=new Be("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return l8.error(t),null})):"building-scene"===e.type?this._getBuildingSubLayer(e,t):Promise.resolve(null)}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()]),this.notifyChange("allSources")}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var e;const t=null==(e=this.view)?void 0:e.popup,{resultGraphic:i}=this;if(!t||!i)return;const{selectedFeature:r}=t;r&&r===i&&t.close()}_suggestTimer(e,t){return gt(null!=e?e:this.suggestionDelay,null,t&&t.signal)}_createLocationForSearch(e){return e instanceof fE?A6(e.geometry):e instanceof il?e:Array.isArray(e)&&2===e.length?new il({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&o8(e,"key")&&o8(e,"text")&&o8(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),i="string"==typeof e?e:this.searchTerm,{selectedSuggestion:r,selectedResult:s}=this,n=!e&&r&&s,o=n&&r.key===s.key&&r.sourceIndex===s.sourceIndex,a=n&&r.location;return o||a?r:{location:t,text:t?"":i,sourceIndex:null,key:null}}_getFirstResult(e){let t=null;return e&&e.some((e=>{const{results:i}=e,r=i[0],s=!!r;return s&&(t=r),s})),t}_selectFirstResult(e){return this.autoSelect&&e?this.select(e):Promise.resolve(null)}_suggestImmediate(e,t){return this.when().then((()=>this._getSuggestionsFromSources(e,t))).then((i=>{var r;if(null!=(r=null==t?void 0:t.signal)&&r.aborted)return null;const s={activeSourceIndex:this.activeSourceIndex,searchTerm:e,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(s,i),s}))}_formatSourceResponse(e,t,i){const r=t&&t.value||[],s=t&&t.error,n=this.allSources.getItemAt(i);if(s){const t={sourceIndex:i,source:n,error:s};e.errors.push(t),l8.error(s),e.numErrors++}else{const t={sourceIndex:i,source:n,results:r};e.results.push(t),e.numResults+=r.length}}_formatResponse(e,t,i){if(t)if(-1===e.activeSourceIndex){const r=i&&o8(i,"sourceIndex")&&-1!==i.sourceIndex?i.sourceIndex:void 0;t.forEach(((t,i)=>{const s=void 0!==r?r:i;this._formatSourceResponse(e,t,s)}))}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}_getResultsFromSources(e,t){const{allSources:i}=this,r=!e.location&&o8(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,s=[];if(!i.length){const e=new Be("search:no-sources-defined","At least one source is required.",{allSources:i});return l8.error(e),Promise.reject(e)}return-1===r?i.forEach(((i,r)=>{s.push(this._getResultsFromSource(e,r,t))})):s.push(this._getResultsFromSource(e,r,t)),pt(s)}_getSuggestionsFromSources(e,t){const{allSources:i,activeSourceIndex:r}=this,s=[];if(!i.length){const e=new Be("suggest:no-sources-defined","At least one source is required.",{allSources:i});return l8.error(e),Promise.reject(e)}return-1===r?i.forEach(((i,r)=>{s.push(this._getSuggestionsFromSource(e,r,t))})):s.push(this._getSuggestionsFromSource(e,r,t)),pt(s)}_getResultsFromSource(e,t,i){var r;const s=this.allSources.getItemAt(t),{location:n=null}=e,o=(null==(r=this.view)?void 0:r.spatialReference)||c8,a=o8(s,"maxResults")?s.maxResults:this.maxResults,l=!!(s instanceof K6&&o8(s,"exactMatch"))&&s.exactMatch,{view:h}=this;return s.getResults({view:h,sourceIndex:t,location:n,suggestResult:e,spatialReference:o,exactMatch:l,maxResults:a},i)}_getSuggestionsFromSource(e,t,i){const r=this.allSources.getItemAt(t),s=o8(r,"suggestionsEnabled")?r.suggestionsEnabled:this.suggestionsEnabled,n=e.length,o=o8(r,"minSuggestCharacters")?r.minSuggestCharacters:this.minSuggestCharacters;if(s&&e.trim()&&n>=o){var a;const s=(null==(a=this.view)?void 0:a.spatialReference)||c8,n=o8(r,"maxSuggestions")?r.maxSuggestions:this.maxSuggestions,{view:o}=this;return r.getSuggestions({view:o,sourceIndex:t,suggestTerm:e,spatialReference:s,maxSuggestions:n},i)}return Promise.resolve(null)}createDefaultSymbol(e,t){if("point"===t){const t=e;return new $I({color:e.color,size:t.size,outline:{color:t.outline.color,width:t.outline.width}})}if("polyline"===t){const t=e;return new fM({color:t.color,width:t.width})}if("polygon"===t){const t=e;return new BI({color:t.color,outline:{color:t.outline.color,width:t.outline.width}})}}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return o8(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){const t=this.results;let i=null;return t.some((t=>t.results.some((r=>r===e&&(i=t.sourceIndex,!0))))),i}async _goToSearchResult(e){const t=!!e;this._abortGoTo();const i=et();this._gotoController=i;const r={target:{target:e},options:{animate:t,signal:i.signal}};await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){var t,i,r;const s=null==(t=this.view)||null==(i=t.map)||null==(r=i.basemap)?void 0:r.id,n=R(e,"feature","geometry","type");if(m(n)){const e=w6({basemap:s,geometryType:n})||w6({basemap:"topo",geometryType:n}),t=e&&e.primaryScheme;if(t)return t.color&&o8(t,"opacity")&&(t.color.a=t.opacity),this.createDefaultSymbol(t,n)}return this.defaultSymbol}_removeHighlight(){this._handles.remove("highlight")}async _getLayerView(e){const{view:t}=this;if(!e||!t||"building-component"===e.layer.type||"subtype-sublayer"===e.layer.type)return Promise.resolve(null);const{layer:i}=e;return await t.when(),t.whenLayerView(i)}_highlightFeature(e){const{graphic:t,layerView:i}=e,{attributes:r,layer:s}=t,{objectIdField:n}=s,o=r&&r[n],a=i.highlight(o||t);this._handles.add(a,"highlight")}};p8.ALL_INDEX=-1,Q([ro({readOnly:!0,value:null})],p8.prototype,"activeSource",null),Q([ro()],p8.prototype,"activeSourceIndex",null),Q([ro()],p8.prototype,"allPlaceholder",null),Q([ro({readOnly:!0,dependsOn:["defaultSources.length","sources.length","includeDefaultSources"]})],p8.prototype,"allSources",null),Q([ro()],p8.prototype,"autoNavigate",void 0),Q([ro()],p8.prototype,"autoSelect",void 0),Q([ro()],p8.prototype,"defaultPopupTemplate",void 0),Q([ro({readOnly:!0})],p8.prototype,"defaultSources",void 0),Q([ro()],p8.prototype,"defaultSymbol",void 0),Q([ro()],p8.prototype,"includeDefaultSources",void 0),Q([ro()],p8.prototype,"locationEnabled",null),Q([ro()],p8.prototype,"maxInputLength",void 0),Q([ro()],p8.prototype,"maxResults",void 0),Q([ro()],p8.prototype,"maxSuggestions",void 0),Q([ro()],p8.prototype,"messages",void 0),Q([ro()],p8.prototype,"minSuggestCharacters",void 0),Q([ro({readOnly:!0})],p8.prototype,"placeholder",null),Q([ro()],p8.prototype,"popupEnabled",void 0),Q([ro({type:xS})],p8.prototype,"popupTemplate",void 0),Q([ro({type:Yl})],p8.prototype,"portal",void 0),Q([ro()],p8.prototype,"resultCount",void 0),Q([ro()],p8.prototype,"resultGraphicEnabled",void 0),Q([ro({readOnly:!0})],p8.prototype,"resultGraphic",void 0),Q([ro({readOnly:!0})],p8.prototype,"results",void 0),Q([ro({readOnly:!0})],p8.prototype,"selectedSuggestion",void 0),Q([ro()],p8.prototype,"searchAllEnabled",void 0),Q([ro({readOnly:!0})],p8.prototype,"selectedResult",void 0),Q([ro()],p8.prototype,"searchTerm",null),Q([ro({type:h8})],p8.prototype,"sources",void 0),Q([ro({readOnly:!0,dependsOn:["allSources.length","updating"]})],p8.prototype,"state",null),Q([ro()],p8.prototype,"suggestionDelay",void 0),Q([ro()],p8.prototype,"suggestionCount",void 0),Q([ro({readOnly:!0})],p8.prototype,"suggestions",void 0),Q([ro()],p8.prototype,"suggestionsEnabled",void 0),Q([ro({readOnly:!0})],p8.prototype,"updating",null),Q([ro()],p8.prototype,"view",void 0),Q([ro()],p8.prototype,"clear",null),p8=Q([Ro(a8)],p8);var d8=p8;let f8=class extends(yH(sh.EventedAccessor)){constructor(e){super(e),this._initialViewpoint=null,this._goingHomeController=null,this.go=this.go.bind(this)}destroy(){this._cancelGo(),this.view=null}get state(){return this.get("view.ready")?this._goingHomeController?"going-home":"ready":"disabled"}set view(e){this._initialViewpoint=null,this._set("view",e),e&&e.when().then((()=>{this.view===e&&(this._initialViewpoint=e.viewpoint.clone(),this.notifyChange("viewpoint"))}))}get viewpoint(){return this._get("viewpoint")||this._initialViewpoint}set viewpoint(e){this._set("viewpoint",e)}async go(){if(!this.get("view.ready"))throw new Be("home:disabled-state","Cannot go when disabled.");this._cancelGo(),this.emit("go");const e=et();this._goingHomeController=e;try{await this.view.when(),await this.callGoTo({target:this.viewpoint,options:{signal:e.signal}})}catch(mr){}this._goingHomeController=null}cancelGo(){this._cancelGo()}_cancelGo(){const{_goingHomeController:e}=this;e&&e.abort(),this._goingHomeController=null}};Q([ro()],f8.prototype,"_goingHomeController",void 0),Q([ro({readOnly:!0})],f8.prototype,"state",null),Q([ro()],f8.prototype,"view",null),Q([ro({type:m$})],f8.prototype,"viewpoint",null),Q([ro()],f8.prototype,"go",null),Q([ro()],f8.prototype,"cancelGo",null),f8=Q([Ro("esri.widgets.Home.HomeViewModel")],f8);var y8=f8;let g8=class extends(yH(sh.EventedMixin(jo))){constructor(){super(...arguments),this._geolocationUsable=!0,this._iconPath=gr("esri/images/support/sdk_gps_location.png"),this.geolocationOptions=null,this.goToLocationEnabled=!0,this.graphic=new fE({symbol:new PI({url:this._iconPath,width:21,height:21})}),this.scale=null,this.useHeadingEnabled=!0,this.view=null}initialize(){r8()||(this._geolocationUsable=!1)}destroy(){this._clear(),this.view=null}_clear(){this.view&&this.view.graphics.remove(this.graphic)}_getScaleWithinConstraints(e,t){if(!t)return e;if("2d"===t.type){const{effectiveMaxScale:i,effectiveMinScale:r}=t.constraints;return Math.min(r,Math.max(i,e))}return e}_getScale(e){const{scale:t}=this,i="number"==typeof t?t:2500;return this._getScaleWithinConstraints(i,e)}_getHeading(e,t){const i=t&&t.spatialReference,r=i&&(i.isWebMercator||i.isGeographic),s=e.coords&&e.coords.heading;if(!(!r||"number"!=typeof s||isNaN(s)||s<0||s>360))return s}_addHeading(e){const{heading:t,target:i,view:r}=e;r&&"number"==typeof t&&!isNaN(t)&&("3d"!==r.type?"2d"===r.type&&(i.rotation=360-t):i.heading=t)}_animatePoint(e,t,i,r){const{view:s}=this;if(!this.goToLocationEnabled||!s)return Promise.resolve(t);const n=this.useHeadingEnabled?this._getHeading(t,s):void 0,o={target:e,scale:i};return this._addHeading({heading:n,target:o,view:s}),this.callGoTo({target:o,options:r}).then((()=>t))}async _setPosition(e,t){try{const i=await n8({position:e,view:this.view},t),{graphic:r}=this,{timestamp:s}=e,{coords:n}=e,{accuracy:o,altitude:a,altitudeAccuracy:l,heading:h,latitude:c,longitude:u,speed:p}=n,d={timestamp:s,accuracy:o,altitude:a,altitudeAccuracy:l,heading:h,latitude:c,longitude:u,speed:p};r&&(r.geometry=i,r.attributes=d);const f=this._getScale(this.view);return this._animatePoint(i,e,f,t)}catch(ia){throw new Be("positioning:invalid-point","Cannot position invalid point",{error:ia})}}};Q([ro()],g8.prototype,"_geolocationUsable",void 0),Q([ro()],g8.prototype,"geolocationOptions",void 0),Q([ro()],g8.prototype,"goToLocationEnabled",void 0),Q([ro()],g8.prototype,"graphic",void 0),Q([ro()],g8.prototype,"scale",void 0),Q([ro()],g8.prototype,"useHeadingEnabled",void 0),Q([ro()],g8.prototype,"view",void 0),g8=Q([Ro("esri.widgets.support.GeolocationPositioning")],g8);var m8=g8;let v8=class extends m8{constructor(e){super(e),this._locateController=null,this._handles=new Mh,this.popupEnabled=!0,this.locate=this.locate.bind(this)}initialize(){this._handles.add([ce((()=>{var e;const{graphic:t,view:i}=this;(null==i||null==(e=i.graphics)?void 0:e.includes(t))&&this._updatePopupTemplate(t)}))])}destroy(){this.cancelLocate(),this._handles.destroy(),this._handles=null}get state(){return this._geolocationUsable?this.get("view.ready")?this._locateController?"locating":"ready":"disabled":"feature-unsupported"}async locate(){if(this.cancelLocate(),"disabled"===this.state)throw new Be("locate:disabled-state","Cannot locate when disabled.");if("feature-unsupported"===this.state)throw new Be("locate:feature-unsupported-state","Cannot locate in unsecure domain.");const e=et();this._locateController=e;try{let t=await s8(this.geolocationOptions);return t=await this._setPosition(t,{signal:e.signal}),this._locateController!==e?null:(this.graphic&&(this.graphic=this.graphic.clone(),await this._updatePopupTemplate(this.graphic),this.view.graphics.push(this.graphic)),this.emit("locate",{position:t}),this._locateController=null,t)}catch(qe){throw this._locateController=null,this.emit("locate-error",{error:qe}),qe}}cancelLocate(){this._clear(),this._locateController&&this._locateController.abort(),this._locateController=null}async _updatePopupTemplate(e){if(!this.popupEnabled)return;const t=await async function(){const e=await Pt("esri/widgets/Locate/t9n/Locate");return new xS({title:e.currentLocation,fieldInfos:[{fieldName:"timestamp",label:e.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:e.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:e.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:e.accuracy,format:{places:0,digitSeparator:!0}},{fieldName:"altitude",label:e.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:e.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:e.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:e.speed,format:{places:0,digitSeparator:!0}}],actions:[hH.clone()],content:[{type:"fields"}]})}(),i=e!==this.graphic;this.destroyed||i||(e.popupTemplate=t)}};Q([ro()],v8.prototype,"_locateController",void 0),Q([ro()],v8.prototype,"popupEnabled",void 0),Q([ro({readOnly:!0})],v8.prototype,"state",null),Q([ro()],v8.prototype,"locate",null),Q([ro()],v8.prototype,"cancelLocate",null),v8=Q([Ro("esri.widgets.Locate.LocateViewModel")],v8);var b8=v8;const w8="esri.widgets.Fullscreen.FullscreenViewModel",_8=Ne.getLogger(w8);let x8=class extends jo{constructor(e){super(e),this._vendorInfo=null,this._fullscreenStyle="width: 100%; height: 100%;",this.view=null,this._errorHandler=this._errorHandler.bind(this),this._stateHandler=this._stateHandler.bind(this)}destroy(){this._removeFullscreenListeners(),this.view=null}get element(){return this.get("view.container")}set element(e){void 0!==e?this._override("element",e):this._clearOverride("element")}get state(){return this.element?this._isSupported()?this._isActive()?"active":"ready":"feature-unsupported":"disabled"}enter(){this._enterFullscreen()}exit(){this._exitFullscreen()}toggle(){this._isActive()?this._exitFullscreen():this._enterFullscreen()}_isSupported(){this._removeFullscreenListeners();const e=this._getVendorInfo(this.element);return this._addFullscreenListeners(e),this._vendorInfo=e,!!e}_isActive(){return!!this._vendorInfo&&!!document[this._vendorInfo.propertyName]}_stateHandler(){this.notifyChange("state"),"active"===this.state?this._addStyle():this._removeStyle()}_errorHandler(e){_8.error("fullscreen request failed",e)}_getVendorInfo(e){if(e)return e.requestFullscreen?{enterName:"requestFullscreen",exitName:"exitFullscreen",errorEventName:"fullscreenerror",changeEventName:"fullscreenchange",propertyName:"fullscreen"}:e.webkitRequestFullScreen?{enterName:"webkitRequestFullscreen",exitName:"webkitCancelFullScreen",errorEventName:"webkitfullscreenerror",changeEventName:"webkitfullscreenchange",propertyName:"webkitIsFullScreen"}:e.mozRequestFullScreen?{enterName:"mozRequestFullScreen",exitName:"mozCancelFullScreen",errorEventName:"mozfullscreenerror",changeEventName:"mozfullscreenchange",propertyName:"mozFullScreen"}:e.msRequestFullscreen?{enterName:"msRequestFullscreen",exitName:"msExitFullscreen",errorEventName:"MSFullscreenError",changeEventName:"MSFullscreenChange",propertyName:"msFullscreenElement"}:void 0}_enterFullscreen(){if("feature-unsupported"===this.state)return void _8.warn("The fullscreen API is not supported in this browser.");const{element:e}=this;e&&(e[this._vendorInfo.enterName].call(e),this.notifyChange("state"))}_addStyle(){const{element:e}=this;e&&e.setAttribute("style",this._fullscreenStyle)}_removeStyle(){const{element:e}=this;e&&e.removeAttribute("style")}_exitFullscreen(){if("feature-unsupported"===this.state)return;const{element:e}=this;e&&(document[this._vendorInfo.exitName].call(document),this.notifyChange("state"))}_addFullscreenListeners(e){e&&(document.addEventListener(e.changeEventName,this._stateHandler),document.addEventListener(e.errorEventName,this._errorHandler))}_removeFullscreenListeners(){const{_vendorInfo:e}=this;this._vendorInfo&&(document.removeEventListener(e.changeEventName,this._stateHandler),document.removeEventListener(e.errorEventName,this._errorHandler))}};Q([ro()],x8.prototype,"element",null),Q([ro({readOnly:!0})],x8.prototype,"state",null),Q([ro()],x8.prototype,"view",void 0),Q([ro()],x8.prototype,"enter",null),Q([ro()],x8.prototype,"exit",null),Q([ro()],x8.prototype,"toggle",null),x8=Q([Ro(w8)],x8);var S8=x8;function M8(e){if(!e)return null;if(e.isGeographic&&e.wkid){const t=nZ[e.wkid];if(t)return t}if(e.wkt){const t=function(e){const t=tZ.exec(e);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),s=parseFloat(i[2]);return isNaN(r)||isNaN(s)?null:{a:r,f:0===s?0:1/s}}(e.wkt);if(t)return t}return null}function T8(e){const t=M8(e||Aa.WGS84);if(function(e){return"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function I8(e){return null!==M8(e)}function E8(e,t,i,r,s){const n=t[0],o=t[1],a=n*eZ,l=o*eZ,h=i*eZ,{a:c,b:u,f:p}=T8(s),d=Math.sin(h),f=Math.cos(h),y=(1-p)*Math.tan(l),g=1/Math.sqrt(1+y*y),m=y*g,v=Math.atan2(y,f),b=g*d,w=b*b,_=1-w,x=_*(c*c-u*u)/(u*u),S=1+x/16384*(4096+x*(x*(320-175*x)-768)),M=x/1024*(256+x*(x*(74-47*x)-128));let T,I,E,A,P=r/(u*S),C=2*Math.PI;for(;Math.abs(P-C)>1e-12;)E=Math.cos(2*v+P),T=Math.sin(P),I=Math.cos(P),A=M*T*(E+M/4*(I*(2*E*E-1)-M/6*E*(4*T*T-3)*(4*E*E-3))),C=P,P=r/(u*S)+A;const O=m*T-g*I*f,k=Math.atan2(m*I+g*T*f,(1-p)*Math.sqrt(w+O*O)),L=Math.atan2(T*d,g*I-m*T*f),R=p/16*_*(4+p*(4-3*_)),D=k/eZ,F=(a+(L-(1-R)*p*b*(P+R*T*(E+R*I*(2*E*E-1)))))/eZ;return e[0]=F,e[1]=D,e}function A8(e,t,i,r){const s=t[0]*eZ,n=t[1]*eZ,o=i[0]*eZ,a=i[1]*eZ,{a:l,b:h,f:c,radius:u}=T8(r),p=o-s,d=Math.atan((1-c)*Math.tan(n)),f=Math.atan((1-c)*Math.tan(a)),y=Math.sin(d),g=Math.cos(d),m=Math.sin(f),v=Math.cos(f);let b,w,_,x,S,M,T,I,E,A,P=1e3,C=p;do{if(T=Math.sin(C),I=Math.cos(C),_=Math.sqrt(v*T*(v*T)+(g*m-y*v*I)*(g*m-y*v*I)),0===_)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;S=y*m+g*v*I,M=Math.atan2(_,S),E=g*v*T/_,w=1-E*E,x=S-2*y*m/w,isNaN(x)&&(x=0),A=c/16*w*(4+c*(4-3*w)),b=C,C=p+(1-A)*c*E*(M+A*_*(x+A*S*(2*x*x-1)))}while(Math.abs(C-b)>1e-12&&--P>0);if(0===P){const t=u,i=Math.acos(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(o-s))*t,r=o-s,l=Math.sin(r)*Math.cos(a),h=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(r),c=Math.atan2(l,h);return e.azimuth=c/eZ,e.distance=i,e.reverseAzimuth=void 0,e}const O=w*(l*l-h*h)/(h*h),k=O/1024*(256+O*(O*(74-47*O)-128)),L=h*(1+O/16384*(4096+O*(O*(320-175*O)-768)))*(M-k*_*(x+k/4*(S*(2*x*x-1)-k/6*x*(4*_*_-3)*(4*x*x-3)))),R=Math.atan2(v*Math.sin(C),g*m-y*v*Math.cos(C)),D=Math.atan2(g*Math.sin(C),g*m*Math.cos(C)-y*v);return e.azimuth=R/eZ,e.distance=L,e.reverseAzimuth=D/eZ,e}function P8(e,t){return e&&e.indexOf(t)>-1}function C8(e,t){const{x:i,y:r}="decimal-degrees"===e?Ka(t,!0):t;return[i,r]}function O8({state:{paddedViewState:e},spatialReference:t,width:i}){return t.isWrappable&&e.worldScreenWidth<i}let k8=class extends jo{constructor(e){super(e),this.scaleComputedFrom=FS(),this.view=null}get state(){return this.get("view.ready")&&"2d"===this.get("view.type")?"ready":"disabled"}getScaleBarProperties(e,t){if("disabled"===this.state||isNaN(e)||!t)return null;const i=this._getDistanceInKm(this.view,this.scaleComputedFrom);if(v(i))return null;if("metric"===t)return this._getScaleBarProps(e,i,"metric");const r=i/1.609;return this._getScaleBarProps(e,r,"non-metric")}_getLocationUnit(){const e=this.get("view.spatialReference"),{isWebMercator:t,wkid:i,wkt:r}=e;return t||P8(r,"WGS_1984_Web_Mercator")?"decimal-degrees":null!=aa[i]||P8(r,"PROJCS")?"linear-unit":"unknown"}_getDistanceInKm(e,t){const{state:i,spatialReference:r}=e,s=this._getLocationUnit();if("linear-unit"===s){const e=1e3;return i.extent.width*function(e){const{wkid:t}=e;if(null!=aa[t])return aa.values[aa[t]];const{wkt:i}=e,r=i.lastIndexOf(",")+1,s=i.lastIndexOf("]]");return parseFloat(i.substring(r,s))}(r)/e}const[n,o]=this._getScaleMeasuringPoints(e,t),a="decimal-degrees"===s||r.isGeographic&&!I8(r)?Aa.WGS84:r,l=bk(new nw({paths:[[C8(s,n),C8(s,o)]],spatialReference:a}),10);let h;try{[h]=function(e,t="meters"){if(!e)throw new Be("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some((e=>!I8(e.spatialReference))))throw new Be("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let r=0;r<e.length;r++){const s=e[r],{spatialReference:n}=s,o="polyline"===s.type?s.paths:s.rings;let a=0;for(let e=0;e<o.length;e++){const t=o[e];let i=0;for(let e=1;e<t.length;e++){const r=t[e-1][0],s=t[e][0],o=t[e-1][1],a=t[e][1];if(o!==a||r!==s){const e={distance:null};A8(e,[r,o],[s,a],n),i+=e.distance}}a+=i}a=FA(a,"meters",t),i.push(a)}return i}([l],"kilometers")}catch{return null}return h}_getScaleMeasuringPoints(e,t){const{width:i,height:r,position:s,spatialReference:n}=e;if(O8(e)){const{valid:e}=ya(n);return[new il(e[0],0,n),new il(e[1],0,n)]}let o=t.y-s[1];o>r?o=r:o<0&&(o=0);const a=FS(0,o),l=FS(i,o);return[e.toMap(a),e.toMap(l)]}_getScaleBarProps(e,t,i){const{view:r}=this;let s=e*t/(O8(r)?r.state.paddedViewState.worldScreenWidth:r.width),n="metric"===i?"km":"mi";s<.1&&("mi"===n?(s*=5280,n="ft"):"km"===n&&(s*=1e3,n="m"));let o=0;for(;s>=1;)s/=10,o++;const a=this._getConstraints(s);if(!a)return null;const{min:l,max:h}=a,c=h/s>=s/l?l:h;return{length:e*(c/s),value:10**o*c,unit:n}}_getConstraints(e){return e>.5?{min:.5,max:1}:e>.3?{min:.3,max:.5}:e>.2?{min:.2,max:.3}:e>.15?{min:.15,max:.2}:e>=.1?{min:.15,max:.1}:void 0}};Q([ro()],k8.prototype,"scaleComputedFrom",void 0),Q([ro({readOnly:!0})],k8.prototype,"state",null),Q([ro()],k8.prototype,"view",void 0),k8=Q([Ro("esri.widgets.Scalebar.ScaleBarViewModel")],k8);var L8=k8;const R8="esri-scale-bar esri-widget",D8="esri-scale-bar__label-container",F8="esri-scale-bar__label-container--ruler",j8="esri-scale-bar__label-container--line",N8="esri-scale-bar__label-container--top",z8="esri-scale-bar__label-container--bottom",V8="esri-scale-bar__label",U8="esri-scale-bar__line",G8="esri-scale-bar__line--top",B8="esri-scale-bar__line--bottom",q8="esri-scale-bar__ruler",H8="esri-scale-bar__ruler-block",W8="esri-scale-bar__bar-container",$8="esri-scale-bar__bar-container--ruler",J8="esri-scale-bar__bar-container--line",X8="esri-disabled";function K8(e){return 2*e}let Y8=class extends xy{constructor(e,t){super(e,t),this.label=void 0,this.messages=null,this.unit="non-metric",this.view=null,this.viewModel=new L8}initialize(){this.own([Vh(this,"view.stationary",(()=>this.scheduleRender())),Dh(this,["view.center","view.scale","view.zoom"],(()=>{this.view.stationary&&this.scheduleRender()}))])}set style(e){const t="dual"===this.unit?"line":e;this._set("style",t)}castStyle(e){return"line"===e?e:"ruler"}castUnit(e){return"metric"===e||"dual"===e?e:"non-metric"}render(){const e="disabled"===this.get("viewModel.state"),t={[X8]:e};let i,r;if(!e){const{unit:e,style:t}=this,s="metric"===e||"dual"===e,n=50;if("non-metric"===e||"dual"===e){const e=this.viewModel.getScaleBarProperties(n,"non-metric");e&&(r="ruler"===t?this._renderRuler(e):this._renderLine(e,"bottom"))}if(s){const e=this.viewModel.getScaleBarProperties(n,"metric");e&&(i="ruler"===t?this._renderRuler(e):this._renderLine(e,"top"))}}return Iy("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(R8,t)},i,r)}_renderRuler(e){const t=K8(Math.round(e.length)),{messages:i}=this,r=i[e.unit]||i.unknownUnit,s=`${K8(e.value)} ${r}`;return Iy("div",{class:this.classes(W8,$8),key:"esri-scale-bar__ruler"},Iy("div",{class:q8,styles:{width:`${t}px`}},Iy("div",{class:H8}),Iy("div",{class:H8}),Iy("div",{class:H8}),Iy("div",{class:H8})),Iy("div",{class:this.classes(D8,F8)},Iy("div",{class:V8},"0"),Iy("div",{class:V8},s)))}_renderLine(e,t){const{messages:i}=this,r=i[e.unit]||i.unknownUnit,s=`${K8(e.value)} ${r}`,n={[N8]:"top"===t,[z8]:"bottom"===t},o=Iy("div",{class:this.classes(D8,j8,n),key:"esri-scale-bar__label"},Iy("div",{class:V8},s)),a={[G8]:"top"===t,[B8]:"bottom"===t},l=K8(Math.round(e.length)),h=Iy("div",{class:this.classes(U8,a),key:"esri-scale-bar__line",styles:{width:`${l}px`}});return Iy("div",{class:this.classes(W8,J8),key:"esri-scale-bar__line-container"},[h,o])}_handleRootCreateOrUpdate(e){const t=this.viewModel;if(!t)return;const i=e.getBoundingClientRect(),r=FS(i.left+window.pageXOffset,i.top+window.pageYOffset);(r.x!==t.scaleComputedFrom.x||r.y!==t.scaleComputedFrom.y)&&(t.scaleComputedFrom=r)}};Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Y8.prototype,"label",void 0),Q([ro(),Sy("esri/widgets/ScaleBar/t9n/ScaleBar")],Y8.prototype,"messages",void 0),Q([ro()],Y8.prototype,"style",null),Q([Ra("style")],Y8.prototype,"castStyle",null),Q([ro()],Y8.prototype,"unit",void 0),Q([Ra("unit")],Y8.prototype,"castUnit",null),Q([eh("viewModel.view")],Y8.prototype,"view",void 0),Q([ro()],Y8.prototype,"viewModel",void 0),Y8=Q([Ro("esri.widgets.ScaleBar")],Y8);var Z8=Y8;const Q8="esri-search-result-renderer esri-widget",eee="esri-widget__anchor",tee="esri-search-result-renderer__more-results--show-more-results",iee="esri-search-result-renderer__more-results",ree="esri-search-result-renderer__more-results-list",see="esri-search-result-renderer__more-results-item",nee="esri-search-result-renderer__more-results-list-header";let oee=class extends xy{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}render(){const e={[tee]:this.showMoreResultsOpen};return Iy("div",{class:Q8},Iy("div",{key:"esri-search-renderer__container",class:this.classes(iee,e)},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return Iy("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){var e;const t=null==(e=this.viewModel)?void 0:e.selectedResult,i=t&&t.name||"";return Iy("div",{key:"esri-search-renderer__result-name",class:see},i)}renderMoreResultsLists(){var e;const t=null==(e=this.viewModel)?void 0:e.results,{resultCount:i}=this.viewModel;if(i<2)return null;const r=t.map((e=>this.renderMoreResultsList(e)));return Iy("div",{key:"esri-search-renderer__more-results-container",class:ree},r)}renderMoreResultsButton(){const{messages:e}=this,{resultCount:t}=this.viewModel;return t<2?null:Iy("div",{key:"esri-search-renderer__more-results-button",class:see},Iy("a",{class:eee,href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?e.hideMoreResults:e.showMoreResults))}renderMoreResultsHeader(e,t){return Iy("div",{key:`esri-search-result-renderer__header-${t}`,class:nee},e)}renderMoreResultsList(e){var t,i;const{results:r}=e,s=r.length,n=!!s,o=null==(t=this.viewModel)?void 0:t.selectedResult,a=1===s&&r[0]===o,l=this._getSourceName(e.source,e.sourceIndex),h=(null==(i=this.viewModel)?void 0:i.results.length)>1&&!a?this.renderMoreResultsHeader(l,e.sourceIndex):null,c=n&&r.map(((e,t)=>this.renderMoreResultsListItem(e,t))),u=n&&!a?Iy("ul",{key:`esri-search-result-renderer__list-${e.sourceIndex}`},c):null;return n?Iy("div",{key:`esri-search-result-renderer__results-${e.sourceIndex}`},h,u):null}renderMoreResultsListItem(e,t){return e!==this.get("viewModel.selectedResult")?Iy("li",{key:`esri-search-result-renderer__list-item-${t}`},Iy("a",{class:eee,href:"#",tabindex:"0",bind:this,"data-result":e,onclick:this._selectResultClick,onkeydown:this._selectResultClick},e.name)):null}_showMoreResultsClick(e){e.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const t=this.get("viewModel.view.popup");t&&t.reposition()}_selectResultClick(e){e.preventDefault();const t=e.currentTarget["data-result"];this.viewModel&&this.viewModel.select(t)}_getSourceName(e,t){return t===d8.ALL_INDEX?this.messages.all:e.name}};Q([ro(),Sy("esri/widgets/Search/t9n/Search")],oee.prototype,"messages",void 0),Q([ro()],oee.prototype,"showMoreResultsOpen",void 0),Q([ro()],oee.prototype,"viewModel",void 0),Q([Fy()],oee.prototype,"_showMoreResultsClick",null),Q([Fy()],oee.prototype,"_selectResultClick",null),oee=Q([Ro("esri.widgets.Search.SearchResultRenderer")],oee);var aee=oee;const lee="esri-search esri-widget",hee="esri-widget__loader",cee="esri-widget__loader-text",uee="esri-widget__loader-animation",pee="esri-input",dee="esri-search--multiple-sources",fee="esri-search--loading",yee="esri-search--searching",gee="esri-search--show-suggestions",mee="esri-search--sources",vee="esri-search--warning",bee="esri-search__container",wee="esri-search__input",_ee="esri-search__input-container",xee="esri-search__form",See="esri-search__submit-button",Mee="esri-search__sources-button",Tee="esri-search__clear-button",Iee="esri-search__source-name",Eee="esri-search__suggestions-menu",Aee="esri-search__suggestions-list",Pee="esri-search__suggestions-list--current-location",Cee="esri-search__sources-menu",Oee="esri-search__source",kee="esri-search__warning-menu",Lee="esri-search__warning-body",Ree="esri-search__warning-header",Dee="esri-search__warning-text",Fee="esri-search__no-value-text",jee="esri-widget--disabled",Nee="esri-widget--button",zee="esri-icon-font-fallback-text",Vee="esri-icon-locate-circled",Uee="esri-menu",Gee="esri-menu__list",Bee="esri-menu__list-item",qee="esri-menu__list-item--active",Hee="esri-menu__list-item--focus",Wee="esri-menu__header",$ee="esri-icon-search",Jee="esri-icon-down-arrow esri-search__sources-button--down",Xee="esri-icon-up-arrow esri-search__sources-button--up",Kee="esri-icon-close",Yee="esri-icon-notice-triangle",Zee="esri-icon-search",Qee="esri-disabled",ete=/<[a-z/][\s\S]*>/i;let tte=class extends xy{constructor(e,t){super(e,t),this._activeMenuItemIndex=-1,this._handles=new Mh,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new aee,this._locateFailed=null,this._container=null,this.activeMenu="none",this.activeSource=null,this.activeSourceIndex=null,this.allPlaceholder=null,this.allSources=null,this.autoNavigate=null,this.autoSelect=null,this.defaultSources=null,this.disabled=!1,this.goToOverride=null,this.iconClass=Zee,this.includeDefaultSources=null,this.label=void 0,this.locationEnabled=null,this.maxResults=null,this.maxSuggestions=null,this.messages=null,this.messagesCommon=null,this.minSuggestCharacters=null,this.popupEnabled=null,this.popupTemplate=null,this.portal=null,this.resultGraphic=null,this.resultGraphicEnabled=null,this.results=null,this.searchAllEnabled=null,this.searchTerm=null,this.selectedResult=null,this.sources=null,this.suggestions=null,this.suggestionsEnabled=null,this.view=null,this.viewModel=new d8,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=e=>{var t;const i=e.relatedTarget;i&&null!=(t=this._container)&&t.contains(i)||this._clearActiveMenu()},this.own(Dh(this,"searchTerm",(e=>{(e&&"warning"===this.activeMenu||!e&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()})),Hh(this,"viewModel.allSources","change",(()=>this._watchSourceChanges())),Rh(this,"activeMenu",(()=>this._resetActiveMenuItemIndex())),Rh(this,"viewModel.defaultPopupTemplate",(e=>{e&&(e.content=this._renderSearchResultsContent.bind(this))})))}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}clear(){}focus(){var e;null==(e=this._inputNode)||e.focus(),this.emit("search-focus")}blur(){var e;null==(e=this._inputNode)||e.blur(),this.emit("search-blur")}search(e){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const t=et(),{signal:i}=t;return this._searchController=t,this.viewModel.search(e,{signal:i}).catch((e=>{if(this._searchController===t)return this._clearActiveMenu(),this._searchController=null,e})).then((e=>{if(this._searchController===t)return this.activeMenu=e.numResults?"none":"warning",this._searchController=null,e}))}suggest(e){this._cancelSuggest();const t=et(),{signal:i}=t;return this._suggestController=t,this.viewModel.suggest(e,null,{signal:i}).then((e=>{if(this._suggestController===t)return this._suggestController=null,e.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),e})).catch((()=>{if(this._suggestController===t)return this._suggestController=null,null}))}render(){const{state:e}=this.viewModel,t={[Qee]:"disabled"===e,[jee]:this.disabled};return Iy("div",{class:this.classes(lee,t)},"loading"===e?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:e}=this;return Iy("button",{"aria-label":e.searchButtonTitle,bind:this,class:this.classes(See,Nee),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:e.searchButtonTitle},Iy("span",{"aria-hidden":"true",class:$ee}))}renderWarningMenu(){return Iy("div",{key:"esri-search__error-menu",class:this.classes(Uee,kee)},Iy("div",{class:Lee},this.renderWarning()))}renderSourceMenuButton(){const{messages:e,activeMenu:t,sourceMenuId:i,sourceMenuButtonId:r}=this,{activeSourceIndex:s,allSources:n}=this.viewModel;return n.length>1?Iy("button",{id:r,key:"esri-search__source-menu-button",bind:this,"aria-label":e.searchIn,title:e.searchIn,"aria-haspopup":"true","aria-expanded":("source"===t).toString(),"aria-controls":i,class:this.classes(Mee,Nee),onclick:this._handleSourcesMenuToggleClick,onfocus:this._clearActiveMenu,afterCreate:uu,"data-node-ref":"_sourceMenuButtonNode"},Iy("span",{"aria-hidden":"true",class:Jee}),Iy("span",{"aria-hidden":"true",class:Xee}),Iy("span",{class:Iee},this._getSourceName(s))):null}renderSourcesList(){const{allSources:e,searchAllEnabled:t}=this.viewModel,{_activeMenuItemIndex:i,activeMenu:r,sourceMenuId:s,sourceMenuButtonId:n}=this,o="source"===r&&i>-1?this._buildId("source-item",i):null;return e.length>1?Iy("ul",{"aria-activedescendant":o,"aria-labelledby":n,id:s,role:"menu",bind:this,afterCreate:uu,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:Gee,tabIndex:-1},t?this.renderSource(d8.ALL_INDEX):null,e.map(((e,t)=>this.renderSource(t))).toArray()):null}renderSourcesMenu(){const{allSources:e}=this.viewModel;return e.length>1?Iy("div",{key:"esri-search__source-menu",class:this.classes(Uee,Cee)},this.renderSourcesList()):null}renderLoader(){const{messages:e,messagesCommon:t}=this;return Iy("div",{class:hee,key:"base-loader"},Iy("span",{"aria-hidden":"true",class:uee}),Iy("span",{class:zee},e.searchButtonTitle),Iy("span",{class:cee},t.loading))}renderContainer(){const{allSources:e,state:t}=this.viewModel,{activeMenu:i}=this,r={[dee]:e.length>1,[fee]:"loading"===t,[yee]:"searching"===t,[vee]:"warning"===i,[mee]:"source"===i,[gee]:"suggestion"===i};return Iy("div",{tabIndex:-1,afterCreate:e=>{this._container=e,e.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:e=>{e.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes(r,bee),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?Iy("button",{bind:this,class:this.classes(Tee,Nee),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle},Iy("span",{"aria-hidden":"true",class:Kee})):null}renderLocationGroup(){const{messages:e,locationEnabled:t,displayedSearchTerm:i}=this,r=t&&!i,s="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return r?Iy("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes(Gee,Aee,Pee)},Iy("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),role:"option",class:this.classes(Bee,s?Hee:null)},Iy("span",{"aria-hidden":"true",class:Vee})," ",e.useCurrentLocation)):null}renderInput(){const{activeMenu:e,locationEnabled:t,displayedSearchTerm:i,messages:r,suggestionsMenuId:s,inputId:n,_activeMenuItemIndex:o}=this,{maxInputLength:a,placeholder:l,searchTerm:h,suggestionCount:c}=this.viewModel,u=!((!t||i)&&!c);return Iy("input",{"aria-activedescendant":"suggestion"===e&&o>-1?this._buildId("suggestion-item",o):null,"aria-autocomplete":"list","aria-expanded":(u&&"suggestion"===e).toString(),"aria-controls":u?s:null,"aria-haspopup":"listbox","aria-label":r.searchButtonTitle,bind:this,placeholder:l,maxlength:a,autocomplete:"off",type:"text",class:this.classes(pee,wee),value:h,id:n,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:uu,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:h?"":l})}renderForm(){return Iy("form",{key:"esri-search__form",bind:this,class:xee,onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(e){const{sourceIndex:t}=e,i=e.results.length,r=e.results;return i?Iy("ul",{role:"group",key:`esri-search__suggestion-list-${t}`,class:this.classes(Gee,Aee)},r.map((e=>this.renderSuggestion(e,this._menuItemCount++)))):null}renderSuggestionsGroup(){const{suggestions:e}=this.viewModel;return e?e.map((e=>[this.renderSuggestionHeader(e),this.renderSuggestList(e)])):null}renderSuggestionsMenu(){const{displayedSearchTerm:e,locationEnabled:t,suggestionsMenuId:i,inputId:r}=this,{suggestionCount:s}=this.viewModel,n=t&&!e||s;return this._menuItemCount=0,n?Iy("div",{id:i,key:"esri-search__suggestions-menu",class:this.classes(Uee,Eee),role:"listbox","aria-labelledby":r,bind:this,afterCreate:uu,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return Iy("div",{key:"esri-search__input-container",class:_ee},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(e){const{allSources:t,activeSourceIndex:i}=this.viewModel,{sourceIndex:r}=e,s=e.results.length,n=t.length>1&&i===d8.ALL_INDEX;return s&&n?Iy("div",{key:`esri-search__suggestion-header-${r}`,class:Wee},this._getSourceName(r)):null}renderSuggestion(e,t){const{_activeMenuItemIndex:i,messages:r}=this,{searchTerm:s}=this.viewModel;if(s){const{text:n}=e,o=n||r.untitledResult,a=ete.test(o),l=[];if(a)l.push(Iy("div",{innerHTML:o}));else{const e=this._splitResult(o,s),t=s.toLowerCase();e.forEach(((e,i)=>{e&&e.length&&(e.toLowerCase()===t?l.push(Iy("strong",{key:i},e)):l.push(e))}))}const h="suggestion"===this.activeMenu&&i===t;return Iy("li",{bind:this,id:this._buildId("suggestion-item",t),"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===t).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${t}`,"data-suggestion":e,role:"option",class:this.classes(Bee,h?Hee:null)},l)}}renderSource(e){const{activeSourceIndex:t,searchAllEnabled:i}=this.viewModel,r={[qee]:e===t,[Hee]:"source"===this.activeMenu&&e===(i?this._activeMenuItemIndex-1:this._activeMenuItemIndex)},s=i?e+1:e;return Iy("li",{bind:this,key:`esri-search__source-${e}`,id:this._buildId("source-item",s),"aria-checked":(e===t).toString(),onclick:this._handleSourceClick,"data-source-index":e,role:"menuitemradio",class:this.classes(Oee,Bee,r)},this._getSourceName(e))}renderNoResultsWarning(e){const{messages:t}=this,i=e?Ve(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return Iy("div",{key:"esri-search__no_results"},Iy("div",{class:Ree},t.noResults),Iy("div",{class:Dee},i))}renderEmptySearchWarning(){const{messages:e}=this;return Iy("div",{key:"esri-search__empty-search"},Iy("span",{"aria-hidden":"true",class:Yee}),Iy("span",{class:Fee},e.emptyValue))}renderLocateWarning(){const{messages:e}=this;return Iy("div",{key:"esri-search__locate-error"},Iy("span",{"aria-hidden":"true",class:Yee}),Iy("span",{class:Fee},e.locateError))}renderWarning(){var e;const{displayedSearchTerm:t,_locateFailed:i}=this,{viewModel:r}=this;return i?this.renderLocateWarning():null!=(e=r.selectedSuggestion)&&e.location||t?this.renderNoResultsWarning(t):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(e,t){return`${this.id}-${e}${void 0===t?"":`-${t}`}`}_watchSourceChanges(){const{_handles:e,viewModel:{allSources:t}}=this,i="sources";e.remove(i),t.forEach((t=>e.add(Dh(t,"name",(()=>this.scheduleRender())),i)))}_handleSourcesMenuToggleClick(){const e="source"===this.activeMenu;var t;this.activeMenu=e?"none":"source",this.renderNow(),"source"===this.activeMenu&&(null==(t=this._sourceListNode)||t.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(e){const t=e.currentTarget["data-suggestion"];t&&(this._focus(),this.search(t))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const e=et(),{signal:t}=e;this._searchController=e,this.viewModel.searchNearby({signal:t}).catch((()=>{this._locateFailed=!0,this.activeMenu="warning"})).then((()=>{this._searchController=null}))}_handleSourceClick(e){this._setSourceFromMenuItem(e.currentTarget)}_setSourceFromMenuItem(e){var t;if(!e)return;const i=e["data-source-index"];this.viewModel.activeSourceIndex=i,this._clearActiveMenu(),null==(t=this._sourceMenuButtonNode)||t.focus()}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(e){var t;const i=Ke(e);if(e.ctrlKey||e.metaKey||"Copy"===i||"ArrowLeft"===i||"ArrowRight"===i||"Shift"===i)return;if("Tab"===i||"Escape"===i||e.shiftKey&&"Tab"===i)return this._cancelSuggest(),void("Escape"===i&&this._clearActiveMenu());const r="Home"===i||"End"===i||"ArrowUp"===i||"ArrowDown"===i;if("Enter"===i&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const s=null==(t=this._suggestionListNode)?void 0:t.getElementsByTagName("li");if(null!=s&&s.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),r)return e.preventDefault(),this._cancelSuggest(),void this.handleItemNavigation(i,s,this._suggestionListNode);const t=s[this._activeMenuItemIndex];if("Enter"===i&&t){const e=t["data-suggestion"];return void(e?(this._focus(),this.search(e)):t["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}handleItemNavigation(e,t,i){const r=this._activeMenuItemIndex;"Home"===e&&(this._activeMenuItemIndex=0),"End"===e&&(this._activeMenuItemIndex=t.length-1),"ArrowUp"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?t.length-1:this._activeMenuItemIndex-1),"ArrowDown"===e&&(this._activeMenuItemIndex=this._activeMenuItemIndex===t.length-1?0:this._activeMenuItemIndex+1),r!==this._activeMenuItemIndex&&function(e,t){const i=e.getBoundingClientRect(),r=t.getBoundingClientRect(),s=i.top+i.height,n=r.top+r.height,o=i.top,a=r.top;(s>n||o<a)&&e.scrollIntoView({block:"end"})}(t[this._activeMenuItemIndex],i)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(e){const t=e.target;this.viewModel.searchTerm!==t.value&&(this.viewModel.searchTerm=t.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(e){const t=Ke(e);if(gu(t)){e.preventDefault();const t=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(t)}else"ArrowUp"!==t&&"ArrowDown"!==t&&"End"!==t&&"Home"!==t||e.preventDefault()}_handleSourceMenuKeyup(e){var t;const i=Ke(e),r="ArrowUp"===i||"ArrowDown"===i||"End"===i||"Home"===i;var s;if(r&&e.preventDefault(),"Escape"===i)return this._clearActiveMenu(),void(null==(s=this._sourceMenuButtonNode)||s.focus());const n=null==(t=this._sourceListNode)?void 0:t.getElementsByTagName("li");return n&&0!==n.length&&r?("source"!==this.activeMenu&&(this.activeMenu="source"),void this.handleItemNavigation(i,n,this._sourceListNode.parentElement)):void 0}_focus(e){this.focus(),e&&(this.activeMenu=e)}_formSubmit(e){e.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(e){const{messages:t}=this,i=this.viewModel,{allSources:r}=i,s=r.getItemAt(e);return e===d8.ALL_INDEX?t.all:s&&s.name||t.untitledSource}_splitResult(e,t){const i=Re(t);return e.replace(new RegExp(`(^|)(${i})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};Q([ro()],tte.prototype,"_activeMenuItemIndex",void 0),Q([ro()],tte.prototype,"displayedSearchTerm",null),Q([ro({readOnly:!0})],tte.prototype,"inputId",null),Q([ro({readOnly:!0})],tte.prototype,"suggestionsMenuId",null),Q([ro({readOnly:!0})],tte.prototype,"sourceMenuId",null),Q([ro({readOnly:!0})],tte.prototype,"sourceMenuButtonId",null),Q([ro()],tte.prototype,"activeMenu",void 0),Q([eh("viewModel.activeSource")],tte.prototype,"activeSource",void 0),Q([eh("viewModel.activeSourceIndex")],tte.prototype,"activeSourceIndex",void 0),Q([eh("viewModel.allPlaceholder")],tte.prototype,"allPlaceholder",void 0),Q([eh("viewModel.allSources")],tte.prototype,"allSources",void 0),Q([eh("viewModel.autoNavigate")],tte.prototype,"autoNavigate",void 0),Q([eh("viewModel.autoSelect")],tte.prototype,"autoSelect",void 0),Q([eh("viewModel.defaultSources")],tte.prototype,"defaultSources",void 0),Q([ro()],tte.prototype,"disabled",void 0),Q([eh("viewModel.goToOverride")],tte.prototype,"goToOverride",void 0),Q([ro()],tte.prototype,"iconClass",void 0),Q([eh("viewModel.includeDefaultSources")],tte.prototype,"includeDefaultSources",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],tte.prototype,"label",void 0),Q([eh("viewModel.locationEnabled")],tte.prototype,"locationEnabled",void 0),Q([eh("viewModel.maxResults")],tte.prototype,"maxResults",void 0),Q([eh("viewModel.maxSuggestions")],tte.prototype,"maxSuggestions",void 0),Q([ro(),Sy("esri/widgets/Search/t9n/Search")],tte.prototype,"messages",void 0),Q([ro(),Sy("esri/t9n/common")],tte.prototype,"messagesCommon",void 0),Q([eh("viewModel.minSuggestCharacters")],tte.prototype,"minSuggestCharacters",void 0),Q([eh("viewModel.popupEnabled")],tte.prototype,"popupEnabled",void 0),Q([eh("viewModel.popupTemplate")],tte.prototype,"popupTemplate",void 0),Q([eh("viewModel.portal")],tte.prototype,"portal",void 0),Q([eh("viewModel.resultGraphic")],tte.prototype,"resultGraphic",void 0),Q([eh("viewModel.resultGraphicEnabled")],tte.prototype,"resultGraphicEnabled",void 0),Q([eh("viewModel.results")],tte.prototype,"results",void 0),Q([eh("viewModel.searchAllEnabled")],tte.prototype,"searchAllEnabled",void 0),Q([eh("viewModel.searchTerm")],tte.prototype,"searchTerm",void 0),Q([eh("viewModel.selectedResult")],tte.prototype,"selectedResult",void 0),Q([eh("viewModel.sources")],tte.prototype,"sources",void 0),Q([eh("viewModel.suggestions")],tte.prototype,"suggestions",void 0),Q([eh("viewModel.suggestionsEnabled")],tte.prototype,"suggestionsEnabled",void 0),Q([eh("viewModel.view")],tte.prototype,"view",void 0),Q([Ny(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),ro({type:d8})],tte.prototype,"viewModel",void 0),Q([eh("viewModel.clear")],tte.prototype,"clear",null),tte=Q([Ro("esri.widgets.Search")],tte);var ite=tte;let rte=class extends sh.EventedAccessor{constructor(e){super(e),this._basemapCache={},this.nextBasemap=eb("hybrid",this._basemapCache),this.view=null,this.toggle=this.toggle.bind(this)}initialize(){Rh(this,"nextBasemap",(e=>{e&&!e.loaded&&e.load().catch((()=>{}))}))}destroy(){this.view=null,Qv(this._basemapCache),this._basemapCache=null}get activeBasemap(){return eb(this.get("view.map.basemap")||"topo",this._basemapCache)}castNextBasemap(e){return eb(e,this._basemapCache)}get state(){return this.get("view.ready")?"ready":"disabled"}toggle(){if("disabled"===this.state)return;const e=this.activeBasemap,t=this.nextBasemap;this.view.map.basemap=t,this.nextBasemap=e,this.emit("toggle",{previous:e,current:t})}static getThumbnailUrl(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const i=tb(e);if(i)return $g[i].thumbnailUrl;const r=e.baseLayers.find((e=>!!Fv(e)().get("portalItem.thumbnailUrl")));return r?Fv(r)().get("portalItem.thumbnailUrl"):null}};Q([ro({readOnly:!0})],rte.prototype,"activeBasemap",null),Q([ro()],rte.prototype,"nextBasemap",void 0),Q([Ra("nextBasemap")],rte.prototype,"castNextBasemap",null),Q([ro({readOnly:!0})],rte.prototype,"state",null),Q([ro()],rte.prototype,"view",void 0),Q([ro()],rte.prototype,"toggle",null),rte=Q([Ro("esri.widgets.BasemapToggle.BasemapToggleViewModel")],rte);var ste=rte;const nte="esri-basemap-toggle esri-widget",ote="esri-basemap-toggle__image--secondary",ate="esri-basemap-thumbnail esri-basemap-toggle__container",lte="esri-basemap-thumbnail__image esri-basemap-toggle__image",hte="esri-basemap-toggle__image--loading",cte="esri-basemap-thumbnail__overlay esri-basemap-toggle__image-overlay",ute="esri-basemap-thumbnail__title esri-basemap-toggle__title",pte="esri-widget__loader-animation";function dte(e){const t=ste.getThumbnailUrl(e);return t?{backgroundImage:"url("+t+")"}:{backgroundImage:""}}const fte={title:!1};let yte=class extends xy{constructor(e,t){super(e,t),this.activeBasemap=null,this.label=void 0,this.messages=null,this.nextBasemap=null,this.view=null,this.viewModel=new ste,this.visibleElements=a({},fte)}castVisibleElements(e){return a(a({},fte),e)}toggle(){}render(){const e=this.viewModel,t="disabled"===e.state?null:e.activeBasemap,i="disabled"===e.state?null:e.nextBasemap,r=i?i.title:"",s=i&&"loaded"!==i.loadStatus;let n;return this.visibleElements.title&&r&&(n=Iy("div",{class:cte,key:"esri-basemap-toggle__overlay"},Iy("span",{class:ute,title:r},r))),Iy("div",{class:nte,role:"button","data-basemap-id":i?i.id:"",bind:this,onclick:this._toggle,onkeydown:this._toggle,tabIndex:0,title:this.label},Iy("div",{class:this.classes(ate,ote)},Iy("div",{class:lte,styles:dte(t)})),Iy("div",{class:ate},Iy("div",{class:this.classes(lte,s?hte:null),styles:dte(i)},s?Iy("span",{"aria-hidden":"true",role:"presentation",class:pte}):null),n))}_toggle(){this.toggle()}};Q([eh("viewModel.activeBasemap")],yte.prototype,"activeBasemap",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],yte.prototype,"label",void 0),Q([ro(),Sy("esri/widgets/BasemapToggle/t9n/BasemapToggle")],yte.prototype,"messages",void 0),Q([eh("viewModel.nextBasemap")],yte.prototype,"nextBasemap",void 0),Q([eh("viewModel.view")],yte.prototype,"view",void 0),Q([Ny("toggle"),ro({type:ste})],yte.prototype,"viewModel",void 0),Q([ro()],yte.prototype,"visibleElements",void 0),Q([Ra("visibleElements")],yte.prototype,"castVisibleElements",null),Q([eh("viewModel.toggle")],yte.prototype,"toggle",null),Q([Fy()],yte.prototype,"_toggle",null),yte=Q([Ro("esri.widgets.BasemapToggle")],yte);var gte=yte;let mte=class extends(RV(pU(Mw))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new Q$,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,t){return super.on(e,t)}graphicChanged(e){this.emit("graphic-update",e)}};Q([ro({type:WV})],mte.prototype,"elevationInfo",void 0),Q([ro(Z$())],mte.prototype,"graphics",void 0),Q([ro({type:["show","hide"]})],mte.prototype,"listMode",void 0),Q([ro()],mte.prototype,"screenSizePerspectiveEnabled",void 0),Q([ro({readOnly:!0})],mte.prototype,"type",void 0),Q([ro({constructOnly:!0})],mte.prototype,"internal",void 0),mte=Q([Ro("esri.layers.GraphicsLayer")],mte);var vte,bte=mte;function wte(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported"}return""}function _te(e,t){return v(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}function xte(e,t){return _te(!!m(e)&&e.hasZ,t)}function Ste(e){const t=Ite(e);return xte(e.geometry,t)}function Mte(e){const t=Ite(e),i=xte(e.geometry,t);return{mode:i,offset:m(t)&&"on-the-ground"!==i?S(t.offset,0)*VV(S(t.unit,"meters")):0}}function Tte(e){if("on-the-ground"===Ste(e))return!1;const t=Ite(e),i=m(t)&&t.featureExpressionInfo?t.featureExpressionInfo.expression:null;return!(!i||"0"===i)}function Ite(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function Ete(e,t,i){if(v(i)||!i.mode)return;const r=e.hasZ?e.z:0,s=m(i.offset)?i.offset:0;switch(i.mode){case"absolute-height":return r-s;case"on-the-ground":return 0;case"relative-to-ground":return r-(S(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"ground"),0)+s);case"relative-to-scene":return r-(S(t.elevationProvider.getElevation(e.x,e.y,e.z,e.spatialReference,"scene"),0)+s)}}function Ate(e,t,i,r=null){return Cte(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,r)}function Pte(e,t,i,r,s=null){return Cte(e,t[0],t[1],t.length>2?t[2]:0,i,r,s)}function Cte(e,t,i,r,s,n,o=null){if(v(n))return;const a=m(o)?o.mode:"absolute-height";return"on-the-ground"===a?0:function(e,t,i,r,s,n,o,a){const l=m(o)&&m(o.offset)?o.offset:0;switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-(S(n.elevationProvider.getElevation(t,i,r,s,"ground"),0)+l);case"relative-to-scene":return e-(S(n.elevationProvider.getElevation(t,i,r,s,"scene"),0)+l)}}(function(e,t,i,r,s,n){const o=m(n.offset)?n.offset:0;switch(n.mode){case"absolute-height":return i+o;case"on-the-ground":return S(s.elevationProvider.getElevation(e,t,0,r,"ground"),0);case"relative-to-ground":return i+S(s.elevationProvider.getElevation(e,t,i,r,"ground"),0)+o;case"relative-to-scene":return i+S(s.elevationProvider.getElevation(e,t,i,r,"scene"),0)+o}}(t,i,r,s,e,n),t,i,r,s,e,o,a)}function Ote(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if(v(e.geometry))return 2;switch(e.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;case"multipoint":case"extent":default:return 3}return"on-the-ground"!==Ste(e)&&Tte(e)?4:0}let kte=vte=class extends rw{constructor(...e){super(...e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(e,t){let i;if(e&&e.center)i=e;else{if(e&&e.rings)return super.normalizeCtorArgs(e,t);i={center:e}}return a(a(a({},super.normalizeCtorArgs()),i),t)}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e&&e.hasZ,0!==this.rings.length||!e)return;const i=FA(this.radius,this.radiusUnit,"meters"),r=e.spatialReference;let s,n="geographic";if(r.isWebMercator?n="webMercator":(null!=aa[r.wkid]||r.wkt&&0===r.wkt.indexOf("PROJCS"))&&(n="projected"),this.geodesic){let r;switch(n){case"webMercator":r=Ka(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=e}s=this._createGeodesicCircle(r,i,t),"webMercator"===n&&(s=Xa(s))}else{let r;"webMercator"===n||"projected"===n?r=i/this._convert2Meters(1,e.spatialReference):"geographic"===n&&(r=jA(i,"meters",xA(e.spatialReference).radius)),s=this._createPlanarCircle(e,r,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s}=this;return new vte({center:e.clone(),numberOfPoints:t,radius:i,radiusUnit:r,geodesic:s})}_createGeodesicCircle(e,t,i){let r=0;const s=[];for(;r<360;){const n=[0,0];E8(n,[e.x,e.y],r,t),this.hasZ&&n.push(e.z),s.push(n),r+=360/i}return s.push(s[0]),new rw(s)}_createPlanarCircle(e,t,i){const r=[],s=2*Math.PI/i;for(let n=0;n<i;++n){const i=s*n,o=[e.x+Math.cos(-i)*t,e.y+Math.sin(-i)*t];this.hasZ&&o.push(e.z),r.push(o)}return r.push(r[0]),new rw({spatialReference:e.spatialReference,rings:[r]})}_convert2Meters(e,t){let i;if(null!=aa[t.wkid])i=aa.values[aa[t.wkid]];else{const e=t.wkt,r=e.lastIndexOf(",")+1,s=e.lastIndexOf("]]");i=parseFloat(e.substring(r,s))}return e*i}};Q([ro({type:il})],kte.prototype,"center",void 0),Q([ro()],kte.prototype,"geodesic",void 0),Q([ro()],kte.prototype,"numberOfPoints",void 0),Q([ro()],kte.prototype,"radius",void 0),Q([ro()],kte.prototype,"radiusUnit",void 0),kte=vte=Q([Ro("esri.geometry.Circle")],kte);var Lte=kte;function Rte(e){return Fte(e).result}function Dte(e){return Fte(e).geometry}function Fte(e){var t;return"graphics"!==(null==(t=e.layer)?void 0:t.type)?{result:1,geometry:null}:v(e.geometry)?{result:2,geometry:null}:"on-the-ground"!==Ste(e)&&Tte(e)?{result:4,geometry:null}:"point"!==e.geometry.type&&"polyline"!==e.geometry.type&&("polygon"!==e.geometry.type||e.geometry instanceof Lte)?{result:3,geometry:null}:{result:0,geometry:e.geometry}}function jte(e){return 32+e.length}function Nte(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=jte(r);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function zte(e,t){return 32+e.length*t}function Vte(e=yie){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Ute(e,t,i,r,s,n,o=Vte()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function Gte(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function Bte(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function qte(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Hte(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],h=e[5];for(let c=0;c<r;c++)s=Math.min(s,t[i+3*c]),n=Math.min(n,t[i+3*c+1]),o=Math.min(o,t[i+3*c+2]),a=Math.max(a,t[i+3*c]),l=Math.max(l,t[i+3*c+1]),h=Math.max(h,t[i+3*c+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=h}function Wte(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],h=e[5];if(i)for(let c=0;c<r;c++){const e=t[c];s=Math.min(s,e[0]),n=Math.min(n,e[1]),o=Math.min(o,e[2]),a=Math.max(a,e[0]),l=Math.max(l,e[1]),h=Math.max(h,e[2])}else for(let c=0;c<r;c++){const e=t[c];s=Math.min(s,e[0]),n=Math.min(n,e[1]),a=Math.max(a,e[0]),l=Math.max(l,e[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=h}function $te(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function Jte(e){return e[0]>=e[3]?0:e[3]-e[0]}function Xte(e){return e[1]>=e[4]?0:e[4]-e[1]}function Kte(e){return e[2]>=e[5]?0:e[5]-e[2]}function Yte(e){const t=Jte(e),i=Kte(e),r=Xte(e);return Math.sqrt(t*t+i*i+r*r)}function Zte(e,t=[0,0,0]){return t[0]=e[0]+Jte(e)/2,t[1]=e[1]+Xte(e)/2,t[2]=e[2]+Kte(e)/2,t}function Qte(e,t=[0,0,0]){return t[0]=Jte(e),t[1]=Xte(e),t[2]=Kte(e),t}function eie(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function tie(e,t){return!!v(t)||function(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}(e,t)}function iie(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function rie(e,t,i=e){const r=e[0]+Jte(e)/2,s=e[1]+Xte(e)/2,n=e[2]+Kte(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function sie(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function nie(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function oie(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function aie(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function lie(e){return e?aie(e,fie):Vte(fie)}function hie(e,t){return t||(t=v$()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function cie(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function uie(e){return 6===e.length}function pie(e){return 0===Jte(e)&&0===Xte(e)&&0===Kte(e)}function die(e,t,i){if(v(e)||v(t))return e===t;if(!uie(e)||!uie(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const fie=[1/0,1/0,1/0,-1/0,-1/0,-1/0],yie=[0,0,0,0,0,0];Vte();const gie=(e,t,i)=>[t,i],mie=(e,t,i)=>[t,i,e[2]],vie=(e,t,i)=>[t,i,e[2],e[3]];function bie(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function wie({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function _ie({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function xie(e,t,i){const r=[];let s,n,o,a;for(let l=0;l<i.length;l++){const h=i[l];l>0?(o=wie(e,h[0]),a=_ie(e,h[1]),o===s&&a===n||(r.push(t(h,o-s,a-n)),s=o,n=a)):(s=wie(e,h[0]),n=_ie(e,h[1]),r.push(t(h,s,n)))}return r.length>0?r:null}function Sie({scale:e,translate:t},i){return i*e[0]+t[0]}function Mie({scale:e,translate:t},i){return t[1]-i*e[1]}function Tie(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=Sie(e,i[0][0]),a=Mie(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const e=i[l];o+=e[0]*s,a-=e[1]*n,r[l]=t(e,o,a)}return r}function Iie(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=Tie(e,t,i[s]);return r}function Eie(e,t,i,r,s){return t.points=function(e,t,i,r){return xie(e,i?r?vie:mie:r?mie:gie,t)}(e,i.points,r,s),t}function Aie(e,t,i,r,s){return t.x=wie(e,i.x),t.y=_ie(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function Pie(e,t,i,r,s){const n=function(e,t,i,r){const s=[],n=i?r?vie:mie:r?mie:gie;for(let o=0;o<t.length;o++){const i=xie(e,n,t[o]);i&&i.length>=3&&s.push(i)}return s.length?s:null}(e,i.rings,r,s);return n?(t.rings=n,t):null}function Cie(e,t,i,r,s){const n=function(e,t,i,r){const s=[],n=i?r?vie:mie:r?mie:gie;for(let o=0;o<t.length;o++){const i=xie(e,n,t[o]);i&&i.length>=2&&s.push(i)}return s.length?s:null}(e,i.paths,r,s);return n?(t.paths=n,t):null}function Oie(e,t){return e&&t?cw(t)?Aie(e,{},t,!1,!1):uw(t)?Cie(e,{},t,!1,!1):pw(t)?Pie(e,{},t,!1,!1):hw(t)?Eie(e,{},t,!1,!1):lw(t)?function(e,t,i,r,s){return t.xmin=wie(e,i.xmin),t.ymin=_ie(e,i.ymin),t.xmax=wie(e,i.xmax),t.ymax=_ie(e,i.ymax),t!==i&&(r&&(t.zmin=i.zmin,t.zmax=i.zmax),s&&(t.mmin=i.mmin,t.mmax=i.mmax)),t}(e,{},t,!1,!1):null:null}function kie(e,t,i,r,s){return t.points=function(e,t,i,r){return Tie(e,i?r?vie:mie:r?mie:gie,t)}(e,i.points,r,s),t}function Lie(e,t,i,r,s){return t.x=Sie(e,i.x),t.y=Mie(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function Rie(e,t,i,r,s){return t.rings=function(e,t,i,r){return Iie(e,i?r?vie:mie:r?mie:gie,t)}(e,i.rings,r,s),t}function Die(e,t,i,r,s){return t.paths=function(e,t,i,r){return Iie(e,i?r?vie:mie:r?mie:gie,t)}(e,i.paths,r,s),t}function Fie(e,t){return!!function(e,t){return e===t||e&&t&&e.equals(t)}(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}class jie{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function Nie(e){return m(e.geometry)}class zie{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function Vie(e,t,i,r){return{x:e,y:t,z:i,hasZ:null!=i,hasM:!1,spatialReference:r,type:"point"}}function Uie(e){if(v(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function Gie(e,t){switch(lie(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)Wte(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)Wte(t,e.rings[i],e.hasZ);break;case"multipoint":Wte(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function Bie(e,t){switch(z$(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)T$(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)T$(t,e.rings[i]);break;case"multipoint":T$(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function qie(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}Vte(),v$();const Hie={main:new Rv([255,127,0]),selected:new Rv([255,255,255]),outline:new Rv([0,0,0,.5]),selectedOutline:new Rv([255,255,255]),hoverOutline:new Rv([255,255,255]),secondary:new Rv([255,255,255]),secondaryOutline:new Rv([100,100,100]),transparent:new Rv([0,0,0,0])};function Wie(e,t){if(t)for(const i in t)e[i]=t[i]}class $ie{constructor(e){this.size=8,this.hoverSize=10,this.color=Hie.main,this.hoverColor=Hie.main,this.outlineColor=Hie.outline,this.hoverOutlineColor=Hie.hoverOutline,Wie(this,e)}}class Jie{constructor(e){this.color=Hie.secondary,this.hoverColor=Hie.main,Wie(this,e)}}class Xie{constructor(e){this.color=Hie.transparent,this.hoverColor=Hie.transparent,this.outlineColor=Hie.main,this.hoverOutlineColor=Hie.main,this.stagedColor=Hie.transparent,this.stagedOutlineColor=Hie.secondary,Wie(this,e)}}class Kie{constructor(e){this.vertex=new $ie,this.midpoint=new $ie({color:Hie.secondary,outlineColor:Hie.secondaryOutline,size:6}),this.selected=new $ie({color:Hie.selected,hoverColor:Hie.selected,hoverOutlineColor:Hie.hoverOutline}),Wie(this,e)}}class Yie{constructor(e){this.center=new $ie({color:Hie.secondaryOutline}),this.fill=new Xie,this.line=new Jie,this.vertex=new $ie({color:Hie.selected,outlineColor:Hie.main,hoverColor:Hie.selected,hoverOutlineColor:Hie.secondaryOutline}),Wie(this,e)}}const Zie=new class{constructor(e){this.reshapeGraphics=new Kie,this.transformGraphics=new Yie,Wie(this,e)}};let Qie=class extends Ko{constructor(){super(...arguments),this.enabled=!0}};Q([ro({type:Boolean})],Qie.prototype,"enabled",void 0),Qie=Q([Ro("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Qie);let ere=class extends Ko{constructor(e){super(e),this.lineSnapper=new Qie,this.parallelLineSnapper=new Qie,this.rightAngleSnapper=new Qie,this.rightAngleTriangleSnapper=new Qie,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new Rv([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};Q([ro({type:Qie,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ere.prototype,"lineSnapper",void 0),Q([ro({type:Qie,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ere.prototype,"parallelLineSnapper",void 0),Q([ro({type:Qie,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ere.prototype,"rightAngleSnapper",void 0),Q([ro({type:Qie,constructOnly:!0,nonNullable:!0,json:{write:!0}})],ere.prototype,"rightAngleTriangleSnapper",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],ere.prototype,"shortLineThreshold",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],ere.prototype,"distance",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ere.prototype,"pointThreshold",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ere.prototype,"intersectionParallelLineThreshold",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ere.prototype,"parallelLineThreshold",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ere.prototype,"touchSensitivityMultiplier",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],ere.prototype,"pointOnLineThreshold",void 0),Q([ro({type:Rv,nonNullable:!0})],ere.prototype,"orange",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ere.prototype,"lineHintWidthReference",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ere.prototype,"lineHintWidthTarget",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ere.prototype,"lineHintFadedExtensions",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],ere.prototype,"parallelLineHintWidth",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],ere.prototype,"parallelLineHintLength",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],ere.prototype,"parallelLineHintOffset",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],ere.prototype,"rightAngleHintSize",void 0),Q([ro({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],ere.prototype,"rightAngleHintOutlineSize",void 0),ere=Q([Ro("esri.views.interactive.snapping.Settings.Defaults")],ere);const tre=new ere;function ire(e,t){const i=e.x-t.x,r=e.y-t.y;return i*i+r*r}function rre(e,t){const i=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return i;case 3:return i&&e[2]===t[2];case 4:return i&&e[3]===t[3]}return!1}function sre(e,t,i,r){return"2d"===r.type?r.toScreen(t.toPoint(e,hre)):(nre(e,t,i,r,are),r.state.camera.projectToScreen(are,lre),FS(lre[0],lre[1]))}function nre(e,t,i,r,s=[0,0,0]){const n=t.toXYZ(e);return n[2]=Pte(r,n,t.spatialReference,i)||0,r.renderCoordsHelper.toRenderCoords(n,t.spatialReference,s),s}function ore(e,t){t.sort(((t,i)=>NX(t.targetPoint,e)-NX(i.targetPoint,e)))}const are=[0,0,0],lre=jS(),hre=new il;class cre{}class ure extends cre{constructor(e){super(),this.intersectionPoint=e}equals(e){return e instanceof ure&&rre(this.intersectionPoint,e.intersectionPoint)}}Ne.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class pre extends cre{constructor(e,t,i,r=!0,s=!0){super(),this.type=e,this.lineStart=t,this.lineEnd=i,this.fadeLeft=r,this.fadeRight=s}equals(e){return e instanceof pre&&this.type===e.type&&rre(this.lineStart,e.lineStart)&&rre(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}Ne.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class dre extends cre{constructor(e,t){super(),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof dre&&rre(this.lineStart,e.lineStart)&&rre(this.lineEnd,e.lineEnd)}}class fre extends cre{constructor(e){super(),this.point=e}equals(e){return e instanceof fre&&rre(this.point,e.point)}}Ne.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class yre extends cre{constructor(e,t,i){super(),this.previousVertex=e,this.centerVertex=t,this.nextVertex=i}equals(e){return e instanceof yre&&rre(this.previousVertex,e.previousVertex)&&rre(this.centerVertex,e.centerVertex)&&rre(this.nextVertex,e.nextVertex)}}class gre{draw(e,t){const i=this.getUniqueHints(e),r=[];for(const s of i)s instanceof ure&&r.push(this.visualizeIntersectionPoint(s,t)),s instanceof pre&&r.push(this.visualizeLine(s,t)),s instanceof dre&&r.push(this.visualizeParallelSign(s,t)),s instanceof yre&&r.push(this.visualizeRightAngleQuad(s,t)),s instanceof fre&&r.push(this.visualizePoint(s,t));return _r(r)}getUniqueHints(e){const t=[];for(const i of e){let e=!0;for(const r of t)if(i.equals(r)){e=!1;break}e&&t.push(i)}return t}}class mre extends gre{constructor(e){super(),this.graphicsLayer=e}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new il({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.coordinateHelper.spatialReference}),wre)}visualizePoint(e,t){return this._visualizeSnappingIndicator(new il({x:e.point[0],y:e.point[1],spatialReference:t.coordinateHelper.spatialReference}),_re)}visualizeLine(e,t){return this._visualizeSnappingIndicator(new nw({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),xre)}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new nw({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),Sre)}visualizeRightAngleQuad(e,t){return this._visualizeSnappingIndicator(new nw({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.coordinateHelper.spatialReference}),Ere(e))}_visualizeSnappingIndicator(e,t){const i=new fE({geometry:e,symbol:t});return this.graphicsLayer.add(i),xr((()=>{this.graphicsLayer.remove(i)}))}}const vre=Hie.main.toArray(),bre=[...Hie.main.toRgb(),100],wre=new $I({outline:new fM({width:1.5,color:vre}),size:15,color:[0,0,0,0]}),_re=new $I({outline:{width:.5,color:[0,0,0,1]},size:10,color:vre}),xre=new PS({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:RS(tre.lineHintWidthTarget),color:vre}]}}}),Sre=new PS({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:vre}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:vre}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),Mre=e=>new PS({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:RS(tre.rightAngleHintSize),rotation:e,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:RS(tre.rightAngleHintOutlineSize),color:vre},{type:"CIMSolidFill",enable:!0,color:bre}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),Tre=Mre(45),Ire=Mre(225),Ere=(()=>{const e=[0,0],t=[0,0],i=[0,0,0];return r=>(CX(e,r.centerVertex,r.previousVertex),CX(t,r.nextVertex,r.previousVertex),qX(i,e,t),i[2]<0?Tre:Ire)})();function Are(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Pre(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function Cre(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function Ore(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function kre(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function Lre(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function Rre(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Dre(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function Fre(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function jre(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function Nre(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function zre(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function Vre(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ure(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function Gre(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function Bre(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function qre(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],h=t[3];return Math.abs(i-o)<=Am*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Am*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Am*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-h)<=Am*Math.max(1,Math.abs(n),Math.abs(h))}const Hre=Ore,Wre=kre,$re=Lre,Jre=Dre,Xre=Fre,Kre=jre,Yre=Nre;function Zre(){return[0,0,0,0]}function Qre(e){return[e[0],e[1],e[2],e[3]]}function ese(e,t,i,r){return[e,t,i,r]}function tse(e){const t=[0,0,0,0],i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function ise(e,t){return new Float64Array(e,t,4)}function rse(){return[0,0,0,0]}function sse(){return ese(1,1,1,1)}function nse(){return ese(1,0,0,0)}function ose(){return ese(0,1,0,0)}function ase(){return ese(0,0,1,0)}function lse(){return ese(0,0,0,1)}Object.freeze({__proto__:null,copy:Are,set:Pre,add:Cre,subtract:Ore,multiply:kre,divide:Lre,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},max:function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:Rre,scaleAndAdd:function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},distance:Dre,squaredDistance:Fre,length:jre,squaredLength:Nre,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:zre,dot:Vre,lerp:Ure,random:function(e,t){let i,r,s,n,o,a;t=t||1;do{i=2*Pm()-1,r=2*Pm()-1,o=i*i+r*r}while(o>=1);do{s=2*Pm()-1,n=2*Pm()-1,a=s*s+n*n}while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e},transformMat4:Gre,transformQuat:function(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],h=i[3],c=h*r+a*n-l*s,u=h*s+l*r-o*n,p=h*n+o*s-a*r,d=-o*r-a*s-l*n;return e[0]=c*h+d*-o+u*-l-p*-a,e[1]=u*h+d*-a+p*-o-c*-l,e[2]=p*h+d*-l+c*-a-u*-o,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:Bre,equals:qre,sub:Hre,mul:Wre,div:$re,dist:Jre,sqrDist:Xre,len:Kre,sqrLen:Yre});const hse=[0,0,0,0],cse=sse(),use=nse(),pse=ose(),dse=ase(),fse=lse();Object.freeze({__proto__:null,create:Zre,clone:Qre,fromValues:ese,fromArray:tse,createView:ise,zeros:rse,ones:sse,unitX:nse,unitY:ose,unitZ:ase,unitW:lse,ZEROS:hse,ONES:cse,UNIT_X:use,UNIT_Y:pse,UNIT_Z:dse,UNIT_W:fse});const yse=[0,0];class gse{constructor(e,t){this.spatialReference=e,this.viewingMode=t,this._unnormalizationInfo=_se(e,t)}tag(e){return e}createNew(){return this.tag([0,0])}fromPoint(e){return this.tag(nK(e.x,e.y))}fromArray(e){return this.tag(nK(e[0],e[1]))}toArray(e){return[e[0],e[1]]}clone(e){return this.tag(oK(e))}copy(e,t){return EX(t,e)}toPoint(e,t){return t.x=e[0],t.y=e[1],t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}createPoint(e){return new il({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new il({x:e[0],y:e[1],z:void 0,m:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:void 0,m:void 0,hasZ:!1,hasM:!1,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,r){return HX(r,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}scale(e,t,i,r){const s=CX(yse,e,t);FX(e,e,DX(yse,i,BX(i,s)),r-1)}rotate(e,t,i){JX(e,e,t,i)}pointToArray(e){return[e.x,e.y]}getZ(e,t){return t}hasZ(){return!1}getM(e,t){return t}hasM(){return!1}unnormalize(e){wse(e,this._unnormalizationInfo)}fromXYZ(e){return this.tag(nK(e[0],e[1]))}toXYZ(e,t=0){return ym(e[0],e[1],t)}distance(e,t){return jX(e,t)}}class mse{constructor(e,t,i){this.valueType=e,this.spatialReference=t,this._unnormalizationInfo=_se(t,i)}distance(e,t){return 0===this.valueType?Bm(e,t):jX(e,t)}tag(e){return e}createNew(){return this.tag([0,0,0])}fromPoint(e){return this.tag(ym(e.x,e.y,0===this.valueType?e.z:e.m))}fromArray(e){return this.tag(ym(e[0],e[1],e[2]||0))}toArray(e){return[e[0],e[1],e[2]]}clone(e){return this.tag(gm(e))}copy(e,t){return Dm(t,e)}toPoint(e,t){return t.x=e[0],t.y=e[1],0===this.valueType?(t.z=e[2],t.hasZ=!0,t.hasM=!1):(t.m=e[2],t.hasZ=!1,t.hasM=!0),t.spatialReference=this.spatialReference,t}createPoint(e){return new il({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createPointFromArray(e){return new il({x:e[0],y:e[1],z:0===this.valueType?e[2]:void 0,m:1===this.valueType?e[2]:void 0,spatialReference:this.spatialReference})}createDehydratedPoint(e){const t=0===this.valueType,i=1===this.valueType;return{x:e[0],y:e[1],z:t?e[2]:void 0,m:i?e[2]:void 0,hasZ:t,hasM:i,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,r){return Km(r,e,t,i)}addDelta(e,t,i,r){e[0]+=t,e[1]+=i,0===this.valueType&&(e[2]+=r)}scale(e,t,i,r){const s=CX(yse,e,t);FX(e,e,DX(yse,i,BX(i,s)),r-1)}rotate(e,t,i){JX(e,e,t,i)}pointToArray(e){return 0===this.valueType?[e.x,e.y,e.z]:[e.x,e.y,e.m]}getZ(e,t){return 0===this.valueType?e[2]:t}hasZ(){return 0===this.valueType}getM(e,t){return 1===this.valueType?e[2]:t}hasM(){return 1===this.valueType}unnormalize(e){wse(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag(ym(e[0],e[1],0===this.valueType?e.length>2?e[2]:t:i))}toXYZ(e,t=0){return this.tag(ym(e[0],e[1],0===this.valueType?e[2]:t))}}class vse{constructor(e,t){this.spatialReference=e,this._unnormalizationInfo=_se(e,t)}distance(e,t){return Bm(e,t)}tag(e){return e}createNew(){return this.tag([0,0,0,0])}fromPoint(e){return this.tag(ese(e.x,e.y,e.z,e.m))}fromArray(e){return this.tag(ese(e[0],e[1],e[2]||0,e[3]||0))}toArray(e){return[e[0],e[1],e[2],e[3]]}clone(e){return this.tag(tse(e))}copy(e,t){return Are(t,e)}toPoint(e,t){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}createPoint(e){return new il({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createPointFromArray(e){return new il({x:e[0],y:e[1],z:e[2],m:e[3],spatialReference:this.spatialReference})}createDehydratedPoint(e){return{x:e[0],y:e[1],z:e[2],m:e[3],hasZ:!0,hasM:!0,spatialReference:this.spatialReference,type:"point"}}lerp(e,t,i,r){return Ure(r,e,t,i)}addDelta(e,t,i,r){e[0]+=t,e[1]+=i,e[2]+=r}scale(e,t,i,r){const s=CX(yse,e,t);FX(e,e,DX(yse,i,BX(i,s)),r-1)}rotate(e,t,i){JX(e,e,t,i)}pointToArray(e){return[e.x,e.y,e.z,e.m]}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}unnormalize(e){wse(e,this._unnormalizationInfo)}fromXYZ(e,t=0,i=0){return this.tag(ese(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e){return ym(e[0],e[1],e[2])}}function bse(e,t,i,r){return e&&t?new vse(i,r):t?new mse(1,i,r):e?new mse(0,i,r):new gse(i,r)}function wse(e,t){if(!t.supported)return;let i=1/0,r=-1/0;const s=t.upperBoundX-t.lowerBoundX;e.forEach((e=>{let n=e.pos[0];for(;n<t.lowerBoundX;)n+=s;for(;n>t.upperBoundX;)n-=s;i=Math.min(i,n),r=Math.max(r,n),e.pos[0]=n}));const n=r-i;s-n<n&&e.forEach((e=>{e.pos[0]<0&&(e.pos[0]+=s)}))}function _se(e,t){const i=ya(e);return"global"===t&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}class xse{constructor(e){this.left=null,this.right=null,this.type="vertex",this.index=null,this.component=e}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}}class Sse{constructor(e,t,i){this.type="edge",this.component=e,this.left=t,this.right=i,t.right=this,i.left=this}}class Mse{constructor(e){this.vertices=[],this.edges=[],this.data=e}unnormalizeVertexPositions(){this.vertices.length<=1||this.data.coordinateHelper.unnormalize(this.vertices)}updateVertexIndex(e,t){if(0===this.vertices.length)return;const i=this.vertices[0];let r=null,s=e,n=t;do{r=s,r.index=n++,s=r.right?r.right.right:null}while(null!=s&&s!==i);r.left&&r!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(r),this.vertices.length-1)}getFirstVertex(){return 0===this.vertices.length?null:this.vertices[0]}getLastVertex(){return 0===this.vertices.length?null:this.vertices[this.vertices.length-1]}isClosed(){return this.vertices.length>2&&null!==this.vertices[0].left}swapVertices(e,t){const i=this.vertices[e];this.vertices[e]=this.vertices[t],this.vertices[t]=i}iterateVertices(e){if(0===this.vertices.length)return;const t=this.vertices[0];let i=t;do{e(i,i.index),i=m(i.right)?i.right.right:null}while(i!==t&&null!=i)}}class Tse extends sh{constructor(e){super(),this.coordinateHelper=e,this.undoStack=[],this.redoStack=[],this.components=[]}apply(e,t=1){return 0!==t&&!v(this.lastOperation)&&this.lastOperation.accumulate(e)||(e.apply(),this.undoStack.push(e),this.redoStack=[]),e}undo(){if(this.undoStack.length>0){const e=this.undoStack.pop();return e.undo(),this.redoStack.push(e),e}return null}get canUndo(){return this.undoStack.length>0}get lastOperation(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();return e.apply(),this.undoStack.push(e),e}return null}get canRedo(){return this.redoStack.length>0}toPoint(){return 0===this.components.length||0===this.components[0].vertices.length?null:this.coordinateHelper.createPoint(this.components[0].vertices[0].pos)}toPolyline(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((i,r)=>{const s=[];let n=i.vertices.find((e=>null==e.left));const o=n;do{s.push(t(n.pos)),n=n.right?n.right.right:null}while(n&&n!==o);e.push(s)})),new nw({paths:e,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}toPolygon(){const e=[],t=this.coordinateHelper.toArray;return this.components.forEach(((i,r)=>{const s=[],n=i.vertices[0];let o=n;const a=o;do{s.push(t(o.pos)),o=m(o.right)?o.right.right:null}while(o&&o!==a);i.isClosed()&&s.push(t(n.pos)),e.push(s)})),new rw({rings:e,spatialReference:this.coordinateHelper.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(e,t){const i=bse(e.hasZ,e.hasM,e.spatialReference,t),r=new Tse(i);switch(e.type){case"polygon":{const t=e.rings;for(let e=0;e<t.length;++e){const s=t[e],n=new Mse(r),o=s.length>2&&ns(s[0],s[s.length-1]),a=o?s.length-1:s.length;for(let e=0;e<a;++e){const t=i.fromArray(s[e]),r=new xse(n);n.vertices.push(r),r.pos=t,r.index=e}const l=n.vertices.length-1;for(let e=0;e<l;++e){const t=n.vertices[e],i=n.vertices[e+1],r=new Sse(n,t,i);n.edges.push(r)}if(o){const e=new Sse(n,n.vertices[n.vertices.length-1],n.vertices[0]);n.edges.push(e)}r.components.push(n)}}break;case"polyline":for(const t of e.paths){const e=new Mse(r),s=t.length;for(let r=0;r<s;++r){const s=i.fromArray(t[r]),n=new xse(e);e.vertices.push(n),n.pos=s,n.index=r}const n=e.vertices.length-1;for(let t=0;t<n;++t){const i=e.vertices[t],r=e.vertices[t+1],s=new Sse(e,i,r);e.edges.push(s)}r.components.push(e)}break;case"point":{const t=new Mse(r),i=new xse(t);i.index=0,i.pos=r.coordinateHelper.fromPoint(e),t.vertices.push(i),r.components.push(t)}}return r}}class Ise{constructor(e,t,i){this.editGeometry=e,this.component=t,this.pos=i,this.addedVertex=null,this.originalEdge=null,this.left=null,this.right=null}apply(){let e="redo";v(this.addedVertex)&&(e="apply",this.addedVertex=new xse(this.component));const t=this.component.getLastVertex();if(v(t))this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,this.addedVertex.index=0;else{let e=null;t.right&&(this.originalEdge=t.right,e=this.originalEdge.right,this.component.edges.splice(this.component.edges.indexOf(this.originalEdge),1)),this.component.vertices.push(this.addedVertex),this.addedVertex.pos=this.pos,v(this.left)&&(this.left=new Sse(this.component,t,this.addedVertex)),this.component.edges.push(this.left),t.right=this.left,m(this.originalEdge)&&m(e)&&(v(this.right)&&(this.right=new Sse(this.component,this.addedVertex,e)),this.component.edges.push(this.right),e.left=this.right),this.component.updateVertexIndex(this.addedVertex,t.index+1)}const i={addedVertices:[this.addedVertex],operation:e};this.editGeometry.emit("change",i)}undo(){if(v(this.addedVertex))return null;this.component.vertices.splice(this.component.vertices.indexOf(this.addedVertex),1),m(this.left)&&(this.component.edges.splice(this.component.edges.indexOf(this.left),1),this.left.left.right=null),m(this.right)&&(this.component.edges.splice(this.component.edges.indexOf(this.right),1),this.right.right.left=null),m(this.originalEdge)&&(this.component.edges.push(this.originalEdge),this.originalEdge.left.right=this.originalEdge,this.originalEdge.right.left=this.originalEdge),m(this.left)?this.component.updateVertexIndex(this.left.left,this.left.left.index):this.component.updateVertexIndex(this.addedVertex,0);const e={removedVertices:[this.addedVertex],operation:"undo"};this.editGeometry.emit("change",e)}accumulate(){return!1}}class Ese{constructor(e,t,i){this.editGeometry=e,this.vertices=t,this.operation=i,this.undone=!1}apply(){this.vertices.forEach((e=>this.operation.apply(e))),this.editGeometry.components.forEach((e=>e.unnormalizeVertexPositions()));const e={updatedVertices:this.vertices,operation:this.undone?"redo":"apply"};this.editGeometry.emit("change",e)}undo(){this.vertices.forEach((e=>this.operation.undo(e)));const e={updatedVertices:this.vertices,operation:"undo"};this.editGeometry.emit("change",e),this.undone=!0}canAccumulate(e){if(this.undone||e.vertices.length!==this.vertices.length)return!1;for(let t=0;t<e.vertices.length;++t)if(e.vertices[t]!==this.vertices[t])return!1;return this.operation.canAccumulate(e.operation)}accumulate(e){if(e instanceof Ese&&this.canAccumulate(e)){this.vertices.forEach((t=>this.operation.accumulate(t,e.operation))),this.operation.accumulateParams(e.operation),this.editGeometry.components.forEach((e=>e.unnormalizeVertexPositions()));const t={updatedVertices:this.vertices,operation:"apply"};return this.editGeometry.emit("change",t),!0}return!1}}class Ase{constructor(e){this.helper=e}}class Pse{constructor(e,t,i=0){this.editGeometry=e,this.vertices=t,this.minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";null==this.removedVertices?(this.removedVertices=[],this.vertices.forEach((e=>{const t=this._removeVertex(e);m(t)&&this.removedVertices.push(t)})),e="apply"):this.removedVertices.forEach((e=>{this._removeVertex(e.removedVertex)}));const t={removedVertices:this.vertices,operation:e};this.editGeometry.emit("change",t)}undo(){this.removedVertices.forEach((e=>{this._undoRemoveVertex(e)}));const e={addedVertices:this.vertices,operation:"undo"};this.editGeometry.emit("change",e)}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this.minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},r=e.left,s=e.right;return t.vertices.splice(t.vertices.indexOf(e),1),r&&(t.edges.splice(t.edges.indexOf(r),1),r.left.right=null),s&&(t.edges.splice(t.edges.indexOf(s),1),s.right.left=null),0===e.index&&s&&this.vertices.length>0&&t.swapVertices(t.vertices.indexOf(s.right),0),r&&s&&(i.createdEdge=new Sse(t,r.left,s.right),t.edges.push(i.createdEdge)),s&&t.updateVertexIndex(s.right,s.right.index-1),i}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,r=t.left,s=t.right;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),r&&(i.edges.push(r),r.left.right=r),s&&(i.edges.push(s),s.right.left=s),i.updateVertexIndex(t,t.index)}}class Cse{constructor(e,t,i){this.editGeometry=e,this.edge=t,this.t=i,this.createdVertex=null,this.left=null,this.right=null}apply(){let e="redo";const t=this.edge,i=t.component,r=t.component.data,s=t.left,n=t.right;i.edges.splice(i.edges.indexOf(t),1),v(this.createdVertex)&&(e="apply",this.createdVertex=new xse(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=r.coordinateHelper.lerp(t.left.pos,t.right.pos,this.t,r.coordinateHelper.createNew()),v(this.left)&&(this.left=new Sse(i,s,this.createdVertex)),this.left.left.left?i.edges.push(this.left):i.edges.unshift(this.left),s.right=this.left,v(this.right)&&(this.right=new Sse(i,this.createdVertex,n)),i.edges.push(this.right),n.left=this.right,i.updateVertexIndex(this.createdVertex,s.index+1);const o={addedVertices:[this.createdVertex],operation:e};this.editGeometry.emit("change",o)}undo(){if(v(this.createdVertex)||v(this.left)||v(this.right))return null;const e=this.edge,t=e.component,i=this.createdVertex.left,r=this.createdVertex.right,s=i.left,n=r.right;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this.left),1),t.edges.splice(t.edges.indexOf(this.right),1),this.edge.left.left?t.edges.push(this.edge):t.edges.unshift(this.edge),s.right=e,n.left=e,t.updateVertexIndex(s,s.index);const o={removedVertices:[this.createdVertex],operation:"undo"};this.editGeometry.emit("change",o)}accumulate(){return!1}}class Ose extends Ase{constructor(e,t,i,r){super(e),this.dx=t,this.dy=i,this.dz=r}move(e,t,i,r){this.helper.addDelta(e.pos,t,i,r)}apply(e){this.move(e,this.dx,this.dy,this.dz)}undo(e){this.move(e,-this.dx,-this.dy,-this.dz)}canAccumulate(e){return e instanceof Ose}accumulate(e,t){this.move(e,t.dx,t.dy,t.dz)}accumulateParams(e){this.dx+=e.dx,this.dy+=e.dy,this.dz+=e.dz}}class kse{constructor(e){this.allocator=e,this.items=[],this.itemsPtr=0,this.tickHandle=js.before((()=>this.reset())),this.grow()}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=(this.tickHandle,null)),this.items=(this.items,null)}get(){return 0===this.itemsPtr&&js((()=>{})),this.itemsPtr===this.items.length&&this.grow(),this.items[this.itemsPtr++]}reset(){const e=Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*Lse);this.items.length=Math.min(e,this.items.length),this.itemsPtr=0}grow(){for(let e=0;e<Math.max(8,Math.min(this.items.length,Lse));e++)this.items.push(this.allocator())}}const Lse=1024;function Rse(){return[1,0,0,0,1,0,0,0,1]}function Dse(e,t){return new Float64Array(e,t,9)}function Fse(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jse(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function Nse(e,t,i,r,s,n,o,a,l,h,c,u,p,d,f,y){return[e,t,i,r,s,n,o,a,l,h,c,u,p,d,f,y]}function zse(e,t){return new Float64Array(e,t,16)}Object.freeze({__proto__:null,create:Rse,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},fromValues:function(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]},createView:Dse});const Vse=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function Use(){return[0,0,0,1]}function Gse(e){return[e[0],e[1],e[2],e[3]]}function Bse(e,t){return new Float64Array(e,t,4)}Object.freeze({__proto__:null,create:Fse,clone:jse,fromValues:Nse,createView:zse,IDENTITY:Vse});const qse=[0,0,0,1];Object.freeze({__proto__:null,create:Use,clone:Gse,fromValues:function(e,t,i,r){return[e,t,i,r]},createView:Bse,IDENTITY:qse});class Hse{constructor(e,t,i){this.itemByteSize=e,this.itemCreate=t,this.buffers=[],this.items=[],this.itemsPerBuffer=0,this.itemsPtr=0,this.itemsPerBuffer=Math.ceil(i/this.itemByteSize),this.tickHandle=js.before((()=>this.reset()))}destroy(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=(this.tickHandle,null)),this.itemsPtr=0,this.items=(this.items,null),this.buffers=(this.buffers,null)}get(){0===this.itemsPtr&&js((()=>{}));const e=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=e;){const e=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let t=0;t<this.itemsPerBuffer;++t)this.items.push(this.itemCreate(e,t*this.itemByteSize));this.buffers.push(e)}return this.items[this.itemsPtr++]}reset(){const e=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>e;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0}static createVec2f64(e=Wse){return new Hse(16,aK,e)}static createVec3f64(e=Wse){return new Hse(24,mm,e)}static createVec4f64(e=Wse){return new Hse(32,ise,e)}static createMat3f64(e=Wse){return new Hse(72,Dse,e)}static createMat4f64(e=Wse){return new Hse(128,zse,e)}static createQuatf64(e=Wse){return new Hse(32,Bse,e)}get test(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}}}const Wse=4096,$se=Hse.createVec2f64(),Jse=Hse.createVec3f64(),Xse=Hse.createVec4f64();Hse.createMat3f64();const Kse=Hse.createMat4f64(),Yse=Hse.createQuatf64();function Zse(e){return e?{origin:fm(e.origin),direction:fm(e.direction)}:{origin:[0,0,0],direction:[0,0,0]}}function Qse(e,t){const i=rne.get();return i.origin=e,i.direction=t,i}function ene(e,t=Zse()){return function(e,t,i=Zse()){return Dm(i.origin,e),Dm(i.direction,t),i}(e.origin,e.direction,t)}function tne(e,t,i=Zse()){return Dm(i.origin,e),Nm(i.direction,t,e),i}function ine(e,t){const i=Xm(Jse.get(),$m(Jse.get(),e.direction),Nm(Jse.get(),t,e.origin));return Jm(i,i)}const rne=new kse((function(){return{origin:null,direction:null}}));function sne(e,t,i){return Um(i,e,Jm(e,t)/Jm(e,e))}function nne(e,t){return Jm(e,t)/Rm(e)}function one(e,t){return-Iv(Jm(e,t)/(Rm(e)*Rm(t)))}function ane(e,t,i){$m(lne,e),$m(hne,t);const r=Iv(Jm(lne,hne));return Jm(Xm(lne,lne,hne),i)<0?2*Math.PI-r:r}const lne=[0,0,0],hne=[0,0,0],cne=Ne.getLogger("esri.geometry.support.sphere");function une(){return[0,0,0,0]}function pne(e,t=[0,0,0,0]){return Are(t,e)}function dne(e){return e}function fne(e){e[0]=e[1]=e[2]=e[3]=0}function yne(e){return Array.isArray(e)?e[3]:e}function gne(e){return Array.isArray(e)?e:Tne}function mne(e,t,i){if(v(t))return!1;const r=Nm(Jse.get(),t.origin,gne(e)),s=Jm(t.direction,t.direction),n=2*Jm(t.direction,r),o=n*n-4*s*(Jm(r,r)-e[3]*e[3]);if(o<0)return!1;const a=Math.sqrt(o);let l=(-n-a)/(2*s);const h=(-n+a)/(2*s);return(l<0||h<l&&h>0)&&(l=h),!(l<0||(i&&jm(i,t.origin,Um(Jse.get(),t.direction,l)),0))}function vne(e,t){return mne(e,t,null)}function bne(e,t,i){const r=Jse.get(),s=Kse.get();Xm(r,t.origin,t.direction);const n=yne(e);Xm(i,r,t.origin),Um(i,i,1/Rm(i)*n);const o=_ne(e,t.origin),a=one(t.origin,i);return nY(s),uY(s,s,a+o,r),Ym(i,i,s),i}function wne(e,t,i){const r=Nm(Jse.get(),t,gne(e));return jm(i,Um(Jse.get(),r,e[3]/Rm(r)),gne(e))}function _ne(e,t){const i=Rm(Nm(Jse.get(),t,gne(e))),r=yne(e);return Iv(r/(r+Math.abs(r-i)))}const xne=[0,0,0];function Sne(e,t,i,r){const s=Nm(xne,t,gne(e));switch(i){case 0:{const e=Pv(s,xne)[2];return Fm(r,-Math.sin(e),Math.cos(e),0)}case 1:{const e=Pv(s,xne),t=e[1],i=e[2],n=Math.sin(t);return Fm(r,-n*Math.cos(i),-n*Math.sin(i),Math.cos(t))}case 2:return $m(r,s);default:return}}function Mne(e,t){return Rm(Nm(Ine,t,gne(e)))-e[3]}const Tne=[0,0,0],Ine=[0,0,0];function Ene(e=Qne){return[e[0],e[1],e[2],e[3]]}function Ane(e,t,i,r){return Cne(e,t,i,r,Xse.get())}function Pne(e,t=Ene()){return Cne(e[0],e[1],e[2],e[3],t)}function Cne(e,t,i,r,s=Ene()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function One(e,t,i){Dm(i,t);const r=Jm(t,t);return Math.abs(r-1)>1e-5&&r>1e-12&&Um(i,i,1/Math.sqrt(r)),Vne(i,e,i)}function kne(e,t,i,r=Ene()){return Gne(Nm(Jse.get(),e,t),Nm(Jse.get(),i,t),e,r)}function Lne(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,Dne);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,Fne),n++,o=!rv(Dne,Fne);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,jne),n++,Nm(Nne,Dne,Fne),$m(Nne,Nne),Nm(zne,Fne,jne),$m(zne,zne),o=!rv(Dne,jne)&&!rv(Fne,jne)&&Math.abs(Jm(Nne,zne))<Rne;return o?(kne(Dne,Fne,jne,t),!0):(0!==i||1!==r||2!==s)&&Lne(e,t,0,1,2)}Object.freeze({__proto__:null,create:une,copy:pne,fromCenterAndRadius:function(e,t){return ese(e[0],e[1],e[2],t)},wrap:dne,clear:fne,fromRadius:function(e){return e},getRadius:yne,getCenter:gne,fromValues:function(e,t,i,r){return ese(e,t,i,r)},elevate:function(e,t,i){return e!==i&&Dm(i,e),i[3]=e[3]+t,i},setExtent:function(e,t,i){return cne.error("sphere.setExtent is not yet supported"),e===i?i:pne(e,i)},intersectRay:mne,intersectsRay:vne,intersectRayClosestSilhouette:function(e,t,i){if(mne(e,t,i))return i;const r=bne(e,t,Jse.get());return jm(i,t.origin,Um(Jse.get(),t.direction,Bm(t.origin,r)/Rm(t.direction))),i},closestPointOnSilhouette:bne,closestPoint:function(e,t,i){return mne(e,t,i)?i:(function(e,t,i){const r=Jm(e.direction,Nm(i,t,e.origin));jm(i,e.origin,Um(i,e.direction,r))}(t,gne(e),i),wne(e,i,i))},projectPoint:wne,distanceToSilhouette:function(e,t){const i=Hm(Nm(Jse.get(),t,gne(e))),r=e[3]*e[3];return Math.sqrt(Math.abs(i-r))},angleToSilhouette:_ne,axisAt:Sne,altitudeAt:Mne,setAltitudeAt:function(e,t,i,r){const s=Mne(e,t),n=Sne(e,t,2,Ine);return jm(r,t,Um(Ine,n,i-s))}});const Rne=.99619469809,Dne=[0,0,0],Fne=[0,0,0],jne=[0,0,0],Nne=[0,0,0],zne=[0,0,0];function Vne(e,t,i){return e!==i&&Pne(e,i),i[3]=-Jm(i,t),i}function Une(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Gne(e,t,i,r){return One(i,Xm(jne,t,e),r)}function Bne(e,t,i){return!!m(t)&&Yne(e,t.origin,t.direction,toe,i)}function qne(e,t,i){return Yne(e,t.origin,t.vector,0,i)}function Hne(e,t,i){return Yne(e,t.origin,t.vector,1,i)}function Wne(e,t){return Kne(e,gne(t))-t[3]>=0}function $ne(e,t){return Kne(e,t)>=0}function Jne(e,t){const i=Jm(e,t.ray.direction),r=-Kne(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function Xne(e,t,i){const r=Um(Jse.get(),e,-e[3]);return jm(i,function(e,t,i){const r=Um(Jse.get(),e,Jm(e,t));return Nm(i,t,r),i}(e,Nm(Jse.get(),t,r),Jse.get()),r),i}function Kne(e,t){return Jm(e,t)+e[3]}function Yne(e,t,i,r,s){const n=Jm(e,i);if(0===n)return!1;let o=-(Jm(e,t)+e[3])/n;return 1&r&&(o=mv(o,0,1)),!(!(4&r)&&o<0||!(8&r)&&o>1||(jm(s,t,Um(s,i,o)),0))}function Zne(e){return e}const Qne=[0,0,1,0],eoe=12,toe=8;function ioe(e,t){return e[0]*t[1]-e[1]*t[0]}function roe(e,t,i){const r=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return Math.abs(r)/jX(t,i)}function soe(e,t,i,r,s=i){return CX(uoe,r,i),CX(doe,t,s),function(e,t,i){DX(e,i,BX(i,t)/VX(i))}(foe,doe,uoe),PX(e,s,foe)}function noe(e,t,i,r){CX(uoe,t,i);const s=r/zX(uoe);return FX(e,i,uoe,s)}function ooe(e,t){return soe(doe,t,e.start,e.end),Av(doe[0],t[0])&&Av(doe[1],t[1])?[sK(t)]:[]}function aoe(e,t,i){return noe(doe,i,e,t),Av(doe[0],i[0])&&Av(doe[1],i[1])?[sK(i)]:[]}function loe(e,t){const i=e.start,r=e.end,s=t.start,n=t.end,o=CX(uoe,r,i),a=CX(poe,n,s),l=ioe(o,a);if(Math.abs(l)<=coe)return[];const h=CX(doe,i,s),c=ioe(a,h)/l,u=ioe(o,h)/l;if(c>=0){if(u>=0||1===t.type)return[FX(foe,i,o,c)]}else if(1===e.type&&(u>=0||1===t.type))return[FX(foe,i,o,c)];return[]}function hoe(e,t,i){const r=[],s=CX(uoe,e.end,e.start),n=CX(poe,e.start,t),o=VX(s),a=2*BX(s,n),l=a*a-4*o*(VX(n)-i*i);if(0===l){const t=-a/(2*o);(1===e.type||t>=0)&&r.push(FX(foe,e.start,s,t))}else if(l>0){const t=Math.sqrt(l),i=(-a+t)/(2*o);(1===e.type||i>=0)&&r.push(FX(foe,e.start,s,i));const n=(-a-t)/(2*o);(1===e.type||n>=0)&&r.push(FX(doe,e.start,s,n))}return r}const coe=1e-6,uoe=[0,0],poe=[0,0],doe=[0,0],foe=[0,0];class yoe extends Ase{constructor(e,t,i,r=0,s=0){super(e),this.planeType=t,this.edge=i,this.distance=r,this._plane=Ene(),this._offsetPlane=Ene(),this._minDistance=-1/0,this._maxDistance=1/0,0===s&&this._initialize()}get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){var e,t,i,r;const s=this._toXYZ(this.edge.left.pos),n=this._toXYZ(null==(e=this.edge.left.left)||null==(t=e.left)?void 0:t.pos),o=this._toXYZ(this.edge.right.pos),a=this._toXYZ(null==(i=this.edge.right.right)||null==(r=i.right)?void 0:r.pos);this._edgeDirection=nv([0,0,0],s,o),this._left=this._computeNeighbor(s,n,this._edgeDirection),this._right=this._computeNeighbor(o,a,this._edgeDirection)}_toXYZ(e){return m(e)?this.helper.toXYZ(e):null}_computeNeighbor(e,t,i){if(v(t))return{start:e,end:t,direction:ym(-i[1],i[0],0),isOriginalDirection:!0};const r=nv([0,0,0],e,t),s=!this._passesBisectingAngleThreshold(r,i);return{start:e,end:t,direction:s?this._bisectVectorsPerpendicular(i,r):r,isOriginalDirection:!s}}_passesBisectingAngleThreshold(e,t){const i=Math.abs(one(t,e));return i>=goe&&i<=Math.PI-goe}_bisectVectorsPerpendicular(e,t){const i=Jm(e,t)<0?e:Wm([0,0,0],e),r=Math.abs(Jm(i,t));if(!(r<.001||r>.999))return this._bisectDirection(i,t);const s=Xm([0,0,0],i,[0,0,1]);return $m(s,s)}_bisectDirection(e,t){const i=jm([0,0,0],e,t);return $m(i,i)}_initializePlane(){const e=this._computeNormalDirection(this._left),t=this._computeNormalDirection(this._right);Jm(e,t)<0&&Wm(t,t),One(this._left.start,this._bisectDirection(e,t),this._plane)}_computeNormalDirection(e){const t=Xm([0,0,0],e.direction,this._edgeDirection);$m(t,t);const i=Xm([0,0,0],this._edgeDirection,t);return 1===this.planeType&&(i[2]=0),$m(i,i)}_initializeDistanceConstraints(){m(this._left.end)&&!this.requiresSplitEdgeLeft&&this._updateDistanceConstraint(Kne(this._plane,this._left.end)),m(this._right.end)&&!this.requiresSplitEdgeRight&&this._updateDistanceConstraint(Kne(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(e){e<=0&&(this._minDistance=Math.max(this._minDistance,e)),e>=0&&(this._maxDistance=Math.min(this._maxDistance,e))}_updateIntersectDistanceConstraint(e){const t=e,i=this._edgeDirection,r=jm([0,0,0],this._left.start,this._left.direction),s=jm([0,0,0],this._right.start,this._right.direction),n=this._pointInBasis2D([0,0],t,i,this._left.start),o=this._pointInBasis2D([0,0],t,i,r),a=this._pointInBasis2D([0,0],t,i,this._right.start),l=this._pointInBasis2D([0,0],t,i,s),[h]=loe({start:o,end:n,type:1},{start:l,end:a,type:1});if(!h)return;const c=CX([0,0],n,o);GX(c,c);const u=BX(c,CX([0,0],h,o)),p=Kne(e,jm([0,0,0],r,Um([0,0,0],this._left.direction,-u)));this._updateDistanceConstraint(p)}_pointInBasis2D(e,t,i,r){return e[0]=nne(t,r),e[1]=nne(i,r),e}_offset(e,t){Number.isFinite(this._minDistance)&&(t=Math.max(this._minDistance,t)),Number.isFinite(this._maxDistance)&&(t=Math.min(this._maxDistance,t)),Pne(this._plane,this._offsetPlane),this._offsetPlane[3]-=t;const i=(e,t,i)=>m(t)&&function(e,t,i,r){return Yne(e,t,Nm(Jse.get(),i,t),eoe,r)}(this._offsetPlane,e,jm([0,0,0],e,t),i),r=[0,0,0];(e===this.edge.left?i(this._left.start,this._left.direction,r):i(this._right.start,this._right.direction,r))&&this.helper.copy(this.helper.fromXYZ(r,void 0,this.helper.getM(e.pos)),e.pos)}signedDistanceToPoint(e){return Kne(this.plane,this.helper.toXYZ(this.helper.fromPoint(e)))}apply(e){this._offset(e,this.distance)}undo(e){this._offset(e,0)}canAccumulate(e){return e instanceof yoe&&this.edge.left.index===e.edge.left.index&&this.edge.right.index===e.edge.right.index&&this.edge.component===e.edge.component&&this._maybeEqualsVec3(this._left.direction,e._left.direction)&&this._maybeEqualsVec3(this._right.direction,e._right.direction)&&sv(this._plane,e._plane)}accumulate(e,t){const i=this._plane[3]-t._plane[3]+t.distance;this._offset(e,i)}accumulateParams(e){const t=e.distance-e._plane[3];this.distance=t+this._plane[3]}clone(){const e=new yoe(this.helper,this.planeType,this.edge,this.distance,1);return Pne(this._plane,e._plane),Pne(this._offsetPlane,e._offsetPlane),e._maxDistance=this._maxDistance,e._minDistance=this._minDistance,e._left=this._cloneNeighbor(this._left),e._right=this._cloneNeighbor(this._right),e._edgeDirection=Dm([0,0,0],this._edgeDirection),e}_maybeEqualsVec3(e,t){return v(e)&&v(t)||m(e)&&m(t)&&sv(e,t)}_cloneNeighbor({start:e,end:t,direction:i,isOriginalDirection:r}){return{start:Dm([0,0,0],e),end:m(t)?Dm([0,0,0],t):null,direction:Dm([0,0,0],i),isOriginalDirection:r}}}const goe=Sv(15);class moe extends Ase{constructor(e,t,i,r=0){super(e),this.origin=t,this.angle=i,this.accumulationType=r}rotate(e,t){this.helper.rotate(e.pos,this.origin,t)}apply(e){this.rotate(e,this.angle)}undo(e){this.rotate(e,-this.angle)}canAccumulate(e){return e instanceof moe&&ns(this.origin,e.origin)}accumulate(e,t){const i=1===t.accumulationType;this.rotate(e,i?t.angle-this.angle:t.angle)}accumulateParams(e){const t=1===e.accumulationType;this.angle=t?e.angle:this.angle+e.angle}}class voe extends Ase{constructor(e,t,i,r,s,n=0){super(e),this.origin=t,this.axis1=i,this.factor1=r,this.factor2=s,this.accumulationType=n,this.axis2=AX([0,0],i[1],-i[0])}scale(e,t,i){this.helper.scale(e.pos,this.origin,this.axis1,t),this.helper.scale(e.pos,this.origin,this.axis2,i)}apply(e){this.scale(e,this.factor1,this.factor2)}undo(e){this.scale(e,1/this.factor1,1/this.factor2)}canAccumulate(e){return e instanceof voe&&ns(this.origin,e.origin)&&ns(this.axis1,e.axis1)}accumulate(e,t){1===t.accumulationType?this.scale(e,t.factor1/this.factor1,t.factor2/this.factor2):this.scale(e,t.factor1,t.factor2)}accumulateParams(e){const t=1===e.accumulationType;this.factor1=t?e.factor1:this.factor1*e.factor1,this.factor2=t?e.factor2:this.factor2*e.factor2}}class boe{constructor(){this.operations=[],this.closed=!1}close(){this.closed=!0}apply(){for(const e of this.operations)e.apply()}undo(){for(let e=this.operations.length-1;e>=0;e--)this.operations[e].undo()}accumulate(e){if(this.closed)return!1;const t=this.operations.length?this.operations[this.operations.length-1]:null;return t&&t.accumulate(e)||(this.operations.push(e),e.apply()),!0}}class woe extends sh{constructor(e,t){super(),this.editGeometry=e,this.type=t,this._geometry=null,this._dirty=!0,this._listener=this.editGeometry.on("change",(e=>{this._dirty=!0,e.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:e.addedVertices,operation:e.operation}),e.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:e.removedVertices,operation:e.operation}),e.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:e.updatedVertices,operation:e.operation})}))}destroy(){this._listener.remove()}splitEdge(e,t){return this.editGeometry.apply(new Cse(this.editGeometry,e,t))}updateVertices(e,t,i=1){return this.editGeometry.apply(new Ese(this.editGeometry,e,t),i)}moveVertices(e,t,i,r,s=1){return this.updateVertices(e,new Ose(this.editGeometry.coordinateHelper,t,i,r),s)}scaleVertices(e,t,i,r,s,n=1,o=0){return this.updateVertices(e,new voe(this.editGeometry.coordinateHelper,t,i,r,s,o),n)}rotateVertices(e,t,i,r=1,s=0){return this.updateVertices(e,new moe(this.editGeometry.coordinateHelper,t,i,s),r)}removeVertices(e){return this.editGeometry.apply(new Pse(this.editGeometry,e,this._minNumVerticesPerType))}appendVertex(e){return 0===this.editGeometry.components.length?null:this.editGeometry.apply(new Ise(this.editGeometry,this.editGeometry.components[0],e))}offsetEdge(e,t,i,r=1){return this.updateVertices([t.left,t.right],new yoe(this.editGeometry.coordinateHelper,e,t,i),r)}canRemoveVertex(){return this.editGeometry.components[0].vertices.length>this._minNumVerticesPerType}createUndoGroup(){const e=new boe;return this.editGeometry.apply(e),{remove:()=>e.close()}}undo(){return this.editGeometry.undo()}get canUndo(){return this.editGeometry.canUndo}redo(){return this.editGeometry.redo()}get canRedo(){return this.editGeometry.canRedo}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this.editGeometry.toPoint();break;case"polyline":this._geometry=this.editGeometry.toPolyline();break;case"polygon":this._geometry=this.editGeometry.toPolygon()}this._dirty=!1}return this._geometry}get _minNumVerticesPerType(){switch(this.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}static fromGeometry(e,t){return new woe(Tse.fromGeometry(e,t),e.type)}}class _oe{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.geometry=e.geometry,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.visualizer=e.visualizer}get coordinateHelper(){return this.geometry.editGeometry.coordinateHelper}}var xoe;let Soe=xoe=class extends sh.EventedAccessor{constructor(e){var t;super(e),this._hasZ=null,this._cursorScreenPoint=null,this._snappingTask=null,this._stagedVertex=null,this._stagedVertexUnsnapped=null,this._lastVertexUnsnapped=null,this._nativeEventHistory={undoStack:[],redoStack:[]},this.interactiveUndoDisabled=!1,this.history=[],this.redoHistory=[],this.snapToScene=!1,this.view=null,this.elevationInfo=null,this.defaultZ=0,this._coordinateHelper=bse(e.hasZ,!1,e.view.spatialReference,"local"),this._snappingManager=e.snappingManager,this._editGeometry=new woe(new Tse(this._coordinateHelper),null!=(t=e.editGeometryType)?t:"polygon"),this._snappingGraphicsLayer=new bte({id:xoe.SNAPPING_GRAPHICS_LAYER_ID,listMode:"hide",internal:!0}),this._snappingContext=new _oe({geometry:this._editGeometry,elevationInfo:{mode:"on-the-ground",offset:0},pointer:"mouse",visualizer:new mre(this._snappingGraphicsLayer)}),this._activeComponent=new Mse(this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent)}initialize(){"2d"===this.view.type&&this.view.map.layers.add(this._snappingGraphicsLayer)}destroy(){this._snappingTask=E(this._snappingTask),this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy(),m(this._snappingManager)&&this._snappingManager.doneSnapping(),this._editGeometry.destroy()}get _committedVertices(){return this._editGeometry.editGeometry.components[0].vertices.map((e=>e.pos))}get vertices(){return m(this._stagedVertex)?[...this._committedVertices,this._coordinateHelper.pointToArray(this._stagedVertex)]:this._committedVertices}get hasZ(){return m(this._hasZ)?this._hasZ:"3d"===this.view.type}set hasZ(e){this._hasZ=e,this.notifyChange("hasZ")}canUndo(){return this._editGeometry.editGeometry.canUndo}canRedo(){return this._editGeometry.editGeometry.canRedo}undo(){this.canUndo()&&this._editGeometry.undo()}redo(){this.canRedo()&&this._editGeometry.redo()}getCoordsFromScreenPoint(e){const t=this.screenToMap(e);return m(t)?t.hasZ?[t.x,t.y,t.z]:[t.x,t.y]:null}getCoordsAndPointFromScreenPoint(e){const t=this.screenToMap(e);return m(t)?t.hasZ?{vertex:[t.x,t.y,t.z],mapPoint:t}:{vertex:[t.x,t.y],mapPoint:t}:null}_pushCursorVertex(e){const t=Vie(e[0],e[1],null,this.view.spatialReference);this._stagedVertexUnsnapped=t,v(this._snappingManager)?this._stagedVertex=t:(this._stagedVertex=this._snappingManager.update(t,this._snappingContext),this._snappingTask=xt((async e=>{if(m(this._snappingManager)){const i=await this._snappingManager.snap(t,this._snappingContext,e);return i.valid&&(this._stagedVertex=i.apply(),this.notifyChange("vertices")),i}return null})))}_popCursorVertex(){this._stagedVertex=null,this._stagedVertexUnsnapped=null,this.notifyChange("vertices")}getGeometryZValue(){return this.defaultZ}screenToMap(e){let t=null;if("3d"===this.view.type)if(this.hasZ){const i=S(this.elevationInfo,Moe);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(jS(e.x,e.y),i,this.getGeometryZValue())}else{const i=S(this.elevationInfo,Toe);t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(jS(e.x,e.y),i,0),m(t)&&(t.z=void 0)}else t=this.view.toMap(e),m(t)&&(t.z=this.hasZ?this.getGeometryZValue():void 0);return t}_isDuplicateOfLastVertex(e){const t=this._editGeometry.editGeometry.components[0].getLastVertex();if(m(t)&&e[0]===t[0]&&e[1]===t[1])return!0;const{x:i,y:r}=this._coordinateHelper.createDehydratedPoint(e);return!(!m(this._lastVertexUnsnapped)||i!==this._lastVertexUnsnapped.x||r!==this._lastVertexUnsnapped.y)}_vertexAddHandler(e){const t=m(this._stagedVertex)?this._coordinateHelper.pointToArray(this._stagedVertex):this.getCoordsFromScreenPoint(this._cursorScreenPoint);m(t)&&this._addVertex(t,e.native)}_drawCompleteHandler(e){this._completeDrawing(e.native)}};Soe.SNAPPING_GRAPHICS_LAYER_ID="DrawAction-snapping-graphics-layer",Q([ro({readOnly:!0})],Soe.prototype,"vertices",null),Q([ro({type:Boolean,nonNullable:!0})],Soe.prototype,"interactiveUndoDisabled",void 0),Q([ro({readOnly:!0})],Soe.prototype,"history",void 0),Q([ro({readOnly:!0})],Soe.prototype,"redoHistory",void 0),Q([ro()],Soe.prototype,"snapToScene",void 0),Q([ro()],Soe.prototype,"view",void 0),Q([ro()],Soe.prototype,"elevationInfo",void 0),Q([ro({nonNullable:!0})],Soe.prototype,"defaultZ",void 0),Q([ro()],Soe.prototype,"hasZ",null),Soe=xoe=Q([Ro("esri.views.draw.DrawAction")],Soe);const Moe={mode:"absolute-height",offset:0},Toe={mode:"on-the-ground",offset:0};var Ioe=Soe;class Eoe{constructor(e,t,i,r){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=r,this.defaultPrevented=!1,this.type="vertex-add"}preventDefault(){this.defaultPrevented=!0}}class Aoe{constructor(e,t,i,r){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=r,this.defaultPrevented=!1,this.type="vertex-remove"}preventDefault(){this.defaultPrevented=!0}}class Poe{constructor(e,t,i,r,s=null){this.view=e,this.native=t,this.vertexIndex=i,this.vertices=r,this.mapPoint=s,this.coordinates=null,this.defaultPrevented=!1,this.type="cursor-update",this.coordinates=1===r.length?r[0]:null}preventDefault(){this.defaultPrevented=!0}}class Coe{constructor(e,t){this.native=e,this.vertices=t,this.coordinates=null,this.defaultPrevented=!1,this.type="draw-complete",this.coordinates=1===t.length?t[0]:null}preventDefault(){this.defaultPrevented=!0}}const Ooe={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};let koe=class extends Ioe{constructor(e){super(e),this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new Mh,this._undoRedoHandles=new Mh}initialize(){this._addViewHandles(),this._addUndoRedoHandles()}destroy(){this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy(),this.emit("destroy")}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){this._completeDrawing()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation()}),iH.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=wJ(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),iH.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._snappingTask=E(this._snappingTask),this._cursorScreenPoint=wJ(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),iH.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._addVertexOnPointerUp=!1)}),iH.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=E(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp)this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),iH.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),iH.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),iH.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),iH.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===Ooe.vertexAdd&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._snappingTask=E(this._snappingTask),this._vertexAddHandler(e)):t===Ooe.complete&&!i&&this._cursorScreenPoint&&this.vertices.length>2?(e.stopPropagation(),this._snappingTask=E(this._snappingTask),this._vertexAddHandler(e),this._drawCompleteHandler(e)):t!==Ooe.undo||this.interactiveUndoDisabled||i?t!==Ooe.redo||this.interactiveUndoDisabled||i?t!==Ooe.pan||i||e.stopPropagation():(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo())}),iH.TOOL),this.view.on("key-up",(e=>{e.key===Ooe.pan&&e.stopPropagation()}),iH.TOOL)])}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const i=[...this._committedVertices];m(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new Aoe(this.view,t,e.vertices[0].index,i))}})),this._editGeometry.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,i=new Eoe(this.view,e,t,this.vertices);this.emit("vertex-add",i),i.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const i=[...this._committedVertices];m(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new Eoe(this.view,t,e.vertices[0].index,i))}}))])}_removeViewHandles(){this._viewHandles.removeAll()}_removeUndoRedoHandles(){this._undoRedoHandles.removeAll()}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);const r=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(r)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(m(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new Poe(this.view,e,this._activeComponent.vertices.length,this.vertices,m(this._stagedVertex)?new il(this._stagedVertex):null);this.emit("cursor-update",t()),m(this._snappingTask)&&this._snappingTask.promise.then((e=>{e.valid&&this.emit("cursor-update",t())}),(()=>{}))}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._snappingTask=E(this._snappingTask),m(this._snappingManager)&&this._snappingManager.doneSnapping(),this.vertices.length<2)return;const t=new Coe(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(v(this._activePointerId)||this._activePointerId===e.pointerId)}};function Loe(e,t,i,r){if(null==r||e.hasZ||(r=void 0),"point"===e.type)return e.x+=t,e.y+=i,e.hasZ&&null!=r&&(e.z+=r),e;if("multipoint"===e.type){const s=e.points;for(let e=0;e<s.length;e++)s[e]=Noe(s[e],t,i,r);return e}if("extent"===e.type)return e.xmin+=t,e.xmax+=t,e.ymin+=i,e.ymax+=i,null!=r&&(e.zmin+=r,e.zmax+=r),e;const s=mb(e),n="polyline"===e.type?e.paths:e.rings;for(let o=0;o<s.length;o++){const e=s[o];for(let s=0;s<e.length;s++)e[s]=Noe(e[s],t,i,r)}return"paths"in e?e.paths=n:e.rings=n,e}function Roe(e,t,i,r,s){const n=e.clone(),o=r.resolution;if("point"===n.type){if(s)Loe(n,t*o,-i*o);else{const e=r.state.transform,s=r.state.inverseTransform,o=e[0]*n.x+e[2]*n.y+e[4],a=e[1]*n.x+e[3]*n.y+e[5];n.x=s[0]*(o+t)+s[2]*(a+i)+s[4],n.y=s[1]*(o+t)+s[3]*(a+i)+s[5]}return n}if("multipoint"===n.type){if(s)Loe(n,t*o,-i*o);else{const e=n.points,s=r.state.transform,o=r.state.inverseTransform;for(let r=0;r<e.length;r++){const n=e[r],a=s[0]*n[0]+s[2]*n[1]+s[4],l=s[1]*n[0]+s[3]*n[1]+s[5],h=o[0]*(a+t)+o[2]*(l+i)+o[4],c=o[1]*(a+t)+o[3]*(l+i)+o[5];e[r]=zoe(n,h,c,void 0)}}return n}if("extent"===n.type){if(s)Loe(n,t*o,-i*o);else{const e=r.state.transform,s=r.state.inverseTransform,o=e[0]*n.xmin+e[2]*n.ymin+e[4],a=e[1]*n.xmin+e[3]*n.ymin+e[5],l=e[0]*n.xmax+e[2]*n.ymax+e[4],h=e[1]*n.xmax+e[3]*n.ymax+e[5];n.xmin=s[0]*(o+t)+s[2]*(a+i)+s[4],n.ymin=s[1]*(o+t)+s[3]*(a+i)+s[5],n.xmax=s[0]*(l+t)+s[2]*(h+i)+s[4],n.ymax=s[1]*(l+t)+s[3]*(h+i)+s[5]}return n}if(s)Loe(n,t*o,-i*o);else{const e=mb(n),s="polyline"===n.type?n.paths:n.rings,o=r.state.transform,a=r.state.inverseTransform;for(let r=0;r<e.length;r++){const s=e[r];for(let e=0;e<s.length;e++){const r=s[e],n=o[0]*r[0]+o[2]*r[1]+o[4],l=o[1]*r[0]+o[3]*r[1]+o[5],h=a[0]*(n+t)+a[2]*(l+i)+a[4],c=a[1]*(n+t)+a[3]*(l+i)+a[5];s[e]=zoe(r,h,c,void 0)}}"paths"in n?n.paths=s:n.rings=s}return n}function Doe(e,t,i,r){if("point"===e.type){const{x:s,y:n}=e,o=r?r[0]:s,a=r?r[1]:n,l=e.clone(),h=(s-o)*t+o,c=(n-a)*i+a;return l.x=h,l.y=c,l}if("multipoint"===e.type){const s=mb(e),n=v$(),[o,a,l,h]=Ub(n,[s]),c=r?r[0]:(o+l)/2,u=r?r[1]:(h+a)/2,p=e.clone(),d=p.points;for(let e=0;e<d.length;e++){const r=d[e],[s,n]=r,o=(s-c)*t+c,a=(n-u)*i+u;d[e]=zoe(r,o,a,void 0)}return p}if("extent"===e.type){const{xmin:s,xmax:n,ymin:o,ymax:a}=e,l=r?r[0]:(s+n)/2,h=r?r[1]:(a+o)/2,c=e.clone();if(c.xmin=(s-l)*t+l,c.ymax=(a-h)*i+h,c.xmax=(n-l)*t+l,c.ymin=(o-h)*i+h,c.xmin>c.xmax){const e=c.xmin,t=c.xmax;c.xmin=t,c.xmax=e}if(c.ymin>c.ymax){const e=c.ymin,t=c.ymax;c.ymin=t,c.ymax=e}return c}const s=mb(e),n=v$(),[o,a,l,h]=Ub(n,s),c=r?r[0]:(o+l)/2,u=r?r[1]:(h+a)/2,p=e.clone(),d="polyline"===p.type?p.paths:p.rings;for(let f=0;f<s.length;f++){const e=s[f];for(let r=0;r<e.length;r++){const s=e[r],[n,o]=s,a=(n-c)*t+c,l=(o-u)*i+u;d[f][r]=zoe(s,a,l,void 0)}}return"paths"in p?p.paths=d:p.rings=d,p}function Foe(e,t,i,r,s,n){const o=Math.sqrt((i-e)*(i-e)+(r-t)*(r-t));return Math.sqrt((s-e)*(s-e)+(n-t)*(n-t))/o}function joe(e,t,i,r,s,n){const o=180*Math.atan2(t-r,e-i)/Math.PI;return 180*Math.atan2(t-n,e-s)/Math.PI-o}function Noe(e,t,i,r){return zoe(e,e[0]+t,e[1]+i,null!=e[2]&&null!=r?e[2]+r:void 0)}function zoe(e,t,i,r){const s=[t,i];return e.length>2&&s.push(null!=r?r:e[2]),e.length>3&&s.push(e[3]),s}function Voe(e,t){return e.events.on("drag",function(e,t){let i=null,r=null;return s=>{if("cancel"===s.action)return void(m(r)&&(r.execute({action:"cancel"}),i=null,r=null));const n={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};"start"===s.action&&v(i)&&(i=new Koe,r=new Koe,t(e,i,r,s.pointerType,n)),m(i)&&i.execute(n),"end"===s.action&&m(i)&&(i=null,r=null)}}(e,t))}function Uoe(e,t){const i=[e.x,e.y,e.z],r=t,s=[Math.cos(r),Math.sin(r)],n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);if(0===n)return null;s[0]/=n,s[1]/=n;const o=e=>{const t=(e.x-i[0])*s[0]+(e.y-i[1])*s[1];e.x=i[0]+t*s[0],e.y=i[1]+t*s[1]};return e=>(o(e.mapStart),o(e.mapEnd),e)}function Goe(e,t){let i=null;return r=>{if("start"===r.action&&(i=function(e,t,i){const r=e.geometry;if(v(r))return null;if("mesh"===r.type)return function(e,t,i,r){if(m(t.transform))return function(e,t,i,r){const s=Boe(i.getOriginPoint(t.spatialReference),r),n=t.spatialReference;return v(s)?null:{move:(t,r,o)=>{const a=Loe(s.clone(),t,r,o);if(a.spatialReference.equals(n))i.origin=ym(a.x,a.y,a.z);else{const e=gZ(a,n);m(e)&&(i.origin=ym(e.x,e.y,e.z))}e.notifyGeometryChanged()}}}(e,t,t.transform,i);if(!t.spatialReference.equals(i))return null;let s=0,n=0,o=0;return{move:(i,a,l)=>{const h=i-s,c=a-n,u=l-o;if(h||c||u){const p=t.origin.clone().offset(h,c,u);t.centerAt(p,{geographic:1===r}),e.notifyGeometryChanged(),s=i,n=a,o=l}}}}(e,r,t,i);const s=Boe(r,t),n=r.spatialReference;return v(s)?null:{move:(t,i,r)=>{const o=Loe(s.clone(),t,i,r);o.spatialReference.equals(n)?e.geometry=o:e.geometry=gZ(o,n)}}}(e,r.mapStart.spatialReference,t)),v(i))return null;const s=r.mapEnd.x-r.mapStart.x,n=r.mapEnd.y-r.mapStart.y,o=r.mapEnd.z-r.mapStart.z;return i.move(s,n,o),l(a({},r),{translationX:s,translationY:n,translationZ:o})}}function Boe(e,t){return v(e)?null:e.spatialReference.equals(t)?e.clone():gZ(e,t)}function qoe(e,t){const i=e.map((e=>Goe(e,t))).filter((e=>m(e)));return e=>{const t=e.mapEnd.x-e.mapStart.x,r=e.mapEnd.y-e.mapStart.y,s=e.mapEnd.z-e.mapStart.z;return i.forEach((t=>t(e))),l(a({},e),{translationX:t,translationY:r,translationZ:s})}}function Hoe(e){return m(e.geometry)&&"mesh"===e.geometry.type?function(e,t){const i=m(t.transform)?t.transform.clone():null,r=t.vertexAttributes.clonePositional();return s=>(t.transform=i,t.vertexAttributes=r,e.notifyGeometryChanged(),s)}(e,e.geometry):function(e,t){const i=new Map;for(const r of t)i.set(r,H(e[r]));return t=>(i.forEach(((t,i)=>{e[i]=t})),t)}(e,["geometry"])}function Woe(e){const t=e.map((e=>Hoe(e))).filter((e=>m(e)));return e=>(t.forEach((t=>t(e))),e)}function $oe(){let e=0,t=0,i=0;return r=>{"start"===r.action&&(e=r.mapStart.x,t=r.mapStart.y,i=r.mapStart.z);const s=r.mapEnd.x-e,n=r.mapEnd.y-t,o=r.mapEnd.z-i;return e=r.mapEnd.x,t=r.mapEnd.y,i=r.mapEnd.z,l(a({},r),{mapDeltaX:s,mapDeltaY:n,mapDeltaZ:o,mapDeltaSpatialReference:r.mapStart.spatialReference})}}function Joe(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const r=i.screenEnd.x-e,s=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,l(a({},i),{screenDeltaX:r,screenDeltaY:s})}}function Xoe(e,t){let i=null,r=0,s=0;return n=>{if("start"===n.action&&(i=e.toScreen(t),i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(r=n.screenStart.x-i.x,s=n.screenStart.y-i.y)),null==i)return null;const o=FS(mv(n.screenEnd.x-r,0,e.width),mv(n.screenEnd.y-s,0,e.height));return n.screenStart=i,n.screenEnd=o,n}}koe=Q([Ro("esri.views.draw.MultipointDrawAction")],koe),Object.freeze({__proto__:null,get MultipointDrawAction(){return koe}});class Koe{constructor(){this.execute=()=>{}}next(e,t=new Koe){return m(e)&&(this.execute=i=>{const r=e(i);m(r)&&t.execute(r)}),t}}class Yoe{constructor(){this._tasks=new Array}get length(){return this._tasks.length}push(e,t,i){return new Promise(((r,s)=>this._tasks.push(new Zoe(r,s,e,t,i))))}unshift(e,t,i){return new Promise(((r,s)=>this._tasks.unshift(new Zoe(r,s,e,t,i))))}process(){if(0===this._tasks.length)return!1;const e=this._tasks.shift();try{const t=rt(e.signal);if(t&&!e.abortCallback)e.reject(Qe());else{const i=t?e.abortCallback(Qe()):e.callback();bt(i)?i.then(e.resolve,e.reject):e.resolve(i)}}catch(t){e.reject(t)}return!0}cancelAll(){const e=Qe();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0}}class Zoe{constructor(e,t,i,r,s){this.resolve=e,this.reject=t,this.callback=i,this.signal=r,this.abortCallback=s}}let Qoe=class extends jo{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};Q([ro()],Qoe.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),Q([ro()],Qoe.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),Qoe=Q([Ro("esri.views.support.DebugFlags")],Qoe);const eae=new Qoe,tae=Ne.getLogger("esri.views.support.Scheduler");var iae;!function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.OVERLAY_MANAGER="overlay manager",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e[e.TEST_PRIO=1]="TEST_PRIO"}(iae||(iae={}));const rae=new Map([[iae.RESOURCE_CONTROLLER,0],[iae.SLIDE,0],[iae.STREAM_DATA_LOADER,0],[iae.ELEVATION_QUERY,0],[iae.TERRAIN_SURFACE,1],[iae.SURFACE_GEOMETRY_UPDATES,1],[iae.GRAPHICS_CORE,2],[iae.I3S_CONTROLLER,2],[iae.POINT_CLOUD_LAYER,2],[iae.FEATURE_TILE_FETCHER,2],[iae.STAGE,4],[iae.GRAPHICS_DECONFLICTOR,4],[iae.FILTER_VISIBILITY,4],[iae.SCALE_VISIBILITY,4],[iae.FRUSTUM_VISIBILITY,4],[iae.POINT_OF_INTEREST_FREQUENT,6],[iae.POINT_OF_INTEREST_INFREQUENT,30],[iae.LABELER,8],[iae.FEATURE_QUERY_ENGINE,8],[iae.FEATURE_TILE_TREE,16],[iae.FEATURE_TILE_TREE_ACTIVE,0],[iae.ELEVATION_ALIGNMENT,12],[iae.TEXT_TEXTURE_ATLAS,12],[iae.TEXTURE_UNLOAD,12],[iae.OVERLAY_MANAGER,12],[iae.LINE_OF_SIGHT_TOOL,16],[iae.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[iae.SNAPPING,0],[iae.SHADOW_ACCUMULATOR,30]]);function sae(e){return rae.has(e)?rae.get(e):"number"==typeof e?e:1}const nae=1e3/30;var oae,aae;!function(e){let t=class extends jo{constructor(e){super(e),this.updating=!0,this.performanceInfo={total:new Ns("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=null,this._state=1,this._tasks=new Us,this._runQueue=new Us,this._load=0,this._idleStateCallbacks=new Us,this._idleUpdatesStartFired=!1,this._maxReschedule=cae,this._forceTask=!1,this._debug=!1,this._debugHandle=Rh(eae,"SCHEDULER_LOG_SLOW_TASKS",(e=>this._debug=e)),this._budget=new r(e.nowFunc);for(const r of Object.keys(iae))this.performanceInfo.tasks.set(iae[r],new Ns(iae[r]));let t;const i=this;this._test={get state(){return v(t)?i._state:t},set state(e){t=e},FRAME_SAFETY_BUDGET:6.5,INTERACTING_BUDGET:nae,IDLE_BUDGET:100,get budget(){return i._budget.budget},usedBudget:0,updateTask:e=>this._updateTask(e),getState:e=>this._getState(e),getRuntime:e=>this._getRuntime(e),resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._debugHandle&&this._debugHandle.remove()}registerTask(e,t){const r=sae(e),s=new i(this,e,t,r);return this._tasks.push(s),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new Ns(e)),s}registerIdleStateCallbacks(e,t){const i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),2===this.state&&this._idleUpdatesStartFired&&i.idleBegin();const r=this;return{remove:()=>this._removeIdleStateCallbacks(i),set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),2===r._state&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}get now(){return this.nowFunc()}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((e=>e.idleEnd()))))}get state(){return v(this._test.state)?this._state:this._test.state}updateBudget(e){this._test.usedBudget=0;let t=6.5,i=e.frameDuration,r=1;switch(this.state){case 2:t=0,i=Math.max(100,e.frameDuration),r=30;break;case 1:i=Math.max(nae,e.frameDuration)}return i=i-e.elapsedFrameTime-t,2!==this.state&&i<1&&!this._forceTask?(this._forceTask=!0,!1):(i=Math.max(i,r),this._budget.reset(i,this.state),this._maxReschedule=cae,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((e=>e.idleBegin()))),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}removeTask(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}_updateTask(e){this._tasks.forAll((t=>{t.name===e&&t.setPriority(e)}))}_getState(e){if(this._runQueue.some((t=>t.name===e)))return aae.SCHEDULED;let t=aae.IDLE;return this._tasks.forAll((i=>{i.name===e&&i.needsUpdate&&(i.schedulePriority<=1?t=aae.READY:t!==aae.READY&&(t=aae.WAITING))})),t}_getRuntime(e){let t=0;return this._tasks.forAll((i=>{i.name===e&&(t+=i.runtime)})),t}_resetRuntimes(){this._tasks.forAll((e=>e.runtime=0))}_getRunning(){const e=new Map;if(this._tasks.forAll((t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;let t="";return e.forEach(((e,i)=>{t+=e>1?` ${e}x ${i}`:` ${i}`})),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce(((e,t)=>t.needsUpdate?++e:e),0);this._load=.9*this._load+e*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1))),this._tasks.forAll((e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.some((t=>t===e))&&this._runQueue.unshift(e)}));0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forAll((i=>{if(i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority)switch(e=!0,t=Math.max(t,i.basePriority),i.schedulePriority){case 1:i.schedulePriority=0,this._runQueue.push(i);break;default:--i.schedulePriority}})),!e)return this.updating=!1,!1;this._maxReschedule===cae&&(this._maxReschedule=t),--this._maxReschedule}return this.updating=!0,!0}_run(){const e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const t=this._budget.now(),i=this._runQueue.pop();this._budget.resetProgress();try{i.task.runTask(this._budget)}catch(mr){tae.error(`Exception in task "${i.name}"`,mr)}i.schedulePriority=i.basePriority;const r=this._budget.now()-t;if(i.runtime+=r,this._frameTaskTimes.set(i.priority,this._frameTaskTimes.get(i.priority)+r),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",i.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._recordFrameTaskTimes(this._budget.now()-e)}_startFrameTaskTimes(){for(const e of Object.keys(iae))this._frameTaskTimes.set(iae[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach(((e,t)=>this.performanceInfo.tasks.get(t).record(e))),this.performanceInfo.total.record(e)}get test(){return this._test}};Q([ro()],t.prototype,"updating",void 0),Q([ro()],t.prototype,"nowFunc",void 0),t=Q([Ro("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends jo{constructor(e,t,i,r){super({}),this._scheduler=e,this.name=t,this._basePriority=r,this.runtime=0,this._queue=new Yoe,this.updating=!1,this.schedulePriority=this._basePriority,this.task=m(i)?i:{running:!1,runTask:e=>this.processQueue(e)}}normalizeCtorArgs(){return{}}remove(){this.processQueue(lae),this._scheduler.removeTask(this),this.schedule=hae.schedule,this.reschedule=hae.reschedule}get basePriority(){return this._basePriority}setPriority(e){this.name=e;const t=sae(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.updating||this.task.running}schedule(e,t,i){return this.updating=!0,this._queue.push(e,t,i)}reschedule(e,t,i){return this.updating=!0,this._queue.unshift(e,t,i)}processQueue(e){for(;!e.done&&this._queue.process();)e.madeProgress();this.updating=this._queue.length>0}};Q([ro()],i.prototype,"updating",void 0),i=Q([Ro("esri.views.support.SchedulerTask")],i);class r{constructor(e){this.now=e,this._begin=0,this._budget=0,this._state=2,this._didWork=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}get elapsed(){return this.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r}(oae||(oae={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(aae||(aae={}));const lae=(()=>{const e=new oae.Budget((()=>performance.now()));return e.enabled=!1,e})();const hae=new class{remove(){}processQueue(){}schedule(e,t,i){try{if(rt(t)){const e=Qe();return i?Promise.resolve(i(e)):Promise.reject(e)}return vt(e())}catch(ehe){return Promise.reject(ehe)}}reschedule(e,t,i){return this.schedule(e,t,i)}},cae=Number.MAX_SAFE_INTEGER;class uae{constructor(){this.next=new Koe}createSnapDragEventPipelineStep({predicate:e=(()=>!0),cancel:t,snappingManager:i,snappingContext:r,updatingHandles:s}){if(v(i))return e=>e;let n=null,o=null;const h=()=>{n=E(n),i.doneSnapping(),m(o)&&o.frameTask.remove(),o=null};return t.next((e=>(h(),e))),this.next=new Koe,t=>{if(!e(t))return t;if(n=E(n),"start"===t.action){const e="3d"===i.view.type?i.view.resourceController.scheduler.registerTask(iae.SNAPPING):hae;o={context:new _oe({geometry:r.geometry,elevationInfo:r.elevationInfo,pointer:r.pointer,vertexHandle:m(t.info)?t.info.handle:null,excludeFeature:r.excludeFeature,visualizer:r.visualizer}),originalPos:m(t.snapOrigin)?r.coordinateHelper.createDehydratedPoint(t.snapOrigin):t.mapStart,frameTask:e}}if(m(o)){const e=o.context.coordinateHelper.createDehydratedPoint(o.context.coordinateHelper.fromArray([o.originalPos.x,o.originalPos.y,o.originalPos.z]));e.x+=t.mapEnd.x-t.mapStart.x,e.y+=t.mapEnd.y-t.mapStart.y;const r=t.mapStart.x-o.originalPos.x,h=t.mapStart.y-o.originalPos.y,c=l(a({},t),{action:"udpate"}),u=o.context,p=i.update(e,o.context);if(t.mapEnd.x=p.x+r,t.mapEnd.y=p.y+h,"end"!==t.action){const t=o.frameTask;n=xt((async s=>{const n=await t.schedule((()=>i.snap(e,u,s)),s);if(n.valid){const e=await t.schedule((()=>n.apply()),s);Fie(e,p)||(c.mapEnd.x=e.x+r,c.mapEnd.y=e.y+h,this.next.execute(c))}})),s.addPromise(n.promise)}}return"end"===t.action&&h(),t}}}function pae(){return new Float32Array(4)}function dae(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function fae(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function yae(){return pae()}function gae(){return fae(1,1,1,1)}function mae(){return fae(1,0,0,0)}function vae(){return fae(0,1,0,0)}function bae(){return fae(0,0,1,0)}function wae(){return fae(0,0,0,1)}const _ae=yae(),xae=gae(),Sae=mae(),Mae=vae(),Tae=bae(),Iae=wae();function Eae(e){return e?{ray:Zse(e.ray),c0:e.c0,c1:e.c1}:{ray:Zse(),c0:0,c1:Number.MAX_VALUE}}function Aae(e,t=Eae()){return ene(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function Pae(e,t){return Oae(e,e.c0,t)}function Cae(e,t){return Oae(e,e.c1,t)}function Oae(e,t,i){return jm(i,e.ray.origin,Um(i,e.ray.direction,t))}function kae(e){return e?[Ene(e[0]),Ene(e[1]),Ene(e[2]),Ene(e[3]),Ene(e[4]),Ene(e[5])]:[Ene(),Ene(),Ene(),Ene(),Ene(),Ene()]}function Lae(e,t=kae()){for(let i=0;i<6;i++)Pne(e[i],t[i])}function Rae(e,t,i,r=Nae){const s=lY(Kse.get(),t,e);aY(s,s);for(let n=0;n<8;++n){const e=Gre(Xse.get(),jae[n],s);Fm(r[n],e[0]/e[3],e[1]/e[3],e[2]/e[3])}!function(e,t){kne(t[4],t[0],t[3],e[0]),kne(t[1],t[5],t[6],e[1]),kne(t[4],t[5],t[1],e[2]),kne(t[3],t[2],t[6],e[3]),kne(t[0],t[1],t[2],e[4]),kne(t[5],t[4],t[7],e[5])}(i,r)}function Dae(e,t){for(let i=0;i<6;i++)if(Wne(e[i],t))return!1;return!0}function Fae(e,t){for(let i=0;i<6;i++){if(!Jne(e[i],t))return!1}return!0}Object.freeze({__proto__:null,create:pae,clone:dae,fromValues:fae,createView:function(e,t){return new Float32Array(e,t,4)},zeros:yae,ones:gae,unitX:mae,unitY:vae,unitZ:bae,unitW:wae,ZEROS:_ae,ONES:xae,UNIT_X:Sae,UNIT_Y:Mae,UNIT_Z:Tae,UNIT_W:Iae}),new kse((()=>({c0:0,c1:0,ray:null})));const jae=[ese(-1,-1,-1,1),ese(1,-1,-1,1),ese(1,1,-1,1),ese(-1,1,-1,1),ese(-1,-1,1,1),ese(1,-1,1,1),ese(1,1,1,1),ese(-1,1,1,1)];new kse(Eae);const Nae=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]];function zae(e){return e?{origin:fm(e.origin),vector:fm(e.vector)}:{origin:[0,0,0],vector:[0,0,0]}}function Vae(e,t=zae()){return Uae(e.origin,e.vector,t)}function Uae(e,t,i=zae()){return Dm(i.origin,e),Dm(i.vector,t),i}function Gae(e,t,i=zae()){return Dm(i.origin,e),Nm(i.vector,t,e),i}function Bae(e,t){const i=Nm(Jse.get(),t,e.origin),r=mv(Jm(e.vector,i)/Jm(e.vector,e.vector),0,1),s=Nm(Jse.get(),Um(Jse.get(),e.vector,r),i);return Jm(s,s)}function qae(e,t,i){return jm(i,e.origin,Um(i,e.vector,t))}function Hae(e,t,i,r,s){const{vector:n,origin:o}=e;return Um(s,n,mv(Jm(n,Nm(Jse.get(),t,o))/Hm(n),i,r)),jm(s,s,e.origin)}function Wae(e,t){if(Jae(e,function(e,t){const i=Kae.get();return i.origin=e,i.vector=t,i}(t.origin,t.direction),!1,Xae)){const{tA:t,pB:i,distance2:r}=Xae;if(t>=0&&t<=1)return r;if(t<0)return qm(e.origin,i);if(t>1)return qm(jm(Jse.get(),e.origin,e.vector),i)}return null}function $ae(e,t,i){return!!Jae(e,t,!0,Xae)&&(Dm(i,Xae.pA),!0)}function Jae(e,t,i,r){const s=1e-6,n=e.origin,o=jm(Jse.get(),n,e.vector),a=t.origin,l=jm(Jse.get(),a,t.vector),h=Jse.get(),c=Jse.get();if(h[0]=n[0]-a[0],h[1]=n[1]-a[1],h[2]=n[2]-a[2],c[0]=l[0]-a[0],c[1]=l[1]-a[1],c[2]=l[2]-a[2],Math.abs(c[0])<s&&Math.abs(c[1])<s&&Math.abs(c[2])<s)return!1;const u=Jse.get();if(u[0]=o[0]-n[0],u[1]=o[1]-n[1],u[2]=o[2]-n[2],Math.abs(u[0])<s&&Math.abs(u[1])<s&&Math.abs(u[2])<s)return!1;const p=h[0]*c[0]+h[1]*c[1]+h[2]*c[2],d=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],f=h[0]*u[0]+h[1]*u[1]+h[2]*u[2],y=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],g=(u[0]*u[0]+u[1]*u[1]+u[2]*u[2])*y-d*d;if(Math.abs(g)<s)return!1;let m=(p*d-f*y)/g,v=(p+d*m)/y;i&&(m=mv(m,0,1),v=mv(v,0,1));const b=Jse.get(),w=Jse.get();return b[0]=n[0]+m*u[0],b[1]=n[1]+m*u[1],b[2]=n[2]+m*u[2],w[0]=a[0]+v*c[0],w[1]=a[1]+v*c[1],w[2]=a[2]+v*c[2],r.tA=m,r.tB=v,r.pA=b,r.pB=w,r.distance2=qm(b,w),!0}const Xae={tA:0,tB:0,pA:[0,0,0],pB:[0,0,0],distance2:0},Kae=new kse((()=>({origin:null,vector:null})));class Yae{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this.view.watch("ready",(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProps(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}function Zae(e,t=0){const i=e.stride;return e.fieldNames.filter((t=>{const i=e.fields.get(t).optional;return!(i&&i.glPadding)})).map((r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=function(e){const t=Qae[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return{name:r,stride:i,count:n,type:o,offset:a,normalized:l,divisor:t}}))}const Qae={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126};class ele{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=9;const n=this.TypedArrayConstructor;void 0===r&&(r=9*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<9;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;for(let a=0;a<9;++a)r[n++]=s[o++]}get buffer(){return this.typedBuffer.buffer}}ele.ElementCount=9;class tle{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=16;const n=this.TypedArrayConstructor;void 0===r&&(r=16*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)t[r]=this.typedBuffer[i++];return t}setMat(e,t){let i=e*this.typedBufferStride;for(let r=0;r<16;r++)this.typedBuffer[i++]=t[r]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;for(let a=0;a<16;++a)r[n++]=s[o++]}get buffer(){return this.typedBuffer.buffer}}tle.ElementCount=16;class ile{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=1;const n=this.TypedArrayConstructor;void 0===r&&(r=n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}ile.ElementCount=1;class rle{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=2;const n=this.TypedArrayConstructor;void 0===r&&(r=2*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,AX(t,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=i}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;r[n++]=s[o++],r[n]=s[o]}get buffer(){return this.typedBuffer.buffer}}rle.ElementCount=2;class sle{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=3;const n=this.TypedArrayConstructor;void 0===r&&(r=3*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Fm(t,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;r[n++]=s[o++],r[n++]=s[o++],r[n]=s[o]}get buffer(){return this.typedBuffer.buffer}}sle.ElementCount=3;class nle{constructor(e,t,i=0,r,s){this.TypedArrayConstructor=e,this.elementCount=4;const n=this.TypedArrayConstructor;void 0===r&&(r=4*n.BYTES_PER_ELEMENT);const o=0===t.byteLength?0:i;this.typedBuffer=null==s?new n(t,o):new n(t,o,(s-i)/n.BYTES_PER_ELEMENT),this.typedBufferStride=r/n.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,i=this.count-t){const r=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,r,this.stride,r+i*this.stride)}getVec(e,t){return e*=this.typedBufferStride,Pre(t,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,i){this.typedBuffer[e*this.typedBufferStride+t]=i}setValues(e,t,i,r,s){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=s}copyFrom(e,t,i){const r=this.typedBuffer,s=t.typedBuffer;let n=e*this.typedBufferStride,o=i*t.typedBufferStride;r[n++]=s[o++],r[n++]=s[o++],r[n++]=s[o++],r[n]=s[o]}get buffer(){return this.typedBuffer.buffer}}nle.ElementCount=4;class ole extends ile{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}static fromTypedArray(e,t){return new ole(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}ole.ElementType="f32";class ale extends rle{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(ale,e,t)}static fromTypedArray(e,t){return new ale(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}ale.ElementType="f32";class lle extends sle{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(lle,e,t)}static fromTypedArray(e,t){return new lle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}lle.ElementType="f32";class hle extends nle{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(hle,e,t)}static fromTypedArray(e,t){return new hle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}hle.ElementType="f32";class cle extends ele{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(cle,e,t)}static fromTypedArray(e,t){return new cle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}cle.ElementType="f32";class ule extends ele{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(ule,e,t)}static fromTypedArray(e,t){return new ule(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}ule.ElementType="f64";class ple extends tle{constructor(e,t=0,i,r){super(Float32Array,e,t,i,r),this.elementType="f32"}slice(e,t){return this.sliceBuffer(ple,e,t)}static fromTypedArray(e,t){return new ple(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}ple.ElementType="f32";class dle extends tle{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(dle,e,t)}static fromTypedArray(e,t){return new dle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}dle.ElementType="f64";class fle extends ile{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(fle,e,t)}static fromTypedArray(e,t){return new fle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}fle.ElementType="f64";class yle extends rle{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(yle,e,t)}static fromTypedArray(e,t){return new yle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}yle.ElementType="f64";class gle extends sle{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(gle,e,t)}static fromTypedArray(e,t){return new gle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}gle.ElementType="f64";class mle extends nle{constructor(e,t=0,i,r){super(Float64Array,e,t,i,r),this.elementType="f64"}slice(e,t){return this.sliceBuffer(mle,e,t)}static fromTypedArray(e,t){return new mle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}mle.ElementType="f64";class vle extends ile{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(vle,e,t)}static fromTypedArray(e,t){return new vle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}vle.ElementType="u8";class ble extends rle{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(ble,e,t)}static fromTypedArray(e,t){return new ble(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}ble.ElementType="u8";class wle extends sle{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(wle,e,t)}static fromTypedArray(e,t){return new wle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}wle.ElementType="u8";class _le extends nle{constructor(e,t=0,i,r){super(Uint8Array,e,t,i,r),this.elementType="u8"}slice(e,t){return this.sliceBuffer(_le,e,t)}static fromTypedArray(e,t){return new _le(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}_le.ElementType="u8";class xle extends ile{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(xle,e,t)}static fromTypedArray(e,t){return new xle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}xle.ElementType="u16";class Sle extends rle{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(Sle,e,t)}static fromTypedArray(e,t){return new Sle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Sle.ElementType="u16";class Mle extends sle{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(Mle,e,t)}static fromTypedArray(e,t){return new Mle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Mle.ElementType="u16";class Tle extends nle{constructor(e,t=0,i,r){super(Uint16Array,e,t,i,r),this.elementType="u16"}slice(e,t){return this.sliceBuffer(Tle,e,t)}static fromTypedArray(e,t){return new Tle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Tle.ElementType="u16";class Ile extends ile{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(Ile,e,t)}static fromTypedArray(e,t){return new Ile(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Ile.ElementType="u32";class Ele extends rle{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(Ele,e,t)}static fromTypedArray(e,t){return new Ele(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Ele.ElementType="u32";class Ale extends sle{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(Ale,e,t)}static fromTypedArray(e,t){return new Ale(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Ale.ElementType="u32";class Ple extends nle{constructor(e,t=0,i,r){super(Uint32Array,e,t,i,r),this.elementType="u32"}slice(e,t){return this.sliceBuffer(Ple,e,t)}static fromTypedArray(e,t){return new Ple(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Ple.ElementType="u32";class Cle extends ile{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(Cle,e,t)}static fromTypedArray(e,t){return new Cle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Cle.ElementType="i8";class Ole extends rle{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(Ole,e,t)}static fromTypedArray(e,t){return new Ole(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Ole.ElementType="i8";class kle extends sle{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(kle,e,t)}static fromTypedArray(e,t){return new kle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}kle.ElementType="i8";class Lle extends nle{constructor(e,t=0,i,r){super(Int8Array,e,t,i,r),this.elementType="i8"}slice(e,t){return this.sliceBuffer(Lle,e,t)}static fromTypedArray(e,t){return new Lle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Lle.ElementType="i8";class Rle extends ile{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(Rle,e,t)}static fromTypedArray(e,t){return new Rle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Rle.ElementType="i16";class Dle extends rle{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(Dle,e,t)}static fromTypedArray(e,t){return new Dle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Dle.ElementType="i16";class Fle extends sle{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(Fle,e,t)}static fromTypedArray(e,t){return new Fle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Fle.ElementType="i16";class jle extends nle{constructor(e,t=0,i,r){super(Int16Array,e,t,i,r),this.elementType="i16"}slice(e,t){return this.sliceBuffer(jle,e,t)}static fromTypedArray(e,t){return new jle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}jle.ElementType="i16";class Nle extends ile{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Nle,e,t)}static fromTypedArray(e,t){return new Nle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Nle.ElementType="i32";class zle extends rle{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(zle,e,t)}static fromTypedArray(e,t){return new zle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}zle.ElementType="i32";class Vle extends sle{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Vle,e,t)}static fromTypedArray(e,t){return new Vle(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}Vle.ElementType="i32";class Ule extends nle{constructor(e,t=0,i,r){super(Int32Array,e,t,i,r),this.elementType="i32"}slice(e,t){return this.sliceBuffer(Ule,e,t)}static fromTypedArray(e,t){return new Ule(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}}function Gle(e){switch(e){case"u8":return 1;case"u16":return 2;case"u32":return 4;case"i8":return 1;case"i16":return 2;case"i32":case"f32":return 4;case"f64":return 8;default:return}}function Ble(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function qle(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function Hle(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}Ule.ElementType="i32";class Wle{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const i of e.fieldNames){const t=e.fields.get(i);this[i]=new t.constructor(this.buffer,t.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const i=this[e];return i&&i.elementCount===t.ElementCount&&i.elementType===t.ElementType?i:null}slice(e,t){return new Wle(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t,i,r){const s=this.stride;if(s%4==0){const n=new Uint32Array(e.buffer,t*s,r*s/4);new Uint32Array(this.buffer,i*s,r*s/4).set(n)}else{const n=new Uint8Array(e.buffer,t*s,r*s);new Uint8Array(this.buffer,i*s,r*s).set(n)}}}class $le{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(e,t){return this.appendField(e,ale,t),this}vec2f64(e,t){return this.appendField(e,yle,t),this}vec3f(e,t){return this.appendField(e,lle,t),this}vec3f64(e,t){return this.appendField(e,gle,t),this}vec4f(e,t){return this.appendField(e,hle,t),this}vec4f64(e,t){return this.appendField(e,mle,t),this}mat3f(e,t){return this.appendField(e,cle,t),this}mat3f64(e,t){return this.appendField(e,ule,t),this}mat4f(e,t){return this.appendField(e,ple,t),this}mat4f64(e,t){return this.appendField(e,dle,t),this}vec4u8(e,t){return this.appendField(e,_le,t),this}f32(e,t){return this.appendField(e,ole,t),this}f64(e,t){return this.appendField(e,fle,t),this}u8(e,t){return this.appendField(e,vle,t),this}u16(e,t){return this.appendField(e,xle,t),this}i8(e,t){return this.appendField(e,Cle,t),this}vec2i8(e,t){return this.appendField(e,Ole,t),this}vec2i16(e,t){return this.appendField(e,Dle,t),this}vec2u8(e,t){return this.appendField(e,ble,t),this}vec4u16(e,t){return this.appendField(e,Tle,t),this}u32(e,t){return this.appendField(e,Ile,t),this}appendField(e,t,i){const r=t.ElementCount*Gle(t.ElementType),s=this.stride;this.fields.set(e,{size:r,constructor:t,offset:s,optional:i}),this.stride+=r,this.fieldNames.push(e)}alignTo(e){return this.stride=Math.floor((this.stride+e-1)/e)*e,this}hasField(e){return this.fieldNames.indexOf(e)>=0}createBuffer(e){return new Wle(this,e)}createView(e){return new Wle(this,e)}clone(){const e=new $le;return e.stride=this.stride,e.fields=new Map,this.fields.forEach(((t,i)=>e.fields.set(i,t))),e.fieldNames=this.fieldNames.slice(),e.BufferType=this.BufferType,e}}function Jle(){return new $le}class Xle{constructor(e,t){this._module=e,this._loadModule=t}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}class Kle{constructor(e,t,i=(()=>this.dispose())){this.release=i,t&&(this._config=t.snapshot()),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e)}dispose(){this._program=T(this._program),this._pipeline=this._config=null}reload(e){T(this._program),this._program=this.initializeProgram(e)}get program(){return this._program}get pipeline(){return this._pipeline}get key(){return this._config.key}get configuration(){return this._config}bindPass(e,t){}bindMaterial(e,t){}bindDraw(e,t,i){}bindPipelineState(e){e.setPipelineState(this.pipeline)}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return 4}}class Yle{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits.map((()=>0))}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,t={key:this.key};for(const i of e)t[i]=this[i];return t}}function Zle(e={}){return(t,i)=>{var r,s;t._parameterNames=null!=(r=t._parameterNames)?r:[],t._parameterNames.push(i);const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(_v(o)),l=null!=(s=t._parameterBits)?s:[0];let h=0;for(;l[h]+a>16;)h++,h>=l.length&&l.push(0);t._parameterBits=l;const c=l[h],u=(1<<a)-1<<c;l[h]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(e){if(this[n]!==e&&(this[n]=e,this._keyDirty=!0,this._parameterBits[h]=this._parameterBits[h]&~u|+e<<c&u,"number"!=typeof e&&"boolean"!=typeof e))throw"Configuration value for "+i+" must be boolean or number, got "+typeof e}})}}var Qle,ehe;(ehe=Qle||(Qle={}))[ehe.Texture=0]="Texture",ehe[ehe.Buffer=1]="Buffer",ehe[ehe.VAO=2]="VAO",ehe[ehe.Program=3]="Program",ehe[ehe.Framebuffer=4]="Framebuffer",ehe[ehe.Renderbuffer=5]="Renderbuffer",ehe[ehe.COUNT=6]="COUNT";class the{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Map;this._current.length<Qle.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,t){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e])}decrement(e,t){--this._current[e]}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce(((e,t)=>e+t),0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let e=0;e<Qle.COUNT;++e){const t=this._current[e];t>0&&console.log(`${Qle[e]}: ${t}`)}}if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const e=new Map;this._allocations.forEach((t=>{var i;e.set(t,(null!=(i=e.get(t))?i:0)+1)})),e.forEach(((e,t)=>console.log(e," : ",t)))}}}function ihe(e,t,i=32774,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function rhe(e,t,i,r,s=32774,n=32774,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const she={face:1029,mode:2305},nhe={face:1028,mode:2305},ohe=e=>2===e?she:1===e?nhe:null,ahe={zNear:0,zFar:1},lhe={r:!0,g:!0,b:!0,a:!0};function hhe(e){return whe.intern(e)}function che(e){return xhe.intern(e)}function uhe(e){return Mhe.intern(e)}function phe(e){return Ihe.intern(e)}function dhe(e){return Ahe.intern(e)}function fhe(e){return Che.intern(e)}function yhe(e){return khe.intern(e)}function ghe(e){return Rhe.intern(e)}function mhe(e){return Fhe.intern(e)}class vhe{constructor(e,t){this.makeKey=e,this.makeRef=t,this.interns=new Map}intern(e){if(!e)return null;const t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}function bhe(e){return"["+e.join(",")+"]"}const whe=new vhe(_he,(e=>a({__tag:"Blending"},e)));function _he(e){return e?bhe([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const xhe=new vhe(She,(e=>a({__tag:"Culling"},e)));function She(e){return e?bhe([e.face,e.mode]):null}const Mhe=new vhe(The,(e=>a({__tag:"PolygonOffset"},e)));function The(e){return e?bhe([e.factor,e.units]):null}const Ihe=new vhe(Ehe,(e=>a({__tag:"DepthTest"},e)));function Ehe(e){return e?bhe([e.func]):null}const Ahe=new vhe(Phe,(e=>a({__tag:"StencilTest"},e)));function Phe(e){return e?bhe([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const Che=new vhe(Ohe,(e=>a({__tag:"DepthWrite"},e)));function Ohe(e){return e?bhe([e.zNear,e.zFar]):null}const khe=new vhe(Lhe,(e=>a({__tag:"ColorWrite"},e)));function Lhe(e){return e?bhe([e.r,e.g,e.b,e.a]):null}const Rhe=new vhe(Dhe,(e=>a({__tag:"StencilWrite"},e)));function Dhe(e){return e?bhe([e.mask]):null}const Fhe=new vhe((function(e){return e?bhe([_he(e.blending),She(e.culling),The(e.polygonOffset),Ehe(e.depthTest),Phe(e.stencilTest),Ohe(e.depthWrite),Lhe(e.colorWrite),Dhe(e.stencilWrite)]):null}),(e=>({blending:hhe(e.blending),culling:che(e.culling),polygonOffset:uhe(e.polygonOffset),depthTest:phe(e.depthTest),stencilTest:dhe(e.stencilTest),depthWrite:fhe(e.depthWrite),colorWrite:yhe(e.colorWrite),stencilWrite:ghe(e.stencilWrite)})));class jhe{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this.setBlending(e.blending),this.setCulling(e.culling),this.setPolygonOffset(e.polygonOffset),this.setDepthTest(e.depthTest),this.setStencilTest(e.stencilTest),this.setDepthWrite(e.depthWrite),this.setColorWrite(e.colorWrite),this.setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}setBlending(e){this._blending=this.setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}setCulling(e){this._culling=this.setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}setPolygonOffset(e){this._polygonOffset=this.setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}setDepthTest(e){this._depthTest=this.setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}setStencilTest(e){this._stencilTest=this.setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}setDepthWrite(e){this._depthWrite=this.setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}setColorWrite(e){this._colorWrite=this.setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}setStencilWrite(e){this._stencilWrite=this.setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}}function Nhe(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}class zhe{constructor(e,t,i=null){this._context=e,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,e.instanceCounter.increment(Qle.Texture,this),this._descriptor=a({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1},t),this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}dispose(){this._context.gl&&this._glName&&(this._context.unbindTextureAllUnits(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Qle.Texture,this))}release(){this.dispose()}resize(e,t){const i=this._descriptor;i.width===e&&i.height===t||(i.width=e,i.height=t,this.setData(null))}setData(e){if(!this._context||!this._context.gl)return;const t=this._context.gl;this._glName||(this._glName=t.createTexture()),void 0===e&&(e=null),null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);const i=this._context.bindTexture(this,zhe.TEXTURE_UNIT_FOR_UPDATES),r=this._descriptor;zhe._validateTexture(this._context,r),t.pixelStorei(t.UNPACK_ALIGNMENT,r.unpackAlignment),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r.flipped?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.preMultiplyAlpha?1:0);const s=r.pixelFormat;let n=r.internalFormat?r.internalFormat:s;if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){let i=e.width,o=e.height;e instanceof HTMLVideoElement&&(i=e.videoWidth,o=e.videoHeight),r.width&&r.height,t.texImage2D(t.TEXTURE_2D,0,n,s,r.dataType,e),r.hasMipmap&&this.generateMipmap(),void 0===r.width&&(r.width=i),void 0===r.height&&(r.height=o)}else{null!=r.width&&null!=r.height||console.error("Width and height must be specified!"),t.DEPTH24_STENCIL8&&n===t.DEPTH_STENCIL&&(n=t.DEPTH24_STENCIL8);let i=r.width,o=r.height;if(function(e){return m(e)&&"type"in e&&"compressed"===e.type}(e)){const s=Math.round(Math.log(Math.max(i,o))/Math.LN2)+1;r.hasMipmap=r.hasMipmap&&s===e.levels.length;for(let a=0;;++a){const s=e.levels[Math.min(a,e.levels.length-1)];if(t.compressedTexImage2D(t.TEXTURE_2D,a,n,i,o,0,s),1===i&&1===o||!r.hasMipmap)break;i=Math.max(1,i>>1),o=Math.max(1,o>>1)}}else if(m(e))t.texImage2D(t.TEXTURE_2D,0,n,i,o,0,s,r.dataType,e),r.hasMipmap&&this.generateMipmap();else for(let e=0;t.texImage2D(t.TEXTURE_2D,e,n,i,o,0,s,r.dataType,null),(1!==i||1!==o)&&r.hasMipmap;++e)i=Math.max(1,i>>1),o=Math.max(1,o>>1)}zhe._applySamplingMode(t,this._descriptor),zhe._applyWrapMode(t,this._descriptor),zhe._applyAnisotropicFilteringParameters(this._context,this._descriptor),this._context.bindTexture(i,zhe.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,t,i,r,s,n){n||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const o=this._context.gl,a=this._descriptor,l=this._context.bindTexture(this,zhe.TEXTURE_UNIT_FOR_UPDATES);(t<0||i<0||r>a.width||s>a.height||t+r>a.width||i+s>a.height)&&console.error("An attempt to update out of bounds of the texture!"),o.pixelStorei(o.UNPACK_ALIGNMENT,a.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,a.flipped?1:0),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.preMultiplyAlpha?1:0),n instanceof ImageData||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement?o.texSubImage2D(o.TEXTURE_2D,e,t,i,a.pixelFormat,a.dataType,n):o.texSubImage2D(o.TEXTURE_2D,e,t,i,r,s,a.pixelFormat,a.dataType,n),this._context.bindTexture(l,zhe.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,this._samplingModeDirty=!0,zhe._validateTexture(this._context,e)),9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);const t=this._context.bindTexture(this,zhe.TEXTURE_UNIT_FOR_UPDATES),i=this._context.gl;i.generateMipmap(i.TEXTURE_2D),this._context.bindTexture(t,zhe.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,zhe._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._context.gl,t=this._descriptor;this._samplingModeDirty&&(zhe._applySamplingMode(e,t),this._samplingModeDirty=!1),this._wrapModeDirty&&(zhe._applyWrapMode(e,t),this._wrapModeDirty=!1)}static _validateTexture(e,t){(t.width<0||t.height<0)&&console.error("Negative dimension parameters are not allowed!");const i=vv(t.width)&&vv(t.height);Nhe(e.gl)||i||("number"==typeof t.wrapMode?33071!==t.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===t.wrapMode.s&&33071===t.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),t.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(e,t){let i=t.samplingMode,r=t.samplingMode;9985===i||9987===i?(i=9729,t.hasMipmap||(r=9729)):9984!==i&&9986!==i||(i=9728,t.hasMipmap||(r=9728)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r)}static _applyWrapMode(e,t){"number"==typeof t.wrapMode?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.wrapMode.s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.wrapMode.t))}static _applyAnisotropicFilteringParameters(e,t){var i;const r=e.capabilities.textureFilterAnisotropic;if(!r)return;const s=e.gl;s.texParameterf(s.TEXTURE_2D,r.TEXTURE_MAX_ANISOTROPY,null!=(i=t.maxAnisotropy)?i:1)}}zhe.TEXTURE_UNIT_FOR_UPDATES=0;class Vhe{constructor(e,t,i,r,s,n,o,a){this.createQuery=e,this.resultAvailable=t,this.getResult=i,this.disjoint=r,this.beginTimeElapsed=s,this.endTimeElapsed=n,this.createTimestamp=o,this.timestampBits=a}}function Uhe(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&Nhe(e)?new Vhe((()=>e.createQuery()),(t=>e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)),(t=>e.getQueryParameter(t,e.QUERY_RESULT)),(()=>e.getParameter(i.GPU_DISJOINT_EXT)),(t=>e.beginQuery(i.TIME_ELAPSED_EXT,t)),(()=>e.endQuery(i.TIME_ELAPSED_EXT)),(e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT)),(()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Vhe((()=>i.createQueryEXT()),(e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)),(e=>i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)),(()=>e.getParameter(i.GPU_DISJOINT_EXT)),(e=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,e)),(()=>i.endQueryEXT(i.TIME_ELAPSED_EXT)),(e=>i.queryCounterEXT(e,i.TIMESTAMP_EXT)),(()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):null)}function Ghe(e,t){const i=t.disabledExtensions||{},r=t.debugWebGLExtensions||{};let s,n,o,a,l,h,c,u,p,d,f,y=null,g=null,m=null,v=null;return{get drawBuffers(){return f||(f=function(e,t){if(t.disjointTimerQuery)return null;if(Nhe(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(e,i)),f},get instancing(){return s||(s=function(e){if(Nhe(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}(e)),s},get vao(){return n||(n=function(e,t){if(Nhe(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}(e,i)),n},get compressedTextureETC(){return o||(o=function(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(e,i)),o},get compressedTextureS3TC(){return a||(a=function(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(e,i)),a},get textureFilterAnisotropic(){return l||(l=function(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(e,i)),l},get disjointTimerQuery(){return h||(h=Uhe(e,i)),h},get textureFloat(){return c||(c=function(e,t){if(Nhe(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}(e,i)),c},get colorBufferFloat(){return u||(u=function(e,t){if(Nhe(e)){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}(e,i)),u},get blendMinMax(){return p||(p=function(e,t){if(Nhe(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const t=e.getExtension("EXT_blend_minmax");return t?{MIN:t.MIN_EXT,MAX:t.MAX_EXT}:null}}(e,i)),p},get depthTexture(){return null===y&&(y=Bhe(e,i,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),y},get standardDerivatives(){return null===g&&(g=Bhe(e,i,"standardDerivatives",!0,["OES_standard_derivatives"])),g},get shaderTextureLOD(){return null===m&&(m=Bhe(e,i,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),m},get fragDepth(){return null===v&&(v=Bhe(e,i,"fragDepth",!0,["EXT_frag_depth"])),v},get loseContext(){return d||(d=function(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}(e,r)),d},enable(e){return this[e]}}}function Bhe(e,t,i,r,s){if(r&&Nhe(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}class qhe{constructor(e,t={}){this.gl=e,this.instanceCounter=new the,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._viewport=null,this._stencilTestEnabled=!1,this._polygonOffsetFillEnabled=!1,this._polygonOffset=[0,0],this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=null,this._activeVertexBuffer=null,this._activeIndexBuffer=null,this._activeFramebuffer=null,this._activeRenderbuffer=null,this._activeTextureUnit=0,this._textureUnitMap=new Array,this._numOfDrawCalls=0,this._numOfTriangles=0,this.webglVersion=Nhe(e)?"webgl2":"webgl",e instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint"),this._capabilities=Ghe(e,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new jhe({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const i=e.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)}}),this.enforceState()}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this._textureUnitMap.length=0,Jhe()&&this.instanceCounter.printResourceCount()}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._blendEnabled!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=e,this._stateTracker.invalidateBlending())}externalTextureUnitUpdate(e,t){for(let i=0;i<e.length;++i)this._textureUnitMap[e[i]]=null;t>=0&&(this._activeTextureUnit=t)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._activeVertexArrayObject=null),this._activeVertexBuffer=null,this._activeIndexBuffer=null}externalVertexBufferUpdate(){this._activeVertexBuffer=null}externalIndexBufferUpdate(){this._activeIndexBuffer=null}setBlendColor(e,t,i,r){e===this._blendColorState.r&&t===this._blendColorState.g&&i===this._blendColorState.b&&r===this._blendColorState.a||(this.gl.blendColor(e,t,i,r),this._blendColorState.r=e,this._blendColorState.g=t,this._blendColorState.b=i,this._blendColorState.a=r,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._blendFunctionState.srcRGB&&t===this._blendFunctionState.dstRGB||(this.gl.blendFunc(e,t),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,i,r){this._blendFunctionState.srcRGB===e&&this._blendFunctionState.srcAlpha===i&&this._blendFunctionState.dstRGB===t&&this._blendFunctionState.dstAlpha===r||(this.gl.blendFuncSeparate(e,t,i,r),this._blendFunctionState.srcRGB=e,this._blendFunctionState.srcAlpha=i,this._blendFunctionState.dstRGB=t,this._blendFunctionState.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._blendEquationState.mode!==e&&(this.gl.blendEquation(e),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._blendEquationState.mode===e&&this._blendEquationState.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._blendEquationState.mode=e,this._blendEquationState.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,i,r){this._colorMaskState.r===e&&this._colorMaskState.g===t&&this._colorMaskState.b===i&&this._colorMaskState.a===r||(this.gl.colorMask(e,t,i,r),this._colorMaskState.r=e,this._colorMaskState.g=t,this._colorMaskState.b=i,this._colorMaskState.a=r,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,i,r){this._clearColor.r===e&&this._clearColor.g===t&&this._clearColor.b===i&&this._clearColor.a===r||(this.gl.clearColor(e,t,i,r),this._clearColor.r=e,this._clearColor.g=t,this._clearColor.b=i,this._clearColor.a=r)}setFaceCullingEnabled(e){this._polygonCullingEnabled!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._polygonOffsetFillEnabled!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._polygonOffset[0]===e&&this._polygonOffset[1]===t||(this._polygonOffset[0]=e,this._polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._cullFace!==e&&(this.gl.cullFace(e),this._cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._frontFace!==e&&(this.gl.frontFace(e),this._frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._scissorTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=e)}setScissorRect(e,t,i,r){this._scissorRect.x===e&&this._scissorRect.y===t&&this._scissorRect.width===i&&this._scissorRect.height===r||(this.gl.scissor(e,t,i,r),this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=i,this._scissorRect.height=r)}setDepthTestEnabled(e){this._depthTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._clearDepth!==e&&(this.gl.clearDepth(e),this._clearDepth=e)}setDepthFunction(e){this._depthFunction!==e&&(this.gl.depthFunc(e),this._depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._depthWriteEnabled!==e&&(this.gl.depthMask(e),this._depthWriteEnabled=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._depthRange.zNear===e&&this._depthRange.zFar===t||(this.gl.depthRange(e,t),this._depthRange.zNear=e,this._depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._stencilTestEnabled!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._clearStencil&&(this.gl.clearStencil(e),this._clearStencil=e)}setStencilFunction(e,t,i){this._stencilFunction.func===e&&this._stencilFunction.ref===t&&this._stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._stencilFunction.face=1032,this._stencilFunction.func=e,this._stencilFunction.ref=t,this._stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,i,r){this._stencilFunction.face===e&&this._stencilFunction.func===t&&this._stencilFunction.ref===i&&this._stencilFunction.mask===r||(this.gl.stencilFuncSeparate(e,t,i,r),this._stencilFunction.face=e,this._stencilFunction.func=t,this._stencilFunction.ref=i,this._stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._stencilWriteMask!==e&&(this.gl.stencilMask(e),this._stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,i){this._stencilOperation.fail===e&&this._stencilOperation.zFail===t&&this._stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._stencilOperation.face=1032,this._stencilOperation.fail=e,this._stencilOperation.zFail=t,this._stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,i,r){this._stencilOperation.face===e&&this._stencilOperation.fail===t&&this._stencilOperation.zFail===i&&this._stencilOperation.zPass===r||(this.gl.stencilOpSeparate(e,t,i,r),this._stencilOperation.face=e,this._stencilOperation.face=e,this._stencilOperation.fail=t,this._stencilOperation.zFail=i,this._stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const i=this._activeTextureUnit;return e>=0&&(t||e!==this._activeTextureUnit)&&(this.gl.activeTexture(33984+e),this._activeTextureUnit=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,t=255){e&&(16384&e&&this.setColorMask(!0,!0,!0,!0),256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e))}drawArrays(e,t,i){Jhe()&&(this._numOfDrawCalls++,this._numOfTriangles+=Whe(e,i)),this.gl.drawArrays(e,t,i)}drawElements(e,t,i,r){Jhe()&&(this._numOfDrawCalls++,this._numOfTriangles+=Whe(e,t)),this.gl.drawElements(e,t,i,r)}logIno(){Jhe()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}get capabilities(){return this._capabilities}setViewport(e,t,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);const s=this._viewport;s.x===e&&s.y===t&&s.width===i&&s.height===r||(s.x=e,s.y=t,s.width=i,s.height=r,this.gl.viewport(e,t,i,r))}getViewport(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}}useProgram(e){var t,i;if(!e)return null==(i=this._activeShaderProgram)||i.stop(),this._activeShaderProgram=null,void this.gl.useProgram(null);this._activeShaderProgram!==e&&(null==(t=this._activeShaderProgram)||t.stop(),this._activeShaderProgram=e,this.gl.useProgram(e.glName))}bindTexture(e,t,i=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const r=this._textureUnitMap[t];return this.setActiveTexture(t,i),v(e)||null==e.glName?(m(r)&&this.gl.bindTexture(r.descriptor.target,null),this._textureUnitMap[t]=null,r):i||r!==e?(this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._textureUnitMap[t]=e,r):(e.applyChanges(),r)}unbindTextureAllUnits(e){for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._textureUnitMap[t]===e&&(this.bindTexture(null,t),this._textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(v(e))return this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),void(this._activeFramebuffer=null);(t||this._activeFramebuffer!==e)&&(e.initializeAndBind(),this._activeFramebuffer=e)}bindBuffer(e){e&&(34962===e.bufferType?this._activeVertexBuffer=Hhe(this.gl,e,e.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=Hhe(this.gl,e,e.bufferType,this._activeIndexBuffer))}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._activeRenderbuffer=null),this._activeRenderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._activeRenderbuffer=e)}unbindBuffer(e){34962===e?this._activeVertexBuffer=Hhe(this.gl,null,e,this._activeVertexBuffer):this._activeIndexBuffer=Hhe(this.gl,null,e,this._activeIndexBuffer)}bindVAO(e=null){v(e)?this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null):this._activeVertexArrayObject!==e&&(e.bind(),this._activeVertexArrayObject=e)}getBoundFramebufferObject(){return this._activeFramebuffer}getBoundVAO(){return this._activeVertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null),this.unbindBuffer(34962),this.unbindBuffer(34963);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const e=this.gl,t=this.capabilities.vao;t&&t.bindVertexArray(null);for(let i=0;i<this.parameters.maxVertexAttributes;i++)e.disableVertexAttribArray(i);if(this._activeVertexBuffer?e.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):e.bindBuffer(34962,null),this._activeIndexBuffer?e.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):e.bindBuffer(34963,null),t&&this._activeVertexArrayObject){const e=this._activeVertexArrayObject;this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null),this.bindVAO(e)}e.bindFramebuffer(e.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null),e.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null),e.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a),e.bindRenderbuffer(e.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null),!0===this._blendEnabled?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha),e.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha),e.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),e.clearDepth(this._clearDepth),e.clearStencil(this._clearStencil),e.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a),e.cullFace(this._cullFace),e.depthFunc(this._depthFunction),e.depthRange(this._depthRange.zNear,this._depthRange.zFar),!0===this._depthTestEnabled?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._depthWriteEnabled),e.frontFace(this._frontFace),e.lineWidth(1),!0===this._polygonCullingEnabled?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]),!0===this._polygonOffsetFillEnabled?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height),!0===this._scissorTestEnabled?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask),e.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass),!0===this._stencilTestEnabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._stencilWriteMask);for(let i=0;i<this.parameters.maxTextureImageUnits;i++){e.activeTexture(33984+i),e.bindTexture(3553,null),Nhe(e)&&e.bindTexture(32879,null);const t=this._textureUnitMap[i];m(t)&&e.bindTexture(t.descriptor.target,t.glName)}e.activeTexture(33984+this._activeTextureUnit),e.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height),Jhe()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}_loadParameters(e){var t;const i=this.capabilities.textureFilterAnisotropic,r=null!=(t=e.maxAnisotropy)?t:1/0,s={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)};return zhe.TEXTURE_UNIT_FOR_UPDATES=s.maxTextureImageUnits-1,s}}function Hhe(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function Whe(e,t){switch(e){case 0:return 2*t;case 4:return t/3;case 5:case 6:return t-2;default:return 0}}const $he=!!y("enable-feature:webgl-debug");function Jhe(){return $he}function Xhe(){return $he}var Khe,Yhe=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"],Zhe={exports:{}};void 0!==(Khe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(Zhe.exports=Khe);var Qhe,ece=Zhe.exports,tce={exports:{}};Qhe=tce,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];void 0!==t&&(Qhe.exports=t)}();var ice=tce.exports,rce={exports:{}};!function(e){!function(t){var i=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"];void 0!==i&&(e.exports=i)}()}(rce);var sce=rce.exports,nce=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function oce(){var e,t,i,r=0,s=0,n=999,o=[],a=[],l=1,h=0,c=0,u=!1,p=!1,d="";return function(t){return a=[],null!==t?function(t){var o;for(r=0,i=(d+=t).length;e=d[r],r<i;){switch(o=r,n){case 0:r=b();break;case 1:r=v();break;case 2:r=m();break;case 3:r=w();break;case 4:r=S();break;case 11:r=x();break;case 5:r=M();break;case 9999:r=T();break;case 9:r=g();break;case 999:r=y()}if(o!==r)switch(d[o]){case"\n":h=0,++l;break;default:++h}}return s+=r,d=d.slice(r),a}(t.replace?t.replace(/\r\n/g,"\n"):t):(o.length&&f(o.join("")),n=10,f("(eof)"),a)};function f(e){e.length&&a.push({type:nce[n],data:e,position:c,line:l,column:h})}function y(){return o=o.length?[]:o,"/"===t&&"*"===e?(c=s+r-1,n=0,t=e,r+1):"/"===t&&"/"===e?(c=s+r-1,n=1,t=e,r+1):"#"===e?(n=2,c=s+r,r):/\s/.test(e)?(n=9,c=s+r,r):(u=/\d/.test(e),p=/[^\w_]/.test(e),c=s+r,n=u?4:p?3:9999,r)}function g(){return/[^\s]/g.test(e)?(f(o.join("")),n=999,r):(o.push(e),t=e,r+1)}function m(){return"\r"!==e&&"\n"!==e||"\\"===t?(o.push(e),t=e,r+1):(f(o.join("")),n=999,r)}function v(){return m()}function b(){return"/"===e&&"*"===t?(o.push(e),f(o.join("")),n=999,r+1):(o.push(e),t=e,r+1)}function w(){if("."===t&&/\d/.test(e))return n=5,r;if("/"===t&&"*"===e)return n=0,r;if("/"===t&&"/"===e)return n=1,r;if("."===e&&o.length){for(;_(o););return n=5,r}if(";"===e||")"===e||"("===e){if(o.length)for(;_(o););return f(e),n=999,r+1}var i=2===o.length&&"="!==e;if(/[\w_\d\s]/.test(e)||i){for(;_(o););return n=999,r}return o.push(e),t=e,r+1}function _(e){for(var t,i,r=0;;){if(t=ice.indexOf(e.slice(0,e.length+r).join("")),i=ice[t],-1===t){if(r--+e.length>0)continue;i=e.slice(0,1).join("")}return f(i),c+=i.length,(o=o.slice(i.length)).length}}function x(){return/[^a-fA-F0-9]/.test(e)?(f(o.join("")),n=999,r):(o.push(e),t=e,r+1)}function S(){return"."===e||/[eE]/.test(e)?(o.push(e),n=5,t=e,r+1):"x"===e&&1===o.length&&"0"===o[0]?(n=11,o.push(e),t=e,r+1):/[^\d]/.test(e)?(f(o.join("")),n=999,r):(o.push(e),t=e,r+1)}function M(){return"f"===e&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(f(o.join("")),n=999,r):(o.push(e),t=e,r+1)}function T(){if(/[^\d\w_]/.test(e)){var i=o.join("");return n=ece.indexOf(i)>-1?8:sce.indexOf(i)>-1?7:6,f(o.join("")),n=999,r}return o.push(e),t=e,r+1}}function ace(e){return function(e){var t=oce(),i=[];return(i=i.concat(t(e))).concat(t(null))}(e)}const lce=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function hce(e,t){for(let i=t-1;i>=0;i--){const t=e[i];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function cce(e,t,i,r){r=r||i;for(const s of e)if("ident"===s.type&&s.data===i)return r in t?t[r]++:t[r]=0,cce(e,t,r+"_"+t[r],r);return i}function uce(e,t,i="afterVersion"){function r(e,t){for(let i=t;i<e.length;i++){const t=e[i];if("operator"===t.type&&";"===t.data)return i}return null}const s={data:"\n",type:"whitespace"},n=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let o=function(e){let t=-1,s=0,n=-1;for(let o=0;o<e.length;o++){const a=e[o];if("preprocessor"===a.type&&(a.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++s:a.data.match(/\#endif\s*.*/)&&--s),"afterVersion"!==i&&"afterPrecision"!==i||"preprocessor"===a.type&&/^#version/.test(a.data)&&(n=Math.max(n,o)),"afterPrecision"===i&&"keyword"===a.type&&"precision"===a.data){const t=r(e,o);if(null===t)throw new Error("precision statement not followed by any semicolons!");n=Math.max(n,t)}t<n&&0===s&&(t=o)}return t+1}(e);n(o-1)&&e.splice(o++,0,s);for(const a of t)e.splice(o++,0,a);n(o-1)&&n(o)&&e.splice(o,0,s)}function pce(e,t,i,r="lowp"){uce(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function dce(e,t,i,r,s="lowp"){uce(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function fce(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const t=e[n];if("operator"===t.type&&("["===t.data&&(i=n),"]"===t.data)){r=n;break}"integer"===t.type&&(s=parseInt(t.data,10))}return i&&r&&e.splice(i,r-i+1),s}function yce(e,t){const i=ace(e);if("300 es"===function(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if("preprocessor"===s.type){const e=r.exec(s.data);if(e){const r=e[1].replace(/\s\s+/g," ");if(r===i)return r;if(r===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+r)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:"\n"}),null}(i,"100","300 es"))throw new Error("shader is already glsl 300 es");let r=null,s=null;const n={},o={};for(let a=0;a<i.length;++a){const e=i[a];switch(e.type){case"keyword":35633===t&&"attribute"===e.data?e.data="in":"varying"===e.data&&(e.data=35633===t?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(e.data.trim())&&(e.data=e.data.replace(/(2D|Cube|EXT)/g,"")),35632===t&&"gl_FragColor"===e.data&&(r||(r=cce(i,n,"fragColor"),pce(i,r,"vec4")),e.data=r),35632===t&&"gl_FragData"===e.data){const t=fce(i,a+1),r=cce(i,n,"fragData");dce(i,r,"vec4",t,"mediump"),e.data=r}else 35632===t&&"gl_FragDepthEXT"===e.data&&(s||(s=cce(i,n,"gl_FragDepth")),e.data=s);break;case"ident":if(Yhe.indexOf(e.data)>=0){if(35633===t&&hce(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");e.data in o||(o[e.data]=cce(i,n,e.data)),e.data=o[e.data]}}}for(let a=i.length-1;a>=0;--a){const e=i[a];if("preprocessor"===e.type){const t=e.data.match(/\#extension\s+(.*)\:/);if(t&&t[1]&&lce.indexOf(t[1].trim())>=0){const e=i[a+1];i.splice(a,e&&"whitespace"===e.type?2:1)}const r=e.data.match(/\#ifdef\s+(.*)/);r&&r[1]&&lce.indexOf(r[1].trim())>=0&&(e.data="#if 1");const s=e.data.match(/\#ifndef\s+(.*)/);s&&s[1]&&lce.indexOf(s[1].trim())>=0&&(e.data="#if 0")}}return function(e){return e.map((e=>"eof"!==e.type?e.data:"")).join("")}(i)}class gce{constructor(e,t,i,r){this._context=e,this._locations=r,this._vShader=null,this._fShader=null,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v={},this._nameToUniform2={},this._nameToUniform3={},this._nameToUniform4={},this._nameToUniformMatrix3={},this._nameToUniformMatrix4={},e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),this._vShader=vce(this._context,35633,t),this._fShader=vce(this._context,35632,i),this._vShader&&this._fShader||console.error("Error loading shaders!");const s=this._context.gl,n=s.createProgram();s.attachShader(n,this._vShader),s.attachShader(n,this._fShader),r.forEach(((e,t)=>s.bindAttribLocation(n,e,t))),s.linkProgram(n),Xhe()&&!s.getProgramParameter(n,s.LINK_STATUS)&&console.error("Could not initialize shader\nVALIDATE_STATUS: "+s.getProgramParameter(n,s.VALIDATE_STATUS)+", gl error ["+s.getError()+"]infoLog: "+s.getProgramInfoLog(n)),this._glName=n,this._context.instanceCounter.increment(Qle.Program,this)}get glName(){return this._glName}dispose(){const e=this._context.gl;if(this._vShader){const t=this._vShader;e.deleteShader(t),this._vShader=null}if(this._fShader){const t=this._fShader;e.deleteShader(t),this._fShader=null}this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Qle.Program,this))}_getUniformLocation(e){return void 0===this._nameToUniformLocation[e]&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this._glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return null!==this._getUniformLocation(e)}setUniform1i(e,t){const i=this._nameToUniform1[e];void 0!==i&&t===i||(this._context.useProgram(this),this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1iv(e,t){const i=this._nameToUniform1v[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform1iv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform1v[e]=Array.from(t):bce(t,i))}setUniform2iv(e,t){const i=this._nameToUniform2[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform2iv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform2[e]=Array.from(t):bce(t,i))}setUniform3iv(e,t){const i=this._nameToUniform3[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform3iv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform3[e]=Array.from(t):bce(t,i))}setUniform4iv(e,t){const i=this._nameToUniform4[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform4iv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform4[e]=Array.from(t):bce(t,i))}setUniform1f(e,t){const i=this._nameToUniform1[e];void 0!==i&&t===i||(this._context.useProgram(this),this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1[e]=t)}setUniform1fv(e,t){const i=this._nameToUniform1v[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform1fv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform1v[e]=Array.from(t):bce(t,i))}setUniform2f(e,t,i){const r=this._nameToUniform2[e];void 0!==r&&t===r[0]&&i===r[1]||(this._context.useProgram(this),this._context.gl.uniform2f(this._getUniformLocation(e),t,i),void 0===r?this._nameToUniform2[e]=[t,i]:(r[0]=t,r[1]=i))}setUniform2fv(e,t){const i=this._nameToUniform2[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform2fv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform2[e]=Array.from(t):bce(t,i))}setUniform3f(e,t,i,r){const s=this._nameToUniform3[e];void 0!==s&&t===s[0]&&i===s[1]&&r===s[2]||(this._context.useProgram(this),this._context.gl.uniform3f(this._getUniformLocation(e),t,i,r),void 0===s?this._nameToUniform3[e]=[t,i,r]:(s[0]=t,s[1]=i,s[2]=r))}setUniform3fv(e,t){const i=this._nameToUniform3[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform3fv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform3[e]=Array.from(t):bce(t,i))}setUniform4f(e,t,i,r,s){const n=this._nameToUniform4[e];void 0!==n&&t===n[0]&&i===n[1]&&r===n[2]&&s===n[3]||(this._context.useProgram(this),this._context.gl.uniform4f(this._getUniformLocation(e),t,i,r,s),void 0===n?this._nameToUniform4[e]=[t,i,r,s]:(n[0]=t,n[1]=i,n[2]=r,n[3]=s))}setUniform4fv(e,t){const i=this._nameToUniform4[e];mce(i,t)&&(this._context.useProgram(this),this._context.gl.uniform4fv(this._getUniformLocation(e),t),void 0===i?this._nameToUniform4[e]=Array.from(t):bce(t,i))}setUniformMatrix3fv(e,t,i=!1){const r=this._nameToUniformMatrix3[e];(function(e,t){return!!v(e)||(9!==e.length?mce(e,t):9!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8])})(r,t)&&(this._context.useProgram(this),this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,t),void 0===r?this._nameToUniformMatrix3[e]=Array.from(t):bce(t,r))}setUniformMatrix4fv(e,t,i=!1){const r=this._nameToUniformMatrix4[e];(function(e,t){return!!v(e)||(16!==e.length?mce(e,t):16!==e.length||e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||e[4]!==t[4]||e[5]!==t[5]||e[6]!==t[6]||e[7]!==t[7]||e[8]!==t[8]||e[9]!==t[9]||e[10]!==t[10]||e[11]!==t[11]||e[12]!==t[12]||e[13]!==t[13]||e[14]!==t[14]||e[15]!==t[15])})(r,t)&&(this._context.useProgram(this),this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,t),void 0===r?this._nameToUniformMatrix4[e]=Array.from(t):bce(t,r))}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){}}function mce(e,t){if(v(e)||e.length!==t.length)return!0;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!0;return!1}function vce(e,t,i){const r="webgl2"===e.webglVersion?yce(i,t):i,s=e.gl,n=s.createShader(t);return s.shaderSource(n,r),s.compileShader(n),Xhe()&&!s.getShaderParameter(n,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(35633===t?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(n)),console.error(function(e){let t=2;return e.replace(/\n/g,(()=>"\n"+function(e){return e>=1e3?e.toString():("  "+e).slice(-3)}(t++)+":"))}(r)),"webgl2"===e.webglVersion&&(console.log("Shader source before transpilation:"),console.log(i))),n}function bce(e,t){for(let i=0;i<e.length;++i)t[i]=e[i]}class wce extends gce{constructor(e,t,i){super(e,t.generateSource("vertex"),t.generateSource("fragment"),i),this._textures=new Map,this._freeTextureUnits=new Us({deallocator:null}),this._fragmentUniforms=Jhe()?t.fragmentUniforms.entries:null}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,t){if(v(e)||null==e.glName){const e=this._textures.get(t);return e&&(this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(t)),null}let i=this._textures.get(t);return null==i?(i=this._allocTextureUnit(e),this._textures.set(t,i)):i.texture=e,this._context.useProgram(this),this.setUniform1i(t,i.unit),this._context.bindTexture(e,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach(((e,t)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(t,e.unit)})),m(this._fragmentUniforms)&&this._fragmentUniforms.forEach((e=>{if(("sampler2D"===e.type||"samplerCube"===e.type)&&!this._textures.has(e.name))throw new Error(`Texture sampler ${e.name} has no bound texture`)}))}_allocTextureUnit(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}}function _ce(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}function xce(e){e.code.add(_ce`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Sce(e){e.include(xce),e.code.add(_ce`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function Mce(e){e.fragment.uniforms.add("projInfo","vec4"),e.fragment.uniforms.add("zScale","vec2"),e.fragment.code.add(_ce`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Tce(e,t){e.extensions.add("GL_OES_standard_derivatives"),e.fragment.include(Sce),e.include(Mce),e.fragment.uniforms.add("glowColor","vec3"),e.fragment.uniforms.add("glowWidth","float"),e.fragment.uniforms.add("glowFalloff","float"),e.fragment.uniforms.add("innerColor","vec3"),e.fragment.uniforms.add("innerWidth","float"),e.fragment.uniforms.add("depthMap","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("frameColor","sampler2D"),t.contrastControlEnabled&&e.fragment.uniforms.add("globalAlphaContrastBoost","float"),e.fragment.code.add(_ce`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),e.fragment.code.add(_ce`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),e.fragment.code.add(_ce`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),e.fragment.code.add(_ce`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),t.contrastControlEnabled?e.fragment.code.add(_ce`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`):e.fragment.code.add(_ce`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}!function(e){e.int=function(e){return Math.round(e).toString()},e.float=function(e){return e.toPrecision(8)}}(_ce||(_ce={}));const Ice=Ne.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class Ece{constructor(){this.includedModules=new Map}include(e,t){this.includedModules.has(e)?this.includedModules.get(e)!==t&&Ice.error("Trying to include shader module multiple times with different sets of options."):(this.includedModules.set(e,t),e(this.builder,t))}}class Ace extends Ece{constructor(){super(...arguments),this.vertex=new Oce,this.fragment=new Oce,this.attributes=new kce,this.varyings=new Lce,this.extensions=new Rce,this.constants=new Dce}get fragmentUniforms(){return this.fragment.uniforms}get builder(){return this}generateSource(e){const t=this.extensions.generateSource(e),i=this.attributes.generateSource(e),r=this.varyings.generateSource(),s="vertex"===e?this.vertex:this.fragment,n=s.uniforms.generateSource(),o=s.code.generateSource(),a="vertex"===e?jce:Fce,l=this.constants.generateSource().concat(s.constants.generateSource());return`\n${t.join("\n")}\n\n${a}\n\n${l.join("\n")}\n\n${n.join("\n")}\n\n${i.join("\n")}\n\n${r.join("\n")}\n\n${o.join("\n")}`}}class Pce{constructor(){this._entries=new Map}add(e,t,i){const r=`${e}_${t}_${i}`;return this._entries.set(r,{name:e,type:t,arraySize:i}),this}generateSource(){return Array.from(this._entries.values()).map((e=>{return`uniform ${e.type} ${e.name}${t=e.arraySize,t?`[${t}]`:""};`;var t}))}get entries(){return Array.from(this._entries.values())}}class Cce{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}}class Oce extends Ece{constructor(){super(...arguments),this.uniforms=new Pce,this.code=new Cce,this.constants=new Dce}get builder(){return this}}class kce{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map((e=>`attribute ${e[1]} ${e[0]};`))}}class Lce{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(){return this._entries.map((e=>`varying ${e[1]} ${e[0]};`))}}class Rce{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?Rce.ALLOWLIST_VERTEX:Rce.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((e=>t.includes(e))).map((e=>`#extension ${e} : enable`))}}Rce.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],Rce.ALLOWLIST_VERTEX=[];class Dce{constructor(){this._entries=[]}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=Dce.numberToFloatStr(i);break;case"int":r=Dce.numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${Dce.numberToFloatStr(i[0])},                            ${Dce.numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${Dce.numberToFloatStr(i[0])},                            ${Dce.numberToFloatStr(i[1])},                            ${Dce.numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${Dce.numberToFloatStr(i[0])},                            ${Dce.numberToFloatStr(i[1])},                            ${Dce.numberToFloatStr(i[2])},                            ${Dce.numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${Dce.numberToIntStr(i[0])},                             ${Dce.numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${Dce.numberToIntStr(i[0])},                             ${Dce.numberToIntStr(i[1])},                             ${Dce.numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${Dce.numberToIntStr(i[0])},                             ${Dce.numberToIntStr(i[1])},                             ${Dce.numberToIntStr(i[2])},                             ${Dce.numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,(e=>Dce.numberToFloatStr(e))).join(", ")})`}return this._entries.push(`const ${t} ${e} = ${r};`),this}static numberToIntStr(e){return e.toFixed(0)}static numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}const Fce="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",jce="precision highp float;\nprecision highp sampler2D;";function Nce(e){const t=new Ace;return t.include(Tce,e),t.vertex.uniforms.add("uModelViewMatrix","mat4"),t.vertex.uniforms.add("uProjectionMatrix","mat4"),t.attributes.add("start","vec3"),t.attributes.add("end","vec3"),t.attributes.add("up","vec3"),t.attributes.add("extrude","vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),t.vertex.uniforms.add("glowWidth","float"),t.vertex.uniforms.add("pixelToNDC","vec2"),t.vertex.code.add(_ce`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = uModelViewMatrix * vec4(pos, 1);
vec4 projPos = uProjectionMatrix * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (uModelViewMatrix * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = uProjectionMatrix * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (uModelViewMatrix * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (uModelViewMatrix * vec4(start, 1)).xyz;
vViewEnd = (uModelViewMatrix * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),t.fragment.uniforms.add("globalAlpha","float"),t.fragment.uniforms.add("perScreenPixelRatio","float"),t.fragment.code.add(_ce`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),t}var zce=Object.freeze({__proto__:null,build:Nce});class Vce extends Kle{initializeProgram(e){const t=Vce.shader.get(),i=this.configuration,r=t.build(i);return new wce(e.rctx,r,Vce.attributeLocations)}bind(e,t,i){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*i.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*i.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.program.setUniform1f("perScreenPixelRatio",i.perScreenPixelRatio),this.program.setUniform2f("pixelToNDC",2/i.fullWidth,2/i.fullHeight),this.program.setUniformMatrix4fv("uProjectionMatrix",i.projectionMatrix),hY(Gce,i.viewMatrix,t),this.program.setUniformMatrix4fv("uModelViewMatrix",Gce),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1)}initializePipeline(){return mhe({blending:ihe(1,771),colorWrite:lhe})}bindPipelineState(e){e.setPipelineState(this.pipeline)}}Vce.shader=new Xle(zce,(()=>import("./LaserlinePath.glsl.41e5ccde.js"))),Vce.attributeLocations=new Map([["start",0],["end",1],["up",2],["extrude",3]]);class Uce extends Yle{constructor(){super(...arguments),this.contrastControlEnabled=!1}}Q([Zle()],Uce.prototype,"contrastControlEnabled",void 0);const Gce=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Bce=Ne.getLogger("esri/views/webgl");function qce(e){if(Jhe()){const t=e.getError();if(t){const i=function(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(e,t),r=(new Error).stack;Bce.error(new Be("webgl-error","WebGL error occured",{message:i,stack:r}))}}}const Hce=Ne.getLogger("esri.views.webgl.BufferObject");class Wce{constructor(e,t,i,r,s){this._context=e,this.bufferType=t,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Qle.Buffer,this),this._glName=this._context.gl.createBuffer(),qce(this._context.gl),r&&this.setData(r,s)}static createIndex(e,t,i,r){return new Wce(e,34963,t,i,r)}static createVertex(e,t,i){return new Wce(e,34962,t,i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return 34962===this.bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}dispose(){var e;null!=(e=this._context)&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Qle.Buffer,this),this._context=null):this._glName&&Hce.warn("Leaked WebGL buffer object")}setData(e,t){if(!e)return;if("number"==typeof e){if(e<0&&Hce.error("Buffer size cannot be negative!"),34963===this.bufferType&&t)switch(this._indexType=t,this._size=e,t){case 5123:e*=2;break;case 5125:e*=4}}else{let t=e.byteLength;V(e)&&(t/=2,this._indexType=5123),U(e)&&(t/=4,this._indexType=5125),this._size=t}const i=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const r=this._context.gl;r.bufferData(this.bufferType,e,this.usage),qce(r),this._context.bindVAO(i)}setSubData(e,t=0,i=0,r=e.byteLength){if(!e)return;(t<0||t>=this._size)&&Hce.error("offset is out of range!");let s=t,n=i,o=r,a=e.byteLength;V(e)&&(a/=2,s*=2,n*=2,o*=2),U(e)&&(a/=4,s*=4,n*=4,o*=4),void 0===r&&(r=a-1),i>=r&&Hce.error("end must be bigger than start!"),t+i-r>this._size&&Hce.error("An attempt to write beyond the end of the buffer!");const l=this._context.getBoundVAO();this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,c=ArrayBuffer.isView(e)?e.buffer:e,u=0===n&&o===e.byteLength?c:c.slice(n,o);h.bufferSubData(this.bufferType,s,u),qce(h),this._context.bindVAO(l)}}function $ce(e,t){return e.vertexBuffers[t].size/Jce(e.layout[t])}function Jce(e){return e[0].stride}function Xce(e,t,i,r,s){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const e=t.get(a.name);void 0===e&&console.error(`There is no location for vertex attribute '${a.name}' defined.`),a.baseInstance&&!a.divisor&&console.error(`Vertex attribute '${a.name}' uses baseInstanceOffset without divisor.`);const i=(s||(0+a.baseInstance?a.baseInstance:0))*a.stride;if(a.count<=4)n.vertexAttribPointer(e,a.count,a.type,a.normalized,a.stride,a.offset+i),n.enableVertexAttribArray(e),a.divisor>0&&o&&o.vertexAttribDivisor(e,a.divisor);else if(9===a.count)for(let t=0;t<3;t++)n.vertexAttribPointer(e+t,3,a.type,a.normalized,a.stride,a.offset+12*t+i),n.enableVertexAttribArray(e+t),a.divisor>0&&o&&o.vertexAttribDivisor(e+t,a.divisor);else if(16===a.count)for(let t=0;t<4;t++)n.vertexAttribPointer(e+t,4,a.type,a.normalized,a.stride,a.offset+16*t+i),n.enableVertexAttribArray(e+t),a.divisor>0&&o&&o.vertexAttribDivisor(e+t,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function Kce(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const e=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(e),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(e,0);else if(9===o.count)for(let t=0;t<3;t++)s.disableVertexAttribArray(e+t),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(e+t,0);else if(16===o.count)for(let t=0;t<4;t++)s.disableVertexAttribArray(e+t),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(e+t,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(34962)}function Yce(e){switch(e){case 6406:case 6409:case 36168:return 1;case 6410:case 32854:case 33325:case 32854:case 33189:return 2;case 6407:case 6402:return 3;case 6408:case 34041:case 33326:case 35898:case 33327:case 34041:return 4;case 33328:case 34842:return 8;case 34836:return 16;case 33776:case 33777:return.5;case 33778:case 33779:return 1;case 37488:case 37489:case 37492:case 37493:case 37494:case 37495:return.5;case 37490:case 37491:case 37496:case 37497:return 1}return 0}function Zce(e){if(v(e))return 0;if("descriptor"in e)return e.glName?Zce(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return Yce(t)*r*i}const Qce=Ne.getLogger("esri.views.webgl.VertexArrayObject");class eue{constructor(e,t,i,r,s=null){this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Qle.VAO,this)}get glName(){return this._glName}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].size),m(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(e=!0){if(this._context){if(this._glName){var t,i;const e=null==(t=this._context)||null==(i=t.capabilities)?void 0:i.vao;e?(e.deleteVertexArray(this._glName),this._glName=null):Qce.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),e){for(const e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer=T(this._indexBuffer)}this._context.instanceCounter.decrement(Qle.VAO,this),this._context=null}else(this._glName||e&&Object.getOwnPropertyNames(this._buffers).length>0)&&Qce.warn("Leaked WebGL VAO")}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||Qce.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const s in e){const i=e[s];i||Qce.error("Vertex buffer is uninitialized!");const r=t[s];r||Qce.error("Vertex element descriptor is empty!"),Xce(this._context,this._locations,i,r)}m(i)&&(this._context.capabilities.vao?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||Qce.error("Vertex buffer dictionary is empty!");for(const i in e){const r=e[i];r||Qce.error("Vertex buffer is uninitialized!");const s=t[i];Kce(this._context,this._locations,r,s)}m(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}class tue{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=[0,0,0],this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let i=0;for(const r of e)t[i++]=r[0],t[i++]=r[1],t[i++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);Fm(this._origin,e[t+0],e[t+1],e[t+2])}else Fm(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this.ensureVAO(e);m(t)&&(e.bindVAO(t),e.drawArrays(4,0,this._count))}dispose(){m(this._vao)&&this._vao.dispose()}ensureVAO(e){return v(this._buffers)?null:(v(this._vao)&&(this._vao=this.createVAO(e,this._buffers)),this.ensureVertexData(this._vao,this._buffers),this._vao)}createVAO(e,t){const i=this.createDataBuffer(t);return this._dirty=!1,new eue(e,Vce.attributeLocations,{data:Zae(sue)},{data:Wce.createVertex(e,35044,i)})}ensureVertexData(e,t){if(!this._dirty)return;const i=this.createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}numberOfRenderVertices(e){return 2*(e.length/3-1)*3}createDataBuffer(e){const t=e.reduce(((e,t)=>e+this.numberOfRenderVertices(t)),0);this._count=t;const i=sue.createBuffer(t),r=this._origin;let s=0,n=0;for(const o of e){for(let e=0;e<o.length;e+=3){const t=Fm(rue,o[e+0],o[e+1],o[e+2]);0===e?n=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,n);const a=this._renderCoordsHelper.worldUpAtPosition(t,iue),l=s+2*e,h=Nm(rue,t,r);if(e<o.length-3){i.up.setVec(l,a),i.up.setVec(l+3,a),i.up.setVec(l+5,a);for(let e=0;e<6;e++)i.start.setVec(l+e,h);i.extrude.setValues(l+0,0,-1),i.extrude.setValues(l+1,1,-1),i.extrude.setValues(l+2,1,1),i.extrude.setValues(l+3,0,-1),i.extrude.setValues(l+4,1,1),i.extrude.setValues(l+5,0,1)}if(e>0){i.up.setVec(l-2,a),i.up.setVec(l-4,a),i.up.setVec(l-5,a);for(let e=-6;e<0;e++)i.end.setVec(l+e,h)}}s+=this.numberOfRenderVertices(o)}return i.buffer}}const iue=[0,0,0],rue=[0,0,0],sue=Jle().vec3f("start").vec3f("end").vec3f("up").vec2f("extrude"),nue=new Map([["position",0],["normal",1],["uv0",2],["color",3],["size",4],["tangent",4],["auxpos1",5],["symbolColor",5],["auxpos2",6],["featureAttribute",6],["instanceFeatureAttribute",6],["instanceColor",7],["model",8],["modelNormal",12],["modelOriginHi",11],["modelOriginLo",15]]),oue=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}],aue=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];function lue(e,t=oue,i=nue,r=-1,s=1){let n=null;switch(t){case aue:n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]);break;case oue:default:n=new Float32Array([r,r,s,r,r,s,s,s])}return new eue(e,i,{geometry:t},{geometry:Wce.createVertex(e,35044,n)})}function hue(e){return new zhe(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}class cue{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function uue(e,t){if(!e){t=t||"assert";const e=new Error(t);throw e.stack&&console.log(e.stack),new cue(t)}}function pue(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let h=(i[2]-e[2])/t[2],c=(r[2]-e[2])/t[2];return h>c&&(s=h,h=c,c=s),!(n>c||h>o||(c<o&&(o=c),o<0))}function due(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function fue(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]}function yue(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function gue(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function mue(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function vue(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function bue(e,t,i=0){const r=mv(e,0,Sue);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*Mue(r*_ue[s]))}function wue(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*xue[r];return i}const _ue=[1,256,65536,16777216],xue=[1/256,1/65536,1/16777216,1/4294967296],Sue=wue(new Uint8ClampedArray([255,255,255,255]));function Mue(e){return e-Math.floor(e)}function Tue(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return Cue.scale=Math.min(r.divisor/(t-r.offset),1),Cue.factor=function(e){return Math.abs(e*e*e)}(e),Cue.minPixelSize=r.minPixelSize,Cue.paddingPixels=s,Cue}function Iue(e,t){return 0===e?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function Eue(e,t){return Math.max(xv(e*t.scale,e,t.factor),Iue(e,t))}function Aue(e,t,i,r){r.scale=function(e,t,i){const r=Tue(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,Eue(1,r)}(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function Pue(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,Iue(e[1],t)/e[1]),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}const Cue={scale:0,factor:0,minPixelSize:0,paddingPixels:0};function Oue(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function kue(e,t,i,r){for(let s=0;s<r;++s)Lue[0]=e[s],Oue(Lue,Rue,1),t[s]=Rue[0],i[s]=Rue[1]}const Lue=new Float64Array(1),Rue=new Float32Array(2);function Due(e,t){return v(e)&&(e=[]),e.push(t),e}function Fue(e,t){if(v(e))return e;const i=e.filter((e=>e!==t));return 0===i.length?null:i}function jue(e){return!!m(e)&&!e.visible}function Nue(e,t){const i=new Map;return i.set(0,t.acquire(e,0)),i.set(1,t.acquire(e,7)),i.set(4,t.acquire(e,3)),i.set(3,t.acquire(e,2)),i.set(2,t.acquire(e,1)),i.set(5,t.acquire(e,4)),i.set(7,t.acquire(e,3)),i.set(6,t.acquire(e,3)),i}function zue(e,t){t.release(e,0),t.release(e,7),t.release(e,3),t.release(e,2),t.release(e,1),t.release(e,4)}function Vue(e,t,i){const r=e.origin.vec3;due(que,-r[0],-r[1],-r[2]),m(e.transformation)?lY(t,que,e.transformation):rY(t,que),i&&(aY(i,t),oY(i,i))}function Uue(e,t,i,r,s){Gue[0]=e.get(t,0),Gue[1]=e.get(t,1),Gue[2]=e.get(t,2),Oue(Gue,Bue,3),i.set(s,0,Bue[0]),r.set(s,0,Bue[1]),i.set(s,1,Bue[2]),r.set(s,1,Bue[3]),i.set(s,2,Bue[4]),r.set(s,2,Bue[5])}const Gue=new Float64Array(3),Bue=new Float32Array(6),que=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Hue=Vte();function Wue(e,t,i,r,s,n,o){if(!jue(t))if(e.boundingInfo){uue(0===e.primitiveType);const t=i.tolerance;Jue(e.boundingInfo,r,s,t,n,o)}else{const t=e.indices.get("position"),i=e.vertexAttributes.get("position");Kue(r,s,0,t.length/3,t,i,void 0,n,o)}}const $ue=[0,0,0];function Jue(e,t,i,r,s,n){if(v(e))return;const o=function(e,t,i){return Fm(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}(t,i,$ue);if(nie(Hue,e.getBBMin()),oie(Hue,e.getBBMax()),m(s)&&s.applyToAabb(Hue),epe(Hue,t,o,r)){const{primitiveIndices:o,indices:a,position:l}=e,h=o?o.length:a.length/3;if(h>lpe){const o=e.getChildren();if(void 0!==o){for(let e=0;e<8;++e)void 0!==o[e]&&Jue(o[e],t,i,r,s,n);return}}Kue(t,i,0,h,a,l,o,s,n)}}const Xue=[0,0,0];function Kue(e,t,i,r,s,n,o,a,l){if(o)return function(e,t,i,r,s,n,o,a,l){const h=n.data,c=n.stride||n.size,u=e[0],p=e[1],d=e[2],f=t[0]-u,y=t[1]-p,g=t[2]-d;for(let v=i;v<r;++v){const e=o[v];let t=3*e,i=c*s[t++],r=h[i++],n=h[i++],b=h[i];i=c*s[t++];let w=h[i++],_=h[i++],x=h[i];i=c*s[t];let S=h[i++],M=h[i++],T=h[i];m(a)&&([r,n,b]=a.applyToVertex(r,n,b,v),[w,_,x]=a.applyToVertex(w,_,x,v),[S,M,T]=a.applyToVertex(S,M,T,v));const I=w-r,E=_-n,A=x-b,P=S-r,C=M-n,O=T-b,k=y*O-C*g,L=g*P-O*f,R=f*C-P*y,D=I*k+E*L+A*R;if(Math.abs(D)<=Number.EPSILON)continue;const F=u-r,j=p-n,N=d-b,z=F*k+j*L+N*R;if(D>0){if(z<0||z>D)continue}else if(z>0||z<D)continue;const V=j*A-E*N,U=N*I-A*F,G=F*E-I*j,B=f*V+y*U+g*G;if(D>0){if(B<0||z+B>D)continue}else if(B>0||z+B<D)continue;const q=(P*V+C*U+O*G)/D;q>=0&&l(q,Que(I,E,A,P,C,O,Xue),e)}}(e,t,i,r,s,n,o,a,l);const h=n.data,c=n.stride||n.size,u=e[0],p=e[1],d=e[2],f=t[0]-u,y=t[1]-p,g=t[2]-d;for(let v=i,b=3*i;v<r;++v){let e=c*s[b++],t=h[e++],i=h[e++],r=h[e];e=c*s[b++];let n=h[e++],o=h[e++],w=h[e];e=c*s[b++];let _=h[e++],x=h[e++],S=h[e];m(a)&&([t,i,r]=a.applyToVertex(t,i,r,v),[n,o,w]=a.applyToVertex(n,o,w,v),[_,x,S]=a.applyToVertex(_,x,S,v));const M=n-t,T=o-i,I=w-r,E=_-t,A=x-i,P=S-r,C=y*P-A*g,O=g*E-P*f,k=f*A-E*y,L=M*C+T*O+I*k;if(Math.abs(L)<=Number.EPSILON)continue;const R=u-t,D=p-i,F=d-r,j=R*C+D*O+F*k;if(L>0){if(j<0||j>L)continue}else if(j>0||j<L)continue;const N=D*I-T*F,z=F*M-I*R,V=R*T-M*D,U=f*N+y*z+g*V;if(L>0){if(U<0||j+U>L)continue}else if(U>0||j+U<L)continue;const G=(E*N+A*z+P*V)/L;G>=0&&l(G,Que(M,T,I,E,A,P,Xue),v)}}const Yue=[0,0,0],Zue=[0,0,0];function Que(e,t,i,r,s,n,o){return Fm(Yue,e,t,i),Fm(Zue,r,s,n),Xm(o,Yue,Zue),$m(o,o),o}function epe(e,t,i,r){return function(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const h=(e[1]-r-t[1])*i[1],c=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(h,c)),l<0)return!1;if(a=Math.max(a,Math.min(h,c)),a>l)return!1;const u=(e[2]-r-t[2])*i[2],p=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(u,p)),!(l<0)&&(a=Math.max(a,Math.min(u,p)),!(a>l)&&a<s)}(e,t,i,r,1/0)}function tpe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;s&&(n=function(e,t,i,r){return Eue(e,Tue(t,i,r))}(n,r,t,s));return mv(n*Math.tan(.5*e.fovY)/(.5*e.fullHeight)*t,i.minWorldLength||0,null!=i.maxWorldLength?i.maxWorldLength:1/0)}function ipe(e,t,i){if(!e)return;const r=e.parameters,s=e.paddingPixelsOverride;t.setUniform4f(i,r.divisor,r.offset,r.minPixelSize,s)}function rpe(e,t){const i=t?rpe(t):{};for(const r in e){let t=e[r];t&&t.forEach&&(t=ope(t)),null==t&&r in i||(i[r]=t)}return i}function spe(e,t){let i=!1;for(const r in t){const s=t[r];void 0!==s&&(i=!0,Array.isArray(s)?e[r]=s.slice():e[r]=s)}return i}function npe(e,t,i,r,s){if(!t.options.selectionMode)return;const n=e.vertexAttributes.get("position").data,o=e.vertexAttributes.get("size"),a=o&&o.data[0],l=i[0],h=i[1],c=((a+r)/2+4)*e.screenToWorldRatio;let u=Number.MAX_VALUE;for(let p=0;p<n.length-5;p+=3){const e=n[p],t=n[p+1],i=l-e,r=h-t,s=n[p+3]-e,o=n[p+4]-t,a=mv((s*i+o*r)/(s*s+o*o),0,1),c=s*a-i,d=o*a-r,f=c*c+d*d;f<u&&(u=f)}u<c*c&&s()}function ope(e){const t=[];return e.forEach((e=>t.push(e))),t}const ape={multiply:1,ignore:2,replace:3,tint:4},lpe=1e3;function hpe(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add(_ce`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)}const cpe=Sv(6);function upe(e){const t=new Ace;return t.extensions.add("GL_OES_standard_derivatives"),t.include(hpe),t.include(Tce,e),t.fragment.uniforms.add("angleCutoff","vec2"),t.fragment.uniforms.add("globalAlpha","float"),e.heightManifoldEnabled&&t.fragment.uniforms.add("heightPlane","vec4"),e.pointDistanceEnabled&&t.fragment.uniforms.add("pointDistanceSphere","vec4"),e.lineVerticalPlaneEnabled&&t.fragment.uniforms.add("lineVerticalPlane","vec4").add("lineVerticalStart","vec3").add("lineVerticalEnd","vec3"),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&t.fragment.uniforms.add("maxPixelDistance","float"),e.intersectsLineEnabled&&t.fragment.uniforms.add("intersectsLineStart","vec3").add("intersectsLineEnd","vec3").add("intersectsLineDirection","vec3").add("intersectsLineRadius","float").add("perScreenPixelRatio","float"),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&t.fragment.code.add(_ce`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.pointDistanceEnabled&&t.fragment.code.add(_ce`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),e.intersectsLineEnabled&&t.fragment.code.add(_ce`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&t.fragment.code.add(_ce`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),t.fragment.code.add(_ce`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),e.heightManifoldEnabled&&t.fragment.code.add(_ce`{
float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));
vec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));
color = max(color, heightManifoldColor * heightManifoldAlpha);
}`),e.pointDistanceEnabled&&t.fragment.code.add(_ce`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`),e.lineVerticalPlaneEnabled&&t.fragment.code.add(_ce`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`),e.intersectsLineEnabled&&t.fragment.code.add(_ce`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`),t.fragment.code.add(_ce`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),t}var ppe=Object.freeze({__proto__:null,defaultAngleCutoff:cpe,build:upe});class dpe extends Kle{initializeProgram(e){const t=dpe.shader.get(),i=this.configuration,r=t.build(i);return new wce(e.rctx,r,nue)}bind(e,t){this.program.setUniform3fv("innerColor",e.innerColor),this.program.setUniform1f("innerWidth",e.innerWidth*t.pixelRatio),this.program.setUniform3fv("glowColor",e.glowColor),this.program.setUniform1f("glowWidth",e.glowWidth*t.pixelRatio),this.program.setUniform1f("glowFalloff",e.glowFalloff),this.program.setUniform1f("globalAlpha",e.globalAlpha),this.configuration.contrastControlEnabled&&this.program.setUniform1f("globalAlphaContrastBoost",null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1);const i=null!=e.angleCutoff?e.angleCutoff:cpe;this.program.setUniform2f("angleCutoff",Math.cos(i),Math.cos(Math.max(0,i-Sv(2)))),this.configuration.intersectsLineEnabled&&this.program.setUniform1f("perScreenPixelRatio",t.perScreenPixelRatio)}initializePipeline(){return mhe({blending:ihe(1,771),colorWrite:lhe})}}dpe.shader=new Xle(ppe,(()=>import("./Laserlines.glsl.4fd1bf16.js")));class fpe extends Yle{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.contrastControlEnabled=!1}}Q([Zle()],fpe.prototype,"heightManifoldEnabled",void 0),Q([Zle()],fpe.prototype,"pointDistanceEnabled",void 0),Q([Zle()],fpe.prototype,"lineVerticalPlaneEnabled",void 0),Q([Zle()],fpe.prototype,"intersectsLineEnabled",void 0),Q([Zle()],fpe.prototype,"contrastControlEnabled",void 0);const ype=[0,0,0],gpe=[0,0,0,0],mpe={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:Sv(6),globalAlphaContrastBoost:2};function vpe(e,t,i,r){const s=ype,n=gpe;Ym(s,t,r),Dm(n,i),n[3]=0,Gre(n,n,r),One(s,n,e)}class bpe{constructor(e,t={},i={contrastControlEnabled:!1}){this._renderCoordsHelper=e,this._config=i,this._technique=null,this._projInfo=[0,0,0,0],this._zScale=[0,0],this._heightManifoldEnabled=!1,this._heightManifoldTarget=[0,0,0],this._pointDistanceEnabled=!1,this._pointDistanceOrigin=[0,0,0],this._pointDistanceTarget=[0,0,0],this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=zae(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=zae(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=[0,0,0],this._tempDir=[0,0,0],this._tempUp=[0,0,0],this._tempVec3A=[0,0,0],this._tempVec3B=[0,0,0],this._tempVec4=[0,0,0,0],this._tempPlane=Ene(),this._tempSphere=[0,0,0,0],this._params=rpe(t,mpe)}get renderSlots(){return[this._config.contrastControlEnabled?17:16]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._heightManifoldTarget}set heightManifoldTarget(e){Dm(this._heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._pointDistanceTarget}set pointDistanceTarget(e){Dm(this._pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._pointDistanceOrigin}set pointDistanceOrigin(e){Dm(this._pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){Vae(e,this._lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._intersectsLineSegment}set intersectsLineSegment(e){Vae(e,this._intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._intersectsLineRadius}set intersectsLineRadius(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,m(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){v(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new tue(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){v(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new tue(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameterValues(e){spe(this._params,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=lue(t),this._techniqueRepository=e.shaderTechniqueRep,this._techniqueConfig=new fpe;const i=new Uce;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(Vce,i)}uninitializeRenderContext(){this._quadVAO=T(this._quadVAO),this._technique=A(this._technique),this._pathVerticalPlaneData=T(this._pathVerticalPlaneData),this._pathTechnique=A(this._pathTechnique)}render(e){const t=this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled,i=this.pathVerticalPlaneEnabled;if(!t&&!i)return!0;const r=e.camera;return function(e,t,i,r,s){const n=e;0===e[11]?(r[0]=2/(t*n[0]),r[1]=2/(i*n[5]),r[2]=(1+n[12])/n[0],r[3]=(1+n[13])/n[5],AX(s,0,1)):(r[0]=-2/(t*n[0]),r[1]=-2/(i*n[5]),r[2]=(1-n[8])/n[0],r[3]=(1-n[9])/n[5],AX(s,1,0))}(r.projectionMatrix,r.fullWidth,r.fullHeight,this._projInfo,this._zScale),t&&this.renderUnified(e),i&&this.renderPath(e),!0}renderUnified(e){const t=e.rctx,i=this._selectTechnique(),r=i.program;t.useProgram(r),i.bindPipelineState(t),this._bindGlobalUniforms(e,r),this.bindHeightManifoldUniforms(e,r),this.bindPointDistanceUniforms(e,r),this.bindLineVerticalPlaneUniforms(e,r),this.bindIntersectsLineUniforms(e,r),i.bind(this._params,e.camera),t.bindVAO(this._quadVAO),t.drawArrays(5,0,4)}renderPath(e){if(v(this._pathVerticalPlaneData)||v(this._pathTechnique))return;const t=e.rctx,i=this._pathTechnique,r=i.program;t.useProgram(r),i.bindPipelineState(t),this._bindGlobalUniforms(e,r),i.bind(this._params,this._pathVerticalPlaneData.origin,e.camera),this._pathVerticalPlaneData.draw(e.rctx)}bindHeightManifoldUniforms(e,t){if(!this.heightManifoldEnabled)return;const i=this._tempVec3A,r=this._tempPlane;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),vpe(r,this._heightManifoldTarget,i,e.camera.viewMatrix),t.setUniform4fv("heightPlane",r)}bindPointDistanceUniforms(e,t){if(!this._pointDistanceEnabled)return;const i=e.camera,r=this._tempSphere;Dm(r,this._pointDistanceOrigin),Ym(r,r,i.viewMatrix),r[3]=Bm(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",r[0],r[1],r[2],r[3])}bindLineVerticalPlaneUniforms(e,t){if(!this._lineVerticalPlaneEnabled)return;const i=this._renderCoordsHelper,r=e.camera,s=this._tempPlane,n=this._tempVec3A,o=this._tempUp,a=this._tempDir,l=this._tempNormal;qae(this._lineVerticalPlaneSegment,.5,n),i.worldUpAtPosition(n,o),$m(a,this._lineVerticalPlaneSegment.vector),Xm(l,o,a),$m(l,l),vpe(s,this._lineVerticalPlaneSegment.origin,l,r.viewMatrix),t.setUniform4fv("lineVerticalPlane",s);const h=this._tempVec3A;Dm(h,this._lineVerticalPlaneSegment.origin),i.setAltitude(h,0),Ym(h,h,r.viewMatrix),t.setUniform3fv("lineVerticalStart",h);const c=this._tempVec3B;jm(c,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(c,0),Ym(c,c,r.viewMatrix),t.setUniform3fv("lineVerticalEnd",c)}bindIntersectsLineUniforms(e,t){if(!this._intersectsLineEnabled)return;const i=_pe,r=xpe;if(this._intersectsLineInfinite){const t=e.camera;if(Aae(Qse(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),wpe),wpe.c0=-Number.MAX_VALUE,!Fae(t.frustum,wpe))return;Pae(wpe,i),Cae(wpe,r)}else Dm(i,this._intersectsLineSegment.origin),jm(r,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);const s=this._tempVec3A;Ym(s,i,e.camera.viewMatrix),t.setUniform3fv("intersectsLineStart",s);const n=this._tempVec4;Dm(n,this._intersectsLineSegment.vector),this._tempVec4[3]=0,Gre(this._tempVec4,this._tempVec4,e.camera.viewMatrix),Ym(r,r,e.camera.viewMatrix),t.setUniform3fv("intersectsLineEnd",r),$m(n,n),t.setUniform3f("intersectsLineDirection",n[0],n[1],n[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}_bindGlobalUniforms(e,t){const i=e.camera;t.setUniform4fv("projInfo",this._projInfo),t.setUniform2fv("zScale",this._zScale),t.setUniform2f("nearFar",i.near,i.far),this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture(e.offscreenRenderingHelper.linearDepthTexture,"depthMap"),t.bindTexture(e.offscreenRenderingHelper.mainColorTexture,"frameColor")}_requestRender(){this._context&&this._context.requestRender()}_selectTechnique(){return this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(dpe,this._techniqueConfig,this._technique),this._technique}}const wpe=Eae(),_pe=[0,0,0],xpe=[0,0,0];class Spe extends Yae{constructor(e){super(e.view),this._angleCutoff=cpe,this._style={},this._heightManifoldTarget=[0,0,0],this._heightManifoldEnabled=!1,this._intersectsLine=zae(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this.renderer}createResources(){this.ensureRenderer()}destroyResources(){this.disposeRenderer()}updateVisibility(){this.syncHeightManifold(),this.syncIntersectsLine(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this.syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this.syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){m(e)?(Dm(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this.syncRenderer(),this.syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(v(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,Mpe);this.intersectsLine=Uae(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){m(e)?(Vae(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this.syncIntersectsLine(),this.syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this.syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=m(e)?Vae(e):null,this.syncLineVerticalPlane(),this.syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=m(e)?{origin:fm(e.origin),target:fm(e.target)}:null,this.syncPointDistance(),this.syncRenderer()}syncRenderer(){this.attached&&(this._intersectsLineEnabled||this._heightManifoldEnabled||m(this._pointDistanceLine)||m(this._pathVerticalPlaneBuffers))?this.ensureRenderer():this.disposeRenderer()}ensureRenderer(){m(this.renderer)||(this.renderer=new bpe(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this.syncStyle(),this.syncHeightManifold(),this.syncIntersectsLine(),this.syncIntersectsLineInfinite(),this.syncPathVerticalPlane(),this.syncLineVerticalPlane(),this.syncPointDistance(),this.syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}syncStyle(){v(this.renderer)||(this.renderer.setParameterValues(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}syncAngleCutoff(){v(this.renderer)||this.renderer.setParameterValues({angleCutoff:this._angleCutoff})}syncHeightManifold(){v(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}syncIntersectsLine(){v(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}syncIntersectsLineInfinite(){v(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}syncPathVerticalPlane(){v(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=m(this._pathVerticalPlaneBuffers)&&this.visible,m(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}syncLineVerticalPlane(){v(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=m(this._lineVerticalPlaneSegment)&&this.visible,m(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}syncPointDistance(){v(this.renderer)||(this.renderer.pointDistanceEnabled=m(this._pointDistanceLine)&&this.visible,m(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}disposeRenderer(){m(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}const Mpe=[0,0,0];class Tpe{constructor(){this.id=uE()}unload(){}}class Ipe{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(e,t,i,r,s,n){this.id=uE(),this.geometry=e,this.material=t,this.transformation=i,this.instanceParameters=r,this.origin=s,this._shaderTransformation=n,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return m(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&(Ym(e,e,this.getStaticTransformation()),!0)}}Ipe.pool=new Gr(Ipe);class Epe{constructor(e){this.channel=e,this.id=uE()}}class Ape extends Tpe{constructor(e={}){super(),this.type=1,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this._bvObjectSpace=new Cpe,this._bvWorldSpace=new Cpe,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==e.castShadow||e.castShadow,this.metadata=e.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new Ppe),this.transformation=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];const{geometries:t,materials:i,transformations:r,origins:s}=e;if(Array.isArray(t)){uue(i.length===t.length,"Object3D: materials don't match geometries"),uue(r.length===t.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=t.length,this._geometries.length=t.length;for(let e=0;e<t.length;e++)this._geometries[e]=t[e],this._geometryRecords[e]=Ipe.pool.acquire(t[e],i[e],jse(r[e]),{highlights:null,occludees:null,visible:!0},s&&s[e])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(e){rY(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){uue(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}getNumGeometryRecords(){return this._geometryRecords.length}getGeometryRecord(e){return uue(e>=0&&e<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range"),this._geometryRecords[e]}addGeometry(e,t,i,r,s,n){i=i||Vse,this._geometries.push(e);const o=Ipe.pool.acquire(e,t,i,r||{highlights:null,occludees:null,visible:!0},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||m(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(e){const t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=m(t.shaderTransformation)?this._geometryRecords.some((e=>m(e.shaderTransformation))):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}removeAllGeometries(){for(;this.getNumGeometryRecords()>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("vertexAttrsUpdated",{object:this,record:this._geometryRecords[e]}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(e){this._visible=e;for(const t of this._geometryRecords)t.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}maskOccludee(){const e=new Epe(1);for(const t of this._geometryRecords)t.instanceParameters.occludees=Due(t.instanceParameters.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometryRecords)t.instanceParameters.occludees=Fue(t.instanceParameters.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new Epe(0);for(const t of this._geometryRecords)t.instanceParameters.highlights=Due(t.instanceParameters.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometryRecords)t.instanceParameters.highlights=Fue(t.instanceParameters.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return lY(S(t,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.transformation,e.getStaticTransformation())}getCombinedShaderTransformation(e,t){return lY(t=t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.transformation,e.getShaderTransformation()),t}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let r=0;r<this._geometryRecords.length;++r){const e=this._geometries[r],t=this._geometryRecords[r],i=e.boundingInfo;m(i)&&(this._calculateTransformedBoundingVolume(i,this._bvObjectSpace,t.getShaderTransformation()),this._calculateTransformedBoundingVolume(i,this._bvWorldSpace,this.getCombinedShaderTransformation(t)))}Km(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Km(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const e=[0,0,0],t=[0,0,0],i=n$(this.transformation);for(let r=0;r<this._geometryRecords.length;++r){const s=this._geometries[r].boundingInfo;if(v(s))continue;const n=this._geometryRecords[r].getShaderTransformation(),o=n$(n);Ym(e,s.getCenter(),n);const a=Bm(e,this._bvObjectSpace.bounds),l=s.getBSRadius()*o;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],a+l),Ym(t,e,this.transformation);const h=Bm(t,this._bvWorldSpace.bounds),c=l*i;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+c)}this._bvDirty=!1}_calculateTransformedBoundingVolume(e,t,i){const r=e.getBBMin(),s=e.getBBMax(),n=fm(r),o=fm(s);Ym(n,n,i),Ym(o,o,i);for(let a=0;a<3;++a)t.min[a]=Math.min(t.min[a],n[a],o[a]),t.max[a]=Math.max(t.max[a],n[a],o[a]);for(let a=0;a<3;++a){Dm(n,r),Dm(o,s),n[a]=s[a],o[a]=r[a],Ym(n,n,i),Ym(o,o,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],n[e],o[e]),t.max[e]=Math.max(t.max[e],n[e],o[e])}}_invalidateBoundingVolume(){this._bvDirty=!0,m(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(e,t){m(this._parentLayer)&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.indexOf(t)>-1,getGeometryIndex:t=>e._geometries.indexOf(t)}}}class Ppe{constructor(){this.min=ym(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=ym(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Cpe extends Ppe{constructor(){super(...arguments),this.bounds=[0,0,0,0]}init(){Fm(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Fm(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),fne(this.bounds)}}const Ope=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class kpe{constructor(e,t){this._objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Lpe,this._objectCount=0,t&&(void 0!==t.maximumObjectsPerNode&&(this._maximumObjectsPerNode=t.maximumObjectsPerNode),void 0!==t.maximumDepth&&(this._maximumDepth=t.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),Lpe.clearPool(),qpe[0]=null,Xpe.prune(),tde.prune()}add(e,t=e.length){this._objectCount+=t,this._grow(e,t);const i=Lpe.acquire();for(let r=0;r<t;r++){const t=e[r];this._isDegenerate(t)?this._degenerateObjects.add(t):(i.init(this._root),this._add(t,i))}Lpe.release(i)}remove(e,t=null){this._objectCount-=e.length;const i=Lpe.acquire();for(const r of e){const e=m(t)?t:pne(this._objectToBoundingSphere(r),Kpe);Vpe(e[3])?(i.init(this._root),this._remove(r,e,i)):this._degenerateObjects.delete(r)}Lpe.release(i),this._shrink()}update(e,t){if(!Vpe(t[3])&&this._isDegenerate(e))return;const i=function(e){return qpe[0]=e,qpe}(e);this.remove(i,t),this.add(i)}forEachAlongRay(e,t,i){const r=Qse(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNode(r,e))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObject(r,e)&&i(e)})),!0}))}forEachAlongRayWithVerticalOffset(e,t,i,r){const s=Qse(e,t);this._forEachNode(this._root,(e=>{if(!this._intersectsNodeWithOffset(s,e,r))return!1;const t=e.node;return t.terminals.forAll((e=>{this._intersectsObjectWithOffset(s,e,r)&&i(e)})),null!==t.residents&&t.residents.forAll((e=>{this._intersectsObjectWithOffset(s,e,r)&&i(e)})),!0}))}forEach(e){this._forEachNode(this._root,(t=>{const i=t.node;return i.terminals.forAll(e),null!==i.residents&&i.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,t,i,r=(()=>!0),s=1/0){let n=1/0,o=1/0,a=null;const l=Npe(e,t),h=l=>{if(--s,!r(l))return;const h=this._objectToBoundingSphere(l);if(!Dae(i,h))return;const c=zpe(e,t,gne(h)),u=c-h[3],p=c+h[3];u<n&&(n=u,o=p,a=l)};return this._forEachNodeDepthOrdered(this._root,(r=>{if(s<=0||!Dae(i,r.bounds))return!1;if(Um(Wpe,l,r.halfSize),jm(Wpe,Wpe,r.bounds),zpe(e,t,Wpe)>o)return!1;const n=r.node;return n.terminals.forAll((e=>h(e))),null!==n.residents&&n.residents.forAll((e=>h(e))),!0}),e,t),a}forEachInDepthRange(e,t,i,r,s,n,o){let a=-1/0,l=1/0;const h={setRange:e=>{1===i?(a=Math.max(a,e.near),l=Math.min(l,e.far)):(a=Math.max(a,-e.far),l=Math.min(l,-e.near))}};h.setRange(r);const c=zpe(t,i,e),u=Npe(t,i),p=Npe(t,-1*i),d=e=>{if(!o(e))return;const r=this._objectToBoundingSphere(e),u=gne(r),p=zpe(t,i,u)-c,d=p-r[3],f=p+r[3];d>l||f<a||!Dae(n,r)||s(e,h)};this._forEachNodeDepthOrdered(this._root,(e=>{if(!Dae(n,e.bounds))return!1;if(Um(Wpe,u,e.halfSize),jm(Wpe,Wpe,e.bounds),zpe(t,i,Wpe)-c>l)return!1;if(Um(Wpe,p,e.halfSize),jm(Wpe,Wpe,e.bounds),zpe(t,i,Wpe)-c<a)return!1;const r=e.node;return r.terminals.forAll((e=>d(e))),null!==r.residents&&r.residents.forAll((e=>d(e))),!0}),t,i)}forEachNode(e){this._forEachNode(this._root,(t=>e(t.node,t.bounds,t.halfSize)))}_intersectsNode(e,t){return Fpe(t.bounds,2*-t.halfSize,$pe),Fpe(t.bounds,2*t.halfSize,Jpe),pue(e.origin,e.direction,$pe,Jpe)}_intersectsNodeWithOffset(e,t,i){return Fpe(t.bounds,2*-t.halfSize,$pe),Fpe(t.bounds,2*t.halfSize,Jpe),i.applyToMinMax($pe,Jpe),pue(e.origin,e.direction,$pe,Jpe)}_intersectsObject(e,t){const i=this._objectToBoundingSphere(t);return!(i[3]>0)||vne(i,e)}_intersectsObjectWithOffset(e,t,i){const r=this._objectToBoundingSphere(t);return!(r[3]>0)||vne(i.applyToBoundingSphere(r),e)}_forEachNode(e,t){let i=Lpe.acquire().init(e);const r=[i];for(;0!==r.length;){if(i=r.pop(),t(i)&&!i.isLeaf())for(let e=0;e<i.node.children.length;e++)i.node.children[e]&&r.push(Lpe.acquire().init(i).advance(e));Lpe.release(i)}}_forEachNodeDepthOrdered(e,t,i,r=1){let s=Lpe.acquire().init(e);const n=[s];for(function(e,t,i){if(!tde.length)for(let r=0;r<8;++r)tde.push({index:0,distance:0});for(let r=0;r<8;++r){const i=Upe[r];tde.data[r].index=r,tde.data[r].distance=zpe(e,t,i)}tde.sort(((e,t)=>e.distance-t.distance));for(let r=0;r<8;++r)i[r]=tde.data[r].index}(i,r,ide);0!==n.length;){if(s=n.pop(),t(s)&&!s.isLeaf())for(let e=7;e>=0;--e){const t=ide[e];s.node.children[t]&&n.push(Lpe.acquire().init(s).advance(t))}Lpe.release(s)}}_remove(e,t,i){Xpe.clear();const r=i.advanceTo(t,((e,t)=>{Xpe.push(e.node),Xpe.push(t)}))?i.node.terminals:i.node.residents;if(r.removeUnordered(e),0===r.length)for(let s=Xpe.length-2;s>=0;s-=2){const e=Xpe.data[s],t=Xpe.data[s+1];if(!this._purge(e,t))break}}_nodeIsEmpty(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(let t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}_purge(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new Us({shrink:!0})),!0)}_add(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}_split(e){const t=e.node.residents;e.node.residents=null;for(let i=0;i<t.length;i++){const r=Lpe.acquire().init(e);this._add(t.getItemAt(i),r),Lpe.release(r)}}_grow(e,t){if(0!==t&&(jpe(e,t,(e=>this._objectToBoundingSphere(e)),Ype),Vpe(Ype[3])&&!this._fitsInsideTree(Ype)))if(this._nodeIsEmpty(this._root.node))pne(Ype,this._root.bounds),this._root.halfSize=1.25*Ype[3];else{const e=this._rootBoundsForRootAsSubNode(Ype);this._placingRootViolatesMaxDepth(e)?this._rebuildTree(Ype,e):this._growRootAsSubNode(e),Lpe.release(e)}}_rebuildTree(e,t){Dm(Zpe,t.bounds),Zpe[3]=t.halfSize,jpe([e,Zpe],2,(e=>e),Qpe);const i=Lpe.acquire().init(this._root);this._root.initFrom(null,Qpe,1.25*Qpe[3]),this._forEachNode(i,(e=>(this.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&this.add(e.node.residents.data,e.node.residents.length),!0))),Lpe.release(i)}_placingRootViolatesMaxDepth(e){const t=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,(e=>(i=Math.max(i,e.depth),i+t<=this._maximumDepth))),i+t>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const t=e[3],i=e;let r=-1/0;const s=this._root.bounds,n=this._root.halfSize;for(let o=0;o<3;o++){const e=s[o]-n-(i[o]-t),a=i[o]+t-(s[o]+n),l=Math.max(0,Math.ceil(e/(2*n))),h=Math.max(0,Math.ceil(a/(2*n)))+1,c=2**Math.ceil(Math.log(l+h)*Math.LOG2E);r=Math.max(r,c),ede[o].min=l,ede[o].max=h}for(let o=0;o<3;o++){let e=ede[o].min,t=ede[o].max;const i=(r-(e+t))/2;e+=Math.ceil(i),t+=Math.floor(i);const a=s[o]-n-e*n*2;Hpe[o]=a+(t+e)*n}return Hpe[3]=r*n*Bpe,Lpe.acquire().initFrom(null,Hpe,r*n,0)}_growRootAsSubNode(e){const t=this._root.node;Dm(Ype,this._root.bounds),Ype[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Ype,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let e=null;const t=this._root.node.children;let i=0,r=0;for(;r<t.length&&null==e;)i=r++,e=t[i];for(;r<t.length;)if(t[r++])return-1;return i}_isDegenerate(e){return!Vpe(this._objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const t=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=t[0]-i&&e[0]<=t[0]+i&&e[1]>=t[1]-i&&e[1]<=t[1]+i&&e[2]>=t[2]-i&&e[2]<=t[2]+i}}class Lpe{constructor(){this.bounds=[0,0,0,0],this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,t,i,r=this.depth){return this.node=m(e)?e:Lpe.createEmptyNode(),m(t)&&pne(t,this.bounds),this.halfSize=i,this.depth=r,this}advance(e){let t=this.node.children[e];t||(t=Lpe.createEmptyNode(),this.node.children[e]=t),this.node=t,this.halfSize/=2,this.depth++;const i=Upe[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.bounds[3]=this.halfSize*Bpe,this}advanceTo(e,t,i=!1){for(;;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!i)return t&&t(this,-1),!1;this.node.residents=null}const r=this._childIndex(e);t&&t(this,r),this.advance(r)}}isLeaf(){return null!=this.node.residents}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new Us({shrink:!0}),residents:new Us({shrink:!0})}}static acquire(){return Lpe._pool.acquire()}static release(e){Lpe._pool.release(e)}static clearPool(){Lpe._pool.prune()}}function Rpe(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Dpe(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function Fpe(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function jpe(e,t,i,r){if(1===t){pne(i(e[0]),r)}else{$pe[0]=1/0,$pe[1]=1/0,$pe[2]=1/0,Jpe[0]=-1/0,Jpe[1]=-1/0,Jpe[2]=-1/0;for(let r=0;r<t;r++){const t=i(e[r]);Vpe(t[3])&&(Rpe($pe,t),Dpe(Jpe,t))}Km(r,$pe,Jpe,.5),r[3]=Math.max(Jpe[0]-$pe[0],Jpe[1]-$pe[1],Jpe[2]-$pe[2])/2}}function Npe(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=zpe(e,t,Gpe[s]);n<i&&(i=n,r=Gpe[s])}return r}function zpe(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function Vpe(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}Lpe._pool=new Gr(Lpe);const Upe=[ym(-1,-1,-1),ym(1,-1,-1),ym(-1,1,-1),ym(1,1,-1),ym(-1,-1,1),ym(1,-1,1),ym(-1,1,1),ym(1,1,1)],Gpe=[ym(-1,-1,-1),ym(-1,-1,1),ym(-1,1,-1),ym(-1,1,1),ym(1,-1,-1),ym(1,-1,1),ym(1,1,-1),ym(1,1,1)],Bpe=Math.sqrt(3),qpe=[null];const Hpe=[0,0,0,0],Wpe=[0,0,0],$pe=[0,0,0],Jpe=[0,0,0],Xpe=new Us,Kpe=[0,0,0,0],Ype=[0,0,0,0],Zpe=[0,0,0,0],Qpe=[0,0,0,0],ede=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],tde=new Us,ide=[0,0,0,0,0,0,0,0];class rde extends Tpe{constructor(e,t=""){var i,r,s;super(),this.apiLayerUid=t,this.type=0,this.events=new sh,this.isSliceable=!1,this._objects=new Us,this._stageHandles=new Mh,this.apiLayerUid=t,this.isVisible=null==(i=null==e?void 0:e.isVisible)||i,this.isPickable=null==(r=null==e?void 0:e.isPickable)||r,this.updatePolicy=null!=(s=null==e?void 0:e.updatePolicy)?s:0}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(e){this.detachStage(),this._stage=e;for(const t of Ope)this._stageHandles.add(this.events.on(t,(i=>e.handleEvent(t,i))))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),m(this._octree)&&this._octree.add([e])}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),m(this._octree)&&this._octree.remove([e]))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),m(this._octree)&&this._octree.add(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),m(this._octree)&&this._octree.remove(t)}}sync(){m(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){m(this._octree)&&this._octree.update(e,t)}getSpatialQueryAccelerator(){return v(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=M(this._octree)}_createOctree(){this._octree=new kpe((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)}}class sde extends Yae{constructor(e){super(e.view),this._resources=null,this._transform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}get object(){return m(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){rY(this._transform,e),m(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(v(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new rde({isPickable:!1,updatePolicy:1});e.add(t);const i=new Ape({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;!v(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((t=>{e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){v(this._resources)||this._resources.object.setVisible(e)}}function nde(){return new Float32Array(3)}function ode(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ade(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function lde(){return nde()}function hde(){return ade(1,1,1)}function cde(){return ade(1,0,0)}function ude(){return ade(0,1,0)}function pde(){return ade(0,0,1)}const dde=lde(),fde=hde(),yde=cde(),gde=ude(),mde=pde();var vde;Object.freeze({__proto__:null,create:nde,clone:ode,fromValues:ade,createView:function(e,t){return new Float32Array(e,t,3)},zeros:lde,ones:hde,unitX:cde,unitY:ude,unitZ:pde,ZEROS:dde,ONES:fde,UNIT_X:yde,UNIT_Y:gde,UNIT_Z:mde}),function(e){e.length=function(e,t){const i=e[t],r=e[t+1],s=e[t+2];return Math.sqrt(i*i+r*r+s*s)},e.normalize=function(e,t){const i=e[t],r=e[t+1],s=e[t+2],n=1/Math.sqrt(i*i+r*r+s*s);e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},e.add=function(e,t,i,r,s,n=t){(s=s||e)[n]=e[t]+i[r],s[n+1]=e[t+1]+i[r+1],s[n+2]=e[t+2]+i[r+2]},e.subtract=function(e,t,i,r,s,n=t){(s=s||e)[n]=e[t]-i[r],s[n+1]=e[t+1]-i[r+1],s[n+2]=e[t+2]-i[r+2]}}(vde||(vde={}));class bde{constructor(e,t,i,r){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.indices=i,this.position=r,this.center=[0,0,0],uue(e.length>=1),uue(i.length%this._numIndexPerPrimitive==0),uue(i.length>=e.length*this._numIndexPerPrimitive),uue(3===r.size||4===r.size);const{data:s,size:n}=r,o=e.length;let a=n*i[this._numIndexPerPrimitive*e[0]];wde.clear(),wde.push(a),this.bbMin=ym(s[a],s[a+1],s[a+2]),this.bbMax=fm(this.bbMin);for(let h=0;h<o;++h){const t=this._numIndexPerPrimitive*e[h];for(let e=0;e<this._numIndexPerPrimitive;++e){a=n*i[t+e],wde.push(a);let r=s[a];this.bbMin[0]=Math.min(r,this.bbMin[0]),this.bbMax[0]=Math.max(r,this.bbMax[0]),r=s[a+1],this.bbMin[1]=Math.min(r,this.bbMin[1]),this.bbMax[1]=Math.max(r,this.bbMax[1]),r=s[a+2],this.bbMin[2]=Math.min(r,this.bbMin[2]),this.bbMax[2]=Math.max(r,this.bbMax[2])}}Km(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let l=this.radius*this.radius;for(let h=0;h<wde.length;++h){a=wde.getItemAt(h);const e=s[a]-this.center[0],t=s[a+1]-this.center[1],i=s[a+2]-this.center[2],r=e*e+t*t+i*i;if(r<=l)continue;const n=Math.sqrt(r),o=.5*(n-this.radius);this.radius=this.radius+o,l=this.radius*this.radius;const c=o/n;this.center[0]+=e*c,this.center[1]+=t*c,this.center[2]+=i*c}wde.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(qm(this.bbMin,this.bbMax)>1){const e=Km([0,0,0],this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,i=new Uint8Array(t),r=new Array(8);for(let l=0;l<8;++l)r[l]=0;const{data:s,size:n}=this.position;for(let l=0;l<t;++l){let t=0;const o=this._numIndexPerPrimitive*this.primitiveIndices[l];let a=n*this.indices[o],h=s[a],c=s[a+1],u=s[a+2];for(let e=1;e<this._numIndexPerPrimitive;++e){a=n*this.indices[o+e];const t=s[a],i=s[a+1],r=s[a+2];t<h&&(h=t),i<c&&(c=i),r<u&&(u=r)}h<e[0]&&(t|=1),c<e[1]&&(t|=2),u<e[2]&&(t|=4),i[l]=t,++r[t]}let o=0;for(let l=0;l<8;++l)r[l]>0&&++o;if(o<2)return;const a=new Array(8);for(let l=0;l<8;++l)a[l]=r[l]>0?new Uint32Array(r[l]):void 0;for(let l=0;l<8;++l)r[l]=0;for(let l=0;l<t;++l){const e=i[l];a[e][r[e]++]=this.primitiveIndices[l]}this._children=new Array(8);for(let l=0;l<8;++l)void 0!==a[l]&&(this._children[l]=new bde(a[l],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){wde.prune()}}const wde=new Us({deallocator:null});function _de(e,t,i){return Nm(xde,t,e),Nm(Sde,i,e),Rm(Xm(xde,xde,Sde))/2}new kse(zae),new kse((()=>({p0:null,p1:null,p2:null})));const xde=[0,0,0],Sde=[0,0,0];let Mde=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const Tde=new Uint16Array([0]),Ide=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function Ede(e){if(1===e)return Tde;if(e<Ide.length)return new Uint16Array(Ide.buffer,0,e);if(e>Mde.length){const t=Math.max(2*Mde.length,e);Mde=new Uint32Array(t);for(let e=0;e<Mde.length;e++)Mde[e]=e}return new Uint32Array(Mde.buffer,0,e)}function Ade(e){if(1===e)return new Uint16Array(Tde);if(e<Ide.length)return new Uint16Array(Ide.slice(0,e));if(e>Mde.length){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}return new Uint32Array(Mde.slice(0,e))}function Pde(e,t,i){if(!e)return!1;const{size:r,data:s}=e;Fm(i,0,0,0),Fm(Dde,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const e=t[a+0]*r,l=t[a+1]*r,h=t[a+2]*r;Fm(kde,s[e+0],s[e+1],s[e+2]),Fm(Lde,s[l+0],s[l+1],s[l+2]),Fm(Rde,s[h+0],s[h+1],s[h+2]);const c=_de(kde,Lde,Rde);c?(jm(kde,kde,Lde),jm(kde,kde,Rde),Um(kde,kde,1/3*c),jm(i,i,kde),n+=c):(jm(Dde,Dde,kde),jm(Dde,Dde,Lde),jm(Dde,Dde,Rde),o+=3)}return!(0===o&&0===n||(0!==n?(Um(i,i,1/n),0):0===o||(Um(i,Dde,1/o),0)))}function Cde(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;Fm(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const e=t[a]*r;n!==e&&(i[0]+=s[e+0],i[1]+=s[e+1],i[2]+=s[e+2],o++),n=e}return o>1&&Um(i,i,1/o),o>0}function Ode(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;Fm(r,0,0,0),Fm(Dde,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,h=l+(i?2:0);for(let c=0;c<h;c+=2){const e=c<l?c:l,i=c<l?c+1:0,h=(t?t[e]:e)*s,u=(t?t[i]:i)*s;kde[0]=n[h+0],kde[1]=n[h+1],kde[2]=n[h+2],Lde[0]=n[u+0],Lde[1]=n[u+1],Lde[2]=n[u+2],Um(kde,jm(kde,kde,Lde),.5);const p=hv(kde,Lde);p>0?(jm(r,r,Um(kde,kde,p)),o+=p):(jm(Dde,Dde,kde),a++)}return 0!==o?(Um(r,r,1/o),!0):0!==a&&(Um(r,Dde,1/a),!0)}const kde=[0,0,0],Lde=[0,0,0],Rde=[0,0,0],Dde=[0,0,0];class Fde extends Tpe{constructor(e,t=[],i=0,r=-1){super(),this._primitiveType=i,this.edgeIndicesLength=r,this.type=2,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[s,n]of e)n&&this._vertexAttributes.set(s,a({},n));if(null==t||0===t.length){const e=function(e){const t=e.values().next().value;return null==t?0:t.data.length/t.size}(this._vertexAttributes),t=Ede(e);this.edgeIndicesLength=this.edgeIndicesLength<0?e:this.edgeIndicesLength;for(const i of this._vertexAttributes.keys())this._indices.set(i,t)}else for(const[s,n]of t)n&&(this._indices.set(s,jde(n)),"position"===s&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(s).length:this.edgeIndicesLength))}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){const t=this._vertexAttributes.get(e);return t&&!t.exclusive&&(t.data=Array.from(t.data),t.exclusive=!0),t}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return v(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return 0===this.primitiveType?this.computeAttachmentOriginTriangles(e):this.computeAttachmentOriginPoints(e)}computeAttachmentOriginTriangles(e){const t=this.indices.get("position");return Pde(this.vertexAttributes.get("position"),t,e)}computeAttachmentOriginPoints(e){const t=this.indices.get("position");return Cde(this.vertexAttributes.get("position"),t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get("position");if(0===e.length)return null;const t=0===this.primitiveType?3:1;uue(e.length%t==0,"Indexing error: "+e.length+" not divisible by "+t);const i=Ede(e.length/t),r=this.vertexAttributes.get("position");return new bde(i,t,e,r)}}function jde(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const Nde=vde;var zde,Vde,Ude,Gde;!function(e){const t=.5,i=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let l=0;l<6;l++)for(let e=0;e<6;e++)o[6*l+e]=l;const a=new Uint16Array(36);for(let l=0;l<6;l++)a[6*l+0]=0,a[6*l+1]=1,a[6*l+2]=2,a[6*l+3]=2,a[6*l+4]=3,a[6*l+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(24);for(let r=0;r<8;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new Fde([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}],["uv0",{size:2,data:s}]],[["position",n],["normal",o],["uv0",a]])}}(zde||(zde={})),function(e){const t=.5,i=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(18);for(let r=0;r<6;r++)t[3*r]=i[r][0]*e[0],t[3*r+1]=i[r][1]*e[1],t[3*r+2]=i[r][2]*e[2];return new Fde([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}]],[["position",s],["normal",n]])}}(Vde||(Vde={})),function(e){const t=.5,i=ade(-t,0,-t),r=ade(t,0,-t),s=ade(0,0,t),n=ade(0,.5,0),o=nde(),a=nde(),l=nde(),h=nde(),c=nde();Nm(o,i,n),Nm(a,i,r),Xm(l,o,a),$m(l,l),Nm(o,r,n),Nm(a,r,s),Xm(h,o,a),$m(h,h),Nm(o,s,n),Nm(a,s,i),Xm(c,o,a),$m(c,c);const u=[i,r,s,n],p=[0,-1,0,l[0],l[1],l[2],h[0],h[1],h[2],c[0],c[1],c[2]],d=[0,1,2,3,1,0,3,2,1,3,0,2],f=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);const t=new Array(12);for(let i=0;i<4;i++)t[3*i]=u[i][0]*e[0],t[3*i+1]=u[i][1]*e[1],t[3*i+2]=u[i][2]*e[2];return new Fde([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:p}]],[["position",new Uint16Array(d)],["normal",new Uint16Array(f)]])}}(Ude||(Ude={})),function(e){e.createBoxGeometry=zde.createGeometry,e.createDiamondGeometry=Vde.createGeometry,e.createTetrahedronGeometry=Ude.createGeometry,e.createSphereGeometry=function(e,t,i,r={uv:!0}){const s=-Math.PI,n=2*Math.PI,o=-Math.PI/2,a=Math.PI,l=Math.max(3,Math.floor(t)),h=Math.max(2,Math.floor(i)),c=(l+1)*(h+1),u=new Float32Array(3*c),p=new Float32Array(3*c),d=new Float32Array(2*c),f=[];let y=0;for(let b=0;b<=h;b++){const t=[],i=b/h,r=o+i*a,c=Math.cos(r);for(let o=0;o<=l;o++){const a=o/l,h=s+a*n,f=Math.cos(h)*c,g=Math.sin(r),m=-Math.sin(h)*c;u[3*y]=f*e,u[3*y+1]=g*e,u[3*y+2]=m*e,p[3*y]=f,p[3*y+1]=g,p[3*y+2]=m,d[2*y]=a,d[2*y+1]=i,t.push(y),++y}f.push(t)}const g=new Uint32Array(2*l*(h-1)*3);y=0;for(let b=0;b<h;b++)for(let e=0;e<l;e++){const t=f[b][e],i=f[b][e+1],r=f[b+1][e+1],s=f[b+1][e];0===b?(g[y++]=t,g[y++]=r,g[y++]=s):b===h-1?(g[y++]=t,g[y++]=i,g[y++]=r):(g[y++]=t,g[y++]=i,g[y++]=r,g[y++]=r,g[y++]=s,g[y++]=t)}const m=[["position",g],["normal",g]],v=[["position",{size:3,data:u,exclusive:!0}],["normal",{size:3,data:p,exclusive:!0}]];return r.uv&&(v.push(["uv0",{size:2,data:d,exclusive:!0}]),m.push(["uv0",g])),r.offset&&(m[0][0]="offset",v[0][0]="offset",m.push(["position",new Uint32Array(g.length)]),v.push(["position",{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new Fde(v,m)},e.createPolySphereGeometry=function(e,t,i){const r=e;let s,n;if(i)s=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const e=r*(1+Math.sqrt(5))/2;s=[-r,e,0,r,e,0,-r,-e,0,r,-e,0,0,-r,e,0,r,e,0,-r,-e,0,r,-e,e,0,-r,e,0,r,-e,0,-r,-e,0,r],n=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let u=0;u<s.length;u+=3)Nde.scale(s,u,e/Nde.length(s,u));let o={};function a(t,i){t>i&&([t,i]=[i,t]);const r=t.toString()+"."+i.toString();if(o[r])return o[r];let n=s.length;return s.length+=3,Nde.add(s,3*t,s,3*i,s,n),Nde.scale(s,n,e/Nde.length(s,n)),n/=3,o[r]=n,n}for(let u=0;u<t;u++){const e=n.length,t=new Uint32Array(4*e);for(let i=0;i<e;i+=3){const e=n[i],r=n[i+1],s=n[i+2],o=a(e,r),l=a(r,s),h=a(s,e),c=4*i;t[c]=e,t[c+1]=o,t[c+2]=h,t[c+3]=r,t[c+4]=l,t[c+5]=o,t[c+6]=s,t[c+7]=h,t[c+8]=l,t[c+9]=o,t[c+10]=l,t[c+11]=h}n=t,o={}}const l=new Float32Array(s);for(let u=0;u<l.length;u+=3)Nde.normalize(l,u);const h=[["position",n],["normal",n]],c=[["position",{size:3,data:new Float32Array(s),exclusive:!0}],["normal",{size:3,data:l,exclusive:!0}]];return new Fde(c,h)},e.createPointGeometry=function(e,t,i,r,s,n,o){const a=t?[t[0],t[1],t[2]]:[0,0,0],l=e?[e[0],e[1],e[2]]:[0,0,1];n=n||[0,0];const h=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],c=null!=r&&2===r.length?r:[1,1],u=[["position",{size:3,data:a,exclusive:!0}],["normal",{size:3,data:l,exclusive:!0}],["uv0",{size:n.length,data:n}],["color",{size:4,data:h,exclusive:!0}],["size",{size:2,data:c}]];if(null!=s){const e=new Float32Array([s[0],s[1],s[2],s[3]]);u.push(["auxpos1",{size:4,data:e}])}if(null!=o){const e=new Float32Array([o[0],o[1],o[2],o[3]]);u.push(["auxpos2",{size:4,data:e}])}return new Fde(u,null,1)},e.updatePointGeometry=function(e,t,i,r,s,n,o,a){if(null!=e){const{data:t}=a.getMutableAttribute("normal");t[0]=e[0],t[1]=e[1],t[2]=e[2]}if(null!=t){const{data:e}=a.getMutableAttribute("position");e[0]=t[0],e[1]=t[1],e[2]=t[2]}if(null!=i){const{data:e}=a.getMutableAttribute("color");e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]}if(null!=r){const{data:e}=a.getMutableAttribute("size");e[0]=r[0],e[1]=r[1]}if(null!=s){const{data:e}=a.getMutableAttribute("auxpos1");e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3]}if(null!=n){const{data:e}=a.getMutableAttribute("uv0");e[0]=n[0],e[1]=n[1]}if(null!=o){const{data:e}=a.getMutableAttribute("auxpos2");e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3]}},e.createPointArrayGeometry=function(e,t){const i=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),s=new Uint32Array(e.length),n=new Uint32Array(e.length);for(let o=0;o<e.length;o++)i[3*o]=e[o][0],i[3*o+1]=e[o][1],i[3*o+2]=e[o][2],t&&(r[3*o]=t[o][0],r[3*o+1]=t[o][1],r[3*o+2]=t[o][2]),s[o]=o,n[o]=0;return t||(r[0]=0,r[1]=1,r[2]=0),new Fde([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:r,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",s],["normal",t?s:n],["uv0",n]],1)},e.createTriangleGeometry=function(){const e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),i=new Uint16Array([0,0,0]);return new Fde([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",e],["normal",t],["uv0",i]])};const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function i(e,t,i,r,s){return!(Math.abs(Jm(t,e))>s||(Xm(i,e,t),$m(i,i),Xm(r,i,e),$m(r,r),0))}function r(e,t,r,s,n,o,a){return i(e,t,n,o,a)||i(e,r,n,o,a)||i(e,s,n,o,a)}e.createSquareGeometry=function(e=t){const i=new Array(12);for(let t=0;t<4;t++)for(let r=0;r<3;r++)i[3*t+r]=e[t][r];const r=new Uint32Array([0,1,2,2,3,0]),s=new Uint32Array([0,0,0,0,0,0]);return new Fde([["position",{size:3,data:i,exclusive:!0}],["normal",{size:3,data:[0,0,1],exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",r],["normal",s],["uv0",r],["color",s]])},e.createConeGeometry=function(e,t,i,r,s=!0,n=!0){let o=0;const a=t,l=e;let h=ade(0,o,0),c=ade(0,o+l,0),u=ade(0,-1,0),p=ade(0,1,0);r&&(o=l,c=ade(0,0,0),h=ade(0,o,0),u=ade(0,1,0),p=ade(0,-1,0));const d=[c,h],f=[u,p],y=i+2,g=Math.sqrt(l*l+a*a);if(r)for(let S=i-1;S>=0;S--){const e=S*(2*Math.PI/i),t=ade(Math.cos(e)*a,o,Math.sin(e)*a);d.push(t);const r=ade(l*Math.cos(e)/g,-a/g,l*Math.sin(e)/g);f.push(r)}else for(let S=0;S<i;S++){const e=S*(2*Math.PI/i),t=ade(Math.cos(e)*a,o,Math.sin(e)*a);d.push(t);const r=ade(l*Math.cos(e)/g,a/g,l*Math.sin(e)/g);f.push(r)}const m=new Uint32Array(2*(i+2)*3),v=new Uint32Array(2*(i+2)*3);let b=0,w=0;if(s){for(let e=3;e<d.length;e++)m[b++]=1,m[b++]=e-1,m[b++]=e,v[w++]=0,v[w++]=0,v[w++]=0;m[b++]=d.length-1,m[b++]=2,m[b++]=1,v[w++]=0,v[w++]=0,v[w++]=0}if(n){for(let e=3;e<d.length;e++)m[b++]=e,m[b++]=e-1,m[b++]=0,v[w++]=e,v[w++]=e-1,v[w++]=1;m[b++]=0,m[b++]=2,m[b++]=d.length-1,v[w++]=1,v[w++]=2,v[w++]=f.length-1}const _=new Float32Array(3*y);for(let S=0;S<y;S++)_[3*S]=d[S][0],_[3*S+1]=d[S][1],_[3*S+2]=d[S][2];const x=new Float32Array(3*y);for(let S=0;S<y;S++)x[3*S]=f[S][0],x[3*S+1]=f[S][1],x[3*S+2]=f[S][2];return new Fde([["position",{size:3,data:_,exclusive:!0}],["normal",{size:3,data:x,exclusive:!0}]],[["position",m],["normal",v]])},e.createCylinderGeometry=function(e,t,i,r,s,n){const o=r?ode(r):ade(1,0,0),a=s?ode(s):ade(0,0,0);n=null==n||n;const l=nde();$m(l,o);const h=nde();Um(h,l,Math.abs(e));const c=nde();Um(c,h,-.5),jm(c,c,a);const u=ade(0,1,0);Math.abs(1-Jm(l,u))<.2&&Fm(u,0,0,1);const p=nde();Xm(p,l,u),$m(p,p),Xm(u,p,l);const d=2*i+(n?2:0),f=i+(n?2:0),y=new Float32Array(3*d),g=new Float32Array(3*f),m=new Float32Array(2*d),v=new Uint32Array(3*i*(n?4:2)),b=new Uint32Array(3*i*(n?4:2));n&&(y[3*(d-2)+0]=c[0],y[3*(d-2)+1]=c[1],y[3*(d-2)+2]=c[2],m[2*(d-2)]=0,m[2*(d-2)+1]=0,y[3*(d-1)+0]=y[3*(d-2)+0]+h[0],y[3*(d-1)+1]=y[3*(d-2)+1]+h[1],y[3*(d-1)+2]=y[3*(d-2)+2]+h[2],m[2*(d-1)]=1,m[2*(d-1)+1]=1,g[3*(f-2)+0]=-l[0],g[3*(f-2)+1]=-l[1],g[3*(f-2)+2]=-l[2],g[3*(f-1)+0]=l[0],g[3*(f-1)+1]=l[1],g[3*(f-1)+2]=l[2]);const w=function(e,t,i){v[e]=t,b[e]=i};let _=0;const x=nde(),S=nde();for(let M=0;M<i;M++){const e=M*(2*Math.PI/i);Um(x,u,Math.sin(e)),Um(S,p,Math.cos(e)),jm(x,x,S),g[3*M+0]=x[0],g[3*M+1]=x[1],g[3*M+2]=x[2],Um(x,x,t),jm(x,x,c),y[3*M+0]=x[0],y[3*M+1]=x[1],y[3*M+2]=x[2],m[2*M+0]=M/i,m[2*M+1]=0,y[3*(M+i)+0]=y[3*M+0]+h[0],y[3*(M+i)+1]=y[3*M+1]+h[1],y[3*(M+i)+2]=y[3*M+2]+h[2],m[2*(M+i)+0]=M/i,m[2*M+1]=1;const r=(M+1)%i;w(_++,M,M),w(_++,M+i,M),w(_++,r,r),w(_++,r,r),w(_++,M+i,M),w(_++,r+i,r)}if(n){for(let e=0;e<i;e++){const t=(e+1)%i;w(_++,d-2,f-2),w(_++,e,f-2),w(_++,t,f-2)}for(let e=0;e<i;e++){const t=(e+1)%i;w(_++,e+i,f-1),w(_++,d-1,f-1),w(_++,t+i,f-1)}}return new Fde([["position",{size:3,data:y,exclusive:!0}],["normal",{size:3,data:g,exclusive:!0}],["uv0",{size:2,data:m,exclusive:!0}]],[["position",v],["normal",b],["uv0",v]])},e.createTubeGeometry=function(t,i,r,s,n){r=r||10,s=null==s||s,uue(t.length>1);const o=[],a=[];for(let e=0;e<r;e++){o.push([0,-e-1,-(e+1)%r-1]);const t=e/r*2*Math.PI;a.push([Math.cos(t)*i,Math.sin(t)*i])}return e.createPathExtrusionGeometry(a,t,[[0,0,0]],o,s,n)},e.createPathExtrusionGeometry=function(e,t,i,s,n,o=ade(0,0,0)){const a=e.length,l=new Float32Array(t.length*a*3+(6*i.length||0)),h=new Float32Array(t.length*a*3+(i?6:0)),c=(t.length-1)*a*6+3*s.length*2,u=new Uint32Array(c),p=new Uint32Array(c);let d=0,f=0,y=0,g=0;const m=nde(),v=nde(),b=nde(),w=nde(),_=nde(),x=nde(),S=nde(),M=[0,0,0],T=nde(),I=nde(),E=nde(),A=nde(),P=nde(),C=Ene();Fm(T,0,1,0),Nm(v,t[1],t[0]),$m(v,v),n?(jm(M,t[0],o),$m(b,M)):Fm(b,0,0,1),r(v,b,T,T,_,b,Bde),Dm(w,b),Dm(A,_);for(let r=0;r<i.length;r++)Um(x,_,i[r][0]),Um(M,b,i[r][2]),jm(x,x,M),jm(x,x,t[0]),l[d++]=x[0],l[d++]=x[1],l[d++]=x[2];h[f++]=-v[0],h[f++]=-v[1],h[f++]=-v[2];for(let r=0;r<s.length;r++)u[y++]=s[r][0]>0?s[r][0]:-s[r][0]-1+i.length,u[y++]=s[r][1]>0?s[r][1]:-s[r][1]-1+i.length,u[y++]=s[r][2]>0?s[r][2]:-s[r][2]-1+i.length,p[g++]=0,p[g++]=0,p[g++]=0;let O=i.length;const k=i.length-1;for(let F=0;F<t.length;F++){let i=!1;F>0&&(Dm(m,v),F<t.length-1?(Nm(v,t[F+1],t[F]),$m(v,v)):i=!0,jm(I,m,v),$m(I,I),jm(E,t[F-1],w),One(t[F],I,C),Bne(C,Qse(E,m),M)?(Nm(M,M,t[F]),$m(b,M),Xm(_,I,b),$m(_,_)):r(I,w,A,T,_,b,Bde),Dm(w,b),Dm(A,_)),n&&(jm(M,t[F],o),$m(P,M));for(let r=0;r<a;r++)if(Um(x,_,e[r][0]),Um(M,b,e[r][1]),jm(x,x,M),$m(S,x),h[f++]=S[0],h[f++]=S[1],h[f++]=S[2],jm(x,x,t[F]),l[d++]=x[0],l[d++]=x[1],l[d++]=x[2],!i){const e=(r+1)%a;u[y++]=O+r,u[y++]=O+a+r,u[y++]=O+e,u[y++]=O+e,u[y++]=O+a+r,u[y++]=O+a+e;for(let t=0;t<6;t++)p[g++]=u[y-6+t]-k}O+=a}const L=t[t.length-1];for(let r=0;r<i.length;r++)Um(x,_,i[r][0]),Um(M,b,i[r][1]),jm(x,x,M),jm(x,x,L),l[d++]=x[0],l[d++]=x[1],l[d++]=x[2];const R=f/3;h[f++]=v[0],h[f++]=v[1],h[f++]=v[2];const D=O-a;for(let r=0;r<s.length;r++)u[y++]=s[r][0]>=0?O+s[r][0]:-s[r][0]-1+D,u[y++]=s[r][2]>=0?O+s[r][2]:-s[r][2]-1+D,u[y++]=s[r][1]>=0?O+s[r][1]:-s[r][1]-1+D,p[g++]=R,p[g++]=R,p[g++]=R;return new Fde([["position",{size:3,data:l,exclusive:!0}],["normal",{size:3,data:h,exclusive:!0}]],[["position",u],["normal",p]])},e.createPolylineGeometry=function(e,t,i){uue(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),uue(3===e[0].length,"createPolylineGeometry(): malformed vertex"),uue(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),uue(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");const r=new Float64Array(3*e.length),s=new Uint32Array(2*(e.length-1));let n=0,o=0;for(let h=0;h<e.length;h++){for(let t=0;t<3;t++)r[n++]=e[h][t];h>0&&(s[o++]=h-1,s[o++]=h)}const a=[],l=[];if(a.push(["position",s]),l.push(["position",{size:3,data:r,exclusive:!0}]),t){const i=new Float32Array(3*t.length);let r=0;for(let s=0;s<e.length;s++)for(let e=0;e<3;e++)i[r++]=t[s][e];a.push(["normal",s]),l.push(["normal",{size:3,data:i,exclusive:!0}])}return i&&(l.push(["color",{size:4,data:i}]),a.push(["color",Ede(i.length/4)])),new Fde(l,a,2)},e.createExtrudedTriangle=function(e,t,i,r,s=0){const n=new Array(18),o=[[-t,s,r/2],[i,s,r/2],[0,e+s,r/2],[-t,s,-r/2],[i,s,-r/2],[0,e+s,-r/2]],a=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let l=0;l<6;l++)n[3*l]=o[l][0],n[3*l+1]=o[l][1],n[3*l+2]=o[l][2];return new Fde([["position",{size:3,data:n,exclusive:!0}]],[["position",a]])},e.transformInPlace=function(e,t){const i=e.getMutableAttribute("position").data;for(let r=0;r<i.length;r+=3){const e=i[r],s=i[r+1],n=i[r+2];Fm(qde,e,s,n),Ym(qde,qde,t),i[r]=qde[0],i[r+1]=qde[1],i[r+2]=qde[2]}},e.cgToGIS=function(e,t=e){const i=e.vertexAttributes,r=i.get("position").data,s=i.get("normal").data;if(s){const e=t.getMutableAttribute("normal").data;for(let t=0;t<s.length;t+=3){const i=s[t+1];e[t+1]=-s[t+2],e[t+2]=i}}if(r){const e=t.getMutableAttribute("position").data;for(let t=0;t<r.length;t+=3){const i=r[t+1];e[t+1]=-r[t+2],e[t+2]=i}}return t},e.makeOrthoBasisDirUp=i,e.makeOrthoBasisDirUpFallback=r}(Gde||(Gde={}));const Bde=.99619469809,qde=nde();var Hde=Gde;const Wde=e=>class extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){for(const t of null!=(e=this._managedDisposables)?e:[]){var e;const i=this[t];this[t]=null,i&&"function"==typeof i.dispose&&i.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};class $de extends(Wde(class{})){}function Jde(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(i=null==(r=e._managedDisposables)?void 0:r.slice())?i:[]),e._managedDisposables.unshift(t)}}class Xde extends $de{constructor(e){super(),this._material=e.material,this._techniqueRep=e.techniqueRep,this._output=e.output}get technique(){return this._technique}getPipelineState(e,t){return this.technique.pipeline}ensureResources(e){return 2}ensureParameters(e){}}class Kde extends Tpe{constructor(e,t){super(),this.type=3,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=nue,this._params=rpe(e,t),this.validateParameterValues(this._params)}dispose(){}get params(){return this._params}update(e){return!1}setParameterValues(e){spe(this._params,e)&&(this.validateParameterValues(this._params),this.parametersChanged())}validateParameterValues(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}isVisibleInPass(e){return!0}get renderOccluded(){return this.params.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){m(this.materialRepository)&&this.materialRepository.materialChanged(this)}}function Yde(e,t){return e.isVisible()&&e.isVisibleInPass(t.pass)&&0!=(e.renderOccluded&t.renderOccludedMask)}const Zde={renderOccluded:1};var Qde;(Qde||(Qde={})).Default={vvSizeEnabled:!1,vvSizeMinSize:ade(1,1,1),vvSizeMaxSize:ade(100,100,100),vvSizeOffset:ade(0,0,0),vvSizeFactor:ade(1,1,1),vvSizeValue:ade(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:[1,0,0,0,1,0,0,0,1]};var efe=Qde;function tfe(e,t){if(t.slicePlaneEnabled){e.extensions.add("GL_OES_standard_derivatives"),t.sliceEnabledForVertexPrograms&&(e.vertex.uniforms.add("slicePlaneOrigin","vec3"),e.vertex.uniforms.add("slicePlaneBasis1","vec3"),e.vertex.uniforms.add("slicePlaneBasis2","vec3")),e.fragment.uniforms.add("slicePlaneOrigin","vec3"),e.fragment.uniforms.add("slicePlaneBasis1","vec3"),e.fragment.uniforms.add("slicePlaneBasis2","vec3");const i=_ce`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,r=_ce`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
if (sliceByFactors(factors)) {
return color;
}
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=t.sliceHighlightDisabled?_ce`#define highlightSlice(_color_, _pos_) (_color_)`:_ce`
        ${r}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i),e.fragment.code.add(s)}else{const i=_ce`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;t.sliceEnabledForVertexPrograms&&e.vertex.code.add(i),e.fragment.code.add(i)}}function ife(e,t,i){rfe(e,t,i.slicePlane,i.origin)}function rfe(e,t,i,r){t.slicePlaneEnabled&&(m(i)?(r?(Nm(sfe,i.origin,r),e.setUniform3fv("slicePlaneOrigin",sfe)):e.setUniform3fv("slicePlaneOrigin",i.origin),e.setUniform3fv("slicePlaneBasis1",i.basis1),e.setUniform3fv("slicePlaneBasis2",i.basis2)):(e.setUniform3fv("slicePlaneBasis1",Sm),e.setUniform3fv("slicePlaneBasis2",Sm),e.setUniform3fv("slicePlaneOrigin",Sm)))}const sfe=[0,0,0],nfe=ese(1,1,0,1),ofe=ese(1,0,1,1);function afe(e){e.fragment.uniforms.add("depthTex","sampler2D"),e.fragment.uniforms.add("highlightViewportPixelSz","vec4"),e.fragment.constants.add("occludedHighlightFlag","vec4",nfe).add("unoccludedHighlightFlag","vec4",ofe),e.fragment.code.add(_ce`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}function lfe(e,t){e.bindTexture(t.highlightDepthTexture,"depthTex"),e.setUniform4f("highlightViewportPixelSz",0,0,t.inverseViewport[0],t.inverseViewport[1])}function hfe(e,t){e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.code.add(_ce`
    // Compare the linearized depths of fragment and terrain. Discard fragments on the wrong side of the terrain.
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){

      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, cameraNearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `)}function cfe(e,t){t.multipassTerrainEnabled&&t.terrainLinearDepthTexture&&e.bindTexture(t.terrainLinearDepthTexture,"terrainDepthTexture")}function ufe(e,t){t.vvInstancingEnabled&&(t.vvSize||t.vvColor)&&e.attributes.add("instanceFeatureAttribute","vec4"),t.vvSize?(e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),e.vertex.uniforms.add("vvSymbolAnchor","vec3"),e.vertex.code.add(_ce`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),e.vertex.code.add(_ce`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.vvInstancingEnabled?_ce`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):e.vertex.code.add(_ce`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(_ce`
      uniform float vvColorValues[vvColorNumber];
      uniform vec4 vvColorColors[vvColorNumber];

      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.vvInstancingEnabled?_ce`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):e.vertex.code.add(_ce`vec4 vvColor() { return vec4(1.0); }`)}function pfe(e,t){t.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",t.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",t.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",t.vvSizeOffset),e.setUniform3fv("vvSizeFactor",t.vvSizeFactor)),t.vvColorEnabled&&(e.setUniform1fv("vvColorValues",t.vvColorValues),e.setUniform4fv("vvColorColors",t.vvColorColors))}function dfe(e,t){pfe(e,t),t.vvSizeEnabled&&(e.setUniform3fv("vvSymbolAnchor",t.vvSymbolAnchor),e.setUniformMatrix3fv("vvSymbolRotationMatrix",t.vvSymbolRotationMatrix))}function ffe(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}const yfe=ffe();function gfe(e,t,i){e.setUniform3f("camPos",i[3]-t[0],i[7]-t[1],i[11]-t[2])}function mfe(e,t){e.setUniformMatrix4fv("proj",t)}function vfe(e,t){e.setUniform2fv("nearFar",t)}function bfe(e,t,i){hY(xfe,i,t),e.setUniform3fv("localOrigin",t),e.setUniformMatrix4fv("view",xfe)}function wfe(e,t){bfe(e,t.origin,t.camera.viewMatrix)}function _fe(e,t){e.setUniform4fv("viewport",t.camera.fullViewport)}Object.freeze({__proto__:null,create:ffe,clone:function(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(e,t,i,r,s,n,o,a,l,h,c,u,p,d,f,y){const g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=s,g[5]=n,g[6]=o,g[7]=a,g[8]=l,g[9]=h,g[10]=c,g[11]=u,g[12]=p,g[13]=d,g[14]=f,g[15]=y,g},createView:function(e,t){return new Float32Array(e,t,16)},IDENTITY:yfe});const xfe=ffe(),Sfe=rhe(770,1,771,771),Mfe=ihe(1,1),Tfe=ihe(0,771);function Ife(e){return 2===e?null:1===e?Tfe:Mfe}function Efe(e){return 2===e?ahe:null}const Afe=5e5,Pfe={factor:-1,units:-2};function Cfe(e){return e?Pfe:null}function Ofe(e){return 3===e||2===e?513:515}const kfe={func:513},Lfe={func:519},Rfe={mask:255},Dfe={mask:0},Ffe={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},jfe={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},Nfe={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},zfe={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};function Vfe(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add(_ce`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add("size","float"),e.vertex.code.add(_ce`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add(_ce`uniform float vvOpacityValues[vvOpacityNumber];
uniform float vvOpacityOpacities[vvOpacityNumber];
float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.vertex.code.add(_ce`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add(_ce`uniform float vvColorValues[vvColorNumber];
uniform vec4 vvColorColors[vvColorNumber];
vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add("color","vec4"),e.vertex.code.add(_ce`vec4 getColor(){
return applyOpacity(color);
}`))}function Ufe(e,t){e.fragment.include(xce),3===t.output?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(_ce`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):1===t.output&&e.fragment.code.add(_ce`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function Gfe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){e.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleUVMaxEnabled&&e.varyings.add("stipplePatternUvMax","float"),e.varyings.add("stipplePatternUv","float"),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add(_ce`
  float getStippleAlpha() {
    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
    ${t.stippleUVMaxEnabled?"stipplePatternUvClamped = clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}

    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;
  }`),t.stippleOffColorEnabled?e.fragment.code.add(_ce`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`):e.fragment.code.add(_ce`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(e,t):function(e){e.fragment.code.add(_ce`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(e)}function Bfe(e){e.vertex.code.add(_ce`const float PI = 3.141592653589793;`),e.fragment.code.add(_ce`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}const qfe=.1,Hfe=.001;function Wfe(e,t){const i=e.fragment;switch(t.alphaDiscardMode){case 0:i.code.add(_ce`
        #define discardOrAdjustAlpha(color) { if (color.a < ${_ce.float(Hfe)}) { discard; } }
      `);break;case 1:i.code.add(_ce`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case 2:i.uniforms.add("textureAlphaCutoff","float"),i.code.add(_ce`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case 3:e.fragment.uniforms.add("textureAlphaCutoff","float"),e.fragment.code.add(_ce`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function $fe(e){e.code.add(_ce`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function Jfe(e){const t=new Ace;t.extensions.add("GL_OES_standard_derivatives"),t.include(Bfe),t.include(Vfe,e),t.include(Gfe,e),1===e.output&&t.include(Ufe,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float");const i=e.falloffEnabled,r=e.innerColorEnabled;return r&&t.varyings.add("vLineDistance","float"),i&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),t.vertex.code.add(_ce`#define PERPENDICULAR(v) vec2(v.y, -v.x);
#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),t.vertex.code.add(_ce`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= screenSize / posNdc.w;
return posNdc;
}`),t.vertex.code.add(_ce`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = cameraNearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -cameraNearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -cameraNearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -cameraNearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -cameraNearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -cameraNearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${e.multipassTerrainEnabled?"depth = pos.z;":""}
      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`),t.vertex.code.add(_ce`void main(void) {
float coverage = 1.0;
vpos = position;
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;
bool isJoin = abs(uv0.y)-3.0 < 0.0;
float lineWidth = getSize() * pixelRatio;
if (lineWidth < 1.0) {
coverage = lineWidth;
lineWidth = 1.0;
}else{
lineWidth = floor(lineWidth + 0.5);
}
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
vec4 next = view * vec4(auxpos2.xyz, 1.0);
clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),e.stippleEnabled&&t.vertex.code.add(_ce`vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);
vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;
vec2 stippleSegmentDirection = stippleSegmentInfo.zw;`),t.vertex.code.add(_ce`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = ISOUTSIDE;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?t.vertex.code.add(_ce`vec2 startDir;
vec2 endDir;
if (leftLen < 0.001) {
startDir = right;
}
else{
startDir = left;
}
startDir = normalize(startDir);
startDir = PERPENDICULAR(startDir);
if (rightLen < 0.001) {
endDir = left;
}
else{
endDir = right;
}
endDir = normalize(endDir);
endDir = PERPENDICULAR(endDir);
float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);`):t.vertex.code.add(_ce`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),t.vertex.code.add(_ce`displacementLen = lineWidth;
}
} else {
if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = isStartVertex ? right : left;
}
joinDisplacementDir = normalize(joinDisplacementDir);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
displacementLen = lineWidth;
capDisplacementDir = isStartVertex ? -right : left;`),e.roundCaps?t.vertex.code.add(_ce`float angle = subdivisionFactor*PI*0.5;
joinDisplacementDir *= cos(angle);
capDisplacementDir *= sin(angle);`):t.vertex.code.add(_ce`capDisplacementDir *= subdivisionFactor;`),t.vertex.code.add(_ce`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

  ${i||r?_ce`float lineDist = lineWidth * sign(uv0.y) * pos.w;`:""}

  ${r?_ce`vLineDistance = lineDist;`:""}
  ${i?_ce`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `),e.stippleEnabled&&(t.vertex.code.add(_ce`{
vec2 posVec = pos.xy - stippleSegmentOrigin;
float stippleSegmentDirectionLength = length(stippleSegmentDirection);`),e.stippleIntegerRepeatsEnabled&&t.vertex.code.add(_ce`float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
stipplePatternUvMax = roundedNumberOfPatternRepeats;`),t.vertex.code.add(_ce`
      if (stippleSegmentDirectionLength >= 0.001) {
        // Project the vertex position onto the line segment.
        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;
     ${e.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale = roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale = 1.0;"}
        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `)),t.vertex.code.add(_ce`pos.xy = pos.xy / screenSize * pos.w;
vColor = getColor();
vColor.a *= coverage;
gl_Position = pos;
}
}`),e.multipassTerrainEnabled&&(t.fragment.include(Sce),t.include(hfe,e)),t.include(tfe,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include($fe),t.fragment.code.add(_ce`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 color = intrinsicColor * vColor;
  `),e.innerColorEnabled&&(t.fragment.uniforms.add("pixelRatio","float"),t.fragment.code.add(_ce`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),t.fragment.code.add(_ce`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&t.fragment.code.add(_ce`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`),t.fragment.code.add(_ce`
    if (finalColor.a < ${_ce.float(Hfe)}) {
      discard;
    }

    ${7===e.output?_ce`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===e.output?_ce`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${4===e.output?_ce`gl_FragColor = vec4(1.0);`:""}
    ${1===e.output?_ce`outputDepth(linearDepth);`:""}
  }
  `),t}var Xfe=Object.freeze({__proto__:null,build:Jfe});const Kfe=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]);class Yfe extends Kle{constructor(e,t,i){super(e,t,i),this.stippleTextureRepository=e.stippleTextureRepository}initializeProgram(e){const t=Yfe.shader.get(),i=this.configuration,r=t.build({OITEnabled:0===i.transparencyPassType,output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,stippleEnabled:i.stippleEnabled,stippleOffColorEnabled:i.stippleOffColorEnabled,stippleUVMaxEnabled:i.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:i.stippleIntegerRepeatsEnabled,roundCaps:i.roundCaps,roundJoins:i.roundJoins,vvColor:i.vvColor,vvSize:i.vvSize,vvInstancingEnabled:!0,vvOpacity:i.vvOpacity,falloffEnabled:i.falloffEnabled,innerColorEnabled:i.innerColorEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new wce(e.rctx,r,Kfe)}dispose(){super.dispose(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(e,t){if(mfe(this.program,t.camera.projectionMatrix),4===this.configuration.output&&lfe(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),cfe(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),function(e,t){pfe(e,t),t.vvOpacityEnabled&&(e.setUniform1fv("vvOpacityValues",t.vvOpacityValues),e.setUniform1fv("vvOpacityOpacities",t.vvOpacityOpacities))}(this.program,e),this.stipplePattern!==e.stipplePattern){const t=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,t),this.stipplePattern=t}if(this.configuration.stippleEnabled){const i=m(this.stippleTextureBind)?this.stippleTextureBind(this.program)*t.camera.pixelRatio:1;if(this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.configuration.stippleOffColorEnabled){const t=e.stippleOffColor;this.program.setUniform4f("stippleOffColor",t[0],t[1],t[2],t.length>3?t[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",S(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}bindDraw(e){wfe(this.program,e),ife(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const i=this.configuration,r=3===e,s=2===e;return mhe({blending:0===i.output||7===i.output?r?Sfe:Ife(e):null,depthTest:{func:Ofe(e)},depthWrite:r?!i.transparent&&i.writeDepth&&ahe:Efe(e),colorWrite:lhe,stencilWrite:i.sceneHasOcludees?Rfe:null,stencilTest:i.sceneHasOcludees?t?jfe:Ffe:null,polygonOffset:r||s?i.polygonOffset&&Zfe:Pfe})}initializePipeline(){const e=this.configuration,t=e.polygonOffset&&Zfe;return e.occluder&&(this._occluderPipelineTransparent=mhe({blending:Sfe,polygonOffset:t,depthTest:Lfe,depthWrite:null,colorWrite:lhe,stencilWrite:null,stencilTest:zfe}),this._occluderPipelineOpaque=mhe({blending:Sfe,polygonOffset:t,depthTest:Lfe,depthWrite:null,colorWrite:lhe,stencilWrite:Dfe,stencilTest:Nfe}),this._occluderPipelineMaskWrite=mhe({blending:null,polygonOffset:t,depthTest:kfe,depthWrite:null,colorWrite:null,stencilWrite:Rfe,stencilTest:jfe})),this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return 5}getPipelineState(e,t){return t?this._occludeePipelineState:this.configuration.occluder?11===e?this._occluderPipelineTransparent:10===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline}}Yfe.shader=new Xle(Xfe,(()=>import("./RibbonLine.glsl.1b4fa097.js")));const Zfe={factor:0,units:-4};class Qfe extends Yle{constructor(){super(...arguments),this.output=0,this.occluder=!1,this.slicePlaneEnabled=!1,this.transparent=!1,this.polygonOffset=!1,this.writeDepth=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleIntegerRepeatsEnabled=!1,this.roundCaps=!1,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Q([Zle({count:8})],Qfe.prototype,"output",void 0),Q([Zle()],Qfe.prototype,"occluder",void 0),Q([Zle()],Qfe.prototype,"slicePlaneEnabled",void 0),Q([Zle()],Qfe.prototype,"transparent",void 0),Q([Zle()],Qfe.prototype,"polygonOffset",void 0),Q([Zle()],Qfe.prototype,"writeDepth",void 0),Q([Zle()],Qfe.prototype,"stippleEnabled",void 0),Q([Zle()],Qfe.prototype,"stippleOffColorEnabled",void 0),Q([Zle()],Qfe.prototype,"stippleIntegerRepeatsEnabled",void 0),Q([Zle()],Qfe.prototype,"roundCaps",void 0),Q([Zle()],Qfe.prototype,"roundJoins",void 0),Q([Zle()],Qfe.prototype,"vvSize",void 0),Q([Zle()],Qfe.prototype,"vvColor",void 0),Q([Zle()],Qfe.prototype,"vvOpacity",void 0),Q([Zle()],Qfe.prototype,"falloffEnabled",void 0),Q([Zle()],Qfe.prototype,"innerColorEnabled",void 0),Q([Zle()],Qfe.prototype,"sceneHasOcludees",void 0),Q([Zle({count:4})],Qfe.prototype,"transparencyPassType",void 0),Q([Zle()],Qfe.prototype,"multipassTerrainEnabled",void 0),Q([Zle()],Qfe.prototype,"cullAboveGround",void 0);const eye=Ne.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");class tye extends Kde{constructor(e){super(e,rye),this._vertexAttributeLocations=Kfe,this.techniqueConfig=new Qfe,this.layout=this.createLayout()}isClosed(e,t){return aye(this.params,e,t)}dispose(){}getPassParameters(){return this.params}getTechniqueConfig(e,t){this.techniqueConfig.output=e;const i=m(this.params.stipplePattern);return this.techniqueConfig.stippleEnabled=i,this.techniqueConfig.stippleIntegerRepeatsEnabled=i&&this.params.stippleIntegerRepeats,this.techniqueConfig.stippleOffColorEnabled=i&&m(this.params.stippleOffColor),this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.params.join,this.techniqueConfig.roundCaps="round"===this.params.cap,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled,this.techniqueConfig.vvSize=this.params.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.params.innerWidth>0&&m(this.params.innerColor),this.techniqueConfig.falloffEnabled=this.params.falloff>0,this.techniqueConfig.occluder=8===this.params.renderOccluded,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,s,n,o,a,l){l?this.intersectDrapedLineGeometry(e,r,n,o):this.intersectLineGeometry(e,t,i,r,this.params.width,o)}intersectDrapedLineGeometry(e,t,i,r){if(!t.options.selectionMode)return;const s=e.vertexAttributes.get("position").data,n=e.vertexAttributes.get("size");let o=this.params.width;if(this.params.vvSizeEnabled){const t=e.vertexAttributes.get("sizeFeatureAttribute").data[0];o*=mv(this.params.vvSizeOffset[0]+t*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else n&&(o*=n.data[0]);const a=i[0],l=i[1],h=(o/2+4)*e.screenToWorldRatio;let c=Number.MAX_VALUE;for(let u=0;u<s.length-5;u+=3){const e=s[u],t=s[u+1],i=a-e,r=l-t,n=s[u+3]-e,o=s[u+4]-t,h=mv((n*i+o*r)/(n*n+o*o),0,1),p=n*h-i,d=o*h-r,f=p*p+d*d;f<c&&(c=f)}c<h*h&&r()}intersectLineGeometry(e,t,i,r,s,n){if(!r.options.selectionMode||jue(t))return;if(!fue(i))return void eye.error("intersection assumes a translation-only matrix");const o=e.vertexAttributes,a=o.get("position").data;let l=s;if(this.params.vvSizeEnabled){const e=o.get("sizeFeatureAttribute").data[0];l*=mv(this.params.vvSizeOffset[0]+e*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])}else o.has("size")&&(l*=o.get("size").data[0]);const h=r.camera,c=fye;EX(c,r.point);const u=l*h.pixelRatio/2+4*h.pixelRatio;Fm(Mye[0],c[0]-u,c[1]+u,0),Fm(Mye[1],c[0]+u,c[1]+u,0),Fm(Mye[2],c[0]+u,c[1]-u,0),Fm(Mye[3],c[0]-u,c[1]-u,0);for(let g=0;g<4;g++)if(!h.unprojectFromRenderScreen(Mye[g],Tye[g]))return;kne(h.eye,Tye[0],Tye[1],Iye),kne(h.eye,Tye[1],Tye[2],Eye),kne(h.eye,Tye[2],Tye[3],Aye),kne(h.eye,Tye[3],Tye[0],Pye);let p=Number.MAX_VALUE;const d=oye(this.params,o,e.indices)?a.length-2:a.length-5;for(let g=0;g<d;g+=3){cye[0]=a[g]+i[12],cye[1]=a[g+1]+i[13],cye[2]=a[g+2]+i[14];const e=(g+3)%a.length;if(uye[0]=a[e]+i[12],uye[1]=a[e+1]+i[13],uye[2]=a[e+2]+i[14],Kne(Iye,cye)<0&&Kne(Iye,uye)<0||Kne(Eye,cye)<0&&Kne(Eye,uye)<0||Kne(Aye,cye)<0&&Kne(Aye,uye)<0||Kne(Pye,cye)<0&&Kne(Pye,uye)<0)continue;if(h.projectToRenderScreen(cye,yye),h.projectToRenderScreen(uye,gye),yye[2]<0&&gye[2]>0){Nm(pye,cye,uye);const e=h.frustum,t=-Kne(e[4],cye)/Jm(pye,e[4]);Um(pye,pye,t),jm(cye,cye,pye),h.projectToRenderScreen(cye,yye)}else if(yye[2]>0&&gye[2]<0){Nm(pye,uye,cye);const e=h.frustum,t=-Kne(e[4],uye)/Jm(pye,e[4]);Um(pye,pye,t),jm(uye,uye,pye),h.projectToRenderScreen(uye,gye)}else if(yye[2]<0&&gye[2]<0)continue;yye[2]=0,gye[2]=0;const t=Bae(Gae(yye,gye,bye),c);t<p&&(p=t,Dm(mye,cye),Dm(vye,uye))}const f=r.rayBeginPoint,y=r.rayEndPoint;if(p<u*u){let e=Number.MAX_VALUE;if($ae(Gae(mye,vye,bye),Gae(f,y,wye),dye)){Nm(dye,dye,f);const t=Rm(dye);Um(dye,dye,1/t),e=t/Bm(f,y)}n(e,dye)}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return null;const r=e.indices;return Ode(i.get("position"),r?r.get("position"):null,r&&oye(this.params,i,r),t)}createLayout(){const e=Jle().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.params.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.params.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.params.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}createBufferWriter(){return new sye(this.layout,this.params)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new iye(e):void 0}validateParameterValues(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}requiresTransparent(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}colorRequiresTransparent(e){return m(e)&&e[3]<1&&e[3]>0}}class iye extends Xde{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(Yfe,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return this._technique.configuration.occluder?3===e||10===e||11===e:0===this._output||7===this._output?(this.targetSlot=this._technique.configuration.writeDepth?5:8,e===this.targetSlot):3===e}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(e,t)}}const rye=a(a({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},Zde),efe.Default);class sye{constructor(e,t){switch(this.params=t,this.numJoinSubdivisions=0,this.vertexBufferLayout=e,this.params.join){case"miter":case"bevel":this.numJoinSubdivisions=t.stipplePattern?1:0;break;case"round":this.numJoinSubdivisions=hye}}isClosed(e){return oye(this.params,e.vertexAttributes,e.indices)}numCapSubdivisions(e){if(this.isClosed(e))return 0;switch(this.params.cap){case"butt":return 0;case"square":return 1;case"round":return lye}}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=2*this.numCapSubdivisions(e)+2,i=e.indices.get("position").length/2+1,r=this.isClosed(e);let s=r?2:2*t;const n=r?0:1,o=r?i:i-1;if(e.vertexAttributes.has("subdivisions")){const t=e.vertexAttributes.get("subdivisions").data;for(let e=n;e<o;++e)s+=4+2*t[e]}else s+=(o-n)*(2*this.numJoinSubdivisions+4);return s+=2,s}write(e,t,i,r){const s=_ye,n=xye,o=Sye,a=t.vertexAttributes.get("position").data,l=t.indices&&t.indices.get("position"),h=this.numCapSubdivisions(t);l&&l.length!==2*(a.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let c=null;t.vertexAttributes.has("subdivisions")&&(c=t.vertexAttributes.get("subdivisions").data);let u=1,p=0;this.params.vvSizeEnabled?p=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(u=t.vertexAttributes.get("size").data[0]);let d=[1,1,1,1],f=0;this.params.vvColorEnabled?f=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(d=t.vertexAttributes.get("color").data);let y=0;this.params.vvOpacityEnabled&&(y=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);const g=a.length/3,m=e.transformation,v=new Float32Array(i.buffer),b=this.vertexBufferLayout.stride/4;let w=r*b;const _=w,x=(e,t,i,r,s,n,o)=>{if(v[w++]=t[0],v[w++]=t[1],v[w++]=t[2],v[w++]=r,v[w++]=s,v[w++]=n,v[w++]=e[0],v[w++]=e[1],v[w++]=e[2],v[w++]=i[0],v[w++]=i[1],v[w++]=i[2],this.params.vvSizeEnabled?v[w++]=p:v[w++]=u,this.params.vvColorEnabled)v[w++]=f;else{const e=Math.min(4*o,d.length-4);v[w++]=d[e+0],v[w++]=d[e+1],v[w++]=d[e+2],v[w++]=d[e+3]}this.params.vvOpacityEnabled&&(v[w++]=y)};w+=b,Fm(n,a[0],a[1],a[2]),m&&Ym(n,n,m);const S=this.isClosed(t);if(S){const e=a.length-3;Fm(s,a[e],a[e+1],a[e+2]),m&&Ym(s,s,m)}else{Dm(s,n),Fm(o,a[3],a[4],a[5]),m&&Ym(o,o,m);for(let e=0;e<h;++e){const t=1-e/h;x(s,n,o,t,1,-4,0),x(s,n,o,t,1,4,0)}x(s,n,o,0,0,-4,0),x(s,n,o,0,0,4,0),Dm(s,n),Dm(n,o)}const M=S?g:g-1;for(let T=S?0:1;T<M;T++){const e=(T+1)%g*3;Fm(o,a[e+0],a[e+1],a[e+2]),m&&Ym(o,o,m),x(s,n,o,0,1,-1,T),x(s,n,o,0,1,1,T);const t=c?c[T]:this.numJoinSubdivisions;for(let i=0;i<t;++i){const e=(i+1)/(t+1);x(s,n,o,e,1,-2,T),x(s,n,o,e,1,2,T)}x(s,n,o,1,0,-2,T),x(s,n,o,1,0,2,T),Dm(s,n),Dm(n,o)}if(S)w=nye(v,_+b,v,w,2*b);else{x(s,n,o,0,1,-5,M),x(s,n,o,0,1,5,M);for(let e=0;e<h;++e){const t=(e+1)/h;x(s,n,o,t,1,-5,M),x(s,n,o,t,1,5,M)}}nye(v,_+b,v,_,b),w=nye(v,w-b,v,w,b)}}function nye(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function oye(e,t,i){return aye(e,t.get("position").data,i?i.get("position"):null)}function aye(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const lye=3,hye=1,cye=[0,0,0],uye=[0,0,0],pye=[0,0,0],dye=[0,0,0],fye=[0,0,0],yye=NS(),gye=NS(),mye=[0,0,0],vye=[0,0,0],bye=zae(),wye=zae(),_ye=[0,0,0],xye=[0,0,0],Sye=[0,0,0],Mye=[NS(),NS(),NS(),NS()],Tye=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Iye=Ene(),Eye=Ene(),Aye=Ene(),Pye=Ene();class Cye extends sde{constructor(e){super(e),this._ray=Zse(),this._externalResources=null,this._handles=new Mh,this._isWorldDown=!1,this._start=[0,0,0],this._end=ym(1,0,0),this._width=1,this._color=fae(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=fae(1,1,1,1),this._stippleIntegerRepeats=!0,this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=Fye,this.applyProps(e)}createExternalResources(){const e=new tye(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()})));const t=new Spe({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){m(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){m(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[[0,0,0],[0,0,0]],i=3===this.extensionType;i&&t.push([0,0,0],[0,0,0]);const r=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,s=Hde.createPolylineGeometry(t,null,r);e.addGeometry(s,this._externalResources.material),this.updateVertices(s)}updateVisibility(e){super.updateVisibility(e),m(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,Dm(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),Nm(this._end,e,this._end),tne(this._start,this._end,this._ray),this.updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,rv(this._start,e)||(Dm(this._start,e),tne(this._start,this._end,this._ray),this.updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,rv(this._end,e)||(Dm(this._end,e),tne(this._start,this._end,this._ray),this.updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get color(){return this._color}set color(e){Bre(e,this._color)||(Are(this._color,e),this.updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this.updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this.updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this.updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Bre(e,this._innerColor)||(Are(this._innerColor,e),this.updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){e!==this._stippleIntegerRepeats&&(this._stippleIntegerRepeats=e,this.updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=m(e)!==m(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this.updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(v(e)||v(this._stippleOffColor)||!Bre(e,this._stippleOffColor))&&(this._stippleOffColor=m(e)?dae(e):null,this.updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this.updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&m(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,m(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,m(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,m(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=S(e,Fye),this.recreateGeometry()}updateMaterial(){v(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stippleIntegerRepeats:this._stippleIntegerRepeats,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}updateGeometry(){m(this.object)&&this.updateVertices(this.object.geometries[0])}updateVertices(e){const t=3===this._extensionType?this.updateLineSegmentFinite(Rye):this.updateLineSegmentInfinite(this._extensionType,Rye);this.updateVertexAttributes(e,t),m(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}updateLineSegmentFinite(e){return Gae(this._start,this._end,e)}updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch(Aae(this._ray,Oye),e){case 0:Oye.c0=-Number.MAX_VALUE;break;case 1:case 2:{const e=this._ray.origin,t=S(this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&Wm(Oye.ray.direction,Oye.ray.direction),2===this._extensionType&&null!=t&&(Oye.c1=Math.abs(i-t));break}}if(!Fae(i.frustum,Oye))return Gae(this._start,this._end,t);return Gae(Pae(Oye,kye),Cae(Oye,Lye),t)}updateVertexAttributes(e,t){const i=e.getMutableAttribute("position").data;if(3===this.extensionType){const e=qae(t,-this.fadedExtensions.start,kye);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=qae(t,0,kye);i[3]=r[0],i[4]=r[1],i[5]=r[2];const s=qae(t,1,kye);i[6]=s[0],i[7]=s[1],i[8]=s[2];const n=qae(t,1+this.fadedExtensions.end,kye);i[9]=n[0],i[10]=n[1],i[11]=n[2]}else{const e=qae(t,0,kye);i[0]=e[0],i[1]=e[1],i[2]=e[2];const r=qae(t,1,kye);i[3]=r[0],i[4]=r[1],i[5]=r[2]}m(this.object)&&this.object.geometryVertexAttrsUpdated(0)}}const Oye=Eae(),kye=[0,0,0],Lye=[0,0,0],Rye=zae(),Dye=1/3,Fye={start:Dye,end:Dye};class jye extends sde{constructor(e){super(e),this._handles=new Mh,this._location=[0,0,0],this._direction=ym(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=fae(1,0,1,1),this._renderOccluded=4,this.applyProps(e)}get location(){return this._location}set location(e){rv(this._location,e)||(Dm(this._location,e),this.updateGeometry())}get direction(){return this._direction}set direction(e){rv(this._direction,e)||(Dm(this._direction,e),this.updateGeometry())}setDirectionFromPoints(e,t){$m(this._direction,Nm(this._direction,t,e)),this.updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this.updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this.updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this.updateGeometry())}get color(){return this._color}set color(e){Bre(e,this._color)||(Are(this._color,e),this.updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this.updateMaterial())}createExternalResources(){const e=new tye(this.materialParameters);this._handles.add(this.view.state.watch("camera",(()=>{this.updateGeometry()}))),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=Hde.createPolylineGeometry([[0,0,0],[0,0,0]]),i=Hde.createPolylineGeometry([[0,0,0],[0,0,0]]),r=this._externalResources.material;e.addGeometry(t,r,Vse),e.addGeometry(i,r,Vse),this.updateVertices(e)}forEachExternalMaterial(e){m(this._externalResources)&&e(this._externalResources.material)}updateMaterial(){v(this._externalResources)||this._externalResources.material.setParameterValues(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}updateGeometry(){const e=this.object;v(e)||this.updateVertices(e)}updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,zye),jm(Nye,this.location,this.direction),t.projectToScreen(Nye,Vye),GX(Vye,CX(Vye,Vye,zye)),this.updateVertexAttributes(t,e,0,zye,Vye,1),this.updateVertexAttributes(t,e,1,zye,Vye,-1)}updateVertexAttributes(e,t,i,r,s,n){const o=t.geometryRecords[i].geometry.getMutableAttribute("position").data,a=DX(Uye,AX(Uye,s[1]*n,s[0]*-n),this.offset+this.width/2),l=PX(Gye,PX(Gye,PX(Gye,r,DX(Gye,s,this.length/2)),a),a),h=PX(Bye,l,DX(Bye,s,-this.length));e.unprojectFromScreen(l,Nye),o[0]=Nye[0],o[1]=Nye[1],o[2]=Nye[2],e.unprojectFromScreen(h,Nye),o[3]=Nye[0],o[4]=Nye[1],o[5]=Nye[2],t.geometryVertexAttrsUpdated(i)}}const Nye=[0,0,0],zye=jS(),Vye=jS(),Uye=jS(),Gye=jS(),Bye=jS();class qye{constructor(e){this.resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return m(this._resources)?this._resources.object:null}get resources(){return m(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this.resourceFactory.recreateGeometry)return void this.recreate();const e=this.resourceFactory.view._stage;if(v(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{2===t.type&&e.remove(t)})),t.removeAllGeometries();const i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this.resourceFactory.view._stage;if(!e)return;const t=new rde({isPickable:!1,updatePolicy:1});e.add(t);const i=new Ape({castShadow:!1}),r=this.resourceFactory.createResources(i,t);r.forEach((t=>e.add(t))),e.add(i),t.add(i),this._syncVisible();const s=this.resourceFactory.cameraChanged?Rh(this.resourceFactory.view.state,"camera",(e=>this.resourceFactory.cameraChanged(e))):null;this._resources={layer:t,object:i,external:r,cameraHandle:s}}_destroyResources(){if(v(this._resources))return;const e=this.resourceFactory.view._stage;null==e||e.remove(this._resources.object),null==e||e.remove(this._resources.layer),this._resources.external.forEach((t=>{null==e||e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){v(this._resources)||this._resources.object.setVisible(this._visible)}}function Hye(e){return"point"===e.type}function Wye(e){return"declaredClass"in e}function $ye(e){return"declaredClass"in e}function Jye(e,t){if(!e)return null;if(function(e){return"declaredClass"in e}(e))return e;const i=new fE({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=H(e.symbol),i.attributes=H(e.attributes),i.geometry=Xye(e.geometry),i}function Xye(e){return v(e)?null:Wye(e)?e:dw(function(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:Kye(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:Kye(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:h,hasZ:c,hasM:u}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:h,hasZ:c,hasM:u,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:Zye(i)?Yye(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}(e))}function Kye(e){return function(e){for(const t of e)if(0!==t.length)return Zye(t);return!1}(e)?e.map((e=>Yye(e))):e}function Yye(e){return e.map((e=>function(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}(e)))}function Zye(e){return e.length&&(G(e[0])||B(e[0]))}function Qye(e,t){if(!e)return null;let i;if($ye(e)){if(null==t)return e.clone();if($ye(t))return t.copy(e)}return null!=t?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=Vie(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}function ege(e,t){if("point"===e.type)return ige(e,t,!1);if(Wye(e))switch(e.type){case"extent":return ige(e.center,t,!1);case"polygon":return ige(e.centroid,t,!1);case"polyline":return ige(tge(e),t,!0);case"mesh":return ige(e.origin,t,!1)}else switch(e.type){case"extent":return ige(function(e){const t=fv(e.zmin);return Vie(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return ige(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const i=Pb(e.rings,e.hasZ);return Vie(i[0],i[1],i[2],e.spatialReference)}(e),t,!0);case"polyline":return ige(tge(e),t,!0)}}function tge(e){const t=e.paths[0];if(!t||0===t.length)return null;const i=Sb(t,xb(t)/2);return Vie(i[0],i[1],i[2],e.spatialReference)}function ige(e,t,i){const r=i?e:Qye(e);return t&&e?xZ(e,r,t)?r:null:r}function rge(e,t,i,r=0){if(e){t||(t=v$());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),Pre(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function sge(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute("auxpos1");r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(i))}}function nge(e,t){const i=Qre(cse);return m(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),m(t)?i[3]=t:m(e)&&e.length>3&&(i[3]=e[3]),i}function oge(e=Mm,t,i,r=1){const s=new Array(3);if(v(t)||v(i))s[0]=1,s[1]=1,s[2]=1;else{let r,n=0;for(let o=2;o>=0;o--){const a=e[o];let l;const h=null!=a,c=0===o&&!r&&!h,u=i[o];"symbol-value"===a||c?l=0!==u?t[o]/u:1:h&&"proportional"!==a&&isFinite(a)&&(l=0!==u?a/u:1),null!=l&&(s[o]=l,r=l,n=Math.max(n,Math.abs(l)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=r:0===s[e]&&(s[e]=.001*n)}for(let n=2;n>=0;n--)s[n]/=r;return gm(s)}function age(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),lge(e)?null:"Symbol sizes may not be negative values"}function lge(e){if(Array.isArray(e)){for(const t of e)if(!lge(t))return!1;return!0}return null==e||e>=0}function hge(e,t,i,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){const s=e||0,n=t||0,o=i||0;return 0!==s&&fY(r,r,-s/180*Math.PI),0!==n&&pY(r,r,n/180*Math.PI),0!==o&&dY(r,r,o/180*Math.PI),r}function cge(e,t){return null!=t.minDemResolution?t.minDemResolution:pie(e)?t.minDemResolutionForPoints:.01*function(e){return Math.max(Jte(e),Kte(e),Xte(e))}(e)}const uge={"bottom-left":nK(0,0),bottom:nK(.5,0),"bottom-right":nK(1,0),left:nK(0,.5),center:nK(.5,.5),right:nK(1,.5),"top-left":nK(0,1),top:nK(.5,1),"top-right":nK(1,1)};class pge{constructor(e,t=null,i=0){this.array=e,this.spatialReference=t,this.offset=i}}function dge(e){return"array"in e}function fge(e,t,i="ground"){if(Hye(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(dge(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,S(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function yge(e,t,i,r,s,n,o,a,l,h,c){const u=xge[c.mode];let p,d,f=0;if(CZ(e,t,i,r,l.spatialReference,s,a))return u.requiresAlignment(c)?(f=u.applyElevationAlignmentBuffer(r,s,n,o,a,l,h,c),p=n,d=o):(p=r,d=s),CZ(p,l.spatialReference,d,n,h.spatialReference,o,a)?f:void 0}function gge(e,t,i,r,s){const n=(Hye(e)?e.z:dge(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const i=S(fge(t,e,"ground"),0);return s&&(s.verticalDistanceToGround=0,s.sampledElevation=i),i}case"relative-to-ground":{const o=S(fge(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s&&(s.verticalDistanceToGround=a,s.sampledElevation=o),a+o}case"relative-to-scene":{const o=S(fge(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s&&(s.verticalDistanceToGround=a,s.sampledElevation=o),a+o}case"absolute-height":{const o=i.geometryZWithOffset(n,r);if(s){const i=S(fge(t,e,"ground"),0);s.verticalDistanceToGround=o-i,s.sampledElevation=i}return o}default:return i.mode,0}}function mge(e,t,i){return null==t||null==i?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===i?e.staysOnTheGround:t===i||"on-the-ground"!==t&&"on-the-ground"!==i?_ge.UPDATE:e.onTheGroundChanged}function vge(e){return"relative-to-ground"===e||"relative-to-scene"===e}function bge(e){return"absolute-height"!==e}function wge(e,t,i,r,s){const n=gge(t,i,s,r,Mge);sge(e,Mge.verticalDistanceToGround);const o=Mge.sampledElevation,a=rY(Sge,e.transformation);return Tge[0]=t.x,Tge[1]=t.y,Tge[2]=n,LZ(t.spatialReference,Tge,a,r.spatialReference)?e.transformation=a:console.warn("Could not locate symbol object properly, it might be misplaced"),o}var _ge;!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(_ge||(_ge={}));const xge={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext;t*=3,r*=3;for(let c=0;c<s;++c){const s=e[t+0],n=e[t+1],o=e[t+2];i[r+0]=s,i[r+1]=n,i[r+2]=null==h?o+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return 0!==t||null!=i}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const s=e[t+0],l=e[t+1],h=e[t+2],c=S(n.getElevation(s,l,h,a,"ground"),0);o+=c,i[r+0]=s,i[r+1]=l,i[r+2]=c,t+=3,r+=3}return o/s},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n,o,a){let l=0;const h=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext,u=n.spatialReference;t*=3,r*=3;for(let p=0;p<s;++p){const s=e[t+0],o=e[t+1],a=e[t+2],p=S(n.getElevation(s,o,a,u,"ground"),0);l+=p,i[r+0]=s,i[r+1]=o,i[r+2]=null==c?a+p+h:p+h,t+=3,r+=3}return l/s},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,i,r,s,n,o,a){let l=0;const h=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext,u=n.spatialReference;t*=3,r*=3;for(let p=0;p<s;++p){const s=e[t+0],o=e[t+1],a=e[t+2],p=S(n.getElevation(s,o,a,u,"scene"),0);l+=p,i[r+0]=s,i[r+1]=o,i[r+2]=null==c?a+p+h:p+h,t+=3,r+=3}return l/s},requiresAlignment:()=>!0}},Sge=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Mge={verticalDistanceToGround:0,sampledElevation:0},Tge=[0,0,0],Ige=Ne.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");async function Ege(e,t,i){const r=e&&e.expression;if("string"!=typeof r)return null;const s=function(e){return"0"===e?0:null}(r);if(null!=s)return{cachedResult:s};const n=await i_(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function Age(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function Pge(e,t){if(null!=e&&!kge(e)){if(!t||!e.arcade)return void Ige.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=Xye(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Cge(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||"0"===r||(i=null),i}const Oge={cachedResult:0};function kge(e){return null!=e.cachedResult}class Lge{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=VV(e)}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=function(e){if(null!=e){if(kge(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=function(e){return null!=BF[e]}(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=S(e.offset,0)}updateFeatureExpressionInfoContext(e,t,i){if(v(e))return void(this._featureExpressionInfoContext=null);const r=e&&e.arcade;r&&m(t)&&m(i)?(this._featureExpressionInfoContext=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}(e),Pge(this._featureExpressionInfoContext,Age(r.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new Lge;return m(e)&&t.setFromElevationInfo(e),t}}function Rge(e,t){const i=e,r=new Uint8Array(4*i*i),s=i/2-.5,n=t/2;for(let o=0;o<i;o++)for(let t=0;t<i;t++){const a=t+i*o,l=t-s,h=o-s;let c=Math.sqrt(l*l+h*h)-n;c=c/e+.5,bue(c,r,4*a)}return r}function Dge(e,t){return Vge(e,t,!1)}function Fge(e,t){return Vge(e,t,!0)}function jge(e,t){return Uge(e,t,!1)}function Nge(e,t){return Uge(e,t,!0)}function zge(e,t){const i=new Uint8Array(4*e*e),r=-.5,s=Math.sqrt(1.25),n=(e-t)/2;for(let o=0;o<e;o++)for(let a=0;a<e;a++){const l=o*e+a,h=(a-n)/t,c=(o-n+.75)/t,u=-(1*h+r*c)/s,p=(1*(h-1)+r*-c)/s,d=-c;bue(Math.max(u,p,d)*t/e+.5,i,4*l)}return i}function Vge(e,t,i){i&&(t/=Math.SQRT2);const r=new Uint8Array(4*e*e);for(let s=0;s<e;s++)for(let n=0;n<e;n++){let o=n-.5*e+.25,a=.5*e-s-.75;const l=s*e+n;if(i){const e=(o+a)/Math.SQRT2;a=(a-o)/Math.SQRT2,o=e}let h=Math.max(Math.abs(o),Math.abs(a))-.5*t;h=h/e+.5,bue(h,r,4*l)}return r}function Uge(e,t,i){i&&(t*=Math.SQRT2);const r=.5*t,s=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let t=0;t<e;t++){let o=t-.5*e,a=.5*e-n-1;const l=n*e+t;if(i){const e=(o+a)/Math.SQRT2;a=(a-o)/Math.SQRT2,o=e}let h;o=Math.abs(o),a=Math.abs(a),h=o>a?o>r?Math.sqrt((o-r)*(o-r)+a*a):a:a>r?Math.sqrt(o*o+(a-r)*(a-r)):o,h=h/e+.5,bue(h,s,4*l)}return s}async function Gge(e,t){const{data:i}=await $i(e,a({responseType:"image"},t));return i}let Bge,qge=null,Hge=null;async function Wge(){return v(Hge)&&(Hge=function(){if(v(Bge)){const e=e=>gr(`esri/libs/basisu/${e}`);Bge=import("./basis_transcoder.e79227f5.js").then((function(e){return e.b})).then((({default:t})=>t({locateFile:e}).then((e=>(e.initializeBasis(),delete e.then,e)))))}return Bge}(),qge=await Hge),Hge}function $ge(e,t,i,r,s){const n=Yce(t?37496:37492),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function Jge(e){return e.getNumImages()>=1&&!e.isUASTC()}function Xge(e){return e.getFaces()>=1&&e.isETC1S()}function Kge(e,t,i,r,s,n,o,h){const{compressedTextureETC:c,compressedTextureS3TC:u}=e.capabilities,[p,d]=c?r?[1,37496]:[0,37492]:u?r?[3,33779]:[2,33776]:[13,6408],f=t.hasMipmap?i:Math.min(1,i),y=[];for(let a=0;a<f;a++)y.push(new Uint8Array(o(a,p))),h(a,p,y[a]);const g=y.length>1,m=g?9987:9729,v=l(a({},t),{samplingMode:m,hasMipmap:g,internalFormat:d,width:s,height:n});return new zhe(e,v,{type:"compressed",levels:y})}const Yge=Ne.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function Zge(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const Qge=Zge("DXT1"),eme=Zge("DXT3"),tme=Zge("DXT5");function ime(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=function(e,t){const i=new Int32Array(e,0,31);if(542327876!==i[0])return Yge.error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return Yge.error("Unsupported format, must contain a FourCC code"),null;const r=i[21];let s,n;switch(r){case Qge:s=8,n=33776;break;case eme:s=16,n=33778;break;case tme:s=16,n=33779;break;default:return Yge.error("Unsupported FourCC code:",function(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}(r)),null}let o=1,a=i[4],l=i[3];0==(3&a)&&0==(3&l)||(Yge.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const h=a,c=l;let u,p;131072&i[2]&&!1!==t&&(o=Math.max(1,i[7])),1===o||vv(a)&&vv(l)||(Yge.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let d=i[1]+4;const f=[];for(let y=0;y<o;++y)p=(a+3>>2)*(l+3>>2)*s,u=new Uint8Array(e,d,p),f.push(u),d+=p,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:f},internalFormat:n,width:h,height:c}}(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?9987:9729,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new zhe(e,t,r)}class rme{constructor(e,t){this._context=e,this._desc=t,this._context.instanceCounter.increment(Qle.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this),i.renderbufferStorage(i.RENDERBUFFER,t.internalFormat,t.width,t.height)}get descriptor(){return this._desc}resize(e,t){const i=this._desc;if(i.width===e&&i.height===t)return;i.width=e,i.height=t;const r=this._context.gl;this._context.bindRenderbuffer(this),r.renderbufferStorage(r.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Qle.Renderbuffer,this),this._context=null)}}const sme=Ne.getLogger("esri.views.webgl.FrameBufferObject");class nme{constructor(e,t,i,r){if(this._context=e,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=a({},t),e.instanceCounter.increment(Qle.Framebuffer,this),i){Array.isArray(i)||(i=[i]);for(let t=0;t<i.length;++t){var s;const r=i[t];let n;ome(r)?(n=r.descriptor,this._colorAttachments.set(36064+t,r)):(n=r,this._colorAttachments.set(36064+t,new zhe(e,r))),0!==(null==(s=this._desc)?void 0:s.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),this._validateColorAttachmentPoint(36064+t),this._validateTextureDimensions(n,this._desc)}}if(r instanceof rme){var n;const e=null!=(n=this._desc.depthStencilTarget)?n:3;2===e?this._stencilAttachment=r:1===e||3===e?this._depthAttachment=r:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),ame(r.descriptor,this._desc)}else if(r){let e;this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),ome(r)?(this._depthStencilTexture=r,e=r.descriptor):this._depthStencilTexture=new zhe(this._context,r),this._validateTextureDimensions(e,this._desc)}}dispose(){if(!this._desc)return;const e=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Qle.Framebuffer,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const e=this._colorAttachments.get(36064);return e&&ome(e)?e:null}get colorAttachment(){return this._colorAttachments.get(36064)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return Zce(this.colorAttachment)+Zce(this.depthStencilAttachment)}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&ome(t)?t:null}attachColorTexture(e,t=36064){if(!e)return;this._validateColorAttachmentPoint(t);const i=e.descriptor;if(this._validateTextureDimensions(i,this._desc),this._disposeColorAttachments(),this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl;i.framebufferTexture2D(i.FRAMEBUFFER,t,i.TEXTURE_2D,e.glName,0)}this._colorAttachments.set(t,e)}detachColorTexture(e=36064){const t=this._colorAttachments.get(e);if(ome(t)){const i=t;if(this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,e,t.TEXTURE_2D,null,0)}return this._colorAttachments.delete(e),i}}attachDepthStencilTexture(e){if(!e)return;const t=e.descriptor;if(34041!==t.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),34042!==t.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDimensions(t,this._desc),this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,e.glName,0)}this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;if(e&&this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)}return this._depthStencilTexture=null,e}attachDepthStencilBuffer(e){if(!e)return;const t=e.descriptor;if(34041!==t.internalFormat&&33189!==t.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat"),ame(t,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=34041===t.internalFormat?3:1,this._initialized){this._context.bindFramebuffer(this);const t=this._context.gl,i=1===this._desc.depthStencilTarget?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(t.FRAMEBUFFER,i,t.RENDERBUFFER,e.glName)}this._depthAttachment=e}detachDepthStencilBuffer(){const e=this._context.gl,t=this._depthAttachment;if(t&&this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}return this._depthAttachment=null,t}detachAll(){this.detachColorTexture(),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(e,t,i,r,s,n,o){(e<0||t<0||s<0||n<0)&&console.error("Offsets cannot be negative!"),(i<=0||r<=0)&&console.error("Copy width and height must be greater than zero!");const a=this._desc,l=o.descriptor;3553!==o.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(e+i>a.width||t+r>a.height||s+i>l.width||n+r>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,c=h.bindTexture(o,zhe.TEXTURE_UNIT_FOR_UPDATES);h.bindFramebuffer(this),h.gl.copyTexSubImage2D(3553,0,s,n,e,t,i,r),h.bindTexture(c,zhe.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,i,r,s,n,o){(i<=0||r<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,i,r,s,n,o)}resize(e,t){const i=this._desc;if(i.width!==e||i.height!==t){if(!this._initialized)return i.width=e,i.height=t,this._colorAttachments.forEach((i=>{i&&i.resize(e,t)})),void(this._depthStencilTexture&&this._depthStencilTexture.resize(e,t));i.width=e,i.height=t,this._colorAttachments.forEach((i=>{i&&i.resize(e,t)})),null!=this._depthStencilTexture?this._depthStencilTexture.resize(e,t):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(e,t),this._stencilAttachment&&this._stencilAttachment.resize(e,t)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(){var e,t,i,r;const s=this._context.gl;if(this._initialized)return void s.bindFramebuffer(s.FRAMEBUFFER,this.glName);this._glName&&s.deleteFramebuffer(this._glName);const n=this._context,o=s.createFramebuffer(),a=this._desc,l=null!=(e=a.colorTarget)?e:1,h=null!=(t=a.width)?t:1,c=null!=(i=a.height)?i:1;if(s.bindFramebuffer(s.FRAMEBUFFER,o),0===this._colorAttachments.size)if(0===l)this._colorAttachments.set(36064,function(e,t){return new zhe(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:t.width,height:t.height})}(n,a));else{const e=new rme(n,{internalFormat:32854,width:h,height:c});this._colorAttachments.set(36064,e)}this._colorAttachments.forEach(((e,t)=>{e&&(ome(e)?s.framebufferTexture2D(s.FRAMEBUFFER,t,s.TEXTURE_2D,e.glName,0):s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,e.glName))}));const u=null!=(r=a.depthStencilTarget)?r:0;switch(u){case 1:case 3:{this._depthAttachment||(this._depthAttachment=new rme(n,{internalFormat:1===a.depthStencilTarget?33189:34041,width:h,height:c}));const e=1===u?s.DEPTH_ATTACHMENT:s.DEPTH_STENCIL_ATTACHMENT;s.framebufferRenderbuffer(s.FRAMEBUFFER,e,s.RENDERBUFFER,this._depthAttachment.glName);break}case 2:this._stencilAttachment||(this._stencilAttachment=new rme(n,{internalFormat:36168,width:h,height:c})),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.STENCIL_ATTACHMENT,s.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:if(!this._depthStencilTexture){n.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const e={target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:h,height:c};this._depthStencilTexture=new zhe(n,e)}s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,this._depthStencilTexture.glName,0)}Xhe()&&s.checkFramebufferStatus(s.FRAMEBUFFER)!==s.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=o,this._initialized=!0}_disposeColorAttachments(){this._colorAttachments.forEach(((e,t)=>{if(ome(e)){if(this._initialized){this._context.bindFramebuffer(this);const e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,t,e.TEXTURE_2D,null,0)}e.dispose()}else if(e instanceof WebGLRenderbuffer){const i=this._context.gl;this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(i.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(e)}})),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const t=1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateTextureDimensions(e,t){3553!==e.target&&console.error("Texture type must be TEXTURE_2D!"),void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}_validateColorAttachmentPoint(e){if(-1===nme._MAX_COLOR_ATTACHMENTS){const e=this._context.capabilities.drawBuffers;if(e){const t=this._context.gl;nme._MAX_COLOR_ATTACHMENTS=t.getParameter(e.MAX_COLOR_ATTACHMENTS)}else nme._MAX_COLOR_ATTACHMENTS=1}const t=e-36064;t+1>nme._MAX_COLOR_ATTACHMENTS&&sme.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${nme._MAX_COLOR_ATTACHMENTS} color attachments`)}}function ome(e){return"type"in e&&"texture"===e.type}function ame(e,t){void 0!==t.width&&t.width>=0&&void 0!==t.height&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}nme._MAX_COLOR_ATTACHMENTS=-1;class lme extends Tpe{constructor(e,t){super(),this.data=e,this.type=4,this.glTexture=null,this.powerOfTwoStretchInfo=null,this.loadingPromise=null,this.loadingController=null,this.events=new sh,this.params=t||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:10497,t:10497},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1,this.estimatedTexMemRequired=lme.estimateTexMemRequired(this.data,this.params),this.startPreload()}startPreload(){const e=this.data;v(e)||(e instanceof HTMLVideoElement?this.startPreloadVideoElement(e):e instanceof HTMLImageElement&&this.startPreloadImageElement(e))}startPreloadVideoElement(e){di(e.src)||"auto"===e.preload&&e.crossOrigin||(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src)}startPreloadImageElement(e){fi(e.src)||di(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}static getDataDimensions(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}static estimateTexMemRequired(e,t){if(v(e))return 0;if(N(e)||z(e))return t.encoding===lme.KTX2_ENCODING?function(e,t){if(v(qge))return e.byteLength;const i=new qge.KTX2File(new Uint8Array(e)),r=Xge(i)?$ge(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}(e,t.mipmap):t.encoding===lme.BASIS_ENCODING?function(e,t){if(v(qge))return e.byteLength;const i=new qge.BasisFile(new Uint8Array(e)),r=Jge(i)?$ge(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}(e,t.mipmap):e.byteLength;const{width:i,height:r}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?lme.getDataDimensions(e):t;return(t.mipmap?4/3:1)*i*r*(t.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}createDescriptor(e){var t;return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(t=this.params.maxAnisotropy)?t:this.params.mipmap?e.parameters.maxMaxAnisotropy:1}}load(e,t){if(m(this.glTexture))return this.glTexture;if(m(this.loadingPromise))return this.loadingPromise;const i=this.data;return v(i)?(this.glTexture=new zhe(e,this.createDescriptor(e),null),this.glTexture):"string"==typeof i?this.loadFromURL(e,t,i):i instanceof Image?this.loadFromImageElement(e,t,i):i instanceof HTMLVideoElement?this.loadFromVideoElement(e,t,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this.loadFromImage(e,i,t):(N(i)||z(i))&&this.params.encoding===lme.DDS_ENCODING?this.loadFromDDSData(e,i):(N(i)||z(i))&&this.params.encoding===lme.KTX2_ENCODING?this.loadFromKTX2(e,i):(N(i)||z(i))&&this.params.encoding===lme.BASIS_ENCODING?this.loadFromBasis(e,i):z(i)?this.loadFromPixelData(e,i):N(i)?this.loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(e,t,i){if(!(this.data instanceof HTMLVideoElement)||v(this.glTexture))return i;if(this.data.readyState<2||i===this.data.currentTime)return i;if(m(this.powerOfTwoStretchInfo)){const{framebuffer:i,vao:r,sourceTexture:s}=this.powerOfTwoStretchInfo;s.setData(this.data),this.drawStretchedTexture(e,t,i,r,s,this.glTexture)}else{const{width:e,height:t}=this.data,{width:i,height:r}=this.glTexture.descriptor;e!==i||t!==r?this.glTexture.updateData(0,0,0,Math.min(e,i),Math.min(t,r),this.data):this.glTexture.setData(this.data)}return this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap(),this.data.currentTime}loadFromDDSData(e,t){return this.glTexture=ime(e,this.createDescriptor(e),t),this.glTexture}loadFromKTX2(e,t){return this.loadAsync((()=>async function(e,t,i){v(qge)&&(qge=await Wge());const r=new qge.KTX2File(new Uint8Array(i));if(!Xge(r))return null;r.startTranscoding();const s=Kge(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),((e,t)=>r.getImageTranscodedSizeInBytes(e,0,0,t)),((e,t,i)=>r.transcodeImage(i,e,0,0,t,0,-1,-1)));return r.close(),r.delete(),s}(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromBasis(e,t){return this.loadAsync((()=>async function(e,t,i){v(qge)&&(qge=await Wge());const r=new qge.BasisFile(new Uint8Array(i));if(!Jge(r))return null;r.startTranscoding();const s=Kge(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),((e,t)=>r.getImageTranscodedSizeInBytes(0,e,t)),((e,t,i)=>r.transcodeImage(i,0,e,t,0,0)));return r.close(),r.delete(),s}(e,this.createDescriptor(e),t).then((e=>(this.glTexture=e,e)))))}loadFromPixelData(e,t){uue(this.params.width>0&&this.params.height>0);const i=this.createDescriptor(e);return i.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,i.width=this.params.width,i.height=this.params.height,this.glTexture=new zhe(e,i,t),this.glTexture}loadAsync(e){const t=et();this.loadingController=t;const i=e(t.signal);this.loadingPromise=i;const r=()=>{this.loadingController===t&&(this.loadingController=null),this.loadingPromise===i&&(this.loadingPromise=null)};return i.then(r,r),i}loadFromURL(e,t,i){return this.loadAsync((async r=>{const s=await Gge(i,{signal:r});return this.loadFromImage(e,s,t)}))}loadFromImageElement(e,t,i){return i.complete?this.loadFromImage(e,i,t):this.loadAsync((async r=>{const s=await Hi(i,i.src,!1,r);return this.loadFromImage(e,s,t)}))}loadFromVideoElement(e,t,i){return i.readyState>=2?this.loadFromImage(e,i,t):this.loadFromVideoElementAsync(e,t,i)}loadFromVideoElementAsync(e,t,i){return this.loadAsync((r=>new Promise(((s,n)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),m(h)&&h.remove()},a=()=>{i.readyState>=2&&(o(),s(this.loadFromImage(e,i,t)))},l=e=>{o(),n(e||new Be("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const h=ot(r,(()=>l(Qe())))}))))}loadFromImage(e,t,i){const r=lme.getDataDimensions(t);this.params.width=r.width,this.params.height=r.height;const s=this.createDescriptor(e);return s.pixelFormat=3===this.params.components?6407:6408,!this.requiresPowerOfTwo(e,s)||vv(r.width)&&vv(r.height)?(s.width=r.width,s.height=r.height,this.glTexture=new zhe(e,s,t),this.glTexture):(this.glTexture=this.makePowerOfTwoTexture(e,t,r,s,i),this.glTexture)}requiresPowerOfTwo(e,t){const i=33071,r="number"==typeof t.wrapMode?t.wrapMode===i:t.wrapMode.s===i&&t.wrapMode.t===i;return!Nhe(e.gl)&&(t.hasMipmap||!r)}makePowerOfTwoTexture(e,t,i,r,s){const{width:n,height:o}=i,a=gv(n),l=gv(o);let h;switch(r.width=a,r.height=l,this.params.powerOfTwoResizeMode){case 2:r.textureCoordinateScaleFactor=[n/a,o/l],h=new zhe(e,r),h.updateData(0,0,0,n,o,t);break;case 1:case null:case void 0:h=this.stretchToPowerOfTwo(e,t,r,s);break;default:this.params.powerOfTwoResizeMode}return r.hasMipmap&&h.generateMipmap(),h}stretchToPowerOfTwo(e,t,i,r){const s=new zhe(e,i),n=new nme(e,{colorTarget:0,depthStencilTarget:0},s),o=new zhe(e,{target:3553,pixelFormat:i.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!i.flipped,maxAnisotropy:8,preMultiplyAlpha:i.preMultiplyAlpha},t),a=lue(e);return this.drawStretchedTexture(e,r,n,a,o,s),this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:a,sourceTexture:o,framebuffer:n}:(a.dispose(!0),o.dispose(),n.detachColorTexture(),e.bindFramebuffer(null),n.dispose()),s}drawStretchedTexture(e,t,i,r,s,n){e.bindFramebuffer(i);const o=e.getViewport();e.setViewport(0,0,n.descriptor.width,n.descriptor.height);const a=t.program;e.useProgram(a),a.setUniform4f("color",1,1,1,1),a.bindTexture(s,"tex"),e.bindVAO(r),e.setPipelineState(t.pipeline),e.drawArrays(5,0,$ce(r,"geometry")),e.bindFramebuffer(null),e.setViewport(o.x,o.y,o.width,o.height)}unload(){if(m(this.powerOfTwoStretchInfo)){const{framebuffer:e,vao:t,sourceTexture:i}=this.powerOfTwoStretchInfo;t.dispose(!0),i.dispose(),e.dispose(),this.glTexture=null,this.powerOfTwoStretchInfo=null}if(m(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null),m(this.loadingController)){const e=this.loadingController;this.loadingController=null,this.loadingPromise=null,e.abort()}this.events.emit("unloaded")}}function hme(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}lme.DDS_ENCODING="image/vnd-ms.dds",lme.KTX2_ENCODING="image/ktx2",lme.BASIS_ENCODING="image/x.basis";class cme extends Xde{constructor(e){super(e),this._textureIDs=new Set,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._initTransparent=!!e.initTextureTransparent,this._texture=this._acquire(this._textureId),this._textureNormal=this._acquire(e.normalTextureId),this._textureEmissive=this._acquire(e.emissiveTextureId),this._textureOcclusion=this._acquire(e.occlusionTextureId),this._textureMetallicRoughness=this._acquire(e.metallicRoughnessTextureId)}dispose(){this._textureIDs.forEach((e=>this._textureRepository.release(e))),this._textureIDs.clear()}updateTexture(e){e!==this._textureId&&(this._release(this._textureId),this._textureId=e,this._texture=this._acquire(this._textureId))}bindTextures(e){m(this._texture)&&e.bindTexture(this._texture.glTexture,"tex"),m(this._textureNormal)&&e.bindTexture(this._textureNormal.glTexture,"normalTexture"),m(this._textureEmissive)&&e.bindTexture(this._textureEmissive.glTexture,"texEmission"),m(this._textureOcclusion)&&e.bindTexture(this._textureOcclusion.glTexture,"texOcclusion"),m(this._textureMetallicRoughness)&&e.bindTexture(this._textureMetallicRoughness.glTexture,"texMetallicRoughness")}bindTextureScale(e){const t=m(this._texture)&&this._texture.glTexture;t&&t.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",t.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)}_acquire(e){if(!v(e))return this._textureIDs.add(e),this._textureRepository.acquire(e,this._initTransparent)}_release(e){v(e)||(this._textureIDs.delete(e),this._textureRepository.release(e))}}function ume(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const i=2*e[a];s[r]=t[i],s[r+1]=t[i+1],r+=n}}function pme(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,null==s||1===s)for(let l=0;l<a;++l){const i=3*e[l];n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],r+=o}else for(let l=0;l<a;++l){const i=3*e[l];for(let e=0;e<s;++e)n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],r+=o}}function dme(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,1===s)for(let l=0;l<a;++l){const i=4*e[l];n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],n[r+3]=t[i+3],r+=o}else for(let l=0;l<a;++l){const i=4*e[l];for(let e=0;e<s;++e)n[r]=t[i],n[r+1]=t[i+1],n[r+2]=t[i+2],n[r+3]=t[i+3],r+=o}}function fme(e,t,i,r,s,n=1){if(!i)return void pme(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,h=i[0],c=i[1],u=i[2],p=i[4],d=i[5],f=i[6],y=i[8],g=i[9],m=i[10],v=i[12],b=i[13],w=i[14];if(s*=a,1===n)for(let _=0;_<l;++_){const i=3*e[_],r=t[i],n=t[i+1],l=t[i+2];o[s]=h*r+p*n+y*l+v,o[s+1]=c*r+d*n+g*l+b,o[s+2]=u*r+f*n+m*l+w,s+=a}else for(let _=0;_<l;++_){const i=3*e[_],r=t[i],l=t[i+1],x=t[i+2],S=h*r+p*l+y*x+v,M=c*r+d*l+g*x+b,T=u*r+f*l+m*x+w;for(let e=0;e<n;++e)o[s]=S,o[s+1]=M,o[s+2]=T,s+=a}}function yme(e,t,i,r,s,n=1){if(!i)return void pme(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,h=e.length,c=o[0],u=o[1],p=o[2],d=o[4],f=o[5],y=o[6],g=o[8],m=o[9],v=o[10],b=!AY(o),w=1e-6,_=1-w;if(s*=l,1===n)for(let x=0;x<h;++x){const i=3*e[x],r=t[i],n=t[i+1],o=t[i+2];let h=c*r+d*n+g*o,S=u*r+f*n+m*o,M=p*r+y*n+v*o;if(b){const e=h*h+S*S+M*M;if(e<_&&e>w){const t=1/Math.sqrt(e);h*=t,S*=t,M*=t}}a[s+0]=h,a[s+1]=S,a[s+2]=M,s+=l}else for(let x=0;x<h;++x){const i=3*e[x],r=t[i],o=t[i+1],h=t[i+2];let S=c*r+d*o+g*h,M=u*r+f*o+m*h,T=p*r+y*o+v*h;if(b){const e=S*S+M*M+T*T;if(e<_&&e>w){const t=1/Math.sqrt(e);S*=t,M*=t,T*=t}}for(let e=0;e<n;++e)a[s+0]=S,a[s+1]=M,a[s+2]=T,s+=l}}function gme(e,t,i,r,s,n=1){if(!i)return void dme(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,h=e.length,c=o[0],u=o[1],p=o[2],d=o[4],f=o[5],y=o[6],g=o[8],m=o[9],v=o[10],b=!AY(o),w=1e-6,_=1-w;if(s*=l,1===n)for(let x=0;x<h;++x){const i=4*e[x],r=t[i],n=t[i+1],o=t[i+2],h=t[i+3];let S=c*r+d*n+g*o,M=u*r+f*n+m*o,T=p*r+y*n+v*o;if(b){const e=S*S+M*M+T*T;if(e<_&&e>w){const t=1/Math.sqrt(e);S*=t,M*=t,T*=t}}a[s+0]=S,a[s+1]=M,a[s+2]=T,a[s+3]=h,s+=l}else for(let x=0;x<h;++x){const i=4*e[x],r=t[i],o=t[i+1],h=t[i+2],S=t[i+3];let M=c*r+d*o+g*h,T=u*r+f*o+m*h,I=p*r+y*o+v*h;if(b){const e=M*M+T*T+I*I;if(e<_&&e>w){const t=1/Math.sqrt(e);M*=t,T*=t,I*=t}}for(let e=0;e<n;++e)a[s+0]=M,a[s+1]=T,a[s+2]=I,a[s+3]=S,s+=l}}function mme(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,1===n){if(4===i)for(let h=0;h<l;++h){const i=4*e[h];o[s]=t[i],o[s+1]=t[i+1],o[s+2]=t[i+2],o[s+3]=t[i+3],s+=a}else if(3===i)for(let h=0;h<l;++h){const i=3*e[h];o[s]=t[i],o[s+1]=t[i+1],o[s+2]=t[i+2],o[s+3]=255,s+=a}}else if(4===i)for(let h=0;h<l;++h){const i=4*e[h];for(let e=0;e<n;++e)o[s]=t[i],o[s+1]=t[i+1],o[s+2]=t[i+2],o[s+3]=t[i+3],s+=a}else if(3===i)for(let h=0;h<l;++h){const i=3*e[h];for(let e=0;e<n;++e)o[s]=t[i],o[s+1]=t[i+1],o[s+2]=t[i+2],o[s+3]=255,s+=a}}function vme(e,t,i,r,s,n){for(const o of t.fieldNames){const t=e.vertexAttributes.get(o),a=e.indices.get(o);if(t&&a)switch(o){case"position":{uue(3===t.size);const e=s.getField(o,lle);e&&fme(a,t.data,i,e,n);break}case"normal":{uue(3===t.size);const e=s.getField(o,lle);e&&yme(a,t.data,r,e,n);break}case"uv0":{uue(2===t.size);const e=s.getField(o,ale);e&&ume(a,t.data,e,n);break}case"color":{uue(3===t.size||4===t.size);const e=s.getField(o,_le);e&&mme(a,t.data,t.size,e,n);break}case"symbolColor":{uue(3===t.size||4===t.size);const e=s.getField(o,_le);e&&mme(a,t.data,t.size,e,n);break}case"tangent":{uue(4===t.size);const e=s.getField(o,hle);e&&gme(a,t.data,r,e,n);break}}}}function bme(e){const t=_ce`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=_ce`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function wme(e){e.vertex.code.add(_ce`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(_ce`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(_ce`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(_ce`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(_ce`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(_ce`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
}`),e.vertex.code.add(_ce`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function _me(e,t){const i=e;i.include(wme),i.attributes.add("position","vec3"),i.attributes.add("normal","vec3"),i.attributes.add("auxpos1","vec4"),i.vertex.uniforms.add("proj","mat4"),i.vertex.uniforms.add("view","mat4"),i.vertex.uniforms.add("viewNormal","mat4"),i.vertex.uniforms.add("viewport","vec4"),i.vertex.uniforms.add("camPos","vec3"),i.vertex.uniforms.add("polygonOffset","float"),i.vertex.uniforms.add("cameraGroundRelative","float"),i.vertex.uniforms.add("pixelRatio","float"),i.vertex.uniforms.add("perDistancePixelRatio","float"),i.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&i.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&i.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),i.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),i.vertex.constants.add("smallOffsetAngle","float",.984807753012208),i.vertex.code.add(_ce`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.vertex.code.add(_ce`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped||i.vertex.code.add(_ce`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`),i.vertex.code.add(_ce`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.verticalOffsetEnabled?_ce`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==t.screenCenterOffsetUnitsEnabled?_ce`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.vertex.code.add(_ce`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (uRenderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}function xme(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}function Sme(e){e.include(Sce),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add(_ce`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}function Mme(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}function Tme(e,t){t.multipassGeometryEnabled&&e.vertex.include(Sme),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add(_ce`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.multipassGeometryEnabled?_ce`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.multipassTerrainEnabled?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.multipassTerrainEnabled&&e.fragment.include(Sce),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(xce),e.fragment.code.add(_ce`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.multipassTerrainEnabled?_ce`

          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}function Ime(e){const t=new Ace,i=e.signedDistanceFieldEnabled;if(t.include(bme),t.include(_me,e),t.include(tfe,e),6===e.output)return t.include(Tme,e),t;t.include(wme),t.fragment.include(xce),t.fragment.include($fe),t.include(ufe,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),i&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add(_ce`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.screenSizePerspectiveEnabled?_ce`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:_ce`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const r=_ce`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,s=e.pixelSnappingEnabled?i?_ce`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:_ce`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:_ce`posProj += quadOffset;`;t.vertex.code.add(_ce`
      ${e.occlusionTestEnabled?"if (visible) {":""}
      ${r}
      ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${_ce.float(Hfe)};
      ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${_ce.float(Hfe)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${s}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${e.occlusionTestEnabled?_ce`} else { vtc = vec2(0.0);
        ${e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `),t.fragment.uniforms.add("tex","sampler2D"),i&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));const n=e.debugDrawBorder?_ce`(isBorder > 0.0 ? 0.0 : ${_ce.float(.1)})`:_ce.float(.1),o=_ce`
    ${e.debugDrawBorder?_ce`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?_ce`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${n} ||
          fillPixelColor.a + outlinePixelColor.a < ${_ce.float(Hfe)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${n}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:_ce`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${n}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${e.debugDrawBorder?_ce`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;return 7===e.output&&t.fragment.code.add(_ce`
      void main() {
        ${o}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),0===e.output&&t.fragment.code.add(_ce`
    void main() {
      ${o}
      ${e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),4===e.output&&(t.include(afe),t.fragment.code.add(_ce`
    void main() {
      ${o}
      ${e.binaryHighlightOcclusionEnabled?_ce`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function Eme(e,t,i){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",hse),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*i,2*t.screenOffset[1]*i),e.setUniform2fv("anchorPos",Ame(t))}function Ame(e,t=Pme){return e.textureIsSignedDistanceField?function(e,t,i){i[0]=e[0]*(t[2]-t[0])+t[0],i[1]=e[1]*(t[3]-t[1])+t[1]}(e.anchorPos,e.distanceFieldBoundingBox,t):EX(t,e.anchorPos),t}const Pme=[0,0];var Cme=Object.freeze({__proto__:null,build:Ime,bindHUDMaterialUniforms:Eme,calculateAnchorPosForRendering:Ame});function Ome(e,t){const i=e.vertex.code;t.verticalOffsetEnabled?(e.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&(e.include(wme),e.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),i.add(_ce`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===t.viewingMode?_ce`vec3 worldNormal = normalize(worldPos + localOrigin);`:_ce`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${t.screenSizePerspectiveEnabled?_ce`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:_ce`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):i.add(_ce`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}function kme(e,t,i){if(!t.verticalOffset)return;const r=function(e,t,i,r=Lme){return r.screenLength=e.screenLength,r.perDistance=Math.tan(.5*t)/(.5*i),r.minWorldLength=e.minWorldLength,r.maxWorldLength=e.maxWorldLength,r}(t.verticalOffset,i.camera.fovY,i.camera.fullViewport[3]),s=i.camera.pixelRatio||1;e.setUniform4f("verticalOffset",r.screenLength*s,r.perDistance,r.minWorldLength,r.maxWorldLength)}const Lme={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};class Rme extends Kle{initializeProgram(e){const t=Rme.shader.get(),i=this.configuration,r=t.build({output:i.output,FrontFacePass:2===i.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:i.occlusionTestEnabled,signedDistanceFieldEnabled:i.sdf,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:i.debugDrawBorder,binaryHighlightOcclusionEnabled:i.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:i.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:i.screenSizePerspective,verticalOffsetEnabled:i.verticalOffset,pixelSnappingEnabled:i.pixelSnappingEnabled,vvSize:i.vvSize,vvColor:i.vvColor,vvInstancingEnabled:!1,isDraped:i.isDraped,multipassGeometryEnabled:i.multipassGeometryEnabled,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new wce(e.rctx,r,nue)}bindPass(e,t){mfe(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),kme(this.program,e,t),function(e,t){t.screenSizePerspective&&(ipe(t.screenSizePerspective,e,"screenSizePerspective"),ipe(t.screenSizePerspectiveAlignment||t.screenSizePerspective,e,"screenSizePerspectiveAlignment"))}(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),_fe(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),Mme(this.program,t),cfe(this.program,t)):(xme(this.program,t),Eme(this.program,e,t.camera.pixelRatio||1),pfe(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&lfe(this.program,t)}bindDraw(e){wfe(this.program,e),gfe(this.program,e.origin,e.camera.viewInverseTransposeMatrix),ife(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e){const t=this.configuration,i=3===e,r=2===e,s=this.configuration.polygonOffsetEnabled&&Dme,n=(i||r)&&4!==t.output?(t.depthEnabled||6===t.output)&&ahe:null;return mhe({blending:0===t.output||7===t.output||4===t.output?i?Fme:Ife(e):null,depthTest:{func:515},depthWrite:n,colorWrite:lhe,polygonOffset:s})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return 6===this.configuration.output?0:4}}Rme.shader=new Xle(Cme,(()=>import("./HUDMaterial.glsl.a2ca943c.js")));const Dme={factor:0,units:-4},Fme=ihe(1,771);class jme extends Yle{constructor(){super(...arguments),this.output=0,this.occlusionTestEnabled=!0,this.sdf=!1,this.vvSize=!1,this.vvColor=!1,this.verticalOffset=!1,this.screenSizePerspective=!1,this.screenCenterOffsetUnitsEnabled=0,this.debugDrawBorder=!0,this.binaryHighlightOcclusion=!0,this.slicePlaneEnabled=!1,this.polygonOffsetEnabled=!1,this.depthEnabled=!0,this.transparencyPassType=3,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.multipassGeometryEnabled=!1,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Q([Zle({count:8})],jme.prototype,"output",void 0),Q([Zle()],jme.prototype,"occlusionTestEnabled",void 0),Q([Zle()],jme.prototype,"sdf",void 0),Q([Zle()],jme.prototype,"vvSize",void 0),Q([Zle()],jme.prototype,"vvColor",void 0),Q([Zle()],jme.prototype,"verticalOffset",void 0),Q([Zle()],jme.prototype,"screenSizePerspective",void 0),Q([Zle({count:2})],jme.prototype,"screenCenterOffsetUnitsEnabled",void 0),Q([Zle()],jme.prototype,"debugDrawBorder",void 0),Q([Zle()],jme.prototype,"binaryHighlightOcclusion",void 0),Q([Zle()],jme.prototype,"slicePlaneEnabled",void 0),Q([Zle()],jme.prototype,"polygonOffsetEnabled",void 0),Q([Zle()],jme.prototype,"depthEnabled",void 0),Q([Zle({count:4})],jme.prototype,"transparencyPassType",void 0),Q([Zle()],jme.prototype,"pixelSnappingEnabled",void 0),Q([Zle()],jme.prototype,"isDraped",void 0),Q([Zle()],jme.prototype,"multipassGeometryEnabled",void 0),Q([Zle()],jme.prototype,"multipassTerrainEnabled",void 0),Q([Zle()],jme.prototype,"cullAboveGround",void 0);class Nme extends Kde{constructor(e){super(e,ove),this.techniqueConfig=new jme}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.params.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset,this.techniqueConfig.isDraped=this.params.isDraped,this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled,this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.params.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.params.depthEnabled,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.multipassGeometryEnabled=!!t&&t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,r,s,n,o,a,l){l?this.intersectDrapedHudGeometry(e,n,o,a):this.intersectHudGeometry(e,t,i,r,o,a)}intersectDrapedHudGeometry(e,t,i,r){const s=e.vertexAttributes.get("position"),n=e.vertexAttributes.get("size"),o=this.params,a=Ame(o);let l=1,h=1;if(m(r)){const e=r(tve);l=e[0],h=e[5]}l*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const c=rve*e.screenToWorldRatio;for(let u=0;u<s.data.length/s.size;u++){const r=u*s.size,p=s.data[r],d=s.data[r+1],f=u*n.size;let y;sve[0]=n.data[f]*l,sve[1]=n.data[f+1]*h,o.textureIsSignedDistanceField&&(y=o.outlineSize*e.screenToWorldRatio/2),Gme(t,p,d,sve,c,y,o,a)&&i()}}intersectHudGeometry(e,t,i,r,s,n){if(!r.options.selectionMode||!r.options.hud)return;if(jue(t))return;const o=this.params;let a=1,l=1;if(MQ(Kme,i),m(n)){const e=n(tve);a=e[0],l=e[5],function(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],h=e[8],c=1/Math.sqrt(t*t+i*i+r*r),u=1/Math.sqrt(s*s+n*n+o*o),p=1/Math.sqrt(a*a+l*l+h*h);e[0]=t*c,e[1]=i*c,e[2]=r*c,e[3]=s*u,e[4]=n*u,e[5]=o*u,e[6]=a*p,e[7]=l*p,e[8]=h*p}(Kme)}const h=e.vertexAttributes.get("position"),c=e.vertexAttributes.get("size"),u=e.vertexAttributes.get("normal"),p=e.vertexAttributes.get("auxpos1");uue(h.size>=3);const d=r.point,f=r.camera,y=Ame(o);a*=f.pixelRatio,l*=f.pixelRatio;const g="screen"===this.params.centerOffsetUnits;for(let m=0;m<h.data.length/h.size;m++){const e=m*h.size;Fm(Hme,h.data[e],h.data[e+1],h.data[e+2]),Ym(Hme,Hme,i);const t=m*c.size;sve[0]=c.data[t]*a,sve[1]=c.data[t+1]*l,Ym(Hme,Hme,f.viewMatrix);const n=m*p.size;if(Fm(Qme,p.data[n+0],p.data[n+1],p.data[n+2]),!g&&(Hme[0]+=Qme[0],Hme[1]+=Qme[1],0!==Qme[2])){const e=Qme[2];$m(Qme,Hme),Nm(Hme,Hme,Um(Qme,Qme,e))}const v=m*u.size;if(Fm(Wme,u.data[v],u.data[v+1],u.data[v+2]),this.normalAndViewAngle(Wme,Kme,f,eve),this.applyVerticalOffsetTransformationView(Hme,eve,f,Bme),f.applyProjection(Hme,$me),$me[0]>-1){let e=Math.floor($me[0])+this.params.screenOffset[0],t=Math.floor($me[1])+this.params.screenOffset[1];g&&(e+=Qme[0],0!==Qme[1]&&(t+=Eue(Qme[1],Bme.factorAlignment))),Pue(sve,Bme.factor,sve);const i=ive*f.pixelRatio;let n;if(o.textureIsSignedDistanceField&&(n=o.outlineSize*f.pixelRatio/2),Gme(d,e,t,sve,i,n,o,y)){const e=r.ray;if(Ym(Xme,Hme,aY(Zme,f.viewMatrix)),$me[0]=d[0],$me[1]=d[1],f.unprojectFromRenderScreen($me,Hme)){const t=[0,0,0];Dm(t,e.direction);const i=1/Rm(t);Um(t,t,i),s(Bm(e.origin,Hme)*i,t,-1,1,!0,Xme)}}}}}computeAttachmentOrigin(e,t){const i=e.vertexAttributes;if(!i)return!1;return Cde(i.get("position"),e.indices.get("position"),t)}createBufferWriter(){return new lve(this)}normalAndViewAngle(e,t,i,r){return hme(t)&&(t=MQ(Yme,t)),Zm(r.normal,e,t),Ym(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=Jm(Jme,nve),r}updateScaleInfo(e,t,i){const r=this.params;r.screenSizePerspective?Aue(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?Aue(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,t,i,r,s,n,o){const a=this.normalAndViewAngle(t,i,s,eve);return this.applyVerticalGroundOffsetView(e,a,s,o),this.applyVerticalOffsetTransformationView(o,a,s,n),this.applyPolygonOffsetView(o,a,r[3],s,o),this.applyCenterOffsetView(o,r,o),o}applyShaderOffsetsNDC(e,t,i,r,s){return this.applyCenterOffsetNDC(e,t,i,r),m(s)&&Dm(s,r),this.applyPolygonOffsetNDC(r,t,i,r),r}applyPolygonOffsetView(e,t,i,r,s){const n=r.aboveGround?1:-1;let o=wv(i);0===o&&(o=n);const a=n*o;if(this.params.shaderPolygonOffset<=0)return Dm(s,e);const l=mv(Math.abs(t.cosAngle),.01,1),h=1-Math.sqrt(1-l*l)/l/r.viewport[2];return Um(s,e,a>0?h:1/h),s}applyVerticalGroundOffsetView(e,t,i,r){const s=Rm(e),n=i.aboveGround?1:-1,o=.5*i.computeRenderPixelSizeAtDist(s);return jm(r,e,Um(Hme,t.normal,n*o)),r}applyVerticalOffsetTransformationView(e,t,i,r){const s=this.params;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const i=Rm(e);this.updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const n=Rm(e),o=s.screenSizePerspectiveAlignment||s.screenSizePerspective,a=tpe(i,n,s.verticalOffset,t.cosAngle,o);return this.updateScaleInfo(r,n,t.cosAngle),Um(t.normal,t.normal,a),jm(e,e,t.normal)}applyCenterOffsetView(e,t,i){const r="screen"!==this.params.centerOffsetUnits;return i!==e&&Dm(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&($m(Wme,i),jm(i,i,Um(Wme,Wme,t[2])))),i}applyCenterOffsetNDC(e,t,i,r){const s="screen"!==this.params.centerOffsetUnits;return r!==e&&Dm(r,e),s||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}applyPolygonOffsetNDC(e,t,i,r){const s=this.params.shaderPolygonOffset;if(e!==r&&Dm(r,e),s){const e=i.aboveGround?1:-1,n=e*wv(t[3]);r[2]-=(n||e)*s}return r}getGLMaterial(e){return 0===e.output||7===e.output?new Vme(e):4===e.output?new Ume(e):void 0}calculateRelativeScreenBounds(e,t,i=v$()){return function(e,t,i,r=qme){EX(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i}(this.params,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}}class zme extends cme{constructor(e){super(a(a({},e),e.material.params)),this.updateParameters()}beginSlot(e){return e===(this._material.params.drawInSecondSlot?19:18)}updateParameters(e){this.updateTexture(this._material.params.textureId),this.selectProgram(e)}selectProgram(e){this._technique=this._techniqueRep.releaseAndAcquire(Rme,this._material.getTechniqueConfig(this._output,e),this._technique)}ensureParameters(e){this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}}class Vme extends zme{constructor(e){super(e),this._isOcclusionSlot=!1}beginSlot(e){const t=this._material.params.drawInSecondSlot?19:18;return this._material.params.occlusionTest?(this._isOcclusionSlot=12===e,12===e||e===t):(this._isOcclusionSlot=!1,e===t)}get technique(){return this._isOcclusionSlot?this._occlusionTechnique:this._technique}selectProgram(e){this._technique=this._techniqueRep.releaseAndAcquire(Rme,this._material.getTechniqueConfig(this._output,e),this._technique),this._occlusionTechnique=this._techniqueRep.releaseAndAcquire(Rme,this._material.getTechniqueConfig(6,e),this._occlusionTechnique)}bind(e){const t=this.technique;this._isOcclusionSlot||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.params,e)}}class Ume extends zme{constructor(e){super(l(a({},e),{output:4}))}}function Gme(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),h=l+r[0]+2*s,c=i-s-(a[1]>0?r[1]*a[1]:0),u=c+r[1]+2*s;if(o.textureIsSignedDistanceField){const e=o.distanceFieldBoundingBox;l+=r[0]*e[0],c+=r[1]*e[1],h-=r[0]*(1-e[2]),u-=r[1]*(1-e[3]),l-=n,h+=n,c-=n,u+=n}return e[0]>l&&e[0]<h&&e[1]>c&&e[1]<u}const Bme={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},qme=[0,0],Hme=[0,0,0],Wme=[0,0,0],$me=NS(),Jme=[0,0,0],Xme=[0,0,0],Kme=[1,0,0,0,1,0,0,0,1],Yme=[1,0,0,0,1,0,0,0,1],Zme=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Qme=[0,0,0],eve={normal:Jme,cosAngle:0},tve=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ive=1,rve=2,sve=[0,0],nve=ym(0,0,1),ove=a({texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:nK(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1},Zde),ave=Jle().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2");class lve{constructor(e){this.material=e,this.vertexBufferLayout=ave}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return 6*e.indices.get("position").length}write(e,t,i,r){fme(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,i.position,r,6),yme(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,i.normal,r,6);{const e=t.vertexAttributes.get("uv0").data;let s,n,o,a;if(null==e||e.length<4){const e=this.material.params;s=0,n=0,o=e.texCoordScale[0],a=e.texCoordScale[1]}else s=e[0],n=e[1],o=e[2],a=e[3];o=Math.min(1.99999,o+1),a=Math.min(1.99999,a+1);const l=t.indices.get("position").length,h=i.uv0;let c=r;for(let t=0;t<l;++t)h.set(c,0,s),h.set(c,1,n),c+=1,h.set(c,0,o),h.set(c,1,n),c+=1,h.set(c,0,o),h.set(c,1,a),c+=1,h.set(c,0,o),h.set(c,1,a),c+=1,h.set(c,0,s),h.set(c,1,a),c+=1,h.set(c,0,s),h.set(c,1,n),c+=1}mme(t.indices.get("color"),t.vertexAttributes.get("color").data,4,i.color,r,6);{const e=t.indices.get("size"),s=t.vertexAttributes.get("size").data,n=e.length,o=i.size;let a=r;for(let t=0;t<n;++t){const i=s[2*e[t]],r=s[2*e[t]+1];for(let e=0;e<6;++e)o.set(a,0,i),o.set(a,1,r),a+=1}}t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&dme(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,i.auxpos1,r,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&dme(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,i.auxpos2,r,6)}}class hve{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=ese(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=ese(1,1,1,1),this._elevationInfo=null,this.resources=new qye({view:e.view,createResources:e=>this.createResources(e),recreateGeometry:(e,t)=>(e.geometry=this.recreateGeometry(t,e.material),m(e.geometry)?[e.geometry]:[])});let t=!0;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.resources.destroy()}get visible(){return this.resources.visible}set visible(e){this.resources.visible=e}get attached(){return this.resources.attached}set attached(e){this.resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?m(this.resources)&&this.resources.recreate():this.updateSizeAttribute()}}get color(){return this._color}set color(e){Bre(e,this._color)||(Are(this._color,e),this.updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this.updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,m(this.resources)&&this.resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this.updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Bre(e,this._outlineColor)||(Are(this._outlineColor,e),this.updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}updateMaterial(){const e=this.resources.resources;v(e)||e.material.setParameterValues(this.materialParameters(e.texture.id))}updateSizeAttribute(){const e=this.resources.resources,t=this.resources.object;if(v(e)||v(t))return;const i=e.geometry;if(v(i))return;const r=i.getMutableAttribute("size").data,s=this.geometrySize;r[0]=s,r[1]=s,t.geometryVertexAttrsUpdated(0)}materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:uve,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get geometrySize(){return this._size/cve}recreateGeometry(e,t){const i=this.createRenderGeometry();return m(i)&&e.addGeometry(i,t),i}createResources(e){const t=this.createTexture(),i=new Nme(this.materialParameters(t.id)),r=this.recreateGeometry(e,i);return{material:i,texture:t,geometry:r,forEach(e){e(t),e(i),m(this.geometry)&&e(this.geometry)}}}get preferredTextureSize(){return mv(gv(2*this.geometrySize),16,128)}createTexture(){const e=this.preferredTextureSize;return new lme(function(e,t,i){switch(e){case"circle":return Rge(t,i);case"square":return Dge(t,i);case"cross":return jge(t,i);case"x":return Nge(t,i);case"kite":return Fge(t,i);case"triangle":return zge(t,i);default:return Rge(t,i)}}(this._primitive,e,e*cve),{mipmap:!1,wrap:{s:33071,t:33071},width:e,height:e,components:4,noUnpackFlip:!0})}calculateMapBounds(e){if(v(this.resources.resources)||v(this.resources.resources.geometry))return!1;return PZ(this.resources.resources.geometry.vertexAttributes.get("position").data,this.view.renderCoordsHelper.spatialReference,pve,this.view.spatialReference),Hte(e,pve),!0}createRenderGeometry(){const e=this.geometry;if(v(e))return null;const{renderCoordsHelper:t,elevationProvider:i}=this.view,r=gge(e,i,Lge.fromElevationInfo(this.elevationInfo),t),s=Fm(Jse.get(),e.x,e.y,r),n=Jse.get();PZ(s,e.spatialReference,n,t.spatialReference);const o=this.geometrySize;return Hde.createPointGeometry(null,n,null,[o,o],[0,0,0,1])}}const cve=.5,uve=[cve/2,cve/2,1-cve/2,1-cve/2],pve=[0,0,0],dve=Jle().vec3f("position"),fve=Jle().vec3f("position").vec2f("uv0"),yve=Jle().vec3f("position").vec4u8("color");class gve{constructor(e){this.vertexBufferLayout=e}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get("position").length}write(e,t,i,r){vme(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,r)}}function mve(e,t){t.linearDepth?e.vertex.code.add(_ce`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(_ce`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}function vve(e,t){t.attributeColor?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(_ce`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(_ce`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(_ce`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function bve(e){const t=new Ace,i=1===e.output;return t.include(mve,{linearDepth:i}),t.include(vve,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),i&&(t.include(Ufe,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add(_ce`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?_ce`transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);`:_ce`transformPosition(proj, view, vpos);`}
    }
  `),t.include(tfe,e),t.fragment.include($fe),e.multipassTerrainEnabled&&(t.fragment.include(Sce),t.include(hfe,e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(afe),t.fragment.code.add(_ce`
  void main() {
    discardBySlice(vpos);
    ${e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 color = ${e.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${_ce.float(Hfe)}) {
      discard;
    }

    ${7===e.output?_ce`gl_FragColor = vec4(color.a);`:""}

    ${0===e.output?_ce`gl_FragColor = highlightSlice(color, vpos); ${e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===e.output?_ce`outputHighlight();`:""};
    ${1===e.output?_ce`outputDepth(linearDepth);`:""};
  }
  `),t}var wve=Object.freeze({__proto__:null,build:bve});class _ve extends Kle{initializeProgram(e){const t=_ve.shader.get(),i=this.configuration,r=t.build({output:i.output,OITEnabled:0===i.transparencyPassType,attributeColor:i.vertexColors,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new wce(e.rctx,r,nue)}bindPass(e,t){mfe(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&lfe(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),cfe(this.program,t))}bindDraw(e){wfe(this.program,e),this.program.rebindTextures(),ife(this.program,this.configuration,e)}setPipelineState(e,t){const i=this.configuration,r=3===e,s=2===e;return mhe({blending:0!==i.output&&7!==i.output||!i.transparent?null:r?Sfe:Ife(e),culling:ohe(i.cullFace),depthTest:{func:Ofe(e)},depthWrite:r||s?i.writeDepth&&ahe:null,colorWrite:lhe,stencilWrite:i.sceneHasOcludees?Rfe:null,stencilTest:i.sceneHasOcludees?t?jfe:Ffe:null,polygonOffset:r||s?i.polygonOffset&&xve:Cfe(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}_ve.shader=new Xle(wve,(()=>import("./ColorMaterial.glsl.ac73bba4.js")));const xve={factor:1,units:1};class Sve extends Yle{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}Q([Zle({count:8})],Sve.prototype,"output",void 0),Q([Zle({count:3})],Sve.prototype,"cullFace",void 0),Q([Zle()],Sve.prototype,"slicePlaneEnabled",void 0),Q([Zle()],Sve.prototype,"vertexColors",void 0),Q([Zle()],Sve.prototype,"transparent",void 0),Q([Zle()],Sve.prototype,"polygonOffset",void 0),Q([Zle()],Sve.prototype,"enableOffset",void 0),Q([Zle()],Sve.prototype,"writeDepth",void 0),Q([Zle()],Sve.prototype,"sceneHasOcludees",void 0),Q([Zle({count:4})],Sve.prototype,"transparencyPassType",void 0),Q([Zle()],Sve.prototype,"multipassTerrainEnabled",void 0),Q([Zle()],Sve.prototype,"cullAboveGround",void 0);class Mve extends Kde{constructor(e){super(e,Ive),this.supportsEdges=!0,this.techniqueConfig=new Sve}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.polygonOffset=this.params.polygonOffset,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<5e5,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}getPassParameters(){return this.params}intersect(e,t,i,r,s,n,o){Wue(e,t,r,s,n,void 0,o)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.params.writeLinearDepth?new Tve(e):void 0}createBufferWriter(){return new gve(yve)}}class Tve extends Xde{constructor(e){super(e),this.updateParameters()}updateParameters(e){this._technique=this._techniqueRep.releaseAndAcquire(_ve,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){return 4===this._output?3===e:e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&this._material.setParameterValues({sceneHasOcludees:e.hasOccludees})}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this._technique.bindPass(this._material.getPassParameters(),e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const Ive=a({color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1},Zde);class Eve extends sde{constructor(e){super(e),this._handles=new Mh,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=[0,0,0],this._up=[0,0,0],this._right=[0,0,0],this._renderOccluded=4,this._color=fae(1,0,0,1),this._outlineColor=fae(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Are(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Are(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:i}){this._maxSize=Math.min(Bm(t,e),Bm(t,i))/3,$m(this._up,Nm(this._up,e,t)),$m(this._right,Nm(this._right,i,t)),Dm(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new Mve(this.quadMaterialParameters),this._outlineMaterial=new tye(this.outlineMaterialParameters),this._handles.add(this.view.state.watch("camera",(()=>this._updateTransform())))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(0===this._outlineSize)return;const t=jm(Jse.get(),this._up,this._right),i=Hde.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);nY(Ave),hY(Ave,Ave,this._position),cY(Ave,Ave,[r,r,r]),m(e)&&(e.transformation=Ave)}_quadGeometryData(e,t){const i=jm(Jse.get(),e,t);return new Fde([["position",{size:3,data:[0,0,0,...t,...e,...i],exclusive:!0}]],[["position",new Uint16Array([0,1,2,1,2,3])]])}get quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameterValues(this.quadMaterialParameters)}get outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameterValues(this.outlineMaterialParameters)}}const Ave=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class Pve extends gre{visualizeIntersectionPoint(e,t){const{coordinateHelper:i,elevationInfo:r,view:s}=t;return Mr(new hve({view:s,primitive:"circle",geometry:i.createPoint(e.intersectionPoint),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:Rv.toUnitRGBA(tre.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{coordinateHelper:i,elevationInfo:r,view:s}=t;return Mr(new hve({view:s,primitive:"circle",geometry:i.createPoint(e.point),elevationInfo:r,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:Rv.toUnitRGBA(tre.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{coordinateHelper:i,elevationInfo:r,view:s}=t;return Mr(this.createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,r,s,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{coordinateHelper:i,elevationInfo:r,view:s}=t,n=nre(e.lineStart,i,r,t.view),o=nre(e.lineEnd,i,r,t.view),a=Km(o,n,o,.5),l=new jye({view:s,attached:!1,offset:tre.parallelLineHintOffset,length:tre.parallelLineHintLength,width:tre.parallelLineHintWidth,color:Rv.toUnitRGBA(tre.orange),location:a,renderOccluded:16});return l.setDirectionFromPoints(n,a),l.attached=!0,Mr(l)}visualizeRightAngleQuad(e,t){const{coordinateHelper:i,elevationInfo:r,view:s}=t;return Mr(new Eve({view:s,attached:!0,color:Rv.toUnitRGBA(tre.orange),renderOccluded:2,outlineRenderOccluded:16,outlineColor:Rv.toUnitRGBA(tre.orange),outlineSize:tre.rightAngleHintOutlineSize,size:tre.rightAngleHintSize,geometry:{previous:nre(e.previousVertex,i,r,s),center:nre(e.centerVertex,i,r,s),next:nre(e.nextVertex,i,r,s)}}))}createLineSegmentHintFromMap(e,t,i,r,s,n,o=!0,a=!0){const l=[0,0,0],h=[0,0,0];return function(e,t,i,r,s,n,o){const a=i.toXYZ(e),l=i.toXYZ(t),h=Pte(s,a,i.spatialReference,r),c=Pte(s,l,i.spatialReference,r),u=(null==h?c:null==c?h:Math.min(h,c))||0;a[2]=u,l[2]=u,s.renderCoordsHelper.toRenderCoords(a,i.spatialReference,n),s.renderCoordsHelper.toRenderCoords(l,i.spatialReference,o)}(t,i,r,s,n,l,h),this.createLineSegmentHint(e,n,l,h,o,a)}createLineSegmentHint(e,t,i,r,s=!0,n=!0){const o=new Cye({view:t,extensionType:3,start:i,end:r,color:Rv.toUnitRGBA(tre.orange),renderOccluded:16});switch(e){case 0:o.width=tre.lineHintWidthTarget,o.fadedExtensions={start:0,end:tre.lineHintFadedExtensions};break;case 2:o.width=tre.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case 1:o.width=tre.lineHintWidthReference,o.fadedExtensions={start:s?tre.lineHintFadedExtensions:0,end:n?tre.lineHintFadedExtensions:0}}return o.attached=!0,o}}class Cve{constructor({grabbableForEvent:e}){this.events=new sh,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=e}intersectionDistance(e,t){return 0}attach(){}detach(){}}const Ove=["freehand","hybrid","click"],kve="click";let Lve=class extends(sh.EventedMixin(Jv)){constructor(e){super(e),this._manipulator=null,this._stagedVertex=null,this.elevationInfo=null,this.snapToSceneEnabled=null,this._handles=new Mh,this._snappingPipeline=new uae,this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingTask=null}set drawingMode(e){this._set("drawingMode",null!=e?e:kve)}get updating(){return this.updatingHandles.updating}get isCompleted(){return this._createOperationCompleted}get _snappingEnabled(){return m(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}initialize(){var e,t;this.coordinateHelper=bse(this.hasZ,this.hasM,this.view.spatialReference,this.view.viewingMode);const i=null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler;this._frameTask=i?i.registerTask(iae.SNAPPING):hae,this._editGeometry=new woe(new Tse(this.coordinateHelper),"segment"===this.geometryType?"polyline":this.geometryType),this._activeComponent=new Mse(this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent),this._editGeometry.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.toArray(e.pos)}))),i=t.map((e=>e.coordinates));switch(e.type){case"vertex-add":this.emit(e.type,l(a({},e),{added:i,vertices:t}));break;case"vertex-update":this.emit(e.type,l(a({},e),{updated:i,vertices:t}));break;case"vertex-remove":this.emit(e.type,l(a({},e),{removed:i,vertices:t}))}})),this._manipulator=new Cve({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType;const r=this.createManipulatorDragPipeline(this._manipulator),s=this._manipulator.events.on("immediate-double-click",(e=>{this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())})),n=this._manipulator.events.on("immediate-click",(e=>{if(this._manipulator.dragging)return;const t=this._activeComponent;if(m(this._closeOnClickVertexIndex(e.screenPoint)))this.discardStagedVertex(),this.complete();else{const i=this._screenToMap(e.screenPoint);if(m(i))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(i)),this.complete());break;case"click":case"hybrid":this._snappingTask=E(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(i)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}}e.stopPropagation()}));this._handles.add([r,n,s])}createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this.createManipulatorDragPipelineClick(e);case"freehand":return this.createManipulatorDragPipelineFreehand(e);case"hybrid":return this.createManipulatorDragPipelineHybrid(e)}}createManipulatorDragPipelineClick(e){return Voe(e,((e,t,i,r)=>{const s="touch"===r&&this._snappingEnabled;!this.isCompleted&&s&&(t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||s&&0===this.numVertices)&&this.commitStagedVertex()),e))).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>s,cancel:i,snappingManager:this.snappingManager,snappingContext:new _oe({geometry:this._editGeometry,elevationInfo:this.elevationInfo,pointer:r,visualizer:new Pve}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((e=>(s&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e))),i.next((()=>{s&&m(this.snappingManager)&&this.snappingManager.doneSnapping()})))}))}createManipulatorDragPipelineFreehand(e){return Voe(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}createManipulatorDragPipelineHybrid(e){return Voe(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}destroy(){this._handles.destroy(),this._handles=null,this._editGeometry.destroy(),this._frameTask.remove()}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}get canRedo(){return this._editGeometry.canRedo}redo(){this._editGeometry.redo()}get canUndo(){return this._editGeometry.canUndo}undo(){m(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometry.undo()}complete(e=!1){E(this._snappingTask),m(this.snappingManager)&&this.snappingManager.doneSnapping(),"polyline"===this.geometryType||"polygon"===this.geometryType?this.discardStagedVertex():this.commitStagedVertex();const t="polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!t,(this.isCompleted||e)&&this.emit("complete",{vertices:this.vertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:e,type:"complete"})}cancel(){this.complete(!0)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get numVertices(){return m(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get numCommittedVertices(){return this._activeComponent.vertices.length}get vertices(){const e=this.committedVertices;return m(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.toArray(e.pos)))}get spatialReference(){return this.view.spatialReference}get hasStagedVertex(){return m(this._stagedVertex)}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if(v(e))this.discardStagedVertex();else{if(v(this._stagedVertex))this._stagedVertex=H(e);else{if(Fie(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}commitStagedVertex(){if(this._snappingTask=E(this._snappingTask),m(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometry.appendVertex(this.coordinateHelper.fromPoint(e))}}discardStagedVertex(){this._stagedVertex=null}_onPointerMove(e){if(E(this._snappingTask),this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=FS(e.x,e.y),i=this._closeOnClickVertexIndex(t);if(m(i)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.toArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const i=this._screenToMap(t);if(this._manipulator.cursor=m(i)?"crosshair":null,m(i))if(m(this.snappingManager)){const t=this.snappingManager,r=new _oe({geometry:this._editGeometry,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:new Pve});this.stagedVertex=t.update(i,r),this._snappingTask=xt((async e=>{const s=await this._frameTask.schedule((()=>t.snap(i,r,e)),e);s.valid&&await this._frameTask.schedule((()=>{this.stagedVertex=s.apply()}),e)})),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=i}e.stopPropagation()}_onHold(e){E(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),v(e))return null;const i=this._screenToMap(t.screenEnd);return m(i)?l(a({},t),{mapStart:e,mapEnd:i}):null}}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_getDrawSurface(){if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;m(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),m(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),m(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);const i=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&i>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.sceneDrawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(e);return!!m(i)&&function(e,t,i){const r=e.x-t.x,s=e.y-t.y;return r*r+s*s<=i}(i,t,25)}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[0].pos,Rve),e))return 0;if(this._vertexWithinPointerDistance(this.coordinateHelper.toPoint(t.vertices[t.vertices.length-1].pos,Rve),e))return t.vertices.length-1}return null}};Q([ro({constructOnly:!0})],Lve.prototype,"view",void 0),Q([ro({value:kve})],Lve.prototype,"drawingMode",null),Q([ro({constructOnly:!0})],Lve.prototype,"geometryType",void 0),Q([ro({constructOnly:!0})],Lve.prototype,"elevationInfo",void 0),Q([ro()],Lve.prototype,"snapToSceneEnabled",void 0),Q([ro({constructOnly:!0})],Lve.prototype,"manipulators",void 0),Q([ro({constructOnly:!0})],Lve.prototype,"hasZ",void 0),Q([ro({constructOnly:!0})],Lve.prototype,"hasM",void 0),Q([ro()],Lve.prototype,"defaultZ",void 0),Q([ro({constructOnly:!0})],Lve.prototype,"sceneDrawSurface",void 0),Q([ro({constructOnly:!0})],Lve.prototype,"elevationDrawSurface",void 0),Q([ro({constructOnly:!0})],Lve.prototype,"snappingManager",void 0),Q([ro({readOnly:!0})],Lve.prototype,"updating",null),Lve=Q([Ro("esri.views.3d.interactive.editingTools.draw3D.DrawOperation")],Lve);const Rve=new il({x:0,y:0,z:0});class Dve{constructor(e,t,i,r=null){this.elevationInfo=e,this.defaultZ=t,this.view=i,this.excludeGraphics=r}screenToMap(e){if(m(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen(jS(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen(jS(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return m(t)&&(t.z=void 0),t}mapToScreen(e){const t=Vie(e.x,e.y,Ate(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class Fve{constructor(e,t,i=[]){this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return m(t)&&(t.z=Ete(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return m(this.elevationInfo)&&(t=Vie(e.x,e.y,Ate(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}class jve{constructor(){this._isToolEditable=!0,this._manipulators=new xh,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){return this.addMany([e],t)[0]}addMany(e,t=0){return e.map((e=>{const i=this._nextManipulatorId++,r={id:i,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(r),this._attached&&this._updateManipulatorAttachment(r),i}))}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).manipulator===t){const e=this._manipulators.splice(i,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this._manipulators.forEach((({manipulator:e})=>{e.destroy&&e.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,r=Number.MAX_VALUE;return this._manipulators.forEach((({id:s,manipulator:n,attached:o})=>{if(!o||!n.interactive)return;const a=n.intersectionDistance(e,t);m(a)&&a<r&&(r=a,i={id:s,manipulator:n})})),i}findById(e){if(v(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)}}let Nve=class extends jo{constructor(e){super(e),this.toolState="pending",this.attached=!1,this.created=!1,this.completed=!1,this.manipulators=new jve,this.updating=!1,this._editableFlags=new Array,this._creationStartedResolver=_t(),this._creationFinishedResolver=_t()}get active(){return null!=this.view&&this.view.activeTool===this}get isSupported(){return!0}set visible(e){this._set("visible",e),e||vJ(this,!1),this.attached&&(e?this._show():this._hide())}get editable(){return this.hasEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}attach(){!this.attached&&this.isSupported&&(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}detach(){this.attached&&(this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1))}handleInputEvent(e){this.attached&&this.onInputEvent(e)}handleInputEventAfter(e){this.attached&&this.onInputEventAfter(e)}destroy(){switch(this.toolState){case"pending":break;case"creating":case"created":this.manipulators.destroy()}this.toolState="destroyed",this._set("view",null),this._set("created",!1),this._set("completed",!1)}setEditableFlag(e,t){this._editableFlags[e]=t,this.manipulators.isToolEditable=this._editableFlags.every((e=>null==e||e)),this._updateManipulatorAttachment(),0===e&&this.notifyChange("editable"),this.onEditableChange()}hasEditableFlag(e){const t=this._editableFlags[e];return null==t||t}whenCreationStarted(){return this._creationStartedResolver.promise}when(){return this._creationFinishedResolver.promise}rejectCreation(e){switch(this.toolState){case"pending":case"creating":this._creationStartedResolver.resolve(this)}this._creationFinishedResolver.reject(e)}initialize(){}onAttach(){}onDetach(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.hasEditableFlag(0)&&this.hasEditableFlag(1)}startToolCreation(){switch(this.toolState){case"pending":this._creationStartedResolver.resolve(this),this.toolState="creating";break;case"creating":case"created":case"destroyed":default:throw new Error(`unexpected tool state ${this.toolState}`)}}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||(this._set("created",!0),this._creationFinishedResolver.resolve(this)),this.toolState="created";break;case"created":if(!this.created)throw new Error(`expected this.created to match toolstate ${this.toolState}`);break;case"destroyed":default:throw new Error(`unexpected tool state ${this.toolState}`)}}complete(){this.finishToolCreation(),this._set("completed",!0)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()}};Q([ro()],Nve.prototype,"toolState",void 0),Q([ro({constructOnly:!0})],Nve.prototype,"view",void 0),Q([ro({readOnly:!0})],Nve.prototype,"active",null),Q([ro({value:!0})],Nve.prototype,"visible",null),Q([ro({value:!0})],Nve.prototype,"editable",null),Q([ro({readOnly:!0})],Nve.prototype,"attached",void 0),Q([ro({readOnly:!0})],Nve.prototype,"created",void 0),Q([ro({readOnly:!0})],Nve.prototype,"completed",void 0),Q([ro({readOnly:!0})],Nve.prototype,"manipulators",void 0),Q([ro({readOnly:!0})],Nve.prototype,"updating",void 0),Nve=Q([Ro("esri.views.interactive.InteractiveToolBase")],Nve);let zve=class extends(sh.EventedMixin(Nve)){constructor(e){super(e),this.drawOperation=null,this.hasZ=!0,this.defaultZ=0,this.elevationInfo=null,this.snapToScene=null,this.mode=null,this.geometryType=null,this.type="draw-3d"}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}initialize(){const e=S(this.elevationInfo,{mode:this.hasZ?"absolute-height":"on-the-ground",offset:0});this.drawOperation=new Lve({view:this.view,manipulators:this.manipulators,geometryType:this.geometryType,drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,sceneDrawSurface:new Fve(this.view,e),elevationDrawSurface:new Dve(e,this.defaultZ,this.view),hasM:!1,elevationInfo:e}),this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e))),this.complete()}destroy(){this.drawOperation.destroy(),this.drawOperation=null,this._set("view",null)}onInputEvent(e){this.drawOperation.onInputEvent(e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}reset(){}get canRedo(){return this.drawOperation.canRedo}redo(){this.drawOperation.redo()}get canUndo(){return this.drawOperation.canUndo}undo(){this.drawOperation.undo()}completeCreateOperation(){this.drawOperation.complete()}activate(){}deactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}getVertexCoords(){return this.drawOperation.vertices}onVertexAdd(e){this.emit("vertex-add",e)}onVertexRemove(e){this.emit("vertex-remove",e)}onVertexUpdate(e){this.emit("vertex-update",e)}onCursorUpdate(e){this.emit("cursor-update",e)}onComplete(e){this.emit("complete",e)}};Q([ro()],zve.prototype,"drawOperation",void 0),Q([ro({readOnly:!0})],zve.prototype,"updating",null),Q([ro({constructOnly:!0,nonNullable:!0})],zve.prototype,"view",void 0),Q([ro({value:!0})],zve.prototype,"enabled",null),Q([ro({constructOnly:!0})],zve.prototype,"hasZ",void 0),Q([ro({constructOnly:!0,nonNullable:!0})],zve.prototype,"defaultZ",void 0),Q([ro({constructOnly:!0})],zve.prototype,"elevationInfo",void 0),Q([ro()],zve.prototype,"snapToScene",void 0),Q([ro({constructOnly:!0})],zve.prototype,"mode",void 0),Q([ro({constructOnly:!0})],zve.prototype,"geometryType",void 0),Q([ro({readOnly:!0})],zve.prototype,"type",void 0),zve=Q([Ro("esri.views.3d.interactive.editingTools.draw.DrawTool")],zve);let Vve=class extends Ioe{constructor(e){super(e),this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new Mh}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get coordinates(){return br(Ne.getLogger("esri.views.draw.PointDrawAction"),"coordinates",{replacement:"vertices",version:"4.19"}),this.vertices[0]}complete(){"2d"===this.view.type?this._cursorScreenPoint&&this._completeDrawing():this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=wJ(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),iH.TOOL),this.view.on("pointer-move",(e=>{this._snappingTask=E(this._snappingTask),this._cursorScreenPoint=wJ(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),iH.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._addVertexOnPointerUp=!1)}),iH.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=E(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp)e.stopPropagation(),this._vertexAddHandler(e);else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),iH.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),iH.TOOL),this.view.on("key-down",(e=>{e.key===Ooe.complete&&this._cursorScreenPoint&&(this._snappingTask=E(this._snappingTask),this._vertexAddHandler(e))}),iH.TOOL)])}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new zve({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"point",mode:"click"}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Poe(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new Coe(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){m(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e){const t=this._coordinateHelper.fromArray(e);this._isDuplicateOfLastVertex(t)||(this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(t),this.notifyChange("vertices"),this._completeDrawing())}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(m(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new Poe(this.view,e,this._activeComponent.vertices.length,this.vertices,m(this._stagedVertex)?new il(this._stagedVertex):null);this.emit("cursor-update",t()),m(this._snappingTask)&&this._snappingTask.promise.then((e=>{e.valid&&this.emit("cursor-update",t())}),(()=>{}))}}_completeDrawing(e){this._activePointerId=null,this._popCursorVertex(),this._snappingTask=E(this._snappingTask),m(this._snappingManager)&&this._snappingManager.doneSnapping();const t=new Coe(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(v(this._activePointerId)||this._activePointerId===e.pointerId)}};Q([ro({readOnly:!0})],Vve.prototype,"coordinates",null),Vve=Q([Ro("esri.views.draw.PointDrawAction")],Vve);let Uve=class extends Ioe{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new Mh,this._undoRedoHandles=new Mh,this.mode=kve}initialize(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}getGeometryZValue(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation()}),iH.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=wJ(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),iH.TOOL),this.view.on("pointer-move",(e=>{this._snappingTask=E(this._snappingTask),this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._cursorScreenPoint=wJ(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),iH.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._cursorScreenPoint=wJ(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),iH.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=E(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),iH.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&m(this._activePointerId)&&!this._panEnabled&&e.stopPropagation()}),iH.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),iH.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),iH.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),iH.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===Ooe.vertexAdd&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._snappingTask=E(this._snappingTask),this._vertexAddHandler(e)):t!==Ooe.complete||i?t!==Ooe.undo||this.interactiveUndoDisabled||i?t!==Ooe.redo||this.interactiveUndoDisabled||i?t!==Ooe.pan||i||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),iH.TOOL),this.view.on("key-up",(e=>{e.key===Ooe.pan&&(e.stopPropagation(),this._panEnabled=!1)}),iH.TOOL)])}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const i=[...this._committedVertices];m(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new Aoe(this.view,t,e.vertices[0].index,i))}})),this._editGeometry.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,i=new Eoe(this.view,e,t,this.vertices);this.emit("vertex-add",i),i.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const i=[...this._committedVertices];m(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new Eoe(this.view,t,e.vertices[0].index,i))}}))])}_removeViewHandles(){this._viewHandles.removeAll()}_removeUndoRedoHandles(){this._undoRedoHandles.removeAll()}_addDrawTool(e){this._drawTool=new zve({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polygon",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new Eoe(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Poe(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new Coe(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){m(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);const r=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(r)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(m(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new Poe(this.view,e,this._activeComponent.vertices.length,this.vertices,m(this._stagedVertex)?new il(this._stagedVertex):null);this.emit("cursor-update",t()),m(this._snappingTask)&&this._snappingTask.promise.then((e=>{e.valid&&this.emit("cursor-update",t())}),(()=>{}))}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<3)return;this._snappingTask=E(this._snappingTask),m(this._snappingManager)&&this._snappingManager.doneSnapping();const t=new Coe(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(v(this._activePointerId)||this._activePointerId===e.pointerId)}};Q([ro()],Uve.prototype,"_dragEnabled",null),Q([ro()],Uve.prototype,"_clickEnabled",null),Q([ro({type:Ove})],Uve.prototype,"mode",void 0),Uve=Q([Ro("esri.views.draw.PolygonDrawAction")],Uve);let Gve=class extends Ioe{constructor(e){super(e),this._panEnabled=!1,this._popVertexOnPointerMove=!1,this._addVertexOnPointerUp=!1,this._activePointerId=null,this._viewHandles=new Mh,this._undoRedoHandles=new Mh,this.mode=kve}initialize(){"2d"===this.view.type?(this._addViewHandles(),this._addUndoRedoHandles()):this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy(),this._removeUndoRedoHandles(),this._undoRedoHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}get _clickEnabled(){return"click"===this.mode||"hybrid"===this.mode}get _dragEnabled(){return"freehand"===this.mode||"hybrid"===this.mode}undo(){super.undo(),this.notifyChange("vertices")}redo(){super.redo(),this.notifyChange("vertices")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}_addViewHandles(){this._removeViewHandles(),this._viewHandles.add([this.view.on("click",(e=>{e.stopPropagation()}),iH.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&!this._panEnabled&&(this._snappingTask=E(this._snappingTask),this._activePointerId=e.pointerId,this._addVertexOnPointerUp=!0,this._cursorScreenPoint=wJ(e),"touch"===e.pointerType&&this._updateCursor(e.native))}),iH.TOOL),this.view.on("pointer-move",(e=>{this._popVertexOnPointerMove&&(this.undo(),this._popVertexOnPointerMove=!1),this._snappingTask=E(this._snappingTask),this._cursorScreenPoint=wJ(e),"touch"!==e.pointerType&&this._updateCursor(e.native)}),iH.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._cursorScreenPoint=wJ(e),this._dragEnabled&&!this._panEnabled?this._vertexAddHandler(e):this._addVertexOnPointerUp=!1)}),iH.TOOL),this.view.on("pointer-up",(e=>{if(this._shouldHandlePointerEvent(e))if(this._snappingTask=E(this._snappingTask),this._activePointerId=null,this._addVertexOnPointerUp){if(!this._clickEnabled)return 1===this.vertices.length&&this.vertices.pop(),void this._drawCompleteHandler(e);this._vertexAddHandler(e)}else{const t="touch"===e.pointerType;this._updateCursor(e.native,t)}}),iH.TOOL),this.view.on("drag",(e=>{this._dragEnabled&&m(this._activePointerId)&&!this._panEnabled&&e.stopPropagation()}),iH.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),iH.TOOL),this.view.on("double-click",(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),iH.TOOL),this.view.on("double-click",["Control"],(e=>{e.stopPropagation(),this._drawCompleteHandler(e)}),iH.TOOL),this.view.on("key-down",(e=>{const{key:t,repeat:i}=e;t===Ooe.vertexAdd&&!i&&this._cursorScreenPoint?(e.stopPropagation(),this._snappingTask=E(this._snappingTask),this._vertexAddHandler(e)):t!==Ooe.complete||i?t!==Ooe.undo||this.interactiveUndoDisabled||i?t!==Ooe.redo||this.interactiveUndoDisabled||i?t!==Ooe.pan||i||(e.stopPropagation(),this._panEnabled=!0):(e.stopPropagation(),this.redo()):(e.stopPropagation(),this.undo()):(e.stopPropagation(),this._drawCompleteHandler(e))}),iH.TOOL),this.view.on("key-up",(e=>{e.key===Ooe.pan&&(e.stopPropagation(),this._panEnabled=!1)}),iH.TOOL)])}_addUndoRedoHandles(){this._removeUndoRedoHandles(),this._undoRedoHandles.add([this._editGeometry.on("vertex-remove",(e=>{if(this.notifyChange("vertices"),"undo"===e.operation){const t=this._nativeEventHistory.undoStack.pop();this._nativeEventHistory.redoStack.push(t);const i=[...this._committedVertices];m(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("undo",new Aoe(this.view,t,e.vertices[0].index,i))}})),this._editGeometry.on("vertex-add",(e=>{if(this.notifyChange("vertices"),"apply"===e.operation){const e=this._nativeEventHistory.undoStack[this._nativeEventHistory.undoStack.length],t=this._committedVertices.length-1,i=new Eoe(this.view,e,t,this.vertices);this.emit("vertex-add",i),i.defaultPrevented&&(this._popVertexOnPointerMove=!0)}else if("redo"===e.operation){const t=this._nativeEventHistory.redoStack.pop();this._nativeEventHistory.undoStack.push(t);const i=[...this._committedVertices];m(this._stagedVertex)&&i.push(this._coordinateHelper.pointToArray(this._stagedVertex)),this.emit("redo",new Eoe(this.view,t,e.vertices[0].index,i))}}))])}_removeViewHandles(){this._viewHandles.removeAll()}_removeUndoRedoHandles(){this._undoRedoHandles.removeAll()}_addDrawTool(e){this._drawTool=new zve({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"polyline",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new Eoe(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Poe(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new Coe(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){m(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool=M(this._drawTool))}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i);const r=t||new Event("placeholder");this._nativeEventHistory.undoStack.push(r)}_updateCursor(e,t=!1){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const i=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(m(i)&&!t){this._pushCursorVertex(i.vertex);const t=()=>new Poe(this.view,e,this._activeComponent.vertices.length,this.vertices,m(this._stagedVertex)?new il(this._stagedVertex):null);this.emit("cursor-update",t()),m(this._snappingTask)&&this._snappingTask.promise.then((e=>{e.valid&&this.emit("cursor-update",t())}),(()=>{}))}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._committedVertices.length<2)return;this._snappingTask=E(this._snappingTask),m(this._snappingManager)&&this._snappingManager.doneSnapping();const t=new Coe(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(v(this._activePointerId)||this._activePointerId===e.pointerId)}};function Bve(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function qve(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Am?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function Hve(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],h=i[2],c=i[3];return e[0]=r*c+o*a+s*h-n*l,e[1]=s*c+o*l+n*a-r*h,e[2]=n*c+o*h+r*l-s*a,e[3]=o*c-r*a-s*l-n*h,e}function Wve(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,h,c,u,p,d=i[0],f=i[1],y=i[2],g=i[3];return h=s*d+n*f+o*y+a*g,h<0&&(h=-h,d=-d,f=-f,y=-y,g=-g),1-h>Am?(l=Math.acos(h),c=Math.sin(l),u=Math.sin((1-r)*l)/c,p=Math.sin(r*l)/c):(u=1-r,p=r),e[0]=u*s+p*d,e[1]=u*n+p*f,e[2]=u*o+p*y,e[3]=u*a+p*g,e}function $ve(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function Jve(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Xve(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);const s=(i+1)%3,n=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*n+n]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*s+n]-t[3*n+s])*r,e[s]=(t[3*s+i]+t[3*i+s])*r,e[n]=(t[3*n+i]+t[3*i+n])*r}return e}function Kve(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),h=Math.sin(r),c=Math.cos(r);return e[0]=n*l*c-o*a*h,e[1]=o*a*c+n*l*h,e[2]=o*l*h-n*a*c,e[3]=o*l*c+n*a*h,e}Q([ro()],Gve.prototype,"_clickEnabled",null),Q([ro()],Gve.prototype,"_dragEnabled",null),Q([ro({type:Ove})],Gve.prototype,"mode",void 0),Gve=Q([Ro("esri.views.draw.PolylineDrawAction")],Gve);const Yve=Are,Zve=Pre,Qve=Cre,ebe=Hve,tbe=Rre,ibe=Vre,rbe=Ure,sbe=jre,nbe=sbe,obe=Nre,abe=obe,lbe=zre,hbe=Bre,cbe=qre;function ube(e,t,i){const r=Jm(t,i);return r<-.999999?(Xm(pbe,dbe,t),uv(pbe)<1e-6&&Xm(pbe,fbe,t),$m(pbe,pbe),Bve(e,pbe,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Xm(pbe,t,i),e[0]=pbe[0],e[1]=pbe[1],e[2]=pbe[2],e[3]=1+r,lbe(e,e))}const pbe=[0,0,0],dbe=ym(1,0,0),fbe=ym(0,1,0);const ybe=[0,0,0,1],gbe=[0,0,0,1];const mbe=[1,0,0,0,1,0,0,0,1];function vbe(e,t,i=null){return m(i)?[e,t,i]:[e,t]}function bbe(e,t,i=null){return m(i)?{x:e,y:t,z:i}:{x:e,y:t}}Object.freeze({__proto__:null,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:Bve,getAxisAngle:qve,multiply:Hve,rotateX:function(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e},rotateY:function(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e},rotateZ:function(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e},calculateW:function(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e},slerp:Wve,random:function(e){const t=Pm(),i=Pm(),r=Pm(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e},invert:$ve,conjugate:Jve,fromMat3:Xve,fromEuler:Kve,str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},copy:Yve,set:Zve,add:Qve,mul:ebe,scale:tbe,dot:ibe,lerp:rbe,length:sbe,len:nbe,squaredLength:obe,sqrLen:abe,normalize:lbe,exactEquals:hbe,equals:cbe,rotationTo:ube,sqlerp:function(e,t,i,r,s,n){return Wve(ybe,t,s,n),Wve(gbe,i,r,n),Wve(e,ybe,gbe,2*n*(1-n)),e},setAxes:function(e,t,i,r){const s=mbe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],lbe(e,Xve(e,s))}});class wbe{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return L(e.map((e=>this.mapToLocal(e))))}get doUnnormalization(){return!1}}class _be extends wbe{constructor(e,t,i=null){super(t),this.defaultZ=i,this.transform=[1,0,0,1,0,0],this.transformInv=[1,0,0,1,0,0],this.transform=IX(e),yX(this.transformInv,this.transform)}makeMapPoint(e,t){return vbe(e,t,this.defaultZ)}mapToLocal(e){return bbe(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return vbe(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class xbe extends wbe{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=[0,0,0],this.tangentFrameUpWS=[0,0,0],this.tangentFrameRightWS=[0,0,0],this.tangentFrameForwardWS=[0,0,0],this.localFrameRightWS=[0,0,0],this.localFrameUpWS=[0,0,0],this.worldToLocalTransform=[0,0,0,1],this.localToWorldTransform=[0,0,0,1],this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);const r=[0,0,0];Um(r,this.tangentFrameForwardWS,Jm(i,this.tangentFrameForwardWS)),Nm(this.localFrameRightWS,i,r),$m(this.localFrameRightWS,this.localFrameRightWS),Xm(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),ube(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),$ve(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return vbe(e,t,this.defaultZ)}mapToLocal(e){const t=[0,0,0];this.view.renderCoordsHelper.toRenderCoords(new il({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Qm(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return m(i)?bbe(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=[0,0,0];this.view.renderCoordsHelper.toRenderCoords(new il({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Qm(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return m(i)?vbe(i.x,i.y,this.defaultZ):null}}function Sbe(e,t){if("2d"===e.type)return new _be(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new il({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new il({x:t[0],y:t[1],spatialReference:e.spatialReference});return new xbe(e,i)}return null}let Mbe=class extends Ioe{constructor(e){super(e),this._isDragging=!1,this._panEnabled=!1,this._viewHandles=new Mh,this._activePointerId=null,this._addVertexOnPointerUp=!1,this.viewAlignedCoordinateSystem=null,this.mode="freehand"}initialize(){"2d"===this.view.type?this._addViewHandles():this._addDrawTool(this.view)}destroy(){"2d"===this.view.type?(this._removeViewHandles(),this._viewHandles.destroy()):this._removeDrawTool(),this.emit("destroy")}complete(){"2d"===this.view.type?this._completeDrawing():this._drawTool.completeCreateOperation()}getGeometryZValue(){return this.vertices.length>0&&this.vertices[0].length>2?this.vertices[0][2]:this._get("defaultZ")}_addViewHandles(){this._removeViewHandles(),"click"===this.mode?this._viewHandles.add(this._getClickModeViewHandles()):this._viewHandles.add(this._getDragModeViewHandles())}_getDragModeViewHandles(){return[this.view.on("immediate-click",(e=>{if(e.stopPropagation(),e.mapPoint&&!this._panEnabled){m(this.getCoordsFromScreenPoint(wJ(e)))&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}}),iH.TOOL),this.view.on("pointer-down",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._panEnabled||(this._resetGeometry(),this._addVertexOnPointerUp=!0,this._cursorScreenPoint=wJ(e),this._activePointerId=e.pointerId,this._vertexAddHandler(e),this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor(e.native)))}),iH.TOOL),this.view.on("pointer-move",(e=>{this._snappingTask=E(this._snappingTask),v(this._activePointerId)&&"touch"!==e.pointerType&&(this._cursorScreenPoint=wJ(e),this._updateCursor(e.native))}),iH.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._isDragging=!0,this._cursorScreenPoint=wJ(e),this._updateCursor(e.native))}),iH.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&this._addVertexOnPointerUp&&(this._snappingTask=E(this._snappingTask),this._activePointerId=null,this._isDragging&&this._vertexAddHandler(e),2===this._committedVertices.length&&this._drawCompleteHandler(e),this._isDragging=!1)}),iH.TOOL),this.view.on("key-down",(e=>{e.key===Ooe.complete&&this._cursorScreenPoint?(this._snappingTask=E(this._snappingTask),this._vertexAddHandler(e),this._drawCompleteHandler(e)):e.key===Ooe.pan&&(this._panEnabled=!0)}),iH.TOOL),this.view.on("key-up",(e=>{e.key===Ooe.pan&&(this._panEnabled=!1)}),iH.TOOL),this.view.on("drag",(e=>{m(this._activePointerId)&&e.stopPropagation()}),iH.TOOL),this.view.on("drag",["Shift"],(e=>{e.stopPropagation()}),iH.TOOL)]}_getClickModeViewHandles(){return[this.view.on("pointer-down",(e=>{this._snappingTask=E(this._snappingTask),this._cursorScreenPoint=wJ(e),this._activePointerId=e.pointerId,this._isDragging=!1,"touch"===e.pointerType&&this._updateCursor(e.native)}),iH.TOOL),this.view.on("pointer-move",(e=>{this._snappingTask=E(this._snappingTask),this._cursorScreenPoint=wJ(e),v(this._activePointerId)&&"touch"!==e.pointerType&&this._updateCursor(e.native)}),iH.TOOL),this.view.on("pointer-drag",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._isDragging=!0)}),iH.TOOL),this.view.on("pointer-up",(e=>{this._shouldHandlePointerEvent(e)&&(this._snappingTask=E(this._snappingTask),this._activePointerId=null,e.stopPropagation(),this._isDragging||this._vertexAddHandler(e),2!==this.vertices.length||this._isDragging||this._drawCompleteHandler(e),this._isDragging=!1)}),iH.TOOL),this.view.on("key-down",(e=>{e.key===Ooe.vertexAdd&&this._cursorScreenPoint&&(this._vertexAddHandler(e),2===this.vertices.length&&this._drawCompleteHandler(e)),e.key===Ooe.complete&&this._cursorScreenPoint&&2===this.vertices.length&&(this._vertexAddHandler(e),this._drawCompleteHandler(e))}),iH.TOOL)]}_removeViewHandles(){this._viewHandles.removeAll()}_addDrawTool(e){this._drawTool=new zve({view:e,elevationInfo:this.elevationInfo,hasZ:this.hasZ,geometryType:"segment",mode:this.mode}),this.view.toolViewManager.tools.push(this._drawTool),this.view.activeTool=this._drawTool,this._drawTool.on("vertex-add",(e=>{1===e.vertices.length&&this.emit("vertex-add",new Eoe(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("cursor-update",(e=>{1===e.vertices.length&&this.emit("cursor-update",new Poe(this.view,null,e.vertices[0].vertexIndex,this._drawTool.getVertexCoords()))})),this._drawTool.on("complete",(e=>{this.emit("draw-complete",new Coe(null,this._drawTool.getVertexCoords())),this._removeDrawTool()}))}_removeDrawTool(){m(this._drawTool)&&(this.view.tools.remove(this._drawTool),this._drawTool.destroy(),this._drawTool=null)}_addVertex(e,t){const i=this._coordinateHelper.fromArray(e);if(this._isDuplicateOfLastVertex(i))return;this._lastVertexUnsnapped=this._stagedVertexUnsnapped,this._popCursorVertex(),this._editGeometry.appendVertex(i),1===this._committedVertices.length&&(this.viewAlignedCoordinateSystem=Sbe(this.view,this._committedVertices[0]));const r=this._committedVertices.length-1,s=new Eoe(this.view,t,r,this.vertices);this.emit("vertex-add",s)}_updateCursor(e){if(this._popCursorVertex(),!this._cursorScreenPoint)return;const t=this.getCoordsAndPointFromScreenPoint(this._cursorScreenPoint);if(m(t)){this._pushCursorVertex(t.vertex);const i=()=>new Poe(this.view,e,this._activeComponent.vertices.length,this.vertices,m(this._stagedVertex)?new il(this._stagedVertex):null);this.emit("cursor-update",i()),m(this._snappingTask)&&this._snappingTask.promise.then((e=>{e.valid&&this.emit("cursor-update",i())}),(()=>{}))}}_completeDrawing(e){if(this._activePointerId=null,this._popCursorVertex(),this._cursorScreenPoint=null,this._isDragging=!1,this._snappingTask=E(this._snappingTask),m(this._snappingManager)&&this._snappingManager.doneSnapping(),this.vertices.length<1)return;const t=new Coe(e,this.vertices);this.emit("draw-complete",t),t.defaultPrevented||this._removeViewHandles()}_resetGeometry(){this._editGeometry.destroy(),this._editGeometry=new woe(new Tse(this._coordinateHelper),"polygon"),this._activeComponent=new Mse(this._editGeometry.editGeometry),this._editGeometry.editGeometry.components.push(this._activeComponent)}_shouldHandlePointerEvent(e){return function(e){return"mouse"!==e.pointerType||0===e.button}(e)&&(v(this._activePointerId)||this._activePointerId===e.pointerId)}};Q([ro({type:["freehand","click"]})],Mbe.prototype,"mode",void 0),Mbe=Q([Ro("esri/views/2d/engine/markup/SegmentDrawAction")],Mbe);let Tbe=class extends jo{constructor(){super(...arguments),this.activeAction=null,this.type="draw",this.view=null}destroy(){this.activeAction&&(this.activeAction.destroy(),this.activeAction=null)}create(e,t){this.reset();const i=a({view:this.view},t);switch(e){case"point":i.editGeometryType="point",this.activeAction=new Vve(i);break;case"polyline":i.editGeometryType="polyline",this.activeAction=new Gve(i);break;case"multipoint":i.editGeometryType="polygon",this.activeAction=new koe(i);break;case"polygon":i.editGeometryType="polygon",this.activeAction=new Uve(i);break;case"rectangle":case"circle":case"ellipse":case"triangle":i.editGeometryType="polygon",this.activeAction=new Mbe(i)}return this.activeAction}complete(){this.activeAction&&this.activeAction.complete(),this.activeAction=null}reset(){this.activeAction&&this.activeAction.destroy(),this.activeAction=null}};Q([ro()],Tbe.prototype,"activeAction",void 0),Q([ro({readOnly:!0})],Tbe.prototype,"type",void 0),Q([ro()],Tbe.prototype,"view",void 0),Tbe=Q([Ro("esri.views.draw.Draw")],Tbe);var Ibe=Tbe;let Ebe=null;async function Abe(){return Ebe||(Ebe=await import("./createUtils.7513709d.js")),Ebe}function Pbe(e,t,i){if(!t||!e||!e.map)return;const{map:r}=e,s=r.layers.find((e=>e===t));s||r.add(t,i),null!=i&&r.layers.reorder(s,i)}class Cbe{constructor(e){this.coordinateHelper=e}}class Obe extends Cbe{constructor(e,t){super(e),this.point=t}objectEqual(e){return e instanceof Obe&&rre(this.point,e.point)}check(e){return NX(e,this.point)<tre.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(e){const t=[];return e instanceof kbe?t.push(...ooe({start:e.start,end:e.end,type:e instanceof Rbe?1:0},this.point)):e instanceof Fbe&&t.push(...aoe(e.center,e.radius,this.point)),t.map((t=>new Dbe(this.coordinateHelper,t,this,e)))}}class kbe extends Cbe{constructor(e,t,i){super(e),this.start=t,this.end=i}objectEqual(e){return e instanceof kbe&&rre(this.start,e.start)&&rre(this.end,e.end)}intersect(e){const t=[];return e instanceof Obe?t.push(...ooe({start:this.start,end:this.end,type:this instanceof Rbe?1:0},e.point)):e instanceof kbe?t.push(...loe({start:this.start,end:this.end,type:this instanceof Rbe?1:0},{start:e.start,end:e.end,type:e instanceof Rbe?1:0})):e instanceof Fbe&&t.push(...hoe({start:this.start,end:this.end,type:this instanceof Rbe?1:0},e.center,e.radius)),t.map((t=>new Dbe(this.coordinateHelper,t,this,e)))}}class Lbe extends kbe{constructor(e,t,i){super(e,t,i),this.dir=[0,0],this.p=[0,0]}objectEqual(e){return e instanceof Lbe&&super.objectEqual(e)}check(e){return CX(this.dir,this.end,this.start),CX(this.p,e,this.start),BX(this.dir,this.p)>=0&&roe(e,this.start,this.end)<tre.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return function(e,t,i,r){CX(uoe,r,i),CX(doe,t,i);const s=BX(uoe,doe)/VX(uoe);s>0?FX(e,i,uoe,s):EX(e,i)}(t,e,this.start,this.end),t}}class Rbe extends kbe{constructor(e,t,i){super(e,t,i)}objectEqual(e){return e instanceof Rbe&&super.objectEqual(e)}check(e){return roe(e,this.start,this.end)<tre.pointOnLineThreshold}closestTo(e){const t=this.coordinateHelper.clone(e);return soe(t,e,this.start,this.end),t}}class Dbe extends Cbe{constructor(e,t,i,r){super(e),this.intersection=t,this.first=i,this.second=r}objectEqual(e){return e instanceof Dbe&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return EX(t,this.intersection),t}intersect(){return[]}}class Fbe extends Cbe{constructor(e,t,i){super(e),this.center=t,this.radius=i}objectEqual(e){return e instanceof Fbe&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}check(){return!1}closestTo(e){const t=this.coordinateHelper.clone(e);return noe(t,e,this.center,this.radius),t}intersect(e){const t=[];return e instanceof kbe?t.push(...hoe({start:e.start,end:e.end,type:e instanceof Rbe?1:0},this.center,this.radius)):e instanceof Obe&&t.push(...aoe(this.center,this.radius,e.point)),t.map((t=>new Dbe(this.coordinateHelper,t,this,e)))}}class jbe{constructor(e,t,i){this.coordinateHelper=e,this.targetPoint=t,this.constraint=i}}class Nbe extends jbe{constructor({coordinateHelper:e,targetPoint:t,objectId:i,constraint:r}){super(e,t,r),this.objectId=i}}class zbe extends Nbe{constructor(e){super(l(a({},e),{constraint:new Rbe(e.coordinateHelper,e.edgeStart,e.edgeEnd)}))}get hints(){return[new pre(1,this.constraint.start,this.constraint.end)]}}class Vbe extends jbe{constructor({coordinateHelper:e,targetPoint:t,constraint:i,previousVertex:r,otherVertex:s,otherVertexType:n,objectId:o}){super(e,t,i),this.previousVertex=r,this.otherVertex=s,this.otherVertexType=n,this.objectId=o}get hints(){const e=this.previousVertex,t=1===this.otherVertexType?this.otherVertex:this.targetPoint,i=1===this.otherVertexType?this.targetPoint:this.otherVertex;return[new pre(0,t,i),new pre(1,e,t),new yre(this.previousVertex,t,i)]}}let Ube=class extends Jv{constructor(e){super(e),this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return tJ(this.snappingSources,(({snappingSource:e})=>e.updating))||this.updatingHandles.updating}get snappingSources(){var e;const t=this._get("snappingSources")||new Map,i=new Map;if(null!=(e=this.options)&&e.featureSources)for(const r of this.options.featureSources.items){const e=r.layer.uid,s=t.get(e);if(s){t.delete(e),i.set(e,s);continue}if(!r.layer.loaded){this.updatingHandles.addPromise(r.layer.load());continue}const n=this.createSourceInfo(r);m(n)&&i.set(e,n)}for(const[,r]of t)r.destroy();return i}initialize(){var e;this.updatingHandles.add(this,"snappingSources",(()=>{this.notifyChange("updating")}),1),m(this.view)&&this.handles.add([null==(e=this.view.refreshManager)?void 0:e.on("refresh",(e=>{"interval"===e.trigger&&this.refreshSourceOfLayer(e.layerView.layer)})),this.view.on("layerview-create",(e=>this.updateLayerView(e.layer,e.layerView))),this.view.on("layerview-destroy",(e=>this.updateLayerView(e.layer,null)))])}refreshSourceOfLayer(e){for(const[,{snappingSource:t}]of this.snappingSources)t.layerSource.layer===e&&t.refresh()}updateLayerView(e,t){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=t)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,t,i){if(!this.options.effectiveFeatureEnabled)return[];const r=[],s=this.computeScreeenSizeDistanceParameters(e,t),n={distance:s,point:e,coordinateHelper:t.coordinateHelper,types:this.types,filter:null};for(const[,{snappingSource:a,layerView:l}]of this.snappingSources)!a.layerSource.enabled||m(l)&&l.suspended||r.push(a.fetchCandidates(n,i).then((e=>e.filter((e=>!this.candidateIsExcluded(a,e,t.excludeFeature))))));const o=(await dt(r)).flat();return this.addRightAngleCandidates(o,e,s,t),tt(i),ore(e,o),o}addRightAngleCandidates(e,t,i,r){var s,n,o,a,l,h,c,u;const p=m(r.vertexHandle)?null==(s=r.vertexHandle.right)||null==(n=s.right)?void 0:n.pos:m(r.geometry)&&"polygon"===r.geometry.type?null==(o=null==(a=r.geometry.editGeometry.components[0])?void 0:a.getFirstVertex())?void 0:o.pos:null,d=m(r.vertexHandle)?null==(l=r.vertexHandle.left)||null==(h=l.left)?void 0:h.pos:m(r.geometry)?null==(c=null==(u=r.geometry.editGeometry.components[0])?void 0:u.getLastVertex())?void 0:c.pos:null,f=e.length;for(let y=0;y<f;y++)this.addRightAngleCandidate(e[y],d,t,i,r,e),this.addRightAngleCandidate(e[y],p,t,i,r,e)}addRightAngleCandidate(e,t,i,r,s,n){if(v(t)||!(e instanceof zbe))return;const o=e.constraint.closestTo(t),a=(o[0]-i[0])/r.x,l=(o[1]-i[1])/r.y;if(a*a+l*l<=1){const i=s.coordinateHelper;n.push(new Vbe({coordinateHelper:i,targetPoint:o,otherVertex:t,otherVertexType:0,previousVertex:e.constraint.start,constraint:new Lbe(i,t,o),objectId:e.objectId}))}}computeScreeenSizeDistanceParameters(e,t){const i=this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1);return v(this.view)?{x:i,y:i}:"2d"===this.view.type?{x:i*this.view.resolution,y:i*this.view.resolution}:this.computeScreeenSizeDistanceParameters3D(e,i,this.view,t)}computeScreeenSizeDistanceParameters3D(e,t,i,r){const{coordinateHelper:s,elevationInfo:n}=r,o=i.state.camera.computeScreenPixelSizeAt(nre(e,s,n,i,Bbe))*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,a=t*o;return{x:a/this.computeScreenMagnitudeOfMapOffset(e,o,0,i,r),y:a/this.computeScreenMagnitudeOfMapOffset(e,0,o,i,r)}}computeScreenMagnitudeOfMapOffset(e,t,i,r,{coordinateHelper:s,elevationInfo:n}){const o=s.clone(e);o[0]+=t,o[1]+=i;const a=sre(e,s,n,r),l=sre(o,s,n,r),h=l.x-a.x,c=l.y-a.y;return Math.sqrt(h*h+c*c)}get types(){return 3}candidateIsExcluded(e,t,i){if(v(i))return!1;const r=this.getCandidateObjectId(t);if(v(r))return!1;const s=e.layerSource.layer;return"graphics"===s.type?i.uid===r:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===r}getCandidateObjectId(e){return e instanceof Nbe?e.objectId:null}createSourceInfo(e){const t=this.createFeatureSnappingSourceType(e);if(v(t))return null;if("loading"in t)return this.updatingHandles.addPromise(t.loading.then((()=>{this.destroyed||this.notifyChange("snappingSources")}))),null;const i=m(this.view)?this.view.allLayerViews.find((t=>t.layer===e.layer)):null;return new Gbe(t.source,i)}createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"wfs":return this.createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this.createFeatureSnappingSourceGraphicsLayer(e)}return null}createFeatureSnappingSourceFeatureLayer(e){switch(e.layer.source.type){case"feature-layer":{const t=this.getSourceModule("featureService");return m(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===e.layer.geometryType)return null;const t=this.getSourceModule("featureCollection");return m(t.module)?{source:new t.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:t.loader}}}return null}createFeatureSnappingSourceGraphicsLayer(e){const t=this.getSourceModule("graphics");return m(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}getSourceModule(e){const t=this.sourceModules[e];if(v(t.loader)){const i=this.loadSourceModule(e).then((e=>{t.module=e}));return t.loader=i,{module:t.module,loader:i}}return{module:t.module,loader:t.loader}}loadSourceModule(e){switch(e){case"featureService":return this.updatingHandles.addPromise(import("./FeatureServiceSnappingSource.8b285a75.js"));case"featureCollection":return this.updatingHandles.addPromise(import("./FeatureCollectionSnappingSource.ca4966f1.js"));case"graphics":return this.updatingHandles.addPromise(import("./GraphicsSnappingSource.1d00fd5f.js"))}return null}};Q([ro({constructOnly:!0})],Ube.prototype,"spatialReference",void 0),Q([ro({constructOnly:!0})],Ube.prototype,"view",void 0),Q([ro()],Ube.prototype,"options",void 0),Q([ro({readOnly:!0})],Ube.prototype,"updating",null),Q([ro({readOnly:!0})],Ube.prototype,"snappingSources",null),Ube=Q([Ro("esri.views.interactive.snapping.FeatureSnappingEngine")],Ube);class Gbe{constructor(e,t){this.snappingSource=e,this.layerView=t,this.handles=new Mh;const i=this.snappingSource.layerSource.layer;if("refresh"in i){const t=i;this.handles.add(t.on("refresh",(()=>e.refresh())))}this.handles.add([Rh(e,"updating",(t=>e.layerSource.updating=t),!0),Rh(e,"availability",(t=>e.layerSource.availability=t),!0)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const Bbe=[0,0,0];class qbe{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=tre.shortLineThreshold*tre.shortLineThreshold}snap(e,t){return m(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold(e.left.pos,e.right.pos,t)}exceedsShortLineThreshold(e,t,{elevationInfo:i,geometry:r}){const s=r.editGeometry.coordinateHelper;return 0===this.squaredShortLineThreshold||ire(sre(t,s,i,this.view),sre(e,s,i,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class Hbe extends jbe{constructor({coordinateHelper:e,lineStart:t,lineEnd:i,targetPoint:r}){super(e,r,new Rbe(e,t,i)),this.referenceLineHint=new pre(2,t,i)}get hints(){return[this.referenceLineHint,new pre(0,this.lineEndClosestToTarget(),this.targetPoint)]}lineEndClosestToTarget(){const e=this.constraint.start,t=this.constraint.end;return wv(BX(CX($be,t,e),CX(Wbe,this.targetPoint,e)))>0?t:e}}const Wbe=[0,0],$be=[0,0];class Jbe extends qbe{snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],r=i.edges.length,s=[];if(r<1)return s;const n=sre(e,t.coordinateHelper,t.elevationInfo,this.view),o=i.edges[r-1];let a=o;do{this.edgeExceedsShortLineThreshold(a,t)&&this._processCandidateProposal(a.left.pos,a.right.pos,e,n,t,s),a=a.left.left}while(a&&a!==o);return s}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<2)return i;const n=sre(e,t.coordinateHelper,t.elevationInfo,this.view),o=r.left,a=r.right;o&&a&&this.edgeExceedsShortLineThreshold(o,t)&&this.edgeExceedsShortLineThreshold(a,t)&&this._processCandidateProposal(o.left.pos,a.right.pos,e,n,t,i);const l=s.edges[0];let h=l;do{h!==r.left&&h!==r.right&&this.edgeExceedsShortLineThreshold(h,t)&&this._processCandidateProposal(h.left.pos,h.right.pos,e,n,t,i),h=h.right.right}while(h&&h!==l);return i}_processCandidateProposal(e,t,i,r,s,n){const o=soe([0,0],i,e,t),a=s.coordinateHelper,l=a.fromXYZ(o,a.getZ(i,0));ire(r,sre(l,a,s.elevationInfo,this.view))<this.squaredProximityTreshold(s.pointer)&&n.push(new Hbe({coordinateHelper:s.coordinateHelper,lineStart:e,lineEnd:t,targetPoint:l}))}}class Xbe extends jbe{constructor({coordinateHelper:e,referenceLine:t,lineStart:i,targetPoint:r}){const s=e.clone(i);CX(s,PX(s,s,t.right.pos),t.left.pos),super(e,r,new Rbe(e,i,s)),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new pre(0,this.constraint.start,this.targetPoint),new dre(this.constraint.start,this.targetPoint),...this._referenceLines.map((e=>new pre(1,e.edge.left.pos,e.edge.right.pos,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{e.right.right===i.edge&&(i.fadeLeft=!1,t.fadeRight=!1),e.left.left===i.edge&&(i.fadeRight=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class Kbe extends qbe{constructor(){super(...arguments),this._tmpProjection=[0,0]}snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],r=i.edges.length,s=i.vertices.length,n=[];if(r<2)return n;const o=sre(e,t.coordinateHelper,t.elevationInfo,this.view),a=i.vertices[s-1],l=i.vertices[0],h=i.edges[r-1];let c=h;do{this.edgeExceedsShortLineThreshold(c,t)&&(this._checkEdgeForParalleLines(c,a.pos,e,o,t,n),this._checkEdgeForParalleLines(c,l.pos,e,o,t,n)),c=c.left.left}while(c&&c!==h);return n}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;if(s.edges.length<3)return i;const n=sre(e,t.coordinateHelper,t.elevationInfo,this.view),o=r.left,a=r.right,l=s.vertices[0],h=s.vertices.length,c=s.vertices[h-1],u=s.edges[0];let p=u;do{p!==o&&p!==a&&this.edgeExceedsShortLineThreshold(p,t)&&(o&&this._checkEdgeForParalleLines(p,o.left.pos,e,n,t,i),a&&this._checkEdgeForParalleLines(p,a.right.pos,e,n,t,i),r===l?this._checkEdgeForParalleLines(p,c.pos,e,n,t,i):r===c&&this._checkEdgeForParalleLines(p,l.pos,e,n,t,i)),p=p.right.right}while(p&&p!==u);return i}_checkEdgeForParalleLines(e,t,i,r,s,n){const o=e.left.pos,a=e.right.pos;if(soe(this._tmpProjection,t,o,a),NX(this._tmpProjection,t)<tre.parallelLineThreshold)return;soe(this._tmpProjection,i,o,a,t);const l=s.coordinateHelper,h=l.fromXYZ(this._tmpProjection,l.getZ(i,0));if(ire(r,sre(h,l,s.elevationInfo,this.view))<this.squaredProximityTreshold(s.pointer)){if(this.parallelToPreviousCandidate(e,n))return;n.push(new Xbe({coordinateHelper:l,referenceLine:e,lineStart:t,targetPoint:h}))}}parallelToPreviousCandidate(e,t){const i=e.left.pos,r=e.right.pos;for(const s of t)if(soe(this._tmpProjection,r,s.constraint.start,s.constraint.end,i),NX(this._tmpProjection,r)<tre.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1}}class Ybe extends qbe{constructor(){super(...arguments),this._tmp=[0,0]}snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],r=i.vertices.length,s=[];if(r<2)return s;const n=sre(e,t.coordinateHelper,t.elevationInfo,this.view),o=i.vertices[r-1];this._checkForSnappingCandidate(s,o.left,o.pos,e,o.left.left.pos,o.pos,t,e,n);const a=i.vertices[0];return this._checkForSnappingCandidate(s,a.right,a.pos,e,a.right.right.pos,a.pos,t,e,n),s}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component,n=s.vertices.length;if(n<3)return i;const o=sre(e,t.coordinateHelper,t.elevationInfo,this.view),a=r.left,l=r.right,h=s.vertices[0],c=s.vertices[n-1];if(!a)return this._checkForSnappingCandidate(i,h.right.right.right,h.right.right.pos,e,h.right.right.right.right.pos,h.right.right.pos,t,e,o),i;if(!l)return this._checkForSnappingCandidate(i,c.left.left.left,c.left.left.pos,e,c.left.left.left.left.pos,c.left.left.pos,t,e,o),i;if(a&&a.left.left){const r=a.left.left;this._checkForSnappingCandidate(i,r,a.left.pos,e,r.left.pos,a.left.pos,t,e,o)}if(l&&l.right.right){const r=l.right.right;this._checkForSnappingCandidate(i,r,l.right.pos,e,r.right.pos,l.right.pos,t,e,o)}return i}_checkForSnappingCandidate(e,t,i,r,s,n,o,a,l){if(!this.edgeExceedsShortLineThreshold(t,o))return;CX(this._tmp,t.right.pos,t.left.pos);const h=nK(this._tmp[1],-this._tmp[0]),c=BX(h,CX(this._tmp,r,i))/VX(h),u=o.coordinateHelper,p=u.fromXYZ(FX([0,0],n,h,c),u.getZ(a,0));ire(l,sre(p,u,o.elevationInfo,this.view))<this.squaredProximityTreshold(o.pointer)&&e.push(new Vbe({coordinateHelper:u,targetPoint:p,constraint:new Lbe(u,n,FX(u.createNew(),n,h,wv(c))),previousVertex:s,otherVertex:n,otherVertexType:1}))}}class Zbe extends jbe{constructor({coordinateHelper:e,targetPoint:t,point1:i,point2:r}){super(e,t,new Fbe(e,HX(Qbe,i,r,.5),.5*jX(i,r))),this.p1=i,this.p2=r}get hints(){return[new pre(1,this.targetPoint,this.p1),new pre(1,this.targetPoint,this.p2),new yre(this.p1,this.targetPoint,this.p2)]}}const Qbe=[0,0];class ewe extends qbe{snapNewVertex(e,t){const i=t.geometry.editGeometry.components[0],r=[],s=i.vertices.length;if("polygon"!==t.geometry.type||s<2)return r;const n=i.vertices[0],o=i.vertices[s-1];return this._processCandidateProposal(n.pos,o.pos,e,t,r),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,s=r.component;return s.edges.length<2?i:"polyline"!==t.geometry.type||0!==r.index&&r.index!==s.vertices.length-1?(this._processCandidateProposal(r.left.left.pos,r.right.right.pos,e,t,i),i):i}_processCandidateProposal(e,t,i,r,s){if(!this.exceedsShortLineThreshold(e,t,r))return;const n=noe([0,0],i,HX([0,0],e,t,.5),.5*jX(e,t)),o=r.coordinateHelper,a=o.fromXYZ(n,o.getZ(i,0));ire(sre(i,o,r.elevationInfo,this.view),sre(a,o,r.elevationInfo,this.view))<this.squaredProximityTreshold(r.pointer)&&s.push(new Zbe({coordinateHelper:o,targetPoint:a,point1:e,point2:t}))}}let twe=class extends jo{constructor(e){super(e),this.updating=!1,this._snappers=new xh}initialize(){this._snappers.push(new Kbe(this.view,this.options),new Jbe(this.view,this.options),new Ybe(this.view,this.options),new ewe(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t){if(!this.options.effectiveSelfEnabled)return[];const i=[];for(const r of this._snappers.items)i.push(...r.snap(e,t));return ore(e,i),i}};Q([ro({readOnly:!0})],twe.prototype,"updating",void 0),Q([ro({constructOnly:!0})],twe.prototype,"view",void 0),Q([ro()],twe.prototype,"options",null),twe=Q([Ro("esri.views.interactive.snapping.SelfSnappingEngine")],twe);let iwe=class extends jo{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};Q([ro({constructOnly:!0})],iwe.prototype,"layer",void 0),Q([ro()],iwe.prototype,"enabled",void 0),Q([ro()],iwe.prototype,"updating",void 0),Q([ro()],iwe.prototype,"availability",void 0),iwe=Q([Ro("esri.views.interactive.snapping.SnappingLayerSource")],iwe);var rwe=iwe;let swe=class extends jo{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new xh,this.distance=tre.distance,this.touchSensitivityMultiplier=tre.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};Q([ro()],swe.prototype,"enabled",void 0),Q([ro()],swe.prototype,"enabledToggled",void 0),Q([ro()],swe.prototype,"selfEnabled",void 0),Q([ro()],swe.prototype,"featureEnabled",void 0),Q([ro({type:xh.ofType(rwe)})],swe.prototype,"featureSources",void 0),Q([ro()],swe.prototype,"distance",void 0),Q([ro()],swe.prototype,"touchSensitivityMultiplier",void 0),Q([ro({readOnly:!0})],swe.prototype,"effectiveEnabled",null),Q([ro({readOnly:!0})],swe.prototype,"effectiveSelfEnabled",null),Q([ro({readOnly:!0})],swe.prototype,"effectiveFeatureEnabled",null),swe=Q([Ro("esri.views.interactive.snapping.SnappingOptions")],swe);var nwe=swe;class owe extends jbe{constructor(e,t,i,r){super(e,t,new Dbe(e,t,i.constraint,r.constraint)),this.first=i,this.second=r}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ure(this.targetPoint)]}}let awe=class extends(sh.EventedMixin(Jv)){constructor(e){super(e),this.options=new nwe,this.engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([dn((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}}),(()=>{this.doneSnapping(),this.emit("changed")})),this.watch("options",(e=>{for(const t of this.engines)t.options=e}),!0),Rh(this.view,"ready",(e=>this.onViewReady(e)),!0)])}destroy(){this.destroyEngines()}get updating(){return this.engines.some((e=>e.updating))}onViewReady(e){var t,i;this.destroyEngines(),e&&(this.engines=[new twe({view:this.view,options:this.options}),new Ube({view:this.view,spatialReference:null!=(t=null==(i=this.view)?void 0:i.spatialReference)?t:Aa.WGS84,options:this.options})])}destroyEngines(){for(const e of this.engines)e.destroy();this.engines.length=0}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}async snap(e,t,i){const r=t.coordinateHelper.fromPoint(e),s=await this.fetchCandidates(r,t,i);return{get valid(){return!rt(i)},apply:()=>{const{snappedPoint:e,hints:i}=this.processCandidates(r,s,t);return this.removeVisualization(),m(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),lwe),e}}}update(e,t){this.removeVisualization();let i=e;const r=[];if(m(this._currentMainCandidate)){const s=t.coordinateHelper,n=s.fromPoint(e),o=this._currentMainCandidate.constraint.closestTo(n);if(ire(sre(n,s,t.elevationInfo,this.view),sre(o,s,t.elevationInfo,this.view))<this.squaredPointProximityThreshold(t.pointer)){i=s.createDehydratedPoint(o),this._currentMainCandidate.targetPoint=o,r.push(...this._currentMainCandidate.hints);for(const e of this._currentOtherActiveCandidates)e.targetPoint=o,r.push(...e.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return m(t.visualizer)&&this.handles.add(t.visualizer.draw(r,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),lwe),i}doneSnapping(){this.removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}removeVisualization(){this.handles.remove(lwe)}async fetchCandidates(e,t,i){return(await Promise.all(this.engines.map((r=>r.fetchCandidates(e,t,i))))).flat()}processCandidates(e,t,i){if(t.length<1)return this.doneSnapping(),{snappedPoint:i.coordinateHelper.createDehydratedPoint(e),hints:[]};ore(e,t);const r=this._currentMainCandidate;if(m(r)){const s=this.findOldConstraintInNewCandidates(r,t);if(s>=0){if(!(t[s]instanceof owe))return this.intersectWithOtherCandidates(s,t,e,i);if(NX(e,r.targetPoint)<this.squaredPointProximityThreshold(i.pointer))return this.updateSnappingCandidate(r,t,i)}}return this.intersectWithOtherCandidates(0,t,e,i)}findOldConstraintInNewCandidates(e,t){return e instanceof owe?this.findOldCandidateIndex(t,e.first)>=0&&this.findOldCandidateIndex(t,e.second)>=0?0:-1:this.findOldCandidateIndex(t,e)}intersectWithOtherCandidates(e,t,i,r){const s=t[e],n=[],o=r.coordinateHelper;for(let a=0;a<t.length;++a){if(a===e)continue;const l=t[a];for(const e of s.constraint.intersect(l.constraint)){const t=o.fromXYZ(e.intersection,s.targetPoint[2]);n.push([new owe(o,t,s,l),ire(sre(i,r.coordinateHelper,r.elevationInfo,this.view),sre(t,r.coordinateHelper,r.elevationInfo,this.view))])}}return n.length>0&&(n.sort(((e,t)=>e[1]-t[1])),n[0][1]<this.squaredPointProximityThreshold(r.pointer))?this.updateSnappingCandidate(n[0][0],t,r):this.updateSnappingCandidate(s,t,r)}updateSnappingCandidate(e,t,i){this.doneSnapping(),this._currentMainCandidate=e;const r=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const n of t){if(e instanceof owe){if(n.constraint.objectEqual(e.first.constraint)||n.constraint.objectEqual(e.second.constraint))continue}else if(n.constraint.objectEqual(e.constraint))continue;n.constraint.check(r)&&(n.targetPoint=r,this._currentOtherActiveCandidates.push(n),s.push(...n.hints))}return{snappedPoint:i.coordinateHelper.createDehydratedPoint(r),hints:s}}squaredPointProximityThreshold(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}findOldCandidateIndex(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.objectEqual(e[r].constraint)){i=r;break}return i}get test(){return{visualizationsActive:this.handles.has(lwe),engines:this.engines}}};Q([ro({constructOnly:!0})],awe.prototype,"view",void 0),Q([ro()],awe.prototype,"options",void 0),Q([ro({readOnly:!0})],awe.prototype,"updating",null),Q([ro()],awe.prototype,"engines",void 0),Q([ro()],awe.prototype,"squaredMouseProximityTreshold",null),Q([ro()],awe.prototype,"squaredTouchProximityThreshold",null),awe=Q([Ro("esri.views.interactive.snapping.SnappingManager")],awe);const lwe="visualization-handle";let hwe=class extends sh.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw":case"draw-3d":return null;default:this.activeComponent}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this.reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}reset(){this.activeComponent.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",(()=>{this.canUndo()&&e()}))}set redo(e){this._set("redo",(()=>{this.canRedo()&&e()}))}};Q([ro()],hwe.prototype,"activeComponent",void 0),Q([ro()],hwe.prototype,"cancelled",void 0),Q([ro()],hwe.prototype,"history",void 0),Q([ro()],hwe.prototype,"tool",null),Q([ro()],hwe.prototype,"type",void 0),Q([ro()],hwe.prototype,"canUndo",null),Q([ro()],hwe.prototype,"canRedo",null),Q([ro()],hwe.prototype,"onEnd",void 0),Q([ro()],hwe.prototype,"undo",null),Q([ro()],hwe.prototype,"redo",null),Q([ro()],hwe.prototype,"toggleTool",void 0),Q([ro()],hwe.prototype,"addToSelection",void 0),Q([ro()],hwe.prototype,"removeFromSelection",void 0),hwe=Q([Ro("esri.widgets.Sketch.support.OperationHandle")],hwe);const cwe="esri.widgets.Sketch.SketchViewModel",uwe=Ne.getLogger(cwe),pwe={defaultZ:0},dwe={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let fwe=class extends sh.EventedAccessor{constructor(e){super(e),this._activeFillGraphic=null,this._activeLineGraphic=null,this._centerIndicatorGraphic=null,this._centerSymbol=new $I({style:"cross",size:6,color:[255,255,255]}),this._defaultSegmentOffset=48,this._numUpdating=0,this._handles=new Mh,this._internalGraphicsLayer=new bte({listMode:"hide",internal:!0,title:"SVM Internal"}),this._lineGraphic=null,this._operationHandle=null,this._vertexGraphics=[],this._viewHandles=new Mh,this._doUnnormalization=!1,this.activeFillSymbol=new BI({style:"solid",color:[150,150,150,.2],outline:{color:[50,50,50],width:0}}),this.activeLineSymbol=new PS({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),this.activeVertexSymbol=new $I({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}}),this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new $I({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new BI({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new fM({color:[130,130,130,1],width:2}),this._snappingManager=null,this.updateGraphics=new xh,this.updateOnGraphicClick=!0,this.updatePointSymbol=new $I({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new BI({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new fM({color:[12,207,255],width:2}),this.vertexSymbol=new $I({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=pwe,this.defaultUpdateOptions=dwe,this.snappingOptions=new nwe}initialize(){this._handles.add([Dh(this,"layer",(()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=m(this.layer)?this.layer.elevationInfo:null})),Hh(this,"view.map.layers","change",(e=>{e.removed.includes(this.layer)&&this.cancel()})),Hh(this,"layer.graphics","change",(e=>{if(m(this._operationHandle))for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())})),Rh(this,"layer.elevationInfo",(()=>{this.cancel(),this._internalGraphicsLayer.elevationInfo=m(this.layer)?this.layer.elevationInfo:null}),!0),Rh(this,"view",(e=>{M(this._snappingManager),e&&(this._snappingManager=new awe({view:e,options:this.snappingOptions}),"3d"===e.type&&(import("./editingTools.889d920b.js").then((function(e){return e.e})),import("./GraphicsLayerView3D.71a8ca91.js").then((function(e){return e.G}))))}),!0)])}destroy(){this.cancel(),this._handles=M(this._handles),this._viewHandles=M(this._viewHandles),this._removeDefaultLayer(),M(this._draw),M(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get _draw(){return"ready"===this.state||"active"===this.state?new Ibe({view:this.view}):null}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return this.view&&"3d"===this.view.type&&m(this.activeComponent)&&"draw-3d"===this.activeComponent.type?this.activeComponent.createGraphic:this._get("createGraphic")}set defaultCreateOptions(e){this._set("defaultCreateOptions",a(a({},pwe),e))}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",l(a(a({},dwe),e),{reshapeOptions:a(a({},dwe.reshapeOptions),null==e?void 0:e.reshapeOptions)}))}set snappingOptions(e){m(this._snappingManager)&&(this._snappingManager.options=e),this._set("snappingOptions",e)}get state(){var e;const t=!(null==(e=this.view)||!e.ready||!this.layer),i=this._operationHandle;return t&&i?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:i}=t;e&&(t.cursor=null),i&&i.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}this._doUnnormalization=null!=e&&"3d"===e.type&&"global"===e.viewingMode;const i="view-ready";this._handles.remove(i),e&&this._handles.add(Fh(e,"ready",(t=>{this._viewHandles.removeAll(),t&&this._viewHandles.add(this._generateViewHandles(e))}),!0),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=E(this._moduleLoaderAbortController),this._viewReadyAbortController=E(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:i}=this,r=t.toArray();i.removeMany(r),this.cancel(),this._emitDeleteEvent({graphics:r,tool:e})}}async create(e,t){if(await this._waitViewReady(),"disabled"===this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),Qe();if(this.cancel(),this.view.activeTool=null,!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");const i=await this._setupCreateOperation(e,t);if(v(i)||this.destroyed)return;let r=null;"2d"===this.view.type&&(r=this.view.map.layers.findIndex((e=>e.id===Ioe.SNAPPING_GRAPHICS_LAYER_ID)),r=r>-1?r:null),Pbe(this.view,this._internalGraphicsLayer,r);i.on("complete",(()=>{if(i===this._operationHandle){const t=this.createGraphic,r=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||null==t||this.layer.add(t),this.emit("create",{graphic:t,state:r?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"})}})),this._operationHandle=i,this.view.ready&&s$(this.view)&&this.view.focus()}async update(e,t){await this._waitViewReady();const{layer:i,view:r,state:s}=this;if("disabled"===s)throw r||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),i||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),Qe();this.cancel(),this.view.activeTool=null;const n=Array.isArray(e)?e:[e];if(null==e||!n||!n.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some((e=>e.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):v(e.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):"2d"===r.type&&!r.spatialReference.equals(e.geometry.spatialReference)&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with a spatial reference different from the supplied IMapView."),!0))))return;const o=await this._setupUpdateOperation(n,t);this.destroyed||v(o)||bwe(o)||(Pbe(this.view,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:o.tool,toolEventInfo:null,type:"update"}))}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(e){const t=[];switch(this.view.type){case"2d":{const s=await this.view.hitTest(e);if(s.results.length>0){const e=s.results[0];if(e.graphic){var i,r;const s=e.graphic;"vector-tile"!==(null==(i=s.layer)?void 0:i.type)&&"imagery"!==(null==(r=s.layer)?void 0:r.type)&&t.push(e)}}}break;case"3d":{const i=[this.view.map.ground];this.view.map.allLayers.forEach((e=>{"integrated-mesh"===e.type&&i.push(e)}));const r=await this.view.hitTest(e,{exclude:i});if(r.results.length>0){const e=r.results[0];(!r.ground.mapPoint||this.view.map.ground.opacity<1||r.ground.distance-e.distance>-Math.min(3*r.ground.distance,"global"===this.view.viewingMode?xA(this.view.renderCoordsHelper.spatialReference).radius/this.view.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY))&&t.push(e)}}}return{screenPoint:e,results:t}}_generateViewHandles(e){return[e.on("immediate-click",(async t=>{const i="active"===this.state&&"create"===this._operationHandle.type;if("disabled"===this.state||i||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const r=(await t.async((()=>this._getFirstHit(wJ(t))))).results;let s=null;if(r.length){for(const n of r)if(n.graphic){const i=n.graphic;if(this.updateGraphics.includes(i)||i.layer===this.layer){t.stopPropagation(),s=i;break}"2d"!==e.type||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}}else"active"===this.state&&this.cancel();m(s)&&!this.updateGraphics.includes(s)&&await this.update([s],l(a({},this.defaultUpdateOptions),{reshapeOptions:a({},this.defaultUpdateOptions.reshapeOptions)})),this._endAsyncOperation()}),iH.WIDGET)]}async _setupCreateOperation(e,t){if(!e)return null;const i=a(a({hasZ:"3d"===this.view.type},this.defaultCreateOptions),t);let r;if("2d"===this.view.type)switch(e){case"point":r=this._setupCreatePointOperation(e,i);break;case"multipoint":r=await this._setupCreateMultipointOperation(e,i);break;case"polygon":case"polyline":r=await this._setupCreatePolyOperation(e,i);break;case"rectangle":r=await this._setupCreateRectangleOperation(e,i);break;case"circle":r=await this._setupCreateCircleOperation(e,i)}else{const t=await this._setupCreate3DOperation(e,this.view,i);if(v(t)||bwe(t))return null;r=t}return r}async _setupCreate3DOperation(e,t,i){if("multipoint"===e)return null;this._removeCreateOperationGraphics();const r="rectangle"!==e,s="rectangle"!==e;this.snappingOptions.enabledToggled=!1;const n=await this._requireModule(import("./editingTools.889d920b.js").then((function(e){return e.e})));if(bwe(n))return n;if(this.destroyed)return null;const o=new n.module.DrawGraphicTool(l(a({view:t,mode:"rectangle"===e||"circle"===e?"hybrid":"click"},i),{elevationInfo:this.layer.elevationInfo,geometryType:e,createGraphicSymbol:this._getGraphicSymbolFromTool(e),snapToScene:!m(this.layer.elevationInfo)||"absolute-height"===this.layer.elevationInfo.mode,snappingManager:this._snappingManager,forceUniformSize:s,centered:r}));this.view.tools.add(o);let h=null;this.view.activeTool=o;const c=[this.view.on("key-down",(t=>{if(t.key===Ooe.pan)t.stopPropagation(),t.repeat||(o.enabled=!1);else if(t.key===Ooe.complete)t.stopPropagation(),o.completeCreateOperation();else if(t.key!==Ooe.vertexAdd||t.repeat)t.key===Ooe.undo?(t.stopPropagation(),u.undo()):t.key===Ooe.redo?(t.stopPropagation(),u.redo()):t.key!==Ooe.snappingToggle||"rectangle"===e||"circle"===e||t.repeat?t.key!==Ooe.constraint||"rectangle"!==e&&"circle"!==e||t.repeat?t.key===Ooe.center&&(t.repeat||(o.centered=!r,t.stopPropagation())):(o.forceUniformSize=!s,t.stopPropagation()):(this.snappingOptions.enabledToggled=!0,t.stopPropagation());else{const e=o.drawOperation.geometryType;"polyline"!==e&&"polygon"!==e||(t.stopPropagation(),o.drawOperation.commitStagedVertex())}}),iH.WIDGET),this.view.on("key-up",(t=>{t.key===Ooe.pan?o.enabled=!0:t.key===Ooe.snappingToggle&&"rectangle"!==e&&"circle"!==e?(this.snappingOptions.enabledToggled=!1,t.stopPropagation()):t.key!==Ooe.constraint||"rectangle"!==e&&"circle"!==e?t.key===Ooe.center&&(o.centered=r,t.stopPropagation()):(o.forceUniformSize=s,t.stopPropagation())}),iH.WIDGET),o.on("vertex-add",(t=>{switch(h=v(h)?"start":"active",t.operation){case"apply":this.emit("create",{graphic:o.createGraphic,state:h,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[o.createGraphic],tool:e});break;case"redo":this._emitRedoEvent({graphics:[o.createGraphic],tool:e})}})),o.on("cursor-update",(e=>{o.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:o.createGraphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:e.vertices[0].coordinates,type:"cursor-update"},type:"create"})})),o.on("vertex-remove",(t=>{switch(t.operation){case"apply":this.emit("create",{graphic:o.createGraphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[o.createGraphic],tool:e});break;case"redo":this._emitRedoEvent({graphics:[o.createGraphic],tool:e})}})),o.on("complete",(e=>{this._removeCreateOperationGraphics(),this._set("createGraphic",e.graphic),h="complete",e.aborted?u&&u.cancel():u&&u.complete()}))],u=new hwe({activeComponent:o,tool:e,type:"update",onEnd:()=>{var e;c.forEach((e=>e.remove())),c.length=0,null==(e=this.view.tools)||e.remove(o),o.destroy()},undo:()=>{o.canUndo&&o.undo()},redo:()=>{o.canRedo&&o.redo()},canUndo:()=>o.canUndo,canRedo:()=>o.canRedo});return u}_getGraphicSymbolFromTool(e){switch(e){case"point":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}_setupCreatePointOperation(e,t){const i={elevationInfo:this.layer.elevationInfo,hasZ:t.hasZ,defaultZ:t.defaultZ,snappingManager:this._snappingManager,interactiveUndoDisabled:!0},r=this._draw.create(e,i),s=[r.on("cursor-update",(e=>{m(e.vertexIndex)?this._displayCrosshairCursor():this._displayDefaultCursor()})),r.on("draw-complete",(e=>{const t=this.createPointFromVertex(e.vertices[0]),i=new fE(t,this.pointSymbol);this._set("createGraphic",i),o&&o.complete()}))],n=[this.view.on("key-down",(e=>{e.key===Ooe.cancel&&(o&&o.cancel(),e.stopPropagation())}),iH.WIDGET)],o=this._operationHandleForCreateAction(r,[...s,...n],e);return o}async _setupCreateMultipointOperation(e,t){const i=await Abe(),r=l(a({},t),{elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0}),s=this._draw.create(e,r);let n=null;const o=[],h=this._operationHandleForCreateAction(s,o,e);return o.push(s.on("vertex-add",(t=>{const{type:r,vertexIndex:s,vertices:o}=t,a=o[s];n=t,this._drawMultipointGraphic(i,o,!0),this.emit("create",{graphic:this.createGraphic,state:1===o.length?"start":"active",tool:e,toolEventInfo:{added:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:s}],type:r},type:"create"})})),s.on("vertex-remove",(t=>{const{type:r,vertexIndex:s,vertices:o}=t,a=o[s];n=t,this._drawMultipointGraphic(i,o,!0),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{removed:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:s}],type:r},type:"create"})})),s.on("vertex-update",(t=>{const{type:r,vertexIndex:s,vertices:o}=t,a=o[s];n=t,this._drawMultipointGraphic(i,o,!0),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{type:r,updated:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:s}]},type:"create"})})),s.on("cursor-update",(e=>{n=e})),s.on("draw-complete",(e=>{const t=e.vertices.slice(0),r=i.createMultipoint(t,this.view.spatialReference);r&&this.createGraphic&&(this.createGraphic.geometry=r),h&&h.complete()})),s.on("undo",(e=>{const t=e.vertices,r=n&&"cursor-update"!==n.type;this._resetCreateOperationGraphics(),t.length&&this._drawMultipointGraphic(i,t,r)})),s.on("redo",(e=>{const t=e.vertices,r=n&&"cursor-update"!==n.type;this._resetCreateOperationGraphics(),t.length&&this._drawMultipointGraphic(i,t,r)}))),o.push(this.view.on("pointer-move",(()=>this._displayCrosshairCursor()),iH.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(h,e)),iH.WIDGET)),h}async _setupCreatePolyOperation(e,t){const i=await Abe(),r=l(a({},t),{elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0});let s=null;("polyline"===e||"polygon"===e)&&(s=this._draw.create(e,r));let n=null;const o=[s.on("vertex-add",(t=>{const{type:r,vertexIndex:s,vertices:o}=t,a=o[s];this._snapLastPolygonVertexToFirst(e,o),n=t,this._drawVertexGraphics(i,e,o,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:1===o.length?"start":"active",tool:e,toolEventInfo:{added:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:s}],type:r},type:"create"})})),s.on("vertex-remove",(t=>{const{type:r,vertexIndex:s,vertices:o}=t,a=o[s];this._snapLastPolygonVertexToFirst(e,o),n=t,this._drawVertexGraphics(i,e,o,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{removed:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:s}],type:r},type:"create"})})),s.on("vertex-update",(t=>{const{type:r,vertexIndex:s,vertices:o}=t,a=o[s];this._snapLastPolygonVertexToFirst(e,o),n=t,this._drawVertexGraphics(i,e,o,{userClicked:!0}),this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{type:r,updated:a,vertices:[{coordinates:a,componentIndex:0,vertexIndex:s}]},type:"create"})})),s.on("cursor-update",(t=>{const{type:r,vertices:s}=t;if(t.mapPoint&&(this._snapLastPolygonVertexToFirst(e,s),n=t,this._drawVertexGraphics(i,e,s,{userClicked:!1}),s.length>1)){const t=s[s.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:r},type:"create"})}})),s.on("draw-complete",(t=>{const r=t.vertices.slice(0);let s=null;"polyline"===e?s=i.createPolyline([r],this.view.spatialReference,this._doUnnormalization):"polygon"===e&&(s=i.createPolygon([r],this.view.spatialReference,this._doUnnormalization,!0)),s&&(this.createGraphic.geometry=s),c&&c.complete()})),s.on("undo",(t=>{const r=t.vertices,s=n&&"cursor-update"!==n.type;this._resetCreateOperationGraphics(),this._snapLastPolygonVertexToFirst(e,r),r.length&&this._drawVertexGraphics(i,e,r,{userClicked:s})})),s.on("redo",(t=>{const r=t.vertices,s=n&&"cursor-update"!==n.type;this._resetCreateOperationGraphics(),this._snapLastPolygonVertexToFirst(e,r),r.length&&this._drawVertexGraphics(i,e,r,{userClicked:s})}))],h=[this.view.on("pointer-move",(e=>{m(s.getCoordsFromScreenPoint(FS(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()}),iH.WIDGET),this.view.on("key-down",(e=>{e.key!==Ooe.snappingToggle||e.repeat?e.key===Ooe.undo&&c&&c.canUndo()?(e.stopPropagation(),c.undo()):e.key===Ooe.redo&&c&&c.canRedo()?(e.stopPropagation(),c.redo()):e.key===Ooe.cancel&&c&&c.cancel():(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),iH.WIDGET),this.view.on("key-up",(e=>{e.key===Ooe.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),iH.WIDGET)];if("polygon"===e){const e=(e,t,i)=>{if(!e||!e.layer||!e.visible)return!1;const r=this.view.toScreen(e.geometry);return this._isWithinScreenDistance(r,t,i)},t=t=>{if(!(this._vertexGraphics.length<=2))return e(this._vertexGraphics[0],t,this._getVertexIntersectDistance())};let i=!1;h.push(this.view.on("pointer-move",(()=>{i=!1}),iH.WIDGET),this.view.on("pointer-down",(r=>{if(t(r))return i=!0,void r.stopPropagation();this._vertexGraphics.some((t=>e(t,r,this._getVertexIntersectDistance())))&&r.stopPropagation()}),iH.WIDGET),this.view.on("pointer-up",(e=>{i&&(e.stopPropagation(),s.complete())})))}const c=this._operationHandleForCreateAction(s,[...o,...h],e);return c}async _setupCreateCircleOperation(e,t){const i=await Abe(),r=l(a({},t),{elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0}),s=this._draw.create(e,r);let n=!1,o=!0;const h=[s.on("vertex-add",(t=>{const{type:r,vertexIndex:a,vertices:l}=t,h=l[a];this._drawSegmentGraphic(i,e,l,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem),this.emit("create",{graphic:this.createGraphic,state:1===l.length?"start":"active",tool:e,toolEventInfo:{added:h,vertices:[{coordinates:h,componentIndex:0,vertexIndex:a}],type:r},type:"create"})})),s.on("cursor-update",(t=>{const{type:r,vertices:a}=t;if(this._drawSegmentGraphic(i,e,a,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem),2===a.length){const t=a[a.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:r},type:"create"})}})),s.on("draw-complete",(e=>{const t=e.vertices.slice(0);let r;1===t.length?(t.push(s.viewAlignedCoordinateSystem.makeMapPoint(t[0][0]+this._defaultSegmentOffset*this.view.resolution,t[0][1])),r=i.createCircle(t,s.viewAlignedCoordinateSystem,!0,this.view.resolution)):r=n?i.createEllipse(t,s.viewAlignedCoordinateSystem,o):i.createCircle(t,s.viewAlignedCoordinateSystem,o,this.view.resolution),this.createGraphic?this.createGraphic.geometry=r:(this._removeCreateGraphic(),this._set("createGraphic",new fE(r,this.polygonSymbol))),u&&u.complete()}))],c=[this.view.on("pointer-move",(e=>{m(s.getCoordsFromScreenPoint(FS(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()}),iH.WIDGET),this.view.on("key-down",(t=>{t.key===Ooe.constraint?n||(n=!0,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem)):t.key===Ooe.center?o&&(o=!1,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem)):t.key===Ooe.cancel&&u&&u.cancel()}),iH.WIDGET),this.view.on("key-up",(t=>{t.key===Ooe.constraint?(n=!1,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem)):t.key===Ooe.center&&(o=!0,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem))}),iH.WIDGET)],u=this._operationHandleForCreateAction(s,[...h,...c],e);return u}async _setupCreateRectangleOperation(e,t){const i=await Abe(),r=l(a({},t),{elevationInfo:this.layer.elevationInfo,snappingManager:this._snappingManager,interactiveUndoDisabled:!0}),s=this._draw.create(e,r);let n=!1,o=!1;const h=[s.on("vertex-add",(t=>{const{type:r,vertexIndex:a,vertices:l}=t,h=l[a];this._drawSegmentGraphic(i,e,l,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem),this.emit("create",{graphic:this.createGraphic,state:1===l.length?"start":"active",tool:e,toolEventInfo:{added:h,vertices:[{coordinates:h,componentIndex:0,vertexIndex:a}],type:r},type:"create"})})),s.on("cursor-update",(t=>{const{type:r,vertices:a}=t;if(this._drawSegmentGraphic(i,e,a,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem),2===a.length){const t=a[a.length-1];this.emit("create",{graphic:this.createGraphic,state:"active",tool:e,toolEventInfo:{coordinates:t,type:r},type:"create"})}})),s.on("draw-complete",(e=>{const t=e.vertices.slice(0);let r=null;1===t.length&&(n=!1,o=!1),r=n?i.createSquare(t,s.viewAlignedCoordinateSystem,o):i.createRectangle(t,s.viewAlignedCoordinateSystem,o),this.createGraphic?this.createGraphic.geometry=r:(this._removeCreateGraphic(),this._set("createGraphic",new fE(r,this.polygonSymbol))),u&&u.complete()}))],c=[this.view.on("pointer-move",(e=>{m(s.getCoordsFromScreenPoint(FS(e.x,e.y)))?this._displayCrosshairCursor():this._displayDefaultCursor()}),iH.WIDGET),this.view.on("key-down",(t=>{t.key===Ooe.constraint?n||(n=!0,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem)):t.key===Ooe.center?o||(o=!0,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem)):t.key===Ooe.cancel&&u&&u.cancel()}),iH.WIDGET),this.view.on("key-up",(t=>{t.key===Ooe.constraint?(n=!1,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem)):t.key===Ooe.center&&(o=!1,this._drawSegmentGraphic(i,e,s.vertices,{centered:o,constrainToggle:n},s.viewAlignedCoordinateSystem))}),iH.WIDGET)],u=this._operationHandleForCreateAction(s,[...h,...c],e);return u}async _setupUpdateOperation(e,t){const{layer:i,view:r}=this,s=l(a(a({tool:this._defaultUpdateTool},this.defaultUpdateOptions),t),{reshapeOptions:a(a({},this.defaultUpdateOptions.reshapeOptions),null==t?void 0:t.reshapeOptions)}),n=s.tool;for(const o of e)i.remove(o),i.add(o);if("3d"===r.type){if(0===e.length)return null;switch(n){case"move":return this._setupMove3DOperation(e,s,r,n);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=Rte(e[0]);return 0===t?this._setupReshape3DOperation(e[0],s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${wte(t)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(e,s,r)}}switch(n){case"move":return this._setupMoveOperation(e,s,r);case"reshape":{if(e.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const t=Rte(e[0]);return 0===t?this._setupTransformOrReshapeOperation(e,n,s,r):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${wte(t)}).`),null)}case"transform":return this._setupTransformOrReshapeOperation(e,1===e.length&&"point"===R(e[0].geometry,"type")?"reshape":n,s,r)}}async _setupMove3DOperation(e,t,i,r,s=!1){for(const h of e){const e=Ote(h);if(0!==e)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${wte(e)}).`),null}const n=await this._requireModule(import("./editingTools.889d920b.js").then((function(e){return e.e})));if(bwe(n))return n;const o=new n.module.GraphicMoveTool({view:i,enableZ:t.enableZ,snappingManager:this._snappingManager});this.view.tools.add(o),o.graphics.addMany(e),s||this.updateGraphics.addMany(e);const a=[],l=new hwe({activeComponent:o,tool:r,type:"update",onEnd:()=>{var e;a.forEach((e=>e.remove())),a.length=0,null==(e=this.view.tools)||e.remove(o),o.destroyed||o.destroy()},undo:()=>{ywe(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{gwe(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:e=>{this.updateGraphics.push(e),o.graphics.push(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);l.history.undo.forEach((e=>e.updates.splice(t,1))),l.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?o.graphics.remove(e):l.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;if("transform"!==r)return;const e=this.updateGraphics.getItemAt(0);if(0!==Rte(e))return;const s=await this._setupReshape3DOperation(e,t,i,!0);bwe(s)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(s,t))}});return a.push(...this._getHandlesForComponent(l,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(l,e,t)),iH.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===Ooe.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),iH.WIDGET),i.on("key-up",(e=>{e.key===Ooe.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),iH.WIDGET)),l}_setupGraphicTransform3DOperation(e,t,i,r=!1){if(1===e.length&&0===function(e){var t;if("graphics"!==(null==(t=e.layer)?void 0:t.type))return 1;if(v(e.geometry))return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const i=m(e.symbol)&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return i&&i.length>0&&i.some((e=>"object"===e.type))?"on-the-ground"!==Ste(e)&&Tte(e)?4:0:5}(e[0])){const s=e[0],n=s.geometry;if(m(n)&&("point"===n.type||"mesh"===n.type))return this._setupPointTransform3DOperation(s,t,i);if(m(n)&&("polygon"===n.type||"polyline"===n.type))return this._setupPolyTransform3DOperation(s,t,i,r)}return this._setupMove3DOperation(e,t,i,"transform",r)}async _setupPointTransform3DOperation(e,t,i){const r="transform",{enableRotation:s,enableScaling:n,enableZ:o}=t,a=await this._requireModule(import("./editingTools.889d920b.js").then((function(e){return e.e})));if(bwe(a))return a;const l=new a.module.GraphicTransformTool({graphic:e,view:i,enableRotation:s,enableScaling:n,enableZ:o,snappingManager:this._snappingManager});this.view.tools.add(l),this.updateGraphics.add(e);const h=[],c=new hwe({activeComponent:l,tool:r,type:"update",onEnd:()=>{var e;h.forEach((e=>e.remove())),h.length=0,null==(e=this.view.tools)||e.remove(l),l.destroyed||l.destroy()},undo:()=>{ywe(c,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{gwe(c,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);bwe(r)||(c.onEnd(),c.destroy(),this._setUpdateOperationHandle(r,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),c.complete()},toggleTool:()=>{}});return h.push(...this._getHandlesForComponent(c,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(c,e,t)),iH.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(c,e),e.key===Ooe.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),iH.WIDGET),i.on("key-up",(e=>{e.key===Ooe.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),iH.WIDGET)),c}async _setupPolyTransform3DOperation(e,t,i,r=!1){const s="transform",{enableRotation:n,enableScaling:o,enableZ:a,preserveAspectRatio:l}=t,h=await this._requireModule(import("./editingTools.889d920b.js").then((function(e){return e.e})));if(bwe(h))return h;const c=new h.module.ExtentTransformTool({graphic:e,view:i,enableRotation:n,enableScaling:o,enableZ:a,preserveAspectRatio:l});this.view.tools.add(c),r||this.updateGraphics.add(e);const u=[],p=new hwe({activeComponent:c,tool:s,type:"update",onEnd:()=>{var e;u.forEach((e=>e.remove())),u.length=0,null==(e=this.view.tools)||e.remove(c),c.destroyed||c.destroy()},canUndo:()=>c.canUndo,undo:()=>{c.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>c.canRedo,redo:()=>{c.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);bwe(r)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(r,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),p.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===t.toggleToolOnClick)return;const e=this.updateGraphics.getItemAt(0);if(0!==Rte(e))return;const r=await this._setupReshape3DOperation(e,t,i,!0);bwe(r)||(p.onEnd(),p.destroy(),this._setUpdateOperationHandle(r,t))}});return u.push(...this._getHandlesForComponent(p,t),this.view.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(p,e,t)),iH.WIDGET),this.view.on("key-down",(e=>this._getCommonUpdateOperationKeyDownHandlers(p,e)),iH.WIDGET),this.view.on("key-down",(e=>{e.key!==Ooe.constraint||e.repeat||(c.preserveAspectRatio=!c.preserveAspectRatio,e.stopPropagation())}),iH.WIDGET),this.view.on("key-up",(e=>{e.key===Ooe.constraint&&(c.preserveAspectRatio=!c.preserveAspectRatio,e.stopPropagation())}),iH.WIDGET)),p}async _setupMoveOperation(e,t,i){const r="move";this.updateGraphics.addMany(e);const s=await this._getGraphicMover(e,t,i);if(bwe(s))return s;const n=new hwe({activeComponent:s,tool:r,type:"update",onEnd:()=>{var e;this._displayDefaultCursor(),l.forEach((e=>e.remove())),a.forEach((e=>e.remove())),l=[],a=[],s.destroy(),null==(e=this._internalGraphicsLayer)||e.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();ywe(n,e),n.refreshComponent(),this._emitUndoEvent({graphics:e,tool:r})},redo:()=>{const e=this.updateGraphics.toArray();gwe(n,e),n.refreshComponent(),this._emitRedoEvent({graphics:e,tool:r})},addToSelection:e=>{this.updateGraphics.push(e),s.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach((e=>e.updates.splice(t,1))),n.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?s.graphics=i:n.complete()}});let o=!1,a=[i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(n,e,t)),iH.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key!==Ooe.constraint||e.repeat||(o=!0,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)}),iH.WIDGET),i.on("key-up",(e=>{e.key===Ooe.constraint&&o&&(o=!1,s.enableMoveAllGraphics=!s.enableMoveAllGraphics)}),iH.WIDGET)],l=this._getHandlesForComponent(n,t);return n}async _setupReshape3DOperation(e,t,i,r=!1){const s="reshape",n=await this._requireModule(import("./editingTools.889d920b.js").then((function(e){return e.e})));if(bwe(n))return n;this.snappingOptions.enabledToggled=!1;const o=new n.module.GraphicReshapeTool({view:i,graphic:e,enableZVertex:t.enableZ&&"move"===t.reshapeOptions.vertexOperation,enableZShape:t.enableZ&&"move"===t.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===t.reshapeOptions.shapeOperation||"move-xy"===t.reshapeOptions.shapeOperation,enableMidpoints:"split"===t.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===t.reshapeOptions.edgeOperation,snappingManager:this._snappingManager});i.tools.add(o),r||this.updateGraphics.add(e);const a=[],l=new hwe({activeComponent:o,tool:s,type:"update",onEnd:()=>{var e;a.forEach((e=>e.remove())),a.length=0,null==(e=this.view.tools)||e.remove(o),o.destroyed||o.destroy()},canUndo:()=>o.canUndo,undo:()=>{o.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s})},canRedo:()=>o.canRedo,redo:()=>{o.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"});const r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);bwe(r)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(r,t))},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),l.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);bwe(e)||(l.onEnd(),l.destroy(),this._setUpdateOperationHandle(e,t))}});return a.push(...this._getHandlesForComponent(l,t),i.on("immediate-click",(e=>this._getCommonUpdateOperationClickHandlers(l,e,t)),iH.WIDGET),i.on("key-down",(e=>{this._getCommonUpdateOperationKeyDownHandlers(l,e),e.key===Ooe.snappingToggle&&(this.snappingOptions.enabledToggled=!0,e.stopPropagation())}),iH.WIDGET),i.on("key-up",(e=>{e.key===Ooe.snappingToggle&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation())}),iH.WIDGET)),l}async _setupTransformOrReshapeOperation(e,t,i,r){const{multipleSelectionEnabled:s}=i;this.updateGraphics.addMany(e);const n="transform"===t?await this._getBox(e,i,r):await this._getReshape(e,i,r);if(bwe(n))return n;const o=new hwe({activeComponent:n,type:"update",onEnd:()=>{l.forEach((e=>e.remove())),a.forEach((e=>e.remove())),l=[],a=[],o.activeComponent&&!o.activeComponent.destroyed&&o.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{ywe(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},redo:()=>{gwe(o,this.updateGraphics.toArray()),o.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o.tool})},addToSelection:async e=>{let t=o.activeComponent;if("reshape"===t.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll();const s=await this._setupMoveOperation(t,i,r);if(bwe(s))return;o.onEnd(),o.destroy(),this._setUpdateOperationHandle(s,i)}else this.updateGraphics.add(e),t=t,t.graphics=this.updateGraphics.toArray(),t.refresh(),o.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async e=>{const t=this.updateGraphics.indexOf(e);o.history.undo.forEach((e=>e.updates.splice(t,1))),o.history.redo.forEach((e=>e.updates.splice(t,1))),this.updateGraphics.remove(e);const i=this.updateGraphics.toArray();0===i.length?o.complete():1===i.length&&m(i[0].geometry)&&"point"===i[0].geometry.type?o.toggleTool():o.activeComponent.graphics=i,this.emit("update",{graphics:i,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.getItemAt(0);if(m(e.geometry)&&("transform"===o.tool&&"extent"===e.geometry.type||"reshape"===o.tool&&"point"===e.geometry.type))return;let t=null;"transform"===o.tool?t=await this._getReshape([e],i,r):"reshape"===o.tool&&(t=await this._getBox([e],i,r)),bwe(t)||(o.activeComponent.destroy(),o.activeComponent=t,o.activeComponent&&(l.forEach((e=>e.remove())),l=this._getHandlesForComponent(o,i)))}});let a=[r.on("immediate-click",(async e=>{var t;const i=await e.async((()=>this._getFirstHit(wJ(e))));null!=(t=i.results)&&t.length?i.results.some((t=>{if(t.graphic){var i;const r=t.graphic;if(null!=(i=e.native)&&i.shiftKey&&s)return e.stopPropagation(),o.addToSelection(r),!0;if(r.layer===this.layer)return o.complete(),!0}return!1})):o.complete()}),iH.WIDGET),r.on("key-down",(e=>{if(this._getCommonUpdateOperationKeyDownHandlers(o,e),e.key!==Ooe.snappingToggle||e.repeat||(this.snappingOptions.enabledToggled=!0,e.stopPropagation()),e.key===Ooe.constraint&&!e.repeat&&o){const e=o.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),iH.WIDGET),r.on("key-up",(e=>{var t;if(e.key===Ooe.snappingToggle&&"reshape"===(null==o||null==(t=o.activeComponent)?void 0:t.type)&&(this.snappingOptions.enabledToggled=!1,e.stopPropagation()),e.key===Ooe.constraint&&o){const e=o.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}}),iH.WIDGET)],l=this._getHandlesForComponent(o,i);return o}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:r}=t,s=await this._requireModule(import("./GraphicMover.55c11337.js"));return bwe(s)?s:new s.module.default({enableMoveAllGraphics:r,graphics:e,view:i,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:i})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:i})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:r,enableScaling:s,preserveAspectRatio:n}=t,o=await this._requireModule(import("./Box.71d0f800.js"));return bwe(o)?o:new o.module.default({graphics:e,enableRotation:r,enableScaling:s,preserveAspectRatio:n,layer:this._internalGraphicsLayer,view:i,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"})}})}async _getReshape(e,t,i){var r,s;const n="split"===(null==(r=t.reshapeOptions)?void 0:r.edgeOperation),o="move"===(null==(s=t.reshapeOptions)?void 0:s.shapeOperation),l=await this._requireModule(import("./Reshape.61e47a37.js"));return bwe(l)?l:new l.module.default({enableMidpoints:n,enableMovement:o,graphic:e[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:i,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:a({},e),type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:i,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:r},type:"update"}),onMove:({dx:e,dy:t,mover:i,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:r},type:"update"}),onMoveStop:({dx:e,dy:t,mover:i,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:i,type:r},type:"update"}),onVertexAdd:({added:e,type:t,vertices:i})=>{const r=e.map((e=>mb(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:r,vertices:i,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:i})=>{const r=e.map((e=>mb(e.geometry)));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:r,vertices:i,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;switch(i.type){case"graphic-mover":return[i.on("graphic-click",(({graphic:t,viewEvent:i})=>{var r;null!=(r=i.native)&&r.shiftKey&&(i.stopPropagation(),e.removeFromSelection(t))})),i.on("graphic-move-start",(t=>e.addToHistory(vwe(t.allGraphics))))];case"box":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(vwe(t.graphics)))),i.on("rotate-start",(t=>e.addToHistory(vwe(t.graphics)))),i.on("scale-start",(t=>e.addToHistory(vwe(t.graphics))))];case"reshape":return[i.on("graphic-click",(i=>this._onTransformOrReshape2DGraphicClick(e,t,i))),i.on("move-start",(t=>e.addToHistory(vwe([t.mover])))),i.on("reshape-start",(t=>e.addToHistory(vwe([t.graphic])))),i.on("vertex-add",(t=>e.addToHistory(vwe([t.oldGraphic])))),i.on("vertex-remove",(t=>e.addToHistory(vwe([t.oldGraphic]))))];case"move-3d":return[i.on("graphic-move-start",(t=>{e.addToHistory(vwe(t.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:t.allGraphics.length>0?t.allGraphics[0]:null,type:"move-start"},type:"update"})})),i.on("graphic-move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move"},type:"update"})})),i.on("graphic-move-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.allGraphics.length>0?e.allGraphics[0]:null,type:"move-stop"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"transform-3d":return[i.on("record-undo",(({record:t})=>{e.addToHistory({updates:[t]})})),i.on("graphic-translate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})})),i.on("graphic-translate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})})),i.on("graphic-rotate-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-start"},type:"update"})})),i.on("graphic-rotate-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})})),i.on("graphic-scale-start",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})})),i.on("graphic-scale-stop",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})})),i.on("graphic-translate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})})),i.on("graphic-rotate",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,angle:e.angle,type:"rotate"},type:"update"})})),i.on("graphic-scale",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"reshape-3d":return[i.on("reshape",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("move",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-add",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("vertex-remove",(e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})})),i.on("immediate-click",(i=>{i.shiftKey?this._toggleSelection([i.graphic],e,t):e.toggleTool()}))];case"draw":case"draw-3d":return null;default:return}}_onTransformOrReshape2DGraphicClick(e,t,i){var r;const{graphic:s,viewEvent:n}=i;return null!=(r=n.native)&&r.shiftKey?(n.stopPropagation(),e.removeFromSelection(s)):t.toggleToolOnClick?(n.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view.map;this._disablePopup(t);e.on("complete",(()=>{if(e===this._operationHandle){const r=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:r,state:"complete",aborted:e.cancelled,tool:s,toolEventInfo:null,type:"update"})}}))}async _getCommonUpdateOperationClickHandlers(e,t,i){const r=wJ(t),s=(await t.async((()=>this._getFirstHit(r)))).results;s.length&&(t.native.shiftKey&&this._toggleSelection(s.map((e=>e.graphic)),e,i)||s.some((e=>e.graphic&&this.updateGraphics.includes(e.graphic))))?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const r=!!i.multipleSelectionEnabled;return e.some((e=>!(null==e||!r||e.layer!==this.layer||(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),0))))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===Ooe.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===Ooe.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===Ooe.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&Ooe.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,i=this.updateGraphics.toArray();v(t)||"reshape-3d"===t.type||("reshape"!==t.type||1===i.length&&"point"===R(i[0].geometry,"type"))&&(e.stopPropagation(),this.delete())}_drawMultipointGraphic(e,t,i){let r=null;if(!i&&t.length>1){const i=t.slice(0);i.pop(),r=e.createMultipoint(i,this.view.spatialReference)}else r=e.createMultipoint(t,this.view.spatialReference);this.createGraphic?this.createGraphic.geometry=r:this._set("createGraphic",new fE(r,this.pointSymbol)),i&&1===t.length&&this._internalGraphicsLayer.add(this.createGraphic)}_drawVertexGraphics(e,t,i,r){if(!i.length)return;const{_doUnnormalization:s,activeLineSymbol:n,activeVertexSymbol:o,polygonSymbol:a,polylineSymbol:l,vertexSymbol:h,view:{spatialReference:c}}=this,u=!(!r||!r.userClicked),p="polygon"===t,d=p?a:l;if(1===i.length){this._removeLineGraphic(),this._removeActiveLineGraphic();const t=this.createPointFromVertex(i[0]),r=p?e.createPolygon([i],c,s,!0):e.createPolyline([i],c,s);this._vertexGraphics.length?this._vertexGraphics[0].geometry=t:this._vertexGraphics.push(new fE(t,o)),this.createGraphic?this.createGraphic.set({geometry:r,symbol:d}):this._set("createGraphic",new fE(r,d)),u&&this._internalGraphicsLayer.add(this._vertexGraphics[0])}else if(2===i.length){const t=this.createPointFromVertex(i[1]),r=e.createPolyline([i],c,s),n=p?e.createPolygon([i],c,s,!0):e.createPolyline([i],c,s);if(!this._vertexGraphics.length){const e=this.createPointFromVertex(i[0]),t=new fE(e,h);this._vertexGraphics.push(t)}if(1===this._vertexGraphics.length){const e=this._vertexGraphics[0],i=new fE(t,h);this._removeLineGraphic(),this._removeActiveFillGraphic(),this._vertexGraphics.push(i),this._internalGraphicsLayer.remove(e),this._internalGraphicsLayer.add(e)}else this._vertexGraphics[1].geometry=t;this._showActiveLineGraphic(r);const o=this._vertexGraphics[0];u&&(this._activeLineGraphic.symbol=l,o.symbol=h,this._internalGraphicsLayer.add(this._vertexGraphics[1])),this.createGraphic?this.createGraphic.set({geometry:n,symbol:d}):this._set("createGraphic",new fE(n,d)),this._internalGraphicsLayer.remove(o),this._internalGraphicsLayer.add(o)}else if(i.length>2){const r=p?e.createPolygon([i],c,s,!0):e.createPolyline([i],c,s);"polygon"===t&&this._showFillGraphic(r);const a=i.map((e=>e.slice())),f=a.pop(),y=[a[a.length-1],f],g=e.createPolyline([a],c,s),m=e.createPolyline([y],c,s);this._showLineGraphic(g),this._showActiveLineGraphic(m);for(let e=0;e<a.length;e++){const t=this._vertexGraphics[e];if(t)u||e!==this._vertexGraphics.length-1?t.symbol=h:t.symbol=o;else{const t=this.createPointFromVertex(i[e]);this._showVertexGraphic(t)}}if(u){this._activeLineGraphic.symbol=l;const e=i.length-1,t=this.createPointFromVertex(i[e]);this._showVertexGraphic(t)}else this._activeLineGraphic.symbol=n;this.createGraphic?this.createGraphic.set({geometry:r,symbol:d}):(this._removeCreateGraphic(),this._set("createGraphic",new fE(r,d)));for(const e of this._vertexGraphics)this._internalGraphicsLayer.remove(e),this._internalGraphicsLayer.add(e)}}_drawSegmentGraphic(e,t,i,r,s){if(!i.length)return;const n=!(null==r||!r.centered),o=!(null==r||!r.constrainToggle);let a;1===i.length?this._removeCenterIndicatorGraphic():("rectangle"===t?a=o?e.createSquare(i,s,n):e.createRectangle(i,s,n):"circle"===t&&(a=o?e.createEllipse(i,s,n):e.createCircle(i,s,n,this.view.resolution)),m(a)&&a.extent&&a.extent.center&&this._showCenterIndicatorGraphic(a.extent.center)),a?this.createGraphic?this.createGraphic.geometry=a:(this._removeCreateGraphic(),this._set("createGraphic",new fE(a,this.polygonSymbol)),this._internalGraphicsLayer.add(this.createGraphic)):this._removeCreateGraphic()}_showCenterIndicatorGraphic(e){this._centerIndicatorGraphic?this._centerIndicatorGraphic.geometry=e:(this._centerIndicatorGraphic=new fE(e,this._centerSymbol),this._internalGraphicsLayer.add(this._centerIndicatorGraphic))}_removeCenterIndicatorGraphic(){this._centerIndicatorGraphic&&(this._internalGraphicsLayer.remove(this._centerIndicatorGraphic),this._centerIndicatorGraphic.destroy(),this._centerIndicatorGraphic=null)}_showActiveLineGraphic(e){this._activeLineGraphic?(this._activeLineGraphic.set({geometry:e,symbol:this.activeLineSymbol}),this._internalGraphicsLayer.remove(this._activeLineGraphic)):this._activeLineGraphic=new fE(e,this.activeLineSymbol),this._internalGraphicsLayer.add(this._activeLineGraphic)}_showFillGraphic(e){this._activeFillGraphic?(this._activeFillGraphic.set({geometry:e,symbol:this.activeFillSymbol}),this._internalGraphicsLayer.remove(this._activeFillGraphic)):this._activeFillGraphic=new fE(e,this.activeFillSymbol),this._internalGraphicsLayer.add(this._activeFillGraphic)}_showLineGraphic(e){this._lineGraphic?(this._lineGraphic.set({geometry:e,symbol:this.polylineSymbol}),this._internalGraphicsLayer.remove(this._lineGraphic)):this._lineGraphic=new fE(e,this.polylineSymbol),this._internalGraphicsLayer.add(this._lineGraphic)}_showVertexGraphic(e,t){const i=t?this.activeVertexSymbol:this.vertexSymbol,r=new fE(e,i);this._vertexGraphics.push(r),this._internalGraphicsLayer.add(r)}_resetCreateOperationGraphics(){this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeActiveLineGraphic(),this._removeVertexGraphics()}_removeCreateGraphic(){this.createGraphic&&(this._internalGraphicsLayer.remove(this.createGraphic),this._set("createGraphic",null))}_removeCreateOperationGraphics(){this._removeCenterIndicatorGraphic(),this._removeActiveLineGraphic(),this._removeActiveFillGraphic(),this._removeLineGraphic(),this._removeVertexGraphics()}_removeActiveLineGraphic(){this._activeLineGraphic&&(this._internalGraphicsLayer.remove(this._activeLineGraphic),this._activeLineGraphic.destroy(),this._activeLineGraphic=null)}_removeActiveFillGraphic(){this._activeFillGraphic&&(this._internalGraphicsLayer.remove(this._activeFillGraphic),this._activeFillGraphic.destroy(),this._activeFillGraphic=null)}_removeLineGraphic(){this._lineGraphic&&(this._internalGraphicsLayer.remove(this._lineGraphic),this._lineGraphic.destroy(),this._lineGraphic=null)}_removeVertexGraphics(){this._vertexGraphics.length&&(this._internalGraphicsLayer.removeMany(this._vertexGraphics),this._vertexGraphics.forEach((e=>e.destroy())),this._vertexGraphics=[])}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer.destroy(),this._internalGraphicsLayer=null)}_operationHandleForCreateAction(e,t,i){return new hwe({activeComponent:this._draw,tool:i,type:"create",onEnd:()=>{t.forEach((e=>e.remove())),t.length=0,this._removeCreateOperationGraphics(),this._internalGraphicsLayer&&this._internalGraphicsLayer.remove(this.createGraphic),this._displayDefaultCursor()},undo:()=>{e.undo(),this._emitUndoEvent({graphics:[this.createGraphic],tool:i})},redo:()=>{e.redo(),this._emitRedoEvent({graphics:[this.createGraphic],tool:i})},canUndo:()=>e&&e.canUndo(),canRedo:()=>e&&e.canRedo()})}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||v(t))&&(!(!e.attributes||!e.attributes.esriSketchTool)||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_snapLastPolygonVertexToFirst(e,t){if("polygon"!==e&&t.length<=2)return;const i=t[0],r=t[t.length-1],s=this.view.toScreen(new il(i[0],i[1],this.view.spatialReference)),n=this.view.toScreen(new il(r[0],r[1],this.view.spatialReference));this._isWithinScreenDistance(s,n,this._getVertexIntersectDistance())&&(r[0]=i[0],r[1]=i[1])}_getVertexIntersectDistance(){return this.vertexSymbol&&"simple-marker"===this.vertexSymbol.type?LS(this.vertexSymbol.size)/2+3:3}_isWithinScreenDistance(e,t,i){const r=e.x-t.x,s=e.y-t.y;return Math.sqrt(r*r+s*s)<=i}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayCrosshairCursor(){this.view&&this.view.container&&"crosshair"!==this.view.cursor&&(this.view.cursor="crosshair")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(e,t,i){uwe.error(new Be(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",l(a({},e),{type:"undo"}))}_emitRedoEvent(e){this.emit("redo",l(a({},e),{type:"redo"}))}_emitDeleteEvent(e){this.emit("delete",l(a({},e),{type:"delete"}))}createPointFromVertex(e){return e.length>2?new il(e[0],e[1],e[2],this.view.spatialReference):new il(e[0],e[1],this.view.spatialReference)}test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:dwe}}wait(){return zh(this,"updating")}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(e){var t;return"3d"!==(null==(t=this.view)?void 0:t.type)||this.updateOnGraphicClick||m(e)&&e.toggleToolOnClick}_disablePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&v(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=t.autoOpenEnabled,t.autoOpenEnabled=!1)}_restorePopup(e){if(!this._disablePopupEnabled(e))return;const t=this.view.popup;t&&m(this._originalAutoOpenEnabled)&&(t.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}async _waitViewReady(){this.view&&(E(this._viewReadyAbortController),this._viewReadyAbortController=et(),await lt(jh(this.view,"ready"),this._viewReadyAbortController.signal))}};function ywe(e,t){mwe("undo",e.history.undo,e.history.redo,t)}function gwe(e,t){mwe("redo",e.history.redo,e.history.undo,t)}function mwe(e,t,i,r){const s=t.pop().updates,n=[];r.forEach(((t,i)=>{const r=s[i];null!=r&&("geometry"in r&&m(r.geometry)&&(n.push({geometry:t.geometry}),t.geometry=r.geometry),"symbol"in r&&m(r.symbol)&&(n.push({symbol:t.symbol}),t.symbol=r.symbol),"undo"in r&&(n.push(r),r[e](t)))})),i.push({updates:n})}function vwe(e){return{updates:e.map((e=>({geometry:e.geometry})))}}function bwe(e){return"requireError"in e&&"aborted"===e.requireError}Q([ro({readOnly:!0})],fwe.prototype,"_draw",null),Q([ro()],fwe.prototype,"updating",null),Q([ro()],fwe.prototype,"_operationHandle",void 0),Q([ro({readOnly:!0})],fwe.prototype,"activeTool",null),Q([ro()],fwe.prototype,"activeFillSymbol",void 0),Q([ro()],fwe.prototype,"activeLineSymbol",void 0),Q([ro()],fwe.prototype,"activeVertexSymbol",void 0),Q([ro()],fwe.prototype,"allowDeleteKey",void 0),Q([ro({readOnly:!0})],fwe.prototype,"createGraphic",null),Q([ro()],fwe.prototype,"defaultCreateOptions",null),Q([ro()],fwe.prototype,"defaultUpdateOptions",null),Q([ro()],fwe.prototype,"layer",void 0),Q([ro({types:iE})],fwe.prototype,"pointSymbol",void 0),Q([ro({types:iE})],fwe.prototype,"polygonSymbol",void 0),Q([ro({types:iE})],fwe.prototype,"polylineSymbol",void 0),Q([ro({type:nwe,nonNullable:!0})],fwe.prototype,"snappingOptions",null),Q([ro()],fwe.prototype,"_snappingManager",void 0),Q([ro({readOnly:!0})],fwe.prototype,"state",null),Q([ro({readOnly:!0})],fwe.prototype,"updateGraphics",void 0),Q([ro()],fwe.prototype,"updateOnGraphicClick",void 0),Q([ro({types:iE})],fwe.prototype,"updatePointSymbol",void 0),Q([ro({types:iE})],fwe.prototype,"updatePolygonSymbol",void 0),Q([ro({types:iE})],fwe.prototype,"updatePolylineSymbol",void 0),Q([ro({types:iE})],fwe.prototype,"vertexSymbol",void 0),Q([ro({value:null})],fwe.prototype,"view",null),Q([ro()],fwe.prototype,"cancel",null),Q([ro()],fwe.prototype,"complete",null),Q([ro()],fwe.prototype,"delete",null),Q([ro()],fwe.prototype,"create",null),Q([ro()],fwe.prototype,"update",null),Q([ro()],fwe.prototype,"undo",null),Q([ro()],fwe.prototype,"redo",null),Q([ro()],fwe.prototype,"canUndo",null),Q([ro()],fwe.prototype,"canRedo",null),Q([ro()],fwe.prototype,"toggleUpdateTool",null),fwe=Q([Ro(cwe)],fwe);var wwe=fwe;let _we=class extends(RV(pU(aU(hU(Lw(Aw(sz(Mw)))))))){constructor(e){super(e),this._visibilityHandles={},this.fullExtent=void 0,this.operationalLayerType="GroupLayer",this.spatialReference=void 0,this.type="group",this._visibilityWatcher=this._visibilityWatcher.bind(this)}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.watch("visible",this._visibleWatcher.bind(this),!0)}_writeLayers(e,t,i,r){const s=[];if(!e)return s;e.forEach((e=>{const t=em(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);m(t)&&t.layerType&&s.push(t)})),t.layers=s}set portalItem(e){this._set("portalItem",e)}set visibilityMode(e){const t=this._get("visibilityMode")!==e;this._set("visibilityMode",e),t&&this._enforceVisibility(e,this.visible)}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection","Scene Service"]},e)),Promise.resolve(this)}loadAll(){return Fg(this,(e=>{e(this.layers)}))}layerAdded(e){e.visible&&"exclusive"===this.visibilityMode?this._turnOffOtherLayers(e):"inherited"===this.visibilityMode&&(e.visible=this.visible),this._visibilityHandles[e.uid]=e.watch("visible",this._visibilityWatcher,!0)}layerRemoved(e){const t=this._visibilityHandles[e.uid];t&&(t.remove(),delete this._visibilityHandles[e.uid]),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach((t=>{t!==e&&(t.visible=!1)}))}_enforceVisibility(e,t){if(!Tr(this).initialized)return;const i=this.layers;let r=i.find((e=>e.visible));switch(e){case"exclusive":i.length&&!r&&(r=i.getItemAt(0),r.visible=!0),this._turnOffOtherLayers(r);break;case"inherited":i.forEach((e=>{e.visible=t}))}}_visibleWatcher(e){"inherited"===this.visibilityMode&&this.layers.forEach((t=>{t.visible=e}))}_visibilityWatcher(e,t,i,r){const s=r;switch(this.visibilityMode){case"exclusive":e?this._turnOffOtherLayers(s):this._isAnyLayerVisible()||(s.visible=!0);break;case"inherited":s.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some((e=>e.visible))}};Q([ro()],_we.prototype,"fullExtent",void 0),Q([ro({json:{read:!1,write:{ignoreOrigin:!0}}})],_we.prototype,"layers",void 0),Q([na("layers")],_we.prototype,"_writeLayers",null),Q([ro({type:["GroupLayer"]})],_we.prototype,"operationalLayerType",void 0),Q([ro({json:{origins:{"web-document":{read:!1,write:!1}}}})],_we.prototype,"portalItem",null),Q([ro()],_we.prototype,"spatialReference",void 0),Q([ro({json:{read:!1},readOnly:!0,value:"group"})],_we.prototype,"type",void 0),Q([ro({type:["independent","inherited","exclusive"],value:"independent",json:{write:!0,origins:{"web-map":{read:!1,write:!1}}}})],_we.prototype,"visibilityMode",null),_we=Q([Ro("esri.layers.GroupLayer")],_we);var xwe,Swe=_we,Mwe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Swe});let Twe=xwe=class extends hS{constructor(e){super(e),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new xwe({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};Q([ro()],Twe.prototype,"displayValueEnabled",void 0),Q([ro()],Twe.prototype,"max",void 0),Q([ro()],Twe.prototype,"min",void 0),Q([ro()],Twe.prototype,"step",void 0),Q([ro()],Twe.prototype,"value",void 0),Twe=xwe=Q([Ro("esri.support.Action.ActionSlider")],Twe);var Iwe=Twe;const Ewe="esri-layer-list-panel",Awe="esri-layer-list-panel__content",Pwe="esri-layer-list-panel__content--legend",Cwe="esri-layer-list-panel__content--string",Owe="esri-layer-list-panel__content--html-element",kwe="esri-layer-list-panel__content--widget";let Lwe=class extends(bw(xy)){constructor(e,t){super(e,t),this._legend=null,this._handles=new Mh,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.own([Rh(this,"content",(e=>this._createLegend(e)))])}destroy(){const{_legend:e}=this;e&&e.destroy(),this._legend=null}get className(){const{image:e}=this,t=this._getFirstWidget();return this._get("className")||!e&&t?t.iconClass:""}set className(e){void 0!==e?this._override("className",e):this._clearOverride("className")}get title(){const e=this._getFirstWidget();return this._get("title")||e?e.label:""}set title(e){void 0!==e?this._override("title",e):this._clearOverride("title")}render(){return Iy("div",{class:Ewe},this._renderContents())}_renderContent(e){const{_legend:t,listItem:i}=this;return e?"legend"===e?i&&i.view&&i.layer&&t?Iy("div",{class:this.classes(Awe,Pwe),key:t},t.render()):null:"string"==typeof e?Iy("div",{class:this.classes(Awe,Cwe),key:e,innerHTML:e}):zy(e)?Iy("div",{class:this.classes(Awe,kwe),key:e},e.render()):e instanceof HTMLElement?Iy("div",{class:this.classes(Awe,Owe),key:e,bind:e,afterCreate:this._attachToNode}):null:null}_renderContents(){const{content:e}=this;return Array.isArray(e)?e.map((e=>this._renderContent(e))):this._renderContent(e)}_getLegendOptions(e){if(!e)return;const{layer:t,view:i}=e;return t&&i?{view:i,layerInfos:[{layer:t,title:""}]}:void 0}_createLegend(e){this._hasLegend(e)&&!this._legend&&Promise.resolve().then((function(){return DAe})).then((({default:e})=>{const{_handles:t,listItem:i}=this,r=new e(this._getLegendOptions(i));this._legend=r,this.notifyChange("className"),this.notifyChange("title");const s=Rh(this,["listItem.view","listItem.layer"],(()=>this._updateLegend(r)));t.add(s,"legends"),this.scheduleRender()}))}_hasLegend(e){const t="legend";return e===t||!!Array.isArray(e)&&e.some((e=>e===t))}_attachToNode(e){e.appendChild(this)}_updateLegend(e){const{listItem:t}=this;if(!t)return;const{layer:i,view:r}=t;e.view=r,e.layerInfos=[{layer:i,title:null}],this.scheduleRender()}_getWidget(e){return"legend"===e?this._legend:zy(e)?e:null}_getFirstWidget(){const{content:e}=this;if(Array.isArray(e)){let t=null;return e.some((e=>{const i=this._getWidget(e);return i&&(t=i),!!i})),t}return this._getWidget(e)}};Q([ro()],Lwe.prototype,"className",null),Q([ro()],Lwe.prototype,"content",void 0),Q([ro()],Lwe.prototype,"image",void 0),Q([ro()],Lwe.prototype,"listItem",void 0),Q([ro()],Lwe.prototype,"title",null),Q([ro()],Lwe.prototype,"open",void 0),Q([ro()],Lwe.prototype,"visible",void 0),Lwe=Q([Ro("esri.widgets.LayerList.ListItemPanel")],Lwe);var Rwe=Lwe;const Dwe="hide",Fwe="hide-children";function jwe(e){if(e)return null!=e.listMode?e.listMode:void 0}function Nwe(e){if(e)return e.listMode===Fwe||"wmts"===e.type?void 0:"group"===e.type?"layers":"sublayers"}function zwe(e,t){e&&e.sort(((e,i)=>{const r=t.indexOf(e.uid),s=t.indexOf(i.uid);return r>s?-1:r<s?1:0}))}function Vwe(e){const t=null==e?void 0:e.layer;return t&&"group"===t.type?t.layers:null}function Uwe(e,t){var i;const r=null==(i=e.layer)?void 0:i.uid;return r&&t.find((e=>{var t;return(null==(t=e.layer)?void 0:t.uid)===r}))}var Gwe;const Bwe=xh.ofType({key:"type",defaultKeyValue:"button",base:hS,typeMap:{button:pS,toggle:yS,slider:Iwe}}),qwe=xh.ofType(Bwe),Hwe="layer",Wwe="child-list-mode";let $we=Gwe=class extends(bw($v(jo))){constructor(e){super(e),this.actionsSections=new qwe,this.actionsOpen=!1,this.children=new(xh.ofType(Gwe)),this.childrenSortable=!0,this.error=null,this.layer=null,this.layerView=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null,this.visible=null}initialize(){this.handles.add([Rh(this,"layer",(e=>this._watchLayerProperties(e))),Rh(this,"view",(e=>this._updateChildren(e))),Rh(this,"panel",(e=>this._setListItemOnPanel(e))),Rh(this,["layer","view"],(()=>this._getLayerView()))])}destroy(){this.view=null}castPanel(e){return this.get("panel.open")&&!e.hasOwnProperty("open")&&(e.open=!0),e?new Rwe(e):null}get title(){const e=this.get("layer.layer");return(!e||e&&this.get("layer.layer.loaded"))&&this.get("layer.title")||this.get("layer.attributes.title")||""}set title(e){void 0!==e?this._override("title",e):this._clearOverride("title")}get updating(){const e=this.layerView;return e?e.updating:this._isLayerUpdating(this.layer)}get visibleAtCurrentScale(){return!function(e,t){if(!e||isNaN(t))return!1;const i=function(e){if(e)return null!=e.minScale?e.minScale:void 0}(e),r=function(e){if(e)return null!=e.maxScale?e.maxScale:void 0}(e),s=!isNaN(i)&&i>0&&t>i,n=!isNaN(r)&&r>0&&t<r;return s||n}(this.layer,this.get("view.scale"))}get visibilityMode(){return function(e){if(!e)return"inherited";const t=e.get("layer.capabilities.exportMap.supportsSublayerVisibility");if("boolean"==typeof t)return t?"independent":"inherited";const i=e.get("capabilities.exportMap.supportsSublayerVisibility");return"boolean"==typeof i?i?"independent":"inherited":null!=e.visibilityMode?e.visibilityMode:"independent"}(this.layer)}clone(){return new Gwe({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,children:this.children.clone(),layer:this.layer,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildren(e){const t=this.children;t&&t.forEach((t=>t.view=e))}_addChildren(e){if(this.handles.remove(Wwe),this.children.removeAll(),!e)return;e.forEach((t=>{this.handles.add(Dh(t,"listMode",(()=>this._addChildren(e))),Wwe)}));const t=e.filter((e=>"hide"!==jwe(e)));this.children.addMany(this._makeChildren(t))}_watchSublayerChanges(e){e&&this.handles.add(e.on("change",(()=>{this._addChildren(e)})),Hwe)}_initializeChildLayers(e){this._addChildren(e),this._watchSublayerChanges(e)}_makeChildren(e){return e.map((e=>function(e){return jwe(e)!==Dwe}(e)?new Gwe({layer:e,parent:this,view:this.view}):null)).reverse()}_watchLayerProperties(e){if(!this.handles)return;if(this.handles.remove(Hwe),this.handles.remove(Wwe),!e)return;if(this.handles.add(Dh(e,"listMode",(()=>this._watchLayerProperties(e))),Hwe),"hide-children"===jwe(e))return void this.children.removeAll();const t=Nwe(e);t&&this.handles.add(Rh(e,t,(()=>{e.hasOwnProperty(t)&&this._initializeChildLayers(e[t])})),Hwe)}async _getLayerView(){const{layer:e,view:t}=this;if(e&&t)try{const i=await t.whenLayerView(e);if(i.layer!==this.layer)return;this._set("layerView",i)}catch{}}_isLayerUpdating(e){return e&&"loading"===e.loadStatus}};Q([ro({type:qwe})],$we.prototype,"actionsSections",void 0),Q([ro()],$we.prototype,"actionsOpen",void 0),Q([ro({type:xh})],$we.prototype,"children",void 0),Q([ro()],$we.prototype,"childrenSortable",void 0),Q([eh("layer.loadError?")],$we.prototype,"error",void 0),Q([ro()],$we.prototype,"layer",void 0),Q([ro({readOnly:!0})],$we.prototype,"layerView",void 0),Q([ro()],$we.prototype,"open",void 0),Q([ro({type:Rwe})],$we.prototype,"panel",void 0),Q([Ra("panel")],$we.prototype,"castPanel",null),Q([ro()],$we.prototype,"parent",void 0),Q([ro()],$we.prototype,"sortable",void 0),Q([ro()],$we.prototype,"title",null),Q([ro({readOnly:!0})],$we.prototype,"updating",null),Q([ro({value:null})],$we.prototype,"view",void 0),Q([eh("layer.visible")],$we.prototype,"visible",void 0),Q([ro({readOnly:!0})],$we.prototype,"visibleAtCurrentScale",null),Q([ro({readOnly:!0})],$we.prototype,"visibilityMode",null),$we=Gwe=Q([Ro("esri.widgets.LayerList.ListItem")],$we);var Jwe=$we;const Xwe="view",Kwe="view-layers",Ywe="map-layers",Zwe="layer-views",Qwe="layer-list-mode",e_e=xh.ofType(Jwe);let t_e=class extends sh.EventedAccessor{constructor(e){super(e),this._handles=new Mh,this.listItemCreatedFunction=null,this.operationalItems=new e_e,this.view=null}initialize(){this._handles.add(Rh(this,["view","view.ready"],(()=>this._viewHandles())),Xwe)}destroy(){this._handles.destroy(),this._handles=null,this.view=null,this.operationalItems.removeAll()}get state(){const e=this.get("view");return this.get("view.ready")?"ready":e?"loading":"disabled"}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,i,r){var s,n;const o=null==e?void 0:e.layer;if(!o)return;const a=null==(s=this.view)||null==(n=s.map)?void 0:n.layers,l=t?Vwe(t):a,h=i?Vwe(i):a;if(!l||!h)return;const{operationalItems:c}=this,u=(null==t?void 0:t.children)||c,p=(null==i?void 0:i.children)||c,d=h.length-r;e.parent=i||null,u.includes(e)&&u.remove(e),l.includes(o)&&l.remove(o),p.includes(e)||p.add(e,d),h.includes(o)||h.add(o,d)}_createLayerViewHandles(e){const{_handles:t}=this;t.remove(Zwe),this._compileList(),e&&t.add(e.on("change",(()=>this._compileList())),Zwe)}_createMapLayerHandles(e){const{_handles:t}=this;t.remove(Ywe),this._compileList(),e&&t.add(e.on("change",(()=>this._compileList())),Ywe)}_watchItemProperties(e){this._handles.add([e.children.on("change",(()=>{this._modifyListItemChildren(e.children)}))],`children-change-${e.uid}`)}_modifyListItemChildren(e){e.forEach((e=>this._modifyListItem(e)))}_modifyListItem(e){if("function"==typeof this.listItemCreatedFunction){const t={item:e};this.listItemCreatedFunction.call(null,t)}this._modifyListItemChildren(e.children)}_createListItem(e){const{view:t}=this,i=new Jwe({layer:e,view:t});return this._watchItemProperties(i),i}_removeAllItems(){const{_handles:e,operationalItems:t}=this;t.forEach((t=>{e.remove(`children-change-${t.uid}`)})),t.removeAll()}_getViewableLayers(e){if(e)return e.filter((e=>"hide"!==jwe(e)))}_watchLayersListMode(e){const{_handles:t}=this;t.remove(Qwe),e&&e.forEach((e=>{t.add(Dh(e,"listMode",(()=>this._compileList())),Qwe)}))}_compileList(){const e=this.get("view.map.layers");this._watchLayersListMode(e);const t=this._getViewableLayers(e);t&&t.length?(this._createNewItems(t),this._modifyOrRemoveItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach((e=>{t.find((t=>t.layer===e))||t.add(this._createListItem(e))}))}_modifyOrRemoveItems(e){const{_handles:t,operationalItems:i}=this,r=[];i.forEach((i=>{i&&e&&e.find((e=>i.layer===e))?this._modifyListItem(i):(t.remove(`children-change-${i.uid}`),r.push(i))})),i.removeMany(r)}_sortItems(e){const{operationalItems:t}=this;t.sort(((t,i)=>{const r=e.indexOf(t.layer),s=e.indexOf(i.layer);return r>s?-1:r<s?1:0}))}_viewHandles(){const{_handles:e,view:t}=this;e.remove([Ywe,Zwe,Kwe]),this._compileList(),t&&t.ready&&e.add([Rh(this,"view.map.allLayers",(e=>this._createMapLayerHandles(e))),Rh(this,"view.allLayerViews",(e=>this._createLayerViewHandles(e))),Rh(this,"listItemCreatedFunction",(()=>this._compileList()))],Kwe)}};Q([ro()],t_e.prototype,"listItemCreatedFunction",void 0),Q([ro({type:e_e})],t_e.prototype,"operationalItems",void 0),Q([ro({readOnly:!0})],t_e.prototype,"state",null),Q([ro()],t_e.prototype,"view",void 0),t_e=Q([Ro("esri.widgets.LayerList.LayerListViewModel")],t_e);var i_e=t_e;
/**!
 * Sortable 1.13.0
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function r_e(e){return(r_e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s_e(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n_e(){return(n_e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}).apply(this,arguments)}function o_e(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{},r=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(i).filter((function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable})))),r.forEach((function(t){s_e(e,t,i[t])}))}return e}function a_e(e,t){if(null==e)return{};var i,r,s=function(e,t){if(null==e)return{};var i,r,s={},n=Object.keys(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||(s[i]=e[i]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)i=n[r],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}function l_e(e){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(e)}var h_e=l_e(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),c_e=l_e(/Edge/i),u_e=l_e(/firefox/i),p_e=l_e(/safari/i)&&!l_e(/chrome/i)&&!l_e(/android/i),d_e=l_e(/iP(ad|od|hone)/i),f_e=l_e(/chrome/i)&&l_e(/android/i),y_e={capture:!1,passive:!1};function g_e(e,t,i){e.addEventListener(t,i,!h_e&&y_e)}function m_e(e,t,i){e.removeEventListener(t,i,!h_e&&y_e)}function v_e(e,t){if(t){if(">"===t[0]&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch(i){return!1}return!1}}function b_e(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function w_e(e,t,i,r){if(e){i=i||document;do{if(null!=t&&(">"===t[0]?e.parentNode===i&&v_e(e,t):v_e(e,t))||r&&e===i)return e;if(e===i)break}while(e=b_e(e))}return null}var __e,x_e=/\s+/g;function S_e(e,t,i){if(e&&t)if(e.classList)e.classList[i?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(x_e," ").replace(" "+t+" "," ");e.className=(r+(i?" "+t:"")).replace(x_e," ")}}function M_e(e,t,i){var r=e&&e.style;if(r){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in r||-1!==t.indexOf("webkit")||(t="-webkit-"+t),r[t]=i+("string"==typeof i?"":"px")}}function T_e(e,t){var i="";if("string"==typeof e)i=e;else do{var r=M_e(e,"transform");r&&"none"!==r&&(i=r+" "+i)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(i)}function I_e(e,t,i){if(e){var r=e.getElementsByTagName(t),s=0,n=r.length;if(i)for(;s<n;s++)i(r[s],s);return r}return[]}function E_e(){var e=document.scrollingElement;return e||document.documentElement}function A_e(e,t,i,r,s){if(e.getBoundingClientRect||e===window){var n,o,a,l,h,c,u;if(e!==window&&e.parentNode&&e!==E_e()?(o=(n=e.getBoundingClientRect()).top,a=n.left,l=n.bottom,h=n.right,c=n.height,u=n.width):(o=0,a=0,l=window.innerHeight,h=window.innerWidth,c=window.innerHeight,u=window.innerWidth),(t||i)&&e!==window&&(s=s||e.parentNode,!h_e))do{if(s&&s.getBoundingClientRect&&("none"!==M_e(s,"transform")||i&&"static"!==M_e(s,"position"))){var p=s.getBoundingClientRect();o-=p.top+parseInt(M_e(s,"border-top-width")),a-=p.left+parseInt(M_e(s,"border-left-width")),l=o+n.height,h=a+n.width;break}}while(s=s.parentNode);if(r&&e!==window){var d=T_e(s||e),f=d&&d.a,y=d&&d.d;d&&(l=(o/=y)+(c/=y),h=(a/=f)+(u/=f))}return{top:o,left:a,bottom:l,right:h,width:u,height:c}}}function P_e(e,t,i){for(var r=R_e(e,!0),s=A_e(e)[t];r;){var n=A_e(r)[i];if(!("top"===i||"left"===i?s>=n:s<=n))return r;if(r===E_e())break;r=R_e(r,!1)}return!1}function C_e(e,t,i){for(var r=0,s=0,n=e.children;s<n.length;){if("none"!==n[s].style.display&&n[s]!==Fxe.ghost&&n[s]!==Fxe.dragged&&w_e(n[s],i.draggable,e,!1)){if(r===t)return n[s];r++}s++}return null}function O_e(e,t){for(var i=e.lastElementChild;i&&(i===Fxe.ghost||"none"===M_e(i,"display")||t&&!v_e(i,t));)i=i.previousElementSibling;return i||null}function k_e(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)"TEMPLATE"===e.nodeName.toUpperCase()||e===Fxe.clone||t&&!v_e(e,t)||i++;return i}function L_e(e){var t=0,i=0,r=E_e();if(e)do{var s=T_e(e),n=s.a,o=s.d;t+=e.scrollLeft*n,i+=e.scrollTop*o}while(e!==r&&(e=e.parentNode));return[t,i]}function R_e(e,t){if(!e||!e.getBoundingClientRect)return E_e();var i=e,r=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var s=M_e(i);if(i.clientWidth<i.scrollWidth&&("auto"==s.overflowX||"scroll"==s.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==s.overflowY||"scroll"==s.overflowY)){if(!i.getBoundingClientRect||i===document.body)return E_e();if(r||t)return i;r=!0}}}while(i=i.parentNode);return E_e()}function D_e(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}function F_e(e,t){return function(){if(!__e){var i=arguments,r=this;1===i.length?e.call(r,i[0]):e.apply(r,i),__e=setTimeout((function(){__e=void 0}),t)}}}function j_e(e,t,i){e.scrollLeft+=t,e.scrollTop+=i}function N_e(e){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):i?i(e).clone(!0)[0]:e.cloneNode(!0)}var z_e="Sortable"+(new Date).getTime();function V_e(){var e,t=[];return{captureAnimationState:function(){(t=[],this.options.animation)&&[].slice.call(this.el.children).forEach((function(e){if("none"!==M_e(e,"display")&&e!==Fxe.ghost){t.push({target:e,rect:A_e(e)});var i=o_e({},t[t.length-1].rect);if(e.thisAnimationDuration){var r=T_e(e,!0);r&&(i.top-=r.f,i.left-=r.e)}e.fromRect=i}}))},addAnimationState:function(e){t.push(e)},removeAnimationState:function(e){t.splice(function(e,t){for(var i in e)if(e.hasOwnProperty(i))for(var r in t)if(t.hasOwnProperty(r)&&t[r]===e[i][r])return Number(i);return-1}(t,{target:e}),1)},animateAll:function(i){var r=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof i&&i());var s=!1,n=0;t.forEach((function(e){var t=0,i=e.target,o=i.fromRect,a=A_e(i),l=i.prevFromRect,h=i.prevToRect,c=e.rect,u=T_e(i,!0);u&&(a.top-=u.f,a.left-=u.e),i.toRect=a,i.thisAnimationDuration&&D_e(l,a)&&!D_e(o,a)&&(c.top-a.top)/(c.left-a.left)==(o.top-a.top)/(o.left-a.left)&&(t=function(e,t,i,r){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*r.animation}(c,l,h,r.options)),D_e(a,o)||(i.prevFromRect=o,i.prevToRect=a,t||(t=r.options.animation),r.animate(i,c,a,t)),t&&(s=!0,n=Math.max(n,t),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout((function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null}),t),i.thisAnimationDuration=t)})),clearTimeout(e),s?e=setTimeout((function(){"function"==typeof i&&i()}),n):"function"==typeof i&&i(),t=[]},animate:function(e,t,i,r){if(r){M_e(e,"transition",""),M_e(e,"transform","");var s=T_e(this.el),n=s&&s.a,o=s&&s.d,a=(t.left-i.left)/(n||1),l=(t.top-i.top)/(o||1);e.animatingX=!!a,e.animatingY=!!l,M_e(e,"transform","translate3d("+a+"px,"+l+"px,0)"),this.forRepaintDummy=function(e){return e.offsetWidth}(e),M_e(e,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),M_e(e,"transform","translate3d(0,0,0)"),"number"==typeof e.animated&&clearTimeout(e.animated),e.animated=setTimeout((function(){M_e(e,"transition",""),M_e(e,"transform",""),e.animated=!1,e.animatingX=!1,e.animatingY=!1}),r)}}}}var U_e=[],G_e={initializeByDefault:!0},B_e={mount:function(e){for(var t in G_e)G_e.hasOwnProperty(t)&&!(t in e)&&(e[t]=G_e[t]);U_e.forEach((function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")})),U_e.push(e)},pluginEvent:function(e,t,i){var r=this;this.eventCanceled=!1,i.cancel=function(){r.eventCanceled=!0};var s=e+"Global";U_e.forEach((function(r){t[r.pluginName]&&(t[r.pluginName][s]&&t[r.pluginName][s](o_e({sortable:t},i)),t.options[r.pluginName]&&t[r.pluginName][e]&&t[r.pluginName][e](o_e({sortable:t},i)))}))},initializePlugins:function(e,t,i,r){for(var s in U_e.forEach((function(r){var s=r.pluginName;if(e.options[s]||r.initializeByDefault){var n=new r(e,t,e.options);n.sortable=e,n.options=e.options,e[s]=n,n_e(i,n.defaults)}})),e.options)if(e.options.hasOwnProperty(s)){var n=this.modifyOption(e,s,e.options[s]);void 0!==n&&(e.options[s]=n)}},getEventProperties:function(e,t){var i={};return U_e.forEach((function(r){"function"==typeof r.eventProperties&&n_e(i,r.eventProperties.call(t[r.pluginName],e))})),i},modifyOption:function(e,t,i){var r;return U_e.forEach((function(s){e[s.pluginName]&&s.optionListeners&&"function"==typeof s.optionListeners[t]&&(r=s.optionListeners[t].call(e[s.pluginName],i))})),r}};var q_e=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.evt,s=a_e(i,["evt"]);B_e.pluginEvent.bind(Fxe)(e,t,o_e({dragEl:W_e,parentEl:$_e,ghostEl:J_e,rootEl:X_e,nextEl:K_e,lastDownEl:Y_e,cloneEl:Z_e,cloneHidden:Q_e,dragStarted:pxe,putSortable:nxe,activeSortable:Fxe.active,originalEvent:r,oldIndex:exe,oldDraggableIndex:ixe,newIndex:txe,newDraggableIndex:rxe,hideGhostForTarget:kxe,unhideGhostForTarget:Lxe,cloneNowHidden:function(){Q_e=!0},cloneNowShown:function(){Q_e=!1},dispatchSortableEvent:function(e){H_e({sortable:t,name:e,originalEvent:r})}},s))};function H_e(e){!function(e){var t=e.sortable,i=e.rootEl,r=e.name,s=e.targetEl,n=e.cloneEl,o=e.toEl,a=e.fromEl,l=e.oldIndex,h=e.newIndex,c=e.oldDraggableIndex,u=e.newDraggableIndex,p=e.originalEvent,d=e.putSortable,f=e.extraEventProperties;if(t=t||i&&i[z_e]){var y,g=t.options,m="on"+r.charAt(0).toUpperCase()+r.substr(1);!window.CustomEvent||h_e||c_e?(y=document.createEvent("Event")).initEvent(r,!0,!0):y=new CustomEvent(r,{bubbles:!0,cancelable:!0}),y.to=o||i,y.from=a||i,y.item=s||i,y.clone=n,y.oldIndex=l,y.newIndex=h,y.oldDraggableIndex=c,y.newDraggableIndex=u,y.originalEvent=p,y.pullMode=d?d.lastPutMode:void 0;var v=o_e({},f,B_e.getEventProperties(r,t));for(var b in v)y[b]=v[b];i&&i.dispatchEvent(y),g[m]&&g[m].call(t,y)}}(o_e({putSortable:nxe,cloneEl:Z_e,targetEl:W_e,rootEl:X_e,oldIndex:exe,oldDraggableIndex:ixe,newIndex:txe,newDraggableIndex:rxe},e))}var W_e,$_e,J_e,X_e,K_e,Y_e,Z_e,Q_e,exe,txe,ixe,rxe,sxe,nxe,oxe,axe,lxe,hxe,cxe,uxe,pxe,dxe,fxe,yxe,gxe,mxe=!1,vxe=!1,bxe=[],wxe=!1,_xe=!1,xxe=[],Sxe=!1,Mxe=[],Txe="undefined"!=typeof document,Ixe=d_e,Exe=c_e||h_e?"cssFloat":"float",Axe=Txe&&!f_e&&!d_e&&"draggable"in document.createElement("div"),Pxe=function(){if(Txe){if(h_e)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents}}(),Cxe=function(e,t){var i=M_e(e),r=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),s=C_e(e,0,t),n=C_e(e,1,t),o=s&&M_e(s),a=n&&M_e(n),l=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+A_e(s).width,h=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+A_e(n).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(s&&o.float&&"none"!==o.float){var c="left"===o.float?"left":"right";return!n||"both"!==a.clear&&a.clear!==c?"horizontal":"vertical"}return s&&("block"===o.display||"flex"===o.display||"table"===o.display||"grid"===o.display||l>=r&&"none"===i[Exe]||n&&"none"===i[Exe]&&l+h>r)?"vertical":"horizontal"},Oxe=function(e){function t(e,i){return function(r,s,n,o){var a=r.options.group.name&&s.options.group.name&&r.options.group.name===s.options.group.name;if(null==e&&(i||a))return!0;if(null==e||!1===e)return!1;if(i&&"clone"===e)return e;if("function"==typeof e)return t(e(r,s,n,o),i)(r,s,n,o);var l=(i?r:s).options.group.name;return!0===e||"string"==typeof e&&e===l||e.join&&e.indexOf(l)>-1}}var i={},r=e.group;r&&"object"==r_e(r)||(r={name:r}),i.name=r.name,i.checkPull=t(r.pull,!0),i.checkPut=t(r.put),i.revertClone=r.revertClone,e.group=i},kxe=function(){!Pxe&&J_e&&M_e(J_e,"display","none")},Lxe=function(){!Pxe&&J_e&&M_e(J_e,"display","")};Txe&&document.addEventListener("click",(function(e){if(vxe)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),vxe=!1,!1}),!0);var Rxe=function(e){if(W_e){e=e.touches?e.touches[0]:e;var t=(s=e.clientX,n=e.clientY,bxe.some((function(e){if(!O_e(e)){var t=A_e(e),i=e[z_e].options.emptyInsertThreshold,r=s>=t.left-i&&s<=t.right+i,a=n>=t.top-i&&n<=t.bottom+i;return i&&r&&a?o=e:void 0}})),o);if(t){var i={};for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);i.target=i.rootEl=t,i.preventDefault=void 0,i.stopPropagation=void 0,t[z_e]._onDragOver(i)}}var s,n,o},Dxe=function(e){W_e&&W_e.parentNode[z_e]._isOutsideThisEl(e.target)};function Fxe(e,t){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=n_e({},t),e[z_e]=this;var i={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Cxe(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Fxe.supportPointer&&"PointerEvent"in window&&!p_e,emptyInsertThreshold:5};for(var r in B_e.initializePlugins(this,e,i),i)!(r in t)&&(t[r]=i[r]);for(var s in Oxe(t),this)"_"===s.charAt(0)&&"function"==typeof this[s]&&(this[s]=this[s].bind(this));this.nativeDraggable=!t.forceFallback&&Axe,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?g_e(e,"pointerdown",this._onTapStart):(g_e(e,"mousedown",this._onTapStart),g_e(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(g_e(e,"dragover",this),g_e(e,"dragenter",this)),bxe.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),n_e(this,V_e())}function jxe(e,t,i,r,s,n,o,a){var l,h,c=e[z_e],u=c.options.onMove;return!window.CustomEvent||h_e||c_e?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=t,l.from=e,l.dragged=i,l.draggedRect=r,l.related=s||t,l.relatedRect=n||A_e(t),l.willInsertAfter=a,l.originalEvent=o,e.dispatchEvent(l),u&&(h=u.call(c,l,o)),h}function Nxe(e){e.draggable=!1}function zxe(){Sxe=!1}function Vxe(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,r=0;i--;)r+=t.charCodeAt(i);return r.toString(36)}function Uxe(e){return setTimeout(e,0)}function Gxe(e){return clearTimeout(e)}Fxe.prototype={constructor:Fxe,_isOutsideThisEl:function(e){this.el.contains(e)||e===this.el||(dxe=null)},_getDirection:function(e,t){return"function"==typeof this.options.direction?this.options.direction.call(this,e,t,W_e):this.options.direction},_onTapStart:function(e){if(e.cancelable){var t=this,i=this.el,r=this.options,s=r.preventOnFilter,n=e.type,o=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,a=(o||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||a,h=r.filter;if(function(e){Mxe.length=0;var t=e.getElementsByTagName("input"),i=t.length;for(;i--;){var r=t[i];r.checked&&Mxe.push(r)}}(i),!W_e&&!(/mousedown|pointerdown/.test(n)&&0!==e.button||r.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!p_e||!a||"SELECT"!==a.tagName.toUpperCase())&&!((a=w_e(a,r.draggable,i,!1))&&a.animated||Y_e===a)){if(exe=k_e(a),ixe=k_e(a,r.draggable),"function"==typeof h){if(h.call(this,e,a,this))return H_e({sortable:t,rootEl:l,name:"filter",targetEl:a,toEl:i,fromEl:i}),q_e("filter",t,{evt:e}),void(s&&e.cancelable&&e.preventDefault())}else if(h&&(h=h.split(",").some((function(r){if(r=w_e(l,r.trim(),i,!1))return H_e({sortable:t,rootEl:r,name:"filter",targetEl:a,fromEl:i,toEl:i}),q_e("filter",t,{evt:e}),!0}))))return void(s&&e.cancelable&&e.preventDefault());r.handle&&!w_e(l,r.handle,i,!1)||this._prepareDragStart(e,o,a)}}},_prepareDragStart:function(e,t,i){var r,s=this,n=s.el,o=s.options,a=n.ownerDocument;if(i&&!W_e&&i.parentNode===n){var l=A_e(i);if(X_e=n,$_e=(W_e=i).parentNode,K_e=W_e.nextSibling,Y_e=i,sxe=o.group,Fxe.dragged=W_e,oxe={target:W_e,clientX:(t||e).clientX,clientY:(t||e).clientY},cxe=oxe.clientX-l.left,uxe=oxe.clientY-l.top,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,W_e.style["will-change"]="all",r=function(){q_e("delayEnded",s,{evt:e}),Fxe.eventCanceled?s._onDrop():(s._disableDelayedDragEvents(),!u_e&&s.nativeDraggable&&(W_e.draggable=!0),s._triggerDragStart(e,t),H_e({sortable:s,name:"choose",originalEvent:e}),S_e(W_e,o.chosenClass,!0))},o.ignore.split(",").forEach((function(e){I_e(W_e,e.trim(),Nxe)})),g_e(a,"dragover",Rxe),g_e(a,"mousemove",Rxe),g_e(a,"touchmove",Rxe),g_e(a,"mouseup",s._onDrop),g_e(a,"touchend",s._onDrop),g_e(a,"touchcancel",s._onDrop),u_e&&this.nativeDraggable&&(this.options.touchStartThreshold=4,W_e.draggable=!0),q_e("delayStart",this,{evt:e}),!o.delay||o.delayOnTouchOnly&&!t||this.nativeDraggable&&(c_e||h_e))r();else{if(Fxe.eventCanceled)return void this._onDrop();g_e(a,"mouseup",s._disableDelayedDrag),g_e(a,"touchend",s._disableDelayedDrag),g_e(a,"touchcancel",s._disableDelayedDrag),g_e(a,"mousemove",s._delayedDragTouchMoveHandler),g_e(a,"touchmove",s._delayedDragTouchMoveHandler),o.supportPointer&&g_e(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(r,o.delay)}}},_delayedDragTouchMoveHandler:function(e){var t=e.touches?e.touches[0]:e;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){W_e&&Nxe(W_e),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;m_e(e,"mouseup",this._disableDelayedDrag),m_e(e,"touchend",this._disableDelayedDrag),m_e(e,"touchcancel",this._disableDelayedDrag),m_e(e,"mousemove",this._delayedDragTouchMoveHandler),m_e(e,"touchmove",this._delayedDragTouchMoveHandler),m_e(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,t){t=t||"touch"==e.pointerType&&e,!this.nativeDraggable||t?this.options.supportPointer?g_e(document,"pointermove",this._onTouchMove):g_e(document,t?"touchmove":"mousemove",this._onTouchMove):(g_e(W_e,"dragend",this),g_e(X_e,"dragstart",this._onDragStart));try{document.selection?Uxe((function(){document.selection.empty()})):window.getSelection().removeAllRanges()}catch(i){}},_dragStarted:function(e,t){if(mxe=!1,X_e&&W_e){q_e("dragStarted",this,{evt:t}),this.nativeDraggable&&g_e(document,"dragover",Dxe);var i=this.options;!e&&S_e(W_e,i.dragClass,!1),S_e(W_e,i.ghostClass,!0),Fxe.active=this,e&&this._appendGhost(),H_e({sortable:this,name:"start",originalEvent:t})}else this._nulling()},_emulateDragOver:function(){if(axe){this._lastX=axe.clientX,this._lastY=axe.clientY,kxe();for(var e=document.elementFromPoint(axe.clientX,axe.clientY),t=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(axe.clientX,axe.clientY))!==t;)t=e;if(W_e.parentNode[z_e]._isOutsideThisEl(e),t)do{if(t[z_e]){if(t[z_e]._onDragOver({clientX:axe.clientX,clientY:axe.clientY,target:e,rootEl:t})&&!this.options.dragoverBubble)break}e=t}while(t=t.parentNode);Lxe()}},_onTouchMove:function(e){if(oxe){var t=this.options,i=t.fallbackTolerance,r=t.fallbackOffset,s=e.touches?e.touches[0]:e,n=J_e&&T_e(J_e,!0),o=J_e&&n&&n.a,a=J_e&&n&&n.d,l=Ixe&&gxe&&L_e(gxe),h=(s.clientX-oxe.clientX+r.x)/(o||1)+(l?l[0]-xxe[0]:0)/(o||1),c=(s.clientY-oxe.clientY+r.y)/(a||1)+(l?l[1]-xxe[1]:0)/(a||1);if(!Fxe.active&&!mxe){if(i&&Math.max(Math.abs(s.clientX-this._lastX),Math.abs(s.clientY-this._lastY))<i)return;this._onDragStart(e,!0)}if(J_e){n?(n.e+=h-(lxe||0),n.f+=c-(hxe||0)):n={a:1,b:0,c:0,d:1,e:h,f:c};var u="matrix(".concat(n.a,",").concat(n.b,",").concat(n.c,",").concat(n.d,",").concat(n.e,",").concat(n.f,")");M_e(J_e,"webkitTransform",u),M_e(J_e,"mozTransform",u),M_e(J_e,"msTransform",u),M_e(J_e,"transform",u),lxe=h,hxe=c,axe=s}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!J_e){var e=this.options.fallbackOnBody?document.body:X_e,t=A_e(W_e,!0,Ixe,!0,e),i=this.options;if(Ixe){for(gxe=e;"static"===M_e(gxe,"position")&&"none"===M_e(gxe,"transform")&&gxe!==document;)gxe=gxe.parentNode;gxe!==document.body&&gxe!==document.documentElement?(gxe===document&&(gxe=E_e()),t.top+=gxe.scrollTop,t.left+=gxe.scrollLeft):gxe=E_e(),xxe=L_e(gxe)}S_e(J_e=W_e.cloneNode(!0),i.ghostClass,!1),S_e(J_e,i.fallbackClass,!0),S_e(J_e,i.dragClass,!0),M_e(J_e,"transition",""),M_e(J_e,"transform",""),M_e(J_e,"box-sizing","border-box"),M_e(J_e,"margin",0),M_e(J_e,"top",t.top),M_e(J_e,"left",t.left),M_e(J_e,"width",t.width),M_e(J_e,"height",t.height),M_e(J_e,"opacity","0.8"),M_e(J_e,"position",Ixe?"absolute":"fixed"),M_e(J_e,"zIndex","100000"),M_e(J_e,"pointerEvents","none"),Fxe.ghost=J_e,e.appendChild(J_e),M_e(J_e,"transform-origin",cxe/parseInt(J_e.style.width)*100+"% "+uxe/parseInt(J_e.style.height)*100+"%")}},_onDragStart:function(e,t){var i=this,r=e.dataTransfer,s=i.options;q_e("dragStart",this,{evt:e}),Fxe.eventCanceled?this._onDrop():(q_e("setupClone",this),Fxe.eventCanceled||((Z_e=N_e(W_e)).draggable=!1,Z_e.style["will-change"]="",this._hideClone(),S_e(Z_e,this.options.chosenClass,!1),Fxe.clone=Z_e),i.cloneId=Uxe((function(){q_e("clone",i),Fxe.eventCanceled||(i.options.removeCloneOnHide||X_e.insertBefore(Z_e,W_e),i._hideClone(),H_e({sortable:i,name:"clone"}))})),!t&&S_e(W_e,s.dragClass,!0),t?(vxe=!0,i._loopId=setInterval(i._emulateDragOver,50)):(m_e(document,"mouseup",i._onDrop),m_e(document,"touchend",i._onDrop),m_e(document,"touchcancel",i._onDrop),r&&(r.effectAllowed="move",s.setData&&s.setData.call(i,r,W_e)),g_e(document,"drop",i),M_e(W_e,"transform","translateZ(0)")),mxe=!0,i._dragStartId=Uxe(i._dragStarted.bind(i,t,e)),g_e(document,"selectstart",i),pxe=!0,p_e&&M_e(document.body,"user-select","none"))},_onDragOver:function(e){var t,i,r,s,n=this.el,o=e.target,a=this.options,l=a.group,h=Fxe.active,c=sxe===l,u=a.sort,p=nxe||h,d=this,f=!1;if(!Sxe){if(void 0!==e.preventDefault&&e.cancelable&&e.preventDefault(),o=w_e(o,a.draggable,n,!0),A("dragOver"),Fxe.eventCanceled)return f;if(W_e.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||d._ignoreWhileAnimating===o)return C(!1);if(vxe=!1,h&&!a.disabled&&(c?u||(r=!X_e.contains(W_e)):nxe===this||(this.lastPutMode=sxe.checkPull(this,h,W_e,e))&&l.checkPut(this,h,W_e,e))){if(s="vertical"===this._getDirection(e,o),t=A_e(W_e),A("dragOverValid"),Fxe.eventCanceled)return f;if(r)return $_e=X_e,P(),this._hideClone(),A("revert"),Fxe.eventCanceled||(K_e?X_e.insertBefore(W_e,K_e):X_e.appendChild(W_e)),C(!0);var y=O_e(n,a.draggable);if(!y||function(e,t,i){var r=A_e(O_e(i.el,i.options.draggable)),s=10;return t?e.clientX>r.right+s||e.clientX<=r.right&&e.clientY>r.bottom&&e.clientX>=r.left:e.clientX>r.right&&e.clientY>r.top||e.clientX<=r.right&&e.clientY>r.bottom+s}(e,s,this)&&!y.animated){if(y===W_e)return C(!1);if(y&&n===e.target&&(o=y),o&&(i=A_e(o)),!1!==jxe(X_e,n,W_e,t,o,i,e,!!o))return P(),n.appendChild(W_e),$_e=n,O(),C(!0)}else if(o.parentNode===n){i=A_e(o);var g,m,v,b=W_e.parentNode!==n,w=!function(e,t,i){var r=i?e.left:e.top,s=i?e.right:e.bottom,n=i?e.width:e.height,o=i?t.left:t.top,a=i?t.right:t.bottom,l=i?t.width:t.height;return r===o||s===a||r+n/2===o+l/2}(W_e.animated&&W_e.toRect||t,o.animated&&o.toRect||i,s),_=s?"top":"left",x=P_e(o,"top","top")||P_e(W_e,"top","top"),S=x?x.scrollTop:void 0;if(dxe!==o&&(m=i[_],wxe=!1,_xe=!w&&a.invertSwap||b),0!==(g=function(e,t,i,r,s,n,o,a){var l=r?e.clientY:e.clientX,h=r?i.height:i.width,c=r?i.top:i.left,u=r?i.bottom:i.right,p=!1;if(!o)if(a&&yxe<h*s){if(!wxe&&(1===fxe?l>c+h*n/2:l<u-h*n/2)&&(wxe=!0),wxe)p=!0;else if(1===fxe?l<c+yxe:l>u-yxe)return-fxe}else if(l>c+h*(1-s)/2&&l<u-h*(1-s)/2)return function(e){return k_e(W_e)<k_e(e)?1:-1}(t);if((p=p||o)&&(l<c+h*n/2||l>u-h*n/2))return l>c+h/2?1:-1;return 0}(e,o,i,s,w?1:a.swapThreshold,null==a.invertedSwapThreshold?a.swapThreshold:a.invertedSwapThreshold,_xe,dxe===o))){var M=k_e(W_e);do{M-=g,v=$_e.children[M]}while(v&&("none"===M_e(v,"display")||v===J_e))}if(0===g||v===o)return C(!1);dxe=o,fxe=g;var T=o.nextElementSibling,I=!1,E=jxe(X_e,n,W_e,t,o,i,e,I=1===g);if(!1!==E)return 1!==E&&-1!==E||(I=1===E),Sxe=!0,setTimeout(zxe,30),P(),I&&!T?n.appendChild(W_e):o.parentNode.insertBefore(W_e,I?T:o),x&&j_e(x,0,S-x.scrollTop),$_e=W_e.parentNode,void 0===m||_xe||(yxe=Math.abs(m-A_e(o)[_])),O(),C(!0)}if(n.contains(W_e))return C(!1)}return!1}function A(a,l){q_e(a,d,o_e({evt:e,isOwner:c,axis:s?"vertical":"horizontal",revert:r,dragRect:t,targetRect:i,canSort:u,fromSortable:p,target:o,completed:C,onMove:function(i,r){return jxe(X_e,n,W_e,t,i,A_e(i),e,r)},changed:O},l))}function P(){A("dragOverAnimationCapture"),d.captureAnimationState(),d!==p&&p.captureAnimationState()}function C(t){return A("dragOverCompleted",{insertion:t}),t&&(c?h._hideClone():h._showClone(d),d!==p&&(S_e(W_e,nxe?nxe.options.ghostClass:h.options.ghostClass,!1),S_e(W_e,a.ghostClass,!0)),nxe!==d&&d!==Fxe.active?nxe=d:d===Fxe.active&&nxe&&(nxe=null),p===d&&(d._ignoreWhileAnimating=o),d.animateAll((function(){A("dragOverAnimationComplete"),d._ignoreWhileAnimating=null})),d!==p&&(p.animateAll(),p._ignoreWhileAnimating=null)),(o===W_e&&!W_e.animated||o===n&&!o.animated)&&(dxe=null),a.dragoverBubble||e.rootEl||o===document||(W_e.parentNode[z_e]._isOutsideThisEl(e.target),!t&&Rxe(e)),!a.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),f=!0}function O(){txe=k_e(W_e),rxe=k_e(W_e,a.draggable),H_e({sortable:d,name:"change",toEl:n,newIndex:txe,newDraggableIndex:rxe,originalEvent:e})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){m_e(document,"mousemove",this._onTouchMove),m_e(document,"touchmove",this._onTouchMove),m_e(document,"pointermove",this._onTouchMove),m_e(document,"dragover",Rxe),m_e(document,"mousemove",Rxe),m_e(document,"touchmove",Rxe)},_offUpEvents:function(){var e=this.el.ownerDocument;m_e(e,"mouseup",this._onDrop),m_e(e,"touchend",this._onDrop),m_e(e,"pointerup",this._onDrop),m_e(e,"touchcancel",this._onDrop),m_e(document,"selectstart",this)},_onDrop:function(e){var t=this.el,i=this.options;txe=k_e(W_e),rxe=k_e(W_e,i.draggable),q_e("drop",this,{evt:e}),$_e=W_e&&W_e.parentNode,txe=k_e(W_e),rxe=k_e(W_e,i.draggable),Fxe.eventCanceled||(mxe=!1,_xe=!1,wxe=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Gxe(this.cloneId),Gxe(this._dragStartId),this.nativeDraggable&&(m_e(document,"drop",this),m_e(t,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),p_e&&M_e(document.body,"user-select",""),M_e(W_e,"transform",""),e&&(pxe&&(e.cancelable&&e.preventDefault(),!i.dropBubble&&e.stopPropagation()),J_e&&J_e.parentNode&&J_e.parentNode.removeChild(J_e),(X_e===$_e||nxe&&"clone"!==nxe.lastPutMode)&&Z_e&&Z_e.parentNode&&Z_e.parentNode.removeChild(Z_e),W_e&&(this.nativeDraggable&&m_e(W_e,"dragend",this),Nxe(W_e),W_e.style["will-change"]="",pxe&&!mxe&&S_e(W_e,nxe?nxe.options.ghostClass:this.options.ghostClass,!1),S_e(W_e,this.options.chosenClass,!1),H_e({sortable:this,name:"unchoose",toEl:$_e,newIndex:null,newDraggableIndex:null,originalEvent:e}),X_e!==$_e?(txe>=0&&(H_e({rootEl:$_e,name:"add",toEl:$_e,fromEl:X_e,originalEvent:e}),H_e({sortable:this,name:"remove",toEl:$_e,originalEvent:e}),H_e({rootEl:$_e,name:"sort",toEl:$_e,fromEl:X_e,originalEvent:e}),H_e({sortable:this,name:"sort",toEl:$_e,originalEvent:e})),nxe&&nxe.save()):txe!==exe&&txe>=0&&(H_e({sortable:this,name:"update",toEl:$_e,originalEvent:e}),H_e({sortable:this,name:"sort",toEl:$_e,originalEvent:e})),Fxe.active&&(null!=txe&&-1!==txe||(txe=exe,rxe=ixe),H_e({sortable:this,name:"end",toEl:$_e,originalEvent:e}),this.save())))),this._nulling()},_nulling:function(){q_e("nulling",this),X_e=W_e=$_e=J_e=K_e=Z_e=Y_e=Q_e=oxe=axe=pxe=txe=rxe=exe=ixe=dxe=fxe=nxe=sxe=Fxe.dragged=Fxe.ghost=Fxe.clone=Fxe.active=null,Mxe.forEach((function(e){e.checked=!0})),Mxe.length=lxe=hxe=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":W_e&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move");e.cancelable&&e.preventDefault()}(e));break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],i=this.el.children,r=0,s=i.length,n=this.options;r<s;r++)w_e(e=i[r],n.draggable,this.el,!1)&&t.push(e.getAttribute(n.dataIdAttr)||Vxe(e));return t},sort:function(e,t){var i={},r=this.el;this.toArray().forEach((function(e,t){var s=r.children[t];w_e(s,this.options.draggable,r,!1)&&(i[e]=s)}),this),t&&this.captureAnimationState(),e.forEach((function(e){i[e]&&(r.removeChild(i[e]),r.appendChild(i[e]))})),t&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,t){return w_e(e,t||this.options.draggable,this.el,!1)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];var r=B_e.modifyOption(this,e,t);i[e]=void 0!==r?r:t,"group"===e&&Oxe(i)},destroy:function(){q_e("destroy",this);var e=this.el;e[z_e]=null,m_e(e,"mousedown",this._onTapStart),m_e(e,"touchstart",this._onTapStart),m_e(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(m_e(e,"dragover",this),m_e(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),(function(e){e.removeAttribute("draggable")})),this._onDrop(),this._disableDelayedDragEvents(),bxe.splice(bxe.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!Q_e){if(q_e("hideClone",this),Fxe.eventCanceled)return;M_e(Z_e,"display","none"),this.options.removeCloneOnHide&&Z_e.parentNode&&Z_e.parentNode.removeChild(Z_e),Q_e=!0}},_showClone:function(e){if("clone"===e.lastPutMode){if(Q_e){if(q_e("showClone",this),Fxe.eventCanceled)return;W_e.parentNode!=X_e||this.options.group.revertClone?K_e?X_e.insertBefore(Z_e,K_e):X_e.appendChild(Z_e):X_e.insertBefore(Z_e,W_e),this.options.group.revertClone&&this.animate(W_e,Z_e),M_e(Z_e,"display",""),Q_e=!1}}else this._hideClone()}},Txe&&g_e(document,"touchmove",(function(e){(Fxe.active||mxe)&&e.cancelable&&e.preventDefault()})),Fxe.utils={on:g_e,off:m_e,css:M_e,find:I_e,is:function(e,t){return!!w_e(e,t,e,!1)},extend:function(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},throttle:F_e,closest:w_e,toggleClass:S_e,clone:N_e,index:k_e,nextTick:Uxe,cancelNextTick:Gxe,detectDirection:Cxe,getChild:C_e},Fxe.get=function(e){return e[z_e]},Fxe.mount=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t[0].constructor===Array&&(t=t[0]),t.forEach((function(e){if(!e.prototype||!e.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(e));e.utils&&(Fxe.utils=o_e({},Fxe.utils,e.utils)),B_e.mount(e)}))},Fxe.create=function(e,t){return new Fxe(e,t)},Fxe.version="1.13.0";var Bxe,qxe,Hxe,Wxe,$xe,Jxe,Xxe=[],Kxe=!1;function Yxe(){Xxe.forEach((function(e){clearInterval(e.pid)})),Xxe=[]}function Zxe(){clearInterval(Jxe)}var Qxe=F_e((function(e,t,i,r){if(t.scroll){var s,n=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,a=t.scrollSensitivity,l=t.scrollSpeed,h=E_e(),c=!1;qxe!==i&&(qxe=i,Yxe(),Bxe=t.scroll,s=t.scrollFn,!0===Bxe&&(Bxe=R_e(i,!0)));var u=0,p=Bxe;do{var d=p,f=A_e(d),y=f.top,g=f.bottom,m=f.left,v=f.right,b=f.width,w=f.height,_=void 0,x=void 0,S=d.scrollWidth,M=d.scrollHeight,T=M_e(d),I=d.scrollLeft,E=d.scrollTop;d===h?(_=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX||"visible"===T.overflowX),x=w<M&&("auto"===T.overflowY||"scroll"===T.overflowY||"visible"===T.overflowY)):(_=b<S&&("auto"===T.overflowX||"scroll"===T.overflowX),x=w<M&&("auto"===T.overflowY||"scroll"===T.overflowY));var A=_&&(Math.abs(v-n)<=a&&I+b<S)-(Math.abs(m-n)<=a&&!!I),P=x&&(Math.abs(g-o)<=a&&E+w<M)-(Math.abs(y-o)<=a&&!!E);if(!Xxe[u])for(var C=0;C<=u;C++)Xxe[C]||(Xxe[C]={});Xxe[u].vx==A&&Xxe[u].vy==P&&Xxe[u].el===d||(Xxe[u].el=d,Xxe[u].vx=A,Xxe[u].vy=P,clearInterval(Xxe[u].pid),0==A&&0==P||(c=!0,Xxe[u].pid=setInterval(function(){r&&0===this.layer&&Fxe.active._onTouchMove($xe);var t=Xxe[this.layer].vy?Xxe[this.layer].vy*l:0,i=Xxe[this.layer].vx?Xxe[this.layer].vx*l:0;"function"==typeof s&&"continue"!==s.call(Fxe.dragged.parentNode[z_e],i,t,e,$xe,Xxe[this.layer].el)||j_e(Xxe[this.layer].el,i,t)}.bind({layer:u}),24))),u++}while(t.bubbleScroll&&p!==h&&(p=R_e(p,!1)));Kxe=c}}),30),eSe=function(e){var t=e.originalEvent,i=e.putSortable,r=e.dragEl,s=e.activeSortable,n=e.dispatchSortableEvent,o=e.hideGhostForTarget,a=e.unhideGhostForTarget;if(t){var l=i||s;o();var h=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,c=document.elementFromPoint(h.clientX,h.clientY);a(),l&&!l.el.contains(c)&&(n("spill"),this.onSpill({dragEl:r,putSortable:i}))}};function tSe(){}function iSe(){}function rSe(e,t,i){e.splice(i,0,e.splice(t,1)[0])}tSe.prototype={startIndex:null,dragStart:function(e){var t=e.oldDraggableIndex;this.startIndex=t},onSpill:function(e){var t=e.dragEl,i=e.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var r=C_e(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(t,r):this.sortable.el.appendChild(t),this.sortable.animateAll(),i&&i.animateAll()},drop:eSe},n_e(tSe,{pluginName:"revertOnSpill"}),iSe.prototype={onSpill:function(e){var t=e.dragEl,i=e.putSortable||this.sortable;i.captureAnimationState(),t.parentNode&&t.parentNode.removeChild(t),i.animateAll()},drop:eSe},n_e(iSe,{pluginName:"removeOnSpill"}),Fxe.mount(new function(){function e(){for(var e in this.defaults={scroll:!0,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===e.charAt(0)&&"function"==typeof this[e]&&(this[e]=this[e].bind(this))}return e.prototype={dragStarted:function(e){var t=e.originalEvent;this.sortable.nativeDraggable?g_e(document,"dragover",this._handleAutoScroll):this.options.supportPointer?g_e(document,"pointermove",this._handleFallbackAutoScroll):t.touches?g_e(document,"touchmove",this._handleFallbackAutoScroll):g_e(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(e){var t=e.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?m_e(document,"dragover",this._handleAutoScroll):(m_e(document,"pointermove",this._handleFallbackAutoScroll),m_e(document,"touchmove",this._handleFallbackAutoScroll),m_e(document,"mousemove",this._handleFallbackAutoScroll)),Zxe(),Yxe(),clearTimeout(__e),__e=void 0},nulling:function(){$xe=qxe=Bxe=Kxe=Jxe=Hxe=Wxe=null,Xxe.length=0},_handleFallbackAutoScroll:function(e){this._handleAutoScroll(e,!0)},_handleAutoScroll:function(e,t){var i=this,r=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,n=document.elementFromPoint(r,s);if($xe=e,t||c_e||h_e||p_e){Qxe(e,this.options,n,t);var o=R_e(n,!0);!Kxe||Jxe&&r===Hxe&&s===Wxe||(Jxe&&Zxe(),Jxe=setInterval((function(){var n=R_e(document.elementFromPoint(r,s),!0);n!==o&&(o=n,Yxe()),Qxe(e,i.options,n,t)}),10),Hxe=r,Wxe=s)}else{if(!this.options.bubbleScroll||R_e(n,!0)===E_e())return void Yxe();Qxe(e,this.options,R_e(n,!1),!1)}}},n_e(e,{pluginName:"scroll",initializeByDefault:!0})}),Fxe.mount(iSe,tSe);const sSe=xh.ofType(Jwe),nSe="data-sort-filter",oSe="data-layer-uid",aSe="esri-layer-list esri-widget esri-widget--panel",lSe="esri-layer-list--new-ui",hSe="esri-layer-list__no-items",cSe="esri-layer-list__list",uSe="esri-layer-list__list--root",pSe="esri-layer-list__list--exclusive",dSe="esri-layer-list__list--inherited",fSe="esri-layer-list__list--independent",ySe="esri-layer-list__item",gSe="esri-layer-list__item--error",mSe="esri-layer-list__item--invisible",vSe="esri-layer-list__item--invisible-at-scale",bSe="esri-layer-list__item--updating",wSe="esri-layer-list__item--has-children",_Se="esri-layer-list__item--selectable",xSe="esri-layer-list__item-container",SSe="esri-layer-list__item-actions-menu",MSe="esri-layer-list__item-actions-menu-item",TSe="esri-layer-list__item-actions-menu-item--active",ISe="esri-layer-list__item-actions",ESe="esri-layer-list__item-actions-list",ASe="esri-layer-list__item-action",PSe="esri-layer-list__item-action-icon",CSe="esri-layer-list__item-action-image",OSe="esri-layer-list__item-action-title",kSe="esri-layer-list__action-toggle",LSe="esri-layer-list__action-toggle--on",RSe="esri-layer-list__item-label",DSe="esri-layer-list__item-error-message",FSe="esri-layer-list__item-title",jSe="esri-layer-list__item-toggle",NSe="esri-layer-list__item-toggle-icon",zSe="esri-layer-list__item-toggle-icon",VSe="esri-layer-list__item-radio-icon",USe="esri-layer-list__child-toggle",GSe="esri-layer-list__child-toggle--open",BSe="esri-layer-list__child-toggle-icon--opened",qSe="esri-layer-list__child-toggle-icon--closed",HSe="esri-layer-list__child-toggle-icon--closed-rtl",WSe="esri-layer-list--chosen",$Se="esri-disabled",JSe="esri-disabled-element",XSe="esri-hidden",KSe="esri-rotating",YSe="esri-icon-handle-horizontal",ZSe="esri-icon-visible",QSe="esri-icon-non-visible",eMe="esri-icon-radio-checked",tMe="esri-icon-radio-unchecked",iMe="esri-icon-notice-triangle",rMe="esri-icon-down-arrow",sMe="esri-icon-right-triangle-arrow",nMe="esri-icon-left-triangle-arrow",oMe="esri-icon-loading-indicator",aMe="esri-icon-default-action",lMe="esri-icon-layers",hMe="actions",cMe="action-section",uMe="items",pMe={exclusive:"exclusive",inherited:"inherited",independent:"independent"};function dMe(e){const{actionsOpen:t,children:i}=e;t&&(e.actionsOpen=!1),i.forEach((e=>dMe(e)))}const fMe=Ne.getLogger("esri.widgets.LayerList"),yMe={statusIndicators:!0};let gMe=class extends xy{constructor(e,t){super(e,t),this._handles=new Mh,this._sortableNodes=new Map,this._sortableMap=new Map,this._focusSortUid=null,this._newUI=y("esri-layerlist-new-ui"),this.visibleItems=null,this.iconClass=lMe,this.label=void 0,this.listItemCreatedFunction=null,this.localeStrings=null,this.messages=null,this.messagesCommon=null,this.multipleSelectionEnabled=!1,this.operationalItems=null,this.selectionEnabled=!1,this.selectedItems=new sSe,this.view=null,this.viewModel=new i_e,this.visibleElements=a({},yMe),this._onSortableSort=({to:e,from:t,item:i,newIndex:r})=>{t&&e&&(t===e?this._sortLayers(this._sortableMap.get(t.dataset.group)):this._moveLayerFromChildList({to:e,from:t,item:i,newIndex:r}))},this._sortableCanPut=(e,t,i)=>{var r,s;const n=e.el.dataset.group,o=t.el.dataset.group,a=e.el["data-item"],l=i["data-item"],h=null==l||null==(r=l.layer)?void 0:r.type,c=null==a||null==(s=a.layer)?void 0:s.type;return n&&o&&h&&!("group"===c&&"group"===h)},this._sortableCanPull=(e,t,i)=>{var r;const s=e.el.dataset.group,n=t.el.dataset.group,o=i["data-item"],a=null==o||null==(r=o.layer)?void 0:r.type;return s&&n&&!!a},this._onSortableEnd=({oldIndex:e,from:t,to:i,item:r})=>{t!==i&&t.insertBefore(r,t.children[e])}}initialize(){const e=this.operationalItems;this._setVisibleItems(e),this.own(Hh(this,"operationalItems","change",(()=>this._itemsChanged(e))),Rh(this,"selectionEnabled",(()=>this._toggleAllSorting())))}destroy(){this._destroySortables(),this._handles.destroy(),this._handles=null}set statusIndicatorsVisible(e){br(fMe,"statusIndicatorsVisible",{replacement:"visibleElements.statusIndicators",version:"4.15"}),this.visibleElements=l(a({},this.visibleElements),{statusIndicators:e})}castVisibleElements(e){return a(a({},yMe),e)}triggerAction(e,t){this.viewModel.triggerAction(e,t)}render(){var e;const{visibleItems:t,_newUI:i}=this,r=null==(e=this.viewModel)?void 0:e.state,s={[lSe]:i,[XSe]:"loading"===r,[$Se]:"disabled"===r};return Iy("div",{class:this.classes(aSe,s)},null!=t&&t.length?this.renderItems():this.renderNoItems())}renderNoItems(){return Iy("div",{class:hSe},this.messages.noItemsToDisplay)}renderItems(){const{visibleItems:e,selectionEnabled:t,messages:i}=this;return Iy("ul",{"aria-label":i.widgetLabel,role:t?"listbox":void 0,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,"data-group":"root",bind:this,class:this.classes(cSe,uSe,fSe)},null==e?void 0:e.map((e=>this.renderItem(e,null))).toArray())}renderActionsMenuIcon(e,t){const{messages:i}=this,r={[TSe]:e.actionsOpen},s=e.actionsOpen?i.closeActions:i.openActions;return Iy("div",{key:"actions-menu-toggle","data-item":e,bind:this,onclick:this._toggleActionsOpen,onkeydown:this._toggleActionsOpen,class:this.classes(MSe,r),tabindex:"0",role:"button","aria-controls":t,"aria-label":s,title:s},Iy("span",{"aria-hidden":"true",class:YSe}))}renderActionsMenu(e,t,i,r){const{panel:s}=e,n=s&&s.visible?this.renderPanelButton(s):null,o=1===i&&this._getSingleActionButton(t),a=o?this.renderAction({item:e,action:o,singleAction:!0}):null,l=!o&&i?this.renderActionsMenuIcon(e,r):null;return l||n||o?Iy("div",{key:"actions-menu",class:SSe},n,a,l):null}renderChildList(e,t){var i;const{selectionEnabled:r}=this,{visibilityMode:s,children:n}=e,o=!!e.error,a=!!n.length&&!o,l=!a&&r&&"group"===(null==(i=e.layer)?void 0:i.type),{exclusive:h,inherited:c}=pMe,u={[pSe]:s===h,[dSe]:s===c,[fSe]:s!==c&&s!==h};return a||l?Iy("ul",{bind:this,key:"list-items",id:t,"data-group":e.uid,"data-item":e,afterCreate:this._sortNodeCreated,afterUpdate:this._sortNodeCreated,afterRemoved:this._sortNodeRemoved,class:this.classes(cSe,u),"aria-expanded":e.open?"true":"false",role:r?"listbox":s===h?"radiogroup":"group",hidden:!e.open&&!l||null},null==n?void 0:n.map((t=>this.renderItem(t,e))).toArray()):null}renderChildrenToggle(e,t){const{messagesCommon:i}=this,{children:r}=e,s=!!e.error,n=!!r.length&&!s,o={[GSe]:e.open},a=e.open?i.collapse:i.expand;return n?Iy("span",{onclick:this._toggleChildrenClick,onkeydown:this._toggleChildrenClick,"data-item":e,key:"toggle-children",class:this.classes(USe,o),tabindex:"0",role:"button","aria-controls":t,"aria-label":a,title:a},Iy("span",{"aria-hidden":"true",class:this.classes(qSe,sMe)}),Iy("span",{"aria-hidden":"true",class:this.classes(BSe,rMe)}),Iy("span",{"aria-hidden":"true",class:this.classes(HSe,nMe)})):null}renderError(e){return e.error?Iy("div",{key:"esri-layer-list__error",class:DSe,role:"alert"},Iy("span",null,this.messages.layerError)):null}renderItemContent(e,t,i){const{id:r}=this,s=`${r}_${e.uid}`,n=`${s}_actions`,o=`${s}__list`,{panel:a}=e,l=this._filterActions(e.actionsSections),h=this._countActions(l);return[Iy("div",{key:"list-item-container",class:xSe},this.renderChildrenToggle(e,o),this.renderLabel(e,t,i),this.renderActionsMenu(e,l,h,n)),this.renderError(e),h?this.renderActionsSections(e,l,n):null,a&&a.open?a.render():null,this.renderChildList(e,o)]}renderItem(e,t){const{_newUI:i,id:r,selectionEnabled:s,selectedItems:n,visibleElements:o}=this,{children:l}=e,h=`${r}_${e.uid}__title`,c=!!e.error,u=!!l.length&&!c,p={[wSe]:u,[gSe]:!!c,[bSe]:e.updating&&!t&&o.statusIndicators,[mSe]:i&&!e.visible,[vSe]:!e.visibleAtCurrentScale,[_Se]:s};if(s){var d;const i={[oSe]:null==(d=e.layer)?void 0:d.uid,[nSe]:(!e.sortable).toString()};return Iy("li",a({key:`item-with-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(ySe,p),"aria-labelledby":h,onclick:this._toggleSelection,onkeydown:this._selectionKeydown,"data-item":e,"data-group":t?t.uid:"root",tabIndex:0,"aria-selected":Uwe(e,n)?"true":"false",role:"option"},i),this.renderItemContent(e,t,h))}return Iy("li",{key:`item-no-selection-${e.uid}`,bind:this,afterCreate:this._focusListItem,afterUpdate:this._focusListItem,class:this.classes(ySe,p),"aria-labelledby":h},this.renderItemContent(e,t,h))}renderItemTitle(e,t){const{messages:i}=this,r=e.title||i.untitledLayer,s=e.visibleAtCurrentScale?r:`${r} (${i.layerInvisibleAtScale})`;return Iy("span",{key:"layer-title-container",id:t,title:s,"aria-label":s,class:FSe},r)}renderItemToggleIcon(e,t){const{_newUI:i}=this,{exclusive:r}=pMe,s=t&&t.visibilityMode,n={[NSe]:i,[zSe]:i&&s!==r,[VSe]:i&&s===r,[eMe]:s===r&&e.visible,[tMe]:s===r&&!e.visible,[ZSe]:s!==r&&e.visible,[QSe]:s!==r&&!e.visible};return Iy("span",{key:"item-toggle-icon",class:this.classes(n),"aria-hidden":"true"})}renderItemToggle(e,t,i){const{selectionEnabled:r}=this,{exclusive:s}=pMe,n=t&&t.visibilityMode,o=n===s?"radio":"switch";return Iy("span",r?{key:"item-toggle-selection-enabled",class:jSe,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":n,tabIndex:0,"aria-checked":e.visible?"true":"false",role:o,"aria-labelledby":i}:{key:"item-toggle",class:jSe},this.renderItemToggleIcon(e,t))}renderItemError(e){return e.error?Iy("span",{key:"notice-triangle","aria-hidden":"true",class:iMe}):null}renderLabel(e,t,i){const{selectionEnabled:r,_newUI:s}=this,{inherited:n,exclusive:o}=pMe,a=null==t?void 0:t.visibilityMode,l=a===o?"radio":"switch",h=[this.renderItemToggle(e,t,i),this.renderItemTitle(e,i)];s&&h.reverse();const c=Iy("div",r?{key:`item-label-no-selection-${e.uid}`,class:RSe}:{key:`item-label-with-selection-${e.uid}`,class:RSe,bind:this,onclick:this._toggleVisibility,onkeydown:this._toggleVisibility,"data-item":e,"data-parent-visibility":a,tabIndex:0,"aria-checked":e.visible?"true":"false",role:l,"aria-labelledby":i},h);return a===n||e.error?Iy("div",{key:`item-label-container-${e.uid}`,class:RSe},this.renderItemError(e),this.renderItemTitle(e,i)):c}renderPanelButton(e){const{className:t,open:i,title:r,image:s}=e,n=s||t?t:aMe,o=this._getIconImageStyles(e),a={[TSe]:i},l={[CSe]:!!o["background-image"]};return n&&(l[n]=!!n),Iy("div",{key:`panel-${e.uid}`,bind:this,"data-panel":e,onclick:this._triggerPanel,onkeydown:this._triggerPanel,class:this.classes(MSe,a),role:"button",tabindex:"0",title:r,"aria-label":r},Iy("span",{class:this.classes(l),styles:o}))}renderActionsSections(e,t,i){const r=t.toArray().map(((t,i)=>Iy("ul",{key:`${e}-action-section-${i}`,class:ESe},this.renderActionSection(e,t))));return Iy("div",{role:"group","aria-expanded":e.actionsOpen?"true":"false",key:"actions-section",id:i,class:ISe,hidden:!e.actionsOpen||null},r)}renderActionSection(e,t){return(t&&t.toArray()).map((t=>this.renderAction({item:e,action:t})))}renderActionIcon(e){const{active:t,className:i}=e,r=this._getIconImageStyles(e),s="button"!==e.type||e.image||i?i:aMe,n={[CSe]:!t&&!!r["background-image"],[oMe]:t,[KSe]:t};return s&&!t&&(n[s]=!0),Iy("span",{key:"action-icon","aria-hidden":"true",class:this.classes(PSe,n),styles:r})}renderActionTitle(e,t){return t?null:Iy("span",{key:"action-title",class:OSe},e)}renderAction(e){const{item:t,action:i,singleAction:r}=e,{active:s,disabled:n,title:o}=i,a={[MSe]:r&&"button"===i.type,[ASe]:s||!r&&"toggle"!==i.type,[kSe]:!s&&"toggle"===i.type,[LSe]:!s&&"toggle"===i.type&&i.value,[JSe]:n},l=[this.renderActionIcon(i),this.renderActionTitle(o,r)];return r?Iy("div",{bind:this,"data-item":t,"data-action":i,role:"button",key:`single-action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",title:o,"aria-label":o},l):Iy("li",{bind:this,"data-item":t,"data-action":i,key:`action-${i.uid}`,onclick:this._triggerAction,onkeydown:this._triggerAction,classes:a,tabindex:"0",role:"button",title:o,"aria-label":o},l)}_sortNodeRemoved(e){const{_sortableMap:t}=this,i=e.dataset.group,r=t.get(i);r&&r.destroy(),t.delete(i)}_destroySortables(){const{_sortableMap:e,_sortableNodes:t}=this;e.forEach((e=>e&&e.destroy())),e.clear(),t.clear()}_moveLayerFromChildList({to:e,from:t,item:i,newIndex:r}){const s=i["data-item"],n=e["data-item"],o=t["data-item"];this.viewModel.moveListItem(s,o,n,r)}_sortLayers(e){if(!e)return;const t=e.el["data-item"],i=e.toArray();var r,s;t?function(e,t){const i=null==e?void 0:e.layer;if(!i)return;const r=Nwe(i);r&&zwe(i.get(r),t)}(t,i):zwe(null==(r=this.view)||null==(s=r.map)?void 0:s.layers,i)}_toggleSorting(e,t){const{_sortableMap:i,selectionEnabled:r}=this,s=i.get(t),n=e["data-item"],o=("root"===t||n.childrenSortable&&function(e){const t=e&&(e.get("layer.layer")||e.layer);if(!t)return!1;const i=t.get("capabilities.exportMap.supportsDynamicLayers");return"boolean"!=typeof i||i}(n))&&r;if(s)s.option("disabled",!o);else if(o){const r=Fxe.create(e,{dataIdAttr:oSe,group:{name:t,pull:this._sortableCanPull,put:this._sortableCanPut},filter:`[${nSe}="true"]`,fallbackTolerance:4,onSort:this._onSortableSort,onEnd:this._onSortableEnd,disabled:!o,chosenClass:WSe});i.set(t,r)}}_toggleAllSorting(){this._sortableNodes.forEach(((e,t)=>this._toggleSorting(e,t)))}_sortNodeCreated(e){const t=e.dataset.group;t&&(this._sortableNodes.set(t,e),this._toggleSorting(e,t))}_setVisibleItems(e){this.visibleItems=null==e?void 0:e.filter((e=>this.errorsVisible||!e.error))}_getSingleActionButton(e){return e.reduce((e=>e)).filter((e=>e&&"button"===e.type)).getItemAt(0)}_focusListItem(e){var t;const{_focusSortUid:i}=this;e&&i&&(null==(t=e["data-item"].layer)?void 0:t.uid)===i&&(e.focus(),this._focusSortUid=null)}_watchActionSectionChanges(e,t){const i=cMe+t;this._handles.add(e.on("change",this.scheduleRender.bind(this)),i),e.forEach((e=>this._renderOnActionChanges(e,t)))}_renderOnActionChanges(e,t){const i=hMe+t;"toggle"!==e.type?"slider"!==e.type?this._handles.add([Rh(e,["className","image","id","title","visible"],(()=>this.scheduleRender()))],i):this._handles.add([Rh(e,["className","id","title","visible","value","displayValueEnabled","max","min","step"],(()=>this.scheduleRender()))],i):this._handles.add([Rh(e,["className","image","id","title","visible","value"],(()=>this.scheduleRender()))],i)}_renderOnItemChanges(e){const t=e.uid,i=uMe+t;this._handles.add([Rh(e,["actionsOpen","visible","open","updating","title","visibleAtCurrentScale","error","visibilityMode","panel","panel.title","panel.content","panel.className","sortable","childrenSortable"],(()=>this.scheduleRender())),e.actionsSections.on("change",(()=>this.scheduleRender())),e.children.on("change",(()=>this.scheduleRender()))],i),e.children.forEach((e=>this._renderOnItemChanges(e))),e.actionsSections.forEach((e=>this._watchActionSectionChanges(e,t)))}_itemsChanged(e){this._handles.removeAll(),e.forEach((e=>this._renderOnItemChanges(e))),this._setVisibleItems(e),this.scheduleRender()}_filterActions(e){return e.map((e=>e.filter((e=>e.visible))))}_countActions(e){return e.reduce(((e,t)=>e+t.length),0)}_getIconImageStyles(e){const t="esri.widgets.LayerList.ListItemPanel"===e.declaredClass||"esri.support.Action.ActionButton"===e.declaredClass||"esri.support.Action.ActionToggle"===e.declaredClass?e.image:null;return{"background-image":t?`url("${t}")`:null}}_selectionKeydown(e){const t=Ke(e);if(-1===["ArrowDown","ArrowUp"].indexOf(t))return void this._toggleSelection(e);e.stopPropagation();const i=e.currentTarget,r=i["data-item"],{_sortableMap:s,selectedItems:n}=this,o=i.dataset.group,a=s.get(o);if(!a)return;const l=Uwe(r,n),h=a.toArray(),c=e.target,u=h.indexOf(c.dataset.layerUid);if(-1!==u){if("ArrowDown"===t){const e=u+1;if(e>=h.length)return;var p,d;l?(rSe(h,u,e),a.sort(h),this._sortLayers(a),this._focusSortUid=null==(p=r.layer)?void 0:p.uid):(this._focusSortUid=null==(d=r.layer)?void 0:d.uid,this.scheduleRender())}if("ArrowUp"===t){const e=u-1;if(e<=-1)return;var f,y;l?(rSe(h,u,e),a.sort(h),this._sortLayers(a),this._focusSortUid=null==(f=r.layer)?void 0:f.uid):(this._focusSortUid=null==(y=r.layer)?void 0:y.uid,this.scheduleRender())}}}_toggleActionsOpen(e){const t=e.currentTarget["data-item"],{actionsOpen:i}=t,r=!i;r&&this.operationalItems.forEach((e=>dMe(e))),t.actionsOpen=r,e.stopPropagation()}_triggerPanel(e){const t=e.currentTarget["data-panel"];t&&(t.open=!t.open),e.stopPropagation()}_triggerAction(e){const t=e.currentTarget,i=t["data-action"],r=t["data-item"];"toggle"===i.type&&(i.value=!i.value),this.triggerAction(i,r),e.stopPropagation()}_toggleVisibility(e){const t=e.currentTarget,i=t.getAttribute("data-parent-visibility"),r=t["data-item"];i===pMe.exclusive&&r.visible||(r.visible=!r.visible),e.stopPropagation()}_toggleChildrenClick(e){const t=e.currentTarget["data-item"];t.open=!t.open,e.stopPropagation()}_toggleSelection(e){e.stopPropagation();const{multipleSelectionEnabled:t,selectedItems:i}=this,r=e.currentTarget["data-item"],s=Uwe(r,i),{length:n}=i;if(!t)return!n||s&&1===n?void(s?null==i.remove||i.remove(s):i.add(r)):(i.removeAll(),void i.add(r));s?null==i.remove||i.remove(s):i.add(r)}};Q([ro()],gMe.prototype,"visibleItems",void 0),Q([ro()],gMe.prototype,"iconClass",void 0),Q([ro()],gMe.prototype,"errorsVisible",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],gMe.prototype,"label",void 0),Q([eh("viewModel.listItemCreatedFunction")],gMe.prototype,"listItemCreatedFunction",void 0),Q([ro()],gMe.prototype,"localeStrings",void 0),Q([ro(),Sy("esri/widgets/LayerList/t9n/LayerList")],gMe.prototype,"messages",void 0),Q([ro(),Sy("esri/t9n/common")],gMe.prototype,"messagesCommon",void 0),Q([ro()],gMe.prototype,"multipleSelectionEnabled",void 0),Q([eh("viewModel.operationalItems")],gMe.prototype,"operationalItems",void 0),Q([ro()],gMe.prototype,"selectionEnabled",void 0),Q([ro()],gMe.prototype,"selectedItems",void 0),Q([ro()],gMe.prototype,"statusIndicatorsVisible",null),Q([eh("viewModel.view")],gMe.prototype,"view",void 0),Q([Ny("trigger-action"),ro({type:i_e})],gMe.prototype,"viewModel",void 0),Q([ro()],gMe.prototype,"visibleElements",void 0),Q([Ra("visibleElements")],gMe.prototype,"castVisibleElements",null),Q([eh("viewModel.triggerAction")],gMe.prototype,"triggerAction",null),Q([Fy()],gMe.prototype,"_toggleActionsOpen",null),Q([Fy()],gMe.prototype,"_triggerPanel",null),Q([Fy()],gMe.prototype,"_triggerAction",null),Q([Fy()],gMe.prototype,"_toggleVisibility",null),Q([Fy()],gMe.prototype,"_toggleChildrenClick",null),Q([Fy()],gMe.prototype,"_toggleSelection",null),gMe=Q([Ro("esri.widgets.LayerList")],gMe);var mMe=gMe;function vMe(e,t,i){return t.flatten((({sublayers:e})=>e)).length!==e.length||(!!e.some((e=>e.originIdOf("minScale")>i||e.originIdOf("maxScale")>i||e.originIdOf("renderer")>i||e.originIdOf("labelingInfo")>i||e.originIdOf("opacity")>i||e.originIdOf("labelsVisible")>i||e.originIdOf("source")>i))||!bMe(e,t))}function bMe(e,t){if(!e||!e.length)return!0;const i=t.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>i.length)return!1;let r=0;const s=i.length;for(const{id:n}of e){for(;r<s&&i[r]!==n;)r++;if(r>=s)return!1}return!0}function wMe(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}const _Me={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};let xMe=class extends($v(jo)){constructor(e){super(e),this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&function(e,t,i){return!!e.some((e=>{const t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===i.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2}))||!bMe(e,t)}(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(()=>this.notifyChange("visibleSublayers"))),e.on("sublayer-update",(e=>this.notifyChange(_Me[e.propertyName])))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map((e=>e.id)).join(","):"show:-1":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,t)=>(e[t.id]=t.definitionExpression,e)),{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,i=t=>{const r=this.scale,s=0===r,n=0===t.minScale||r<=t.minScale,o=0===t.maxScale||r>=t.maxScale;t.visible&&(s||n&&o)&&(t.sublayers?t.sublayers.forEach(i):e.unshift(t))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some(((t,i)=>e[i]!==t))?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=l(a({},t),{layers:this.layers,layerDefs:this.layerDefs}),t}};function SMe(e){return v(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type}function MMe(e){if(v(e))return null;if(!SMe(e))return new Be("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case"simple":return function(e){return TMe(e,_j(e.symbol).error)}(e);case"unique-value":return function(e){const t=e.uniqueValueInfos.map((e=>_j(e.symbol).error)).filter((e=>!!e)),i=_j(e.defaultSymbol);return i.error&&t.unshift(i.error),TMe(e,t)}(e);case"class-breaks":return function(e){const t=e.classBreakInfos.map((e=>_j(e.symbol).error)).filter((e=>!!e)),i=_j(e.defaultSymbol);return i.error&&t.unshift(i.error),TMe(e,t)}(e);case"dictionary":return null}return null}function TMe(e,t){if(!t)return null;let i;if(i=Array.isArray(t)?t:[t],i.length>0){const t=i.map((e=>e.details.symbol.type||e.details.symbol.declaredClass)).filter((e=>!!e));t.sort();const r=[];return t.forEach(((e,i)=>{0!==i&&e===t[i-1]||r.push(e)})),new Be("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${r.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:i})}return null}Q([ro({readOnly:!0})],xMe.prototype,"dynamicLayers",null),Q([ro({readOnly:!0})],xMe.prototype,"hasDynamicLayers",null),Q([ro()],xMe.prototype,"layer",null),Q([ro({readOnly:!0})],xMe.prototype,"layers",null),Q([ro({readOnly:!0})],xMe.prototype,"layerDefs",null),Q([ro({type:Number})],xMe.prototype,"scale",void 0),Q([ro(iU)],xMe.prototype,"timeExtent",void 0),Q([ro({readOnly:!0})],xMe.prototype,"version",null),Q([ro({readOnly:!0})],xMe.prototype,"visibleSublayers",null),xMe=Q([Ro("esri.layers.mixins.ExportImageParameters")],xMe);const IMe=/^-?(\d+)(\.(\d+))?$/i;function EMe(e,t){return e-t}function AMe(e,t){let i,r;return i=Number(e.toFixed(t)),i<e?r=i+1/10**t:(r=i,i-=1/10**t),i=Number(i.toFixed(t)),r=Number(r.toFixed(t)),[i,r]}function PMe(e,t,i,r,s){const n=OMe(e,t,i,r),o=null==n.previous||n.previous<=s,a=null==n.next||n.next<=s;return o&&a||n.previous+n.next<=2*s}function CMe(e){const t=String(e),i=t.match(IMe);if(i&&i[1])return{integer:i[1].split("").length,fractional:i[3]?i[3].split("").length:0};if(t.toLowerCase().indexOf("e")>-1){const e=t.split("e"),i=e[0],r=e[1];if(i&&r){const e=Number(i);let t=Number(r);const s=t>0;s||(t=Math.abs(t));const n=CMe(e);return s?(n.integer+=t,t>n.fractional?n.fractional=0:n.fractional-=t):(n.fractional+=t,t>n.integer?n.integer=1:n.integer-=t),n}}return{integer:0,fractional:0}}function OMe(e,t,i,r){const s={previous:null,next:null};if(null!=i){const r=e-i,n=t-i-r;s.previous=Math.floor(Math.abs(100*n/r))}if(null!=r){const i=r-e,n=r-t-i;s.next=Math.floor(Math.abs(100*n/i))}return s}function kMe(e,t={}){const i=e.slice(0),{tolerance:r=2,strictBounds:s=!1,indexes:n=i.map(((e,t)=>t))}=t;n.sort(EMe);for(let o=0;o<n.length;o++){const e=n[o],t=i[e],a=0===e?null:i[e-1],l=e===i.length-1?null:i[e+1],h=CMe(t).fractional;if(h){let n,c=0,u=!1;for(;c<=h&&!u;){const e=AMe(t,c);n=s&&0===o?e[1]:e[0],u=PMe(t,n,a,l,r),c++}u&&(i[e]=n)}}return i}const LMe={maximumFractionDigits:20};const RMe=Me("short-date");function DMe(e,t,i,r){let s="";0===t?s="< ":t===i&&(s="> ");let n=null;return n=r?Te(e,RMe):function(e){return Ce(e,LMe)}(e),s+n}const FMe=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="],jMe=new Rv([64,64,64]);function NMe(e,t){const i=[],r=e.length-1;return 5===e.length?i.push(0,2,4):i.push(0,r),e.map(((e,s)=>i.indexOf(s)>-1?DMe(e,s,r,t):null))}async function zMe(e,t,i){let r=!1,s=[],n=[];if(e.stops){const t=e.stops;s=t.map((e=>e.value)),r=t.some((e=>!!e.label)),r&&(n=t.map((e=>e.label)))}const o=s[0],a=s[s.length-1];if(null==o&&null==a)return null;const l=r?null:NMe(s,i);return(await Promise.all(s.map((async(i,s)=>({value:i,color:"opacity"===e.type?await VMe(i,e,t):(await Promise.resolve().then((function(){return nj}))).getColor(e,i),label:r?n[s]:l[s]}))))).reverse()}async function VMe(e,t,i=jMe){const r=new Rv(i),s=(await Promise.resolve().then((function(){return nj}))).getOpacity(t,e);return null!=s&&(r.a=s),r}function UMe(e,t){const{startIndex:i,endIndex:r,weight:s}=function(e,t){let i=0,r=t.length-1;return t.some(((t,s)=>e<t.value?(r=s,!0):(i=s,!1))),{startIndex:i,endIndex:r,weight:(e-t[i].value)/(t[r].value-t[i].value)}}(e,t);if(i===r)return t[i].color;const n=Rv.blendColors(t[i].color,t[r].color,s);return new Rv(n)}const GMe={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function BMe(e){const t=22,i=.5*e;return[{type:"path",path:[{command:"M",values:[0,.7*t*.5]},{command:"L",values:[6.6,.7*t]},{command:"L",values:[6.6,.7*t+i]},{command:"L",values:[0,.7*t+i-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,.7*t]},{command:"L",values:[6.6,.7*t+i]},{command:"L",values:[t,i]},{command:"L",values:[t,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[t,0]},{command:"L",values:[6.6,.7*t]},{command:"L",values:[0,.7*t*.5]},{command:"Z",values:[]}]}]}function qMe(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function HMe(e,t){if("type"in e&&("linear"===e.type||"pattern"===e.type))return e;const i=new Rv(e);return new Rv([qMe(i.r,t),qMe(i.g,t),qMe(i.b,t),i.a])}let WMe=0,$Me=0;const JMe=y("android"),XMe=y("chrome")||JMe&&JMe>=4?"auto":"optimizeLegibility",KMe={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},YMe=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let ZMe={},QMe={};const eTe={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},tTe=Math.PI;function iTe(e,t){const i=e*(tTe/180);return Math.abs(t*Math.sin(i))+Math.abs(t*Math.cos(i))}function rTe(e){return e.map((e=>`${e.command} ${e.values.join(" ")}`)).join(" ").trim()}function sTe(e,t,i,r){if(e){if("circle"===e.type)return Iy("circle",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,r:e.r});if("ellipse"===e.type)return Iy("ellipse",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",cx:e.cx,cy:e.cy,rx:e.rx,ry:e.ry});if("rect"===e.type)return Iy("rect",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",x:e.x,y:e.y,width:e.width,height:e.height});if("image"===e.type)return Iy("image",{href:e.src,x:e.x,y:e.y,width:e.width,height:e.height,preserveAspectRatio:"none"});if("path"===e.type){const r="string"!=typeof e.path?rTe(e.path):e.path;return Iy("path",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4",d:r})}if("text"===e.type)return Iy("text",{fill:t,"fill-rule":"evenodd",stroke:i.color,"stroke-width":i.width,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-dasharray":i.dashArray,"stroke-miterlimit":"4","text-anchor":r.align,"text-decoration":r.decoration,kerning:r.kerning,rotate:r.rotate,"text-rendering":XMe,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,"font-size":r.font.size,"font-family":r.font.family,x:e.x,y:e.y},e.text)}return null}function nTe(e){const t={fill:"none",pattern:null,linearGradient:null};if(e)if("type"in e&&"pattern"===e.type){const i="patternId-"+ ++WMe;t.fill=`url(#${i})`,t.pattern={id:i,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&"linear"===e.type){const i="linearGradientId-"+ ++$Me;t.fill=`url(#${i})`,t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map((e=>({offset:e.offset,color:e.color&&new Rv(e.color).toString()})))}}else if(e){const i=new Rv(e);t.fill=i.toString()}return t}function oTe(e){const t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none"};if(e&&(null!=e.width&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new Rv(e.color).toString()),e.style)){let i=null;if(e.style in eTe&&(i=eTe[e.style]),Array.isArray(i)){i=i.slice(0);for(let t=0;t<i.length;++t)i[t]*=e.width;if("butt"!==e.cap){for(let t=0;t<i.length;t+=2)i[t]-=e.width,i[t]<1&&(i[t]=1);for(let t=1;t<i.length;t+=2)i[t]+=e.width}i=i.join(",")}t.dashArray=i}return t}function aTe(e,t){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return e&&(i.align=e.align,i.decoration=e.decoration,i.kerning=e.kerning?"auto":"0",i.rotate=e.rotated?"90":"0",i.font.style=t.style||"normal",i.font.variant=t.variant||"normal",i.font.weight=t.weight||"normal",i.font.size=t.size&&t.size.toString()||"10pt",i.font.family=t.family||"serif"),i}function lTe(e){const{pattern:t,linearGradient:i}=e;if(t)return Iy("pattern",{id:t.id,patternUnits:"userSpaceOnUse",x:t.x,y:t.y,width:t.width,height:t.height},Iy("image",{x:t.image.x,y:t.image.y,width:t.image.width,height:t.image.height,href:t.image.href}));if(i){const e=i.stops.map(((e,t)=>Iy("stop",{key:`${t}-stop`,offset:e.offset,"stop-color":e.color})));return Iy("linearGradient",{id:i.id,gradientUnits:"userSpaceOnUse",x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2},e)}return null}function hTe(e,t,i){return bX(e,fX(e),[t,i])}function cTe(e,t,i,r,s){return vX(e,fX(e),[t,i]),e[4]=e[4]*t-r*t+r,e[5]=e[5]*i-s*i+s,e}function uTe(e,t){ZMe&&"left"in ZMe?(ZMe.left>e&&(ZMe.left=e),ZMe.right<e&&(ZMe.right=e),ZMe.top>t&&(ZMe.top=t),ZMe.bottom<t&&(ZMe.bottom=t)):ZMe={left:e,bottom:t,right:e,top:t}}function pTe(e){const t=e.args,i=t.length;let r;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(r=0;r<i;r+=2)uTe(t[r],t[r+1]);QMe.x=t[i-2],QMe.y=t[i-1];break;case"H":for(r=0;r<i;++r)uTe(t[r],QMe.y);QMe.x=t[i-1];break;case"V":for(r=0;r<i;++r)uTe(QMe.x,t[r]);QMe.y=t[i-1];break;case"m":{let e=0;"x"in QMe||(uTe(QMe.x=t[0],QMe.y=t[1]),e=2);for(r=e;r<i;r+=2)uTe(QMe.x+=t[r],QMe.y+=t[r+1]);break}case"l":case"t":for(r=0;r<i;r+=2)uTe(QMe.x+=t[r],QMe.y+=t[r+1]);break;case"h":for(r=0;r<i;++r)uTe(QMe.x+=t[r],QMe.y);break;case"v":for(r=0;r<i;++r)uTe(QMe.x,QMe.y+=t[r]);break;case"c":for(r=0;r<i;r+=6)uTe(QMe.x+t[r],QMe.y+t[r+1]),uTe(QMe.x+t[r+2],QMe.y+t[r+3]),uTe(QMe.x+=t[r+4],QMe.y+=t[r+5]);break;case"s":case"q":for(r=0;r<i;r+=4)uTe(QMe.x+t[r],QMe.y+t[r+1]),uTe(QMe.x+=t[r+2],QMe.y+=t[r+3]);break;case"A":for(r=0;r<i;r+=7)uTe(t[r+5],t[r+6]);QMe.x=t[i-2],QMe.y=t[i-1];break;case"a":for(r=0;r<i;r+=7)uTe(QMe.x+=t[r+5],QMe.y+=t[r+6])}}function dTe(e,t,i){const r=KMe[e.toLowerCase()];let s;"number"==typeof r&&(r?t.length>=r&&(s={action:e,args:t.slice(0,t.length-t.length%r)},i.push(s),pTe(s)):(s={action:e,args:[]},i.push(s),pTe(s)))}function fTe(e){const t={x:0,y:0,width:0,height:0};if("circle"===e.type)t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if("ellipse"===e.type)t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if("image"===e.type||"rect"===e.type)t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if("path"===e.type){const i=function(e){const t=("string"!=typeof e.path?rTe(e.path):e.path).match(YMe),i=[];if(ZMe={},QMe={},!t)return null;let r="",s=[];const n=t.length;for(let a=0;a<n;++a){const e=t[a],n=parseFloat(e);isNaN(n)?(r&&dTe(r,s,i),s=[],r=e):s.push(n)}dTe(r,s,i);const o={x:0,y:0,width:0,height:0};return ZMe&&"left"in ZMe&&(o.x=ZMe.left,o.y=ZMe.top,o.width=ZMe.right-ZMe.left,o.height=ZMe.bottom-ZMe.top),o}(e);t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height}return t}function yTe(e){const t={x:0,y:0,width:0,height:0};let i=null,r=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(const n of e)i?(i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),r=Math.max(r,n.x+n.width),s=Math.max(s,n.y+n.height)):(i=t,i.x=n.x,i.y=n.y,r=n.x+n.width,s=n.y+n.height);return i&&(i.width=r-i.x,i.height=s-i.y),i}function gTe(e,t,i,r,s,n,o,a){const l=(o&&n?iTe(n,t):t)/2,h=(o&&n?iTe(n,i):i)/2,c=e.width+r,u=e.height+r,p=_Q(),d=_Q();let f=!1;if(s&&0!==c&&0!==u){const e=c/u,r=t>i?t:i;let s=1,n=1;isNaN(r)||(e>1?(s=r/c,n=r/e/u):(n=r/u,s=r*e/c)),gX(d,d,cTe(p,s,n,l,h)),f=!0}const y=e.x+(c-r)/2,g=e.y+(u-r)/2;if(gX(d,d,hTe(p,l-y,h-g)),!f&&(c>t||u>i)){const e=c/t>u/i,r=(e?t:i)/(e?c:u);gX(d,d,cTe(p,r,r,y,g))}return n&&gX(d,d,function(e,t,i,r){const s=t%360*Math.PI/180;mX(e,fX(e),s);const n=Math.cos(s),o=Math.sin(s),a=e[4],l=e[5];return e[4]=a*n-l*o+r*o-i*n+i,e[5]=l*n+a*o-i*o-r*n+r,e}(p,n,y,g)),a&&gX(d,d,hTe(p,a[0],a[1])),`matrix(${d[0]},${d[1]},${d[2]},${d[3]},${d[4]},${d[5]})`}function mTe(e,t,i,r){const s=[],n=[];for(const o of e){const e=[],a=[];let l=0,h=0,c=0;for(const t of o){const{shape:i,fill:r,stroke:n,font:o,offset:u}=t;l+=n&&n.width||0;const p=nTe(r),d=oTe(n),f="text"===i.type?aTe(i,o):null;s.push(lTe(p)),e.push(sTe(i,p.fill,d,f)),a.push(fTe(i)),u&&(h+=u[0],c+=u[1])}const u=gTe(yTe(a),t,i,l,null==r?void 0:r.scale,null==r?void 0:r.rotation,null==r?void 0:r.useRotationSize,[h,c]);n.push(Iy("g",{transform:u},e))}return null!=r&&r.useRotationSize&&null!=r&&r.rotation&&(t=iTe(null==r?void 0:r.rotation,t),i=iTe(null==r?void 0:r.rotation,i)),Iy("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:i},Iy("defs",null,s),n)}const vTe=Yu();function bTe(e,t,i){const r=Math.ceil(t[0]),s=Math.ceil(t[1]);if(!e.some((e=>!!e.length)))return null;const n=i&&i.node||document.createElement("div");return null!=i.opacity&&(n.style.opacity=i.opacity.toString()),vTe.append(n,mTe.bind(null,e,r,s,i)),n}function wTe(e,t,i,r,s){switch(s){case"multiply":e[t+0]*=i[0],e[t+1]*=i[1],e[t+2]*=i[2],e[t+3]*=i[3];break;default:{const s=o9({r:e[t+0],g:e[t+1],b:e[t+2]});s.h=r.h,s.s=r.s,s.v=s.v/100*r.v;const n=n9(s);e[t+0]=n.r,e[t+1]=n.g,e[t+2]=n.b,e[t+3]*=i[3];break}}}function _Te(e,t,i,r,s){return function(e,t,i){return e?$i(e,{responseType:"image"}).then((e=>{const r=e.data,s=r.width,n=r.height,o=s/n;let a=t;if(i){const e=Math.max(s,n);a=Math.min(a,e)}return{image:r,width:o<=1?Math.ceil(a*o):a,height:o<=1?a:Math.ceil(a/o)}})):Promise.reject(new Be("renderUtils: imageDataSize","href not provided."))}(e,t,s).then((s=>{const n=s.width?s.width:t,o=s.height?s.height:t;if(s.image&&function(e,t){return!(!e||"ignore"===t||"multiply"===t&&255===e.r&&255===e.g&&255===e.b&&1===e.a)}(i,r)){let t=s.image.width,a=s.image.height;y("edge")&&/\.svg$/i.test(e)&&(t-=1,a-=1);const l=function(e,t){e=Math.ceil(e),t=Math.ceil(t);const i=document.createElement("canvas");i.width=e,i.height=t,i.style.width=e+"px",i.style.height=t+"px";const r=i.getContext("2d");return r.clearRect(0,0,e,t),r}(n,o);l.drawImage(s.image,0,0,t,a,0,0,n,o);const h=l.getImageData(0,0,n,o),c=[i.r/255,i.g/255,i.b/255,i.a],u=o9(i);for(let e=0;e<h.data.length;e+=4)wTe(h.data,e,c,u,r);l.putImageData(h,0,0),e=l.canvas.toDataURL("image/png")}else{const t=Ui&&Ui.findCredential(e);if(t&&t.token){const i=-1===e.indexOf("?")?"?":"&";e=`${e}${i}token=${t.token}`}}return{url:e,width:n,height:o}})).catch((function(){return{url:e,width:t,height:t}}))}const xTe=Ne.getLogger("esri.symbols.support.previewSymbol3D");function STe(e){const t=e.outline,i=m(e.material)?e.material.color:null,r=m(i)?i.toHex():null;if(v(t))return"fill"===e.type&&"#ffffff"===r?{color:"#bdc3c7",width:.75}:null;const s=LS(t.size)||0;return{color:"rgba("+(m(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(s,80)}}function MTe(e,t=1){const i=e.a,r=o9(e),s=r.h,n=r.s/t,o=100-(100-r.v)/t,{r:a,g:l,b:h}=n9({h:s,s:n,v:o});return[a,l,h,i]}function TTe(e){return"water"===e.type?v(e.color)?null:e.color:v(e.material)||v(e.material.color)?null:e.material.color}function ITe(e,t=0){const i=TTe(e);if(!i){if("fill"===e.type)return null;const i=qMe(Sq.r,t);return[i,i,i,100]}const r=i.toRgba();for(let s=0;s<3;s++)r[s]=qMe(r[s],t);return r}async function ETe(e,t){const i=e.style;return"none"===i?null:{type:"pattern",x:0,y:0,src:await wq(gr(`esri/symbols/patterns/${i}.png`),t.toCss(!0)),width:5,height:5}}function ATe(e){return e.outline?STe(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function PTe(e,t){const i=TTe(e);if(!i)return null;let r="rgba(";return r+=qMe(i.r,t)+",",r+=qMe(i.g,t)+",",r+=qMe(i.b,t)+",",r+i.a+");"}function CTe(e,t){const i=PTe(e,t);return i?{color:i,width:Math.min(e.size?LS(e.size):.75,80)}:{}}function OTe(e,t,i){const r=.75*i;return{type:"linear",x1:r?.25*r:0,y1:r?.5*r:0,x2:r||4,y2:r?.5*r:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function kTe(e,t,i){const r=[];if(!e)return r;switch(e.type){case"icon":{const i=0,s=0,n=t,o=t;switch(e.resource&&e.resource.primitive||"circle"){case"circle":r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:ITe(e,0),stroke:STe(e)});break;case"square":r.push({shape:{type:"path",path:[{command:"M",values:[i,o]},{command:"L",values:[i,s]},{command:"L",values:[n,s]},{command:"L",values:[n,o]},{command:"Z",values:[]}]},fill:ITe(e,0),stroke:STe(e)});break;case"triangle":r.push({shape:{type:"path",path:[{command:"M",values:[i,o]},{command:"L",values:[.5*n,s]},{command:"L",values:[n,o]},{command:"Z",values:[]}]},fill:ITe(e,0),stroke:STe(e)});break;case"cross":r.push({shape:{type:"path",path:[{command:"M",values:[.5*n,s]},{command:"L",values:[.5*n,o]},{command:"M",values:[i,.5*o]},{command:"L",values:[n,.5*o]}]},stroke:ATe(e)});break;case"x":r.push({shape:{type:"path",path:[{command:"M",values:[i,s]},{command:"L",values:[n,o]},{command:"M",values:[n,s]},{command:"L",values:[i,o]}]},stroke:ATe(e)});break;case"kite":r.push({shape:{type:"path",path:[{command:"M",values:[i,.5*o]},{command:"L",values:[.5*n,s]},{command:"L",values:[n,.5*o]},{command:"L",values:[.5*n,o]},{command:"Z",values:[]}]},fill:ITe(e,0),stroke:STe(e)})}break}case"object":switch(e.resource&&e.resource.primitive||"sphere"){case"cone":{const s=OTe(ITe(e,0),ITe(e,-.6),i?20:t),n=function(e,t){let i=t?20:e;const r=t?4:6;i-=i<=22?.5*r:r;const s=.15*i,n=e-s;return[{type:"ellipse",cx:.5*i,cy:n,rx:.5*i,ry:s},{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]}]}(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s});break}case"inverted-cone":{const i=ITe(e,0),s=OTe(i,ITe(e,-.6),t),n=function(e){let t=e;t-=t<22?3:6;const i=.15*t;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[.5*t,e-i]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:0,rx:.5*t,ry:i}]}(t);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:i});break}case"cube":{const s=function(e,t){let i=t?20:e;const r=t?4:6;i-=i<=22?.5*r:r;const s=t?.35*i:.5*i;return[{type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,.5*s]},{command:"L",values:[.5*i,s]},{command:"L",values:[0,.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*s]},{command:"L",values:[.5*i,s]},{command:"L",values:[.5*i,e]},{command:"L",values:[0,e-.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*i,s]},{command:"L",values:[.5*i,e]},{command:"L",values:[i,e-.5*s]},{command:"L",values:[i,.5*s]},{command:"Z",values:[]}]}]}(t,i);r.push({shape:s[0],fill:ITe(e,0)}),r.push({shape:s[1],fill:ITe(e,-.3)}),r.push({shape:s[2],fill:ITe(e,-.5)});break}case"cylinder":{const s=OTe(ITe(e,0),ITe(e,-.6),i?20:t),n=function(e,t){let i=t?20:e;const r=t?4:6;i-=i<=22?.5*r:r;const s=.5*i,n=.15*i,o=e-n;return[{type:"ellipse",cx:.5*i,cy:o,rx:s,ry:n},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[0,o]},{command:"L",values:[i,o]},{command:"L",values:[i,n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*i,cy:n,rx:s,ry:n}]}(t,i);r.push({shape:n[0],fill:s}),r.push({shape:n[1],fill:s}),r.push({shape:n[2],fill:ITe(e,0)});break}case"diamond":{const i=function(e){let t=e;const i=e;t-=t<22?2:4;const r=t,s=i,n=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[r,.5*s-n]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"L",values:[0,.5*s-n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*s-n]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"L",values:[.45*r,i]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*r,i]},{command:"L",values:[r,.5*s-n]},{command:"L",values:[.45*r-n,.5*s+n]},{command:"Z",values:[]}]}]}(t);r.push({shape:i[0],fill:ITe(e,-.3)}),r.push({shape:i[1],fill:ITe(e,0)}),r.push({shape:i[2],fill:ITe(e,-.3)}),r.push({shape:i[3],fill:ITe(e,-.7)});break}case"sphere":{const i=OTe(ITe(e,0),ITe(e,-.6));i.x1=0,i.y1=0,i.x2=.25*t,i.y2=.25*t,r.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:i});break}case"tetrahedron":{const i=function(e){let t=e;return t-=t<22?1:2,[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,t]},{command:"L",values:[.45*e,.6*t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,t]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[e,t]},{command:"Z",values:[]}]}]}(t);r.push({shape:i[0],fill:ITe(e,-.3)}),r.push({shape:i[1],fill:ITe(e,0)}),r.push({shape:i[2],fill:ITe(e,-.6)});break}}}return r}function LTe(e,t){const i=t&&t.size?LS(t.size):null,r=t&&t.maxSize?LS(t.maxSize):null,s=t&&t.disableUpsampling,n=e.symbolLayers,o=[];let a=0,l=0;const h=n.getItemAt(n.length-1);let c;return h&&"icon"===h.type&&(c=h.size&&LS(h.size)),n.forEach((n=>{if("icon"!==n.type&&"object"!==n.type)return;const h="icon"===n.type?n.size&&LS(n.size):0,u=i||h?Math.ceil(Math.min(i||h,r||120)):22;if(n&&n.resource&&n.resource.href){const t=function(e,t){const i=t&&t.resource,r=i&&i.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(r&&"object"!==t.type)return Promise.resolve(Aq(e,t));const s=gr("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?LN(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch((e=>e)).then((e=>{var t;return(null==e||null==(t=e.thumbnail)?void 0:t.url)||s})):Promise.resolve(s)}(e,n).then((function(e){const t=n.get("material.color"),i=function(e){return"icon"===e.type?"multiply":"tint"}(n);return _Te(e,u,t,i,s)})).then((function(e){const t=e.width,i=e.height;return a=Math.max(a,t),l=Math.max(l,i),[{shape:{type:"image",x:0,y:0,width:t,height:i,src:e.url},fill:null,stroke:null}]}));o.push(t)}else{var p;let e=u;"icon"===n.type&&c&&i&&(e=u*(h/c));const r="tall"===(null==t?void 0:t.symbolConfig)||(null==t||null==(p=t.symbolConfig)?void 0:p.isTall)||"object"===n.type&&function(e){const t=e.depth,i=e.height,r=e.width;return r&&t&&i&&r===t&&r<i}(n);a=Math.max(a,r?20:e),l=Math.max(l,e),o.push(Promise.resolve(kTe(n,e,r)))}})),pt(o).then((function(e){const i=[];return e.forEach((function(e){e.value?i.push(e.value):e.error&&xTe.warn("error while building swatchInfo!",e.error)})),bTe(i,[a,l],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})}))}var RTe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",getPatternDescriptor:ETe,getSymbolLayerFill:ITe,previewSymbol3D:function(e,t){if(0===e.symbolLayers.length)return Promise.reject(new Be("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));let i=null;switch(e.type){case"point-3d":i=LTe(e,t);break;case"line-3d":i=function(e,t){const i=e.symbolLayers,r=[],s=Eq(e),n=t&&t.size?LS(t.size):null,o=(t&&t.maxSize?LS(t.maxSize):null)||80;let h,c=0,u=0;return i.forEach(((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const i=[];switch(e.type){case"line":{const r=CTe(e,0),s=r&&r.width||0;0===t&&(h=s);const a=Math.min(n||s,o),l=0===t?a:n?a*(s/h):a,p=l>20?2*l:40;u=Math.max(u,l),c=Math.max(c,p),r.width=l,i.push({shape:{type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[c,.5*u]}]},stroke:r});break}case"path":{const t=Math.min(n||22,o),r=ITe(e,0),h=ITe(e,-.2),d=PTe(e,-.4),f=d?{color:d,width:1}:{};if("quad"===e.profile){var s,p;const t=null!=(s=e.width)?s:e.size,n=null!=(p=e.height)?p:e.size,o=function(e,t,i){let r=22,s=22;e<1?r*=.75:e>1&&(s*=1.25);let n=22,o=22;return t&&i&&(r=s=n=o=0),[{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[i?n:.875*n,0]},{command:"L",values:[i?r-.5*n:0,s-.5*o]},{command:"L",values:[r-.5*n,s-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[n,t?0:.125*o]},{command:"L",values:[r-.5*n,t?s-.5*o:o]},{command:"L",values:[r-.5*n,s-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[r-.5*n,s-.5*o]},{command:"L",values:[i?r-.5*n:0,s-.5*o]},{command:"L",values:[i?r-.5*n:0,t?s-.5*o:o]},{command:"L",values:[r-.5*n,t?s-.5*o:o]},{command:"Z",values:[]}]}]}(t&&n?t/n:1,0===n,0===t),c=l(a({},f),{join:"bevel"});i.push({shape:o[0],fill:h,stroke:c}),i.push({shape:o[1],fill:h,stroke:c}),i.push({shape:o[2],fill:r,stroke:c})}else i.push({shape:GMe.pathSymbol3DLayer[0],fill:h,stroke:f}),i.push({shape:GMe.pathSymbol3DLayer[1],fill:r,stroke:f});u=Math.max(u,t),c=u}}r.push(i)})),Promise.resolve(bTe(r,[c,u],{node:t&&t.node,scale:s,opacity:t&&t.opacity}))}(e,t);break;case"polygon-3d":case"mesh-3d":i=async function(e,t){const i="mesh-3d"===e.type,r=e.symbolLayers,s=t&&t.size?LS(t.size):null,n=t&&t.maxSize?LS(t.maxSize):null,o=s||22,l=[];let h=0,c=0,u=!1;for(let p=0;p<r.length;p++){const e=r.getItemAt(p),t=[];if(i&&"fill"!==e.type)continue;const s=GMe.fill[0];switch(e.type){case"fill":{const r=STe(e),a=Math.min(o,n||120);h=Math.max(h,a),c=Math.max(c,a),u=!0;let l=ITe(e,0);const p="pattern"in e&&e.pattern,d=TTe(e);!i&&m(p)&&"style"===p.type&&"solid"!==p.style&&d&&(l=await ETe(p,d)),t.push({shape:s,fill:l,stroke:r});break}case"line":{const i={stroke:CTe(e,0),shape:s};h=Math.max(h,22),c=Math.max(c,22),t.push(i);break}case"extrude":{const i=a({join:"round"},CTe(e,-.4)),r=ITe(e,0),s=ITe(e,-.2),l=Math.min(o,n||120),u=BMe(l);i.width=1,t.push({shape:u[0],fill:s,stroke:i}),t.push({shape:u[1],fill:s,stroke:i}),t.push({shape:u[2],fill:r,stroke:i});const p=22,d=.7*22+.5*l;h=Math.max(h,p),c=Math.max(c,d);break}case"water":{const i=TTe(e),r=MTe(i),s=MTe(i,2),a=MTe(i,3),l=[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}];u=!0,t.push({shape:l[0],fill:r}),t.push({shape:l[1],fill:s}),t.push({shape:l[2],fill:a});const p=Math.min(o,n||120);h=Math.max(h,p),c=Math.max(c,p);break}}l.push(t)}return Promise.resolve(bTe(l,[h,c],{node:t&&t.node,scale:u,opacity:t&&t.opacity}))}(e,t)}return i||Promise.reject(new Be("symbolPreview: swatchInfo3D","symbol not supported."))}});const DTe={HH:315,HL:45,LL:135,LH:225},FTe={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function jTe(e){if(!e)return;const{type:t}=e;if(t.indexOf("3d")>-1)return ITe(e.symbolLayers.getItemAt(0));if("simple-line"===t){const t=_q(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=_q(e);return t&&t.color}return bq(e)}function NTe(e,t){const i=t.HH.label,r=t.LL.label,s=t.HL.label,n=t.LH.label;switch(e){case"HH":return{top:i,bottom:r,left:s,right:n};case"HL":return{top:s,bottom:n,left:r,right:i};case"LL":return{top:r,bottom:i,left:n,right:s};case"LH":return{top:n,bottom:s,left:i,right:r};default:return{top:i,bottom:r,left:s,right:n}}}function zTe(e){let t=DTe[e];return e&&null==t&&(t=DTe.HH),t||0}const VTe=[255,255,255],UTe=[200,200,200],GTe=[128,128,128];async function BTe(e,t,i,r,s,n){var o,a;const l=t.legendOptions,h=l&&l.customValues,c=function(e,t){let i=null,r=null;if("simple"===e.type)i=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;i=t&&t[0]&&t[0].symbol,r=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;i=t&&t[0]&&t[0].symbol,r=t.length>1}return!i||function(e){if(e)return tE(e)?!!e.symbolLayers&&e.symbolLayers.some((e=>e&&"fill"===e.type)):-1!==e.type.indexOf("fill");return!1}(i)?null:(i=i.clone(),(t||r)&&(i.type.indexOf("3d")>-1?HTe(i):WTe(i)),i)}(e,i),u=!!c,p=!!h,d=null!=t.minSize&&null!=t.maxSize,f=t.stops&&t.stops.length>1,y=!!t.target;if(!u||!p&&!(d||f&&!y))return;const g=Eq(c);let m=null,v=null,b=null;v=g&&!f?kMe([t.minDataValue,t.maxDataValue]):h||await async function(e,t,i,r){const s=(await Promise.resolve().then((function(){return nj}))).getSizeRangeAtScale(e,i,r),n=s&&$Te(s);if(!s&&!n)return;let o=n.map((t=>function(e,t,i){const r=i.minSize,s=i.maxSize,n=t.minDataValue,o=t.maxDataValue;let a=null;a=e<=r?n:e>=s?o:(e-r)/(s-r)*(o-n)+n;return a}(t,e,s)));o=kMe(o);for(let a=1;a<o.length-1;a++){const s=await JTe(e,t,o[a],o[a-1],i,r);s&&(o[a]=s[0],n[a]=s[1])}return o}(t,c,r,s);const w=null==e?void 0:e.authoringInfo,_="univariate-color-size"===(null==w?void 0:w.type),x=_&&"above-and-below"===(null==w?void 0:w.univariateTheme);if(!v&&f&&(v=t.stops.map((e=>e.value)),m=t.stops.some((e=>!!e.label)),m&&(b=t.stops.map((e=>e.label)))),g&&(null==(o=v)?void 0:o.length)>2&&!x&&(v=[v[0],v[v.length-1]]),!v)return null;_&&5!==(null==(a=v)?void 0:a.length)&&(v=$Te({minSize:v[0],maxSize:v[v.length-1]}));const S=g?function(e,t){const i=null==e?void 0:e.authoringInfo,r="univariate-color-size"===(null==i?void 0:i.type);let s=[12,30];if(r){const e=t[0],i=t[t.length-1],r=12,n=30;s=t.map((t=>r+(t-e)/(i-e)*(n-r)))}return r&&"below"===(null==i?void 0:i.univariateTheme)&&s.reverse(),s}(e,v):null,M=Iq(c),T=m?null:function(e,t){const i=e.length-1;return e.map(((e,r)=>DMe(e,r,i,t)))}(v,n);return(await Promise.all(v.map((async(i,n)=>{const o=g?S[n]:await XTe(t,c,i,r,s);return{value:i,symbol:KTe(x&&"class-breaks"===e.type?qTe(e,n):c,o),label:m?b[n]:T[n],size:o,outlineSize:M}})))).reverse()}function qTe(e,t){const i=e.classBreakInfos,r=i.length,s=r<2||!(t>=2)?i[0].symbol.clone():i[r-1].symbol.clone();return e.visualVariables.some((e=>"color"===e.type))&&(s.type.indexOf("3d")>-1?HTe(s):WTe(s)),s}function HTe(e){"line-3d"===e.type?e.symbolLayers.forEach((e=>{e.material={color:GTe}})):e.symbolLayers.forEach((e=>{"icon"!==e.type||e.resource&&e.resource.href?e.material={color:UTe}:(e.material={color:VTe},e.outline={color:GTe,size:1.5})}))}function WTe(e){"cim"===e.type?yq(e,new Rv(UTe)):-1!==e.type.indexOf("line")?e.color=GTe:(e.color=VTe,"simple-marker"===e.type&&(e.outline={color:GTe,width:1.5}))}function $Te(e){const t=e.minSize,i=(e.maxSize-t)/4,r=[];for(let s=0;s<5;s++)r.push(t+i*s);return r}async function JTe(e,t,i,r,s,n){const o=await XTe(e,t,i,s,n),a=await XTe(e,t,r,s,n),l=CMe(i),h=l.fractional;let c=l.integer,u=null,p=null;i>0&&i<1&&(u=10**h,c=CMe(i*=u).integer);for(let d=c-1;d>=0;d--){const r=10**d;let l=Math.floor(i/r)*r,h=Math.ceil(i/r)*r;null!=u&&(l/=u,h/=u);let c=(l+h)/2;[,c]=kMe([l,c,h],{indexes:[1]});const f=await XTe(e,t,l,s,n),y=await XTe(e,t,h,s,n),g=await XTe(e,t,c,s,n),m=OMe(o,f,a,null),v=OMe(o,y,a,null),b=OMe(o,g,a,null);let w=m.previous<=20,_=v.previous<=20;if(w&&_&&(m.previous<=v.previous?(w=!0,_=!1):(_=!0,w=!1)),w?p=[l,f]:_?p=[h,y]:b.previous<=20&&(p=[c,g]),p)break}return p}async function XTe(e,t,i,r,s){const{getSize:n}=await Promise.resolve().then((function(){return nj}));return n(e,i,{scale:r,view:s,shape:"simple-marker"===t.type?t.style:null})}function KTe(e,t){const i=e.clone();if(tE(i))Eq(i)||i.symbolLayers.forEach((e=>{"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(i))i.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(i)){const e=i.width,r=i.height;i.height=t,i.width=t*(e/r)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(i)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(i)&&i.font&&(i.font.size=t):i.width=t;return i}const YTe=Ne.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),ZTe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,QTe=new ee({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),eIe={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},tIe=new $I({size:6,outline:{color:[128,128,128,.5],width:.5}}),iIe=new BI({style:"solid"});function rIe(e){return"vector-field"===e.type}function sIe(e){return"raster-colormap"===e.type}function nIe(e){return"raster-stretch"===e.type}function oIe(e){return"raster-shaded-relief"===e.type}function aIe(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function lIe(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function hIe(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function cIe(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function uIe(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function pIe(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function dIe(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function fIe(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function yIe(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function gIe(e){return"esri.layers.MapImageLayer"===e.declaredClass}function mIe(e){return"esri.layers.ImageryLayer"===e.declaredClass}function vIe(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}const bIe=new $I({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let wIe={},_Ie=class extends jo{constructor(e){super(e),this._handles=new Mh,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this.children=new xh,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this._handles.add([Hh(this,"children","change",(t=>{const{added:i,removed:r}=t,s=this._handles;i.map((t=>{const i=`activeLayerInfo-ready-watcher-${t.layer.uid}`;s.add(Rh(t,"ready",e),i)})),r.forEach((e=>s.remove(e.layer.uid))),e()}))]),this.keepCacheOnDestroy||(wIe={})}destroy(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(wIe=null)}get opacity(){var e;const t=this.layer.opacity,i=null==(e=this.parent)?void 0:e.opacity,r=this.layer.parent,s=r&&"uid"in r?this._getParentLayerOpacity(r):null;return null!=i?i*t:null!=s?s*t:t}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view&&this.view.scale}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("featureReduction"in e&&e.featureReduction&&"cluster"===e.featureReduction.type)return!0;if("renderer"in e&&e.renderer){if("dot-density"===e.renderer.type)return!0;const t=e.get("renderer.valueExpression");if(ZTe.test(t))return!0;const i=e.get("renderer.visualVariables");if(i)return i.some((e=>this._isScaleDrivenSizeVariable(e)))}return this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){const t=e.map((e=>{if(function(e){return"esri.layers.FeatureLayer"===e.declaredClass}(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){const t=e.layerDefinition,i=t&&t.drawingInfo,r=i&&XN(i.renderer),s=QTe.read(t.geometryType);return r?this._getRendererLegendElements(r,{title:e.name,geometryType:s}):(YTe.warn("drawingInfo not available!"),null)}return null}));try{const e=[];await pt(t).then((t=>{t.forEach((({value:t})=>t&&e.push(...t)))})),this.legendElements=e,this.notifyChange("ready")}catch(i){YTe.warn("error while building legend for layer!",i)}}async buildLegendElementsForRenderer(e){try{const t=await this._getRendererLegendElements(e);this.legendElements=t,this.notifyChange("ready")}catch(mr){YTe.warn("error while building legend for layer!",mr)}}async buildLegendElementsForTools(){const e=this.layer;if(function(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(yIe(e))await this._constructLegendElementsForBuildingSceneLayer();else if(gIe(e)||function(e){return"esri.layers.TileLayer"===e.declaredClass}(e)||yIe(e))await this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");let r="default";if(mIe(e)){var t,i;const s=e;r=((null==s||null==(t=s.renderingRule)?void 0:t.functionName)||"default")+"_"+(null!=(i=e.bandIds)&&i.length?e.bandIds.join(""):"###")}await this._getLegendLayers(`${e.uid}-${r}`).then((async t=>{this.legendElements=[],this.notifyChange("ready");const i=t.map((async t=>{if(mIe(e)||vIe(e)){const t=e.watch(["renderingRule","bandIds"],(()=>wt((async()=>{wIe.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()}))()));this._handles.add(t,"imageryLayers-watcher")}const i=this._generateSymbolTableElementForLegendLayer(t);i&&i.infos.length&&(mIe(e)&&(i.title=e.title),this.legendElements.push(i)),this.notifyChange("ready")}));await pt(i)})).catch((e=>{YTe.warn("Request to server for legend has failed!",e)}))}}_getParentLayerOpacity(e){let t=1;const i=e.parent;return i&&"uid"in i&&(t=this._getParentLayerOpacity(i)),e.opacity*t}_isGroupActive(){const e=this.children;return!!e.length&&e.some((e=>e.ready))}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,i=t.minSize,r=t.maxSize;return"object"==typeof i&&i?this._isScaleDrivenSizeVariable(i):"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||ZTe.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((e=>this._isLayerScaleDriven(e)));const t=e.parent;if(!1===e.loaded&&t&&gIe(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const i of t.sourceJSON.layers)if(i.id===e.source.mapLayerId&&(i.minScale>0||i.maxScale>0))return!0;return!1}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");const e=this.layer.activeLayer;if(this._handles.add(Dh(this.layer,"activeLayer",(()=>this._constructLegendElementsForWMTSlayer())),"wmts-activeLayer-watcher"),e.styleId&&e.styles){let t=null;e.styles.some((i=>e.styleId===i.id&&(t=i.legendUrl,!0))),t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}])}this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this._handles.remove("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t=a(a({},e.customParameters),e.customLayerParameters)),this._handles.add(Dh(this.layer,"sublayers",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const i=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForWMSSublayers())),"wms-sublayers-watcher");const r=e.toArray();for(const s of r){const e=s.watch(["title","visible","legendEnabled"],(()=>this._constructLegendElementsForWMSSublayers()));if(this._handles.add(e,"wms-sublayers-watcher"),!this.respectLayerVisibility||s.visible&&s.legendEnabled){const e=await this._generateSymbolTableElementForWMSSublayer(s,t);e&&e.infos.length&&i.unshift(e)}}return i}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const i=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter((e=>e));return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){var i;let r=e.legendUrl;if(!r)return;const s={type:"symbol-table",title:e.title||e.name||e.id&&e.id+"",infos:[]};t&&(r+="?"+Kt(t));let n=null;const o=null==(i=e.layer)?void 0:i.opacity;try{n=(await $i(r,{responseType:"image"})).data,n&&(n.style.opacity=o)}catch{}return s.infos.push({src:r,preview:n,opacity:o}),s}_getLegendLayers(e,t){const i=wIe&&wIe[e];return i?Promise.resolve(i):this._legendRequest(t).then((t=>{const i=t.layers;return wIe[e]=i,i}))}_legendRequest(e){const t=this.layer;let i={f:"json",dynamicLayers:e};if(mIe(t)){const e=t.exportImageServiceParameters.renderingRule;if(e&&(i.renderingRule=JSON.stringify(e.toJSON())),t.bandIds&&(i.bandIds=t.bandIds.join()),t.raster||t.viewId){const{raster:e,viewId:r}=t;i=a({raster:e,viewId:r},i)}}let r=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){const e=r.indexOf("?");e>-1?r=r.substring(0,e)+"/legend"+r.substring(e):r+="/legend"}else{const e=r.toLowerCase().indexOf("/rest/"),t=r.substring(0,e)+r.substring(e+5,r.length);r="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return $i(r,{query:i}).then((e=>e.data))}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(Dh(e,"sublayers",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(mr){YTe.warn("Request to server for legend has failed!",mr)}}async _generateLegendElementsForBuildingSublayers(e,t){let i=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForBuildingSceneLayer())),"sublayers-watcher");const r=e.toArray();for(const s of r){const e=s.watch(["renderer","opacity","title","visible"],(()=>this._constructLegendElementsForBuildingSceneLayer()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||s.visible){const e=s&&null!=s.opacity?s.opacity:null,r=null!=e?e*t:t;if("building-group"===s.type){const e={type:"symbol-table",title:s.title,infos:[]},t=await this._generateLegendElementsForBuildingSublayers(s.sublayers,r);e.infos.push(...t),i=[e,...i]}else s.renderer&&(i=[...await this._getRendererLegendElements(s.renderer,{title:s.title,opacity:r,sublayer:s}),...i])}}return i.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _constructLegendElementsForSublayers(){this.legendElements=[],this._handles.remove("sublayers-watcher");const e=this.layer;this._handles.add(Dh(e,"sublayers",(()=>this._constructLegendElementsForSublayers)),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(mr){YTe.warn("Request to server for legend has failed!",mr)}}async _generateLegendElementsForSublayers(e,t,i){const r=this.layer;let s=[];this._handles.add(e.on("change",(()=>this._constructLegendElementsForSublayers())),"sublayers-watcher");let n=e.toArray();!i&&this.sublayerIds&&this.sublayerIds.length&&(n=this.sublayerIds.map((e=>r.findSublayerById(e))).filter(Boolean));for(const o of n){const e=o.watch("renderer, opacity, title, visible, legendEnabled",(()=>this._constructLegendElementsForSublayers()));if(this._handles.add(e,"sublayers-watcher"),!this.respectLayerVisibility||o.visible&&o.legendEnabled&&this._isSublayerInScale(o)){const e=o&&null!=o.opacity?o.opacity:null,r=null!=e?e*t:t;if(o.renderer&&!o.sublayers&&o.originIdOf("renderer")>2)await o.load(),s=[...await this._getRendererLegendElements(o.renderer,{title:o.title,opacity:r,sublayer:o}),...s];else{const e=await this._generateSymbolTableElementForSublayer(o,r,i);e&&s.unshift(e)}}}return s.filter((e=>!!e&&(!("infos"in e)||e.infos.length>0)))}async _generateSymbolTableElementForSublayer(e,t,i){if(!i){i=new Map;const t=new xMe({layer:this.layer}),r=t.hasDynamicLayers?t.dynamicLayers:null;t.destroy();const s=r||`${this.layer.uid}-${e.id}-default`;(await this._getLegendLayers(s,r)).forEach((e=>i.set(e.layerId,e)))}const r=i.get(e.id);if(!r&&e.sublayers){const r=await this._generateLegendElementsForSublayers(e.sublayers,t,i);return{type:"symbol-table",title:e.title,infos:r}}return this._generateSymbolTableElementForLegendLayer(r,e,t)}_generateSymbolTableElementForLegendLayer(e,t,i){var r;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const s=null==t?void 0:t.renderer;let n=(null==t?void 0:t.title)||e.layerName;if(s&&(!t||(null==t?void 0:t.originIdOf("renderer"))>2)){const e=(null==t?void 0:t.title)||this._getRendererTitle(s,t);e&&(n&&"string"!=typeof e&&"title"in e&&(e.title=n),n=e)}const o={type:"symbol-table",title:n,legendType:e.legendType?e.legendType:null,infos:[]},a=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null==(r=e.legendGroups)?void 0:r.length)>0?e.legendGroups.forEach((t=>{var r;const s={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(a.filter((e=>e.groupId===t.id)),e.layerId,i)};(null==(r=s.infos)?void 0:r.length)>0&&o.infos.push(s)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(a,e.layerId,i),o.infos.length>0?o:null}_generateSymbolTableElementInfosForLegendLayer(e,t,i){return e.map((e=>{let r=e.url;if(e.imageData&&e.imageData.length>0)r=`data:image/png;base64,${e.imageData}`;else{if(0===r.indexOf("http"))return null;r=Gi(`${this.layer.url}/${t}/images/${r}`)}return{label:e.label,src:r,opacity:null==i?this.opacity:i,width:e.width,height:e.height}})).filter((e=>!!e))}_isSublayerInScale(e){const t=e.minScale||0,i=e.maxScale||0;return!(t>0&&t<this.scale||i>this.scale)}_isLegendLayerInScale(e,t){const i=t||this.layer;let r=null,s=null,n=!0;return!i.minScale&&0!==i.minScale||!i.maxScale&&0!==i.maxScale?(0===e.minScale&&i.tileInfo&&(r=i.tileInfo.lods[0].scale),0===e.maxScale&&i.tileInfo&&(s=i.tileInfo.lods[i.tileInfo.lods.length-1].scale)):(r=Math.min(i.minScale,e.minScale)||i.minScale||e.minScale,s=Math.max(i.maxScale,e.maxScale)),(r>0&&r<this.scale||s>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;const i=t.renderer,r=e.some((e=>e.values));let s=null,n=null;return r&&e.some(((e,t)=>(e.values||(s=t,n=e,n.label||(n.label="others")),null!=n))),i?"unique-value"===i.type?n&&(e.splice(s,1),e.push(n)):"class-breaks"===i.type&&(n&&e.splice(s,1),e.reverse(),n&&e.push(n)):n&&(e.splice(s,1),e.push(n)),e}async _getRendererLegendElements(e,t={}){return function(e,t){return aIe(e)||lIe(e)||hIe(e)||cIe(e)||fIe(e)?"2d"===t.type||SMe(e):nIe(e)||sIe(e)||oIe(e)||uIe(e)||pIe(e)||dIe(e)||rIe(e)}(e,this.view)?function(e){return uIe(e)||pIe(e)||dIe(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e)?this._constructPointCloudRendererLegendElements(e,t):fIe(e)?this._constructDotDensityRendererLegendElements(e):this._constructRendererLegendElements(e,t):(YTe.warn(`Renderer of type '${e.type}' not supported!`),[])}_getPointCloudRendererTitle(e){return e.legendOptions&&e.legendOptions.title||e.field}_constructPointCloudRendererLegendElements(e,t={}){const i=t.title,r=[];let s=null,n=null;if(uIe(e))s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((e=>{s.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(tIe,e.color)})}));else if(pIe(e)){const t=e.stops;let r=null;if(t.length&&(1===t.length&&(r=t[0].color),!r)){const e=t[0].value,i=t[t.length-1].value;null!=e&&null!=i&&(r=UMe(e+(i-e)/2,t))}s={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(tIe,r||tIe.color)}]};const o=function(e){let t=!1,i=[],r=[];i=e.map((e=>e.value)),t=e.some((e=>!!e.label)),t&&(r=e.map((e=>e.label)));const s=i[0],n=i[i.length-1];if(null==s&&null==n)return null;const o=t?null:NMe(i,!1);return i.map(((i,s)=>({value:i,color:UMe(i,e),label:t?r[s]:o[s]}))).reverse()}(e.stops);n={type:"color-ramp",title:i||this._getPointCloudRendererTitle(e),infos:o,preview:zq(o.map((e=>e.color)))}}else dIe(e)&&(s={type:"symbol-table",title:i||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((e=>{s.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(tIe,e.color)})})));s&&s.infos.length&&r.push(s),n&&n.infos.length&&r.push(n);return pt(r.reduce(((e,t)=>e.concat(t.infos)),[]).filter((e=>!!e.symbol)).map((t=>this._getSymbolPreview(t,this.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})))).then((()=>r))}_getElementInfoForDotDensity(e,t){const{backgroundColor:i,outline:r,dotSize:s}=e,n=s+"-"+t+"-"+i+"-"+(r&&JSON.stringify(r.toJSON())),o=this._dotDensityUrlCache,a=o.has(n)?o.get(n):function(e,t,i){const{backgroundColor:r,outline:s,dotSize:n}=e,o=i&&i.swatchSize||22,a=Math.round(o*o/n**2*.8),l=window.devicePixelRatio,h=document.createElement("canvas"),c=o*l;h.width=c,h.height=c,h.style.width=h.width/l+"px",h.style.height=h.height/l+"px";const u=h.getContext("2d");if(r&&(u.fillStyle=r.toCss(!0),u.fillRect(0,0,c,c),u.fill()),u.fillStyle=t.toCss(!0),jq&&jq.length/2===a)for(let d=0;d<2*a;d+=2){const e=jq[d],t=jq[d+1];u.fillRect(e,t,n*l,n*l),u.fill()}else{jq=[];for(let e=0;e<2*a;e+=2){const e=Nq(0,c),t=Nq(0,c);jq.push(e,t),u.fillRect(e,t,n*l,n*l),u.fill()}}s&&(s.color&&(u.strokeStyle=s.color.toCss(!0)),u.lineWidth=s.width,u.strokeRect(0,0,c,c));const p=new Image(o,o);return p.src=h.toDataURL(),p}(e,t);return o.set(n,a),{opacity:1,src:a.src,preview:a,width:a.width,height:a.height}}_constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),i=e.legendOptions&&e.legendOptions.unit,r={type:"symbol-table",title:{value:t&&Math.round(t),unit:i||""},infos:[]};return e.attributes.forEach((t=>{const i=this._getElementInfoForDotDensity(e,t.color);i.label=t.label||t.valueExpressionTitle||t.field,r.infos.push(i)})),Promise.resolve([r])}async _constructRendererLegendElements(e,t={}){const{title:i,sublayer:r}=t,s=r||this.layer;let n=await this._loadRenderer(e);this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const o=await this._getVisualVariableLegendElements(n,s)||[],a={type:"symbol-table",title:i||this._getRendererTitle(n,s),infos:[]};let l=null,h=!1;const c=new Set;if(function(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)}(n)){let e=i;const t=function(e){const t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme)}(n)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",r=o.findIndex((e=>"color-ramp"===e.type)),s=o.splice(r,1)[0],a=o.findIndex((e=>"size-ramp"===e.type)),l=o.splice(a,1)[0],h=[];s&&(e=s.title,h.push(s)),l&&(e=l.title,h.push(l)),h.length>0&&o.push({type:t,title:e,infos:h})}else if(cIe(n)){const e=function(e){let t=e.colorStops,i=t.length-1;if(t&&t[0]){const e=t[i];e&&1!==e.ratio&&(t=t.slice(0),t.push(new nN({ratio:1,color:e.color})),i++)}return t.map(((e,t)=>{let r="";return 0===t?r="low":t===i&&(r="high"),{color:e.color,label:r,ratio:e.ratio}})).reverse()}(n);o.push({type:"heatmap-ramp",title:i,infos:e,preview:zq(e.map((e=>e.color)))})}else if(hIe(n)){const e=n&&n.authoringInfo;if(e&&"relationship"===e.type){const{focus:t,numClasses:i,field1:r,field2:l}=e;if(i&&r&&l){const e=[r,l];let h=zTe(t)||0;for(const t of e){const{field:e,normalizationField:i,label:r}=t,n=r||{field:this._getFieldAlias(e,s),normField:i&&this._getFieldAlias(i,s)},o=bIe.clone();o.angle=h,a.infos.push({label:n,symbol:o}),c.add(o),h+=90}const u=function(e){const{focus:t,infos:i,numClasses:r}=e,s=FTe[r],n={};i.forEach((e=>{n[e.value]={label:e.label,fill:jTe(e.symbol)}}));const o=[];for(let a=0;a<r;a++){const e=[];for(let t=0;t<r;t++){const i=n[s[a][t]];e.push(i.fill)}o.push(e)}return{type:"relationship-ramp",numClasses:r,focus:t,colors:o,labels:NTe(t,n),rotation:zTe(t)}}({focus:t,numClasses:i,infos:n.uniqueValueInfos});o.unshift(u)}}else{const e=n.field;n.uniqueValueInfos.forEach((t=>{t.symbol&&a.infos.push({label:t.label||this._getDomainName(e,t.value,s)||t.value,value:t.value,symbol:t.symbol})}))}n.defaultSymbol&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),h=!0)}else if(lIe(n))l=this._isUnclassedRenderer(n),(!l||!this._hasSizeRamp)&&(n.classBreakInfos.forEach((e=>{e.symbol&&a.infos.unshift({label:e.label||(l?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),l&&(a.title=null),this._updateInfosforClassedSizeRenderer(n,a.infos)),n.defaultSymbol&&!l&&(a.infos.push({label:n.defaultLabel||"others",symbol:n.defaultSymbol}),h=!0);else if(nIe(n)){var u,p;if(vIe(this.layer)&&"Map"===(null==(u=this.layer)||null==(p=u.raster)?void 0:p.tileType))this._getServerSideLegend();else if(vIe(this.layer)||function(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const e=this._constructTileImageryStretchRendererElements(n);!function(e){return"stretch-ramp"===e.type}(e)?a.infos=e:o.push(e)}else{const e=this.layer;let t,i;var d,f;n.statistics&&n.statistics.length?(t=null!=n.statistics[0].min?n.statistics[0].min:n.statistics[0][0],i=null!=n.statistics[0].max?n.statistics[0].max:n.statistics[0][1]):(t=null==(d=n)?void 0:d.outputMin,i=null==(f=n)?void 0:f.outputMax);let r=[];const s=e.renderingRule?await e.generateRasterInfo(e.renderingRule):e.serviceRasterInfo,l=s.keyProperties.BandProperties;1===s.bandCount?(t=null!=t?t:s.statistics&&s.statistics[0].min,i=null!=i?i:s.statistics&&s.statistics[0].max,t||i?o.push(this._getStretchLegendElements(n,{min:t,max:i})):this._getServerSideLegend()):e.bandIds&&1===e.bandIds.length?(t=null!=t?t:s.statistics&&s.statistics[e.bandIds[0]].min,i=null!=i?i:s.statistics&&s.statistics[e.bandIds[0]].max,t||i?o.push(this._getStretchLegendElements(n,{min:t,max:i})):this._getServerSideLegend()):s.bandCount>=3?l&&l.length>=s.bandCount?e.bandIds&&3===e.bandIds.length?(r=e.bandIds.map((e=>l[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(r)):"lerc"===e.format?(r=[0,1,2].map((e=>l[e].BandName)),a.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend():"lerc"===e.format?(r=["band1","band2","band3"],a.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend():this._getServerSideLegend()}}else if(sIe(n))n.colormapInfos.forEach((e=>{a.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(iIe,e.color)})}));else if(aIe(n)){let e=n.symbol;switch(t.geometryType){case"point":e="pointSymbol"in s&&s.pointSymbol;break;case"polyline":e="lineSymbol"in s&&s.lineSymbol;break;case"polygon":e="polygonSymbol"in s&&s.polygonSymbol}n.symbol&&!this._hasSizeRamp&&a.infos.push({label:n.label,symbol:e})}else if(rIe(n)){n.outputUnit&&(this.title="("+n.toJSON().outputUnit+")"),a.title=n.attributeField;const e=n.getClassBreakInfos();null!=e&&e.length?e.forEach((e=>{a.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):a.infos.push({label:n.attributeField,symbol:n.getDefaultSymbol()})}else oIe(n)&&o.push(this._getStretchLegendElements(n,{min:0,max:255}));const y=n.defaultSymbol;!y||h||aIe(n)||l&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||o.push({type:"symbol-table",infos:[{label:n.defaultLabel||"others",symbol:y}]}),a.infos.length&&o.unshift(a);const g=null==t.opacity?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in n&&n.visualVariables),v=mIe(this.layer)||vIe(this.layer),b=o.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]).filter((e=>!(!e||!e.symbol))).map((e=>this._getSymbolPreview(e,g,{applyScaleDrivenSize:!c.has(e.symbol),symbolConfig:{isTall:m,isSquareFill:v}})));return n=null,await pt(b),o}_getServerSideLegend(){setTimeout((()=>this.buildLegendElementsForTools()),0)}_getAllInfos(e){const t=null==e?void 0:e.infos;return t?t.reduce(((e,t)=>e.concat(this._getAllInfos(t))),[]):[e]}_constructTileImageryStretchRendererElements(e){var t,i;const r=this.layer,s=r.rasterInfo,n=s.bandCount||e.statistics.length;let o,a,l=[];const h=s.keyProperties&&s.keyProperties.BandProperties,c=null!=e&&null!=(t=e.statistics)&&t.length?e.statistics:null==s?void 0:s.statistics;if(c)o=void 0!==c[0].min?c[0].min:c[0][0],a=c[0].max||c[0][1];else{const e=eIe[r.rasterInfo.pixelType.toLowerCase()];o=e[0],a=e[1]}if(r.hasStandardTime()&&(o=r.getStandardTimeValue(o),a=r.getStandardTimeValue(a)),1===s.bandCount||1===(null==(i=r.bandIds)?void 0:i.length))return this._getStretchLegendElements(e,{min:o,max:a});function u(e){var t;const i=(null!=r&&null!=(t=r.bandIds)&&t.length?r.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((t=>e&&e[t]&&e[t].BandName||"band"+(t+1)));return i.length<3?i.push(i[1]):i.length>3&&i.splice(3),i}return l=h&&h.length>=n?u(h):u(),this._createSymbolTableElementMultiBand(l)}_getStretchLegendElements(e,t){const i=function(e,t){let i=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach((function(r,s){0===s?i.push({value:t.max,color:new Rv(r.toColor),label:"high"}):i.push({value:null,color:new Rv(r.toColor),label:""}),s===e.colorRamps.length-1?i.push({value:t.min,color:new Rv(r.fromColor),label:"low"}):i.push({value:null,color:new Rv(r.fromColor),label:""})}));else{let r,s;e&&"algorithmic"===e.type?(r=e.fromColor,s=e.toColor):(r=[0,0,0,1],s=[255,255,255,1]),i=[{value:t.max,color:new Rv(s),label:"high"},{value:t.min,color:new Rv(r),label:"low"}]}return i}(e.colorRamp,t);return{type:"stretch-ramp",title:"",infos:i,preview:zq(i.map((e=>e.color)))}}_createSymbolTableElementMultiBand(e){const t=[],i=["red","green","blue"];return e.forEach(((e,r)=>{t.push({label:{colorName:i[r],bandName:e},src:FMe[r],opacity:1})})),t}_updateInfosforClassedSizeRenderer(e,t){const i=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,r=e.classBreakInfos.some((e=>Eq(e.symbol)));if(i&&r){const i=30,r=12,s=e.classBreakInfos.length,n=(i-r)/(s>1?s-1:s);t.forEach(((e,t)=>{e.size=i-n*t}))}}_isTallSymbol(e){let t=!1,i=!1;if(e)for(let r=0;r<e.length&&(!t||!i);r++){const s=e[r];"size"===s.type&&("height"===s.axis&&(t=!0),"width-and-depth"===s.axis&&(i=!0))}return t&&i}async _getSymbolPreview(e,t,i){let r=null==e.size&&this._hasSizeRamp?RS(22):e.size;if(this._scaleDrivenSizeVariable&&null!=i&&i.applyScaleDrivenSize){const{getSize:t}=await Promise.resolve().then((function(){return nj}));r=t(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===e.symbol.type?e.symbol.style:null})}return Vq(e.symbol,{size:r,opacity:t,scale:!1,symbolConfig:null==i?void 0:i.symbolConfig}).then((t=>(e.preview=t,e))).catch((()=>(e.preview=null,e)))}async _loadRenderer(e){var t,i;const r=[],s=this.layer;e=e.clone(),this._hasClusterSizeVariable=!1;const n="visualVariables"in e&&(null==(t=e.visualVariables)?void 0:t.some((e=>"size"===e.type&&"outline"!==e.target&&!ZTe.test(e.valueExpression))));if(e&&"visualVariables"in e&&!n&&"featureReduction"in s&&"cluster"===(null==(i=s.featureReduction)?void 0:i.type)){const t=function(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;const i=e.visualVariables.find((e=>"size"===e.type)),r=((e,t)=>{const i=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!=t&&t.levels?t.levels[i]:null})(t,i);return r?new pj({field:i.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}(this.layerView._effectiveRenderer,this.view);if(t){const i=s.featureReduction;if("clusterMinSize"in i&&"clusterMaxSize"in i){const{clusterMinSize:e,clusterMaxSize:r}=i;t.legendOptions=new zF({showLegend:e!==r})}const r=e.visualVariables||[];e.visualVariables=r.concat([t]),this._hasClusterSizeVariable=!0}}const o=await this._getMedianColor(e);if(lIe(e)||hIe(e)){const t=(e.classBreakInfos||e.uniqueValueInfos).map((e=>this._fetchSymbol(e.symbol,o).then((t=>{e.symbol=t})).catch((()=>{e.symbol=null}))));Array.prototype.push.apply(r,t)}return r.push(this._fetchSymbol(e.symbol||e.defaultSymbol,e.defaultSymbol?null:o).then((t=>{this._applySymbolToRenderer(e,t,aIe(e))})).catch((()=>{this._applySymbolToRenderer(e,null,aIe(e))}))),pt(r).then((()=>e))}_applySymbolToRenderer(e,t,i){i?e.symbol=t:e.defaultSymbol=t}async _getMedianColor(e){if(!("visualVariables"in e)||!e.visualVariables)return null;const t=e.visualVariables.find((e=>"color"===e.type));if(!t)return null;let i=null,r=null;if(t.stops){if(1===t.stops.length)return t.stops[0].color;i=t.stops[0].value,r=t.stops[t.stops.length-1].value}const s=i+(r-i)/2,{getColor:n}=await Promise.resolve().then((function(){return nj}));return n(t,s)}_fetchSymbol(e,t){if(!e)return Promise.reject();if("web-style"===e.type){const i=e.portal,r=i&&i.url,s=i&&i.user&&i.user.username,n=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+r+"-"+s,o=this._webStyleSymbolCache;return o.has(n)||("2d"===this.view.type?o.set(n,e.fetchCIMSymbol()):o.set(n,e.fetchSymbol())),o.get(n).then((e=>this._getAppliedCloneSymbol(e,t))).catch((()=>(YTe.warn("Fetching web-style failed!"),Promise.reject())))}return Promise.resolve(this._getAppliedCloneSymbol(e,t))}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const i=e.clone(),r=t&&t.toRgba();return i.type.indexOf("3d")>-1?this._applyColorTo3dSymbol(i,r):"cim"===i.type?yq(i,t):i.color&&(i.color=new Rv(r||i.color)),i}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach((e=>{e&&(e.material||(e.material={}),e.material.color=new Rv(t))}))}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||!e.visualVariables||"vector-field"===e.type)return null;const i=e.visualVariables,r=[],s=[],n=[];for(const h of i)"color"===h.type?r.push(h):"size"===h.type?s.push(h):"opacity"===h.type&&n.push(h);const o=[...r,...s,...n];let a,l;if(0===r.length&&lIe(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];a=t&&t.symbol}if(0===r.length&&aIe(e)&&(a=e.symbol),a)if(a.type.indexOf("3d")>-1){const e=a.symbolLayers.getItemAt(0);"water"===e.type?m(e.color)&&(l=e.color):m(e.material)&&m(e.material.color)&&(l=e.material.color)}else a.url||(l=a.color);return(await Promise.all(o.map((async i=>{if(!i.legendOptions||!1!==i.legendOptions.showLegend){const r=this._getRampTitle(i,t);let s=null;const n="getField"in t&&t.getField&&t.getField(i.field),o=n&&function(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}(n);if("color"===i.type){const e=await zMe(i,null,o);s={type:"color-ramp",title:r,infos:e,preview:zq(e.map((e=>e.color)))},this._hasColorRamp||(this._hasColorRamp=!(null==s.infos||!s.infos.length))}else if("size"===i.type&&"outline"!==i.target)ZTe.test(i.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=i):(s={type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(i):r,infos:await BTe(e,i,await this._getMedianColor(e),this.scale,this.view.type,o)},this._hasSizeRamp||(this._hasSizeRamp=!(null==s.infos||!s.infos.length)));else if("opacity"===i.type){const e=await zMe(i,l,o);s={type:"opacity-ramp",title:r,infos:e,preview:zq(e.map((e=>e.color)))},this._hasOpacityRamp||(this._hasOpacityRamp=!(null==s.infos||!s.infos.length))}return s&&s.infos?s:null}})))).filter((e=>!!e))}_getDomainName(e,t,i){if(e&&"function"!=typeof e){const r="getField"in i&&i.getField&&i.getField(e),s=r&&"getFieldDomain"in i&&i.getFieldDomain?i.getFieldDomain(r.name):null;return s&&"coded-value"===s.type?s.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,i=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,r="popupTemplate"in e&&e.popupTemplate,s=r&&r.fieldInfos;if(s)for(const t of s)if(t.fieldName===i)return"cluster_count"===i?t.label||{showCount:!0}:t.label}return{showCount:!0}}_getRampTitle(e,t){let i=e.field,r=e.normalizationField,s=!1,n=!1,o=!1,a=null;i="function"==typeof i?null:i,r="function"==typeof r?null:r;const l=e.legendOptions&&e.legendOptions.title;if(null!=l)a=l;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const i=e[t];if("color"===i.type){if("ratio"===i.style){s=!0;break}if("percent"===i.style){n=!0;break}if("percent-of-total"===i.style){o=!0;break}}}}a={field:i&&this._getFieldAlias(i,t),normField:r&&this._getFieldAlias(r,t),ratio:s,ratioPercent:n,ratioPercentTotal:o}}return a}_getRendererTitle(e,t){const i=e;if(i.legendOptions&&i.legendOptions.title)return i.legendOptions.title;if(i.valueExpressionTitle)return i.valueExpressionTitle;let r=i.field,s=null,n=null;lIe(i)&&(s=i.normalizationField,n="percent-of-total"===i.normalizationType),r="function"==typeof r?null:r,s="function"==typeof s?null:s;let o=null;return(r||s)&&(o={field:r&&this._getFieldAlias(r,t),normField:s&&this._getFieldAlias(s,t),normByPct:n}),o}_getFieldAlias(e,t){const i="popupTemplate"in t&&t.popupTemplate,r=i&&i.fieldInfos;let s=null;r&&r.some((t=>e===t.fieldName&&(s=t,!0)));let n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));const o=s||n;let a=null;return o&&(a=s&&s.label||n&&n.alias||"name"in o&&o.name||"fieldName"in o&&o.fieldName),a}_isUnclassedRenderer(e){const t=e.visualVariables;let i=!1;return lIe(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(i=e.field?t.some((t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField))):!!t.length),i}};Q([ro()],_Ie.prototype,"children",void 0),Q([ro()],_Ie.prototype,"layerView",void 0),Q([ro()],_Ie.prototype,"layer",void 0),Q([ro()],_Ie.prototype,"legendElements",void 0),Q([ro({readOnly:!0})],_Ie.prototype,"opacity",null),Q([ro()],_Ie.prototype,"parent",void 0),Q([ro({readOnly:!0,dependsOn:[]})],_Ie.prototype,"ready",null),Q([ro()],_Ie.prototype,"keepCacheOnDestroy",void 0),Q([ro()],_Ie.prototype,"respectLayerVisibility",void 0),Q([ro({readOnly:!0})],_Ie.prototype,"scale",null),Q([ro()],_Ie.prototype,"sublayerIds",void 0),Q([ro({readOnly:!0})],_Ie.prototype,"isScaleDriven",null),Q([ro()],_Ie.prototype,"title",void 0),Q([ro({readOnly:!0,dependsOn:["ready"],value:0})],_Ie.prototype,"version",null),Q([ro()],_Ie.prototype,"view",void 0),_Ie=Q([Ro("esri.widgets.Legend.support.ActiveLayerInfo")],_Ie);var xIe=_Ie;const SIe="state",MIe="view",TIe="all-layer-views",IIe="legend-properties",EIe=xh.ofType(xIe),AIe=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],PIe="view.basemapView.baseLayerViews",CIe="view.groundView.layerViews",OIe="view.basemapView.referenceLayerViews",kIe=[PIe,CIe,"view.layerViews",OIe];let LIe=class extends jo{constructor(e){super(e),this._handles=new Mh,this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new xh,this.activeLayerInfos=new EIe,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this._handles.add(Rh(this,"view",this._viewHandles),MIe),this._handles.add(ce((()=>this._refresh())))}destroy(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}_viewHandles(){this._handles.remove(SIe),this.view&&this._handles.add(Rh(this,"state",this._stateHandles),SIe)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this._handles.remove([TIe,IIe]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this._handles.remove(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{allLayerViews:e}=this.view;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),TIe),this._handles.add(Dh(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),IIe)}_allLayerViewsChangeHandle(e){e.removed.forEach((e=>this._destroyViewActiveLayerInfo(e.uid))),this._refresh()}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){if(e.length<2)return;const t=[];e.forEach((i=>{if(!i.parent){const r=i.layer.parent,s=r&&"uid"in r&&this._layerViewByLayerId[r.uid],n=s&&this._activeLayerInfosByLayerViewId[s.uid];n&&-1!==e.indexOf(n)&&(t.push(i),i.parent=n,n.children.add(i),this._sortActiveLayerInfos(n.children))}})),e.removeMany(t);const i={};this.view.allLayerViews.forEach(((e,t)=>i[e.layer.uid]=t)),e.sort(((e,t)=>{const r=i[e.layer.uid]||0;return(i[t.layer.uid]||0)-r}))}_generateLayerViews(){const e=[];return kIe.filter(this._filterLayerViews,this).map(this.get,this).filter((e=>null!=e)).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===PIe||e===OIe),i=!this.groundLegendVisible&&e===CIe;return!t&&!i}_collectLayerViews(e,t){const i=r=>(r&&r.forEach((r=>{t.push(r),i(r[e])})),t);return i}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some((t=>this._hasLayerInfo(t,e)))}_hasLayerInfo(e,t){const i=this._isLayerUIDMatching(e.layer,t.layer.uid);return i&&(this._layerInfosByLayerViewId[t.uid]=e),i}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some((e=>this._isLayerUIDMatching(e,t)))}_isLayerViewSupported(e){return!!AIe.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(Dh(e,"legendEnabled, layer.legendEnabled",(()=>this._layerActiveHandle(e))),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}_buildActiveLayerInfo(e){var t;const i=e.layer,r=e.uid,s=this._layerInfosByLayerViewId[r];let n=this._activeLayerInfosByLayerViewId[r];if(!n){const t=s&&void 0!==s.title&&s.layer.uid===i.uid;n=new xIe({layer:i,layerView:e,title:t?s.title:i.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:s&&s.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[r]=n}const o=i.parent&&"uid"in i.parent&&this._layerViewByLayerId[null==(t=i.parent)?void 0:t.uid];if(n.parent=this._activeLayerInfosByLayerViewId[null==o?void 0:o.uid],!this._handles.has(r)){const t=[Dh(i,"title",(e=>this._titleHandle(e,n))),Dh(i,"renderer?, opacity, pointSymbol?, lineSymbol?, polygonSymbol?",(()=>this._constructLegendElements(n))),Vh(this.view,"stationary",(()=>this._scaleHandle(n))),Dh(e,"_effectiveRenderer",(()=>this._constructLegendElements(n)))];if(this.respectLayerVisibility){const r=Dh(e,"legendEnabled",(e=>this._legendEnabledHandle(e,n))),s=Dh(i,"legendEnabled",(e=>this._legendEnabledHandle(e,n)));t.push(r,s)}this._handles.add(t,r)}n.isScaleDriven||this._constructLegendElements(n),this._addActiveLayerInfo(n)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){e.isScaleDriven&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:i}=e;if(this._isLayerActive(t)&&-1===this.activeLayerInfos.indexOf(e)){const t=e.parent;if(t)-1===t.children.indexOf(e)&&t.children.push(e),this._sortActiveLayerInfos(t.children);else{var r;const t=null==(r=this.layerInfos)?void 0:r.some((e=>e.layer.uid===i.uid));i.parent&&"uid"in i.parent&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach((t=>{const i=t.layer.parent,r=i&&"uid"in i&&this._layerViewByLayerId[null==i?void 0:i.uid],s=this._activeLayerInfosByLayerViewId[null==r?void 0:r.uid];s&&(e.push(t),t.parent=s)})),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach((e=>this._addActiveLayerInfo(e))))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"renderer"in t&&t.renderer?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url?e.buildLegendElementsForTools():e.children.forEach((e=>this._constructLegendElements(e)))}};Q([ro({type:EIe})],LIe.prototype,"activeLayerInfos",void 0),Q([ro()],LIe.prototype,"basemapLegendVisible",void 0),Q([ro()],LIe.prototype,"groundLegendVisible",void 0),Q([ro()],LIe.prototype,"keepCacheOnDestroy",void 0),Q([ro()],LIe.prototype,"respectLayerVisibility",void 0),Q([ro()],LIe.prototype,"layerInfos",void 0),Q([ro({readOnly:!0})],LIe.prototype,"state",null),Q([ro()],LIe.prototype,"view",void 0),LIe=Q([Ro("esri.widgets.Legend.LegendViewModel")],LIe);var RIe=LIe;const DIe="http://www.w3.org/2000/svg",FIe="esri-relationship-ramp--diamond__container",jIe="esri-relationship-ramp--diamond__left-column",NIe="esri-relationship-ramp--diamond__right-column",zIe="esri-relationship-ramp--diamond__middle-column",VIe="esri-relationship-ramp--diamond__middle-column--label",UIe="esri-relationship-ramp--diamond__middle-column--ramp",GIe="esri-relationship-ramp--square__table",BIe="esri-relationship-ramp--square__table-row",qIe="esri-relationship-ramp--square__table-cell",HIe="esri-relationship-ramp--square__table-label",WIe="esri-relationship-ramp--square__table-label--left-bottom",$Ie="esri-relationship-ramp--square__table-label--right-bottom",JIe="esri-relationship-ramp--square__table-label--left-top",XIe="esri-relationship-ramp--square__table-label--right-top";function KIe(e,t,i){const{focus:r,labels:s}=e,n=!!r,o=function(e,t,i,r=60){const{focus:s,numClasses:n,colors:o,rotation:a}=e,l=!!s,h=Math.sqrt(r**2+r**2)+(l?0:5);let c=null;null!=i&&(c=`opacity: ${i}`);const u=[],p=[],d=[],f=(r||75)/n;for(let T=0;T<n;T++){const e=T*f;for(let t=0;t<n;t++){const i=t*f,r=nTe(o[T][t]),s=oTe(null),n={type:"rect",x:i,y:e,width:f,height:f};u.push(lTe(r)),p.push(sTe(n,r.fill,s,null)),d.push(fTe(n))}}const y=10,g=15,m=15,v=10;let b=null;l||(b="margin: -15px -15px -18px -15px");const w=YIe("left",s,t),_=YIe("right",s,t),x=yTe(d),S=gTe(x,h,h,0,!1,a,!1),M=gTe(x,h,h,0,!1,l?-45:null,!1);return Iy("div",{style:c,class:l?UIe:qIe},Iy("svg",{xmlns:DIe,width:h,height:h,style:b},Iy("defs",null,Iy("marker",{id:`${t}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},Iy("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),Iy("marker",{id:`${t}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},Iy("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),u),Iy("g",{transform:S},p),Iy("g",{transform:M},Iy("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":w.markerStart,"marker-end":w.markerEnd,x1:-y,y1:r-g,x2:-y,y2:g}),Iy("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":_.markerStart,"marker-end":_.markerEnd,x1:m,y1:r+v,x2:r-m,y2:r+v}))))}(e,t,i);return n?Iy("div",{class:FIe},Iy("div",{class:jIe},s.left),Iy("div",{class:zIe},Iy("div",{class:VIe},s.top),o,Iy("div",{class:VIe},s.bottom)),Iy("div",{class:NIe},s.right)):Iy("div",{class:GIe},Iy("div",{class:BIe},Iy("div",{class:lu(qIe,HIe,$Ie)},s.left),Iy("div",{class:qIe}),Iy("div",{class:lu(qIe,HIe,WIe)},s.top)),Iy("div",{class:BIe},Iy("div",{class:qIe}),o,Iy("div",{class:qIe})),Iy("div",{class:BIe},Iy("div",{class:lu(qIe,HIe,XIe)},s.bottom),Iy("div",{class:qIe}),Iy("div",{class:lu(qIe,HIe,JIe)},s.right)))}function YIe(e,t,i){const r=`${i}_arrowStart`,s=`${i}_arrowEnd`,n="left"===e,o={markerStart:null,markerEnd:null};switch(t){case"HL":n?o.markerStart=`url(#${s})`:o.markerEnd=`url(#${r})`;break;case"LL":o.markerStart=`url(#${s})`;break;case"LH":n?o.markerEnd=`url(#${r})`:o.markerStart=`url(#${s})`;break;default:o.markerEnd=`url(#${r})`}return o}const ZIe=Yu(),QIe="esri-univariate-above-and-below-ramp__symbol",eEe="esri-legend__color-ramp";function tEe(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?Iy("svg",{height:"4",width:"10"},Iy("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):Iy("svg",{height:"10",width:"10"},Iy("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function iEe(e,t="vertical"){const i=document.createElement("div");return i.style.height="20px",i.className=QIe,null!=e&&(i.style.opacity=e.toString()),ZIe.append(i,tEe.bind(null,t)),i}function rEe(e,t,i="vertical",r){e.infos.forEach(((e,s)=>{if(r&&2===s)e.preview=iEe(t,i);else{const t=LS(e.size)+("horizontal"===i?20:10),r="div"===e.preview.tagName.toLowerCase(),s=r?e.preview:document.createElement("div");s.className=QIe,"horizontal"===i?s.style.width=`${t}px`:s.style.height=`${t}px`,r||s.appendChild(e.preview),e.preview=s}}))}function sEe(e,t="classic"){const i=e.infos;return"classic"===t?(LS(i[0].size)+10)/2:(LS(i[0].size)-LS(i[i.length-1].size))/2}function nEe(e,t){if(!e)return null;const i=e.infos.map((e=>e.color)),r=zq("full"===t.type?i:"above"===t.type?i.slice(0,3):i.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment});return r.className=eEe,null!=t.opacity&&(r.style.opacity=t.opacity.toString()),r}function oEe(e,t,i,r="vertical"){let s=0;const n=e.infos,o=Math.floor(n.length/2),a="full"===t||"above"===t?0:o,l="full"===t||"below"===t?n.length-1:o;for(let h=a;h<=l;h++)s+=i&&h===o?"horizontal"===r?10:20:LS(n[h].size)+("horizontal"===r?20:10);return Math.round(s)}function aEe(e,t,i,r="vertical"){const s=oEe(e,t,i,r),n=e.infos,o=Math.floor(n.length/2),a="full"===t||"above"===t?0:o,l="full"===t||"below"===t?n.length-1:o,h="full"===t?n[a].size+n[l].size:"above"===t?n[a].size:n[l].size,c=i?"vertical"===r?20:10:0,u="vertical"===r?10*("full"===t?2:1):20*("full"===t?2:1);return Math.round(s-(LS(h)/2+c/2+u/2))}function lEe(e,t,i="vertical"){const r=e.infos;let s=r.filter((({type:e})=>"size-ramp"===e))[0],n=r.filter((({type:e})=>"color-ramp"===e))[0];var o;return s&&(s=a({},s),s.infos=[...s.infos]),n&&(n=a({},n),n.infos=[...n.infos]),rEe(s,t,i,!0),"horizontal"===i&&(s.infos.reverse(),null==(o=n)||o.infos.reverse()),{sizeRampElement:s,colorRampElement:n}}function hEe(e,t="vertical"){const i=e.infos;let r=i.filter((({type:e})=>"size-ramp"===e))[0],s=i.filter((({type:e})=>"color-ramp"===e))[0];var n;return r&&(r=a({},r),r.infos=[...r.infos]),s&&(s=a({},s),s.infos=[...s.infos]),rEe(r,null,t,!1),"horizontal"===t&&(r.infos.reverse(),null==(n=s)||n.infos.reverse()),{sizeRampElement:r,colorRampElement:s}}function cEe(e){e.appendChild(this)}function uEe(e,t,i){if(!t)return;if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return Ve(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;let r=null;return function(e,t){return t}(0,i)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:pEe(t,i)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?Ve("showField"===r?"{field}":e[r],{field:t.field,normField:t.normField}):null}function pEe(e,t){return!t}function dEe(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}const fEe="esri-legend--card__carousel-indicator--activated",yEe="esri-legend--card",gEe="esri-legend--stacked",mEe="esri-legend--card__carousel-title",vEe="esri-legend--card__carousel-indicator",bEe="esri-legend--card__interval-separator",wEe="esri-legend--card__imagery-layer-image--stretched",_Ee="esri-legend--card__image-label",xEe="esri-legend--card__layer-caption",SEe="esri-legend--card__label-element",MEe="esri-legend--card__layer-row",TEe="esri-legend--card__label-cell",IEe="esri-legend--card__message",EEe="esri-legend--card__ramp-label",AEe="esri-legend--card__section",PEe="esri-legend--card__service-caption-text",CEe="esri-legend--card__service-content",OEe="esri-legend--card__service",kEe="esri-legend--card__group-layer",LEe="esri-legend--card__group-layer-child",REe="esri-legend--card__symbol",DEe="esri-legend--card__size-ramp-row",FEe="esri-legend--card__symbol-row",jEe="esri-legend--card__symbol-cell",NEe="esri-legend--card__carousel-indicator-container",zEe="esri-legend--card__interval-separators-container",VEe="esri-legend--card__relationship-label-container",UEe="esri-legend--card__label-container",GEe="esri-legend--card__service-caption-container",BEe="esri-legend--card__symbol-container",qEe="esri-legend--card__size-ramp-container",HEe="esri-legend--card__size-ramp-preview",WEe="esri-legend__size-ramp--horizontal",$Ee="esri-legend__ramp-labels",JEe="esri-legend__layer-cell esri-legend__layer-cell--info",XEe="esri-univariate-above-and-below-ramp__color--card",KEe=window.devicePixelRatio;let YEe=class extends xy{constructor(e,t){super(e,t),this._handles=new Mh,this._hasIndicators=!1,this._selectedSectionName=null,this._sectionNames=[],this._sectionMap=new Map,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}initialize(){this.own([this.watch("activeLayerInfos",(e=>{this._handles.removeAll(),this._watchForSectionChanges(e)}))])}destroy(){this._handles.destroy(),this._handles=null}render(){this._hasIndicators="auto"===this.layout&&this.view.container.clientWidth<=768||"stack"===this.layout;const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;const i=this._sectionNames.length,r=this._sectionNames.map(((e,t)=>{const r=Ve(this.messagesCommon.pagination.pageText,{index:t+1,total:i});return Iy("div",{key:e,role:"tab",id:e,"aria-label":r,"aria-controls":`${e}-panel`,"aria-selected":(this._selectedSectionName===e).toString(),tabIndex:this._selectedSectionName===e?0:-1,title:r,onclick:this._selectSection,onkeydown:this._focusSection,bind:this,class:this.classes(vEe,{[fEe]:this._selectedSectionName===e}),"data-section-name":e})})),s=this._hasIndicators&&i>1?Iy("div",{class:NEe,key:"carousel-navigation",role:"tablist"},r):null,n=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):t&&t.length?t:null,o={[gEe]:this._hasIndicators};return Iy("div",{class:this.classes(yEe,o)},n||Iy("div",{class:IEe},this.messages.noLegend),s)}_selectSection(e){const t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}_focusSection(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}_switchSectionOnArrowPress(e){const t=e.key,i="ArrowLeft"===t?-1:1,r=e.target.getAttribute("data-section-name"),s=this._sectionNames.indexOf(r),n=this._sectionNames;let o=null;-1!==s&&(n[s+i]?o=document.getElementById(n[s+i]):"ArrowLeft"===t?o=document.getElementById(n[n.length-1]):"ArrowRight"===t&&(o=document.getElementById(n[0])),o&&o.focus())}_watchForSectionChanges(e){if(this._generateSectionNames(),e){e.forEach((e=>{const t=`activeLayerInfo-${e.layer.uid}-version-change`;this._handles.remove(t),this._watchForSectionChanges(e.children),this._handles.add(e.watch("version",(()=>this._generateSectionNames())),t)}));const t="activeLayerInfos-collection-change";this._handles.remove(t),this._handles.add(e.on("change",(()=>this._watchForSectionChanges(e))),t)}}_generateSectionNames(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}_getSectionName(e,t,i){return`${this.id}${e.uid}-type-${t.type}-${i}`}_generateSectionNamesForActiveLayerInfo(e){e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach(((t,i)=>{this._sectionNames.push(this._getSectionName(e.layer,t,i))}))}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return Iy("div",{key:e.layer.uid,class:this.classes(OEe,kEe)},Iy("div",{class:GEe},e.title),t)}{const t=e.legendElements;if(t&&!t.length)return null;const i=t.some((e=>"relationship-ramp"===e.type)),r=t.map(((t,r)=>this._renderLegendForElement(t,e,r,i))).filter((e=>!!e));if(!r.length)return null;const s={[LEe]:!!e.parent};return Iy("div",{key:e.layer.uid,class:this.classes(OEe,s)},Iy("div",{class:GEe},Iy("div",{class:PEe},e.title)),Iy("div",{class:CEe},r))}}_renderLegendForElement(e,t,i,r=!1){const s="color-ramp"===e.type,n="opacity-ramp"===e.type,o="size-ramp"===e.type,a=t.layer;let l=null;if("string"==typeof e.title)l=e.title;else if(e.title){const t=e.title,i=uEe(this.messages,t,s||n);l=t.title?`${t.title} (${i})`:i}const h=this._getSectionName(a,e,i),c=this._hasIndicators?Iy("div",null,Iy(FC,{level:this.headingLevel,class:mEe},t.title),Iy(FC,{level:this.headingLevel+1,class:xEe},l)):l?Iy(FC,{level:this.headingLevel,class:xEe},l):null;let u=null;if("symbol-table"===e.type){const i=e.infos.map(((i,r)=>this._renderLegendForElementInfo(i,t,e.legendType,r))).filter((e=>!!e));if(i.length){const e=i[0].properties.classes&&i[0].properties.classes[FEe],t={[UEe]:!e&&!r,[VEe]:r};u=Iy("div",{class:this.classes(t)},i)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?u=this._renderLegendForRamp(e,a.opacity):o?u=this._renderSizeRamp(e,a.opacity):"relationship-ramp"===e.type?u=KIe(e,this.id,a.opacity):"univariate-above-and-below-ramp"===e.type?u=this._renderUnivariateAboveAndBelowRamp(e,a.opacity):"univariate-color-size-ramp"===e.type&&(u=this._renderUnivariateColorSizeRamp(e,a.opacity));if(!u)return null;const p=Iy("div",{key:h,class:AEe,id:`${h}-panel`,role:"tabpanel","aria-labelledby":h,tabIndex:0},[c,u]);return this._sectionMap.set(h,p),p}_renderUnivariateAboveAndBelowRamp(e,t){const{sizeRampElement:i,colorRampElement:r}=lEe(e,t,"horizontal"),s=oEe(i,"full",!0,"horizontal"),n=aEe(i,"above",!0,"horizontal"),o=aEe(i,"below",!0,"horizontal"),a=nEe(r,{width:n,height:12,rampAlignment:"horizontal",opacity:t,type:"above"}),l=nEe(r,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"below"}),h=sEe(i,"card"),c=i.infos.map((e=>e.label)),u=c.length-1,p=c.map(((e,t)=>0===t||t===u?Iy("div",{key:t},e):null)),d={marginTop:"3px",marginLeft:`${h}px`,display:"flex"},f={width:`${s}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return Iy("div",{class:MEe,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},Iy("div",{class:this.classes(BEe,WEe),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>Iy("div",{key:t,class:REe,bind:e.preview,afterCreate:cEe})))),a?Iy("div",{class:XEe,styles:d,key:"color-ramp-preview"},Iy("div",{bind:a,afterCreate:cEe}),Iy("div",{bind:l,afterCreate:cEe})):null,Iy("div",{class:JEe},Iy("div",{class:$Ee,styles:f},p)))}_renderUnivariateColorSizeRamp(e,t){const{sizeRampElement:i,colorRampElement:r}=hEe(e,"horizontal"),s=oEe(i,"full",!1,"horizontal"),n=nEe(r,{width:aEe(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full"}),o=sEe(i,"card"),a=i.infos.length-1,l=i.infos.map(((e,t)=>0===t||t===a?Iy("div",{key:t},e.label):null)),h={marginTop:"3px",marginLeft:`${o}px`,display:"flex"},c={width:`${s}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return Iy("div",{class:MEe,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},Iy("div",{class:this.classes(BEe,WEe),styles:{display:"flex",flexDirection:"row"}},i.infos.map(((e,t)=>Iy("div",{key:t,class:REe,bind:e.preview,afterCreate:cEe})))),Iy("div",{class:XEe,styles:h,key:"color-ramp-preview"},Iy("div",{bind:n,afterCreate:cEe})),Iy("div",{class:JEe},Iy("div",{class:$Ee,styles:c},l)))}_renderLegendForElementInfo(e,t,i,r){const s=t.layer;if(e.type)return this._renderLegendForElement(e,t,r);const n=dEe(s,i);if(e.preview){var o,a;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return Iy("div",{key:r,bind:e.preview,afterCreate:cEe});const t={[jEe]:this._hasIndicators};return Iy("div",{key:r,class:this.classes(MEe,{[FEe]:this._hasIndicators})},Iy("div",{class:this.classes(t),bind:e.preview,afterCreate:cEe}),Iy("div",{class:this.classes(_Ee,{[TEe]:this._hasIndicators})},uEe(this.messages,e.label,!1)||""))}let t=255,i=255,n=255,l=0,h=255,c=255,u=255,p=0;const d=e.symbol.color&&e.symbol.color.a,f=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;d&&(t=e.symbol.color.r,i=e.symbol.color.g,n=e.symbol.color.b,l=e.symbol.color.a*s.opacity),f&&(h=e.symbol.outline.color.r,c=e.symbol.outline.color.g,u=e.symbol.outline.color.b,p=e.symbol.outline.color.a*s.opacity);const y=null==(o=null==(a=e.symbol.color)?void 0:a.isBright)||o,g=y?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return Iy("div",{key:r,class:MEe},Iy("div",{class:SEe,styles:{background:d?`rgba(${t}, ${i}, ${n}, ${l})`:"none",color:y?"black":"white",textShadow:`-1px -1px 0 ${g},\n                                              1px -1px 0 ${g},\n                                              -1px 1px 0 ${g},\n                                              1px 1px 0 ${g}`,border:f?`1px solid rgba(${h}, ${c}, ${u}, ${p})`:"none"}}," ",e.label," "))}if(e.src){const t=this._renderImage(e,s,n);return Iy("div",{key:r,class:MEe},t,Iy("div",{class:_Ee},e.label||""))}}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,o={[wEe]:i,[REe]:!i},a={opacity:`${null!=n?n:t.opacity}`};return Iy("img",{alt:uEe(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}_renderSizeRampLines(e){const t=e.infos,i=t[0],r=t[t.length-1],s=i.symbol,n=this._hasIndicators,o=LS(i.size+i.outlineSize)*KEe,a=LS(r.size+r.outlineSize)*KEe,l=n?o:o+50*KEe,h=n?o/2+50*KEe:o,c=function(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===i||"cone"===i||"tetrahedron"===i}return"triangle"===e.style}}(s),u=function(e){if(e){if(e.type.indexOf("3d")>-1){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const i=e.symbolLayers.getItemAt(t-1),r=i.resource&&i.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}{const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}}}(s),p=document.createElement("canvas");p.width=l,p.height=h,p.style.width=p.width/KEe+"px",p.style.height=p.height/KEe+"px";const d=p.getContext("2d");if(n){d.beginPath();const e=0,t=0,i=l/2-a/2,r=h;d.moveTo(e,t),d.lineTo(i,r);const s=l,n=0,o=l/2+a/2,c=h;d.moveTo(s,n),d.lineTo(o,c)}else{d.beginPath();const e=0,t=h/2-a/2,i=l,r=0;d.moveTo(e,t),d.lineTo(i,r);const s=0,n=h/2+a/2,o=l,c=h;d.moveTo(s,n),d.lineTo(o,c)}return d.strokeStyle="#ddd",d.stroke(),Iy("div",{bind:p,afterCreate:cEe,styles:n?{display:"flex",marginTop:`-${c?0:u?o/2:0}px`,marginBottom:`-${c?a:u?a/2:0}px`}:{display:"flex",marginRight:`-${c?0:u?o/2:0}px`,marginLeft:`-${c?0:u?a/2:0}px`}})}_renderSizeRamp(e,t){const i=e.infos,r=i[0].label,s=i[i.length-1].label;let n=i[0].preview,o=i[i.length-1].preview;const a=this._hasIndicators,l={"flex-direction":a?"column":"row-reverse"};n&&(n=n.cloneNode(!0),n.style.display="flex"),o&&(o=o.cloneNode(!0),o.style.display="flex");const h={opacity:null!=t?`${t}`:""};return Iy("div",{class:this.classes(MEe,{[DEe]:a})},Iy("div",{class:EEe},a?r:s),Iy("div",{class:qEe,styles:l},Iy("div",{bind:n,afterCreate:cEe,class:HEe,styles:h}),this._renderSizeRampLines(e),Iy("div",{bind:o,afterCreate:cEe,class:qEe,styles:h})),Iy("div",{class:EEe},a?s:r))}_renderLegendForRamp(e,t){const i=e.infos,r="heatmap-ramp"===e.type,s=i.length-1,n=25,o=s>2&&!r?25*s:100,a=o+20,l=10,h=i.slice(0).reverse();h.forEach(((e,t)=>{e.offset=r?e.ratio:t/s}));const c=h.length-1,u=h.length%2!=0&&h[h.length/2|0],p=u&&Iy("div",{class:zEe},Iy("div",{class:bEe},"|"),Iy("div",{class:EEe},u.label)),d=i[i.length-1].label,f=i[0].label;let y=null;null!=t&&(y=`opacity: ${t}`);const g=mTe([[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:h[0].color,stroke:{width:0}},{shape:{type:"rect",x:l,y:0,width:o,height:n},fill:{type:"linear",x1:l,y1:0,x2:o+l,y2:0,colors:h},stroke:{width:0}},{shape:{type:"path",path:`M${o+l} 0 L${a} 12.5 L${o+l} 25 Z`},fill:h[c].color,stroke:{width:0}}]],a,n),{messages:m}=this;return Iy("div",{class:MEe},Iy("div",{class:EEe},r?m[d]:d),Iy("div",{class:BEe},Iy("div",{style:y},g),p),Iy("div",{class:EEe},r?m[f]:f))}};Q([ro()],YEe.prototype,"activeLayerInfos",void 0),Q([ro()],YEe.prototype,"headingLevel",void 0),Q([ro()],YEe.prototype,"layout",void 0),Q([ro(),Sy("esri/widgets/Legend/t9n/Legend")],YEe.prototype,"messages",void 0),Q([ro(),Sy("esri/t9n/common")],YEe.prototype,"messagesCommon",void 0),Q([ro({readOnly:!0})],YEe.prototype,"type",void 0),Q([ro()],YEe.prototype,"view",void 0),Q([Fy()],YEe.prototype,"_selectSection",null),YEe=Q([Ro("esri.widgets.Legend.styles.Card")],YEe);var ZEe=YEe;const QEe="esri-legend__service",eAe="esri-legend__service-label",tAe="esri-legend__layer",iAe="esri-legend__group-layer",rAe="esri-legend__group-layer-child",sAe="esri-legend__layer-table",nAe="esri-legend__layer-table--size-ramp",oAe="esri-legend__layer-child-table",aAe="esri-legend__layer-caption",lAe="esri-legend__layer-body",hAe="esri-legend__layer-row",cAe="esri-legend__layer-cell esri-legend__layer-cell--info",uAe="esri-legend__imagery-layer-image--stretched",pAe="esri-legend__imagery-layer-info--stretched",dAe="esri-legend__layer-cell esri-legend__layer-cell--symbols",fAe="esri-legend__symbol",yAe="esri-legend__ramps",gAe="esri-legend__size-ramp",mAe="esri-legend__color-ramp",vAe="esri-legend__opacity-ramp",bAe="esri-legend__ramp-labels",wAe="esri-legend__ramp-label",_Ae="esri-univariate-above-and-below-ramp__label",xAe="esri-legend__message",SAe="esri-widget__heading",MAe={display:"flex",alignItems:"flex-start"},TAe={marginLeft:"3px"},IAe={display:"table-cell",verticalAlign:"middle"};let EAe=class extends xy{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return Iy("div",null,t&&t.length?t:Iy("div",{class:xAe},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const t=!!e.children.length,i=`esri-legend__${e.layer.uid}-version-${e.version}`,r=e.title?FC({level:this.headingLevel,class:this.classes(SAe,eAe)},e.title):null;if(t){const t=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return Iy("div",{key:i,class:this.classes(QEe,iAe)},r,t)}{const t=e.legendElements;if(t&&!t.length)return null;const s=t.map((t=>this._renderLegendForElement(t,e.layer))).filter((e=>!!e));if(!s.length)return null;const n={[rAe]:!!e.parent};return Iy("div",{key:i,class:this.classes(QEe,n),tabIndex:0},r,Iy("div",{class:tAe},s))}}_renderLegendForElement(e,t,i){const r="color-ramp"===e.type,s="opacity-ramp"===e.type,n="size-ramp"===e.type;let o=null;if("symbol-table"===e.type||n){const i=e.infos.map((i=>this._renderLegendForElementInfo(i,t,n,e.legendType))).filter((e=>!!e));i.length&&(o=Iy("div",{class:lAe},i))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?o=KIe(e,this.id,t.opacity):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,t.opacity):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,t.opacity));if(!o)return null;const a=e.title;let l=null;if("string"==typeof a)l=a;else if(a){const e=uEe(this.messages,a,r||s);l=pEe(0,r||s)&&a.title?`${a.title} (${e})`:e}const h=i?oAe:sAe,c=l?Iy("div",{class:aAe},l):null,u={[nAe]:n||!i};return Iy("div",{class:this.classes(h,u)},c,o)}_renderUnivariateAboveAndBelowRamp(e,t){const{sizeRampElement:i,colorRampElement:r}=lEe(e,t),s=aEe(i,"above",!0),n=aEe(i,"below",!0),o=nEe(r,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above"}),a=nEe(r,{width:12,height:n,rampAlignment:"vertical",opacity:t,type:"below"}),l=sEe(i),h=i.infos.map((e=>e.label)),c=h.map(((e,t)=>{const i=2===t;return 0===t?Iy("div",{key:t,class:e?o?_Ae:wAe:null},e):i?Iy("div",null):null})),u=h.length-1,p=Math.floor(h.length/2),d=h.map(((e,t)=>t===p||t===u?Iy("div",{key:t,class:e?o?_Ae:wAe:null},e):null)),f={display:"table-cell",verticalAlign:"middle"},y={marginTop:`${l}px`},g={height:`${s}px`},m={height:`${n}px`};return Iy("div",{key:"univariate-above-and-below-ramp-preview",styles:MAe},Iy("div",{class:lAe},i.infos.map(((e,t)=>Iy("div",{class:this.classes(hAe,gAe)},Iy("div",{class:fAe,styles:f,bind:e.preview,afterCreate:cEe}),o||t%2!=0?null:Iy("div",{class:cAe},h[t]))))),o?Iy("div",{styles:y,key:"color-ramp-preview"},Iy("div",{styles:TAe},Iy("div",{styles:IAe},Iy("div",{class:yAe,bind:o,afterCreate:cEe})),Iy("div",{styles:IAe},Iy("div",{class:bAe,styles:g},c))),Iy("div",{styles:TAe},Iy("div",{styles:IAe},Iy("div",{class:yAe,bind:a,afterCreate:cEe})),Iy("div",{styles:IAe},Iy("div",{class:bAe,styles:m},d)))):null)}_renderUnivariateColorSizeRamp(e,t){const{sizeRampElement:i,colorRampElement:r}=hEe(e),s=sEe(i),n=aEe(i,"full",!1),o=nEe(r,{width:12,height:n,rampAlignment:"vertical",opacity:t,type:"full"}),a=i.infos.length-1,l=i.infos.map(((e,t)=>0===t||t===a?Iy("div",{key:t,class:e.label?r?_Ae:wAe:null},e.label):null)),h={display:"table-cell",verticalAlign:"middle"},c={marginTop:`${s}px`},u={height:`${n}px`};return Iy("div",{key:"univariate-above-and-below-ramp-preview",styles:MAe},Iy("div",{class:lAe},i.infos.map((e=>Iy("div",{class:this.classes(hAe,gAe)},Iy("div",{class:fAe,styles:h,bind:e.preview,afterCreate:cEe}))))),Iy("div",{styles:c,key:"color-ramp-preview"},Iy("div",{styles:TAe},Iy("div",{styles:IAe},Iy("div",{class:yAe,bind:o,afterCreate:cEe})),Iy("div",{styles:IAe},Iy("div",{class:bAe,styles:u},l)))))}_renderLegendForRamp(e,t){const i=e.infos,r="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,n="stretch-ramp"===e.type,o=e.preview,a=r?vAe:"";o.className=`${mAe} ${a}`,null!=t&&(o.style.opacity=t.toString());const l=i.map((e=>Iy("div",{class:e.label?wAe:null},s?this.messages[e.label]:n?this._getStretchStopLabel(e):e.label))),h={width:"24px"},c={height:o.style.height};return Iy("div",{class:hAe},Iy("div",{class:dAe,styles:h},Iy("div",{class:yAe,bind:o,afterCreate:cEe})),Iy("div",{class:cAe},Iy("div",{class:bAe,styles:c},l)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:Ce(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}_renderLegendForElementInfo(e,t,i,r){if(e.type)return this._renderLegendForElement(e,t,!0);let s=null;const n=dEe(t,r);if(e.preview?s=Iy("div",{class:fAe,bind:e.preview,afterCreate:cEe}):e.src&&(s=this._renderImage(e,t,n)),!s)return null;const o={[pAe]:n},a={[pAe]:n,[gAe]:!n&&i};return Iy("div",{class:hAe},Iy("div",{class:this.classes(dAe,a)},s),Iy("div",{class:this.classes(cAe,o)},uEe(this.messages,e.label,!1)||""))}_renderImage(e,t,i){const{label:r,src:s,opacity:n}=e,o={[uAe]:i,[fAe]:!i},a={opacity:`${null!=n?n:t.opacity}`};return Iy("img",{alt:uEe(this.messages,r,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:a})}};Q([ro()],EAe.prototype,"activeLayerInfos",void 0),Q([ro()],EAe.prototype,"headingLevel",void 0),Q([ro(),Sy("esri/widgets/Legend/t9n/Legend")],EAe.prototype,"messages",void 0),Q([ro({readOnly:!0})],EAe.prototype,"type",void 0),EAe=Q([Ro("esri.widgets.Legend.styles.Classic")],EAe);var AAe=EAe;const PAe="esri-legend",CAe="esri-widget",OAe="esri-widget--panel",kAe="esri-icon-layer-list";let LAe=class extends xy{constructor(e,t){super(e,t),this._handles=new Mh,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.headingLevel=3,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=kAe,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new AAe,this.view=null,this.viewModel=new RIe}initialize(){this.own(Hh(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),Dh(this,"headingLevel",(e=>{const{style:t}=this;t&&(t.headingLevel=e)})),Rh(this,"style",((e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)})))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof ZEe||e instanceof AAe)return e;if("string"==typeof e)return"card"===e?new ZEe:new AAe;if(e&&"string"==typeof e.type){const t=a({},e);return delete t.type,new("card"===e.type?ZEe:AAe)(t)}return new AAe}render(){return Iy("div",{class:this.classes(PAe,CAe,this.style instanceof AAe?OAe:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const t=Rh(e,"version",(()=>this.scheduleRender()));this._handles.add(t,`version_${e.layer.uid}`);const i=Hh(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(i,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};Q([eh("viewModel.activeLayerInfos")],LAe.prototype,"activeLayerInfos",void 0),Q([eh("viewModel.basemapLegendVisible")],LAe.prototype,"basemapLegendVisible",void 0),Q([eh("viewModel.groundLegendVisible")],LAe.prototype,"groundLegendVisible",void 0),Q([ro()],LAe.prototype,"headingLevel",void 0),Q([eh("viewModel.keepCacheOnDestroy")],LAe.prototype,"keepCacheOnDestroy",void 0),Q([eh("viewModel.respectLayerVisibility")],LAe.prototype,"respectLayerVisibility",void 0),Q([ro()],LAe.prototype,"iconClass",void 0),Q([ro({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],LAe.prototype,"label",void 0),Q([eh("viewModel.layerInfos")],LAe.prototype,"layerInfos",void 0),Q([ro(),Sy("esri/widgets/Legend/t9n/Legend")],LAe.prototype,"messages",void 0),Q([ro()],LAe.prototype,"style",void 0),Q([Ra("style")],LAe.prototype,"castStyle",null),Q([eh("viewModel.view")],LAe.prototype,"view",void 0),Q([ro()],LAe.prototype,"viewModel",void 0),LAe=Q([Ro("esri.widgets.Legend")],LAe);var RAe=LAe,DAe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:RAe});function FAe(){return RY()}function jAe(e,t,i=0){const r=[[e.x,e.y]],s=[],n=function(e){let t=null;if(e||(e=Aa.WGS84),e.wkid){if(t=jY.geogcs(e.wkid),!t)throw new Be("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt)throw new Be("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=jY.fromString(FY.PE_TYPE_GEOGCS,e.wkt),!t)throw new Be("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}(e.spatialReference);let o=0;switch(t){case"dd":o=GY.geog_to_dd(n,1,r,i,s);break;case"ddm":o=GY.geog_to_ddm(n,1,r,i,s);break;case"dms":o=GY.geog_to_dms(n,1,r,i,s);break;default:return console.warn(`invalid format: ${t}`),null}return o?s[0]:null}var NAe={exports:{}};!function(e,t){var i=function(){function e(e){if("number"==typeof e)return $.Uc.$g(e);if(null==e)return null;if(null!=se[e])return $.Uc.$g(se[e]);throw Error("Unrecognised Unit Type")}function t(e){if("number"==typeof e)return $.Uc.$g(e);if(null==e)return null;if(null!=ne[e])return $.Uc.$g(ne[e]);throw Error("Unrecognised Unit Type")}function i(e){if(e)switch(e){case"loxodrome":return 1;case"great-elliptic":return 2;case"normal-section":return 3;case"shape-preserving":return 4}return 0}function r(e,t,i,r){if(null==i||i.B())return null;switch(i.K()){case $.sn.Point:return e.exportPoint(t,i,r);case $.sn.Polygon:return e.exportPolygon(t,i,r);case $.sn.Polyline:return e.exportPolyline(t,i,r);case $.sn.MultiPoint:return e.exportMultipoint(t,i,r);case $.sn.Envelope:return e.exportExtent(t,i,r)}return null}function s(e,t,i,r){if(i.K()!==$.sn.Point)throw Error("Geometry not Point");return e.exportPoint(t,i,r)}function n(e,t,i){return e.convertToGEGeometry(t,i)}function o(e){var t=e.wkid;e=e.wkt;var i=oe.get(t||e);return null==i&&(-1!==t&&null!=t?(i=$.Gg.create(t),oe.set(t,i)):e&&(i=$.Gg.iP(e),oe.set(e,i))),i}function a(e){var t;if(null==e)return null;var i=o(e);return e=i.Id(),i=i.Ln(),(t={}).tolerance=i,t.unitType=null==e?-1:e.od,t.unitID=null==e?-1:e.Fc(),t.unitBaseFactor=null==e?0:e.bi,t.unitSquareDerivative=null==e?0:$.Uc.TF(e).Fc(),t}function l(e,t,i,s){return null==i?null:(i=$.bc.clip(n(e,ae,i),n(e,ae,s),o(t)),r(e,ae,i,t))}function h(e,t,i,s){i=$.bc.el(n(e,ae,i),n(e,ae,s),o(t)),s=[];for(var a=0;a<i.length;a++)s.push(r(e,ae,i[a],t));return s}function c(e,t,i,r){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.contains(n(e,ae,i),n(e,ae,r),o(t))}function u(e,t,i,r){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.tP(n(e,ae,i),n(e,ae,r),o(t))}function p(t,i,r,s,a){if(null==r||null==s)throw Error("Illegal Argument Exception");return $.bc.ub(n(t,ae,r),n(t,ae,s),o(i),e(a))}function d(e,t,i,r){return!(null==i&&null!=r||null==r&&null!=i)&&$.bc.Nb(n(e,ae,i),n(e,ae,r),o(t))}function f(e,t,i,r){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.JS(n(e,ae,i),n(e,ae,r),o(t))}function y(e,t,i,r){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.touches(n(e,ae,i),n(e,ae,r),o(t))}function g(e,t,i,r){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.eY(n(e,ae,i),n(e,ae,r),o(t))}function m(e,t,i,r){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.LP(n(e,ae,i),n(e,ae,r),o(t))}function v(e,t,i,r){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.tU(n(e,ae,i),n(e,ae,r),o(t))}function b(e,t,i,r,s){if(null==i||null==r)throw Error("Illegal Argument Exception");return $.bc.sB(n(e,ae,i),n(e,ae,r),o(t),s)}function w(e,t,i){if(null==i)throw Error("Illegal Argument Exception");return $.bc.US(n(e,ae,i),o(t))}function _(e,t,i){if(null==i)throw Error("Illegal Argument Exception");return i=$.bc.YB(n(e,ae,i),o(t)),r(e,ae,i,t)}function x(e,t,i,s){if(void 0===s&&(s=!1),null==i)throw Error("Illegal Argument Exception");if(Array.isArray(i)){var a=s,l=[];for(s=0;s<i.length;s++)l.push(n(e,ae,i[s]));for(i=$.bc.bP(l,a),a=Array(i.length),s=0;s<i.length;s++)a[s]=r(e,ae,i[s],t);return a}return s=$.bc.aP(n(e,ae,i),o(t)),r(e,ae,s,t)}function S(e,t,i,s){if(null==i||null==s)throw Error("Illegal Argument Exception");if(Array.isArray(i)){for(var a=[],l=0;l<i.length;l++)a.push(n(e,ae,i[l]));for(i=$.bc.IP(a,n(e,ae,s),o(t)),s=Array(i.length),l=0;l<i.length;l++)s[l]=r(e,ae,i[l],t);return s}return l=$.bc.km(n(e,ae,i),n(e,ae,s),o(t)),r(e,ae,l,t)}function M(e,t,i,s){if(null==i||null==s)throw Error("Illegal Argument Exception");if(Array.isArray(i)){for(var a=[],l=0;l<i.length;l++)a.push(n(e,ae,i[l]));for(i=$.bc.JX(a,n(e,ae,s),o(t)),s=Array(i.length),l=0;l<i.length;l++)s[l]=r(e,ae,i[l],t);return s}return l=$.bc.fp(n(e,ae,i),n(e,ae,s),o(t)),r(e,ae,l,t)}function T(e,t,i,s){if(null==i||null==s)throw Error("Illegal Argument Exception");if(Array.isArray(i)){for(var a=[],l=0;l<i.length;l++)a.push(n(e,ae,i[l]));for(i=$.bc.HS(a,n(e,ae,s),o(t)),s=Array(i.length),l=0;l<i.length;l++)s[l]=r(e,ae,i[l],t);return s}return l=$.bc.Fa(n(e,ae,i),n(e,ae,s),o(t)),r(e,ae,l,t)}function I(e,t,i,s){if(null==i)return null;var a=[];if(Array.isArray(i)){if(0===i.length)return null;for(s=0;s<i.length;s++)a.push(n(e,ae,i[s]))}else a.push(n(e,ae,i)),null!=s&&a.push(n(e,ae,s));return r(e,ae,$.bc.YX(a,o(t)),t)}function E(t,i,s,a,l,h,c,u){var p=0;if(null!=h)switch(h){case"round":p=0;break;case"bevel":p=1;break;case"miter":p=2;break;case"square":p=3}if(Array.isArray(s)){if(null==s)t=null;else if(0===s.length)t=[];else{var d=[];for(h=0;h<s.length;h++)d.push(n(t,ae,s[h]));for(s=$.bc.rU(d,o(i),a,p,c,u,e(l)),a=Array(s.length),h=0;h<s.length;h++)a[h]=r(t,ae,s[h],i);t=a}return t}return s=$.bc.offset(n(t,ae,s),o(i),a,p,c,u,e(l)),r(t,ae,s,i)}function A(t,i,s,a,l,h){if(void 0===h&&(h=!1),Array.isArray(s)){if(!Array.isArray(a)){for(var c=[],u=0;u<s.length;u++)c.push(a);a=c}if(a.length!=s.length){if(0==a.length)throw Error("Illegal Argument Exception");c=[];var p=0;for(u=0;u<s.length;u++)void 0===a[u]?c.push(p):(c.push(a[u]),p=a[u]);a=c}return C(t,i,s,a,l,!1,h,"geodesic",NaN)}return s=$.bc.buffer(n(t,ae,s),o(i),a,e(l),!1,0,NaN),r(t,ae,s,i)}function P(t,s,a,l,h,c,u,p){if(Array.isArray(a)){if(!Array.isArray(l)){for(var d=[],f=0;f<a.length;f++)d.push(l);l=d}if(l.length!==a.length){if(0===l.length)throw Error("Illegal Argument Exception");d=[];var y=0;for(f=0;f<a.length;f++)void 0===l[f]?d.push(y):(d.push(l[f]),y=l[f]);l=d}return C(t,s,a,l,h,!0,c,u,p)}return void 0===u&&(u=NaN),a=$.bc.buffer(n(t,ae,a),o(s),l,e(h),!0,i(c),u),r(t,ae,a,s)}function C(t,s,a,l,h,c,u,p,d){if(void 0===d&&(d=NaN),null==a)return null;if(0===a.length)return[];for(var f=[],y=0;y<a.length;y++)f.push(n(t,ae,a[y]));for(a=$.bc.EN(f,o(s),l,e(h),c,u,i(p),d),l=Array(a.length),y=0;y<a.length;y++)l[y]=r(t,ae,a[y],s);return l}function O(e,t,i,r,o){var a;return void 0===o&&(o=!0),i=$.bc.iz(n(e,ae,i),n(e,ae,r),o),(a={}).coordinate=s(e,ae,i.az(),t),a.distance=i.cz(),a.isRightSide=i.Nz(),a.vertexIndex=i.Va(),a.isEmpty=i.B(),a}function k(e,t,i,r){var o;return i=$.bc.jz(n(e,ae,i),n(e,ae,r)),(o={}).coordinate=s(e,ae,i.az(),t),o.distance=i.cz(),o.isRightSide=i.Nz(),o.vertexIndex=i.Va(),o.isEmpty=i.B(),o}function L(e,t,i,r,o,a){var l;for(i=$.bc.kz(n(e,ae,i),n(e,ae,r),o,a),r=[],o=0;o<i.length;o++)!1===i[o].B()&&r.push(((l={}).coordinate=s(e,ae,i[o].az(),t),l.distance=i[o].cz(),l.isRightSide=i[o].Nz(),l.vertexIndex=i[o].Va(),l.isEmpty=i[o].B(),l));return r}function R(t,i,s,a,l,h){return s=$.bc.IQ(n(t,ae,s),o(i),a,l,e(h)),r(t,ae,s,i)}function D(t,i,s,a,l){return s=$.bc.Rr(n(t,ae,s),o(i),a,e(l)),r(t,ae,s,i)}function F(t,i,s,a,l,h){return void 0===h&&(h=0),s=$.bc.Ry(n(t,ae,s),o(i),a,e(l),h),r(t,ae,s,i)}function j(e,i,r,s){if(null==r)throw Error("Illegal Argument Exception");return $.bc.zU(n(e,ae,r),o(i),t(s))}function N(t,i,r,s){if(null==r)throw Error("Illegal Argument Exception");return $.bc.AU(n(t,ae,r),o(i),e(s))}function z(e,r,s,a,l){if(null==s)throw Error("Illegal Argument Exception");return $.bc.OQ(n(e,ae,s),o(r),t(a),i(l))}function V(t,r,s,a,l){if(null==s)throw Error("Illegal Argument Exception");return $.bc.RQ(n(t,ae,s),o(r),e(a),i(l))}function U(e){$.FL.bind(e)}function G(e,t,i,r,s){var a=null,l=null;if(r){if(!s)throw $.i.O("AOI missing Spatial Reference");a=n(e,ae,r),l=o(s).gh()}return null!==(e=$.hu.OR(o(t).gh(),o(i).gh(),a,l))?e:null}function B(e,t,i,r,s){var a=null,l=null;if(r){if(!s)throw $.i.O("AOI missing Spatial Reference");a=n(e,ae,r),l=o(s).gh()}return $.hu.PR(o(t).gh(),o(i).gh(),a,l)}function q(e,t,i,r,s){if(void 0===s&&(s=null),!1===this.zY)throw Error("Projection Engine must be enabled using enableProjection");if(0===t.length)return[];if(s){var n=s.getCachedGeTransformation(i,r);if(!n)e:{if(n=s,s=null,n){var a=n.getGTListEntry();if(null!==a){s=new $.pC(null);for(var l=0,h=a.steps;l<h.length;l++){a=h[l];var c=new $.Bx(a.geogtran);a.isInverse&&c.Lz(),s.add(c)}s=$.xr.Or(o(i).gh(),o(r).gh(),s),n.assignCachedGe(i,r,s),n=s;break e}}if(null===s&&n&&n.steps&&0<n.steps.length){for(s=new $.pC(null),l=0,h=n.steps;l<h.length;l++)-1!=(a=h[l]).wkid&&null!=a.wkid?s.add($.Bx.create(a.wkid,a.isInverse)):s.add($.Bx.mP(a.wkt,a.isInverse));s=$.xr.Or(o(i).gh(),o(r).gh(),s),n.assignCachedGe(i,r,s),n=s}else n=$.xr.Or(o(i).gh(),o(r).gh(),s)}for(i=[],a=0;a<t.length;a++)s=t[a],i.push(H(e,s,r,n))}else for(n=$.xr.Or(o(i).gh(),o(r).gh(),null),i=[],a=0;a<t.length;a++)s=t[a],i.push(H(e,s,r,n));return i}function H(e,t,i,s){return t=$.bc.Ah(n(e,ae,t),s),r(e,ae,t,i)}var W,$,J,X,K,Y,Z=this&&this.__extends||function(){function e(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)}return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(e){var t,i;(t=e.sn||(e.sn={}))[t.Unknown=0]="Unknown",t[t.Point=33]="Point",t[t.Line=322]="Line",t[t.Envelope=197]="Envelope",t[t.MultiPoint=550]="MultiPoint",t[t.Polyline=1607]="Polyline",t[t.Polygon=1736]="Polygon",(i=e.QK||(e.QK={}))[i.enumMild=0]="enumMild",i[i.enumMedium=1]="enumMedium",i[i.enumHot=2]="enumHot";var r=function(){function t(){this.description=null,this.PA=0}return t.prototype.K=function(){return 0},t.prototype.Eb=function(){return-1},t.prototype.kg=function(e){this.wc(),e!=this.description&&this.un(e)},t.prototype.un=function(){},t.prototype.Ll=function(t){this.wc(),t!=this.description&&(t=e.ee.uR(this.description,t))!=this.description&&this.un(t)},t.prototype.hasAttribute=function(e){return this.description.hasAttribute(e)},t.prototype.se=function(t){this.wc(),this.description.hasAttribute(t)||(t=e.ee.tR(this.description,t),this.un(t))},t.prototype.Ug=function(){return null},t.prototype.dn=function(){},t.prototype.A=function(){},t.prototype.Ro=function(){},t.prototype.yc=function(e){this.A(e)},t.prototype.B=function(){return!0},t.prototype.Pa=function(){},t.prototype.Pc=function(){},t.prototype.Ja=function(){return null},t.prototype.copyTo=function(){},t.prototype.He=function(){return 0},t.prototype.Rb=function(){return 0},t.prototype.aG=function(){return this.hasAttribute(1)},t.uf=function(e){return 1+((192&e)>>6)>>1},t.Sn=function(e){return 0!=(32&e)},t.KS=function(e){return 0!=(128&e)},t.zd=function(e){return 0!=(256&e)},t.yj=function(e){return 0!=(512&e)},t.Ic=function(e){return 0!=(1024&e)},t.prototype.Pf=function(){var e=this.Ja();return this.copyTo(e),e},t.prototype.mg=function(){return null},t.ig=function(e){var t=e.Ja();return e.copyTo(t),t},t.prototype.wc=function(){0<=this.PA&&(this.PA+=2147483649)},t.yx=function(i){var r=i.K();if(t.yj(r))return i.I();if(i.B())return 0;if(197==r)return 4;if(33==r)return 1;if(t.zd(r))return 2;throw e.i.ga("missing type")},t}();e.ba=r}($||($={})),J=$||($={}),X=function(){function e(){this.y=this.x=0}return e.construct=function(t,i){var r=new e;return r.x=t,r.y=i,r},e.bl=function(t){var i=new e;return i.x=t.x,i.y=t.y,i},e.prototype.na=function(e,t){this.x=e,this.y=t},e.prototype.N=function(e){this.x=e.x,this.y=e.y},e.prototype.hq=function(e,t){return this.x===e&&this.y===t},e.prototype.Mz=function(e){return 2220446049250313e-31>=Math.abs(this.x-e.x)&&2220446049250313e-31>=Math.abs(this.y-e.y)},e.prototype.rb=function(e){return this.x===e.x&&this.y===e.y},e.prototype.Nb=function(t){return t==this||t instanceof e&&this.x==t.x&&this.y==t.y},e.prototype.sub=function(e){this.x-=e.x,this.y-=e.y},e.prototype.vc=function(e,t){this.x=e.x-t.x,this.y=e.y-t.y},e.prototype.add=function(e,t){void 0!==t?(this.x=e.x+t.x,this.y=e.y+t.y):(this.x+=e.x,this.y+=e.y)},e.prototype.Uq=function(){this.x=-this.x,this.y=-this.y},e.prototype.mt=function(e){this.x=-e.x,this.y=-e.y},e.prototype.ES=function(e,t,i){this.x=e.x*(1-i)+t.x*i,this.y=e.y*(1-i)+t.y*i},e.prototype.Ct=function(e,t){this.x=this.x*e+t.x,this.y=this.y*e+t.y},e.prototype.wW=function(e,t,i){this.x=t.x*e+i.x,this.y=t.y*e+i.y},e.prototype.scale=function(e){this.x*=e,this.y*=e},e.prototype.compare=function(e){return this.y<e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:0},e.prototype.normalize=function(){var e=this.length();0==e&&(this.x=1,this.y=0),this.x/=e,this.y/=e},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.Sk=function(){return this.x*this.x+this.y*this.y},e.ub=function(e,t){return Math.sqrt(this.zc(e,t))},e.Jy=function(e,t,i,r){return e-=i,t-=r,Math.sqrt(e*e+t*t)},e.prototype.Rh=function(e){return this.x*e.x+this.y*e.y},e.prototype.YC=function(e){return Math.abs(this.x*e.x)+Math.abs(this.y*e.y)},e.prototype.xi=function(e){return this.x*e.y-this.y*e.x},e.prototype.Bt=function(e,t){var i=-this.x*t+this.y*e;this.x=this.x*e+this.y*t,this.y=i},e.prototype.Iv=function(){var e=this.x;this.x=-this.y,this.y=e},e.prototype.EG=function(e){this.x=-e.y,this.y=e.x},e.prototype.cr=function(){var e=this.x;this.x=this.y,this.y=-e},e.prototype.ru=function(){return 0<this.x?0<=this.y?1:4:0<this.y?2:0==this.x?4:3},e.ou=function(e,t){var i=e.ru(),r=t.ru();return r==i?0>(e=e.xi(t))?1:0<e?-1:0:i<r?-1:1},e.zc=function(e,t){var i=e.x-t.x;return i*i+(e=e.y-t.y)*e},e.prototype.toString=function(){return"("+this.x+" , "+this.y+")"},e.prototype.Sc=function(){this.y=this.x=NaN},e.prototype.isNaN=function(){return isNaN(this.x)||isNaN(this.y)},e.prototype.offset=function(t,i){var r=e.ub(t,i),s=e.construct(this.x,this.y);if(0==r)return e.ub(s,t);var n=new e;return n.N(i),n.sub(t),s.sub(t),s.xi(n)/r},e.Wq=function(e,t,i){var r=new J.Xb;r.set(t.x),r.sub(e.x);var s=new J.Xb;s.set(i.y),s.sub(e.y);var n=new J.Xb;n.set(t.y),n.sub(e.y);var o=new J.Xb;return o.set(i.x),o.sub(e.x),r.Ag(s),n.Ag(o),r.sub(n),r.qs()?(r=new J.ip(t.x),s=new J.ip(e.x),n=new J.ip(e.y),r=r.jt(s),e=(e=new J.ip(i.y)).jt(n),t=(t=new J.ip(t.y)).jt(n),i=(i=new J.ip(i.x)).jt(s),r=r.nr(e),t=t.nr(i),(r=r.nr(t)).dT()?-1:r.XR()?1:0):0>(i=r.value())?-1:0<i?1:0},e.prototype.dc=function(){return J.P.vj(J.P.vj())},e}(),J.h=X,K=$||($={}),Y=function(){function e(e){this.zy=this.Nt=0,this.CX=e}return e.prototype.reset=function(){this.zy=this.Nt=0},e.prototype.add=function(e){e-=this.zy;var t=this.Nt+e;this.zy=t-this.Nt-e,this.Nt=t},e.prototype.sub=function(e){this.add(-e)},e.prototype.tm=function(){return this.CX+this.Nt},e}(),K.Dx=Y,K.mc=function(){function e(){}return e.Dn=function(e,t){return 0<=t?Math.abs(e):-Math.abs(e)},e.sign=function(e){return 0>e?-1:0<e?1:0},e.JK=function(e){return e-360*Math.floor(e/360)},e.round=function(e){return Math.floor(e+.5)},e.nx=function(e){return e*e},e.jq=function(e,t,i){return.5>=i?e+(t-e)*i:t-(t-e)*(1-i)},e.GG=function(e,t,i,r){.5>=i?(r.x=e.x+(t.x-e.x)*i,r.y=e.y+(t.y-e.y)*i):(r.x=t.x-(t.x-e.x)*(1-i),r.y=t.y-(t.y-e.y)*(1-i))},e.bT=function(e,t,i,r,s,n){.5>=s?(n.x=e+(i-e)*s,n.y=t+(r-t)*s):(n.x=i-(i-e)*(1-s),n.y=r-(r-t)*(1-s))},e}(),function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.sa=0,e.oa=0,e.qa=0,e.ma=0,e.la=null,e}return Z(i,t),i.prototype.ac=function(){return e.h.construct(this.sa,this.oa)},i.prototype.$p=function(e){e.x=this.sa,e.y=this.oa},i.prototype.Ec=function(e){this.gm(0,e)},i.prototype.SB=function(t,i){this.gm(0,e.h.construct(t,i))},i.prototype.Uo=function(e){this.$C(0,e)},i.prototype.setStart=function(e){this.mD(0,e)},i.prototype.xv=function(e,t){return this.Pd(0,e,t)},i.prototype.RB=function(e,t,i){this.vn(0,e,t,i)},i.prototype.xc=function(){return e.h.construct(this.qa,this.ma)},i.prototype.Ur=function(e){e.x=this.qa,e.y=this.ma},i.prototype.Rc=function(e){this.gm(1,e)},i.prototype.Sl=function(t,i){this.gm(1,e.h.construct(t,i))},i.prototype.Qo=function(e){this.$C(1,e)},i.prototype.setEnd=function(e){this.mD(1,e)},i.prototype.hv=function(e,t){return this.Pd(1,e,t)},i.prototype.IB=function(e,t,i){this.vn(1,e,t,i)},i.prototype.Eb=function(){return 1},i.prototype.B=function(){return this.Bc()},i.prototype.Pa=function(){},i.prototype.He=function(){return 0},i.prototype.Fa=function(e,t,i,r,s){return this.CM(e,t,i,r,s)},i.prototype.isIntersecting=function(e,t){return 0!=this.Br(e,t,!1)},i.prototype.rs=function(e,t){return this.su(e,t,!1)},i.prototype.su=function(){return null},i.prototype.Bc=function(){return!1},i.prototype.Zx=function(t){if(this.wc(),null==this.la&&0<t)this.la=e.P.lg(2*t);else if(null!=this.la&&this.la.length<2*t){for(var i=this.la.slice(0),r=this.la.length;r<2*t;r++)i[r]=0;this.la=i}},i.ZL=function(e,t,i){if(0<i)var r=0;for(var s=0;s<i;s++)t[0+r]=e[0],r++},i.prototype.gm=function(e,t){0!=e?(this.qa=t.x,this.ma=t.y):(this.sa=t.x,this.oa=t.y)},i.prototype.un=function(t){if(null!=this.la){for(var r=e.ee.Jw(t,this.description),s=[],n=i.Ig(this.description,0),o=i.Ig(this.description,1),a=i.Ig(t,0),l=i.Ig(t,1),h=0,c=1,u=t.Ba;c<u;c++){var p=t.qd(c),d=e.ua.Wa(p);if(-1==r[c]){var f=e.ua.te(p);for(p=0;p<d;p++)s[a+h]=f,s[l+h]=f,h++}else for(f=this.description.$j(r[c])-2,p=0;p<d;p++)s[a+h]=this.la[n+f],s[l+h]=this.la[o+f],h++,f++}this.la=s}this.description=t},i.prototype.$C=function(t,i){if(this.Bc())throw e.i.ga("empty geometry");i.kg(this.description),i.Bc()&&i.up();for(var r=0;r<this.description.Ba;r++)for(var s=this.description.Fd(r),n=0,o=e.ua.Wa(s);n<o;n++){var a=this.Pd(t,s,n);i.setAttribute(s,n,a)}},i.prototype.mD=function(t,i){if(this.wc(),i.Bc())throw e.i.ga("empty geometry");for(var r=i.description,s=0,n=r.Ba;s<n;s++)for(var o=r.Fd(s),a=e.ua.Wa(o),l=0;l<a;l++){var h=i.Vc(o,l);this.vn(t,o,l,h)}},i.prototype.Pd=function(t,r,s){if(this.Bc())throw e.i.ga("This operation was performed on an Empty Geometry.");if(0==r)return 0!=t?0!=s?this.ma:this.qa:0!=s?this.oa:this.sa;if(s>=e.ua.Wa(r))throw e.i.re();var n=this.description.Qf(r);return 0<=n?(null!=this.la&&this.Zx(this.description.Be.length-2),this.la[i.Ig(this.description,t)+this.description.$j(n)-2+s]):e.ua.te(r)},i.prototype.vn=function(t,r,s,n){if(this.wc(),s>=e.ua.Wa(r))throw e.i.re();var o=this.description.Qf(r);0>o&&(this.se(r),o=this.description.Qf(r)),0==r?0!=t?0!=s?this.ma=n:this.qa=n:0!=s?this.oa=n:this.sa=n:(null==this.la&&this.Zx(this.description.Be.length-2),this.la[i.Ig(this.description,t)+this.description.$j(o)-2+s]=n)},i.prototype.copyTo=function(t){if(t.K()!=this.K())throw e.i.O();t.description=this.description,t.Zx(this.description.Be.length-2),i.ZL(this.la,t.la,2*(this.description.Be.length-2)),t.sa=this.sa,t.oa=this.oa,t.qa=this.qa,t.ma=this.ma,t.wc(),this.pp(t)},i.prototype.Ug=function(t,i){var r=new e.Oc;return this.Bc()?(r.Pa(),r):(r.pa=this.Pd(0,t,i),r.wa=r.pa,r.Lk(this.Pd(1,t,i)),r)},i.prototype.RI=function(e){this.Bc()?e.Pa():(e.pa=this.Pd(0,0,0),e.wa=e.pa,e.Lk(this.Pd(1,0,0)))},i.prototype.Uw=function(t,i){i.kg(this.description),i.Db(this.ic(t));for(var r=1,s=this.description.Ba;r<s;r++)for(var n=this.description.Fd(r),o=e.ua.Wa(n),a=0;a<o;a++){var l=this.Vc(t,n,a);i.setAttribute(n,a,l)}},i.prototype.xM=function(e){if(this.description!=e.description||this.sa!=e.sa||this.qa!=e.qa||this.oa!=e.oa||this.ma!=e.ma)return!1;for(var t=0;t<2*(this.description.Be.length-2);t++)if(this.la[t]!=e.la[t])return!1;return!0},i.prototype.tG=function(){return this.sa==this.qa&&this.oa==this.ma},i.prototype.reverse=function(){var t=this.sa;this.sa=this.qa,this.qa=t,t=this.oa,this.oa=this.ma,this.ma=t,t=1;for(var i=this.description.Ba;t<i;t++)for(var r=this.description.qd(t),s=0,n=e.ua.Wa(r);s<n;s++){var o=this.Pd(0,r,s),a=this.Pd(1,r,s);this.vn(0,r,s,a),this.vn(1,r,s,o)}},i.prototype.Br=function(t,i,r){var s=t.K();switch(this.K()){case 322:if(322==s)return e.zb.GM(this,t,i,r);throw e.i.Ra();default:throw e.i.Ra()}},i.prototype.CM=function(t,i,r,s,n){var o=t.K();switch(this.K()){case 322:if(322==o)return e.zb.Xx(this,t,i,r,s,n);throw e.i.Ra();default:throw e.i.Ra()}},i.prototype.Rx=function(){return null},i.Ig=function(e,t){return t*(e.Be.length-2)},i.prototype.ic=function(t,i){if(void 0===i)return i=new e.h,this.ic(t,i),i;e.mc.bT(this.sa,this.oa,this.qa,this.ma,t,i)},i.prototype.fe=function(){return null},i.prototype.XF=function(){return null},i.prototype.fq=function(){return null},i.prototype.Ci=function(){return null},i.prototype.Qn=function(){return null},i.prototype.jg=function(){return null},i.prototype.Sx=function(e,t){return void 0!==t?this.tx(t)-this.tx(e):this.tx(e)},i.prototype.pp=function(){},i.prototype.el=function(){return null},i.prototype.bh=function(){},i.prototype.Vc=function(){return null},i.prototype.Me=function(){return null},i.prototype.tx=function(){return null},i.prototype.FG=function(){return null},i.prototype.ub=function(e,t){if(!t&&0!=this.Br(e,0,!1))return 0;t=17976931348623157e292;var i=this.ac(),r=e.fe(i,!1);return i.sub(e.ic(r)),(i=i.length())<t&&(t=i),i=this.xc(),r=e.fe(i,!1),i.sub(e.ic(r)),(i=i.length())<t&&(t=i),i=e.ac(),r=this.fe(i,!1),i.sub(this.ic(r)),(i=i.length())<t&&(t=i),i=e.xc(),r=this.fe(i,!1),i.sub(this.ic(r)),(i=i.length())<t&&(t=i),t},i.prototype.mg=function(){return e.ri.im(this,null)},i}(e.ba);e.KC=t}($||($={})),new $.h,function(e){var t,i;(t=e.SK||(e.SK={}))[t.Unknown=-1]="Unknown",t[t.Not=0]="Not",t[t.Weak=1]="Weak",t[t.Strong=2]="Strong",(i=e.EK||(e.EK={}))[i.DirtyIsKnownSimple=1]="DirtyIsKnownSimple",i[i.IsWeakSimple=2]="IsWeakSimple",i[i.IsStrongSimple=4]="IsStrongSimple",i[i.DirtyOGCFlags=8]="DirtyOGCFlags",i[i.DirtyVerifiedStreams=32]="DirtyVerifiedStreams",i[i.DirtyExactIntervals=64]="DirtyExactIntervals",i[i.DirtyLooseIntervals=128]="DirtyLooseIntervals",i[i.DirtyIntervals=192]="DirtyIntervals",i[i.DirtyIsEnvelope=256]="DirtyIsEnvelope",i[i.DirtyLength2D=512]="DirtyLength2D",i[i.DirtyRingAreas2D=1024]="DirtyRingAreas2D",i[i.DirtyCoordinates=1993]="DirtyCoordinates",i[i.DirtyAllInternal=65535]="DirtyAllInternal",i[i.DirtyAll=16777215]="DirtyAll";var r=function(t){function i(){var e=t.call(this)||this;return e.Jm=65535,e.xa=0,e.Qg=-1,e.Cb=null,e}return Z(i,t),i.prototype.pp=function(){},i.prototype.Yx=function(){},i.prototype.dy=function(){},i.prototype.I=function(){return this.xa},i.prototype.B=function(){return this.Bc()},i.prototype.Bc=function(){return 0==this.xa},i.prototype.ak=function(e){return 0!=(this.Jm&e)},i.prototype.Nf=function(e,t){this.Jm=t?this.Jm|e:this.Jm&~e},i.prototype.rc=function(){this.ak(32)&&this.UM()},i.prototype.ux=function(){if(this.Bc())throw e.i.ga("This operation was performed on an Empty Geometry.")},i.prototype.we=function(t,i){if(0>t||t>=this.xa)throw e.i.ga("index out of bounds");this.rc(),i.kg(this.description),i.B()&&i.up();for(var r=0;r<this.description.Ba;r++)for(var s=this.description.Fd(r),n=0,o=e.ua.Wa(s);n<o;n++){var a=this.Aa[r].Bg(o*t+n);i.setAttribute(s,n,a)}},i.prototype.Ht=function(t,i){this.rc();for(var r=i.description,s=0;s<r.Ba;s++)for(var n=r.Fd(s),o=e.ua.Wa(n),a=0;a<o;a++){var l=i.Vc(n,a);this.setAttribute(n,t,a,l)}},i.prototype.D=function(t,i){if(0>t||t>=this.I())throw e.i.re();this.rc(),this.Aa[0].uc(2*t,i)},i.prototype.Oa=function(t){var i=new e.h;return this.D(t,i),i},i.prototype.Hc=function(e,t){this.Aa[0].uc(2*e,t)},i.prototype.Db=function(t,i,r){if(0>t||t>=this.xa)throw e.i.re();this.rc();var s=this.Aa[0];void 0!==r?(s.write(2*t,i),s.write(2*t+1,r)):s.Ut(2*t,i),this.Qc(1993)},i.prototype.xz=function(){if(void 0>=this.I())throw e.i.re();this.rc();var t=this.Aa[0],i=new e.Od;return i.x=t.read(NaN),i.y=t.read(NaN),i.z=this.hasAttribute(1)?this.Aa[1].Bg(void 0):e.ua.te(1),i},i.prototype.XB=function(t){if(0>t||t>=this.I())throw e.i.re();this.se(1),this.rc(),this.Qc(1993);var i=this.Aa[0];i.write(2*t,(void 0).x),i.write(2*t+1,(void 0).y),this.Aa[1].rr(t,(void 0).z)},i.prototype.Vc=function(t,i,r){if(0>i||i>=this.xa)throw e.i.re();var s=e.ua.Wa(t);if(r>=s)throw e.i.re();this.rc();var n=this.description.Qf(t);return 0<=n?this.Aa[n].Bg(i*s+r):e.ua.te(t)},i.prototype.qF=function(e,t){return this.Vc(e,t,void 0)},i.prototype.setAttribute=function(t,i,r,s){if(0>i||i>=this.xa)throw e.i.re();var n=e.ua.Wa(t);if(r>=n)throw e.i.re();this.se(t),this.rc(),t=this.description.Qf(t),this.Qc(1993),this.Aa[t].rr(i*n+r,s)},i.prototype.vb=function(e){return this.ux(),this.se(e),this.rc(),this.Aa[this.description.Qf(e)]},i.prototype.kn=function(t,i){if(null!=i&&e.ua.Vp(t)!=i.Vp())throw e.i.O();this.se(t),t=this.description.Qf(t),null==this.Aa&&(this.Aa=e.Zc.iI(this.description.Ba)),this.Aa[t]=i,this.Qc(16777215)},i.prototype.un=function(t){var i=null;if(null!=this.Aa){var r=e.ee.Jw(t,this.description);i=[];for(var s=0,n=t.Ba;s<n;s++)-1!=r[s]&&(i[s]=this.Aa[r[s]])}this.description=t,this.Aa=i,this.Qg=-1,this.Qc(16777215)},i.prototype.sD=function(t){this.xu(!0),t instanceof e.l?this.aa.A(t):this.aa.Ro(t)},i.prototype.TM=function(t){this.xu(!1),t instanceof e.l?this.aa.A(t):this.aa.Ro(t)},i.prototype.dn=function(e){this.xu(!0),this.aa.copyTo(e)},i.prototype.A=function(e){this.sD(e)},i.prototype.Ro=function(e){this.sD(e)},i.prototype.yc=function(e){this.TM(e)},i.prototype.Ug=function(t,i){var r=new e.Oc;return this.Bc()?(r.Pa(),r):(this.xu(!0),this.aa.Ug(t,i))},i.prototype.dc=function(){var t=this.description.dc();if(!this.Bc())for(var i=this.I(),r=0,s=this.description.Ba;r<s;r++)t=this.Aa[r].Bn(t,0,i*e.ua.Wa(this.description.Fd(r)));return t},i.prototype.Nb=function(t){if(t==this)return!0;if(!(t instanceof i&&this.description.Nb(t.description))||this.Bc()!=t.Bc())return!1;if(this.Bc())return!0;var r=this.I();if(r!=t.I())return!1;for(var s=0;s<this.description.Ba;s++){var n=this.description.qd(s),o=this.vb(n),a=t.vb(n);if(!o.Nb(a,0,r*e.ua.Wa(n)))return!1}return!0},i.prototype.copyTo=function(t){if(t.K()!=this.K())throw e.i.O();this.WC(t)},i.prototype.WC=function(t){this.rc(),t.description=this.description,t.Aa=null;var i=this.description.Ba,r=null;if(null!=this.Aa){r=[];for(var s=0;s<i;s++)null!=this.Aa[s]&&(r[s]=this.Aa[s].AB(this.I()*e.ua.Wa(this.description.Fd(s))))}null!=this.aa?(t.aa=this.aa.Ja(),this.aa.copyTo(t.aa)):t.aa=null,t.xa=this.xa,t.Jm=this.Jm,t.Aa=r;try{this.pp(t)}catch(n){throw t.Pa(),e.i.gu()}},i.prototype.oD=function(){this.xa=0,this.Qg=-1,this.Aa=null,this.Qc(16777215)},i.prototype.Qc=function(e){16777215==e&&(this.Qg=-1,this.Yx()),this.Jm|=e,this.dM(),this.wc()},i.prototype.xu=function(t){if(this.rc(),this.ak(192))if(null==this.aa?this.aa=new e.Gh(this.description):this.aa.kg(this.description),this.B())this.aa.Pa();else{this.cy(t);for(var i=1;i<this.description.Ba;i++)for(var r=this.description.Fd(i),s=e.ua.Wa(r),n=this.Aa[i],o=0;o<s;o++){var a=new e.Oc;a.Pa();for(var l=0;l<this.xa;l++){var h=n.Bg(l*s+o);a.$b(h)}this.aa.setInterval(r,o,a)}t&&this.Nf(192,!1)}},i.prototype.cy=function(){this.aa.Pa();for(var t=this.Aa[0],i=new e.h,r=0;r<this.xa;r++)t.uc(2*r,i),this.aa.$b(i)},i.prototype.Ap=function(t){t.Pa();for(var i=this.Aa[0],r=new e.h,s=0;s<this.xa;s++)i.uc(2*s,r),t.$b(r)},i.prototype.UM=function(){if(this.Qg<this.xa){null==this.Aa&&(this.Aa=e.Zc.iI(this.description.Ba)),this.Qg=2147483647;for(var t=0;t<this.description.Ba;t++){var i=this.description.Fd(t);if(null!=this.Aa[t]){var r=e.ua.Wa(i),s=e.P.truncate(this.Aa[t].size/r);s<this.xa&&(s=e.P.truncate(this.Qg>this.xa+5?(5*this.xa+3)/4:this.xa),this.Aa[t].resize(s*r,e.ua.te(i))),s<this.Qg&&(this.Qg=s)}else this.Aa[t]=e.Zc.QE(i,this.xa),this.Qg=this.xa}}this.dy(),this.Nf(32,!1)},i.prototype.fm=function(t){if(0>t)throw e.i.O();t!=this.xa&&(this.xa=t,this.Qc(65535))},i.prototype.qm=function(e){if(!this.ak(1)){if(!this.ak(2))return 0;if(this.GT>=e)return this.ak(8)?1:2}return-1},i.prototype.Dh=function(t,i){if(this.GT=i,-1==t)this.Nf(1,!0),this.Nf(8,!0);else if(this.Nf(1,!1),this.Nf(8,!0),0==t)this.Nf(2,!1),this.Nf(4,!1);else if(1==t)this.Nf(2,!0),this.Nf(4,!1);else{if(2!=t)throw e.i.ga("internal error.");this.Nf(2,!0),this.Nf(4,!0)}},i.prototype.dM=function(){null!=this.Cb&&(this.Cb=null)},i.prototype.cD=function(t,i,r,s){if(0>t||t>=this.xa)throw e.i.ga("index out of bounds");if(0>i||i>=this.xa)throw e.i.ga("index out of bounds");this.rc(),s.kg(this.description),s.B()&&s.up();for(var n=0;n<this.description.Ba;n++)for(var o=this.description.Fd(n),a=0,l=e.ua.Wa(o);a<l;a++){var h=this.Aa[n].Bg(l*t+a),c=this.Aa[n].Bg(l*i+a);s.setAttribute(o,a,e.mc.jq(h,c,r))}},i.prototype.Ar=function(e,t){var i=this.Aa[0].o,r=i[2*e]-i[2*t];return e=i[2*e+1]-i[2*t+1],Math.sqrt(r*r+e*e)},i.prototype.Eh=function(t,i){if(0>t||t>=this.xa)throw e.i.re();if(i.B())throw e.i.O();this.rc();for(var r=i.description,s=0;s<r.Ba;s++)for(var n=r.qd(s),o=e.ua.Wa(n),a=0;a<o;a++){var l=i.Vc(n,a);this.setAttribute(n,t,a,l)}},i.prototype.mu=function(){return null},i.prototype.gj=function(){return null},i}(e.ba);e.Ex=r}($||($={})),function(e){var t=function(){function t(){this.ob=this.$n=null,this.Vm=124234251,this.Sv=!0,this.Ne=-1,this.ob=new e.ad(7),this.$n=null}return t.prototype.Wo=function(e){this.$n=e},t.prototype.JP=function(){this.Sv=!1},t.prototype.Ee=function(e){this.ob.Ee(e)},t.prototype.Qr=function(e){var t=this.ob.De();return this.fX(t),this.iX(e,t),t},t.prototype.EP=function(e){this.ob.kd(e)},t.prototype.addElement=function(e,t){return-1==t&&(-1==this.Ne&&(this.Ne=this.Qr(-1)),t=this.Ne),this.xD(e,0,t)},t.prototype.BD=function(e){return-1==this.Ne&&(this.Ne=this.Qr(-1)),this.xD(e,1,this.Ne)},t.prototype.yn=function(e){-1==this.Ne&&(this.Ne=this.Qr(-1));var t=this.Ne,i=this.ob.o;if(-1==t||-1==i[7*t])return e=this.ob.Nl([-1,-1,-1,e,this.il(),-1,-1]),(i=this.ob.o)[7*t]=e,this.xp(-1,e,t,i),e;var r=-1==t?-1:i[7*t+2];return e=this.ob.Nl([-1,-1,r,e,this.il(),-1,-1]),(i=this.ob.o)[7*r+1]=e,this.jy(e,i),-1===i[7*e+2]&&(i[7*t]=e),this.xp(-1,e,t,i),e},t.prototype.Au=function(t,i,r,s){var n=-1;-1==n&&(-1==this.Ne&&(this.Ne=this.Qr(-1)),n=this.Ne);var o=this.ob.o;if(-1==n||-1==o[7*n])return r=this.ob.Nl([-1,-1,-1,r,this.il(),-1,-1]),(o=this.ob.o)[7*n]=r,this.xp(-1,r,n,o),r;if(s){s=-1!=i?this.$n.compare(this,r,i):-1;var a=-1!=t?this.$n.compare(this,r,t):1}else s=-1,a=1;if(0==s||0==a)return o[7*n+3]=0==s?i:t,-1;for((-1!=i&&-1!=t?this.Vm>e.P.WA(this.Vm)>>1:-1!=i)?t=i:s=a,i=!0;;){if(0>s){if(-1==(a=o[7*t])){s=t,r=this.ob.Nl([-1,-1,t,r,this.il(),-1,-1]),(o=this.ob.o)[7*t]=r;break}t=a}else{if(-1==(a=o[7*t+1])){s=o[7*t+6],r=this.ob.Nl([-1,-1,t,r,this.il(),-1,-1]),(o=this.ob.o)[7*t+1]=r;break}t=a}i&&(s*=-1,i=!1)}return this.jy(r,o),-1===o[7*r+2]&&(o[7*n]=r),this.xp(s,r,n,o),r},t.prototype.xF=function(){return this.aR(this.Ne)},t.prototype.wd=function(e,t){t=-1==t?this.Ne:t,this.Sv?this.DP(e,t):this.XX(e,t)},t.prototype.search=function(e,t){for(t=this.tv(t);-1!=t;){var i=this.$n.compare(this,e,t);if(0==i)return t;t=0>i?this.nl(t):this.Zp(t)}return-1},t.prototype.xW=function(e){for(var t=this.tv(-1),i=-1;-1!=t;){var r=e.compare(this,t);if(0==r)return t;0>r?t=this.nl(t):(i=t,t=this.Zp(t))}return i},t.prototype.mJ=function(e){for(var t=this.tv(-1),i=-1;-1!=t;){var r=e.compare(this,t);if(0==r)return t;0>r?(i=t,t=this.nl(t)):t=this.Zp(t)}return i},t.prototype.ka=function(e){return this.ob.U(e,3)},t.prototype.nl=function(e){return this.ob.U(e,0)},t.prototype.Zp=function(e){return this.ob.U(e,1)},t.prototype.getParent=function(e){return this.ob.U(e,2)},t.prototype.lb=function(e){return this.ob.U(e,6)},t.prototype.xe=function(e){return this.ob.U(e,5)},t.prototype.sc=function(e){return-1==e?this.ml(this.Ne):this.ml(e)},t.prototype.Gc=function(e){return-1==e?this.$r(this.Ne):this.$r(e)},t.prototype.QR=function(e){return-1==e?this.UF(this.Ne):this.UF(e)},t.prototype.Tj=function(e,t){this.HB(e,t)},t.prototype.tv=function(e){return-1==e?this.QF(this.Ne):this.QF(e)},t.prototype.clear=function(){this.ob.nj(!1),this.Ne=-1},t.prototype.size=function(e){return-1==e?this.SF(this.Ne):this.SF(e)},t.prototype.CN=function(e,t){for(var i=t[7*e],r=t[7*e+1],s=t[7*e+4];-1!=i||-1!=r;){var n=-1!=i?t[7*i+4]:2147483647;if(r=-1!=r?t[7*r+4]:2147483647,s<=Math.min(n,r))break;n<=r?this.kJ(i,t):this.jJ(e,t),i=t[7*e],r=t[7*e+1]}},t.prototype.jy=function(e,t){if(this.Sv)for(var i=t[7*e+4],r=t[7*e+2];-1!=r&&t[7*r+4]>i;)t[7*r]==e?this.kJ(e,t):this.jJ(r,t),r=t[7*e+2]},t.prototype.jJ=function(e,t){var i=t[7*e+1];t[7*i+2]=t[7*e+2],t[7*e+2]=i;var r=t[7*i];t[7*e+1]=r,-1!=r&&(t[7*r+2]=e),t[7*i]=e,-1!=(r=t[7*i+2])&&(t[7*r]==e?t[7*r]=i:t[7*r+1]=i)},t.prototype.kJ=function(e,t){var i=t[7*e+2];t[7*e+2]=t[7*i+2],t[7*i+2]=e;var r=t[7*e+1];t[7*i]=r,-1!=r&&(t[7*r+2]=i),t[7*e+1]=i,-1!=(r=t[7*e+2])&&(t[7*r]===i?t[7*r]=e:t[7*r+1]=e)},t.prototype.Pk=function(e,t){this.ob.T(e,2,t)},t.prototype.MB=function(e,t){this.ob.T(e,0,t)},t.prototype.QB=function(e,t){this.ob.T(e,1,t)},t.prototype.PB=function(e,t){this.ob.T(e,5,t)},t.prototype.ex=function(e,t){this.ob.T(e,6,t)},t.prototype.PJ=function(e,t){this.ob.T(t,0,e)},t.prototype.fX=function(e){this.ob.T(e,4,0)},t.prototype.iX=function(e,t){this.ob.T(t,5,e)},t.prototype.QF=function(e){return-1==e?-1:this.ob.U(e,0)},t.prototype.ml=function(e){return-1==e?-1:this.ob.U(e,1)},t.prototype.$r=function(e){return-1==e?-1:this.ob.U(e,2)},t.prototype.aR=function(e){return-1==e?-1:this.ob.U(e,3)},t.prototype.SF=function(e){return-1==e?0:this.ob.U(e,4)},t.prototype.UF=function(e){return this.ob.U(e,5)},t.prototype.Qw=function(){return this.ob.Nl([-1,-1,-1,void 0,this.il(),-1,-1])},t.prototype.hl=function(e){-1!=e&&this.ob.kd(e)},t.prototype.il=function(){return this.Vm=e.P.WA(this.Vm),1073741823&this.Vm},t.prototype.xD=function(e,t,i){var r=this.ob.o;if(-1==i||-1==r[7*i])return e=this.ob.Nl([-1,-1,-1,e,this.il(),-1,-1]),(r=this.ob.o)[7*i]=e,this.xp(-1,e,i,r),e;for(var s=-1==i?-1:r[7*i];;){var n=-1==t?1:this.$n.compare(this,e,s);if(0>n){if(-1==(n=this.nl(s))){t=s,e=this.ob.Nl([-1,-1,s,e,this.il(),-1,-1]),(r=this.ob.o)[7*s]=e;break}s=n}else{if(1==t&&0==n)return r[7*i+3]=s,-1;if(-1==(n=r[7*s+1])){t=r[7*s+6],e=this.ob.Nl([-1,-1,s,e,this.il(),-1,-1]),(r=this.ob.o)[7*s+1]=e;break}s=n}}return this.jy(e,r),-1===r[7*e+2]&&(r[7*i]=e),this.xp(t,e,i,r),e},t.prototype.xp=function(e,t,i,r){if(-1!=e){var s=r[7*e+5];r[7*e+5]=t}else s=-1==i?-1:r[7*i+2];r[7*t+5]=s,-1!=s&&(r[7*s+6]=t),r[7*t+6]=e,e==(-1==i?-1:r[7*i+1])&&(r[7*i+1]=t),-1==e&&(r[7*i+2]=t),r[7*i+4]=(-1==i?0:r[7*i+4])+1},t.prototype.uB=function(e,t){var i=this.ob.o,r=i[7*e+5];e=i[7*e+6],-1!=r?i[7*r+6]=e:i[7*t+1]=e,-1!=e?i[7*e+5]=r:i[7*t+2]=r,i[7*t+4]=-1===t?-1:i[7*t+4]-1},t.prototype.XX=function(t,i){this.uB(t,i);var r=this.nl(t),s=this.Zp(t),n=this.getParent(t),o=t;if(-1!=r&&-1!=s){this.Vm=e.P.WA(this.Vm);var a=1073741823<this.Vm?this.lb(t):this.xe(t),l=this.getParent(a)==t;this.ob.$B(t,a,0),this.ob.$B(t,a,1),this.ob.$B(t,a,2),-1!=n?this.nl(n)==t?this.MB(n,a):this.QB(n,a):this.PJ(a,i),l?(r==a?(this.MB(a,t),this.Pk(s,a)):s==a&&(this.QB(a,t),this.Pk(r,a)),this.Pk(t,a),n=a):(this.Pk(r,a),this.Pk(s,a),n=this.getParent(t),o=a),r=this.nl(t),s=this.Zp(t),-1!=r&&this.Pk(r,t),-1!=s&&this.Pk(s,t)}r=-1!=r?r:s,-1==n?this.PJ(r,i):this.nl(n)==o?this.MB(n,r):this.QB(n,r),-1!=r&&this.Pk(r,n),this.hl(t)},t.prototype.DP=function(e,t){var i=this.ob.o;i[7*e+4]=2147483647;var r=-1,s=-1,n=-1===t?-1:i[7*t],o=n==e;if(o&&(r=i[7*n],s=i[7*n+1],-1==r&&-1==s))return this.uB(n,t),this.hl(n),void(i[7*t]=-1);this.CN(e,i),-1!=(n=i[7*e+2])&&(i[7*n]==e?i[7*n]=-1:i[7*n+1]=-1),this.uB(e,t),this.hl(e),o&&(i[7*t]=-1==r||-1!=i[7*r+2]?s:r)},t.prototype.HB=function(e,t){this.ob.T(e,3,t)},t}();e.Yj=t}($||($={})),function(e){var t=function(){function t(e,t){void 0!==e&&this.L(e,t)}return t.prototype.L=function(e,t){this.pa=e,this.wa=t,this.normalize()},t.prototype.isIntersecting=function(e){return this.pa<=e.pa?this.wa>=e.pa:e.wa>=this.pa},t.prototype.move=function(e){this.B()||(this.pa+=e,this.wa+=e)},t.prototype.normalize=function(){if(!isNaN(this.pa)){if(this.pa>this.wa){var e=this.pa;this.pa=this.wa,this.wa=e}isNaN(this.wa)&&this.Pa()}},t.prototype.Pa=function(){this.wa=this.pa=NaN},t.prototype.B=function(){return isNaN(this.pa)},t.prototype.$b=function(e){"number"==typeof e?this.B()?this.wa=this.pa=e:this.Lk(e):e.B()||(this.B()?(this.pa=e.pa,this.wa=e.wa):(this.pa>e.pa&&(this.pa=e.pa),this.wa<e.wa&&(this.wa=e.wa),this.pa>this.wa&&this.Pa()))},t.prototype.Lk=function(e){e<this.pa?this.pa=e:e>this.wa&&(this.wa=e)},t.prototype.contains=function(e){return"number"==typeof e?e>=this.pa&&e<=this.wa:e.pa>=this.pa&&e.wa<=this.wa},t.prototype.Fa=function(e){this.B()||e.B()?this.Pa():(this.pa<e.pa&&(this.pa=e.pa),this.wa>e.wa&&(this.wa=e.wa),this.pa>this.wa&&this.Pa())},t.prototype.X=function(e){this.B()||(this.pa-=e,this.wa+=e,this.wa<this.pa&&this.Pa())},t.prototype.zr=function(){return this.B()?2220446049250313e-29:2220446049250313e-29*(Math.abs(this.pa)+Math.abs(this.wa)+1)},t.prototype.EB=function(e,t){e>t?(this.pa=t,this.wa=e):(this.pa=e,this.wa=t)},t.prototype.Jt=function(t){return e.P.Rk(t,this.pa,this.wa)},t.prototype.S=function(){return this.wa-this.pa},t.prototype.tf=function(){return.5*(this.pa+this.wa)},t.prototype.Nb=function(e){return e==this||e instanceof t&&(!(!this.B()||!e.B())||this.pa==e.pa&&this.wa==e.wa)},t.prototype.dc=function(){return e.P.vj(e.P.vj())},t}();e.Oc=t}($||($={})),function(e){var t=new e.Oc,i=new e.Oc,r=function(){this.ne=null,this.pb=-1,this.tb=new e.zb,this.kA=55555555,this.Uv=this.Wv=!1,this.Vf=new e.Oc,this.Vf.EB(0,0)};e.xY=r;var s=function(){function s(t,i,s){this.g=t,this.Hk=NaN,this.FH=this.Mq=0,this.GH=NaN,this.ra=i,this.Pq=10*i,this.HH=this.IH=NaN,this.rg=!1,this.Fm=this.gt=this.Mo=this.Ys=this.Xs=-1,this.bA=s,this.NA=new r,this.QH=new r,e.P.truncate(3*t.gd/2)}return s.prototype.eG=function(e,t,i,r){e.ne=null===r?null:r[i[5*t]],e.Uv=null!=e.ne,e.Uv||(-1!==(r=i[5*t+2])&&this.g.cW(i[5*t],i[5*r],e.tb),e.ne=e.tb,e.Vf.EB(e.tb.sa,e.tb.qa),e.Vf.wa+=this.ra,e.tb.jI(),e.Wv=e.tb.ma==e.tb.oa,e.Wv||(e.kA=(e.tb.qa-e.tb.sa)/(e.tb.ma-e.tb.oa)))},s.prototype.GO=function(e,t){var i=e.Br(t,this.ra,!0);return 0!=i?2==i?this.Ly():this.yi():(e.$p(ee),e.Ur(te),t.$p(ie),t.Ur(re),Q.na(this.Mq,this.Hk),ee.rb(ie)&&this.Hk==ee.y?0>te.compare(re)?Q.N(te):Q.N(re):ee.rb(re)&&this.Hk==ee.y?0>te.compare(ie)?Q.N(te):Q.N(ie):ie.rb(te)&&this.Hk==ie.y?0>ee.compare(re)?Q.N(ee):Q.N(re):te.rb(re)&&this.Hk==te.y&&(0>ee.compare(ie)?Q.N(ee):Q.N(ie)),e.Me(Q.y,Q.x)<t.Me(Q.y,Q.x)?-1:1)},s.prototype.EO=function(e,t){if(e.tb.oa==t.tb.oa&&e.tb.sa==t.tb.sa)return e.tb.ma==t.tb.ma&&e.tb.qa==t.tb.qa?this.bA?this.Ly():0:this.HE(e,t);if(e.tb.ma==t.tb.ma&&e.tb.qa==t.tb.qa)return this.GE(e,t);var i=this.GE(e,t);return e=this.HE(e,t),0>i&&0>e?-1:0<i&&0<e?1:this.yi()},s.prototype.AO=function(e,t){if(e.qa>t.qa){if(t.qa>t.sa&&t.ma-t.oa<2*this.ra&&e.wi(t.qa,t.ma,this.ra))return this.yi()}else if((t.ma-t.oa)/(t.qa-t.sa)*(e.qa-e.sa)<this.Pq&&t.wi(e.qa,e.ma,this.ra))return this.yi();return 1},s.prototype.BO=function(e,t){if(e.sa<t.sa){if(t.qa>t.sa&&t.ma-t.oa<2*this.ra&&e.wi(t.qa,t.ma,this.ra))return this.yi()}else if((t.ma-t.oa)/(t.qa-t.sa)*(e.sa-e.qa)<this.Pq&&t.wi(e.sa,e.oa,this.ra))return this.yi();return-1},s.prototype.CO=function(t,i){var r=new e.h;r.vc(i.xc(),i.ac()),r.cr(),r.normalize();var s=new e.h;s.vc(t.ac(),i.ac());var n=new e.h;n.vc(t.xc(),i.ac()),s=s.Rh(r),r=n.Rh(r),n=Math.abs(s);var o=Math.abs(r);if(n<o){if(n<this.Pq&&i.wi(t.sa,t.oa,this.ra))return this.yi()}else if(o<this.Pq&&i.wi(t.qa,t.ma,this.ra))return this.yi();return 0>s&&0>r?-1:0<s&&0<r?1:this.yi()},s.prototype.FE=function(e,t){return e.oa==t.oa&&e.sa==t.sa?this.AO(e,t):e.ma==t.ma&&e.qa==t.qa?this.BO(e,t):this.CO(e,t)},s.prototype.DO=function(e,t){return e.ma==t.ma&&e.qa==t.qa&&e.oa==t.oa&&e.sa==t.sa?this.bA?this.Ly():0:this.yi()},s.prototype.GE=function(e,t){var i=1;if(e.tb.oa<t.tb.oa){i=-1;var r=e;e=t,t=r}e=e.tb,r=t.tb;var s=e.sa-r.sa;t=t.kA*(e.oa-r.oa);var n=this.Pq;return s<t-n?-i:s>t+n?i:r.wi(e.sa,e.oa,this.ra)?this.yi():s<t?-i:i},s.prototype.HE=function(e,t){var i=1;if(t.tb.ma<e.tb.ma){i=-1;var r=e;e=t,t=r}e=e.tb,r=t.tb;var s=e.qa-r.sa;t=t.kA*(e.ma-r.oa);var n=this.Pq;return s<t-n?-i:s>t+n?i:r.wi(e.qa,e.ma,this.ra)?this.yi():s<t?-i:i},s.prototype.Ly=function(){return this.rg=!0,this.Oi=new e.Nd(5,this.Mo,this.gt),-1},s.prototype.yi=function(){return this.rg=!0,this.bA?this.Oi=new e.Nd(4,this.Mo,this.gt):this.gt=this.Mo=this.Ys=this.Xs=-1,-1},s.prototype.FO=function(e,r,s,n){if(this.rg)return-1;var o=this.GH==this.Hk&&this.FH==this.Mq;if(o&&e==this.Xs)var a=this.HH;else a=NaN,this.Xs=-1;return o&&r==this.Ys?o=this.IH:(o=NaN,this.Ys=-1),s.ne.RI(t),n.ne.RI(i),t.wa<i.pa?-1:i.wa<t.pa?1:(this.GH=this.Hk,this.FH=this.Mq,isNaN(a)&&(this.Xs=e,this.HH=a=e=s.ne.Me(this.Hk,this.Mq)),isNaN(o)&&(this.Ys=r,this.IH=o=e=n.ne.Me(this.Hk,this.Mq)),Math.abs(a-o)<=this.ra?this.GO(s.ne,n.ne):a<o?-1:a>o?1:0)},s.prototype.Lr=function(){this.rg=!1},s.prototype.tm=function(){return this.Oi},s.prototype.SJ=function(e,t){this.Hk=e,this.Mq=t,this.gt=this.Mo=this.Ys=this.Xs=-1},s.prototype.compare=function(e,t,i){return this.rg?-1:(e=e.ka(i),this.Fm=i,this.JE(t,t,e,e))},s.prototype.JE=function(e,t,i,r){if(this.Mo==t)var s=this.NA;else this.Mo=t,s=this.NA,this.NA.pb=e,this.eG(s,t,this.g.ud.o,this.g.Te);if(null==n){this.gt=r;var n=this.QH;this.QH.pb=i,this.eG(n,r,this.g.ud.o,this.g.Te)}return s.Uv||n.Uv?this.FO(t,r,s,n):s.Vf.wa<n.Vf.pa?-1:n.Vf.wa<s.Vf.pa?1:(e=s.Wv?1:0,0==(e|=n.Wv?2:0)?this.EO(s,n):1==e?this.FE(s.tb,n.tb):2==e?-1*this.FE(n.tb,s.tb):this.DO(s.tb,n.tb))},s}();e.MC=s}($||($={})),function(e){var t=function(){function t(t,i){this.g=t,this.ra=i,this.rg=!1,this.Mo=-1,this.Vf=new e.Oc,this.Iq=new e.h,this.Iq.Sc(),this.ie=new e.zb,this.Fm=-1,this.vA=17976931348623157e292}return t.prototype.Lr=function(){this.rg=!1,this.vA=17976931348623157e292},t.prototype.Eh=function(e){this.Iq.N(e)},t.prototype.compare=function(e,t){return this.KE(t,e.ka(t))},t.prototype.KE=function(t,i){var r=null!=this.g.cc(i);if(r||(this.g.fd(i,this.ie),this.Vf.EB(this.ie.sa,this.ie.qa)),r)throw e.i.ga("not implemented");if(this.Iq.x+this.ra<this.Vf.pa)return-1;if(this.Iq.x-this.ra>this.Vf.wa)return 1;if(this.ie.oa==this.ie.ma)return this.Fm=t,this.rg=!0,0;this.ie.jI(),r=this.ie.ac(),(i=new e.h).vc(this.ie.xc(),r),i.cr();var s=new e.h;return s.vc(this.Iq,r),r=i.Rh(s),(r/=i.length())<10*-this.ra?-1:r>10*this.ra?1:this.ie.rs(this.Iq,this.ra)&&((i=Math.abs(r))<this.vA&&(this.Fm=t,this.vA=i),this.rg=!0,i<.25*this.ra)?0:0>r?-1:1},t}();e.TL=t}($||($={})),function(e){function t(e,t,i,r){i=new Float64Array(e.subarray(i,r)),e.set(i,t)}var i=function(){function i(e){this.Pb=this.pk=!1,this.o=null;var t=e;2>t&&(t=2),this.o=new Float64Array(t),this.size=e}return i.prototype.rotate=function(t,i,r){if(this.Pb)throw e.i.ga("invalid_call");if(i<t||i>r||t>r)throw e.i.O();t!=i&&r!=i&&(this.oi(t,i-t,1),this.oi(i,r-i,1),this.oi(t,r-t,1))},i.rf=function(e,t){var r=new i(e),s=r.o;if(2>e&&(e=2),0!==t)for(var n=0;n<e;n++)s[n]=t;return r},i.Cn=function(e){var t=new i(0);return t.o=new Float64Array(e.o),t.size=e.size,t},i.Mr=function(e,t){var r=new i(0);return r.size=e.size,r.size>t&&(r.size=t),2>(t=r.size)&&(t=2),r.o=new Float64Array(t),r.o.set(e.o.length<=t?e.o:e.o.subarray(0,t),0),r},i.prototype.Jb=function(e){0>=e||(null==this.o?this.o=new Float64Array(e):e<=this.o.length||(0<this.o.length?((e=new Float64Array(e)).set(this.o),this.o=e):this.o=new Float64Array(e)))},i.prototype.read=function(e){return this.o[e]},i.prototype.uc=function(e,t){t.x=this.o[e],t.y=this.o[e+1]},i.prototype.get=function(e){return this.o[e]},i.prototype.write=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i},i.prototype.set=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i},i.prototype.Ut=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i.x,this.o[t+1]=i.y},i.prototype.add=function(e){this.resize(this.size+1),this.o[this.size-1]=e},i.prototype.AB=function(e){return i.Mr(this,e)},i.prototype.Bg=function(e){return this.read(e)},i.prototype.resize=function(t,i){if(void 0===i&&(i=0),this.pk)throw e.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");if(t<=this.size){if(30<this.o.length&&5*t/4<this.o.length){var r=new Float64Array(this.o,0,t);this.o=r}}else{t>this.o.length&&(r=e.P.truncate(64>t?Math.max(2*t,4):5*t/4),(r=new Float64Array(r)).set(this.o),this.o=r),r=this.o;for(var s=this.size;s<t;s++)r[s]=i}this.size=t},i.prototype.Ch=function(t){if((null==this.o||t>this.o.length)&&this.resize(t),this.pk)throw e.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");this.size=t},i.prototype.rr=function(e,t){this.write(e,t)},i.prototype.Bn=function(t,i,r){for(var s=this.size;i<s&&i<r;i++)t=e.P.vj(this.read(i));return t},i.prototype.Nb=function(e,t,r){if(null==e||!(e instanceof i))return!1;var s=this.size,n=e.size;if(r>s||r>n&&s!=n)return!1;for(r>s&&(r=s);t<r;t++)if(this.read(t)!=e.read(t))return!1;return!0},i.prototype.addRange=function(t,i,r,s,n){if(this.Pb)throw e.i.Hb();if(!s&&(1>n||r%n!=0))throw e.i.O();var o=this.size;if(this.resize(o+r),s)this.o.set(t.o.subarray(i,i+r),o);else{s=r;for(var a=0;a<r;a+=n){s-=n;for(var l=0;l<n;l++)this.o[o+a+l]=t.o[i+s+l]}}},i.prototype.Nn=function(i,r,s,n,o,a,l){if(this.Pb)throw e.i.Hb();if(!o&&(1>a||n%a!=0))throw e.i.O();var h=this.size-l;if(h<n&&this.resize(this.size+n-h),t(this.o,i+n,i,i+(l-i)),this.o==r.o&&i<s&&(s+=n),o)this.o.set(r.o.subarray(s,s+n),i);else for(o=n,l=0;l<n;l+=a)for(o-=a,h=0;h<a;h++)this.o[i+l+h]=r.o[s+o+h]},i.prototype.Dz=function(i,r,s,n,o,a){if(this.Pb)throw e.i.Hb();if(0>a&&(a=this.size),this.size+2*n>this.o.length?this.resize(this.size+2*n):this.size+=2*n,t(this.o,i+2*n,i,i+(a-i)),o)for(o=0;o<n;o++)a=r[s++],this.o[i++]=a.x,this.o[i++]=a.y;else{o=0;for(var l=n-1;o<n;++o)a=r[s+l],this.o[i++]=a.x,this.o[i++]=a.y,l--}},i.prototype.Mn=function(i,r,s,n){if(this.Pb)throw e.i.Hb();for(n-=i,t(this.o,i+n,i,i+n),n=0;n<s;n++)this.o[i+n]=r},i.prototype.wj=function(i,r,s){if(this.Pb)throw e.i.Hb();t(this.o,i+2,i,i+(s-i)),this.o[i]=r.x,this.o[i+1]=r.y},i.prototype.Vt=function(t,i,r,s,n,o){if(0>t||0>i||0>s)throw e.i.O();if(!n&&(0>=o||i%o!=0))throw e.i.O();if(r.size<s+i)throw e.i.O();if(0!=i)if(this.size<i+t&&this.resize(i+t),r==this)this.Cr(t,i,s,n,o);else if(n)for(n=0;n<i;n++)this.o[t]=r.o[s],t++,s++;else if(s=s+i-o,1==o)for(n=0;n<i;n++)this.o[t]=r.o[s],t++,s--;else for(n=0,i=e.P.truncate(i/o);n<i;n++){for(var a=0;a<o;a++)this.o[t+a]=r.o[s+a];t+=o,s-=o}},i.prototype.Fn=function(i,r,s){if(this.Pb)throw e.i.Hb();if(i+r>this.size)throw e.i.Hb();0<s-(i+r)&&t(this.o,i,i+r,i+(s-(i+r))+r),this.size-=r},i.prototype.oi=function(t,i,r){if(this.Pb)throw e.i.Hb();if(1>r||i%r!=0)throw e.i.Hb();for(var s=i>>1,n=0;n<s;n+=r){i-=r;for(var o=0;o<r;o++){var a=this.o[t+n+o];this.o[t+n+o]=this.o[t+i+o],this.o[t+i+o]=a}}},i.prototype.Xj=function(t,i,r){if(0>i||0>r||0>i||r+i>this.size)throw e.i.O();for(var s=i;s<i+r;s++)this.o[s]=t},i.prototype.Cr=function(t,i,r,s,n){if(!(s&&t==r||(this.o.set(this.o.subarray(r,r+i),t),s)))for(r=t,t=t+i-n,s=0,i=e.P.truncate(i/2);s<i;s++){for(var o=0;o<n;o++){var a=this.o[r+o];this.o[r+o]=this.o[t+o],this.o[t+o]=a}r+=n,t-=n}},i.prototype.oC=function(t,i,r,s,n){if(0>t||0>i||0>s)throw e.i.O();if(0!=i)for(this.size<(i<<1)+t&&this.resize((i<<1)+t),n||(t+=i-1<<1),n=n?2:-2,i+=s;s<i;s++)this.o[t]=r[s].x,this.o[t+1]=r[s].y,t+=n},i.prototype.nC=function(t,i,r){if(0>t||0>i)throw e.i.O();if(0!=i){this.size<(i<<1)+t&&this.resize((i<<1)+t),i+=0;for(var s=0;s<i;s++)this.o[t]=r[s][0],this.o[t+1]=r[s][1],t+=2}},i.prototype.Ww=function(t,i,r,s,n){if(0>t||0>i||0>s||this.size<i+t)throw e.i.O();if(n)for(n=0;n<i;n++)r[s+n]=this.o[t+n];else for(s=s+i-1;t<i;t++)r[s]=this.o[t],s--},i.prototype.oB=function(t,i,r){if(0>t||0>i||this.size<(i>>1)+t)throw e.i.O();if(0!=i){i=0+i;for(var s=0;s<i;s++)r[s][0]=this.o[t],r[s][1]=this.o[t+1],t+=2}},i.prototype.clear=function(e){e?this.resize(0):this.Ch(0)},i.prototype.hx=function(){this.pk=this.Pb=!0},i.prototype.Wd=function(e,t,i){Array.prototype.sort.call(this.o.subarray(e,t),i)},i.prototype.Vp=function(){return 1},i}();e.ce=i}($||($={})),function(e){function t(e,t,i,r){i=new Int32Array(e.subarray(i,r)),e.set(i,t)}e.fY=function(){this.random=1973};var i=function(){function i(e){this.Pb=this.pk=!1,this.o=null;var t=e;2>t&&(t=2),this.o=new Int32Array(t),this.size=e}return i.prototype.rotate=function(t,i,r){if(this.Pb)throw e.i.ga("invalid_call");if(i<t||i>r||t>r)throw e.i.O();t!=i&&r!=i&&(this.oi(t,i-t,1),this.oi(i,r-i,1),this.oi(t,r-t,1))},i.rf=function(e,t){var r=new i(e),s=r.o;if(2>e&&(e=2),0!==t)for(var n=0;n<e;n++)s[n]=t;return r},i.Cn=function(e){var t=new i(0);return t.o=new Int32Array(e.o),t.size=e.size,t},i.Mr=function(e,t){var r=new i(0);return r.size=e.size,r.size>t&&(r.size=t),2>(t=r.size)&&(t=2),r.o=new Int32Array(t),r.o.set(e.o.length<=t?e.o:e.o.subarray(0,t),0),r},i.prototype.Jb=function(e){0>=e||(null==this.o?this.o=new Int32Array(e):e<=this.o.length||(0<this.o.length?((e=new Int32Array(e)).set(this.o),this.o=e):this.o=new Int32Array(e)))},i.prototype.read=function(e){return this.o[e]},i.prototype.uc=function(e,t){t.x=this.o[e],t.y=this.o[e+1]},i.prototype.get=function(e){return this.o[e]},i.prototype.write=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i},i.prototype.set=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i},i.prototype.Ut=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i.x,this.o[t+1]=i.y},i.prototype.add=function(e){this.resize(this.size+1),this.o[this.size-1]=e},i.prototype.AB=function(e){return i.Mr(this,e)},i.prototype.Bg=function(e){return this.read(e)},i.prototype.resize=function(t,i){if(void 0===i&&(i=0),this.pk)throw e.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");if(t<=this.size){if(30<this.o.length&&5*t/4<this.o.length){var r=new Int32Array(this.o,0,t);this.o=r}}else{t>this.o.length&&(r=e.P.truncate(64>t?Math.max(2*t,4):5*t/4),(r=new Int32Array(r)).set(this.o),this.o=r),r=this.o;for(var s=this.size;s<t;s++)r[s]=i}this.size=t},i.prototype.Ch=function(t){if((null==this.o||t>this.o.length)&&this.resize(t),this.pk)throw e.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");this.size=t},i.prototype.rr=function(e,t){this.write(e,t)},i.prototype.Bn=function(t,i,r){for(var s=this.size;i<s&&i<r;i++)t=e.P.Uh(this.read(i),t);return t},i.prototype.Nb=function(e,t,r){if(null==e||!(e instanceof i))return!1;var s=this.size,n=e.size;if(r>s||r>n&&s!=n)return!1;for(r>s&&(r=s);t<r;t++)if(this.read(t)!=e.read(t))return!1;return!0},i.prototype.addRange=function(t,i,r,s,n){if(this.Pb)throw e.i.Hb();if(!s&&(1>n||r%n!=0))throw e.i.O();var o=this.size;if(this.resize(o+r),s)this.o.set(t.o.subarray(i,i+r),o);else{s=r;for(var a=0;a<r;a+=n){s-=n;for(var l=0;l<n;l++)this.o[o+a+l]=t.o[i+s+l]}}},i.prototype.Nn=function(i,r,s,n,o,a,l){if(this.Pb)throw e.i.Hb();if(!o&&(1>a||n%a!=0))throw e.i.O();if(t(this.o,i+n,i,i+(l-i)),this.o==r.o&&i<s&&(s+=n),o)this.o.set(r.o.subarray(s,s+n),i);else for(o=n,l=0;l<n;l+=a){o-=a;for(var h=0;h<a;h++)this.o[i+l+h]=r.o[s+o+h]}},i.prototype.Dz=function(i,r,s,n,o,a){if(this.Pb)throw e.i.Hb();if(0>a&&(a=this.size),this.size+2*n>this.o.length?this.resize(this.size+2*n):this.size+=2*n,t(this.o,i+2*n,i,i+(a-i)),o)for(o=0;o<n;o++)a=r[s++],this.o[i++]=a.x,this.o[i++]=a.y;else{o=0;for(var l=n-1;o<n;++o)a=r[s+l],this.o[i++]=a.x,this.o[i++]=a.y,l--}},i.prototype.Mn=function(i,r,s,n){if(this.Pb)throw e.i.Hb();for(n-=i,t(this.o,i+n,i,i+n),n=0;n<s;n++)this.o[i+n]=r},i.prototype.wj=function(i,r,s){if(this.Pb)throw e.i.Hb();t(this.o,i+2,i,i+(s-i)),this.o[i]=r.x,this.o[i+1]=r.y},i.prototype.Vt=function(t,i,r,s,n,o){if(0>t||0>i||0>s)throw e.i.O();if(!n&&(0>=o||i%o!=0))throw e.i.O();if(r.size<s+i)throw e.i.O();if(0!=i)if(this.size<i+t&&this.resize(i+t),r==this)this.Cr(t,i,s,n,o);else if(n)for(n=0;n<i;n++)this.o[t]=r.o[s],t++,s++;else if(s=s+i-o,1==o)for(n=0;n<i;n++)this.o[t]=r.o[s],t++,s--;else for(n=0,i=e.P.truncate(i/o);n<i;n++){for(var a=0;a<o;a++)this.o[t+a]=r.o[s+a];t+=o,s-=o}},i.prototype.Fn=function(i,r,s){if(this.Pb)throw e.i.Hb();if(i+r>this.size)throw e.i.Hb();0<s-(i+r)&&t(this.o,i,i+r,i+(s-(i+r))+r),this.size-=r},i.prototype.oi=function(t,i,r){if(this.Pb)throw e.i.Hb();if(1>r||i%r!=0)throw e.i.Hb();for(var s=i>>1,n=0;n<s;n+=r){i-=r;for(var o=0;o<r;o++){var a=this.o[t+n+o];this.o[t+n+o]=this.o[t+i+o],this.o[t+i+o]=a}}},i.prototype.Xj=function(t,i,r){if(0>i||0>r||0>i||r+i>this.size)throw e.i.O();for(var s=i;s<i+r;s++)this.o[s]=t},i.prototype.Cr=function(t,i,r,s,n){if(!(s&&t==r||(this.o.set(this.o.subarray(r,r+i),t),s)))for(r=t,t=t+i-n,s=0,i=e.P.truncate(i/2);s<i;s++){for(var o=0;o<n;o++){var a=this.o[r+o];this.o[r+o]=this.o[t+o],this.o[t+o]=a}r+=n,t-=n}},i.prototype.oC=function(t,i,r,s,n){if(0>t||0>i||0>s)throw e.i.O();if(0!=i)for(this.size<(i<<1)+t&&this.resize((i<<1)+t),n||(t+=i-1<<1),n=n?2:-2,i+=s;s<i;s++)this.o[t]=r[s].x,this.o[t+1]=r[s].y,t+=n},i.prototype.Ww=function(t,i,r,s,n){if(0>t||0>i||0>s||this.size<i+t)throw e.i.O();if(n)for(n=0;n<i;n++)r[s+n]=this.o[t+n];else for(s=s+i-1;t<i;t++)r[s]=this.o[t],s--},i.prototype.clear=function(e){e?this.resize(0):this.Ch(0)},i.prototype.hx=function(){this.pk=this.Pb=!0},i.prototype.Wd=function(e,t,r){10>t-e?i.jG(this.o,e,t,r):i.kB(this.o,e,t-1,r)},i.prototype.Vp=function(){return 2},i.prototype.Gc=function(){return this.o[this.size-1]},i.prototype.Jf=function(){this.resize(this.size-1)},i.prototype.PW=function(e){this.o[this.size-1]=e},i.prototype.IV=function(e){e<this.size-1&&(this.o[e]=this.o[this.size-1]),this.resize(this.size-1)},i.prototype.dF=function(e){for(var t=0,i=this.size;t<i;t++)if(this.o[t]==e)return t;return-1},i.prototype.$F=function(e){return 0<=this.dF(e)},i.jG=function(e,t,i,r){for(var s=t;s<i;s++){for(var n=e[s],o=s-1;o>=t&&0<r(e[o],n);)e[o+1]=e[o],o--;e[o+1]=n}},i.rx=function(e,t,i){var r=e[i];e[i]=e[t],e[t]=r},i.kB=function(e,t,r,s){if(!(t>=r))for(;;){if(9>r-t){i.jG(e,t,r+1,s);break}var n=e[t];i.rx(e,t,r);for(var o=t,a=t;a<r;a++)0>=s(e[a],n)&&(i.rx(e,o,a),o+=1);i.rx(e,o,r),o-t<r-o?(i.kB(e,t,o-1,s),t=o+1):(i.kB(e,o+1,r,s),r=o-1)}},i}();e.ja=i}($||($={})),function(e){function t(e,t,i,r){i=new Int8Array(e.subarray(i,r)),e.set(i,t)}var i=function(){function i(e){this.o=null;var t=e;2>t&&(t=2),this.o=new Int8Array(t),this.size=e}return i.prototype.rotate=function(t,i,r){if(this.Pb)throw e.i.ga("invalid_call");if(i<t||i>r||t>r)throw e.i.O();t!=i&&r!=i&&(this.oi(t,i-t,1),this.oi(i,r-i,1),this.oi(t,r-t,1))},i.rf=function(e,t){var r=new i(e),s=r.o;if(2>e&&(e=2),0!==t)for(var n=0;n<e;n++)s[n]=t;return r},i.Cn=function(e){var t=new i(0);return t.o=new Int8Array(e.o),t.size=e.size,t},i.Mr=function(e,t){var r=new i(0);return r.size=e.size,r.size>t&&(r.size=t),2>(t=r.size)&&(t=2),r.o=new Int8Array(t),r.o.set(e.o.length<=t?e.o:e.o.subarray(0,t),0),r},i.prototype.Jb=function(e){0>=e||(null==this.o?this.o=new Int8Array(e):e<=this.o.length||(0<this.o.length?((e=new Int8Array(e)).set(this.o),this.o=e):this.o=new Int8Array(e)))},i.prototype.read=function(e){return this.o[e]},i.prototype.uc=function(e,t){t.x=this.o[e],t.y=this.o[e+1]},i.prototype.get=function(e){return this.o[e]},i.prototype.write=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i},i.prototype.set=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i},i.prototype.Ut=function(t,i){if(this.Pb)throw e.i.Hb();this.o[t]=i.x,this.o[t+1]=i.y},i.prototype.add=function(e){this.resize(this.size+1),this.o[this.size-1]=e},i.prototype.AB=function(e){return i.Mr(this,e)},i.prototype.Bg=function(e){return this.read(e)},i.prototype.resize=function(t,i){if(void 0===i&&(i=0),this.pk)throw e.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");if(t<=this.size){if(30<this.o.length&&5*t/4<this.o.length){var r=new Int8Array(this.o,0,t);this.o=r}}else{t>this.o.length&&(r=e.P.truncate(64>t?Math.max(2*t,4):5*t/4),(r=new Int8Array(r)).set(this.o),this.o=r),r=this.o;for(var s=this.size;s<t;s++)r[s]=i}this.size=t},i.prototype.Ch=function(t){if((null==this.o||t>this.o.length)&&this.resize(t),this.pk)throw e.i.ga("invalid call. Attribute Stream is locked and cannot be resized.");this.size=t},i.prototype.rr=function(e,t){this.write(e,t)},i.prototype.Bn=function(t,i,r){for(var s=this.size;i<s&&i<r;i++)t=e.P.Uh(this.read(i),t);return t},i.prototype.Nb=function(e,t,r){if(null==e||!(e instanceof i))return!1;var s=this.size,n=e.size;if(r>s||r>n&&s!=n)return!1;for(r>s&&(r=s);t<r;t++)if(this.read(t)!=e.read(t))return!1;return!0},i.prototype.addRange=function(t,i,r,s,n){if(this.Pb)throw e.i.Hb();if(!s&&(1>n||r%n!=0))throw e.i.O();var o=this.size;if(this.resize(o+r),s)this.o.set(t.o.subarray(i,i+r),o);else{s=r;for(var a=0;a<r;a+=n){s-=n;for(var l=0;l<n;l++)this.o[o+a+l]=t.o[i+s+l]}}},i.prototype.Nn=function(i,r,s,n,o,a,l){if(this.Pb)throw e.i.Hb();if(!o&&(1>a||n%a!=0))throw e.i.O();if(t(this.o,i+n,i,i+(l-i)),this.o==r.o&&i<s&&(s+=n),o)this.o.set(r.o.subarray(s,s+n),i);else for(o=n,l=0;l<n;l+=a){o-=a;for(var h=0;h<a;h++)this.o[i+l+h]=r.o[s+o+h]}},i.prototype.Mn=function(i,r,s,n){if(this.Pb)throw e.i.Hb();for(n-=i,t(this.o,i+n,i,i+n),n=0;n<s;n++)this.o[i+n]=r},i.prototype.Dz=function(i,r,s,n,o,a){if(this.Pb)throw e.i.Hb();if(0>a&&(a=this.size),this.size+2*n>this.o.length?this.resize(this.size+2*n):this.size+=2*n,t(this.o,i+2*n,i,i+(a-i)),o)for(o=0;o<n;o++)a=r[s++],this.o[i++]=a.x,this.o[i++]=a.y;else{o=0;for(var l=n-1;o<n;++o)a=r[s+l],this.o[i++]=a.x,this.o[i++]=a.y,l--}},i.prototype.wj=function(i,r,s){if(this.Pb)throw e.i.Hb();t(this.o,i+2,i,i+(s-i)),this.o[i]=r.x,this.o[i+1]=r.y},i.prototype.Vt=function(t,i,r,s,n,o){if(0>t||0>i||0>s)throw e.i.O();if(!n&&(0>=o||i%o!=0))throw e.i.O();if(r.size<s+i)throw e.i.O();if(0!=i)if(this.size<i+t&&this.resize(i+t),r==this)this.Cr(t,i,s,n,o);else if(n)for(n=0;n<i;n++)this.o[t]=r.o[s],t++,s++;else if(s=s+i-o,1==o)for(n=0;n<i;n++)this.o[t]=r.o[s],t++,s--;else for(n=0,i=e.P.truncate(i/o);n<i;n++){for(var a=0;a<o;a++)this.o[t+a]=r.o[s+a];t+=o,s-=o}},i.prototype.Fn=function(i,r,s){if(this.Pb)throw e.i.Hb();if(i+r>this.size)throw e.i.Hb();0<s-(i+r)&&t(this.o,i,i+r,i+(s-(i+r))+r),this.size-=r},i.prototype.oi=function(t,i,r){if(this.Pb)throw e.i.Hb();if(1>r||i%r!=0)throw e.i.Hb();for(var s=i>>1,n=0;n<s;n+=r){i-=r;for(var o=0;o<r;o++){var a=this.o[t+n+o];this.o[t+n+o]=this.o[t+i+o],this.o[t+i+o]=a}}},i.prototype.Xj=function(t,i,r){if(0>i||0>r||0>i||r+i>this.size)throw e.i.O();for(var s=i;s<i+r;s++)this.o[s]=t},i.prototype.Cr=function(t,i,r,s,n){if(!(s&&t==r||(this.o.set(this.o.subarray(r,r+i),t),s)))for(r=t,t=t+i-n,s=0,i=e.P.truncate(i/2);s<i;s++){for(var o=0;o<n;o++){var a=this.o[r+o];this.o[r+o]=this.o[t+o],this.o[t+o]=a}r+=n,t-=n}},i.prototype.oC=function(t,i,r,s,n){if(0>t||0>i||0>s)throw e.i.O();if(0!=i)for(this.size<(i<<1)+t&&this.resize((i<<1)+t),n||(t+=i-1<<1),n=n?2:-2,i+=s;s<i;s++)this.o[t]=r[s].x,this.o[t+1]=r[s].y,t+=n},i.prototype.Ww=function(t,i,r,s,n){if(0>t||0>i||0>s||this.size<i+t)throw e.i.O();if(n)for(n=0;n<i;n++)r[s+n]=this.o[t+n];else for(s=s+i-1;t<i;t++)r[s]=this.o[t],s--},i.prototype.clear=function(e){e?this.resize(0):this.Ch(0)},i.prototype.hx=function(){this.pk=this.Pb=!0},i.prototype.Wd=function(e,t,i){t=this.o.subarray(e,t),Array.prototype.sort.call(t,i),this.o.set(t,e)},i.prototype.rJ=function(t,i){if(this.Pb)throw e.i.ga("invalid call. Attribute Stream is read only.");this.o[t]|=i},i.prototype.CE=function(t,i){if(this.Pb)throw e.i.ga("invalid call. Attribute Stream is read only.");this.o[t]&=~i},i.prototype.Vp=function(){return 1},i}();e.rn=i}($||($={})),function(e){e.Zc=function(){function t(){}return t.Nr=function(t,i){return e.rn.rf(t,i)},t.En=function(t,i){return e.ce.rf(t,i)},t.hP=function(t,i,r){switch(t){case 1:t=e.ce.rf(i,r);break;case 2:t=e.ja.rf(i,r);break;case 4:t=e.rn.rf(i,r);break;default:throw e.i.Ra()}return t},t.QE=function(i,r){return t.hP(e.ua.Vp(i),r*e.ua.Wa(i),e.ua.te(i))},t.Ph=function(t,i){return e.ja.rf(t,i)},t.iI=function(e){var t,i=[];for(t=0;t<e;t++)i.push(null);return i},t}()}($||($={})),function(e){e.ha=function(e){void 0===e&&(e=0),this.u=e}}($||($={})),function(e){e.FL=function(){function t(){}return t.bind=function(t){e.Tc=t.PeDefs,e.qf=t.PeFactory,e.FC=t.PeVertcs,e.fj=t.PeCSTransformations,e.EC=t.PeGTTransformations,e.DL=t.PeGeogtran,e.CL=t.PeFactoryCodechange,e.DC=t.PeGCSExtent,e.Eg=t.PePCSInfo,e.EL=t.PeHorizon,e.BL=t.PeCoordsys,e.mp=t.PeGTlistExtended,e.mp.PE_GTLIST_OPTS_USE_DEFAULT=128,e.qf.initialize(null),e.Kx=t.PeGTlistExtendedEntry,e.qf.fromString(e.Tc.PE_TYPE_UNIT,'UNIT["Meter",1.0]')},t}(),e.qf=null,e.FC=null,e.BL=null,e.EL=null,e.Eg=null,e.mp=null,e.Kx=null,e.DC=null,e.CL=null,e.DL=null,e.Tc=null,e.EC=null,e.fj=null}($||($={})),function(e){var t=function(){function e(){}return e.Mb=function(t,i){return 0<=i?e.R(t):-e.R(t)},e.R=function(e){return 0>e?-e:e},e.ui=function(e){return 3552713678800501e-30>e},e.CC=function(t,i,r){return e.R(t-i)<=r*(1+(e.R(t)+e.R(i))/2)},e.$=function(t,i){return e.CC(t,i,3552713678800501e-30)},e.xL=function(t){return 3552713678800501e-30>=e.R(t)},e.Dd=function(t){return e.xL(t)},e}();e.s=t,e.F=function(){function i(){}return i.hp=function(e,i){var r=0;return(e=t.R(e))+(i=t.R(i))!=0&&(e>i?(r=i/e,r=e*Math.sqrt(1+r*r)):(r=e/i,r=i*Math.sqrt(1+r*r))),r},i.Yq=function(e,r,s,n,o){for(var a=[0,0,0],l=[0,0,0],h=0;2>=h;h++)r[h]-=e[h],s[h]-=r[h];s=a[1]*l[2]-a[2]*l[1],r=a[2]*l[0]-a[0]*l[2],a=a[0]*l[1]-a[1]*l[0],e=-1*(s*e[0]+r*e[1]+a*e[2]),n[0]=s,n[1]=r,n[2]=a,n[3]=e,l=i.qn(n),n[0]/=l,n[1]/=l,n[2]/=l,n[3]/=l,0!=o&&(l=t.Dd(a)?t.Dd(e)?t.Mb(1,r):-t.Mb(1,e):t.Mb(1,a),l*=t.Mb(1,o),n[0]*=l,n[1]*=l,n[2]*=l,n[3]*=l)},i.xx=function(e,t,i){i[0]=e[1]*t[2]-t[1]*e[2],i[1]=e[2]*t[0]-t[2]*e[0],i[2]=e[0]*t[1]-t[0]*e[1]},i.Tt=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},i.qn=function(e){return i.hp(i.hp(e[0],e[1]),e[2])},i.dl=function(e,t,r,s,n,o,a,l){e=i.n(e,t,r);var h=Math.cos(r);o.u=(e+n)*h*Math.cos(s),a.u=(e+n)*h*Math.sin(s),l.u=(e*(1-t)+n)*Math.sin(r)},i.bO=function(e,r,s,n,o,a,l){var h=i.hp(r,s),c=1*Math.sqrt(1-e),u=c/1;if(t.$(h,0))a.u=0,o.u=t.Mb(1.570796326794897,n),l.u=t.R(n)-c;else{a.u=Math.atan2(s,r),s=Math.atan2(1*n,c*h),a=Math.cos(s);var p=Math.sin(s);r=c*e/(1-e),e*=1,s=Math.atan2(n+r*p*p*p,h-e*a*a*a),3.141592653589793<t.R(s)&&(s=t.Mb(3.141592653589793,s)-s),s=Math.atan(u*Math.tan(s)),p=Math.sin(s),a=Math.cos(s),o.u=Math.atan2(n+r*p*p*p,h-e*a*a*a),1.570796326794897<t.R(o.u)&&(o.u=t.Mb(3.141592653589793,o.u)-o.u),s=Math.atan(u*Math.tan(o.u)),p=Math.sin(s),a=Math.cos(s),l.u=(n-c*p)*Math.sin(o.u)+(h-1*a)*Math.cos(o.u)}},i.n=function(e,t,i){return i=Math.sin(i),e/Math.sqrt(1-t*i*i)},i.ot=function(e,t){return Math.atan2(Math.sin(t)*(1-e),Math.cos(t))},i.Rj=function(e,t){return Math.atan2(Math.sin(t),Math.cos(t)*(1-e))},i.Tq=function(e,r){if(t.ui(e)||0==r||t.$(t.R(r),1.570796326794897))return r;if(.006884661117170036>e){var s=Math.sqrt(1-e),n=(1-s)/(1+s),o=n*n,a=n*o,l=n*a,h=n*l,c=n*h,u=n*c,p=1.572916666666667*a-3.2578125*h+4.295068359375*u;e=2.142578125*l-6.071484375*c,s=3.129296875*h-11.249837239583334*u;var d=4.775276692708333*c,f=7.958636765252976*u,y=Math.cos(2*r);return r+Math.sin(2*r)*(1.5*n-.84375*a+.525390625*h-.2688395182291667*u-p+s-f+y*(2*(1.3125*o-1.71875*l+1.650146484375*c)-4*e+6*d+y*(4*p-12*s+24*f+y*(8*e-32*d+y*(16*s-80*f+y*(32*d+64*y*f))))))}for(s=1-e,n=e/2,a=(o=t.R(r))*i.$u(e)/(1.570796326794897*s),l=9999,c=o,o=0;1e-16<l&&50>o;o++)u=i.w(e,c),h=c-(p=(h=(i.cG(c,e)-n*Math.sin(2*c)/u)/s-a)/(u=1/(u*u*u))),l=t.R(p),c=h;return 0<=r?c:-c},i.gW=function(e,r){return t.ui(r)?e:e*i.$u(r)/1.570796326794897},i.ca=function(e){return 0>(e=i.hF(e,6.283185307179586))?e+6.283185307179586:3.141592653589793>t.R(e)||t.$(t.R(e),3.141592653589793)?e:e-6.283185307179586},i.hF=function(e,t){return e-Math.floor(e/t)*t},i.Bh=function(e,t){if(.006884661117170036>t){var r=(t=(1-(t=Math.sqrt(1-t)))/(1+t))*t,s=r*r;return e/(1+t)*(1+.25*r+.015625*s+.00390625*r*s)*1.570796326794897}return e*i.$u(t)},i.Xq=function(e,r){var s=t.Mb(1,Math.sin(r));return r=1.570796326794897>=(r=t.R(i.hF(r,3.141592653589793)))?r:3.141592653589793-r,(t.$(r,1.570796326794897)?r:Math.atan(Math.sqrt(1-e)*Math.tan(r)))*s},i.q=function(e,t,r){if(.006884661117170036>t){var s=(t=(1-(t=Math.sqrt(1-t)))/(1+t))*t,n=t*s,o=t*n,a=t*o,l=t*a,h=t*l,c=-.7291666666666666*n+.2278645833333333*a+.03987630208333334*h,u=.615234375*o-.21533203125*l,p=-.54140625*a+.20302734375*h,d=.48876953125*l,f=-.4488699776785715*h,y=Math.cos(2*r);return e/(1+t)*((1+.25*s+.015625*o+.00390625*l)*r+Math.sin(2*r)*(-1.5*t+.1875*n+.0234375*a+.00732421875*h-c+p-f+y*(2*(.9375*s-.234375*o-.03662109375*l)-4*u+6*d+y*(4*c-12*p+24*f+y*(8*u-32*d+y*(16*p-80*f+y*(32*d+64*y*f)))))))}return e*(i.cG(r,t)-.5*t*Math.sin(2*r)/i.w(t,r))},i.w=function(e,t){return t=Math.sin(t),Math.sqrt(1-e*t*t)},i.$u=function(e){return t.CC(e,1,2220446049250313e-31)?1:1>e?i.Yw(0,1-e)-e/3*i.Vw(0,1-e):NaN},i.cG=function(r,s){var n=t.Mb(1,r);r=t.R(r);var o=Math.floor(r/1.570796326794897);if(1<s)s=0==r?0:NaN;else if(t.Dd(o))s=(r=i.sin(r))*i.Yw(1-r*r,1-s*r*r)-s/3*r*r*r*i.Vw(1-r*r,1-s*r*r);else{var a=e.P.truncate(o%2),l=i.$u(s);s=0<a?l*(o+1)-(s=(r=Math.sin(1.570796326794897*(o+1)-r))*i.Yw(1-r*r,1-s*r*r)-s/3*r*r*r*i.Vw(1-r*r,1-s*r*r)):l*o+(s=(r=Math.sin(r-1.570796326794897*o))*i.Yw(1-r*r,1-s*r*r)-s/3*r*r*r*i.Vw(1-r*r,1-s*r*r))}return s*n},i.sin=function(e){e=i.ca(e);var r=t.Mb(1,e);return e=t.R(e),t.$(e,3.141592653589793)?0:t.$(e,1.570796326794897)?1*r:Math.sin(e)*r},i.Vw=function(e,i){var r,s,n,o,a=e,l=i,h=1;for(i=0,e=1;s=((r=.2*(a+l+3*h))-a)/r,n=(r-l)/r,o=(r-h)/r,!(1e-4>t.R(s)&&1e-4>t.R(n)&&1e-4>t.R(o));)o=Math.sqrt(l),i+=e/((r=Math.sqrt(h))*(h+(o=Math.sqrt(a)*(o+r)+o*r))),e*=.25,a=.25*(a+o),l=.25*(l+o),h=.25*(h+o);return l=(a=s*n)-(h=o*o),3*i+e*(1+(h=a-6*h)*(.10227272727272728*h-.2142857142857143-.1730769230769231*o*(s=h+l+l))+o*(.1666666666666667*s+o*(-.4090909090909091*l+.1153846153846154*o*a)))/(r*Math.sqrt(r))},i.Yw=function(e,i){for(var r,s,n,o,a=1;s=2-((r=(e+i+a)/3)+e)/r,n=2-(r+i)/r,o=2-(r+a)/r,!(1e-4>t.R(s)&&1e-4>t.R(n)&&1e-4>t.R(o));a=.25*(a+r))r=Math.sqrt(i),s=Math.sqrt(a),e=.25*(e+(r=Math.sqrt(e)*(r+s)+r*s)),i=.25*(i+r);return(1+(.04166666666666666*(e=s*n-o*o)-.1-.06818181818181818*(i=s*n*o))*e+.07142857142857142*i)/Math.sqrt(r)},i.Rw=function(e,i){if(t.ui(e)||0==i||t.$(t.R(i),1.570796326794897))return i;if(.006884661117170036>e){var r=e*e,s=e*r,n=e*s,o=e*n,a=e*o,l=e*a,h=-(.02708333333333333*s+.03430059523809524*n+.03149181547619048*o+.02634359154541446*a+.02156896735835538*l),c=.007669890873015873*n+.01299603174603175*o+.0148051353064374*a+.01454454953803912*l,u=-(.002275545634920635*o+.004830845032667949*a+.006558395368616723*l),p=.0006957236677288761*a+.001775193002406544*l,d=-.000217324089394402*l,f=Math.cos(2*i);return i+Math.sin(2*i)*(-(.5*e+.2083333333333333*r+.09375*s+.04878472222222222*n+.02916666666666667*o+.01938905423280423*a+.01388255931712963*l)-h+u-d+f*(2*(.1041666666666667*r+.0875*s+.06050347222222222*n+.04151785714285714*o+.02958958540013228*a+.02203667534722222*l)-4*c+6*p+f*(4*h-12*u+24*d+f*(8*c-32*p+f*(16*u-80*d+f*(32*p+64*f*d))))))}return 0==i||t.$(t.R(i),1.570796326794897)?r=i:(n=(s=Math.sqrt(e))*Math.sin(i),r=Math.tan(.7853981633974483+i/2)*Math.pow((1-n)/(1+n),s/2),r=2*Math.atan(r)-1.570796326794897),r},i.qO=function(e,i){if(t.ui(e)||0==i||t.$(t.R(i),1.570796326794897))return i;if(.006884661117170036>e){var r=e*(p=e*(u=e*(f=e*e))),s=e*(d=e*r),n=.05833333333333333*u+.07232142857142858*p+.05634300595238095*r+.0355325796406526*d+.020235546186067*s,o=.02653149801587302*p+.04379960317460317*r+.0429211791776896*d+.03255384637546096*s,a=.01294022817460318*r+.02668104344536636*d+.03155651254609588*s,l=.00659454790965208*d+.0163075268674227*s,h=.003463473736911237*s,c=Math.cos(2*i);return i+Math.sin(2*i)*(.5*e+.2083333333333333*f+.08333333333333333*u+.03611111111111111*p+.01875*r+.01195601851851852*d+.008863673941798942*s-n+a-h+c*(2*(.1458333333333333*f+.1208333333333333*u+.07039930555555556*p+.03616071428571429*r+.01839451058201058*d+.01017113095238095*s)-4*o+6*l+c*(4*n-12*a+24*h+c*(8*o-32*l+c*(16*a-80*h+c*(32*l+64*c*h))))))}var u=Math.sqrt(e),p=u/2,d=Math.tan(.7853981633974483+i/2);e=0,n=1;for(var f=i;0!=n;f=s)r=u*Math.sin(f),s=d*Math.pow((1+r)/(1-r),p),s=2*Math.atan(s)-1.570796326794897,e++,(t.$(s,f)||3e4<e)&&(n=0);return f},i}()}($||($={})),function(e){var t=function(){function t(t){this.wl=this.Vs=null,this.Jv=!1,this.AA=this.BA=0,this.zH=new e.h,this.PH=new e.h,this.EA=!1,this.xq=new e.l,this.oH=this.tw=0,this.uw=null,this.Bl=!1,this.Fo=null,this.Xz=0,this.Re=t,this.Bs=e.Ab.yv(this.Re,0,!0),this.zH.Sc(),this.PH.Sc(),this.JH=NaN;var i=t.getCode();0<i?(this.Kk=i,e.qf.getCode(t)):this.Kk=e.qf.getCode(t),0>this.Kk&&(this.Kk=0);var r=this.Re.getType();if(this.bH=r==e.Tc.PE_TYPE_PROJCS?2:1,r==e.Tc.PE_TYPE_PROJCS&&!t.loadConstants())throw e.i.O("PeProjcs.loadConstants failed");i=r==e.Tc.PE_TYPE_GEOGCS?this.Re:this.Re.getGeogcs(),r!=e.Tc.PE_TYPE_GEOGCS&&e.qf.getCode(i),this.Fo=t.getUnit(),this.JH=i.getPrimem().getLongitude(),this.oH=t=i.getUnit().getUnitFactor(),t=Math.PI/(180*t),1e-10>Math.abs(t-1)&&(t=1),this.AA=t,0!=(r&e.Tc.PE_TYPE_PROJCS)?(i=this.Re,this.BA=1/i.getUnit().getUnitFactor(),this.tw=.001/this.Re.getUnit().getUnitFactor(),this.uw=e.Eg.generate(i,e.Eg.PE_PCSINFO_OPTION_NONE),this.Bl=this.uw.isPannableRectangle(),this.Xz=e.Ab.iN(this.uw.getCentralMeridian(),this.AA)):(this.EA=this.Bl=!0,this.BA=0,r=1/i.getUnit().getUnitFactor(),this.tw=.001/i.getDatum().getSpheroid().getAxis()*r,this.Xz=0),this.Bl&&(this.vx(),this.vK(),this.bY(),this.uK(),this.$X(),this.aY())}return t.prototype.bs=function(){return this.Kk},t.prototype.kk=function(){return this.uw},t.Ky=function(e,t){return e==t||null!=e&&null!=t&&0==e.Kk&&0==t.Kk&&e.Bs===t.Bs},t.prototype.Xc=function(){return this.Bl},t.prototype.hh=function(e){e.L(this.to)},t.prototype.qv=function(){return this.to.v},t.prototype.pv=function(){return this.to.C},t.prototype.yR=function(e){e.L(this.vw)},t.prototype.$X=function(){var t=this.Re.getType();if(t==e.Tc.PE_TYPE_PROJCS){t=this.Re;var i=this.kk().getCentralMeridian(),r=t.getGeogcs();if(null==r)throw e.i.ga("internal error");i=[[i+(r=1/r.getUnit().getUnitFactor()*Math.PI),0]],e.fj.geogToProj(t,1,i),i=i[0][0],r=t.getParameters()[e.Tc.PE_PARM_X0].getValue();var s=this.ol();t=new e.l,s.A(t),i=(s=Math.abs(i-r))+r,r=-1*s+r,s=t.H,t=t.G;var n=new e.l;n.L(r,t,i,s),null==this.to&&(this.to=n)}else{if(t!=e.Tc.PE_TYPE_GEOGCS)throw e.i.ga("internal error");r=1/this.Re.getUnit().getUnitFactor()*Math.PI,(t=new e.l).L(-r,-r/2,r,r/2),null==this.to&&(this.to=t)}},t.prototype.aY=function(){var t=this.Re.getType();if(t==e.Tc.PE_TYPE_PROJCS){var i=this.Re;if(t=this.kk().getCentralMeridian(),null==(i=i.getGeogcs()))throw e.i.ga("internal error");i=1/i.getUnit().getUnitFactor()*Math.PI;var r=this.Wr(),s=new e.l;r.A(s),(r=new e.l).L(t-i,s.G,t+i,s.H),null==this.vw&&(this.vw=r)}else{if(t!=e.Tc.PE_TYPE_GEOGCS)throw e.i.ga("internal error");i=1/this.Re.getUnit().getUnitFactor()*Math.PI,(t=new e.l).L(-i,-i/2,i,i/2),null==this.vw&&(this.vw=t)}},t.prototype.bf=function(){return this.AA},t.prototype.rm=function(){return this.BA},t.prototype.Wr=function(){if(this.Bl)return this.wl;var e=this.wl;return null!=e?e:(this.vx(),this.wl)},t.prototype.Xr=function(){return this.Bl?null:(null!=this.wl||this.vx(),this.PG)},t.prototype.vx=function(){if(this.Re.getType()==e.Tc.PE_TYPE_PROJCS){var t=this.Re,i=t.getGeogcs(),r=t.horizonGcsGenerate();if(null!=r){var s=r[0].getNump(),n=r[0].getKind();t=0<r[0].getInclusive();var o=this.bf(),a=90*o,l=360*o,h=370*o,c=180*o*e.Tc.PE_HORIZON_DELTA/Math.PI,u=new e.l,p=null;if(1<s)for(var d=1;d<s;d++)if(r[d].getKind()==e.Tc.PE_HORIZON_LINE){null==p&&(p=new e.Ua);var f=r[d].getCoord();p.qx(f[0][0],f[0][1]),p.zj(f[1][0],f[1][1])}if(n==e.Tc.PE_HORIZON_RECT)r=r[0].getCoord(),u.L(r[0][0],r[0][1]),u.$b(r[1][0],r[1][1]),Math.abs(u.H-a)<1e-7*c&&(u.H=a),Math.abs(u.G+a)<1e-7*c&&(u.G=-a),u.S()>h&&(r=-400*o,u.L(r,u.G,r+5*l,u.H)),r=new e.Gh(u),null==this.wl&&(this.wl=r,this.Jv=t);else{if(h=new e.Ea,l=this.kk().isGcsHorizonMultiOverlap(),u=e.hu.UE(i,e.iu.Integer64),l){for(h=new e.ZK,c=e.Hh.local().W(h,u,null),d=0;d<s;d++)if(r[d].getKind()==e.Tc.PE_HORIZON_POLY){for(i=r[d].getSize(),o=r[d].getCoord(),n=[],a=0;a<i;a++)n[a]=e.h.construct(o[a][0],o[a][1]);r[d].getInclusive(),l&&((o=new e.Ea).Zk(n,i-1),h.NX(o),c.qe())}h=c.next()}else for(d=0;d<s;d++)if(r[d].getKind()==e.Tc.PE_HORIZON_POLY){for(i=r[d].getSize(),o=r[d].getCoord(),l=[],a=0;a<i;a++)l[a]=e.h.construct(o[a][0],o[a][1]);r[d].getInclusive(),h.Zk(l,i-1)}t?e.Wk.local().xn(h,u,1):e.lp.local().xn(h,u,1),e.ej.local().xn(h,u,1),null==this.wl&&(this.wl=h,this.Jv=t,this.PG=p)}}}},t.prototype.jv=function(){return this.Bl||null==this.wl&&this.vx(),this.Jv},t.prototype.vK=function(){if(2==this.bH){var t=this.Re.horizonPcsGenerate();if(null!=t){var i=t[0].getKind();t[0].getInclusive();var r=t[0].getNump(),s=!1;if(i==e.Tc.PE_HORIZON_RECT)t=t[0].getCoord(),(r=new e.l).L(t[0][0],t[0][1]),r.$b(t[1][0],t[1][1]),t=new e.Gh(r);else{for(i=-1,s=0;s<r;s++)t[s].getKind()==e.Tc.PE_HORIZON_POLY&&(i=s);for(s=t[i].getSize()-1,t=t[i].getCoord(),r=[],i=0;i<s;i++)r[i]=e.h.construct(t[i][0],t[i][1]);t=i=new e.Ea,i.Zk(r,s),s=!0}this.kk().isDensificationNeeded()&&(r=1e5*this.rm(),t=e.Zl.local().W(t,r,null)),s&&(s=new e.Gh,t.dn(s),t.He(),t.Rb(),t.hR(),e.Wk.local().xn(t,null,1)),null==this.Vs&&(this.Vs=t)}}},t.prototype.ol=function(){if(this.Bl)return this.Vs;var e=this.Vs;return null!=e?e:(this.vK(),this.Vs)},t.prototype.bY=function(){if(this.Re.getType()==e.Tc.PE_TYPE_PROJCS){var t=90*this.bf();t=[[0,t],[0,-t]],e.fj.geogToProj(this.Re,2,t);var i=this.kk(),r=i.getNorthPoleLocation()!=e.Eg.PE_POLE_OUTSIDE_BOUNDARY;i=i.getSouthPoleLocation()!=e.Eg.PE_POLE_OUTSIDE_BOUNDARY,this.EA||(r&&this.zH.na(t[0][0],t[0][1]),i&&this.PH.na(t[1][0],t[1][1]))}this.EA=!0},t.prototype.uK=function(){if(1==this.bH){var t=400*this.bf();this.xq.L(-t,-t,t,t)}else t=e.Eg.generate(this.Re,e.Eg.PE_PCSINFO_OPTION_DOMAIN),t=e.l.construct(t.getDomainMinx(),t.getDomainMiny(),t.getDomainMaxx(),t.getDomainMaxy()),this.xq.B()&&this.xq.L(t)},t.prototype.$Q=function(e){this.Bl&&e.L(this.xq),this.xq.B()&&this.uK(),e.L(this.xq)},t.prototype.Wp=function(){return this.JH},t.prototype.Ai=function(){return this.Xz},t.prototype.Id=function(){return this.Fo},t.prototype.Yr=function(){return this.oH},t}();e.GC=t}($||($={})),function(e){var t=function(){function t(t){this.AT=t,this.Bs=e.Ab.yv(t,0,!0);var i=t.getCode();this.ts=0<i?i:e.qf.getCode(t),0>this.ts&&(this.ts=0),this.Fo=i=this.AT.getUnit(),this.AH=1/i.getUnitFactor(),e.qf.getCode(t)}return t.Ky=function(e,t){return e==t||null!=e&&null!=t&&0==e.ts&&0==t.ts&&e.Bs===t.Bs},t.prototype.bs=function(){return this.ts},t}();e.HL=t}($||($={})),function(e){e.Zg=function(){function t(){}return t.ub=function(t,i,r,s,n,o,a,l){if(null!=o||null!=a||null!=l){s=e.F.ca(s),i=e.F.ca(i),r=e.F.ca(r),n=e.F.ca(n),1.570796326794897<e.s.R(r)&&(r=e.s.Mb(3.141592653589793,r)-r,i=e.F.ca(i+3.141592653589793)),1.570796326794897<e.s.R(n)&&(n=e.s.Mb(3.141592653589793,n)-n,s=e.F.ca(s+3.141592653589793));var h=e.F.ca(s-i);if(e.s.$(r,n)&&(e.s.$(i,s)||e.s.$(e.s.R(r),1.570796326794897)))null!=o&&(o.u=0),null!=a&&(a.u=0),null!=l&&(l.u=0);else{if(e.s.$(r,-n)){if(e.s.$(e.s.R(r),1.570796326794897))return null!=o&&(o.u=3.141592653589793*t),null!=a&&(a.u=0<r?e.F.ca(3.141592653589793-e.F.ca(s)):e.F.ca(s)),void(null!=l&&(l.u=0<r?e.F.ca(s):e.F.ca(3.141592653589793-e.F.ca(s))));if(e.s.$(e.s.R(h),3.141592653589793))return null!=o&&(o.u=3.141592653589793*t),null!=a&&(a.u=0),void(null!=l&&(l.u=0))}var c=1.570796326794897==e.s.R(r)?0:Math.cos(r),u=Math.sin(r),p=1.570796326794897==e.s.R(n)?0:Math.cos(n),d=Math.sin(n),f=1.570796326794897==e.s.R(h)?0:Math.cos(h),y=3.141592653589793==e.s.R(h)?0:Math.sin(h);if(null!=o){var g=Math.sin((n-r)/2);h=Math.sin(h/2),o.u=2*Math.asin(Math.sqrt(g*g+c*p*h*h))*t}null!=a&&(a.u=e.s.$(e.s.R(r),1.570796326794897)?0>r?s:e.F.ca(3.141592653589793-s):Math.atan2(p*y,c*d-u*p*f)),null!=l&&(e.s.$(e.s.R(n),1.570796326794897)?l.u=0>n?i:e.F.ca(3.141592653589793-i):(l.u=Math.atan2(c*y,d*c*f-p*u),l.u=e.F.ca(l.u+3.141592653589793)))}}},t.sf=function(t,i,r,s,n,o,a){if(null!=o||null!=a){i=e.F.ca(i),r=e.F.ca(r),1.570796326794897<e.s.R(r)&&(r=e.s.Mb(3.141592653589793,r)-r,i=e.F.ca(i+3.141592653589793)),e.s.$(e.s.R(r),1.570796326794897)&&(i=0),n=e.F.ca(n);var l=e.s.$(e.s.R(n),1.570796326794897)?0:Math.cos(n),h=e.s.$(e.s.R(n),3.141592653589793)?0:Math.sin(n),c=e.s.$(e.s.R(r),1.570796326794897)?0:Math.cos(r),u=Math.sin(r);t=s/t,s=e.s.$(e.s.R(t),1.570796326794897)?0:Math.cos(t);var p=e.s.$(e.s.R(t),3.141592653589793)?0:Math.sin(t),d=Math.asin(u*s+c*p*l);null!=a&&(a.u=d),null!=o&&(o.u=e.s.$(e.s.R(d),1.570796326794897)?e.s.$(r,-d)?0>d?n:e.F.ca(3.141592653589793-n):i:e.s.$(e.s.R(r),1.570796326794897)&&e.s.$(t,3.141592653589793)?0>r?n:e.F.ca(3.141592653589793-n):e.F.ca(i+Math.atan2(p*h,c*s-u*p*l)))}},t}()}($||($={})),function(e){e.Xk=function(){function t(){}return t.ub=function(t,i,r,s,n,o,a,l,h){var c=new e.ha(0),u=new e.ha(0),p=[0,0,0],d=[0,0,0],f=[0,0,0],y=new e.ha(0),g=new e.ha(0),m=new e.ha(0),v=new e.ha(0),b=new e.ha(0);if(null!=a||null!=l||null!=h)if(e.s.ui(i))e.Zg.ub(t,r,s,n,o,a,l,h);else{n=e.F.ca(n),r=e.F.ca(r);var w=e.F.ca(n-r);if(e.s.$(s,o)&&(e.s.$(r,n)||e.s.$(e.s.R(s),1.570796326794897)))null!=a&&(a.u=0),null!=l&&(l.u=0),null!=h&&(h.u=0);else{if(e.s.$(s,-o)){if(e.s.$(e.s.R(s),1.570796326794897))return null!=a&&(a.u=2*e.F.Bh(t,i)),null!=l&&(l.u=0<s?e.F.ca(3.141592653589793-e.F.ca(n)):e.F.ca(n)),void(null!=h&&(h.u=0<s?e.F.ca(n):e.F.ca(3.141592653589793-e.F.ca(n))));e.s.$(e.s.R(w),3.141592653589793)&&(null!=a&&(a.u=2*e.F.Bh(t,i)),null!=l&&(l.u=0),null!=h&&(h.u=0))}else(e.s.$(e.s.R(s),1.570796326794897)||e.s.$(e.s.R(o),1.570796326794897))&&(e.s.$(e.s.R(s),1.570796326794897)?r=n:n=r);var _=0;if(0>w){_=1;var x=r;r=n,n=x,x=s,s=o,o=x}w=e.F.ot(i,s);var S=e.F.ot(i,o);null==l&&null==h||(e.Zg.ub(t,r,w,n,S,null,c,u),c=Math.atan2(Math.sin(c.u)*Math.cos(s-w),Math.cos(c.u)),u=Math.atan2(Math.sin(u.u)*Math.cos(o-S),Math.cos(u.u)),0!=_&&(x=c,c=u,u=x),null!=l&&(l.u=c),null!=h&&(h.u=u)),null!=a&&(e.F.dl(1,i,s,r,0,m,v,b),p[0]=m.u,p[1]=v.u,p[2]=b.u,e.F.dl(1,i,o,n,0,m,v,b),d[0]=m.u,d[1]=v.u,d[2]=b.u,f[0]=p[1]*d[2]-d[1]*p[2],f[1]=-(p[0]*d[2]-d[0]*p[2]),f[2]=p[0]*d[1]-d[0]*p[1],i=1-e.F.w(i,e.F.Xq(i,e.F.Rj(i,Math.acos(f[2]/Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]))))),i*=2-i,l=Math.atan2(-f[1],-f[0]),f=e.F.ca(l-1.570796326794897),l=e.F.ca(l+1.570796326794897),f=e.s.R(e.F.ca(r-f))<=e.s.R(e.F.ca(r-l))?f:l,e.Zg.ub(1,f,0,r,w,y,null,null),e.Zg.ub(1,f,0,n,S,g,null,null),3.141592653589793<y.u+g.u&&(f=e.F.ca(f+3.141592653589793),e.Zg.ub(1,f,0,r,w,y,null,null),e.Zg.ub(1,f,0,n,S,g,null,null)),y.u*=e.s.Mb(1,s),g.u*=e.s.Mb(1,o),y.u=e.F.Rj(i,y.u),g.u=e.F.Rj(i,g.u),r=e.F.q(t,i,y.u),t=e.F.q(t,i,g.u),a.u=e.s.R(t-r))}}},t.sf=function(t,i,r,s,n,o,a,l){var h=0,c=new e.ha(0),u=new e.ha(0),p=[0,0,0],d=[0,0,0],f=new e.ha(0),y=new e.ha(0),g=new e.ha(0);if(null!=a||null!=l)if(e.s.ui(i))e.Zg.sf(t,r,s,n,o,a,l);else if(e.s.Dd(n))null!=a&&(a.u=r),null!=l&&(l.u=s);else if(o=e.F.ca(o),0>n&&(n=e.s.R(n),o=e.F.ca(o+3.141592653589793)),r=e.F.ca(r),s=e.F.ca(s),1.570796326794897<e.s.R(s)&&(r=e.F.ca(r+3.141592653589793),s=e.s.Mb(3.141592653589793,s)-s),e.s.$(e.s.R(s),1.570796326794897)&&(r=0),e.s.Dd(s)){var m=e.s.R(1.570796326794897-e.s.R(o));m=e.F.Rj(i,m),m=1-e.F.w(i,e.F.Xq(i,m)),m*=2-m,t=n/e.F.Bh(t,m)*1.570796326794897,t=e.F.Tq(m,t),t=e.F.ot(m,t),e.Zg.sf(1,r,s,t,o,a,c),null!=l&&(h=c.u),null!=l&&(l.u=e.F.Rj(i,h))}else if(e.s.$(e.s.R(s),1.570796326794897))c=2*(h=e.F.Bh(t,i)),o=0<(t=e.s.Mb(1.570796326794897,s))?e.F.ca(3.141592653589793-o):o,s=h-n,e.s.R(s)<=h?null!=a&&(a.u=o):(s=Math.floor(n/c),0==e.P.truncate(s%2)?(null!=a&&(a.u=o),n-=s*c):(null!=a&&(a.u=e.F.ca(o+3.141592653589793)),n=(s+1)*c-n),s=h-n),null!=l&&(l.u=e.F.Tq(i,s/h*t));else{m=e.F.ot(i,s),o=Math.atan2(Math.sin(o),Math.cos(o)*Math.cos(s-m));var v=e.P.truncate(e.s.Mb(1,m))*(1.570796326794897>=e.s.R(o)?1:-1);o=e.F.ca(r+Math.atan(Math.tan(o)*-Math.sin(m))),e.Zg.ub(t,o,0,r,m,null,u,null),m=e.s.R(1.570796326794897-e.s.R(u.u)),m=e.F.Rj(i,m),m=1-e.F.w(i,e.F.Xq(i,m)),m*=2-m,e.F.dl(1,i,0,o,0,f,y,g),p[0]=f.u,p[1]=y.u,p[2]=g.u,e.F.dl(1,i,s,r,0,f,y,g),d[0]=f.u,d[1]=y.u,d[2]=g.u,s=Math.acos((p[0]*d[0]+p[1]*d[1]+p[2]*d[2])/Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2])),s=e.F.Rj(m,s),n=0<(s=e.F.q(t,m,s)+n*v)?u.u:e.F.ca(u.u+3.141592653589793),t=e.s.R(s)/e.F.Bh(t,m)*1.570796326794897,t=e.F.Tq(m,t),t=e.F.ot(m,t),e.Zg.sf(1,o,0,t,n,a,c),null!=l&&(h=c.u),null!=l&&(l.u=e.F.Rj(i,h))}},t}()}($||($={})),function(e){e.du=function(){function t(){}return t.ub=function(t,i,r,s,n,o,a,l,h){var c=0,u=0,p=0;if(null!=a||null!=l||null!=h)if(e.s.ui(i))e.Zg.ub(t,r,s,n,o,a,l,h);else{var d=e.F.ca(n-r);if(e.s.$(s,o)&&(e.s.Dd(d)||e.s.$(e.s.R(s),1.570796326794897)))null!=a&&(a.u=0),null!=l&&(l.u=0),null!=h&&(h.u=0);else{if(e.s.$(s,-o)){if(e.s.$(e.s.R(s),1.570796326794897))return null!=a&&(a.u=2*e.F.Bh(t,i)),null!=l&&(l.u=0<s?e.F.ca(3.141592653589793-e.F.ca(n)):e.F.ca(n)),void(null!=h&&(h.u=0<s?e.F.ca(n):e.F.ca(3.141592653589793-e.F.ca(n))));e.s.$(e.s.R(d),3.141592653589793)&&(null!=a&&(a.u=2*e.F.Bh(t,i)),null!=l&&(l.u=0),null!=h&&(h.u=0))}else{if(e.s.$(e.s.R(s),1.570796326794897)||e.s.$(e.s.R(o),1.570796326794897))return void e.Xk.ub(t,i,r,s,n,o,a,l,h);if(e.s.Dd(d)||e.s.$(e.s.R(d),3.141592653589793))return void e.Xk.ub(t,i,r,s,n,o,a,l,h)}var f=1-Math.sqrt(1-i),y=i/(1-i),g=t*(1-f);t=e.F.Xq(i,s);var m=e.F.Xq(i,o);i=1.570796326794897==e.s.R(t)?0:Math.cos(t);var v=Math.sin(t),b=1.570796326794897==e.s.R(m)?0:Math.cos(m),w=Math.sin(m),_=d,x=Math.cos(_),S=Math.sin(_),M=1,T=0;do{var I=_,E=Math.sqrt(Math.pow(b*S,2)+Math.pow(i*w-v*b*x,2)),A=v*w+i*b*x,P=Math.atan2(E,A);if(0==E){M=0;break}var C=i*b*S/E;if(c=Math.cos(Math.asin(C)),u=A-2*v*w/(c*=c),1<e.s.R(u)&&(u=e.s.Mb(1,u)),_=d+(1-(_=f/16*c*(4+f*(4-3*c))))*f*C*(P+_*E*(u+_*A*(2*(p=u*u)-1))),x=Math.cos(_),S=Math.sin(_),T++,3.141592653589793<e.s.R(_)&&30<T){M=0;break}}while(5e3>=T&&!e.s.$(I,_));if(0!=M)f=(y*=c)*(256+y*(y*(74-47*y)-128))/1024,null!=a&&(a.u=g*(1+y*(4096+y*(y*(320-175*y)-768))/16384)*(P-f*E*(u+f/4*(A*(2*p-1)-f/6*u*(4*E*E-3)*(4*p-3))))),null!=l&&(l.u=e.s.$(e.s.R(s),1.570796326794897)?0>s?n:e.F.ca(3.141592653589793-n):Math.atan2(b*S,i*w-v*b*x)),null!=h&&(e.s.$(e.s.R(o),1.570796326794897)?h.u=0>o?r:e.F.ca(3.141592653589793-r):(h.u=Math.atan2(i*S,i*w*x-v*b),h.u=e.F.ca(h.u+3.141592653589793)));else{_=e.s.Mb(3.141592653589793,d),A=v*w-i*b,P=Math.acos(A),E=Math.sin(P),c=1,T=C=0;do{p=C,x=1-.25*(C=f*(c*=c)*(1+f+f*f))+.1875*(u=f*f*(x=c*c)*(1+2.25*f))-.1953125*(M=f*f*f*x*c),C=.25*C-.25*u+.29296875*M,S=.03125*u-.05859375*M,M*=.00651041666666667,u=A-2*v*w/c,1<e.s.R(u)&&(u=e.s.Mb(1,u)),c=Math.acos(u),A=Math.cos(2*c),I=Math.cos(3*c),S=(C=e.s.$(s,-o)?e.F.ca(3.141592653589793-d)/(3.141592653589793*f*x):e.F.ca(_-d)/(f*(x*P+C*E*u+S*Math.sin(2*P)*A+M*Math.sin(3*P)*I)))*E/(i*b),_=1.570796326794897<e.s.R(d)?e.s.Mb(3.141592653589793,S)-Math.asin(S):Math.asin(S),x=Math.cos(_),E=Math.sqrt(Math.pow(b*S,2)+Math.pow(i*w-v*b*x,2)),P=3.141592653589793-Math.asin(e.s.R(E)),A=Math.cos(P),c=Math.cos(Math.asin(C)),T++}while(70>=T&&!e.s.$(p,C));null!=a&&(x=1+(y*=c*=c)*(4096+y*(y*(320-175*y)-768))/16384,e.s.$(s,-o)?a.u=3.141592653589793*g*x:(u=A-2*v*w/c,c=Math.acos(u),A=Math.cos(2*c),I=Math.cos(3*c),a.u=g*(x*P+y*(y*(128+y*(35*y-60))-512)/2048*E*u+y*(5*y-4)/6144*y*y*Math.sin(2*P)*A+M*Math.sin(3*P)*I+-762939453125e-16*y*y*y*y*Math.sin(4*P)*Math.cos(4*c)))),null!=l&&(e.s.Dd(s)&&e.s.Dd(o)?(c=Math.sqrt(1-C*C),l.u=Math.acos(c),0>d&&(l.u*=-1)):e.s.$(e.s.R(s),1.570796326794897)?l.u=0>s?n:e.F.ca(3.141592653589793-n):(a=C/i,g=Math.sqrt(1-a*a),0>i*w-v*b*Math.cos(_)&&(g*=-1),l.u=Math.atan2(a,g),e.s.$(s,-o)&&e.s.R(e.F.ca(r-n))>3.141592653589793*(1-f*Math.cos(s))&&(0<s&&1.570796326794897>e.s.R(l.u)||0>s&&1.570796326794897<e.s.R(l.u))&&(l.u=e.s.Mb(3.141592653589793,l.u)-l.u))),null!=h&&(e.s.Dd(s)&&e.s.Dd(o)?(c=Math.sqrt(1-C*C),h.u=Math.acos(c),0<=d&&(h.u*=-1)):e.s.$(e.s.R(o),1.570796326794897)?h.u=0>o?r:e.F.ca(3.141592653589793-r):(d=C/b,a=Math.sqrt(1-d*d),g=Math.sin(_/2),0>Math.sin(m-t)-2*i*w*g*g&&(a*=-1),h.u=Math.atan2(d,a),h.u=e.F.ca(h.u+3.141592653589793),e.s.$(s,-o)&&!e.s.Dd(s)&&!e.s.$(e.s.R(s),1.570796326794897)&&e.s.R(e.F.ca(r-n))>3.141592653589793*(1-f*Math.cos(s))&&(null!=l?g=l.u:(a=C/i,g=Math.sqrt(1-a*a),0>i*w-v*b*Math.cos(_)&&(g*=-1),g=Math.atan2(a,g),e.s.$(s,-o)&&e.s.R(e.F.ca(r-n))>3.141592653589793*(1-f*Math.cos(s))&&(0<s&&1.570796326794897>e.s.R(g)||0>s&&1.570796326794897<e.s.R(g))&&(g=e.s.Mb(3.141592653589793,g)-g)),1.570796326794897>=e.s.R(g)&&1.570796326794897<e.s.R(h.u)||1.570796326794897<=e.s.R(g)&&1.570796326794897>e.s.R(h.u))&&(h.u=-1*e.F.ca(h.u+3.141592653589793))))}}}},t.sf=function(t,i,r,s,n,o,a,l){if(null!=a||null!=l)if(e.s.ui(i))e.Zg.sf(t,r,s,n,o,a,l);else if(o=e.F.ca(o),e.s.$(e.s.R(s),1.570796326794897)||e.s.Dd(o)||e.s.$(e.s.R(o),3.141592653589793))e.Xk.sf(t,i,r,s,n,o,a,l);else{var h=1.570796326794897==e.s.R(o)?0:Math.cos(o),c=3.141592653589793==e.s.R(o)?0:Math.sin(o);e.s.$(e.s.R(s),1.570796326794897)&&(r=0),o=1-Math.sqrt(1-i);var u=e.F.Xq(i,s);s=1.570796326794897==e.s.R(u)?0:Math.cos(u);var p=Math.sin(u);u=Math.atan2(Math.tan(u),h);var d=s*c,f=d*d,y=1-f,g=i/(1-i)*y,m=(i=g*(256+g*(g*(74-47*g)-128))/1024)/4,v=i/6,b=n/(t*(1-o)*(1+g*(4096+g*(g*(320-175*g)-768))/16384)),w=b;do{var _=w;n=1.570796326794897==e.s.R(w)?0:Math.cos(w);var x=(g=3.141592653589793==e.s.R(w)?0:Math.sin(w))*g;w=i*g*((t=Math.cos(2*u+w))+m*(n*(2*(w=t*t)-1)-v*t*(4*x-3)*(4*w-3)))+b}while(!e.s.$(_,w));n=1.570796326794897==e.s.R(w)?0:Math.cos(w),g=3.141592653589793==e.s.R(w)?0:Math.sin(w),null!=a&&(c=Math.atan2(g*c,s*n-p*g*h),y=o/16*y*(4+o*(4-3*y)),t=Math.cos(2*u+w),a.u=e.F.ca(r+(c-(1-y)*o*d*(w+y*g*(t+y*n*(2*t*t-1)))))),null!=l&&(y=p*g-s*n*h,y=(1-o)*Math.sqrt(f+y*y),l.u=Math.atan2(p*n+s*g*h,y))}},t}()}($||($={})),function(e){e.HC=function(){function t(){}return t.ub=function(t,i,r,s,n,o,a,l,h){var c=e.F.ca(n-r),u=e.s.$(e.s.R(s),1.570796326794897),p=e.s.$(e.s.R(o),1.570796326794897);if(e.s.$(s,o)&&(e.s.Dd(c)||u))null!=a&&(a.u=0),null!=l&&(l.u=0),null!=h&&(h.u=0);else{if(e.s.ui(i)){var d=Math.sin(s),f=Math.sin(o);d=Math.sqrt((1+d)/(1-d)),f=Math.sqrt((1+f)/(1-f)),d=Math.log(f)-Math.log(d),d=Math.atan2(c,d),null!=a&&(a.u=e.s.$(s,o)?e.s.R(t*Math.cos(s)*c):e.s.R((t*o-t*s)/Math.cos(d)))}else f=e.F.Rw(i,o),d=Math.sin(e.F.Rw(i,s)),f=Math.sin(f),d=Math.sqrt((1+d)/(1-d)),f=Math.sqrt((1+f)/(1-f)),d=Math.log(f)-Math.log(d),d=Math.atan2(c,d),null!=a&&(e.s.$(s,o)?a.u=e.s.R(t*c*Math.cos(s)/e.F.w(i,s)):(c=e.F.q(t,i,s),t=e.F.q(t,i,o),a.u=e.s.R((t-c)/Math.cos(d))));null==l&&null==h||(a=e.F.ca(d+3.141592653589793),u&&p||!u&&!p||(u?d=0>s?n:e.F.ca(3.141592653589793-n):p&&(a=0>o?r:e.F.ca(3.141592653589793-r))),null!=l&&(l.u=d),null!=h&&(h.u=a))}},t.sf=function(t,i,r,s,n,o,a,l){o=e.F.ca(o),0>n&&(n=e.s.R(n),o=e.F.ca(o+3.141592653589793)),e.s.ui(i)?e.s.$(e.s.R(s),1.570796326794897)?(r=0>s?o:e.F.ca(3.141592653589793-o),3.141592653589793>=(o=n/t%6.283185307179586)?t=s-e.s.Mb(o,s):(r=e.F.ca(r+3.141592653589793),t=-s+e.s.Mb(o-3.141592653589793,s))):e.s.$(e.s.R(o),1.570796326794897)?(r=e.F.ca(r+e.s.Mb(n,o)/(t*Math.cos(s))),t=s):(t=s+n*Math.cos(o)/t,1.570796326794897<e.s.R(t)&&(t=1.570796326794897),e.s.$(e.s.R(t),1.570796326794897)&&(e.s.Dd(o)||e.s.$(e.s.R(o),3.141592653589793))||(1.570796316258184<e.s.R(t)&&(t=e.s.Mb(1.570796316258184,t)),i=Math.sin(s),s=Math.sin(t),i=Math.sqrt((1+i)/(1-i)),s=Math.sqrt((1+s)/(1-s)),i=Math.log(s)-Math.log(i),r=e.F.ca(r+Math.tan(o)*i))):e.s.$(e.s.R(s),1.570796326794897)?(r=0>s?o:e.F.ca(3.141592653589793-o),o=n/e.F.gW(t,i),3.141592653589793>=(o%=6.283185307179586)?t=s-e.s.Mb(o,s):(r=e.F.ca(r+3.141592653589793),t=-s+e.s.Mb(o-3.141592653589793,s)),t=e.F.Tq(i,t)):e.s.$(e.s.R(o),1.570796326794897)?(r=e.F.ca(r+e.s.Mb(n,o)*e.F.w(i,s)/(t*Math.cos(s))),t=s):(t=1.570796326794897*(n*Math.cos(o)+e.F.q(t,i,s))/e.F.Bh(t,i),1.570796326794897<e.s.R(t)&&(t=e.s.Mb(1.570796326794897,t)),t=e.F.Tq(i,t),e.s.$(e.s.R(t),1.570796326794897)&&(e.s.Dd(o)||e.s.$(e.s.R(o),3.141592653589793))||(n=e.F.Rw(i,s),s=e.F.Rw(i,t),1.570796316258184<e.s.R(s)&&(s=e.s.Mb(1.570796316258184,t),t=e.F.qO(i,s)),i=Math.sin(n),s=Math.sin(s),i=Math.sqrt((1+i)/(1-i)),s=Math.sqrt((1+s)/(1-s)),i=Math.log(s)-Math.log(i),r=e.F.ca(r+Math.tan(o)*i))),null!=a&&(a.u=r),null!=l&&(l.u=t)},t}()}($||($={})),function(e){e.kb=function(){function t(){}return t.Sy=function(t,i,r,s,n,o,a){e.du.ub(t,i,r,s,n,o,null,a,null)},t.zi=function(t,i,r,s,n,o,a,l){e.du.sf(t,i,r,s,n,o,a,l)},t.xd=function(t,i,r,s,n,o,a,l,h,c){switch(c){case 2:e.Xk.ub(t,i,r,s,n,o,a,l,h);break;case 3:e.IC.ub(t,i,r,s,n,o,a,l,h);break;case 1:e.HC.ub(t,i,r,s,n,o,a,l,h);break;default:e.du.ub(t,i,r,s,n,o,a,l,h)}},t.pj=function(t,i,r,s,n,o,a,l,h){switch(h){case 2:e.Xk.sf(t,i,r,s,n,o,a,l);break;case 3:e.IC.sf(t,i,r,s,n,o,a,l);break;case 1:e.HC.sf(t,i,r,s,n,o,a,l);break;default:e.du.sf(t,i,r,s,n,o,a,l)}},t}()}($||($={})),function(e){var t=function(){function t(){this.y=this.x=null}return t.construct=function(i){var r=new t;return r.x=new e.Xb,r.x.set(i.x),r.y=new e.Xb,r.y.set(i.y),r},t.NE=function(i,r){var s=new t;return s.x=new e.Xb,s.x.set(i),s.y=new e.Xb,s.y.set(r),s},t.prototype.qg=function(){return this.x.qg()&&this.y.qg()},t.prototype.value=function(){return e.h.construct(this.x.value(),this.y.value())},t}();e.jY=t;var i=function(){function t(){this.z=this.y=this.x=null}return t.construct=function(i){var r=new t;return r.x=new e.Xb,r.x.set(i.x),r.y=new e.Xb,r.y.set(i.y),r.z=new e.Xb,r.z.set(i.z),r},t.NE=function(i,r,s){var n=new t;return n.x=new e.Xb,n.x.set(i),n.y=new e.Xb,n.y.set(r),n.z=new e.Xb,n.z.set(s),n},t.prototype.qg=function(){return this.x.qg()&&this.y.qg()&&this.z.qg()},t.prototype.value=function(){return new e.Od(this.x.value(),this.y.value(),this.z.value())},t.prototype.Rh=function(t){var i=new e.Xb,r=new e.Xb,s=new e.Xb;return i.Ml(this.x,t.x),r.Ml(this.y,t.y),s.Ml(this.z,t.z),(t=new e.Xb).WM(i,r),t.add(s),t},t.prototype.VE=function(i){var r=new t;r.x.Ml(this.y,i.z),r.y.Ml(this.z,i.x),r.z.Ml(this.x,i.y);var s=new e.Xb,n=new e.Xb,o=new e.Xb;return s.Ml(this.z,i.y),n.Ml(this.x,i.z),o.Ml(this.y,i.x),r.x.sub(s),r.y.sub(n),r.z.sub(o),r},t}();e.kY=i,e.Mx=function(){function r(){}return r.wP=function(e,t,i){var s=t.x;t=t.y,r.dl(1,e,Math.cos(s),Math.sin(s),Math.cos(t),Math.sin(t),i)},r.vP=function(t,i){var s=new e.Od;return r.wP(t,i,s),s},r.dl=function(e,t,i,r,s,n,o){e/=Math.sqrt(1-t*n*n),o.L(e*s*i,e*s*r,e*(1-t)*n)},r.Zu=function(t,r){var s=new e.Xb,n=new e.Xb,o=new e.Xb,a=new e.Xb;s.cos(r.x),n.sin(r.x),o.cos(r.y),a.sin(r.y);var l=new e.Xb;return l.set(a),l.Ag(a),l.Oo(t),l.Oo(-1),l.cN(),l.sqrt(),(r=new e.Xb).set(1),r.lm(l),(l=new e.Xb).set(r),l.Ag(o),l.Ag(s),(s=new e.Xb).set(r),s.Ag(o),s.Ag(n),(n=new e.Xb).set(r),n.Oo(1-t),n.Ag(a),i.NE(l,s,n)},r.IS=function(i,s,n,o){if(Math.abs(s.x-n.x)>Math.PI||Math.abs(s.y)>.5*Math.PI||Math.abs(n.y)>.5*Math.PI||(Math.abs(s.y)==.5*Math.PI||Math.abs(n.y)==.5*Math.PI)&&s.x!=n.x)return NaN;if(o=r.XA(o,Math.min(s.x,n.x),Math.max(s.x,n.x)),!new e.Oc(s.x,n.x).contains(o))return NaN;var a=t.construct(s);if(n=t.construct(n),a=r.Zu(i,a),n=r.Zu(i,n),(n=a.VE(n)).z.qg())return s.y;var l=new e.Xb;l.set(n.x),l.lm(n.z),l.Oo(-1);var h=new e.Xb;h.set(n.y),h.lm(n.z),h.Oo(-1);var c=new e.Xb;return c.set(h),c.Ag(h),(a=new e.Xb).set(l),a.Ag(l),a.add(c),a.sqrt(),a.qg()||l.qg()&&h.qg()?s.y:(s=Math.atan2(h.value(),l.value()),s=Math.atan2(a.value()*Math.cos(s-o),1-i),o=r.vP(i,e.h.construct(o,s)),i=new e.Od(o.x,o.y,-o.z),o=n.value().Rh(o),i=n.value().Rh(i),Math.abs(i)<Math.abs(o)&&(s=-s),s)},r.Jz=function(i,s,n,o,a){if(a[0]=NaN,a[1]=NaN,Math.abs(s.x-n.x)>Math.PI||Math.abs(s.y)>.5*Math.PI||Math.abs(n.y)>.5*Math.PI||(Math.abs(s.y)==.5*Math.PI||Math.abs(n.y)==.5*Math.PI)&&s.x!=n.x||Math.abs(o)>=.5*Math.PI||0<s.y&&0<n.y&&s.y>o&&n.y>o||0>s.y&&0>n.y&&s.y<o&&n.y<o)return 0;var l=t.construct(s),h=t.construct(n);l=r.Zu(i,l),h=r.Zu(i,h);var c=l.VE(h);if(c.z.qg())return new e.Oc(s.y,n.y).contains(o)?(a[0]=s.x,1):0;(h=new e.Xb).set(c.x),h.lm(c.z),h.Oo(-1),(l=new e.Xb).set(c.y),l.lm(c.z),l.Oo(-1),(c=new e.Xb).set(l),c.Ag(l);var u=new e.Xb;return u.set(h),u.Ag(h),u.add(c),u.sqrt(),u.qg()||h.qg()&&l.qg()?0==o?(a[0]=s.x,a[1]=n.x,2):0:(i=(1-i)*Math.tan(o)/u.value(),1<Math.abs(i)?0:(i=Math.acos(i),c=Math.atan2(l.value(),h.value()),h=Math.min(s.x,n.x),l=Math.max(s.x,n.x),n=r.XA(c-i,h,l),i=0!=o?r.XA(c+i,h,l):n,o=0,h<=n&&n<=l&&(a[o]=n,o++),i!=n&&h<=i&&i<=l&&(a[o]=i,2==++o&&Math.abs(a[0]-s.x)>Math.abs(a[1]-s.x)&&(s=a[0],a[0]=a[1],a[1]=s)),o))},r.XA=function(e,t,i){return e>i?e-=2*(t=Math.ceil((e-i)/(2*Math.PI)))*Math.PI:e<t&&(e+=2*(t=Math.ceil((t-e)/(2*Math.PI)))*Math.PI),e},r}()}($||($={})),function(e){e.PK=function(){function t(){}return t.OX=function(i,r){var s=[0,0,0,0],n=new e.h;n.N(r),n.scale(9102==e.cb.tc(i).Id().Fc()?1:e.cb.tc(i).Id().bi/3.141592653589793*180),-180>n.x?(n.x-=n.x%360,-180>n.x&&(n.x+=360)):180<n.x&&(n.x-=n.x%360,180<n.x&&(n.x-=360)),90<n.y&&(n.y=90),-90>n.y&&(n.y=-90);for(var o=-180,a=180,l=(i=40)-1,h=(r=(i+31)/32)-1;0<=h;h--)for(var c=l-32*h,u=Math.min(32,i-32*h),p=1;p<u;p+=2){var d=.5*(a+o);n.x>=d?(s[h]|=1<<c,o=d):a=d,c-=2,l-=2}for(o=-90,a=90,l=i-2,h=r-1;0<=h;h--)for(c=l-32*h,u=Math.min(32,i-32*h),p=0;p<u;p+=2)d=.5*(a+o),n.y>=d?(s[h]|=1<<c,o=d):a=d,c-=2,l-=2;return t.SP(s,8,8)},t.SP=function(e,t,i){for(var r=[],s=0;s<t;s++)r[s]="";for(var n=s=0,o=0;o<t;o++){var a=e[s]>>n&31;if(31<(n+=5)){var l=37-n;a&=(1<<l)-1,n-=32,a|=(e[++s]&(1<<n)-1)<<l}r[t-1-o]="0123456789bcdefghjkmnpqrstuvwxyz".split("")[a]}if(i>t)for(o=0;o<i-t;o++)r.push("0");else i<t&&(r.length=i);return r.join("")},t}()}($||($={})),function(e){var t={gcstol:[0,2e-9,1,2.241706620489156e-9,2,2.313672246530541e-9,3,8.98240164660333e-9,4,8.982433838020134e-9,5,8.982439417325895e-9,6,8.982466029667677e-9,7,8.982476760268133e-9,8,8.982492642167149e-9,9,8.98251968292634e-9,10,8.98253685210448e-9,11,8.982546725256576e-9,12,8.982557456049832e-9,13,8.98257333682596e-9,14,8.982575482995276e-9,15,8.982578488197342e-9,16,8.982579775336987e-9,17,8.9825840676828e-9,18,8.982599090925448e-9,19,8.982605529473397e-9,20,8.982609220517402e-9,21,8.982611968030573e-9,22,8.982616260407152e-9,23,8.982620552787834e-9,24,8.982633429954492e-9,25,8.982637722351582e-9,26,8.98264416095491e-9,27,8.982646307158072e-9,28,8.982654891980968e-9,29,8.982667769246082e-9,30,8.982674207892485e-9,31,8.982680646548117e-9,32,8.982682792768713e-9,33,8.982685798042582e-9,34,8.982689231436652e-9,35,8.98269137766135e-9,36,8.98269266624163e-9,37,8.982705114087017e-9,38,8.982706830791106e-9,39,8.982711958374661e-9,40,8.982712839964735e-9,41,8.982717991496125e-9,42,8.982721424914803e-9,43,8.982723571154887e-9,44,8.982727863638127e-9,45,8.982730868942154e-9,46,8.982734302370678e-9,47,8.982745033612112e-9,48,8.982751472369276e-9,49,8.982755764879183e-9,50,8.982762203651733e-9,51,8.982764776628385e-9,52,8.982766496171896e-9,53,8.98277722749025e-9,54,8.98278152002477e-9,55,8.98279933943848e-9,56,8.9829143024805e-9,57,8.982922161948598e-9,58,8.98292327314211e-9,59,8.982925667349601e-9,60,8.982932222965576e-9,61,8.982961298941316e-9,62,8.982965524049989e-9,63,8.982994818246099e-9,64,8.982994895706967e-9,65,8.98299489597736e-9,66,8.983000733443498e-9,67,8.983055097289157e-9,68,8.983064111047368e-9,69,8.983111996941178e-9,70,8.983120447446023e-9,71,8.98312748954554e-9,72,8.983134531656096e-9,73,8.983141573777694e-9,74,8.983148615910332e-9,75,8.983152841195215e-9,76,8.983153545409748e-9,77,8.983153827095593e-9,78,8.98315396793852e-9,79,8.983154249624393e-9,80,8.983155658054012e-9,81,8.983960794340072e-9,82,8.984061344391998e-9,83,8.984072829255685e-9,84,8.984194981201908e-9,85,8.984275233099427e-9,86,8.984326127007554e-9,87,8.984330099816539e-9,88,8.98433275258421e-9,89,8.984333047023206e-9,90,8.984333885258723e-9,91,8.984337959508212e-9,92,8.984365176209457e-9,93,8.984727360418079e-9,94,8.984901041679577e-9,95,8.98542662091587e-9,96,8.98610024130669e-9,97,8.992894229037531e-9,98,8.993203677616635e-9,99,8.993206178094346e-9,100,8.993216059187305e-9,101,8.99322029394808e-9,102,8.994627867045891e-9,103,9.467559984315793e-9,104,9.46881168618118e-9,105,9.980888154931644e-9,106,9.981105353606775e-9,107,9.983807356573187e-9,108,1.687060485811522e-8,109,1.688447560354875e-8,110,2.176606011487185e-8,111,2.225078816042032e-8,112,2.348476432064694e-8,113,2.348765250187846e-8,114,2.378108974103778e-8,115,3.14559636297708e-8,116,3.297788621680806e-8,117,3.667892343788279e-8,118,4.235973644320739e-8,119,4.794625900676345e-8,120,7.262742998235812e-8,121,7.499447580246377e-8,122,7.525056410964318e-8,123,7.979913581209237e-8,124,9.662020153976783e-8,125,9.799175562353741e-8,126,9.897353517547472e-8,127,1.02313891987647e-7,128,1.081460541960784e-7,129,1.21905913857622e-7,130,2.246893314238523e-7,131,2.297344808062643e-7,132,2.42984645941825e-7,133,2.754604784282804e-7,134,2.884548130346993e-7,135,3.370339971357784e-7,136,4.307953346848296e-7,137,5.208707228462029e-7,138,5.509209568565608e-7,139,6.452227422644406e-7,140,6.740679942715567e-7,141,6.861770001566745e-7,142,7.252630318111686e-7,143,7.441010326374328e-7,144,7.742672907173287e-7,145,9.629542775307953e-7,146,1061032953945969e-21,147,1143628333594458e-21,148,1162186197019925e-21,149,136418522650196e-20,150,1367441038498385e-21,151,1432394487827058e-21,152,1736235742820677e-21,153,1848250952034914e-21,154,1909859317102744e-21,155,1975716534933873e-21,156,2122065907891938e-21,157,272837045300392e-20,158,3183098861837907e-21,159,3580986219567645e-21,160,3819718634205488e-21,161,409255567950588e-20,162,4407367654852486e-21,163,4774648292756861e-21,164,5161781938115525e-21,165,520870722846203e-20,166,5729577951308232e-21,167,6031134685587613e-21,168,6987290184522236e-21,169,9241254760174569e-21,170,1145915590261646e-20],pcstol:[0,6.666666666666667e-9,1,2e-8,2,4970973863636364e-20,3,4970978156565657e-20,4,4970980410559237e-20,5,.001,6,.001093615055555556,7,.001093615194444445,8,.001093619003239988,9,.001093623110088878,10,.003280833333333333,11,.003280839895013123,12,.003280843014596366,13,.003280845583333334,14,.003280869330266636,15,.00497101413676763],newtoold:[2154,102110,2195,102200,2204,32036,2205,26979,2225,102641,2226,102642,2227,102643,2228,102644,2229,102645,2230,102646,2231,102653,2232,102654,2233,102655,2234,102656,2235,102657,2236,102658,2237,102659,2238,102660,2239,102666,2240,102667,2241,102668,2242,102669,2243,102670,2246,102679,2247,102680,2248,102685,2249,102686,2250,102687,2254,102694,2255,102695,2257,102712,2258,102713,2259,102714,2260,102715,2261,102716,2262,102717,2263,102718,2264,102719,2267,102724,2268,102725,2271,102728,2272,102729,2274,102736,2275,102737,2276,102738,2277,102739,2278,102740,2279,102741,2283,102746,2284,102747,2285,102748,2286,102749,2287,102752,2288,102753,2289,102754,2312,23433,2326,102140,2395,2091,2396,2092,2397,2166,2398,2167,2399,2168,2759,102229,2760,102230,2761,102248,2762,102249,2763,102250,2764,102251,2765,102252,2766,102241,2767,102242,2768,102243,2769,102244,2770,102245,2771,102246,2772,102253,2773,102254,2774,102255,2775,102256,2776,102257,2777,102258,2778,102259,2779,102260,2780,102266,2781,102267,2782,102261,2783,102262,2784,102263,2785,102264,2786,102265,2787,102268,2788,102269,2789,102270,2790,102271,2791,102272,2792,102273,2793,102274,2794,102275,2795,102276,2796,102277,2797,102278,2798,102279,2799,102280,2800,102281,2801,102282,2802,102283,2803,102284,2804,102285,2805,102286,2806,102287,2807,102288,2808,102289,2809,102290,2810,102291,2811,102292,2812,102293,2813,102294,2814,102295,2815,102296,2816,102297,2817,102298,2818,102300,2819,102304,2820,102307,2821,102308,2822,102309,2823,102310,2824,102311,2825,102312,2826,102313,2827,102314,2828,102315,2829,102316,2830,102317,2831,102318,2832,102320,2833,102321,2834,102322,2835,102323,2836,102324,2837,102325,2838,102326,2839,102327,2840,102330,2841,102334,2842,102335,2843,102336,2844,102337,2845,102338,2846,102339,2847,102340,2848,102341,2849,102342,2850,102343,2851,102344,2852,102345,2853,102346,2854,102347,2855,102348,2856,102349,2857,102350,2858,102351,2859,102352,2860,102353,2861,102354,2862,102355,2863,102356,2864,102357,2865,102358,2866,102361,2942,102167,2943,102169,2944,2139,2945,2140,2946,2141,2947,2142,2948,2143,2949,2144,2950,2145,2951,2146,2952,2147,2953,2036,2954,2291,2955,2153,2956,2152,2957,2151,2958,2150,2959,2149,2960,2037,2961,2038,2962,2148,2965,2244,2966,2245,3003,102091,3004,102092,3005,102190,3060,2982,3067,102139,3072,102606,3074,102608,3075,102208,3077,102210,3078,102123,3080,102119,3081,102603,3082,102602,3083,102601,3088,65163,3089,102763,3090,102363,3092,102151,3093,102152,3094,102153,3095,102154,3096,102155,3097,102145,3098,102146,3099,102147,3100,102148,3101,102149,3102,2155,3107,102172,3110,102170,3111,102171,3119,2214,3158,102234,3159,102235,3160,102236,3336,2979,3338,102006,3346,2600,3370,102126,3371,102127,3372,102130,3373,102131,3389,2577,3390,2694,3400,102184,3401,102185,3404,3359,3407,3366,3417,102675,3418,102676,3419,102677,3420,102678,3421,102707,3422,102708,3423,102709,3424,102711,3433,102651,3434,102652,3435,102671,3436,102672,3437,102710,3438,102730,3448,102095,3451,102681,3452,102682,3455,102735,3461,2063,3462,2064,3463,3073,3464,3076,3560,102742,3566,102743,3567,102744,3734,102722,3735,102723,3736,102755,3737,102756,3738,102757,3739,102758,3741,102205,3742,102206,3743,102207,3748,102211,3750,102202,3751,102203,3759,102663,3760,102463,3764,102112,3770,102090,3771,102180,3772,102181,3773,102182,3775,102186,3776,102187,3777,102188,3800,102183,3801,102189,3812,102199,3814,102609,3815,102469,3819,104990,3821,104136,3824,104137,3825,102444,3826,102443,3827,102442,3828,102441,3857,102100,3889,104991,3906,104992,4048,103201,4049,103202,4050,103203,4051,103204,4056,103205,4057,103206,4058,103207,4059,103208,4060,103209,4061,103210,4062,103211,4063,103212,4071,103213,4082,103214,4083,103215,4093,103216,4094,103217,4095,103218,4096,103219,4167,104108,4169,37252,4171,104107,4189,104110,4197,4234,4223,37223,4304,104304,4414,102201,4415,102762,4417,102764,4434,102765,4437,102647,4455,32029,4456,32018,4457,3454,4462,102439,4463,4466,4470,4469,4484,103794,4485,103795,4486,103796,4487,103797,4488,103798,4489,103799,4611,104104,4612,104111,4613,37255,4615,37247,4616,37250,4617,4140,4618,4291,4620,37211,4626,37235,4647,102362,4658,37204,4668,37201,4669,4126,4672,37217,4673,104125,4675,37220,4684,37232,4698,4631,4707,37213,4708,37231,4709,37212,4710,37238,4711,37214,4712,37237,4713,37208,4714,37215,4715,37253,4716,37216,4717,37239,4719,37219,4722,37242,4724,37233,4725,37222,4727,37224,4728,37246,4729,37226,4730,37227,4731,37228,4732,37229,4733,37230,4734,37251,4735,37259,4736,37254,4739,37205,4758,104133,4760,37001,4762,104114,4826,102214,5013,104142,5014,102331,5015,102332,5016,102333,5173,102085,5174,102086,5175,102087,5176,102088,5177,102089,5178,102040,5179,102080,5185,102081,5186,102082,5187,102083,5188,102084,5221,102066,5246,104100,5247,102490,5324,104144,5325,102420,5329,2934,5365,104143,5367,102305,5451,104132,5513,102065,5514,102067,5519,102111,5520,31461,5646,102745,5839,5388,5858,5532,5879,4474,6207,104256,6244,102769,6245,102790,6246,102770,6247,102771,6248,102793,6249,102796,6250,102772,6251,102788,6252,102775,6253,102795,6254,102781,6255,102767,6256,102774,6257,102768,6258,102797,6259,102789,6260,102780,6261,102783,6262,102787,6263,102791,6264,102777,6265,102798,6266,102779,6267,102784,6268,102792,6269,102782,6270,102785,6271,102794,6272,102773,6273,102778,6274,102786,6275,102776,6311,104141,6318,104145,6322,104287,6325,104286,6328,102046,6329,102047,6330,102048,6331,102049,6332,102050,6333,102051,6334,102052,6335,102053,6336,102054,6337,102055,6338,102056,6339,102057,6340,102058,6341,102059,6342,102382,6343,102383,6344,102384,6345,102385,6346,102386,6347,102387,6348,102388,6350,102965,6355,102975,6356,102976,6391,6141,6393,102966,6394,102977,6395,102978,6396,102979,6397,102980,6398,102981,6399,102982,6400,102983,6401,102984,6402,102985,6403,102986,6404,102988,6405,102991,6406,102987,6407,102990,6408,102989,6409,102992,6410,102993,6411,102995,6412,102994,6413,102996,6414,102962,6415,102997,6416,103003,6417,102998,6418,103004,6419,102999,6420,103005,6421,103e3,6422,103006,6423,103001,6424,103007,6425,103002,6426,103008,6427,103010,6428,103013,6429,103009,6430,103012,6431,103011,6432,103014,6433,103015,6434,103016,6435,103017,6436,103018,6437,103019,6438,103022,6439,102967,6440,103021,6441,103024,6442,103020,6443,103023,6444,103025,6445,103027,6446,103026,6447,103028,6448,103030,6449,103033,6450,103029,6451,103032,6452,103031,6453,103034,6454,103035,6455,103037,6456,103036,6457,103038,6458,103039,6459,103041,6460,103040,6461,103042,6462,103043,6463,103045,6464,103044,6465,103046,6466,103047,6467,103049,6468,103048,6469,103050,6470,103051,6471,103052,6472,103053,6473,103054,6474,103055,6475,103056,6476,103057,6477,103059,6478,103058,6479,103060,6480,103066,6481,103065,6482,103067,6483,103061,6484,103063,6485,103062,6486,103064,6487,103068,6488,103069,6489,103071,6490,103073,6491,103070,6492,103072,6493,103075,6494,103078,6495,103074,6496,103077,6497,102968,6498,103076,6499,103079,6500,103081,6501,103084,6502,103080,6503,103083,6504,103082,6505,103085,6506,103086,6507,103088,6508,102963,6509,103087,6510,103089,6511,103091,6512,103090,6513,103092,6514,103093,6515,103094,6516,103095,6518,103098,6519,103101,6520,103097,6521,103100,6522,103099,6523,103102,6524,103103,6525,103104,6526,103105,6527,103106,6528,103108,6529,103111,6530,103107,6531,103110,6532,103109,6533,103112,6534,103114,6535,103118,6536,103113,6537,103117,6538,103116,6539,103120,6540,103115,6541,103119,6542,103121,6543,103122,6544,103123,6545,103125,6546,103124,6547,103126,6548,103127,6549,103129,6550,103128,6551,103130,6552,103131,6553,103133,6554,103132,6555,103134,6556,102969,6557,102970,6558,103135,6559,103137,6560,103136,6561,103138,6562,103139,6563,103140,6564,103141,6565,103142,6566,103200,6567,103143,6568,103144,6569,103145,6570,103146,6571,103147,6572,103149,6573,103148,6574,103150,6575,103151,6576,103152,6577,103155,6578,103160,6579,102971,6580,102972,6581,103153,6582,103158,6583,103154,6584,103159,6585,103157,6586,103162,6587,103156,6588,103161,6589,103172,6590,103173,6592,103174,6593,103176,6594,103175,6595,103177,6596,103178,6597,103180,6598,103179,6599,103181,6600,103182,6601,103184,6602,103183,6603,103185,6605,103190,6606,103186,6607,103189,6608,103188,6609,103191,6610,102973,6611,103192,6612,103196,6613,103193,6614,103197,6615,103195,6616,103199,6617,103194,6618,103198,6619,103164,6620,103163,6621,103165,6625,103170,6626,103169,6627,103171,6628,102520,6629,102521,6630,102522,6631,102523,6632,102524,6633,102527,6634,102493,6635,102494,6636,102496,6637,102495,6668,104020,6669,102610,6670,102611,6671,102612,6672,102613,6673,102614,6674,102615,6675,102616,6676,102617,6677,102618,6678,102619,6679,102620,6680,102621,6681,102622,6682,102623,6683,102624,6684,102625,6685,102626,6686,102627,6687,102628,6688,102593,6689,102594,6690,102595,6691,102596,6692,102597,6783,104223,6784,102530,6785,102500,6788,102532,6789,102502,6792,102533,6793,102503,6796,102531,6797,102501,6800,102534,6801,102504,6804,102535,6805,102505,6808,102536,6809,102506,6812,102537,6813,102507,6816,102538,6817,102508,6820,102539,6821,102509,6824,102540,6825,102510,6828,102541,6829,102511,6832,102542,6833,102512,6836,102543,6837,102513,6840,102544,6841,102514,6844,102546,6845,102516,6848,102545,6849,102515,6852,102547,6853,102517,6856,102548,6857,102518,6860,102549,6861,102519,6867,102380,6868,102381,6879,103187,6880,103096,6884,102376,6885,102378,6886,102377,6887,102379,7136,6980,7139,6987,7142,102706,7692,102557,7693,102558,7694,102559,7695,102560,7696,102561,8090,103318,8091,103418,8092,103317,8093,103417,8095,103371,8096,103471,8097,103369,8098,103469,8099,103368,8100,103468,8101,103367,8102,103467,8103,103366,8104,103466,8105,103365,8106,103465,8107,103364,8108,103464,8109,103363,8110,103463,8111,103362,8112,103462,8113,103361,8114,103461,8115,103360,8116,103460,8117,103359,8118,103459,8119,103357,8120,103457,8121,103356,8122,103456,8123,103355,8124,103455,8125,103354,8126,103454,8127,103353,8128,103453,8129,103352,8130,103452,8131,103350,8132,103450,8133,103349,8134,103449,8135,103348,8136,103448,8139,103343,8140,103443,8141,103342,8142,103442,8143,103341,8144,103441,8145,103339,8146,103439,8147,103337,8148,103437,8149,103336,8150,103436,8151,103334,8152,103434,8153,103333,8154,103433,8155,103331,8156,103431,8161,103326,8162,103426,8163,103325,8164,103425,8165,103324,8166,103424,8171,103321,8172,103421,8173,103320,8177,103420,8179,103316,8180,103416,8181,103315,8182,103415,8184,103314,8185,103414,8191,103312,8193,103412,8196,103311,8197,103411,8198,103310,8200,103410,8201,103309,8202,103409,8203,103308,8204,103408,8207,103306,8208,103406,8209,103305,8210,103405,8212,103304,8213,103404,8214,103303,8216,103403,8218,103302,8220,103402,8222,103301,8224,103401,8431,104248,8441,102590,8693,102449,8826,102605,8857,54035,8858,54036,8859,54037,8860,8449,8988,104115,8989,104116,8990,104117,8991,104118,8992,104119,8993,104120,8994,104121,8995,104122,8996,104123,8997,104124,8998,104896,8999,104257,9e3,104019,9014,104010,9019,104021,9053,104011,9054,104012,9055,104013,9056,104014,9057,104015,9059,104258,9060,104179,9061,104180,9062,104181,9063,104182,9064,104183,9065,104184,9066,104185,9067,104186,21896,21891,21897,21892,21898,21893,21899,21894,26701,102124,26702,102125,26799,26747,26847,102683,26848,102684,26849,102691,26850,102692,26851,102693,26852,102704,26853,102750,26854,102751,26857,102466,26858,102467,26859,102468,26901,102128,26902,102129,27493,27492,29101,29100,29168,29118,29169,29119,29170,29120,29171,29121,29172,29122,29187,29177,29188,29178,29189,29179,29190,29180,29191,29181,29192,29182,29193,29183,29194,29184,29195,29185,29902,29900,31279,31278,31281,31291,31282,31292,31283,31293,31284,31294,31285,31295,31286,31296,31287,31297,31466,31462,31467,31463,31468,31464,31469,31465,31986,31917,31987,31918,31988,31919,31989,31920,31990,31921,31991,31922,32064,32074,32065,32075,32066,32076,32067,32077,102550,2181,102551,2182,102552,2183,102553,2184,102554,2185,102555,2186,102556,2187],pcsid:[2066,15,2136,12,2155,10,2157,5,2158,5,2159,12,2160,12,2219,5,2220,5,2244,10,2245,10,2256,11,2265,11,2266,11,2269,11,2270,11,2273,11,2290,5,2291,5,2294,5,2295,5,2313,5,2314,14,2899,10,2900,10,2901,11,2909,11,2910,11,2911,10,2912,10,2913,11,2914,11,2964,10,2967,10,2968,10,2991,5,2992,11,2993,5,2994,11,3073,5,3076,5,3079,5,3091,10,3106,5,3108,5,3109,5,3141,5,3142,5,3167,4,3337,5,3347,5,3348,5,3359,10,3360,5,3361,11,3362,5,3363,10,3364,5,3365,10,3366,14,3402,5,3403,5,3405,5,3406,5,3439,5,3440,5,3447,5,3449,5,3450,5,3453,10,3454,10,3460,5,3479,11,3480,5,3481,11,3482,5,3483,11,3484,5,3485,10,3486,5,3487,10,3488,5,3489,5,3490,10,3491,5,3492,10,3493,5,3494,10,3495,5,3496,10,3497,5,3498,10,3499,5,3500,10,3501,5,3502,10,3503,5,3504,10,3505,5,3506,10,3507,5,3508,10,3509,5,3510,10,3511,5,3512,10,3513,5,3514,5,3515,10,3516,5,3517,10,3518,5,3519,10,3520,5,3521,10,3522,5,3523,10,3524,5,3525,10,3526,5,3527,10,3528,5,3529,10,3530,5,3531,10,3532,5,3533,10,3534,5,3535,10,3536,5,3537,10,3538,5,3539,10,3540,5,3541,10,3542,5,3543,10,3544,5,3545,10,3546,5,3547,10,3548,5,3549,10,3550,5,3551,10,3552,5,3553,10,3582,10,3583,5,3584,10,3585,5,3586,10,3587,5,3588,11,3589,5,3590,11,3591,5,3592,5,3593,11,3598,10,3599,5,3600,10,3605,11,3606,5,3607,5,3608,10,3609,5,3610,10,3611,5,3612,10,3613,5,3614,10,3615,5,3616,10,3617,5,3618,10,3619,5,3620,10,3621,5,3622,10,3623,5,3624,10,3625,5,3626,10,3627,5,3628,10,3629,5,3630,10,3631,5,3632,10,3633,5,3634,11,3635,5,3636,11,3640,10,3641,5,3642,10,3643,5,3644,11,3645,5,3646,11,3647,5,3648,11,3649,5,3650,10,3651,5,3652,10,3653,5,3654,10,3655,5,3656,11,3657,5,3658,10,3659,5,3660,10,3661,5,3662,10,3663,5,3664,10,3668,10,3669,5,3670,10,3671,5,3672,10,3673,5,3674,10,3675,5,3676,11,3677,10,3678,5,3679,11,3680,10,3681,5,3682,11,3683,10,3684,5,3685,5,3686,10,3687,5,3688,10,3689,5,3690,10,3691,5,3692,10,3696,10,3697,5,3698,10,3699,5,3700,10,3740,5,3749,5,3783,5,3784,5,3793,5,3794,5,3802,5,3816,5,3829,5,3854,5,3911,5,3912,5,3920,5,3978,5,3979,5,3991,10,3992,10,4026,5,4037,5,4038,5,4087,5,4088,5,4217,10,4438,10,4439,10,4467,5,4471,5,4474,5,4559,5,4822,5,4839,5,5018,5,5048,5,5167,5,5168,5,5223,5,5234,5,5235,5,5243,5,5266,5,5316,5,5320,5,5321,5,5330,5,5331,5,5337,5,5361,5,5362,5,5382,5,5383,5,5396,5,5456,5,5457,5,5469,5,5472,9,5490,5,5518,5,5523,5,5559,5,5588,11,5589,14,5596,5,5627,5,5629,5,5641,5,5643,5,5644,5,5654,10,5655,10,5659,5,5700,5,5825,5,5836,5,5837,5,5842,5,5844,5,5880,5,5887,5,5890,5,6128,11,6129,11,6141,11,6204,5,6210,5,6211,5,6307,5,6312,5,6316,5,6362,5,6591,5,6646,5,6703,5,6786,5,6787,11,6790,5,6791,11,6794,5,6795,11,6798,5,6799,11,6802,5,6803,11,6806,5,6807,11,6810,5,6811,11,6814,5,6815,11,6818,5,6819,11,6822,5,6823,11,6826,5,6827,11,6830,5,6831,11,6834,5,6835,11,6838,5,6839,11,6842,5,6843,11,6846,5,6847,11,6850,5,6851,11,6854,5,6855,11,6858,5,6859,11,6862,5,6863,11,6870,5,6875,5,6876,5,6915,5,6922,5,6923,10,6924,5,6925,10,6962,5,6984,5,6991,5,7128,10,7131,5,7132,10,7257,5,7258,10,7259,5,7260,10,7261,5,7262,10,7263,5,7264,10,7265,5,7266,10,7267,5,7268,10,7269,5,7270,10,7271,5,7272,10,7273,5,7274,10,7275,5,7276,10,7277,5,7278,10,7279,5,7280,10,7281,5,7282,10,7283,5,7284,10,7285,5,7286,10,7287,5,7288,10,7289,5,7290,10,7291,5,7292,10,7293,5,7294,10,7295,5,7296,10,7297,5,7298,10,7299,5,7300,10,7301,5,7302,10,7303,5,7304,10,7305,5,7306,10,7307,5,7308,10,7309,5,7310,10,7311,5,7312,10,7313,5,7314,10,7315,5,7316,10,7317,5,7318,10,7319,5,7320,10,7321,5,7322,10,7323,5,7324,10,7325,5,7326,10,7327,5,7328,10,7329,5,7330,10,7331,5,7332,10,7333,5,7334,10,7335,5,7336,10,7337,5,7338,10,7339,5,7340,10,7341,5,7342,10,7343,5,7344,10,7345,5,7346,10,7347,5,7348,10,7349,5,7350,10,7351,5,7352,10,7353,5,7354,10,7355,5,7356,10,7357,5,7358,10,7359,5,7360,10,7361,5,7362,10,7363,5,7364,10,7365,5,7366,10,7367,5,7368,10,7369,5,7370,10,7877,5,7878,5,7882,5,7883,5,7887,5,7899,5,7991,5,7992,5,8035,10,8036,10,8058,5,8059,5,8082,5,8083,5,8088,5,8137,5,8138,10,8157,5,8158,10,8159,5,8160,10,8167,5,8168,10,8169,5,8170,10,8187,5,8189,10,8205,5,8206,10,8225,5,8226,10,8311,5,8312,11,8313,5,8314,11,8315,5,8316,11,8317,5,8318,11,8319,5,8320,11,8321,5,8322,11,8323,5,8324,11,8325,5,8326,11,8327,5,8328,11,8329,5,8330,11,8331,5,8332,11,8333,5,8334,11,8335,5,8336,11,8337,5,8338,11,8339,5,8340,11,8341,5,8342,11,8343,5,8344,11,8345,5,8346,11,8347,5,8348,11,8352,5,8353,5,8379,5,8380,10,8381,5,8382,10,8383,5,8384,10,8385,5,8387,10,8391,5,8395,5,8433,5,8455,5,8456,5,8531,10,8682,5,8687,5,8692,5,8903,5,8950,5,8951,5,9039,5,9040,5,9141,5,9149,5,9150,5,9191,5,9221,5,9222,5,20499,5,20538,5,20539,5,20790,5,20791,5,21291,5,21292,5,21500,5,21817,5,21818,5,22032,5,22033,5,22091,5,22092,5,22332,5,22391,5,22392,5,22700,5,22770,5,22780,5,22832,5,23090,5,23095,5,23239,5,23240,5,23433,5,23700,5,24047,5,24048,5,24100,14,24200,5,24305,5,24306,5,24382,6,24383,5,24500,5,24547,5,24548,5,24571,2,24600,5,25e3,5,25231,5,25884,5,25932,5,26237,5,26331,5,26332,5,26591,5,26592,5,26632,5,26692,5,26855,10,26856,10,27120,5,27200,5,27291,7,27292,7,27429,5,27492,5,27500,5,27700,5,28232,5,28600,5,28991,5,28992,5,29100,5,29220,5,29221,5,29333,5,29635,5,29636,5,29701,5,29738,5,29739,5,29849,5,29850,5,29871,3,29872,13,29873,5,29900,5,29901,5,29903,5,30200,15,30339,5,30340,5,30791,5,30792,5,31028,5,31121,5,31154,5,31170,5,31171,5,31370,5,31528,5,31529,5,31600,5,31700,5,31838,5,31839,5,31901,5,32061,5,32062,5,32098,5,32099,10,32100,5,32104,5,32161,5,32766,5,53048,5,53049,5,54090,5,54091,5,65061,10,65062,10,65161,5,65163,5,102041,10,102064,8,102068,1,102069,0,102118,10,102119,11,102120,10,102121,10,102217,10,102218,5,102219,10,102220,10,102378,11,102379,11,102380,5,102381,11,102498,5,102499,5,102589,10,102590,5,102599,10,102600,10,102604,10,102605,5,102606,5,102647,5,102704,10,102705,10,102706,5,102733,10,102761,10,102762,5,102763,10,102764,5,102765,5,102766,10,102962,5,102963,5,102970,11,102974,10,102993,5,102994,5,102995,10,102996,10,103015,5,103016,10,103017,5,103018,10,103025,5,103026,5,103027,10,103028,10,103035,5,103036,5,103037,10,103038,10,103039,5,103040,5,103041,10,103042,10,103043,5,103044,5,103045,10,103046,10,103047,5,103048,5,103049,10,103050,10,103051,5,103052,10,103053,5,103054,10,103055,5,103056,10,103057,5,103058,5,103059,10,103060,10,103061,5,103062,5,103063,10,103064,10,103069,10,103070,5,103071,5,103072,10,103073,10,103086,5,103087,5,103088,10,103089,10,103094,11,103095,5,103096,10,103103,5,103104,10,103105,5,103106,10,103121,5,103122,10,103123,5,103124,5,103125,11,103126,11,103127,5,103128,5,103129,10,103130,10,103131,5,103132,5,103133,10,103134,10,103135,5,103136,5,103137,11,103138,11,103139,5,103140,10,103141,5,103142,10,103143,5,103144,10,103145,5,103146,11,103147,5,103148,5,103149,10,103150,10,103151,5,103152,10,103172,5,103173,10,103174,5,103175,5,103176,10,103177,10,103178,5,103179,5,103180,10,103181,10,103182,5,103183,5,103184,10,103185,10,103228,5,103229,5,103230,10,103231,10,103250,5,103251,10,103252,5,103253,10,103260,5,103261,5,103262,10,103263,10,103270,5,103271,5,103272,10,103273,10,103274,5,103275,5,103276,10,103277,10,103278,5,103279,5,103280,10,103281,10,103282,5,103283,5,103284,10,103285,10,103286,5,103287,10,103288,5,103289,10,103290,5,103291,10,103292,5,103293,5,103294,10,103295,10,103296,5,103297,5,103298,10,103299,10,103376,10,103377,5,103378,5,103379,10,103380,10,103393,5,103394,5,103395,10,103396,10,103472,5,103473,11,103474,5,103475,10,103482,5,103483,10,103484,5,103485,10,103500,5,103501,10,103502,5,103503,5,103504,11,103505,11,103506,5,103507,5,103508,10,103509,10,103510,5,103511,5,103512,10,103513,10,103514,5,103515,10,103516,5,103517,10,103518,5,103519,10,103520,5,103521,11,103522,5,103523,5,103524,10,103525,10,103526,5,103527,10,103561,10,103562,10,103563,5,103564,5,103565,10,103566,10,103567,5,103568,5,103569,10,103570,10,103585,10,103586,5,103587,10,103588,11,103589,5,103590,10,103591,11,103592,5,103593,10,103594,11,103695,10,103846,5,103946,10],pcsidc:[[2e3,2045,5],[2056,2065,5],[2067,2135,5],[2137,2153,5],[2161,2170,5],[2172,2193,5],[2196,2198,5],[2200,2203,5],[2206,2217,5],[2222,2224,11],[2251,2253,11],[2280,2282,11],[2308,2311,5],[2315,2325,5],[2327,2394,5],[2400,2491,5],[2494,2758,5],[2867,2869,11],[2870,2888,10],[2891,2895,10],[2896,2898,11],[2902,2908,10],[2915,2920,10],[2921,2923,11],[2924,2930,10],[2931,2941,5],[2969,2973,5],[2975,2982,5],[2984,2988,5],[2995,3002,5],[3006,3051,5],[3054,3059,5],[3061,3066,5],[3068,3071,5],[3084,3087,5],[3112,3118,5],[3120,3138,5],[3146,3151,5],[3153,3157,5],[3161,3166,5],[3168,3172,5],[3174,3203,5],[3294,3313,5],[3315,3335,5],[3339,3345,5],[3350,3358,5],[3367,3369,5],[3374,3388,5],[3391,3399,5],[3408,3416,5],[3425,3432,10],[3441,3446,10],[3456,3459,10],[3465,3478,5],[3554,3559,5],[3561,3565,10],[3568,3570,10],[3571,3581,5],[3594,3597,5],[3601,3604,5],[3637,3639,5],[3665,3667,5],[3693,3695,5],[3701,3727,5],[3728,3733,10],[3744,3747,5],[3753,3758,10],[3761,3763,5],[3765,3769,5],[3779,3781,5],[3788,3791,5],[3797,3799,5],[3832,3841,5],[3844,3852,5],[3873,3885,5],[3890,3893,5],[3942,3950,5],[3968,3970,5],[3973,3976,5],[3986,3989,5],[3994,3997,5],[4390,4398,5],[4399,4413,10],[4418,4433,10],[4491,4554,5],[4568,4589,5],[4652,4656,5],[4766,4800,5],[5069,5072,5],[5105,5130,5],[5180,5184,5],[5253,5259,5],[5269,5275,5],[5292,5311,5],[5343,5349,5],[5355,5357,5],[5387,5389,5],[5459,5463,5],[5479,5482,5],[5530,5539,5],[5550,5552,5],[5562,5583,5],[5623,5625,10],[5631,5639,5],[5649,5653,5],[5663,5680,5],[5682,5685,5],[5875,5877,5],[5896,5899,5],[5921,5940,5],[6050,6125,5],[6351,6354,5],[6366,6372,5],[6381,6387,5],[6622,6624,5],[6707,6709,5],[6720,6723,5],[6732,6738,5],[6931,6933,5],[7005,7007,5],[7057,7070,10],[7074,7082,5],[7109,7118,5],[7119,7127,11],[7374,7376,5],[7528,7586,5],[7587,7645,10],[7755,7787,5],[7791,7795,5],[7799,7801,5],[7803,7805,5],[7825,7831,5],[7845,7859,5],[8013,8032,5],[8065,8068,11],[8518,8529,10],[8533,8536,10],[8538,8540,10],[8677,8679,5],[8836,8840,5],[8908,8910,5],[9154,9159,5],[9205,9218,5],[20002,20032,5],[20062,20092,5],[20135,20138,5],[20248,20258,5],[20348,20358,5],[20436,20440,5],[20822,20824,5],[20934,20936,5],[21035,21037,5],[21095,21097,5],[21148,21150,5],[21413,21423,5],[21473,21483,5],[21780,21782,5],[21891,21894,5],[22171,22177,5],[22181,22187,5],[22191,22197,5],[22234,22236,5],[22521,22525,5],[22991,22994,5],[23028,23038,5],[23830,23853,5],[23866,23872,5],[23877,23884,5],[23886,23894,5],[23946,23948,5],[24311,24313,5],[24342,24347,5],[24370,24374,6],[24375,24381,5],[24718,24721,5],[24817,24821,5],[24877,24882,5],[24891,24893,5],[25391,25395,5],[25828,25838,5],[26191,26195,5],[26391,26393,5],[26703,26722,5],[26729,26760,10],[26766,26798,10],[26860,26870,10],[26891,26899,5],[26903,26923,5],[26929,26946,5],[26948,26998,5],[27037,27040,5],[27205,27232,5],[27258,27260,5],[27391,27398,5],[27561,27564,5],[27571,27574,5],[27581,27584,5],[27591,27594,5],[28191,28193,5],[28348,28358,5],[28402,28432,5],[28462,28492,5],[29118,29122,5],[29177,29185,5],[30161,30179,5],[30491,30494,5],[30729,30732,5],[31251,31259,5],[31265,31268,5],[31275,31278,5],[31288,31297,5],[31461,31465,5],[31491,31495,5],[31917,31922,5],[31965,31985,5],[31992,32e3,5],[32001,32003,10],[32005,32031,10],[32033,32060,10],[32074,32077,10],[32081,32086,5],[32107,32130,5],[32133,32158,5],[32164,32167,10],[32180,32199,5],[32201,32260,5],[32301,32360,5],[32601,32662,5],[32664,32667,10],[32701,32761,5],[53001,53004,5],[53008,53019,5],[53021,53032,5],[53034,53037,5],[53042,53046,5],[53074,53080,5],[54001,54004,5],[54008,54019,5],[54021,54032,5],[54034,54037,5],[54042,54046,5],[54048,54053,5],[54074,54080,5],[54098,54101,5],[102001,102040,5],[102042,102063,5],[102065,102067,5],[102070,102112,5],[102114,102117,5],[102122,102208,5],[102210,102216,5],[102221,102300,5],[102304,102377,5],[102382,102388,5],[102389,102398,10],[102399,102444,5],[102445,102447,10],[102448,102458,5],[102459,102468,10],[102469,102496,5],[102500,102519,11],[102520,102524,5],[102525,102529,10],[102530,102549,5],[102557,102588,5],[102593,102598,5],[102601,102603,5],[102608,102628,5],[102629,102646,10],[102648,102672,10],[102675,102700,10],[102701,102703,5],[102707,102730,10],[102735,102758,10],[102767,102900,5],[102965,102969,5],[102971,102973,5],[102975,102989,5],[102990,102992,11],[102997,103002,5],[103003,103008,10],[103009,103011,5],[103012,103014,10],[103019,103021,5],[103022,103024,10],[103029,103031,5],[103032,103034,10],[103065,103068,5],[103074,103076,5],[103077,103079,11],[103080,103082,5],[103083,103085,10],[103090,103093,5],[103097,103099,5],[103100,103102,10],[103107,103109,5],[103110,103112,10],[103113,103116,5],[103117,103120,10],[103153,103157,5],[103158,103162,10],[103163,103165,5],[103166,103168,11],[103169,103171,10],[103186,103188,5],[103189,103191,10],[103192,103195,5],[103196,103199,10],[103200,103224,5],[103225,103227,11],[103232,103237,5],[103238,103243,10],[103244,103246,5],[103247,103249,10],[103254,103256,5],[103257,103259,10],[103264,103266,5],[103267,103269,10],[103300,103375,5],[103381,103383,5],[103384,103386,11],[103387,103389,5],[103390,103392,10],[103397,103399,5],[103400,103471,10],[103476,103478,5],[103479,103481,10],[103486,103488,5],[103489,103491,10],[103492,103495,5],[103496,103499,10],[103539,103543,5],[103544,103548,10],[103549,103551,5],[103552,103554,11],[103555,103557,10],[103558,103560,5],[103571,103573,5],[103574,103576,10],[103577,103580,5],[103581,103583,10],[103595,103597,5],[103600,103694,5],[103696,103698,5],[103700,103793,10],[103794,103799,5]],gcsid:[4001,81,4002,85,4003,70,4004,84,4005,82,4006,83,4007,60,4008,67,4009,39,4010,57,4011,63,4012,64,4013,64,4014,63,4015,92,4016,90,4018,86,4019,75,4020,68,4021,70,4022,55,4023,75,4024,66,4025,73,4027,95,4028,59,4029,58,4031,75,4032,78,4033,77,4034,65,4035,100,4036,70,4042,88,4044,87,4045,89,4046,75,4047,99,4052,101,4053,97,4054,61,4075,75,4081,75,4120,84,4121,75,4122,80,4123,55,4124,84,4126,75,4130,75,4131,92,4132,64,4133,75,4134,64,4140,75,4141,75,4142,64,4143,64,4144,92,4145,87,4146,89,4147,66,4148,75,4149,84,4150,84,4151,75,4152,75,4153,55,4154,55,4155,63,4156,84,4157,60,4162,84,4163,75,4164,66,4165,55,4166,75,4168,58,4170,75,4172,75,4173,75,4174,58,4175,64,4176,75,4178,66,4179,66,4180,75,4188,81,4190,75,4191,66,4192,55,4193,63,4198,64,4199,55,4200,66,4201,64,4202,70,4203,70,4204,55,4205,66,4206,63,4207,55,4208,55,4209,64,4210,64,4211,84,4212,64,4213,63,4214,66,4215,55,4216,67,4218,55,4219,84,4220,64,4221,55,4222,64,4224,55,4225,55,4229,68,4230,55,4231,55,4232,64,4234,64,4235,55,4236,55,4237,70,4238,70,4239,92,4240,92,4241,65,4242,67,4243,88,4244,92,4245,86,4246,64,4250,64,4251,64,4252,63,4253,67,4254,55,4255,55,4256,64,4257,84,4258,75,4259,55,4260,64,4261,106,4262,84,4263,64,4265,55,4266,63,4267,67,4269,75,4270,64,4271,55,4272,55,4273,82,4274,55,4275,63,4276,73,4280,84,4281,57,4282,63,4283,75,4284,66,4285,55,4286,68,4288,55,4289,84,4291,70,4292,55,4293,83,4294,84,4295,84,4296,63,4297,55,4298,90,4299,85,4300,85,4301,84,4302,60,4303,68,4306,84,4307,64,4308,84,4309,55,4310,63,4311,55,4312,84,4313,55,4314,84,4315,63,4316,55,4317,66,4318,75,4319,75,4322,80,4324,80,4326,75,4466,75,4469,75,4475,55,4483,75,4490,75,4555,66,4558,75,4608,67,4609,67,4610,74,4614,55,4619,75,4624,75,4625,55,4627,75,4636,55,4637,55,4638,67,4639,55,4657,93,4659,75,4660,55,4661,75,4666,84,4667,75,4670,75,4671,63,4674,75,4679,64,4680,64,4682,92,4683,67,4686,75,4687,75,4693,75,4694,75,4695,67,4696,64,4697,64,4702,75,4703,64,4704,55,4705,55,4706,68,4718,55,4720,80,4721,55,4723,67,4726,67,4737,75,4738,60,4740,79,4741,55,4742,75,4743,64,4744,64,4745,84,4746,84,4747,75,4748,56,4749,75,4750,75,4751,91,4752,56,4753,55,4754,55,4759,75,4761,75,4801,84,4802,55,4803,55,4804,84,4805,84,4806,55,4807,106,4808,84,4809,55,4810,105,4811,106,4816,106,4817,82,4818,84,4820,84,4821,106,4823,55,4824,55,4901,107,4902,107,4903,59,4904,84,5228,84,5229,84,5233,92,5252,75,5264,75,5340,75,5354,75,5360,75,5371,75,5373,75,5381,75,5393,75,5464,60,5467,67,5489,75,5524,55,5527,70,5546,75,5561,66,5593,75,5681,84,5886,75,6135,75,6365,75,6706,75,6881,64,6882,64,6883,55,6892,64,6894,64,6980,75,6983,75,6987,75,6990,75,7035,75,7037,75,7039,75,7041,75,7073,75,7084,75,7086,75,7133,75,7373,75,7683,76,7798,75,7844,75,7881,75,7886,75,8042,96,8043,96,8086,75,8232,75,8237,75,8240,75,8246,75,8249,75,8252,75,8255,75,8351,84,8427,75,8428,55,8449,75,8545,75,8685,75,8694,64,8699,75,8818,75,8888,75,8900,75,8902,75,8907,75,8949,75,9003,75,9006,75,9009,75,9012,75,9017,75,9068,75,9069,75,9140,75,9148,75,9153,75,37001,73,37002,69,37003,72,37004,71,37005,62,37006,91,37007,94,37008,101,37201,55,37202,92,37203,87,37204,55,37205,55,37206,64,37207,71,37208,64,37211,64,37220,67,37221,55,37222,55,37223,63,37224,55,37225,106,37226,55,37227,55,37228,64,37229,62,37230,55,37231,70,37232,55,37233,55,37235,55,37237,55,37238,55,37239,67,37240,64,37241,55,37242,55,37243,67,37252,67,37253,55,37254,64,37255,84,37257,66,37259,55,37260,67,104017,79,104018,79,104024,75,104027,75,104047,98,104050,75,104100,75,104101,84,104102,84,104103,64,104104,55,104105,84,104106,55,104107,75,104108,75,104109,67,104110,75,104111,75,104112,67,104113,67,104128,102,104129,75,104130,55,104131,84,104132,67,104133,75,104134,75,104135,66,104136,70,104137,75,104138,55,104139,106,104140,106,104223,75,104248,55,104256,92,104261,63,104286,75,104287,75,104304,63,104700,49,104701,9,104702,24,104703,15,104704,28,104705,32,104706,53,104707,46,104708,37,104709,54,104710,11,104711,14,104712,30,104713,52,104714,4,104715,4,104716,23,104717,14,104718,48,104719,29,104720,22,104721,21,104722,35,104723,21,104724,46,104725,22,104726,49,104727,45,104728,52,104729,10,104730,10,104731,21,104732,31,104733,26,104734,40,104735,19,104736,30,104737,34,104738,27,104739,46,104740,5,104741,12,104742,50,104743,9,104744,43,104745,21,104746,26,104747,25,104748,21,104749,7,104750,53,104751,6,104752,33,104753,29,104754,19,104755,41,104756,31,104757,3,104758,41,104759,25,104760,49,104761,41,104762,44,104763,50,104764,46,104765,6,104766,40,104767,16,104768,8,104769,17,104770,48,104771,42,104772,50,104773,25,104774,29,104775,25,104776,32,104777,13,104778,36,104779,47,104780,14,104781,29,104782,23,104783,38,104784,42,104785,18,104786,20,104808,51,104896,75,104900,112,104901,104,104902,103,104903,116,104904,109,104905,108,104906,169,104907,164,104908,0,104909,168,104910,141,104911,166,104912,114,104913,160,104914,151,104915,117,104916,110,104917,140,104918,115,104919,170,104920,163,104921,154,104922,158,104923,161,104924,148,104925,0,104926,159,104927,167,104928,127,104929,131,104930,145,104931,159,104932,136,104933,123,104934,139,104935,134,104936,166,104937,150,104938,137,104939,147,104940,121,104941,165,104942,128,104943,111,104944,1,104945,126,104946,152,104947,157,104948,162,104949,153,104950,156,104951,149,104952,132,104953,122,104954,160,104955,146,104956,143,104957,156,104958,120,104959,125,104960,2,104961,144,104962,142,104963,138,104964,155,104965,135,104966,133,104967,151,104968,118,104969,119,104970,124,104971,108,104972,129,104973,130,104974,113,104975,0,104990,84,104991,75,104992,84],gcsidc:[[4127,4129,67],[4135,4139,67],[4158,4161,55],[4181,4185,55],[4194,4196,55],[4226,4228,63],[4247,4249,55],[4277,4279,81],[4600,4607,64],[4621,4623,55],[4628,4633,55],[4641,4646,55],[4662,4665,55],[4676,4678,66],[4688,4692,55],[4699,4701,64],[4755,4757,75],[4763,4765,75],[4813,4815,84],[8972,8987,75],[37212,37219,55],[37245,37247,55],[37249,37251,55],[104009,104015,75],[104019,104022,75],[104114,104124,75],[104125,104127,55],[104141,104145,75],[104179,104186,75],[104257,104260,75]]},i={c:[[2e3,2035,9001],[2039,2045,9001],[2056,2062,9001],[2067,2090,9001],[2093,2135,9001],[2161,2165,9001],[2172,2180,9001],[2188,2193,9001],[2195,2198,9001],[2200,2203,9001],[2205,2213,9001],[2215,2217,9001],[2222,2224,9002],[2225,2243,9003],[2246,2250,9003],[2251,2253,9002],[2257,2264,9003],[2274,2279,9003],[2280,2282,9002],[2283,2289,9003],[2308,2313,9001],[2315,2491,9001],[2494,2576,9001],[2578,2599,9001],[2601,2693,9001],[2695,2866,9001],[2867,2869,9002],[2870,2888,9003],[2891,2895,9003],[2896,2898,9002],[2902,2908,9003],[2915,2920,9003],[2921,2923,9002],[2924,2930,9003],[2931,2933,9001],[2935,2962,9001],[2964,2968,9003],[2969,2973,9001],[2975,2978,9001],[2984,2988,9001],[2995,3051,9001],[3054,3072,9001],[3077,3079,9001],[3081,3088,9001],[3092,3101,9001],[3106,3138,9001],[3146,3151,9001],[3153,3166,9001],[3168,3172,9001],[3174,3203,9001],[3294,3313,9001],[3315,3348,9001],[3350,3358,9001],[3367,3403,9001],[3408,3416,9001],[3417,3438,9003],[3441,3446,9003],[3447,3450,9001],[3451,3453,9003],[3455,3459,9003],[3460,3478,9001],[3554,3559,9001],[3560,3570,9003],[3571,3581,9001],[3594,3597,9001],[3601,3604,9001],[3637,3639,9001],[3665,3667,9001],[3693,3695,9001],[3701,3727,9001],[3728,3739,9003],[3740,3751,9001],[3753,3760,9003],[3761,3773,9001],[3775,3777,9001],[3779,3781,9001],[3788,3791,9001],[3797,3802,9001],[3814,3816,9001],[3825,3829,9001],[3832,3841,9001],[3844,3852,9001],[3873,3885,9001],[3890,3893,9001],[3942,3950,9001],[3968,3970,9001],[3973,3976,9001],[3986,3989,9001],[3994,3997,9001],[4001,4016,9102],[4018,4025,9102],[4027,4029,9102],[4031,4036,9102],[4044,4047,9102],[4048,4051,9001],[4052,4054,9102],[4056,4063,9001],[4093,4096,9001],[4120,4124,9102],[4127,4139,9102],[4141,4176,9102],[4178,4185,9102],[4188,4216,9102],[4218,4232,9102],[4235,4260,9102],[4265,4267,9102],[4269,4286,9102],[4292,4304,9102],[4306,4319,9102],[4390,4398,9001],[4399,4413,9003],[4418,4433,9003],[4455,4457,9003],[4484,4489,9001],[4491,4554,9001],[4568,4589,9001],[4600,4630,9102],[4636,4639,9102],[4641,4646,9102],[4652,4656,9001],[4657,4680,9102],[4682,4684,9102],[4686,4765,9102],[4766,4800,9001],[4801,4806,9102],[4813,4815,9102],[5014,5016,9001],[5069,5072,9001],[5105,5130,9001],[5173,5188,9001],[5253,5259,9001],[5269,5275,9001],[5292,5311,9001],[5329,5331,9001],[5343,5349,9001],[5355,5357,9001],[5459,5463,9001],[5479,5482,9001],[5518,5520,9001],[5533,5539,9001],[5550,5552,9001],[5562,5583,9001],[5623,5625,9003],[5631,5639,9001],[5649,5653,9001],[5663,5680,9001],[5682,5685,9001],[5875,5877,9001],[5896,5899,9001],[5921,5940,9001],[6050,6125,9001],[6244,6275,9001],[6328,6348,9001],[6350,6356,9001],[6366,6372,9001],[6381,6387,9001],[6393,6404,9001],[6480,6483,9001],[6511,6514,9001],[6579,6581,9001],[6619,6624,9001],[6625,6627,9003],[6628,6632,9001],[6634,6637,9001],[6669,6692,9001],[6707,6709,9001],[6720,6723,9001],[6732,6738,9001],[6881,6883,9102],[6931,6933,9001],[7005,7007,9001],[7057,7070,9003],[7074,7082,9001],[7109,7118,9001],[7119,7127,9002],[7374,7376,9001],[7528,7586,9001],[7587,7645,9003],[7692,7696,9001],[7755,7787,9001],[7791,7795,9001],[7799,7801,9001],[7803,7805,9001],[7825,7831,9001],[7845,7859,9001],[8013,8032,9001],[8065,8068,9002],[8518,8529,9003],[8533,8536,9003],[8538,8540,9003],[8677,8679,9001],[8836,8840,9001],[8857,8859,9001],[8908,8910,9001],[8972,9e3,9102],[9053,9057,9102],[9059,9069,9102],[9154,9159,9001],[9205,9218,9001],[20002,20032,9001],[20062,20092,9001],[20135,20138,9001],[20248,20258,9001],[20348,20358,9001],[20436,20440,9001],[20822,20824,9001],[20934,20936,9001],[21035,21037,9001],[21095,21097,9001],[21148,21150,9001],[21413,21423,9001],[21473,21483,9001],[21780,21782,9001],[21896,21899,9001],[22171,22177,9001],[22181,22187,9001],[22191,22197,9001],[22234,22236,9001],[22521,22525,9001],[22991,22994,9001],[23028,23038,9001],[23830,23853,9001],[23866,23872,9001],[23877,23884,9001],[23886,23894,9001],[23946,23948,9001],[24311,24313,9001],[24342,24347,9001],[24370,24374,9084],[24375,24381,9001],[24718,24721,9001],[24817,24821,9001],[24877,24882,9001],[24891,24893,9001],[25391,25395,9001],[25828,25838,9001],[26191,26195,9001],[26391,26393,9001],[26701,26722,9001],[26729,26746,9003],[26748,26760,9003],[26766,26799,9003],[26847,26870,9003],[26891,26899,9001],[26901,26923,9001],[26929,26946,9001],[26948,26978,9001],[26980,26998,9001],[27037,27040,9001],[27205,27232,9001],[27258,27260,9001],[27391,27398,9001],[27561,27564,9001],[27571,27574,9001],[27581,27584,9001],[27591,27594,9001],[28191,28193,9001],[28348,28358,9001],[28402,28432,9001],[28462,28492,9001],[29168,29172,9001],[29187,29195,9001],[29901,29903,9001],[30161,30179,9001],[30491,30494,9001],[30729,30732,9001],[31251,31259,9001],[31265,31268,9001],[31275,31277,9001],[31281,31290,9001],[31466,31469,9001],[31491,31495,9001],[31965,32e3,9001],[32001,32003,9003],[32005,32017,9003],[32019,32028,9003],[32033,32035,9003],[32037,32060,9003],[32064,32067,9003],[32081,32086,9001],[32107,32130,9001],[32133,32158,9001],[32164,32167,9003],[32180,32199,9001],[32201,32260,9001],[32301,32360,9001],[32601,32662,9001],[32664,32667,9003],[32701,32761,9001],[37002,37008,9102],[53001,53004,9001],[53008,53019,9001],[53021,53032,9001],[53034,53037,9001],[53042,53046,9001],[53074,53080,9001],[54001,54004,9001],[54008,54019,9001],[54021,54032,9001],[54042,54046,9001],[54048,54053,9001],[54074,54080,9001],[54098,54101,9001],[102001,102005,9001],[102007,102039,9001],[102042,102045,9001],[102060,102063,9001],[102070,102079,9001],[102096,102099,9001],[102101,102109,9001],[102114,102117,9001],[102132,102138,9001],[102141,102144,9001],[102156,102166,9001],[102173,102179,9001],[102191,102198,9001],[102221,102228,9001],[102231,102233,9001],[102237,102240,9001],[102364,102375,9001],[102389,102398,9003],[102399,102419,9001],[102421,102438,9001],[102445,102447,9003],[102450,102458,9001],[102459,102462,9003],[102470,102489,9001],[102550,102556,9001],[102562,102588,9001],[102629,102640,9003],[102648,102650,9003],[102688,102690,9003],[102696,102700,9003],[102701,102703,9001],[102799,102900,9001],[103166,103168,9002],[103220,103224,9001],[103225,103227,9002],[103232,103237,9001],[103238,103243,9003],[103244,103246,9001],[103247,103249,9003],[103254,103256,9001],[103257,103259,9003],[103264,103266,9001],[103267,103269,9003],[103327,103330,9001],[103344,103347,9001],[103372,103375,9001],[103381,103383,9001],[103384,103386,9002],[103387,103389,9001],[103390,103392,9003],[103397,103399,9001],[103427,103430,9003],[103444,103447,9003],[103476,103478,9001],[103479,103481,9003],[103486,103488,9001],[103489,103491,9003],[103492,103495,9001],[103496,103499,9003],[103539,103543,9001],[103544,103548,9003],[103549,103551,9001],[103552,103554,9002],[103555,103557,9003],[103558,103560,9001],[103571,103573,9001],[103574,103576,9003],[103577,103580,9001],[103581,103583,9003],[103595,103597,9001],[103600,103694,9001],[103696,103698,9001],[103700,103793,9003],[104101,104103,9102],[104126,104131,9102],[104259,104261,9102],[104700,104786,9102],[104900,104975,9102]],nc:[2065,9001,2066,9039,2136,9094,2137,9001,2138,9001,2154,9001,2157,9001,2158,9001,2159,9094,2160,9094,2169,9001,2170,9001,2204,9003,2219,9001,2220,9001,2254,9003,2255,9003,2256,9002,2265,9002,2266,9002,2267,9003,2268,9003,2269,9002,2270,9002,2271,9003,2272,9003,2273,9002,2290,9001,2294,9001,2295,9001,2314,9005,2899,9003,2900,9003,2901,9002,2909,9002,2910,9002,2911,9003,2912,9003,2913,9002,2914,9002,2980,9001,2981,9001,2991,9001,2992,9002,2993,9001,2994,9002,3074,9001,3075,9001,3080,9002,3089,9003,3090,9001,3091,9003,3102,9003,3141,9001,3142,9001,3167,9301,3360,9001,3361,9002,3362,9001,3363,9003,3364,9001,3365,9003,3404,9003,3405,9001,3406,9001,3407,9005,3439,9001,3440,9001,3479,9002,3480,9001,3481,9002,3482,9001,3483,9002,3484,9001,3485,9003,3486,9001,3487,9003,3488,9001,3489,9001,3490,9003,3491,9001,3492,9003,3493,9001,3494,9003,3495,9001,3496,9003,3497,9001,3498,9003,3499,9001,3500,9003,3501,9001,3502,9003,3503,9001,3504,9003,3505,9001,3506,9003,3507,9001,3508,9003,3509,9001,3510,9003,3511,9001,3512,9003,3513,9001,3514,9001,3515,9003,3516,9001,3517,9003,3518,9001,3519,9003,3520,9001,3521,9003,3522,9001,3523,9003,3524,9001,3525,9003,3526,9001,3527,9003,3528,9001,3529,9003,3530,9001,3531,9003,3532,9001,3533,9003,3534,9001,3535,9003,3536,9001,3537,9003,3538,9001,3539,9003,3540,9001,3541,9003,3542,9001,3543,9003,3544,9001,3545,9003,3546,9001,3547,9003,3548,9001,3549,9003,3550,9001,3551,9003,3552,9001,3553,9003,3582,9003,3583,9001,3584,9003,3585,9001,3586,9003,3587,9001,3588,9002,3589,9001,3590,9002,3591,9001,3592,9001,3593,9002,3598,9003,3599,9001,3600,9003,3605,9002,3606,9001,3607,9001,3608,9003,3609,9001,3610,9003,3611,9001,3612,9003,3613,9001,3614,9003,3615,9001,3616,9003,3617,9001,3618,9003,3619,9001,3620,9003,3621,9001,3622,9003,3623,9001,3624,9003,3625,9001,3626,9003,3627,9001,3628,9003,3629,9001,3630,9003,3631,9001,3632,9003,3633,9001,3634,9002,3635,9001,3636,9002,3640,9003,3641,9001,3642,9003,3643,9001,3644,9002,3645,9001,3646,9002,3647,9001,3648,9002,3649,9001,3650,9003,3651,9001,3652,9003,3653,9001,3654,9003,3655,9001,3656,9002,3657,9001,3658,9003,3659,9001,3660,9003,3661,9001,3662,9003,3663,9001,3664,9003,3668,9003,3669,9001,3670,9003,3671,9001,3672,9003,3673,9001,3674,9003,3675,9001,3676,9002,3677,9003,3678,9001,3679,9002,3680,9003,3681,9001,3682,9002,3683,9003,3684,9001,3685,9001,3686,9003,3687,9001,3688,9003,3689,9001,3690,9003,3691,9001,3692,9003,3696,9003,3697,9001,3698,9003,3699,9001,3700,9003,3783,9001,3784,9001,3793,9001,3794,9001,3812,9001,3819,9102,3821,9102,3824,9102,3854,9001,3857,9001,3889,9102,3906,9102,3911,9001,3912,9001,3920,9001,3978,9001,3979,9001,3991,9003,3992,9003,4026,9001,4037,9001,4038,9001,4042,9102,4071,9001,4075,9102,4081,9102,4082,9001,4083,9001,4087,9001,4088,9001,4217,9003,4261,9105,4262,9102,4263,9102,4288,9102,4289,9102,4322,9102,4324,9102,4326,9102,4414,9001,4415,9001,4417,9001,4434,9001,4437,9001,4438,9003,4439,9003,4462,9001,4463,9102,4467,9001,4470,9102,4471,9001,4475,9102,4483,9102,4490,9102,4555,9102,4558,9102,4559,9001,4632,9102,4633,9102,4647,9001,4807,9105,4808,9102,4809,9102,4810,9105,4811,9105,4816,9105,4817,9102,4818,9102,4820,9102,4821,9105,4822,9001,4823,9102,4824,9102,4826,9001,4839,9001,4901,9105,4902,9105,4903,9102,4904,9102,5013,9102,5018,9001,5048,9001,5167,9001,5168,9001,5221,9001,5223,9001,5228,9102,5229,9102,5233,9102,5234,9001,5235,9001,5243,9001,5246,9102,5247,9001,5252,9102,5264,9102,5266,9001,5316,9001,5320,9001,5321,9001,5324,9102,5325,9001,5337,9001,5340,9102,5354,9102,5360,9102,5361,9001,5362,9001,5365,9102,5367,9001,5371,9102,5373,9102,5381,9102,5382,9001,5383,9001,5387,9001,5389,9001,5393,9102,5396,9001,5451,9102,5456,9001,5457,9001,5464,9102,5467,9102,5469,9001,5472,9037,5489,9102,5490,9001,5513,9001,5514,9001,5523,9001,5524,9102,5527,9102,5530,9001,5531,9001,5546,9102,5559,9001,5561,9102,5588,9002,5589,9005,5593,9102,5596,9001,5627,9001,5629,9001,5641,9001,5643,9001,5644,9001,5646,9003,5654,9003,5655,9003,5659,9001,5681,9102,5700,9001,5825,9001,5836,9001,5837,9001,5839,9001,5842,9001,5844,9001,5858,9001,5879,9001,5880,9001,5886,9102,5887,9001,5890,9001,6128,9002,6129,9002,6135,9102,6204,9001,6207,9102,6210,9001,6211,9001,6307,9001,6311,9102,6312,9001,6316,9001,6318,9102,6322,9102,6325,9102,6362,9001,6365,9102,6391,9002,6405,9002,6406,9001,6407,9002,6408,9001,6409,9002,6410,9001,6411,9003,6412,9001,6413,9003,6414,9001,6415,9001,6416,9003,6417,9001,6418,9003,6419,9001,6420,9003,6421,9001,6422,9003,6423,9001,6424,9003,6425,9001,6426,9003,6427,9001,6428,9003,6429,9001,6430,9003,6431,9001,6432,9003,6433,9001,6434,9003,6435,9001,6436,9003,6437,9001,6438,9003,6439,9001,6440,9001,6441,9003,6442,9001,6443,9003,6444,9001,6445,9003,6446,9001,6447,9003,6448,9001,6449,9003,6450,9001,6451,9003,6452,9001,6453,9003,6454,9001,6455,9003,6456,9001,6457,9003,6458,9001,6459,9003,6460,9001,6461,9003,6462,9001,6463,9003,6464,9001,6465,9003,6466,9001,6467,9003,6468,9001,6469,9003,6470,9001,6471,9003,6472,9001,6473,9003,6474,9001,6475,9003,6476,9001,6477,9003,6478,9001,6479,9003,6484,9003,6485,9001,6486,9003,6487,9001,6488,9003,6489,9001,6490,9003,6491,9001,6492,9003,6493,9001,6494,9002,6495,9001,6496,9002,6497,9001,6498,9001,6499,9002,6500,9001,6501,9003,6502,9001,6503,9003,6504,9001,6505,9003,6506,9001,6507,9003,6508,9001,6509,9001,6510,9003,6515,9002,6516,9001,6518,9001,6519,9003,6520,9001,6521,9003,6522,9001,6523,9003,6524,9001,6525,9003,6526,9001,6527,9003,6528,9001,6529,9003,6530,9001,6531,9003,6532,9001,6533,9003,6534,9001,6535,9003,6536,9001,6537,9003,6538,9001,6539,9003,6540,9001,6541,9003,6542,9001,6543,9003,6544,9001,6545,9002,6546,9001,6547,9002,6548,9001,6549,9003,6550,9001,6551,9003,6552,9001,6553,9003,6554,9001,6555,9003,6556,9001,6557,9002,6558,9001,6559,9002,6560,9001,6561,9002,6562,9001,6563,9003,6564,9001,6565,9003,6566,9001,6567,9001,6568,9003,6569,9001,6570,9002,6571,9001,6572,9003,6573,9001,6574,9003,6575,9001,6576,9003,6577,9001,6578,9003,6582,9003,6583,9001,6584,9003,6585,9001,6586,9003,6587,9001,6588,9003,6589,9001,6590,9003,6591,9001,6592,9001,6593,9003,6594,9001,6595,9003,6596,9001,6597,9003,6598,9001,6599,9003,6600,9001,6601,9003,6602,9001,6603,9003,6605,9003,6606,9001,6607,9003,6608,9001,6609,9003,6610,9001,6611,9001,6612,9003,6613,9001,6614,9003,6615,9001,6616,9003,6617,9001,6618,9003,6633,9003,6646,9001,6668,9102,6703,9001,6706,9102,6783,9102,6784,9001,6785,9002,6786,9001,6787,9002,6788,9001,6789,9002,6790,9001,6791,9002,6792,9001,6793,9002,6794,9001,6795,9002,6796,9001,6797,9002,6798,9001,6799,9002,6800,9001,6801,9002,6802,9001,6803,9002,6804,9001,6805,9002,6806,9001,6807,9002,6808,9001,6809,9002,6810,9001,6811,9002,6812,9001,6813,9002,6814,9001,6815,9002,6816,9001,6817,9002,6818,9001,6819,9002,6820,9001,6821,9002,6822,9001,6823,9002,6824,9001,6825,9002,6826,9001,6827,9002,6828,9001,6829,9002,6830,9001,6831,9002,6832,9001,6833,9002,6834,9001,6835,9002,6836,9001,6837,9002,6838,9001,6839,9002,6840,9001,6841,9002,6842,9001,6843,9002,6844,9001,6845,9002,6846,9001,6847,9002,6848,9001,6849,9002,6850,9001,6851,9002,6852,9001,6853,9002,6854,9001,6855,9002,6856,9001,6857,9002,6858,9001,6859,9002,6860,9001,6861,9002,6862,9001,6863,9002,6867,9001,6868,9002,6870,9001,6875,9001,6876,9001,6879,9001,6880,9003,6884,9001,6885,9002,6886,9001,6887,9002,6892,9102,6894,9102,6915,9001,6922,9001,6923,9003,6924,9001,6925,9003,6962,9001,6983,9102,6984,9001,6990,9102,6991,9001,7035,9102,7037,9102,7039,9102,7041,9102,7073,9102,7084,9102,7086,9102,7128,9003,7131,9001,7132,9003,7133,9102,7136,9102,7139,9102,7142,9001,7257,9001,7258,9003,7259,9001,7260,9003,7261,9001,7262,9003,7263,9001,7264,9003,7265,9001,7266,9003,7267,9001,7268,9003,7269,9001,7270,9003,7271,9001,7272,9003,7273,9001,7274,9003,7275,9001,7276,9003,7277,9001,7278,9003,7279,9001,7280,9003,7281,9001,7282,9003,7283,9001,7284,9003,7285,9001,7286,9003,7287,9001,7288,9003,7289,9001,7290,9003,7291,9001,7292,9003,7293,9001,7294,9003,7295,9001,7296,9003,7297,9001,7298,9003,7299,9001,7300,9003,7301,9001,7302,9003,7303,9001,7304,9003,7305,9001,7306,9003,7307,9001,7308,9003,7309,9001,7310,9003,7311,9001,7312,9003,7313,9001,7314,9003,7315,9001,7316,9003,7317,9001,7318,9003,7319,9001,7320,9003,7321,9001,7322,9003,7323,9001,7324,9003,7325,9001,7326,9003,7327,9001,7328,9003,7329,9001,7330,9003,7331,9001,7332,9003,7333,9001,7334,9003,7335,9001,7336,9003,7337,9001,7338,9003,7339,9001,7340,9003,7341,9001,7342,9003,7343,9001,7344,9003,7345,9001,7346,9003,7347,9001,7348,9003,7349,9001,7350,9003,7351,9001,7352,9003,7353,9001,7354,9003,7355,9001,7356,9003,7357,9001,7358,9003,7359,9001,7360,9003,7361,9001,7362,9003,7363,9001,7364,9003,7365,9001,7366,9003,7367,9001,7368,9003,7369,9001,7370,9003,7373,9102,7683,9102,7798,9102,7844,9102,7877,9001,7878,9001,7881,9102,7882,9001,7883,9001,7886,9102,7887,9001,7899,9001,7991,9001,7992,9001,8035,9003,8036,9003,8042,9102,8043,9102,8058,9001,8059,9001,8082,9001,8083,9001,8086,9102,8088,9001,8090,9001,8091,9003,8092,9001,8093,9003,8095,9001,8096,9003,8097,9001,8098,9003,8099,9001,8100,9003,8101,9001,8102,9003,8103,9001,8104,9003,8105,9001,8106,9003,8107,9001,8108,9003,8109,9001,8110,9003,8111,9001,8112,9003,8113,9001,8114,9003,8115,9001,8116,9003,8117,9001,8118,9003,8119,9001,8120,9003,8121,9001,8122,9003,8123,9001,8124,9003,8125,9001,8126,9003,8127,9001,8128,9003,8129,9001,8130,9003,8131,9001,8132,9003,8133,9001,8134,9003,8135,9001,8136,9003,8137,9001,8138,9003,8139,9001,8140,9003,8141,9001,8142,9003,8143,9001,8144,9003,8145,9001,8146,9003,8147,9001,8148,9003,8149,9001,8150,9003,8151,9001,8152,9003,8153,9001,8154,9003,8155,9001,8156,9003,8157,9001,8158,9003,8159,9001,8160,9003,8161,9001,8162,9003,8163,9001,8164,9003,8165,9001,8166,9003,8167,9001,8168,9003,8169,9001,8170,9003,8171,9001,8172,9003,8173,9001,8177,9003,8179,9001,8180,9003,8181,9001,8182,9003,8184,9001,8185,9003,8187,9001,8189,9003,8191,9001,8193,9003,8196,9001,8197,9003,8198,9001,8200,9003,8201,9001,8202,9003,8203,9001,8204,9003,8205,9001,8206,9003,8207,9001,8208,9003,8209,9001,8210,9003,8212,9001,8213,9003,8214,9001,8216,9003,8218,9001,8220,9003,8222,9001,8224,9003,8225,9001,8226,9003,8232,9102,8237,9102,8240,9102,8246,9102,8249,9102,8252,9102,8255,9102,8311,9001,8312,9002,8313,9001,8314,9002,8315,9001,8316,9002,8317,9001,8318,9002,8319,9001,8320,9002,8321,9001,8322,9002,8323,9001,8324,9002,8325,9001,8326,9002,8327,9001,8328,9002,8329,9001,8330,9002,8331,9001,8332,9002,8333,9001,8334,9002,8335,9001,8336,9002,8337,9001,8338,9002,8339,9001,8340,9002,8341,9001,8342,9002,8343,9001,8344,9002,8345,9001,8346,9002,8347,9001,8348,9002,8351,9102,8352,9001,8353,9001,8379,9001,8380,9003,8381,9001,8382,9003,8383,9001,8384,9003,8385,9001,8387,9003,8391,9001,8395,9001,8427,9102,8428,9102,8431,9102,8433,9001,8441,9001,8455,9001,8456,9001,8531,9003,8545,9102,8682,9001,8685,9102,8687,9001,8692,9001,8693,9001,8694,9102,8699,9102,8818,9102,8826,9001,8860,9102,8888,9102,8900,9102,8902,9102,8903,9001,8907,9102,8949,9102,8950,9001,8951,9001,9003,9102,9006,9102,9009,9102,9012,9102,9014,9102,9017,9102,9019,9102,9039,9001,9040,9001,9140,9102,9141,9001,9148,9102,9149,9001,9150,9001,9153,9102,9191,9001,9221,9001,9222,9001,20499,9001,20538,9001,20539,9001,20790,9001,20791,9001,21291,9001,21292,9001,21500,9001,21817,9001,21818,9001,22032,9001,22033,9001,22091,9001,22092,9001,22332,9001,22391,9001,22392,9001,22700,9001,22770,9001,22780,9001,22832,9001,23090,9001,23095,9001,23239,9001,23240,9001,23700,9001,24047,9001,24048,9001,24100,9005,24200,9001,24305,9001,24306,9001,24382,9084,24383,9001,24500,9001,24547,9001,24548,9001,24571,9062,24600,9001,25e3,9001,25231,9001,25884,9001,25932,9001,26237,9001,26331,9001,26332,9001,26591,9001,26592,9001,26632,9001,26692,9001,27120,9001,27200,9001,27291,9040,27292,9040,27429,9001,27493,9001,27500,9001,27700,9001,28232,9001,28600,9001,28991,9001,28992,9001,29101,9001,29220,9001,29221,9001,29333,9001,29635,9001,29636,9001,29701,9001,29738,9001,29739,9001,29849,9001,29850,9001,29871,9042,29872,9041,29873,9001,30200,9039,30339,9001,30340,9001,30791,9001,30792,9001,31028,9001,31121,9001,31154,9001,31170,9001,31171,9001,31279,9001,31370,9001,31528,9001,31529,9001,31600,9001,31700,9001,31838,9001,31839,9001,31901,9001,32030,9003,32031,9003,32061,9001,32062,9001,32098,9001,32099,9003,32100,9001,32104,9001,32161,9001,32766,9001,37202,9102,37203,9102,37206,9102,37207,9102,37218,9102,37221,9102,37225,9105,37240,9102,37241,9102,37243,9102,37245,9102,37249,9102,37257,9102,37260,9102,53048,9001,53049,9001,54034,9001,54090,9001,54091,9001,65061,9003,65062,9003,65161,9001,102041,9003,102064,9085,102068,109030,102069,109031,102093,9001,102094,9001,102118,9003,102120,9003,102121,9003,102122,9001,102150,9001,102168,9001,102204,9001,102212,9001,102213,9001,102215,9001,102216,9001,102217,9003,102218,9001,102219,9003,102220,9003,102247,9001,102299,9001,102306,9001,102319,9001,102328,9001,102329,9001,102359,9001,102360,9001,102440,9001,102448,9001,102464,9003,102465,9003,102491,9001,102492,9001,102498,9001,102499,9001,102525,9003,102526,9003,102528,9003,102529,9003,102589,9003,102598,9001,102599,9003,102600,9003,102604,9003,102661,9003,102662,9003,102664,9003,102665,9003,102705,9003,102720,9003,102721,9003,102726,9003,102727,9003,102733,9003,102761,9003,102766,9003,102974,9003,103228,9001,103229,9001,103230,9003,103231,9003,103250,9001,103251,9003,103252,9001,103253,9003,103260,9001,103261,9001,103262,9003,103263,9003,103270,9001,103271,9001,103272,9003,103273,9003,103274,9001,103275,9001,103276,9003,103277,9003,103278,9001,103279,9001,103280,9003,103281,9003,103282,9001,103283,9001,103284,9003,103285,9003,103286,9001,103287,9003,103288,9001,103289,9003,103290,9001,103291,9003,103292,9001,103293,9001,103294,9003,103295,9003,103296,9001,103297,9001,103298,9003,103299,9003,103300,9001,103307,9001,103313,9001,103319,9001,103322,9001,103323,9001,103332,9001,103335,9001,103338,9001,103340,9001,103351,9001,103358,9001,103370,9001,103376,9003,103377,9001,103378,9001,103379,9003,103380,9003,103393,9001,103394,9001,103395,9003,103396,9003,103400,9003,103407,9003,103413,9003,103419,9003,103422,9003,103423,9003,103432,9003,103435,9003,103438,9003,103440,9003,103451,9003,103458,9003,103470,9003,103472,9001,103473,9002,103474,9001,103475,9003,103482,9001,103483,9003,103484,9001,103485,9003,103500,9001,103501,9003,103502,9001,103503,9001,103504,9002,103505,9002,103506,9001,103507,9001,103508,9003,103509,9003,103510,9001,103511,9001,103512,9003,103513,9003,103514,9001,103515,9003,103516,9001,103517,9003,103518,9001,103519,9003,103520,9001,103521,9002,103522,9001,103523,9001,103524,9003,103525,9003,103526,9001,103527,9003,103561,9003,103562,9003,103563,9001,103564,9001,103565,9003,103566,9003,103567,9001,103568,9001,103569,9003,103570,9003,103585,9003,103586,9001,103587,9003,103588,9002,103589,9001,103590,9003,103591,9002,103592,9001,103593,9003,103594,9002,103695,9003,103846,9001,103946,9003,104009,9102,104017,9102,104018,9102,104022,9102,104024,9102,104027,9102,104047,9102,104050,9102,104105,9102,104106,9102,104109,9102,104112,9102,104113,9102,104134,9102,104135,9102,104138,9102,104139,9105,104140,9105,104808,9102]};e.yr=function(){function e(){}return e.Ny=function(t){!1===e.zp&&e.yt();var i=e.xQ(t);if(-1==i){var r=e.zx(t);r!=t&&(i=e.Ny(r))}return-1==i&&(r=e.xK(t))!=t&&(i=e.Ny(r)),i},e.xQ=function(t){return void 0!==e.Gw[t]?e.Gw[t]:-1},e.uQ=function(t){!1===e.zp&&e.yt();var i=e.fF(t);if(1e38==i){var r=e.zx(t);if(r!=t&&(i=e.fF(r)),1e38==i)return 1e-10}return i},e.PS=function(t){if(void 0!==e.Js[t])return!0;var i=e.zx(t);return i!=t&&void 0!==e.Js[i]},e.RS=function(t){if(void 0!==e.yo[t])return!0;var i=e.zx(t);return i!=t&&void 0!==e.yo[i]},e.fF=function(t){return!1===e.zp&&e.yt(),void 0!==e.Js[t]?e.Js[t]:void 0!==e.yo[t]?e.yo[t]:1e38},e.xK=function(t){return!1===e.zp&&e.yt(),void 0!==e.QA[t]?e.QA[t]:t},e.zx=function(t){return!1===e.zp&&e.yt(),void 0!==e.RA[t]?e.RA[t]:t},e.yt=function(){for(var r,s=t,n=0;n<s.pcsid.length;n+=2)e.yo[s.pcsid[n]]=s.pcstol[2*s.pcsid[n+1]+1];for(n=0;n<s.pcsidc.length;n+=1)for(var o=(r=s.pcsidc[n])[0];o<=r[1];o++)e.yo[o]=s.pcstol[2*r[2]+1];for(n=0;n<s.gcsid.length;n+=2)e.Js[s.gcsid[n]]=s.gcstol[2*s.gcsid[n+1]+1];for(n=0;n<s.gcsidc.length;n+=1)for(o=(r=s.gcsidc[n])[0];o<=r[1];o++)e.yo[o]=s.gcstol[2*r[2]+1];for(n=0;n<i.c.length;n+=1)for(o=(r=i.c[n])[0];o<=r[1];o++)e.Gw[o]=r[2];for(n=0;n<i.nc.length;n+=2)e.Gw[i.nc[n]]=i.nc[n+1];for(i=null,n=0;n<s.newtoold.length;n+=2)e.QA[s.newtoold[n+1]]=s.newtoold[n],e.RA[s.newtoold[n]]=s.newtoold[n+1];t=null,e.zp=!0},e.zp=!1,e.Js=[],e.yo=[],e.QA=[],e.RA=[],e.Gw=[],e}()}($||($={})),function(e){function t(e){return 0===e.length?'""':'"'==e[0]||"."==e[0]||"0"<=e[0]&&"9">=e[0]?e:'"'+e.trim()+'"'}var i=[];e.PC=function(){function r(){}return r.wQ=function(s){try{for(var n=0;n<i.length;n++)if(i[n].wkttext===s)return i[n].unit;for(var o,a=n="",l=!1,h=0;h<s.length;h++){var c=s[h];!0===l?'"'==c?'"'==s[h+1]?n+=c:l=l=!1:n+=c:/[\s]/.test(c)||(","==c?(a=""!==n?a+(t(n)+","):a+",",n=""):")"==c||"]"==c?(a=""!==n?a+(t(n)+"]}"):a+"]}",n=""):"("==c||"["==c?(a+='{ "entity": "'+n.toUpperCase().trim()+'", "values":[',n=""):'"'==c?(l=!0,n=""):n+=c)}o=JSON.parse(a);var u=r.eF(o);if(null===u)return null;for(o=null,c=0;c<u.values.length;c++)if("object"==typeof u.values[c]&&"UNIT"===u.values[c].entity){o=u.values[c];break}if(null===o)return null;var p=e.Uc.RO("GEOGCS"===u.entity?1:0,o.values[1],o.values[2]);return i.push({wkttext:s,unit:p}),10<i.length&&i.shift(),p}catch(d){return null}},r.eF=function(e){if(null===e)return null;if("GEOGCS"===e.entity||"PROJCS"===e.entity)return e;for(var t=[],i=0;i<e.values.length;i++)if("object"==typeof e.values[i]&&void 0!==e.values[i].entity){if("GEOGCS"===e.values[i].entity||"PROJCS"==e.values[i].entity)return e.values[i];t.push(e.values[i])}for(e=0;e<t.length;e++)if(null!==(i=r.eF(t[e])))return i;return null},r.vQ=function(e){var t=-1;if(null!=e&&0<e.length){var i=e.indexOf("PROJCS");if(0<=i){var r=0;if(0<=(i=e.lastIndexOf("UNIT"))&&0<(i=e.indexOf(",",i+4))){i++;var s=e.indexOf("]",i+1);if(0<s)try{r=parseFloat(e.substring(i,s))}catch(o){r=0}}0<r&&(t=.001/r)}else if(0<=(i=e.indexOf("GEOGCS"))){var n=0;if(r=0,0<(i=e.indexOf("SPHEROID",i+6))&&0<(i=e.indexOf(",",i+8))){if(i++,0<(s=e.indexOf(",",i+1)))try{n=parseFloat(e.substring(i,s))}catch(o){n=0}if(0<n&&0<=(i=e.indexOf("UNIT",s+1))&&0<(i=e.indexOf(",",i+4))&&(i++,0<(s=e.indexOf("]",i+1))))try{r=parseFloat(e.substring(i,s))}catch(o){r=0}}0<n&&0<r&&(t=.001/(n*r))}}return t},r}()}($||($={})),function(e){var t,i;(t=e.XK||(e.XK={}))[t.NONE=0]="NONE",t[t.LINEAR=1]="LINEAR",t[t.ANGULAR=2]="ANGULAR",(i=e.IL||(e.IL={}))[i.enumFloat=0]="enumFloat",i[i.enumDouble=1]="enumDouble",i[i.enumInt32=2]="enumInt32",i[i.enumInt64=3]="enumInt64",i[i.enumInt8=4]="enumInt8",i[i.enumInt16=5]="enumInt16",function(e){e[e.POSITION=0]="POSITION",e[e.Z=1]="Z",e[e.M=2]="M",e[e.ID=3]="ID",e[e.NORMAL=4]="NORMAL",e[e.TEXTURE1D=5]="TEXTURE1D",e[e.TEXTURE2D=6]="TEXTURE2D",e[e.TEXTURE3D=7]="TEXTURE3D",e[e.ID2=8]="ID2",e[e.MAXSEMANTICS=10]="MAXSEMANTICS"}(e.Jh||(e.Jh={}));var r=function(){function t(e,i){if(this.Ws=this.Be=null,this.Qq=this.Ba=0,this.vh=this.cg=null,this.yl=0,void 0!==i){for(this.Ba=i.Ba,this.Qq=i.Qq,this.cg=i.cg.slice(0),this.vh=i.vh.slice(0),this.yl=i.yl,this.Ws=[],e=i=0;e<this.Ba;e++)this.Ws[e]=i,i+=t.Wa(this.cg[e]);for(this.Qq=i,this.Be=[],e=0;e<this.Ba;e++){i=t.Wa(this.qd(e));for(var r=t.te(this.qd(e)),s=0;s<i;s++)this.Be[this.Ws[e]+s]=r}}else this.Qq=this.Ba=0}return t.prototype.qd=function(t){if(0>t||t>this.Ba)throw e.i.O();return this.cg[t]},t.prototype.Qf=function(e){return this.vh[e]},t.gz=function(e){return t.BM[e]},t.Vp=function(e){return t.KM[e]},t.Wa=function(e){return t.jM[e]},t.prototype.hasAttribute=function(e){return 0<=this.vh[e]},t.prototype.aG=function(){return this.hasAttribute(1)},t.te=function(e){return t.XC[e]},t.prototype.CR=function(e){return this.Ws[e]},t.vG=function(e,i){return t.XC[e]===i},t.prototype.Nb=function(e){return this===e},t.prototype.Bn=function(){for(var t=e.P.Uh(this.cg[0]),i=1;i<this.Ba;i++)t=e.P.Uh(this.cg[i],t);return t},t.prototype.$j=function(e){return this.Ws[e]},t.prototype.dc=function(){return this.yl},t.prototype.Fd=function(e){return this.cg[e]},t.XC=[0,0,NaN,0,0,0,0,0,0],t.BM=[1,1,1,0,2,1,1,1,0],t.KM=[1,1,1,2,0,0,0,0,2],t.jM=[2,1,1,1,3,1,2,3,2],t}();e.ua=r}($||($={})),function(e){function t(e,t,r){var n=t-(e=new a(e)).e,o=e.c;for(o.length>++t&&i(e,n,a.fu),o[0]?r?n=t:(o=e.c,n=e.e+n+1):++n;o.length<n;o.push(0));return n=e.e,1===r||r&&(t<=n||n<=s)?(0>e.Cd&&o[0]?"-":"")+(1<o.length?o[0]+"."+o.join("").slice(1):o[0])+(0>n?"e":"e+")+n:e.toString()}function i(e,t,i,s){var n=e.c,o=e.e+t+1;if(1===i?s=5<=n[o]:2===i?s=5<n[o]||5==n[o]&&(s||0>o||void 0!==n[o+1]||1&n[o-1]):3===i?s=s||void 0!==n[o]||0>o:(s=!1,0!==i&&r("!Big.RM!")),1>o||!n[0])s?(e.e=-t,e.c=[1]):e.c=[e.e=0];else{if(n.length=o--,s)for(;9<++n[o];)n[o]=0,o--||(++e.e,n.unshift(1));for(o=n.length;!n[--o];n.pop());}return e}function r(e){throw(e=Error(e)).name="BigError",e}var s=-7,n=21,o=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,a=function(){function e(t){if(t instanceof e)this.Cd=t.Cd,this.e=t.e,this.c=t.c.slice();else{var i,s,n;for(0===t&&0>1/t?t="-0":o.test(t+="")||r(NaN),this.Cd="-"==t.charAt(0)?(t=t.slice(1),-1):1,-1<(i=t.indexOf("."))&&(t=t.replace(".","")),0<(s=t.search(/e/i))?(0>i&&(i=s),i+=+t.slice(s+1),t=t.substring(0,s)):0>i&&(i=t.length),s=0;"0"==t.charAt(s);s++);if(s==(n=t.length))this.c=[this.e=0];else{for(;"0"==t.charAt(--n););for(this.e=i-s-1,this.c=[],i=0;s<=n;this.c[i++]=+t.charAt(s++));}}}return e.prototype.abs=function(){var t=new e(this);return t.Cd=1,t},e.prototype.cmp=function(t){var i=this.c,r=(t=new e(t)).c,s=this.Cd,n=t.Cd,o=this.e,a=t.e;if(!i[0]||!r[0])return i[0]?s:r[0]?-n:0;if(s!=n)return s;if(t=0>s,o!=a)return o>(a^t)?1:-1;for(s=-1,n=(o=i.length)<(a=r.length)?o:a;++s<n;)if(i[s]!=r[s])return i[s]>(r[s]^t)?1:-1;return o==a?0:o>(a^t)?1:-1},e.prototype.lm=function(t){var s=this.c,n=(t=new e(t)).c,o=this.Cd==t.Cd?1:-1,a=e.tr;if((a!==~~a||0>a||1e6<a)&&r("!Big.DP!"),!s[0]||!n[0])return s[0]==n[0]&&r(NaN),n[0]||r(o/0),new e(0*o);var l,h,c=n.slice(),u=l=n.length,p=s.length,d=s.slice(0,l),f=d.length,y=t,g=y.c=[],m=0,v=a+(y.e=this.e-t.e)+1;for(y.Cd=o,o=0>v?0:v,c.unshift(0);f++<l;d.push(0));do{for(h=0;10>h;h++){if(l!=(f=d.length))var b=l>f?1:-1;else{var w=-1;for(b=0;++w<l;)if(n[w]!=d[w]){b=n[w]>d[w]?1:-1;break}}if(!(0>b))break;for(t=f==l?n:c;f;){if(d[--f]<t[f]){for(w=f;w&&!d[--w];d[w]=9);--d[w],d[f]+=10}d[f]-=t[f]}for(;!d[0];d.shift());}g[m++]=b?h:++h,d[0]&&b?d[f]=s[u]||0:d=[s[u]]}while((u++<p||void 0!==d[0])&&o--);return g[0]||1==m||(g.shift(),y.e--),m>v&&i(y,a,e.fu,void 0!==d[0]),y},e.prototype.XR=function(){return 0<this.cmp(0)},e.prototype.dT=function(){return 0>this.cmp(0)},e.prototype.jt=function(t){var i,r=this.Cd,s=(t=new e(t)).Cd;if(r!=s)return t.Cd=-s,this.lI(t);var n=this.c.slice(),o=this.e,a=t.c,l=t.e;if(!n[0]||!a[0])return a[0]?(t.Cd=-s,t):new e(n[0]?this:0);if(r=o-l){for((i=0>r)?(r=-r,o=n):(l=o,o=a),o.reverse(),s=r;s--;o.push(0));o.reverse()}else for(o=((i=n.length<a.length)?n:a).length,r=s=0;s<o;s++)if(n[s]!=a[s]){i=n[s]<a[s];break}if(i&&(o=n,n=a,a=o,t.Cd=-t.Cd),0<(s=(o=a.length)-(i=n.length)))for(;s--;n[i++]=0);for(s=i;o>r;){if(n[--o]<a[o]){for(i=o;i&&!n[--i];n[i]=9);--n[i],n[o]+=10}n[o]-=a[o]}for(;0==n[--s];n.pop());for(;0==n[0];)n.shift(),--l;return n[0]||(t.Cd=1,n=[l=0]),t.c=n,t.e=l,t},e.prototype.lI=function(t){var i=this.Cd,r=(t=new e(t)).Cd;if(i!=r)return t.Cd=-r,this.jt(t);r=this.e;var s=this.c,n=t.e,o=t.c;if(!s[0]||!o[0])return o[0]?t:new e(s[0]?this:0*i);if(s=s.slice(),i=r-n){for(0<i?(n=r,r=o):(i=-i,r=s),r.reverse();i--;r.push(0));r.reverse()}for(0>s.length-o.length&&(r=o,o=s,s=r),i=o.length,r=0;i;)r=(s[--i]=s[i]+o[i]+r)/10|0,s[i]%=10;for(r&&(s.unshift(r),++n),i=s.length;0==s[--i];s.pop());return t.c=s,t.e=n,t},e.prototype.pow=function(t){var i=this,s=new e(1),n=s,o=0>t;for((t!==~~t||-1e6>t||1e6<t)&&r("!pow!"),t=o?-t:t;1&t&&(n=n.nr(i)),t>>=1;)i=i.nr(i);return o?s.lm(n):n},e.prototype.round=function(t,s){var n=this;return null==t?t=0:(t!==~~t||0>t||1e6<t)&&r("!round!"),i(n=new e(n),t,null==s?e.fu:s),n},e.prototype.sqrt=function(){var t=this.c,s=this.Cd,n=this.e,o=new e("0.5");if(!t[0])return new e(this);0>s&&r(NaN),0==(s=Math.sqrt(this.toString()))||s==1/0?((s=t.join("")).length+n&1||(s+="0"),(t=new e(Math.sqrt(s).toString())).e=((n+1)/2|0)-(0>n||1&n)):t=new e(s.toString()),s=t.e+(e.tr+=4);do{n=t,t=o.nr(n.lI(this.lm(n)))}while(n.c.slice(0,s).join("")!==t.c.slice(0,s).join(""));return i(t,e.tr-=4,e.fu),t},e.prototype.nr=function(t){var i=this.c,r=(t=new e(t)).c,s=i.length,n=r.length,o=this.e,a=t.e;if(t.Cd=this.Cd==t.Cd?1:-1,!i[0]||!r[0])return new e(0*t.Cd);if(t.e=o+a,s<n){var l=i;i=r,r=l,a=s,s=n,n=a}for(l=Array(a=s+n);a--;l[a]=0);for(o=n;o--;){for(n=0,a=s+o;a>o;)n=l[a]+r[o]*i[a-o-1]+n,l[a--]=n%10,n=n/10|0;l[a]=(l[a]+n)%10}for(n&&++t.e,l[0]||l.shift(),o=l.length;!l[--o];l.pop());return t.c=l,t},e.prototype.toString=function(){var e=this.e,t=this.c.join(""),i=t.length;if(e<=s||e>=n)t=t.charAt(0)+(1<i?"."+t.slice(1):"")+(0>e?"e":"e+")+e;else if(0>e){for(;++e;t="0"+t);t="0."+t}else if(0<e)if(++e>i)for(e-=i;e--;t+="0");else e<i&&(t=t.slice(0,e)+"."+t.slice(e));else 1<i&&(t=t.charAt(0)+"."+t.slice(1));return 0>this.Cd&&this.c[0]?"-"+t:t},e.prototype.toExponential=function(e){return null==e?e=this.c.length-1:(e!==~~e||0>e||1e6<e)&&r("!toExp!"),t(this,e,1)},e.prototype.toFixed=function(e){var i=s,o=n;if(s=-(n=1/0),null==e)var a=this.toString();else e===~~e&&0<=e&&1e6>=e&&(a=t(this,this.e+e),0>this.Cd&&this.c[0]&&0>a.indexOf("-")&&(a="-"+a));return s=i,n=o,a||r("!toFix!"),a},e.prototype.toPrecision=function(e){return null==e?this.toString():((e!==~~e||1>e||1e6<e)&&r("!toPre!"),t(this,e-1,2))},e.tr=20,e.fu=1,e}();e.ip=a}($||($={})),function(e){var t=function(){function t(e){this.lf=e}return t.prototype.qr=function(t,i,r){var s=new e.h,n=new e.h,o=this.lf;r.Wd(t,i,(function(e,t){return o.uc(2*e,s),o.uc(2*t,n),s.compare(n)}))},t.prototype.bq=function(e){return this.lf.read(2*e+1)},t}();e.ri=function(){function i(){}return i.cq=function(t){if(t.B())return!1;var r=t.K();return 1736==r?0!=t.He():1607==r?(r=[!1],i.kE(t,!0,r),r[0]):!(197!=r&&(!e.ba.zd(r)||t.tG()))},i.im=function(t){var r=t.K();if(1736==r)return r=new e.Ua(t.description),t.B()||t.WC(r),r;if(1607==r)return i.kE(t,!1,null);if(197==r)return r=new e.Ua(t.description),t.B()||r.bd(t,!1),r;if(e.ba.zd(r)){if(r=new e.de(t.description),!t.B()&&!t.tG()){var s=new e.Ta;t.Uo(s),r.add(s),t.Qo(s),r.add(s)}return r}if(e.ba.Sn(r))return null;throw e.i.O()},i.kE=function(i,r,s){null!=s&&(s[0]=!1);var n=null;if(r||(n=new e.de(i.description)),!i.B()){var o=new e.ja(0);o.Jb(2*i.ea());for(var a=0,l=i.ea();a<l;a++)if(0<i.Ka(a)&&!i.On(a)){var h=i.Ca(a);o.add(h),h=i.Wc(a)-1,o.add(h)}if(0<o.size){l=new e.Yt,a=i.vb(0),l.sort(o,0,o.size,new t(a)),l=new e.h,a.uc(2*o.get(0),l),h=0;for(var c=1,u=new e.Ta,p=new e.h,d=1,f=o.size;d<f;d++)if(a.uc(2*o.get(d),p),p.rb(l))o.get(h)>o.get(d)?(o.set(h,2147483647),h=d):o.set(d,2147483647),c++;else{if(0==(1&c))o.set(h,2147483647);else if(r)return null!=s&&(s[0]=!0),null;l.N(p),h=d,c=1}if(0==(1&c))o.set(h,2147483647);else if(r)return null!=s&&(s[0]=!0),null;if(!r)for(o.Wd(0,o.size,(function(e,t){return e-t})),d=0,f=o.size;d<f&&2147483647!=o.get(d);d++)i.we(o.get(d),u),n.add(u)}}return r?null:n},i}()}($||($={})),function(e){var t=function(){function t(){this.zf=new e.ja(0),this.zs=new e.ja(0),this.wH=1,this.Fs=NaN}return t.prototype.sort=function(e,t,i,r){if(32>i-t)r.qr(t,i,e);else{var s=!0;try{for(var n=1/0,o=-1/0,a=t;a<i;a++){var l=r.bq(e.get(a));l<n&&(n=l),l>o&&(o=l)}if(this.reset(i-t,n,o,i-t)){for(a=t;a<i;a++){var h=e.get(a);l=r.bq(h);var c=this.rF(l);this.zf.set(c,this.zf.get(c)+1),this.zs.write(a-t,h)}var u=this.zf.get(0);this.zf.set(0,0),a=1;for(var p=this.zf.size;a<p;a++){var d=this.zf.get(a);this.zf.set(a,u),u+=d}for(a=t;a<i;a++){h=this.zs.read(a-t),l=r.bq(h),c=this.rF(l);var f=this.zf.get(c);e.set(f+t,h),this.zf.set(c,f+1)}s=!1}}catch(y){this.zf.resize(0),this.zs.resize(0)}if(s)r.qr(t,i,e);else{for(a=i=0,p=this.zf.size;a<p;a++)s=i,(i=this.zf.get(a))>s&&r.qr(t+s,t+i,e);100<this.zf.size&&(this.zf.resize(0),this.zs.resize(0))}}},t.prototype.reset=function(e,i,r,s){return!(2>e||r==i||(e=Math.min(t.$K,e),this.zf.Jb(e),this.zf.resize(e),this.zf.Xj(0,0,this.zf.size),this.wH=i,this.zs.resize(s),this.Fs=(r-i)/(e-1),0))},t.prototype.rF=function(t){return e.P.truncate((t-this.wH)/this.Fs)},t.$K=65536,t}();e.Yt=t}($||($={})),function(e){var t,i;(i=t||(t={}))[i.enum_line=1]="enum_line",i[i.enum_arc=2]="enum_arc",i[i.enum_dummy=4]="enum_dummy",i[i.enum_concave_dip=8]="enum_concave_dip",i[i.enum_connection=3]="enum_connection";var r=function(){function t(){}return t.Su=function(i,r,s,n,o,a){var l=new t;return l.Km=new e.h,l.Xm=new e.h,l.bw=new e.h,l.Km.N(i),l.Xm.N(r),l.bw.N(s),l.Do=n,l.rh=o,l.th=a,l},t.construct=function(i,r,s,n){var o=new t;return o.Km=new e.h,o.Xm=new e.h,o.bw=new e.h,o.Km.N(i),o.Xm.N(r),o.bw.Sc(),o.Do=4,o.rh=s,o.th=n,o},t}(),s=function(){function t(e,t,i,r,s,n){this.Zv=null,this.za=0,this.yA=e,this.UH=this.SH=0,this.La=t,this.Nj=i,this.vk=r,this.Fq=s,this.Vb=n}return t.prototype.next=function(){for(var t=new e.Ta;;){if(this.za==this.yA.I())return null;if(this.yA.we(this.za,t),this.za++,!t.B())break}var i=!1;if(null==this.Zv&&(this.SH=t.Mg(),this.UH=t.jh(),this.Zv=a.buffer(t,this.La,this.Nj,this.vk,this.Fq,this.Vb),i=!0),this.za<this.yA.I()){var r=new e.Ea;this.Zv.copyTo(r)}else r=this.Zv;if(!i){i=new e.Ed;var s=t.Mg()-this.SH;t=t.jh()-this.UH,i.gg(s,t),r.Pc(i)}return r},t.prototype.Ma=function(){return 0},t.prototype.qe=function(){},t}(),n=function(){function t(e,t){this.Xa=e,this.za=0,this.qq=t}return t.prototype.next=function(){var t=this.Xa.Y;if(this.za<t.ea()){var i=this.za;if(this.za++,!t.On(i))for(var r=t.Oa(t.Wc(i)-1);this.za<t.ea();){var s=t.Oa(t.Ca(this.za));if(t.On(this.za))break;if(s!=r)break;r=t.Oa(t.Wc(this.za)-1),this.za++}if(this.za-i==1)return this.Xa.cE(this.Xa.Y,i,this.qq);for((r=new e.Ua(this.Xa.Y.description)).addPath(this.Xa.Y,i,!0),i+=1;i<this.za;i++)r.Fr(this.Xa.Y,i,0,t.sv(i),!1);return this.Xa.cE(r,0,this.qq)}return null},t.prototype.Ma=function(){return 0},t.prototype.qe=function(){},t}(),o=function(){function e(e){this.Xa=e,this.za=0}return e.prototype.next=function(){var e=this.Xa.Y;if(this.za<e.ea()){var t=this.za;for(e.Kr(this.za),this.za++;this.za<e.ea()&&!(0<e.Kr(this.za));)this.za++;return 0==t&&this.za==e.ea()?this.Xa.ky(e,0,e.ea()):this.Xa.ky(e,t,this.za)}return null},e.prototype.Ma=function(){return 0},e.prototype.qe=function(){},e}(),a=function(){function t(e){this.Ls=this.mw=this.Ms=this.Jd=null,this.$d=[],this.Vb=e,this.sb=this.Lv=this.zT=this.La=this.nA=this.ct=this.ra=0,this.iA=this.vk=-1,this.qq=!0}return t.buffer=function(i,r,s,n,o,a){if(null==i)throw e.i.O();if(0>n)throw e.i.O();if(i.B())return new e.Ea(i.description);var l=new e.l;return i.yc(l),0<r&&l.X(r,r),(a=new t(a)).Nj=s,a.Y=i,a.ra=e.ta.Xd(s,l,!0),a.ct=e.ta.Xd(null,l,!0),a.La=r,a.zT=i.K(),0>=o&&(o=96),a.sb=Math.abs(a.La),a.Lv=0!=a.sb?1/a.sb:0,isNaN(n)||0==n?n=1e-5*a.sb:n>.5*a.sb&&(n=.5*a.sb),12>o&&(o=12),(i=Math.abs(r)*(1-Math.cos(Math.PI/o)))>n?n=i:(i=Math.PI/Math.acos(1-n/Math.abs(r)))<o-1&&12>(o=e.P.truncate(i))&&(o=12,n=Math.abs(r)*(1-Math.cos(Math.PI/o))),a.vk=n,a.Fq=o,a.nA=Math.min(a.ct,.25*n),a.dE()},t.prototype.dv=function(){if(null==this.Jd)this.Jd=[];else if(0!==this.Jd.length)return;var t=this.iE();t=e.P.truncate((t+3)/4);var i=.5*Math.PI/t;this.iA=i;for(var r=0;r<4*t;r++)this.Jd.push(null);var s=Math.cos(i);i=Math.sin(i);var n=e.h.construct(0,1);for(r=0;r<t;r++)this.Jd[r+0*t]=e.h.construct(n.y,-n.x),this.Jd[r+1*t]=e.h.construct(-n.x,-n.y),this.Jd[r+2*t]=e.h.construct(-n.y,n.x),this.Jd[r+3*t]=n,(n=e.h.construct(n.x,n.y)).Bt(s,i)},t.prototype.dE=function(){var t=this.Y.K();if(e.ba.zd(t))return(t=new e.Ua(this.Y.description)).oc(this.Y,!0),this.Y=t,this.dE();if(this.La<=this.ra){if(!e.ba.KS(t))return new e.Ea(this.Y.description);if(0>=this.La&&(t=new e.l,this.Y.A(t),t.S()<=2*-this.La||t.da()<=2*this.La))return new e.Ea(this.Y.description)}switch(this.Y.K()){case 33:return this.HN();case 550:return this.GN();case 1607:return this.JN();case 1736:return this.IN();case 197:return this.DN();default:throw e.i.Ra()}},t.prototype.JN=function(){if(this.wG(this.Y)){var t=new e.Ta;this.Y.we(0,t);var i=new e.l;return this.Y.A(i),t.Db(i.tf()),this.Hu(t)}return this.Y=this.MV(this.Y),t=new n(this,this.qq),e.Hh.local().W(t,this.Nj,this.Vb).next()},t.prototype.IN=function(){if(0==this.La)return this.Y;var t=e.$l.local();if(this.dv(),this.Y=t.W(this.Y,null,!1,this.Vb),0>this.La){var i=this.Y;return i=this.ky(i,0,i.ea()),t.W(i,this.Nj,!1,this.Vb)}return this.wG(this.Y)?(t=new e.Ta,this.Y.we(0,t),i=new e.l,this.Y.A(i),t.Db(i.tf()),this.Hu(t)):(t=new o(this),e.Hh.local().W(t,this.Nj,this.Vb).next())},t.prototype.ky=function(i,r,s){for(var n=new e.Ea(i.description);r<s;r++)if(!(1>i.Ka(r))){var o=i.Kr(r),a=new e.l;if(i.Sj(r,a),0<this.La){if(0<o)if(this.xG(i,r))o=new e.Ta,i.we(i.Ca(r),o),o.Db(a.tf()),this.zu(n,o);else{var l=o=new e.Ua(i.description);l=e.$t.BG(this.Y,r)||2==this.An(this.Y,r,l,!0,1)?this.bE(i,r):this.zn(o),n.add(l,!1)}else if(!(a.S()+this.ra<=2*this.sb||a.da()+this.ra<=2*this.sb||(l=o=new e.Ua(i.description),this.An(this.Y,r,l,!0,1),o.B()))){var h=new e.l;for(h.L(a),h.X(this.sb,this.sb),l.vp(h),a=1,o=(l=this.zn(o)).ea();a<o;a++)n.addPath(l,a,!0)}}else if(0<o){if(!(a.S()+this.ra<=2*this.sb||a.da()+this.ra<=2*this.sb||(l=o=new e.Ua(i.description),this.An(this.Y,r,l,!0,-1),o.B())))for(h=new e.l,l.yc(h),h.X(this.sb,this.sb),l.vp(h),a=1,o=(l=this.zn(o)).ea();a<o;a++)n.addPath(l,a,!0)}else for(l=o=new e.Ua(i.description),this.An(this.Y,r,l,!0,-1),a=0,o=(l=this.zn(o)).ea();a<o;a++)n.addPath(l,a,!0)}if(0<this.La)return 1<n.ea()?n=this.zn(n):t.jx(n);if(i=new e.l,n.yc(i),n.B())return t.jx(n);for(i.X(this.sb,this.sb),n.vp(i),n=this.zn(n),i=new e.Ea(n.description),a=1,o=n.ea();a<o;a++)i.addPath(n,a,!1);return t.jx(i)},t.prototype.HN=function(){return this.Hu(this.Y)},t.prototype.Hu=function(t){var i=new e.Ea(this.Y.description);return this.zu(i,t),this.gX(i)},t.prototype.GN=function(){var t=new s(this.Y,this.La,this.Nj,this.vk,this.Fq,this.Vb);return e.Hh.local().W(t,this.Nj,this.Vb).next()},t.prototype.DN=function(){var t=new e.Ea(this.Y.description);if(0>=this.La){if(0==this.La)t.bd(this.Y,!1);else{var i=new e.Gh;this.Y.dn(i),i.X(this.La,this.La),t.bd(i,!1)}return t}return t.bd(this.Y,!1),this.Y=t,this.bE(t,0)},t.prototype.bE=function(i,r){this.dv();var s=new e.Ea(i.description),n=new e.h,o=new e.h,a=new e.h,l=new e.h,h=new e.h,c=new e.h,u=new e.h,p=new e.h,d=i.Ka(r),f=i.Ca(r),y=0;for(r=i.Ka(r);y<r;y++){if(i.D(f+y,o),i.D(f+(y+1)%d,l),i.D(f+(y+2)%d,c),u.vc(l,o),0==u.length())throw e.i.Ra();if(u.Iv(),u.normalize(),u.scale(this.sb),n.add(u,o),a.add(u,l),0==y?s.Mt(n):s.Di(n),s.Di(a),p.vc(c,l),0==p.length())throw e.i.Ra();p.Iv(),p.normalize(),p.scale(this.sb),h.add(p,l),this.yD(s,l,a,h,!1)}return t.jx(s)},t.prototype.cE=function(t,i,r){if(this.dv(),1>t.Ka(i))return null;if(this.xG(t,i)&&0<this.La){r=new e.Ta,t.we(t.Ca(i),r);var s=new e.l;return t.Sj(i,s),r.Db(s.tf()),this.Hu(r)}if(s=new e.Ua(t.description),t.On(i))this.An(t,i,s,r,1),this.An(t,i,s,r,-1);else{var n=new e.Ua(t.description);n.addPath(t,i,!1),n.Fr(t,i,0,t.sv(i),!1),this.An(n,0,s,r,1)}return this.zn(s)},t.prototype.Zq=function(){if(this.Zs++,this.Zs%1024==0&&null!=this.Vb&&!this.Vb.progress(-1,-1))throw e.i.gu("user_canceled")},t.prototype.zn=function(t){return e.Hg.Mk(t,this.ct,!0,!0,this.Vb)},t.prototype.iE=function(){if(0==this.vk)return this.Fq;var t=1-this.vk*Math.abs(this.Lv);return 4>(t=-1>t?4:2*Math.PI/Math.acos(t)+.5)?t=4:t>this.Fq&&(t=this.Fq),e.P.truncate(t)},t.prototype.yD=function(t,i,r,s,n){this.dv();var o=new e.h;o.vc(r,i),o.scale(this.Lv);var a=new e.h;a.vc(s,i),a.scale(this.Lv),0>(o=Math.atan2(o.y,o.x)/this.iA)&&(o=this.Jd.length+o),o=this.Jd.length-o,0>(a=Math.atan2(a.y,a.x)/this.iA)&&(a=this.Jd.length+a),(a=this.Jd.length-a)<o&&(a+=this.Jd.length);var l=e.P.truncate(a);a=e.P.truncate(Math.ceil(o)),(o=new e.h).N(this.Jd[a%this.Jd.length]),o.Ct(this.sb,i);var h=10*this.ra;for(o.sub(r),o.length()<h&&(a+=1),o.N(this.Jd[l%this.Jd.length]),o.Ct(this.sb,i),o.sub(s),o.length()<h&&--l,r=l-a,r++,l=0,a%=this.Jd.length;l<r;l++,a=(a+1)%this.Jd.length)o.N(this.Jd[a]),o.Ct(this.sb,i),t.Di(o),this.Zq();n&&t.Di(s)},t.prototype.An=function(t,i,s,n,o){var a=new e.hd,l=a.eN(t,i);if(a.Ip(this.nA,!1,!1),2>a.I(l))return 0>o||(o=t,a=new e.Ta,o.we(o.Ca(i),a),this.zu(s,a)),1;var h=a.Oa(a.Ya(a.Ob(l))),c=new e.Ed;if(c.gg(-h.x,-h.y),a.Pc(c),n&&(this.lQ(a,l,o),2>a.I(l)))return 0>o||(o=t,a=new e.Ta,o.we(o.Ca(i),a),this.zu(s,a)),1;this.$d.length=0;var u=a.Ob(l);i=a.Ya(u);var p=1==o?a.Na(i):a.V(i);t=1==o?a.V(i):a.Na(i);var d=!0;n=new e.h,l=new e.h;var f=new e.h,y=new e.h,g=new e.h,m=new e.h,v=new e.h,b=new e.h,w=new e.h,_=new e.h,x=this.sb;u=a.Ka(u);for(var S=0;S<u;S++)a.D(t,l),d&&(a.D(i,n),a.D(p,f),b.vc(n,f),b.normalize(),_.EG(b),_.scale(x),y.add(_,n)),v.vc(l,n),v.normalize(),w.EG(v),w.scale(x),g.add(n,w),p=b.xi(v),d=b.Rh(v),0>p||0>d&&0==p?this.$d.push(r.Su(y,g,n,2,this.$d.length+1,this.$d.length-1)):y.rb(g)||(this.$d.push(r.construct(y,n,this.$d.length+1,this.$d.length-1,"dummy")),this.$d.push(r.construct(n,g,this.$d.length+1,this.$d.length-1,"dummy"))),m.add(l,w),this.$d.push(r.Su(g,m,n,1,this.$d.length+1,this.$d.length-1)),y.N(m),_.N(w),f.N(n),n.N(l),b.N(v),p=i,i=t,d=!1,t=1==o?a.V(i):a.Na(i);return this.$d[this.$d.length-1].rh=0,this.$d[0].th=this.$d.length-1,this.OV(s),c.gg(h.x,h.y),s.QD(c,s.ea()-1),1},t.prototype.OV=function(e){for(var t=this.rO(),i=!0,r=t+1,s=t;r!=t;s=r){var n=this.$d[s];r=-1!=n.rh?n.rh:(s+1)%this.$d.length,0!=n.Do&&(i&&e.Mt(n.Km),2==n.Do?this.yD(e,n.bw,n.Km,n.Xm,!0):e.Di(n.Xm),i=!1)}},t.prototype.rO=function(){null==this.Ls&&(this.Ls=[null,null,null,null,null,null,null,null,null]);for(var t=0,i=0,r=this.$d.length;i<r;){var s=this.$d[i];if(0!=(3&s.Do)){t=i;break}i=s.rh}for(r=t+1,i=t;r!=t;i=r){r=(s=this.$d[i]).rh;for(var n=1,o=null;r!=i&&0==(3&(o=this.$d[r]).Do);)r=o.rh,n++;1!=n&&1==(s.Do&o.Do)&&(null==this.Ms&&(this.Ms=new e.zb,this.mw=new e.zb),this.Ms.Ec(s.Km),this.Ms.Rc(s.Xm),this.mw.Ec(o.Km),this.mw.Rc(o.Xm),1==this.Ms.Fa(this.mw,this.Ls,null,null,this.ct)&&(s.Xm.N(this.Ls[0]),o.Km.N(this.Ls[0]),s.rh=r,o.th=i))}return t},t.prototype.Gv=function(t,i,r){var s=new e.h;if(s.vc(r,t),r=s.length(),0<(r=this.sb*this.sb-r*r*.25)){r=Math.sqrt(r),s.normalize(),s.cr();var n=new e.h;if(n.vc(i,t),n.Rh(s)+r>=this.sb)return!0}return!1},t.prototype.lQ=function(t,i,r){for(var s=0;1>s;s++){var n=!1,o=t.Ob(i),a=t.Ka(o);if(0==a)break;var l=a;if(3>a)break;!t.ec(o)&&(l=a-1),o=t.Ya(o),a=0<r?t.Na(o):t.V(o);for(var h=0<r?t.V(o):t.Na(o),c=a,u=!0,p=new e.h,d=new e.h,f=new e.h,y=new e.h,g=new e.h,m=e.h.construct(0,0),v=new e.h,b=new e.h,w=new e.h,_=new e.h,x=this.sb,S=0,M=0;M<l&&(t.D(h,d),u&&(t.D(o,p),t.D(a,f),c=a),b.vc(p,f),b.normalize(),v.vc(d,p),v.normalize(),c!=h);){var T=b.xi(v),I=b.Rh(v),E=!0;if(0>T||0>I&&0==T||!this.Gv(f,p,d)||(m.N(d),E=!1,++S,n=!0),E){if(0<S)for(;(T=0<r?t.Na(c):t.V(c))!=o;){if(t.D(T,y),!this.Gv(y,f,m)){T!=h&&this.Gv(y,f,d)&&this.Gv(y,p,d)&&(f.N(y),c=T,E=!1,++S);break}f.N(y),c=T,E=!1,++S}if(!E)continue;if(0<S){for(c=0<r?t.Na(a):t.V(a),u=1;u<S;u++)E=0<r?t.Na(c):t.V(c),t.pd(c,!0),c=E;w.vc(p,f),S=x*x-(S=w.length())*S*.25,x-(S=Math.sqrt(S))>.5*this.vk?(g.add(f,p),g.scale(.5),w.normalize(),w.cr(),_.N(w),_.scale(x-S),g.add(_),t.mf(a,g)):t.pd(a,!0),S=0}f.N(p),c=o}p.N(d),a=o,o=h,h=0<r?t.V(o):t.Na(o),M++,u=!1}if(0<S){for(c=0<r?t.Na(a):t.V(a),u=1;u<S;u++)E=0<r?t.Na(c):t.V(c),t.pd(c,!0),c=E;g.add(f,p),g.scale(.5),w.vc(p,f),S=x*x-(S=w.length())*S*.25,S=Math.sqrt(S),w.normalize(),w.cr(),_.N(w),_.scale(x-S),g.add(_),t.mf(a,g)}if(t.Ip(this.nA,!1,!1),!n)break}},t.prototype.xG=function(t,i){if(1==t.Ka(i))return!0;var r=new e.l;return t.Sj(i,r),Math.max(r.S(),r.da())<.5*this.vk},t.prototype.wG=function(t){var i=new e.l;return t.A(i),Math.max(i.S(),i.da())<.5*this.vk},t.prototype.MV=function(t){for(var i=0,r=0,s=(t=e.wC.local().W(t,.25*this.vk,!1,this.Vb)).ea();r<s;r++)i=Math.max(t.Ka(r),i);return 32>i?(this.qq=!1,t):(this.qq=!0,e.Hg.Mk(t,this.ct,!1,!0,this.Vb))},t.prototype.zu=function(t,i){if(i=i.D(),null!=this.Jd&&0!==this.Jd.length){var r=new e.h;r.N(this.Jd[0]),r.Ct(this.sb,i),t.Mt(r);for(var s=1,n=this.Jd.length;s<n;s++)r.N(this.Jd[s]),r.Ct(this.sb,i),t.Di(r)}else{s=this.iE(),r=e.P.truncate((s+3)/4),s=.5*Math.PI/r,n=Math.cos(s);for(var o=Math.sin(s),a=new e.h,l=3;0<=l;l--){switch(a.na(0,this.sb),l){case 0:for(s=0;s<r;s++)t.zj(a.x+i.x,a.y+i.y),a.Bt(n,o);break;case 1:for(s=0;s<r;s++)t.zj(-a.y+i.x,a.x+i.y),a.Bt(n,o);break;case 2:for(s=0;s<r;s++)t.zj(-a.x+i.x,-a.y+i.y),a.Bt(n,o);break;default:for(t.qx(a.y+i.x,-a.x+i.y),s=1;s<r;s++)a.Bt(n,o),t.zj(a.y+i.x,-a.x+i.y)}this.Zq()}}},t.jx=function(e){return e.Dh(1,0),e},t.prototype.gX=function(e){return e.Dh(2,this.ra),e.hm(),e},t}();e.zK=a}($||($={})),function(e){var t=function(){function t(t){this.Da=t,this.g=new e.hd,this.ed=new e.ja(0)}return t.prototype.Mh=function(e,t,i){switch(t){case 0:if(e.v<i&&e.C<=i)break;return e.v>=i?1:-1;case 1:if(e.G<i&&e.H<=i)break;return e.G>=i?1:-1;case 2:if(e.v>=i&&e.C>i)break;return e.C<=i?1:-1;case 3:if(!(e.G>=i&&e.H>i))return e.H<=i?1:-1}return 0},t.prototype.uy=function(e,t){return 1736==e.K()?this.wy(e,t):this.xy(e)},t.prototype.wy=function(t,i){if(0==this.Da.S()||0==this.Da.da())return t.Ja();var r=new e.l;t.yc(r),this.Y=this.g.Ib(t);var s=new e.l,n=new e.l,o=new e.h,a=new e.h,l=[0,0,0,0,0,0,0,0,0],h=[0,0,0,0,0,0,0,0,0];new e.hg;var c=new e.zb,u=new e.ja(0);u.Jb(Math.min(100,t.I()));for(var p=!1,d=0;!p&&4>d;d++){var f=!1,y=0!=(1&d),g=0;switch(d){case 0:g=this.Da.v,f=r.v<=g&&r.C>=g;break;case 1:g=this.Da.G,f=r.G<=g&&r.H>=g;break;case 2:g=this.Da.C,f=r.v<=g&&r.C>=g;break;case 3:g=this.Da.H,f=r.G<=g&&r.H>=g}if(f)for(p=!0,f=this.g.Ob(this.Y);-1!=f;){var m=-1,v=-1,b=this.g.Ya(f),w=b;do{var _=this.g.cc(w);null==_&&(_=c,this.g.D(w,o),_.Ec(o),this.g.D(this.g.V(w),a),_.Rc(a)),_.A(s);var x=this.Mh(s,d,g),S=0,M=-1;if(-1==x){S=0<(_=_.fq(y,g,l,h))?this.g.Wl(w,h,_):0,S+=1;var T=w,I=this.g.V(T);for(_=0;_<S;_++){if(this.g.D(T,o),this.g.D(I,a),null==(M=this.g.cc(T))&&((M=c).Ec(o),M.Rc(a)),M.A(n),-1==(M=this.Mh(n,d,g))){if(y)(M=Math.abs(o.y-g))<(E=Math.abs(a.y-g))?(o.y=g,this.g.mf(T,o)):(a.y=g,this.g.mf(I,a));else{M=Math.abs(o.x-g);var E=Math.abs(a.x-g);M<E?(o.x=g,this.g.mf(T,o)):(a.x=g,this.g.mf(I,a))}null==(M=this.g.cc(T))&&((M=c).Ec(o),M.Rc(a)),M.A(n),M=this.Mh(n,d,g)}E=m,m=M,-1==v&&(v=m),0==E&&1==m||1==E&&0==m||0!=E||0!=m||u.add(T),1==m&&(p=!1),M=T=I,I=this.g.V(I)}}0==S&&(E=m,m=x,-1==v&&(v=m),0==E&&1==m||1==E&&0==m||0!=E||0!=m||u.add(w),1==m&&(p=!1),M=this.g.V(w)),w=M}while(w!=b);for(0==v&&0==m&&u.add(b),_=0,m=u.size;_<m;_++)v=u.get(_),this.g.pd(v,!1);u.clear(!1),f=3>this.g.Ka(f)?this.g.ar(f):this.g.Sb(f)}}return p?t.Ja():(this.zB(),0<i&&this.Hy(i),this.g.Ke(this.Y))},t.prototype.xy=function(t){var i=new e.l,r=new e.l,s=[0,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,0],o=new e.hg,a=t,l=new e.l;t.yc(l);for(var h=0;4>h;h++){var c=!1,u=0!=(1&h),p=0;switch(h){case 0:p=this.Da.v,c=l.v<=p&&l.C>=p;break;case 1:p=this.Da.G,c=l.G<=p&&l.H>=p;break;case 2:p=this.Da.C,c=l.v<=p&&l.C>=p;break;case 3:p=this.Da.H,c=l.G<=p&&l.H>=p}if(c){c=a,a=t.Ja(),(c=c.Ha()).$i();for(var d,f=new e.h;c.ab();)for(var y,g=!0;c.Ia();){var m=c.ia();m.A(i);var v=this.Mh(i,h,p);if(-1==v){if(0<(v=m.fq(u,p,s,n))){var b=0;d=m.ac();for(var w=0;w<=v;w++)if(b!=(y=w<v?n[w]:1)){m.bh(b,y,o);var _=o.get();_.Ec(d),w<v&&(u?(f.x=s[w],f.y=p):(f.x=p,f.y=s[w]),_.Rc(f)),_.A(r);var x=this.Mh(r,h,p);if(-1==x){if(d=_.ac(),b=_.xc(),u)(x=Math.abs(d.y-p))<(S=Math.abs(b.y-p))?(d.y=p,_.Ec(d)):(b.y=p,_.Rc(b));else{x=Math.abs(d.x-p);var S=Math.abs(b.x-p);x<S?(d.x=p,_.Ec(d)):(b.x=p,_.Rc(b))}_.A(r),x=this.Mh(r,h,p)}d=_.xc(),b=y,1==(y=x)?(a.oc(_,g),g=!1):g=!0}}}else 1==(y=v)?(a.oc(m,g),g=!1):g=!0}}}return a},t.prototype.zB=function(){this.ki=-1,this.Xl(!1,this.Da.v),this.Xl(!1,this.Da.C),this.Xl(!0,this.Da.G),this.Xl(!0,this.Da.H),this.ed.resize(0),this.ed.Jb(100),this.ki=this.g.Hd();for(var t=new e.h,i=this.g.Ob(this.Y);-1!=i;i=this.g.Sb(i))for(var r=this.g.Ya(i),s=0,n=this.g.Ka(i);s<n;s++,r=this.g.V(r))this.g.D(r,t),(this.Da.v==t.x||this.Da.C==t.x||this.Da.G==t.y||this.Da.H==t.y)&&(this.g.Sa(r,this.ki,this.ed.size),this.ed.add(r));this.Pl(!1,this.Da.v),this.Pl(!1,this.Da.C),this.Pl(!0,this.Da.G),this.Pl(!0,this.Da.H),this.Oy()},t.prototype.Hy=function(t){for(var i=new e.h,r=new e.h,s=e.P.lg(2048,0),n=this.g.Ob(this.Y);-1!=n;n=this.g.Sb(n)){var o=this.g.Ya(n),a=o;do{var l=this.g.V(a);this.g.D(a,i);var h=-1;if(i.x==this.Da.v?(this.g.D(l,r),r.x==this.Da.v&&(h=1)):i.x==this.Da.C&&(this.g.D(l,r),r.x==this.Da.C&&(h=1)),i.y==this.Da.G?(this.g.D(l,r),r.y==this.Da.G&&(h=0)):i.y==this.Da.H&&(this.g.D(l,r),r.y==this.Da.H&&(h=0)),-1!=h&&(h=e.h.ub(i,r),!(1>=(h=e.P.truncate(Math.min(Math.ceil(h/t),2048)))))){for(var c=1;c<h;c++)s[c-1]=1*c/h;this.g.Wl(a,s,h-1)}a=l}while(a!=o)}},t.prototype.Xl=function(t,i){var r=this.g.Hd(),s=new e.h,n=new e.ja(0);n.Jb(100);for(var o=this.g.Ob(this.Y);-1!=o;o=this.g.Sb(o))for(var a=this.g.Ya(o),l=0,h=this.g.Ka(o);l<h;l++){var c=this.g.V(a);this.g.D(a,s),(t?s.y==i:s.x==i)&&(this.g.D(c,s),(t?s.y==i:s.x==i)&&(1!=this.g.Qa(a,r)&&(n.add(a),this.g.Sa(a,r,1)),1!=this.g.Qa(c,r)&&(n.add(c),this.g.Sa(c,r,1)))),a=c}if(this.g.Ud(r),!(3>n.size)){var u=this;n.Wd(0,n.size,(function(e,t){return u.Nh(e,t)})),r=new e.h,o=new e.h,a=new e.h,o.Sc();var p=-1;l=new e.ja(0),h=new e.ja(0),c=this.g.Hd();for(var d=this.g.Hd(),f=0,y=n.size;f<y;f++){var g=n.get(f);if(this.g.D(g,s),!s.rb(o)){if(-1!=p){for(var m=p;m<f;m++){p=n.get(m);var v=this.g.V(p);g=this.g.Na(p);var b=!1;0>this.Nh(p,v)&&(this.g.D(v,r),t?r.y==i:r.x==i)&&(l.add(p),b=!0,this.g.Sa(p,d,1)),0>this.Nh(p,g)&&(this.g.D(g,r),t?r.y==i:r.x==i)&&(b||l.add(p),this.g.Sa(p,c,1))}for(m=0,b=l.size;m<b;m++){if(p=l.get(m),g=this.g.Qa(p,c),v=this.g.Qa(p,d),1==g){g=this.g.Na(p),this.g.D(g,a);var w=[0];if(w[0]=0,!a.rb(s)){var _=e.h.ub(o,a);w[0]=e.h.ub(a,s)/_,0==w[0]?w[0]=2220446049250313e-31:1==w[0]&&(w[0]=.9999999999999998),this.g.Wl(g,w,1),g=this.g.Na(p),this.g.mf(g,s),h.add(g),this.g.Sa(g,c,1),this.g.Sa(g,d,-1)}}1==v&&(v=this.g.V(p),this.g.D(v,a),(w=[0])[0]=0,a.rb(s)||(_=e.h.ub(o,a),w[0]=e.h.ub(o,s)/_,0==w[0]?w[0]=2220446049250313e-31:1==w[0]&&(w[0]=.9999999999999998),this.g.Wl(p,w,1),g=this.g.V(p),this.g.mf(g,s),h.add(g),this.g.Sa(g,c,-1),this.g.Sa(g,d,1)))}p=l,l=h,(h=p).clear(!1)}p=f,o.N(s)}}this.g.Ud(c),this.g.Ud(d)}},t.prototype.Pl=function(t,i){var r=new e.h,s=new e.ja(0);s.Jb(100);for(var n=this.g.Hd(),o=0,a=this.ed.size;o<a;o++){var l=this.ed.get(o);if(-1!=l){var h=this.g.V(l);this.g.D(l,r),(t?r.y==i:r.x==i)&&(this.g.D(h,r),(t?r.y==i:r.x==i)&&(-2!=this.g.Qa(l,n)&&(s.add(l),this.g.Sa(l,n,-2)),-2!=this.g.Qa(h,n)&&(s.add(h),this.g.Sa(h,n,-2))))}}if(0!=s.size){var c=this;for(s.Wd(0,s.size,(function(e,t){return c.Nh(e,t)})),o=0,a=s.size;o<a;o++){var u=s.get(o);this.g.Sa(u,n,o)}l=new e.h,(h=new e.h).Sc();var p=-1;for(o=0,a=s.size;o<a;o++)if(-1!=(u=s.get(o))&&(this.g.D(u,r),!r.rb(h))){if(-1!=p)for(;;){u=!1;for(var d=1<o-p?o-1:o,f=p;f<d;f++){var y=s.get(f);if(-1!=y){var g=-1,m=this.g.V(y);0>this.Nh(y,m)&&(this.g.D(m,l),t?l.y==i:l.x==i)&&(g=m),m=-1;var v=this.g.Na(y);if(0>this.Nh(y,v)&&(this.g.D(v,l),t?l.y==i:l.x==i)&&(m=v),-1!=g&&-1!=m)this.Lh(y,s,n),this.g.pd(y,!1),this.Lh(g,s,n),this.g.pd(g,!1),u=!0;else if(-1!=g||-1!=m){for(v=f+1;v<o;v++){var b=s.get(v);if(-1!=b){var w=this.g.V(b),_=-1;0>this.Nh(b,w)&&(this.g.D(w,l),t?l.y==i:l.x==i)&&(_=w),w=this.g.Na(b);var x=-1;if(0>this.Nh(b,w)&&(this.g.D(w,l),t?l.y==i:l.x==i)&&(x=w),-1!=_&&-1!=x){this.Lh(b,s,n),this.g.pd(b,!1),this.Lh(_,s,n),this.g.pd(_,!1),u=!0;break}if(-1!=g&&-1!=x){this.zt(s,y,g,b,x,n),u=!0;break}if(-1!=m&&-1!=_){this.zt(s,b,_,y,m,n),u=!0;break}}}if(u)break}}}if(!u)break}p=o,h.N(r)}}this.g.Ud(n)},t.prototype.Lh=function(e,t,i){i=this.g.Qa(e,i),t.set(i,-1),i=this.g.Qa(e,this.ki),this.ed.set(i,-1),-1!=(t=this.g.cd(e))&&this.g.Ya(t)==e&&(this.g.Kf(t,-1),this.g.Xg(t,-1))},t.prototype.zt=function(e,t,i,r,s,n){this.g.Cc(t,r),this.g.Dc(r,t),this.g.Dc(i,s),this.g.Cc(s,i),this.Lh(r,e,n),this.g.ni(r,!1),this.Lh(s,e,n),this.g.ni(s,!0)},t.prototype.Oy=function(){for(var e=0,t=this.ed.size;e<t;e++){var i=this.ed.get(e);-1!=i&&this.g.bj(i,-1)}for(var r=0,s=0,n=this.g.Ob(this.Y);-1!=n;){var o=this.g.Ya(n);if(-1==o||n!=this.g.cd(o)){var a=n;n=this.g.Sb(n),this.g.Kf(a,-1),this.g.br(a)}else{i=o,a=0;do{this.g.bj(i,n),a++,i=this.g.V(i)}while(i!=o);2>=a?(i=this.g.Qa(o,this.ki),this.ed.set(i,-1),o=this.g.pd(o,!1),2==a&&(i=this.g.Qa(o,this.ki),this.ed.set(i,-1),this.g.pd(o,!1)),a=n,n=this.g.Sb(n),this.g.Kf(a,-1),this.g.br(a)):(this.g.ep(n,!1),this.g.Xg(n,this.g.Na(o)),this.g.Wj(n,a),s+=a,r++,n=this.g.Sb(n))}}for(e=0,t=this.ed.size;e<t;e++)if(-1!=(i=this.ed.get(e))&&-1==(n=this.g.cd(i))){n=this.g.wf(this.Y,-1),a=0,o=i;do{this.g.bj(i,n),a++,i=this.g.V(i)}while(i!=o);2>=a?(i=this.g.Qa(o,this.ki),this.ed.set(i,-1),o=this.g.pd(o,!1),2==a&&(0<=(i=this.g.Qa(o,this.ki))&&this.ed.set(i,-1),this.g.pd(o,!1)),a=n,this.g.Kf(a,-1),this.g.br(a)):(this.g.mn(n,!0),this.g.Wj(n,a),this.g.Kf(n,o),this.g.Xg(n,this.g.Na(o)),this.g.ep(n,!1),s+=a,r++)}for(this.g.Tl(this.Y,r),this.g.Uj(this.Y,s),e=0,t=this.g.ld;-1!=t;t=this.g.ve(t))e+=this.g.I(t);this.g.VB(e)},t.vy=function(e,i,r){return new t(i).uy(e,r)},t.clip=function(i,r,s,n){if(i.B())return i;if(r.B())return i.Ja();if(33==(s=i.K()))return n=i.D(),r.contains(n)?i:i.Ja();if(197==s)return n=new e.l,i.A(n),n.Fa(r)?(r=new e.Gh,i.copyTo(r),r.Yo(n),r):i.Ja();var o=new e.l;if(i.yc(o),r.contains(o))return i;if(!r.isIntersecting(o))return i.Ja();if(null!=(o=i.Cb)&&null!=(o=o.Fk)){if(1==(o=o.So(r))){if(1736!=s)throw e.i.Ra();return(i=new e.Ea(i.description)).vp(r),i}if(0==o)return i.Ja()}switch(s){case 550:s=null,o=i.I();for(var a=i.vb(0),l=0,h=0;h<o;h++)n=new e.h,a.uc(2*h,n),r.contains(n)||(0==l&&(s=i.Ja()),l<h&&s.Gd(i,l,h),l=h+1);return 0<l&&s.Gd(i,l,o),0==l?i:s;case 1736:case 1607:return t.vy(i,r,n);default:throw e.i.Ra()}},t.prototype.Nh=function(t,i){var r=new e.h;return this.g.D(t,r),t=new e.h,this.g.D(i,t),r.compare(t)},t}();e.Vd=t}($||($={})),function(e){var t=function(){function t(t,i){this.Da=t,this.g=new e.hd,this.ed=new e.ja(0),this.nd=i}return t.prototype.Mh=function(e,t,i){switch(t){case 0:if(e.v<i&&e.C<=i)break;return e.v>=i?1:-1;case 1:if(e.G<i&&e.H<=i)break;return e.G>=i?1:-1;case 2:if(e.v>=i&&e.C>i)break;return e.C<=i?1:-1;case 3:if(!(e.G>=i&&e.H>i))return e.H<=i?1:-1}return 0},t.prototype.uy=function(e,t){return 1736==e.K()?this.wy(e,t):this.xy(e)},t.prototype.wy=function(t,i){if(0==this.Da.S()||0==this.Da.da())return t.Ja();var r=new e.l;t.yc(r),this.Y=this.g.Ib(t);var s=new e.l,n=new e.l,o=new e.h,a=new e.h,l=[0,0,0,0,0,0,0,0,0],h=[0,0,0,0,0,0,0,0,0],c=new e.zb,u=new e.ja(0);u.Jb(256);for(var p=!1,d=0;!p&&4>d;d++){var f=!1,y=0!=(1&d),g=0;switch(d){case 0:g=this.Da.v,f=r.v<=g&&r.C>=g;break;case 1:g=this.Da.G,f=r.G<=g&&r.H>=g;break;case 2:g=this.Da.C,f=r.v<=g&&r.C>=g;break;case 3:g=this.Da.H,f=r.G<=g&&r.H>=g}if(f)for(p=!0,f=this.g.Ob(this.Y);-1!=f;){var m=!0,v=-1,b=-1,w=this.g.Ya(f),_=w;do{var x=this.g.cc(_);null==x&&(x=c,this.g.D(_,o),x.Ec(o),this.g.D(this.g.V(_),a),x.Rc(a)),x.A(s);var S=this.Mh(s,d,g),M=0,T=-1;if(-1==S){M=0<(x=x.fq(y,g,l,h))?this.g.zX(_,h,x):0,M+=1;var I=_,E=this.g.V(I);for(x=0;x<M;x++){if(this.g.D(I,o),this.g.D(E,a),null==(T=this.g.cc(I))&&((T=c).Ec(o),T.Rc(a)),T.A(n),-1==(T=this.Mh(n,d,g))){if(y)(T=Math.abs(o.y-g))<(A=Math.abs(a.y-g))?(o.y=g,this.g.mf(I,o)):(a.y=g,this.g.mf(E,a));else{T=Math.abs(o.x-g);var A=Math.abs(a.x-g);T<A?(o.x=g,this.g.mf(I,o)):(a.x=g,this.g.mf(E,a))}null==(T=this.g.cc(I))&&((T=c).Ec(o),T.Rc(a)),T.A(n),T=this.Mh(n,d,g)}A=v,v=T,-1==b&&(b=v),0==A&&1==v||1==A&&0==v||0!=A||0!=v||u.add(I),1==v&&(m=p=!1),T=I=E,E=this.g.V(E)}}if(0==M&&(A=v,v=S,-1==b&&(b=v),0==A&&1==v||1==A&&0==v||0!=A||0!=v||u.add(_),1==v&&(m=p=!1),T=this.g.V(_)),_=T,256<=u.size){for(x=1,S=u.size-1;x<S;x++)M=u.get(x),this.g.pd(M,!1);u.set(1,u.Gc()),u.Ch(2)}}while(_!=w);if(!m)for(0==b&&0==v&&u.add(w),x=0,S=u.size;x<S;x++)M=u.get(x),this.g.pd(M,!1);u.clear(!1),f=m||0==this.g.Ka(f)?this.g.ar(f):this.g.Sb(f)}}return p?t.Ja():(this.zB(),0<i&&this.Hy(i),this.g.Ke(this.Y))},t.prototype.xy=function(t){var i=new e.l,r=new e.l,s=[0,0,0,0,0,0,0,0,0],n=[0,0,0,0,0,0,0,0,0],o=new e.hg,a=t,l=new e.l;t.yc(l);for(var h=new e.h,c=new e.h,u=null,p=null,d=0;4>d;d++){var f=!1,y=0!=(1&d),g=0;switch(d){case 0:g=this.Da.v,f=l.v<=g&&l.C>=g;break;case 1:g=this.Da.G,f=l.G<=g&&l.H>=g;break;case 2:g=this.Da.C,f=l.v<=g&&l.C>=g;break;case 3:g=this.Da.H,f=l.G<=g&&l.H>=g}if(f)for(f=a,a=t.Ja(),(f=f.Ha()).$i();f.ab();)for(var m,v=!0;f.Ia();){var b=f.ia();b.A(i);var w=this.Mh(i,d,g);if(-1==w){if(0<(w=b.fq(y,g,s,n))){var _=0;b.$p(h);for(var x=0;x<=w;x++)if(_!=(m=x<w?n[x]:1)){b.bh(_,m,o);var S=o.get();S.Ec(h),x<w&&(y?(c.x=s[x],c.y=g):(c.x=g,c.y=s[x]),S.Rc(c)),S.A(r);var M=this.Mh(r,d,g);-1==M&&(null==u&&(u=new e.h),null==p&&(p=new e.h),S.$p(u),S.Ur(p),y?(_=Math.abs(u.y-g))<(M=Math.abs(p.y-g))?(u.y=g,S.Ec(u)):(p.y=g,S.Rc(p)):(_=Math.abs(u.x-g))<(M=Math.abs(p.x-g))?(u.x=g,S.Ec(u)):(p.x=g,S.Rc(p)),S.A(r),M=this.Mh(r,d,g)),S.Ur(h),_=m,1==(m=M)?(a.oc(S,v),v=!1):v=!0}}}else 1==(m=w)?(a.oc(b,v),v=!1):v=!0}}return a},t.prototype.zB=function(){this.ki=-1,this.Xl(!1,this.Da.v),this.Xl(!1,this.Da.C),this.Xl(!0,this.Da.G),this.Xl(!0,this.Da.H),this.ed.resize(0),this.ed.Jb(100),this.ki=this.g.Hd();for(var t=new e.h,i=this.g.Ob(this.Y);-1!=i;i=this.g.Sb(i))for(var r=this.g.Ya(i),s=0,n=this.g.Ka(i);s<n;s++,r=this.g.V(r))this.g.D(r,t),(this.Da.v==t.x||this.Da.C==t.x||this.Da.G==t.y||this.Da.H==t.y)&&(this.g.Sa(r,this.ki,this.ed.size),this.ed.add(r));this.Pl(!1,this.Da.v),this.Pl(!1,this.Da.C),this.Pl(!0,this.Da.G),this.Pl(!0,this.Da.H),this.Oy()},t.prototype.Hy=function(t){for(var i=new e.h,r=new e.h,s=null,n=null,o=e.P.lg(2048,0),a=this.g.Ob(this.Y);-1!=a;a=this.g.Sb(a)){var l=this.g.Ya(a),h=l;do{var c=this.g.V(h);this.g.D(h,i);var u=-1;if(i.x==this.Da.v?(this.g.D(c,r),r.x==this.Da.v&&(u=1)):i.x==this.Da.C&&(this.g.D(c,r),r.x==this.Da.C&&(u=1)),i.y==this.Da.G?(this.g.D(c,r),r.y==this.Da.G&&(u=0)):i.y==this.Da.H&&(this.g.D(c,r),r.y==this.Da.H&&(u=0)),-1!=u){if(null==s&&(s=new e.h),null==n&&(n=new e.h),s.N(i),n.na(0,0),0==u){var p=i.x-this.Da.v;n.x=e.mc.sign(r.x-i.x),s.x=t*e.mc.Dn(Math.floor(Math.abs(p/t)),p)+this.Da.v,0>s.x&&(s.x+=t)}else p=i.y-this.Da.G,n.y=e.mc.sign(r.y-i.y),s.y=t*e.mc.Dn(Math.floor(Math.abs(p/t)),p)+this.Da.G,0>s.y&&(s.y+=t);p=0!=u?r.y-i.y:r.x-i.x;var d=Math.abs(p);if(65536<d/t)throw e.i.ga("internal error");if(0<d){d=e.P.truncate(d/t)+2,o.length<d&&(o=e.P.lg(d));for(var f=d=0;;f++){var y=new e.h;if(y.x=s.x+n.x*f*t,y.y=s.y+n.y*f*t,1<=(y=(0!=u?y.y-i.y:y.x-i.x)/p))break;0>=y||(o[d]=y,d++)}0!=d&&this.g.Wl(h,o,d)}}h=c}while(h!=l)}},t.prototype.Xl=function(t,i){for(var r=-1,s=new e.h,n=null,o=this.g.Ob(this.Y);-1!=o;o=this.g.Sb(o))for(var a=this.g.Ya(o),l=0,h=this.g.Ka(o);l<h;l++){var c=this.g.V(a);this.g.D(a,s),(t?s.y==i:s.x==i)&&(this.g.D(c,s),(t?s.y==i:s.x==i)&&(-1==r&&(r=this.g.Hd()),null==n&&(n=new e.ja(0)).Jb(100),1!=this.g.Qa(a,r)&&(n.add(a),this.g.Sa(a,r,1)),1!=this.g.Qa(c,r)&&(n.add(c),this.g.Sa(c,r,1)))),a=c}if(-1!=r&&this.g.Ud(r),!(null==n||3>n.size)){var u=this;n.Wd(0,n.size,(function(e,t){return u.Nh(e,t)})),r=new e.h,o=new e.h,a=new e.h,o.Sc();var p=-1;l=new e.ja(0),h=new e.ja(0),c=null;for(var d=this.g.Hd(),f=this.g.Hd(),y=0,g=n.size;y<g;y++){var m=n.get(y);if(this.g.D(m,s),!s.rb(o)){if(-1!=p){for(var v=p;v<y;v++){p=n.get(v);var b=this.g.V(p);m=this.g.Na(p);var w=!1;this.g.D(b,r),0>o.compare(r)&&(t?r.y==i:r.x==i)&&(l.add(p),w=!0,this.g.Sa(p,f,1)),this.g.D(m,r),0>o.compare(r)&&(t?r.y==i:r.x==i)&&(w||l.add(p),this.g.Sa(p,d,1))}for(v=0,w=l.size;v<w;v++){if(p=l.get(v),m=this.g.Qa(p,d),b=this.g.Qa(p,f),1==m&&(m=this.g.Na(p),this.g.D(m,a),!a.rb(s))){null==c&&(c=[]);var _=e.h.ub(o,a);c[0]=e.h.ub(a,s)/_,0==c[0]?c[0]=2220446049250313e-31:1==c[0]&&(c[0]=.9999999999999998),this.g.Wl(m,c,1),m=this.g.Na(p),this.g.mf(m,s),h.add(m),this.g.Sa(m,d,1),this.g.Sa(m,f,-1)}1==b&&(b=this.g.V(p),this.g.D(b,a),a.rb(s)||(null==c&&(c=[]),_=e.h.ub(o,a),c[0]=e.h.ub(o,s)/_,0==c[0]?c[0]=2220446049250313e-31:1==c[0]&&(c[0]=.9999999999999998),this.g.Wl(p,c,1),m=this.g.V(p),this.g.mf(m,s),h.add(m),this.g.Sa(m,d,-1),this.g.Sa(m,f,1)))}p=l,l=h,(h=p).clear(!1)}p=y,o.N(s)}}this.g.Ud(d),this.g.Ud(f)}},t.prototype.Pl=function(t,i){for(var r=new e.h,s=null,n=-1,o=0,a=this.ed.size;o<a;o++){var l=this.ed.get(o);if(-1!=l){var h=this.g.V(l);this.g.D(l,r),(t?r.y==i:r.x==i)&&(this.g.D(h,r),(t?r.y==i:r.x==i)&&(-1==n&&(n=this.g.Hd()),null==s&&(s=new e.ja(0)).Jb(100),-2!=this.g.Qa(l,n)&&(s.add(l),this.g.Sa(l,n,-2)),-2!=this.g.Qa(h,n)&&(s.add(h),this.g.Sa(h,n,-2))))}}if(null==s)-1!=n&&this.g.Ud(n);else{var c=this;for(s.Wd(0,s.size,(function(e,t){return c.Nh(e,t)})),o=0,a=s.size;o<a;o++){var u=s.get(o);this.g.Sa(u,n,o)}l=new e.h,(h=new e.h).Sc();var p=-1;for(o=0,a=s.size;o<a;o++)if(-1!=(u=s.get(o))&&(this.g.D(u,r),!r.rb(h))){if(-1!=p)for(;;){u=!1;for(var d=1<o-p?o-1:o,f=p;f<d;f++){var y=s.get(f);if(-1!=y){var g=-1,m=this.g.V(y);this.g.D(m,l),0>h.compare(l)&&(t?l.y==i:l.x==i)&&(g=m),m=-1;var v=this.g.Na(y);if(this.g.D(v,l),0>h.compare(l)&&(t?l.y==i:l.x==i)&&(m=v),-1!=g&&-1!=m)this.Lh(y,s,n),this.g.pd(y,!1),this.Lh(g,s,n),this.g.pd(g,!1),u=!0;else if(-1!=g||-1!=m){for(v=f+1;v<o;v++){var b=s.get(v);if(-1!=b){var w=this.g.V(b),_=-1;this.g.D(w,l),0>h.compare(l)&&(t?l.y==i:l.x==i)&&(_=w),w=this.g.Na(b);var x=-1;if(this.g.D(w,l),0>h.compare(l)&&(t?l.y==i:l.x==i)&&(x=w),-1!=_&&-1!=x){this.Lh(b,s,n),this.g.pd(b,!1),this.Lh(_,s,n),this.g.pd(_,!1),u=!0;break}if(-1!=g&&-1!=x){this.zt(s,y,g,b,x,n),u=!0;break}if(-1!=m&&-1!=_){this.zt(s,b,_,y,m,n),u=!0;break}}}if(u)break}}}if(!u)break}p=o,h.N(r)}this.g.Ud(n)}},t.prototype.Lh=function(e,t,i){i=this.g.Qa(e,i),t.set(i,-1),i=this.g.Qa(e,this.ki),this.ed.set(i,-1),-1!=(t=this.g.cd(e))&&this.g.Ya(t)==e&&(this.g.Kf(t,-1),this.g.Xg(t,-1))},t.prototype.zt=function(e,t,i,r,s,n){this.g.Cc(t,r),this.g.Dc(r,t),this.g.Dc(i,s),this.g.Cc(s,i),this.Lh(r,e,n),this.g.ni(r,!1),this.Lh(s,e,n),this.g.ni(s,!0)},t.prototype.Oy=function(){for(var e=0,t=this.ed.size;e<t;e++){var i=this.ed.get(e);-1!=i&&this.g.bj(i,-1)}for(var r=0,s=0,n=this.g.Ob(this.Y);-1!=n;){var o=this.g.Ya(n);if(-1==o||n!=this.g.cd(o)){var a=n;n=this.g.Sb(n),this.g.Kf(a,-1),this.g.br(a)}else{i=o,a=0;do{this.g.bj(i,n),a++,i=this.g.V(i)}while(i!=o);this.g.ep(n,!1),this.g.Xg(n,this.g.Na(o)),this.g.Wj(n,a),s+=a,r++,n=this.g.Sb(n)}}for(e=0,t=this.ed.size;e<t;e++)if(-1!=(i=this.ed.get(e))&&-1==(n=this.g.cd(i))){n=this.g.wf(this.Y,-1),a=0,o=i;do{this.g.bj(i,n),a++,i=this.g.V(i)}while(i!=o);2>=a?(i=this.g.Qa(o,this.ki),this.ed.set(i,-1),o=this.g.pd(o,!1),2==a&&(0<=(i=this.g.Qa(o,this.ki))&&this.ed.set(i,-1),this.g.pd(o,!1)),a=n,this.g.Kf(a,-1),this.g.br(a)):(this.g.mn(n,!0),this.g.Wj(n,a),this.g.Kf(n,o),this.g.Xg(n,this.g.Na(o)),this.g.ep(n,!1),s+=a,r++)}for(this.g.Tl(this.Y,r),this.g.Uj(this.Y,s),e=0,t=this.g.ld;-1!=t;t=this.g.ve(t))e+=this.g.I(t);this.g.VB(e)},t.vy=function(e,i,r,s){return new t(i,s).uy(e,r)},t.clip=function(e,i,r,s,n){return t.Pu(e,i,null,r,s,n)},t.Pu=function(i,r,s,n,o,a){var l=i.K();if(33==l)return o=i.D(),r.contains(o)?i:i.Ja();if(197==l)return o=new e.l,i.A(o),o.Fa(r)?(r=new e.Gh,i.copyTo(r),r.Yo(o),r):i.Ja();if(i.B())return i;if(r.B())return i.Ja();var h=new e.l;if(i.yc(h),r.contains(h))return i;if(!r.isIntersecting(h))return i.Ja();if((null!=s||isNaN(n))&&e.ta.ny(s,r,!1),!e.ba.yj(l))throw e.i.O();if(null!=(s=i.Cb)&&null!=(s=s.Fk)){if(1==(s=s.So(r))){if(1736!=l)throw e.i.ga("internal error");return(i=new e.Ea(i.description)).vp(r),i}if(0==s)return i.Ja()}switch(l){case 550:for(a=null,l=i.I(),s=i.vb(0),n=0,o=new e.h,h=0;h<l;h++)s.uc(2*h,o),r.contains(o)||(0==n&&(a=i.Ja()),n<h&&a.Gd(i,n,h),n=h+1);return 0<n&&a.Gd(i,n,l),0==n?i:a;case 1736:case 1607:return t.vy(i,r,o,a);default:throw e.i.ga("internal error")}},t.prototype.Nh=function(t,i){var r=new e.h;return this.g.D(t,r),t=new e.h,this.g.D(i,t),r.compare(t)},t}();e.si=t}($||($={})),function(e){var t=new e.h,i=function(){function t(t,i,r,s,n){this.Rm=new e.h,this.Dk=new e.h,this.Qi=new e.h,this.g=t,this.Bw=r,this.oo=s,this.Rm=i,this.Al=n,this.Dk.Sc(),this.Qi.Sc()}return t.prototype.pE=function(t){this.g.D(t,this.Dk),t=e.P.truncate((this.Dk.x-this.Rm.x)*this.oo+.5);var i=e.P.truncate((this.Dk.y-this.Rm.y)*this.oo+.5);return r.bG(t,i)},t.prototype.ez=function(e){return this.g.Qa(e,this.Al)},t.prototype.Ky=function(e,t){return this.g.D(e,this.Dk),this.g.D(t,this.Qi),r.Dv(this.Dk.x,this.Dk.y,this.Qi.x,this.Qi.y,this.Bw)},t}();e.gY=function(){};var r=function(){function r(){this.Rm=new e.h,this.rq=[0,0,0,0],this.ys=[0,0,0,0],this.ro=this.Al=-1}return r.aQ=function(e,t){var i=new r;return i.g=e,i.ra=t,i.Bw=t*t,i.aw=2*t,i.oo=1/i.aw,i.tO()},r.Dv=function(e,t,i,r,s){return(e-=i)*e+(t-=r)*t<=s},r.bG=function(t,i){return e.P.Uh(i,e.P.Uh(t))},r.prototype.vO=function(i,s){this.g.Hc(i,t);for(var n=(t.y-this.Rm.y)*this.oo,o=e.P.truncate((t.x-this.Rm.x)*this.oo),a=e.P.truncate(n),l=n=0;1>=l;l+=1)for(var h=0;1>=h;h+=1){var c=r.bG(o+l,a+h),u=this.zl.iR(c);-1!=u&&(this.rq[n]=u,this.ys[n]=c,n++)}for(o=n-1;1<=o;o--)for(u=this.rq[o],a=o-1;0<=a;a--)if(u==this.rq[a]){this.ys[a]=-1,o!=--n&&(this.ys[o]=this.ys[n],this.rq[o]=this.rq[n]);break}for(a=0;a<n;a++)this.wO(i,this.ys[a],t,this.rq[a],s)},r.prototype.wO=function(t,i,s,n,o){for(var a=new e.h;-1!=n;n=this.zl.wR(n)){var l=this.zl.ka(n);t==l||-1!=i&&this.g.Qa(l,this.Al)!=i||(this.g.Hc(l,a),r.Dv(s.x,s.y,a.x,a.y,this.Bw)&&o.add(n))}},r.prototype.Zm=function(e,t,i){var r=this.g.Qa(e,this.ro),s=this.g.Qa(t,this.ro);return-1==r&&(r=this.Ad.Qh(),this.Ad.addElement(r,e),this.g.Sa(e,this.ro,r)),-1==s?this.Ad.addElement(r,t):this.Ad.By(r,s),this.g.Sa(t,this.ro,-2),t=this.OT(e,t),i&&(i=this.lw.pE(e),this.g.Sa(e,this.Al,i)),t},r.MT=function(t,i,s){t.Nb(i),s=t;var n=new e.h;r.NT(t.D(),i.D(),n),s.Db(n)},r.NT=function(e,t,i){var r=e.x;e.x!=t.x&&(r=(1*e.x+1*t.x)/2);var s=e.y;e.y!=t.y&&(s=(1*e.y+1*t.y)/2),i.na(r,s)},r.prototype.OT=function(t,i){var r=new e.h;this.g.D(t,r);var s=new e.h;this.g.D(i,s);var n=this.g.VF(t),o=n+(i=this.g.VF(i)),a=0,l=r.x;r.x!=s.x&&(l=(r.x*n+s.x*i)/o,a++);var h=r.y;return r.y!=s.y&&(h=(r.y*n+s.y*i)/o,a++),0<a&&this.g.Db(t,l,h),this.g.jX(t,o),0!=a},r.prototype.tO=function(){var t=this.g.gd,r=this.g.AF();for(this.Rm=r.hz(),r=Math.max(r.da(),r.S())/2147483646,this.aw<r&&(this.aw=r,this.oo=1/this.aw),this.Ad=new e.bu,this.Ad.At(e.P.truncate(this.g.gd/3+1)),this.Ad.hn(e.P.truncate(this.g.gd/3+1)),this.Al=this.g.Hd(),this.ro=this.g.Hd(),this.lw=new i(this.g,this.Rm,this.Bw,this.oo,this.Al),this.zl=new e.WK(e.P.truncate(4*t/3),this.lw),this.zl.qW(this.g.gd),t=!1,r=this.g.ld;-1!=r;r=this.g.ve(r))for(var s=this.g.Ob(r);-1!=s;s=this.g.Sb(s))for(var n=this.g.Ya(s),o=0,a=this.g.Ka(s);o<a;o++){var l=this.lw.pE(n);this.g.Sa(n,this.Al,l),this.zl.addElement(n,l),n=this.g.V(n)}var h=new e.ja(0);for(h.Jb(10),r=this.g.ld;-1!=r;r=this.g.ve(r))for(s=this.g.Ob(r);-1!=s;s=this.g.Sb(s))for(n=this.g.Ya(s),o=0,a=this.g.Ka(s);o<a;o++){if(-2!=this.g.Qa(n,this.ro))for(l=this.g.Qa(n,this.Al),this.zl.kd(n,l);this.vO(n,h),0!=h.size;){l=!1;for(var c=0,u=h.size;c<u;c++){var p=h.get(c),d=this.zl.ka(p);this.zl.wd(p),l=this.Zm(n,d,c+1==u)||l}if(t=t||l,h.clear(!1),!l)break}n=this.g.V(n)}return t&&this.nN(),this.lw=this.zl=null,this.g.Ud(this.Al),this.g.Ud(this.ro),t},r.prototype.nN=function(){for(var t=new e.h,i=this.Ad.je;-1!=i;i=this.Ad.lz(i)){var r=this.Ad.sc(i);for(this.g.D(this.Ad.ka(r),t),r=this.Ad.lb(r);-1!=r;r=this.Ad.lb(r))this.g.mf(this.Ad.ka(r),t)}},r}();e.Zt=r}($||($={})),function(e){var t=function(){function t(e){void 0===e&&(e=null),this.yg=null,this.Pb=!1,this.yg=null===e?[]:e}return t.prototype.copyTo=function(t){if(t.Pb)throw e.i.ga("CompositeGeographicTransformation is read-only");for(var i=0;i<this.yg.length;i++)t.yg.push(this.yg[i].Pf())},t.prototype.count=function(){return this.yg.length},t.prototype.add=function(t){if(this.Pb)throw e.i.ga("CompositeGeographicTransformation is read-only");this.yg.push(t.Pf())},t.prototype.clear=function(){if(this.Pb)throw e.i.ga("CompositeGeographicTransformation is read-only");this.yg.length=0},t.prototype.remove=function(t){if(this.Pb)throw e.i.ga("CompositeGeographicTransformation is read-only");this.yg.splice(t,1)},t.prototype.ig=function(){var e=new t;return this.copyTo(e),e},t.prototype.Pf=function(){return this.ig()},t.prototype.transform=function(t,i,r,s){if(t.length<i)throw e.i.ga("invalid Argument");var n=r;for(r=0;r<this.yg.length;r++){var o=this.yg[r];if(null!=o.sm()){var a=o.Vn,l=a?1:0,h=a?o.sm().getGeogcs2():o.sm().getGeogcs1();if(h=n/(h=h.getUnit().getUnitFactor()),3552713678800501e-30<Math.abs(h-1))for(n=0;n<i;n++)t[n][0]*=h,t[n][1]*=h;e.EC.geogToGeog(o.sm(),i,t,null,l),n=(a?o.sm().getGeogcs1():o.sm().getGeogcs2()).getUnit().getUnitFactor()}}if(h=n/s,3552713678800501e-30<Math.abs(h-1))for(n=0;n<i;n++)t[n][0]*=h,t[n][1]*=h;return i},t.prototype.Nb=function(e){if(e==this)return!0;if(!(e instanceof t)||this.yg.length!=e.yg.length)return!1;for(var i=0;i<this.yg.length;i++)if(!this.yg[i].Nb(e.yg[i]))return!1;return!0},t.prototype.hx=function(){this.Pb=!0},t.prototype.toString=function(){for(var e="CGT ("+this.count()+") ",t=0,i=this.count();t<i;++t)e+=this.yg[t].toString()+", ";return 200<e.length?e.substring(0,197)+"... ("+e.length.toString()+" characters)":e},t.create=function(){return new t},t}();e.pC=t}($||($={})),function(e){var t,i=Math.PI,r=2*Math.PI,s=Math.PI/2,n=function(){function e(){}return e.LO=function(t,i){var r=new e;return r.x=t,r.y=i,r.type=0,r.Vh=0,r},e.bl=function(t){var i=new e;return i.x=t.x,i.y=t.y,i.type=0,i.Vh=0,i},e.KO=function(t){var i=new e;return i.x=t.x,i.y=t.y,i.type=t.type,i.Vh=t.Vh,i},e.Qd=function(t,i,r){var s=new e;return s.x=t.x+i*Math.cos(r),s.y=t.y+i*Math.sin(r),s.type=t.type,s.Vh=t.Vh,s},e.Ru=function(t,i){var r=new e;return r.x=.5*(t.x+i.x),r.y=.5*(t.y+i.y),r.type=t.type,r.Vh=t.Vh,r},e.LE=function(t,i){var r=new e;return r.x=t.x+.001*(i.x-t.x),r.y=t.y+.001*(i.y-t.y),r.type=t.type,r.Vh=t.Vh,r},e}(),o=function(){};(t=e.YK||(e.YK={}))[t.Round=0]="Round",t[t.Bevel=1]="Bevel",t[t.Miter=2]="Miter",t[t.Square=3]="Square";var a=function(){function t(e){this.HA=this.Zb=this.wg=null,this.nd=e}return t.W=function(i,r,s,n,o,a){if(null==i)throw e.i.O();if(1>i.Eb())throw e.i.O();return 0==r||i.B()?i:((a=new t(a)).lo=i,a.La=r,a.ra=o,a.Li=s,a.wA=n,a.Px())},t.prototype.XL=function(){var t=this.lo,i=t.ac(),r=t.xc(),s=new e.h;return s.vc(r,i),s.normalize(),s.Iv(),s.scale(this.La),i.add(s),r.add(s),s=t.Ja(),t.Ec(i),t.Rc(r),s},t.prototype.WL=function(){var t=this.lo;if(0<this.La&&2!=this.Li){var i=new e.Ea;return i.bd(t,!1),this.lo=i,this.Px()}return(t=new e.Gh(t.aa)).X(this.La,this.La),t},t.prototype.lJ=function(e,t,i,r){return(t.x-e.x)*(r.x-i.x)+(t.y-e.y)*(r.y-i.y)},t.prototype.hc=function(e,t){if(void 0===t)this.Zb.push(e),this.gf++;else if(0==this.gf)this.hc(e);else{var i=this.Cw,r=this.wg[0==t?i-1:t-1],o=this.wg[t],a=this.lJ(r,o,this.Zb[this.gf-1],e);0<a?this.hc(e):0>a&&(0<this.lJ(r,o,o,this.Zb[this.gf-1])?(o=this.wg[0==t?i-2:1==t?i-1:t-2],i=n.Qd(r,this.La,Math.atan2(r.y-o.y,r.x-o.x)-s),this.Zb[this.gf-1]=i,1==this.Li||2==this.Li?(i=n.Ru(i,r),this.hc(i),i=n.Qd(r,this.La,this.Kv+s),(r=n.Ru(i,r)).type|=256,this.hc(r)):(i=n.Qd(r,this.La,this.Kv+s)).type|=256,this.hc(i),this.hc(e,t)):(i=n.Qd(o,this.La,this.Kv+s),this.hc(i),1==this.Li||2==this.Li?(i=n.Ru(i,o),this.hc(i),i=n.Qd(o,this.La,this.Wz-s),(r=n.Ru(i,o)).type|=256,this.hc(r)):(i=n.Qd(o,this.La,this.Wz-s)).type|=256,this.hc(i)))}},t.prototype.eE=function(){var t,o=this.Cw;this.gf=0;var a=.5*this.ra,l=0,h=0;for(t=0;t<o;t++){var c=this.wg[t],u=0==t?this.wg[o-1]:this.wg[t-1],p=t==o-1?this.wg[0]:this.wg[t+1],d=u.x-c.x,f=u.y-c.y,y=p.x-c.x,g=p.y-c.y,m=Math.atan2(f,d),v=Math.atan2(g,y);if(this.Kv=m,this.Wz=v,0==t&&(l=m,h=v),d=d*g-y*f,f=v,v<m&&(v+=r),0<d*this.La)1==this.Li||2==this.Li?(m=n.Qd(c,this.La,m+s),this.hc(m),m=n.LE(c,m),this.hc(m),m=n.Qd(c,this.La,v-s),(c=n.LE(c,m)).type|=256,this.hc(c),this.hc(m)):(d=.5*(v-m),d=this.La/Math.abs(Math.sin(d)),m=n.Qd(c,d,.5*(m+v)),this.hc(m,t));else if(0!=(512&c.type)){for(d=1-a/Math.abs(this.La),u=1,p=0>this.La?-i:i,-1<d&&1>d&&(.017453292519943295>(f=2*Math.acos(d))&&(f=.017453292519943295),1<(u=e.P.truncate(i/f+1.5))&&(p/=u)),f=m+s,m=n.Qd(c,this.La,f),0==t&&(m.type|=1024),this.hc(m,t),d=this.La/Math.cos(p/2),f+=p/2,(m=n.Qd(c,d,f)).type|=1024,this.hc(m);0<--u;)f+=p,(m=n.Qd(c,d,f)).type|=1024,this.hc(m);(m=n.Qd(c,this.La,v-s)).type|=1024,this.hc(m)}else if(1==this.Li)m=n.Qd(c,this.La,m+s),this.hc(m,t),m=n.Qd(c,this.La,v-s),this.hc(m);else if(0==this.Li)for(d=1-a/Math.abs(this.La),u=1,p=v-s-(m+s),-1<d&&1>d&&(.017453292519943295>(f=2*Math.acos(d))&&(f=.017453292519943295),1<(u=e.P.truncate(Math.abs(p)/f+1.5))&&(p/=u)),d=this.La/Math.cos(.5*p),f=m+s+.5*p,m=n.Qd(c,d,f),this.hc(m,t);0<--u;)f+=p,m=n.Qd(c,d,f),this.hc(m);else 2==this.Li?(d=u.x-c.x,f=u.y-c.y,.99999999<(u=(d*(y=p.x-c.x)+f*(g=p.y-c.y))/Math.sqrt(d*d+f*f)/Math.sqrt(y*y+g*g))?(m=n.Qd(c,1.4142135623730951*this.La,v-.25*i),this.hc(m,t),m=n.Qd(c,1.4142135623730951*this.La,v+.25*i),this.hc(m)):(u=Math.abs(this.La/Math.sin(.5*Math.acos(u))))>(p=Math.abs(this.wA*this.La))?(d=.5*(v-m),d=this.La/Math.abs(Math.sin(d)),m=n.Qd(c,d,.5*(m+v)),v=e.h.construct(m.x,m.y),m=e.h.construct(c.x,c.y),(c=new e.h).vc(v,m),(v=new e.h).wW(p/c.length(),c,m),m=(u-p)*Math.abs(this.La)/Math.sqrt(u*u-this.La*this.La),0<this.La?c.Iv():c.cr(),c.scale(m/c.length()),(m=new e.h).add(v,c),(u=new e.h).vc(v,c),m=n.bl(m),this.hc(m,t),m=n.bl(u),this.hc(m)):(d=.5*(v-m),d=this.La/Math.abs(Math.sin(d)),m=n.Qd(c,d,.5*(m+v)),this.hc(m,t))):(v=f,0<this.La?(v>m&&(v-=r),u=m-v<s):(v<m&&(v+=r),u=v-m<s),u?(f=0>(d=1.4142135623730951*this.La)?m+.25*i:m+.75*i,m=n.Qd(c,d,f),this.hc(m,t),f=0>d?v-.25*i:v-.75*i,m=n.Qd(c,d,f),this.hc(m)):(d=.5*(v-m),d=this.La/Math.abs(Math.sin(d)),v<m&&(v+=r),m=n.Qd(c,d,(m+v)/2),this.hc(m,t)))}return this.Kv=l,this.Wz=h,this.hc(this.Zb[0],0),c=n.KO(this.Zb[this.gf-1]),this.Zb[0]=c,this.mW()},t.prototype.Bu=function(t,i){if(!(2>i))for(var r=0;r<i;r++){var s=this.Zb[t+r];0!=r?this.HA.Di(e.h.construct(s.x,s.y)):this.HA.Mt(e.h.construct(s.x,s.y))}},t.prototype.YL=function(e,t,i){var r=e.Ca(t),s=e.Wc(t);if(this.Zb=[],this.HA=i,e.ec(t)){for(t=e.Oa(r);e.Oa(s-1).rb(t);)s--;if(2<=s-r){for(this.Cw=s-r,this.wg=[],t=r;t<s;t++)this.wg.push(n.bl(e.Oa(t)));this.eE()&&this.Bu(0,this.gf-1)}}else{for(t=e.Oa(r);r<s&&e.Oa(r+1).rb(t);)r++;for(t=e.Oa(s-1);r<s&&e.Oa(s-2).rb(t);)s--;if(2<=s-r){for(this.Cw=2*(s-r)-2,this.wg=[],(i=n.bl(e.Oa(r))).type|=1536,this.wg.push(i),t=r+1;t<s-1;t++)i=n.bl(e.Oa(t)),this.wg.push(i);for((i=n.bl(e.Oa(s-1))).type|=512,this.wg.push(i),t=s-2;t>=r+1;t--)(i=n.bl(e.Oa(t))).type|=1024,this.wg.push(i);if(this.eE())if(2<=this.Zb.length){for(e=-1,(s=0!=(1024&this.Zb[this.gf-1].type))||(e=0),t=1;t<this.gf;t++)(r=0!=(1024&this.Zb[t].type))?s||1<(s=t-1)-e+1&&this.Bu(e,s-e+1):s&&(e=t-1),s=r;s||1<(s=this.gf-1)-e+1&&this.Bu(e,s-e+1)}else e=0,s=this.gf-1,0<=e&&1<=s-e&&this.Bu(e,s-e+1)}}this.wg=null,this.Cw=0,this.Zb=null,this.gf=0},t.prototype.mW=function(){for(var e=!1,t=0;t<this.gf;t++){var i=this.Zb[t];i.rh=t+1,i.th=t-1,this.Zb[t]=i}for((i=this.Zb[0]).th=this.gf-2,this.Zb[0]=i,(i=this.Zb[this.gf-2]).rh=0,this.Zb[this.gf-2]=i,t=i=0;t<this.gf;t++)if(0!=(256&this.Zb[i].type)){var r=this.yP(i);if(-1==r){e=!0;break}i=r}else i=this.Zb[i].rh;return!e&&(this.IO(i),!0)},t.prototype.yP=function(e){for(var t,i,r=this.gf-1,s=e,n=1;n<=r-2;n++){t=s=this.Zb[s].rh,i=e;for(var o=1;o<=n;o++){if(i=this.Zb[i].th,0==(256&this.Zb[i].type)&&0==(256&this.Zb[t].type)){var a=this.YR(i,t);if(-1!=a)return a}t=this.Zb[t].th}}return-1},t.prototype.YR=function(t,i){var r=this.Zb[this.Zb[t].th],s=this.Zb[t],n=this.Zb[this.Zb[i].th],a=this.Zb[i];if(!this.yW(r,s,n,a))return-1;var l=new o;return this.pQ(r,s,n,a,l)&&!l.UD&&e.P.UJ((s.x-r.x)*(a.y-n.y)-(s.y-r.y)*(a.x-n.x))!=e.P.UJ(this.La)?(r=this.Zb[t].th,l.cn.type=s.type,l.cn.rh=i,l.cn.th=r,this.Zb[t]=l.cn,l.cn=this.Zb[i],l.cn.th=t,this.Zb[i]=l.cn,i):-1},t.prototype.yW=function(e,t,i,r){return Math.max(e.x,t.x)>=Math.min(i.x,r.x)&&Math.max(i.x,r.x)>=Math.min(e.x,t.x)&&Math.max(e.y,t.y)>=Math.min(i.y,r.y)&&Math.max(i.y,r.y)>=Math.min(e.y,t.y)},t.prototype.pQ=function(e,t,i,r,s){s.UD=!1;var o=(t.y-e.y)*(r.x-i.x)-(t.x-e.x)*(r.y-i.y),a=(i.y-e.y)*(t.x-e.x)-(i.x-e.x)*(t.y-e.y);if(0<=(o=0==o?2:a/o)&&1>=o){var l=o;if(o=(r.y-i.y)*(t.x-e.x)-(r.x-i.x)*(t.y-e.y),a=(e.y-i.y)*(r.x-i.x)-(e.x-i.x)*(r.y-i.y),0<=(o=0==o?2:a/o)&&1>=o)return s.cn=n.LO(e.x+o*(t.x-e.x),e.y+o*(t.y-e.y)),s.cn.Vh=i.Vh+l*(r.Vh-i.Vh),0!=l&&1!=l||0!=o&&1!=o||(s.UD=!0),s.KY=o,s.LY=l,!((0==l||1==l)&&0<o&&1>o||(0==o||1==o)&&0<l&&1>l)}return!1},t.prototype.IO=function(e){for(;this.Zb[e].th<e;)e=this.Zb[e].th;var t=0,i=e;do{i=this.Zb[i],this.Zb[t]=i,i=i.rh,t++}while(i!=e);this.Zb[t]=this.Zb[0],this.gf=t+1},t.prototype.SC=function(e){var t=this.lo,i=t.Ha();if(null!=i){i.$i();for(var r=-1;i.ab();)r++,this.YL(t,r,e)}},t.prototype.Px=function(){var t=this.lo.K();return 322==t?this.XL():197==t?this.WL():e.ba.zd(t)?((t=new e.Ua).oc(this.lo,!0),this.lo=t,this.Px()):1607==t?(t=new e.Ua,this.SC(t),t):1736==t?(t=new e.Ea,this.SC(t),t):null},t}();e.AK=a}($||($={})),function(e){var t=function(){function e(e){this.qk=e}return e.prototype.D=function(e,t){this.qk.g.D(e,t)},e.prototype.wd=function(e){var t=this.qk.Ga.ka(e);this.qk.Ga.wd(e,-1),this.qk.g.pd(t,!1)},e}(),i=function(){function e(e){this.qk=e}return e.prototype.D=function(e,t){this.qk.yT.D(e,t)},e.prototype.wd=function(e){this.qk.Ga.wd(e,-1)},e}(),r=function(){function e(e){this.qk=e}return e.prototype.D=function(e,t){t.N(this.qk.BT[e])},e.prototype.wd=function(e){this.qk.Ga.wd(e,-1)},e}(),s=function(){function s(s){void 0===s?(this.Ga=new e.Yj,this.Ga.Ee(20),this.g=new e.hd,this.mT=this.g.Kg(550),this.Ts=this.g.wf(this.mT,-1),this.Yh=new t(this)):s instanceof Array?(this.Ga=new e.Yj,this.Ga.Ee(20),this.BT=s,this.Yh=new r(this)):(this.Ga=new e.Yj,this.Ga.Ee(20),this.yT=s,this.Yh=new i(this))}return s.prototype.Ib=function(t){var i=t.K();if(e.Ex.yj(i))this.bN(t);else if(e.Vk.zd(i))this.gN(t);else if(197==i)this.ZM(t);else{if(33!=i)throw e.i.O("invalid shape type");this.fN(t)}},s.prototype.VQ=function(){var t=new e.Ta,i=this.Ga.sc(-1),r=new e.Ea(this.g.ht);for(this.g.Wi(this.Ga.ka(i),t),r.nf(t),i=this.Ga.lb(i);-1!=i;i=this.Ga.lb(i))this.g.Wi(this.Ga.ka(i),t),r.lineTo(t);return r},s.JO=function(t){var i=new s(t),r=t.I(),n=1,o=new e.h,a=new e.h,l=new e.h;for(t.D(0,o);t.D(n,a),a.Mz(o)&&n<r-1;)n++;for(i.Ga.addElement(0,-1),i.Ga.yn(n),r=n+1;r<t.I();r++)t.D(r,l),-1!=(n=i.iC(l))&&i.Ga.Tj(n,r);for(l=new e.Ta,n=i.Ga.sc(-1),r=new e.Ea(t.description),t.we(i.Ga.ka(n),l),r.nf(l),n=i.Ga.lb(n);-1!=n;n=i.Ga.lb(n))t.we(i.Ga.ka(n),l),r.lineTo(l);return r},s.construct=function(e,t,i){for(var r=new s(e),n=1,o=e[0];e[n].Mz(o)&&n<t-1;)n++;for(r.Ga.addElement(0,-1),r.Ga.yn(n),n+=1;n<t;n++)-1!=(o=r.iC(e[n]))&&r.Ga.Tj(o,n);for(e=0,t=r.Ga.sc(-1);-1!=t;t=r.Ga.lb(t))i[e++]=r.Ga.ka(t);return e},s.BG=function(t,i){var r=t.Ca(i),n=t.Wc(i);if(i=!t.ec(i)&&t.On(i),t=t.vb(0),n*=2,i&&(n-=2),6>n-(r*=2))return!0;i=new e.h;var o=new e.h,a=new e.h;t.uc(r,i),t.uc(r+2,o),t.uc(r+4,a);var l=s.Xu(o,a,i);if(l.qs()||!s.wm(l.value()))return!1;var h=e.h.construct(o.x,o.y),c=new e.h;for(r+=6;r<n;r+=2){if(c.N(o),o.N(a),t.uc(r,a),(l=s.Xu(o,a,i)).qs()||!s.wm(l.value()))return!1;if((l=s.Xu(h,a,i)).qs()||!s.wm(l.value()))return!1;if((l=s.Xu(o,a,c)).qs()||!s.wm(l.value()))return!1}return!0},s.prototype.bN=function(t){for(var i=new e.Ta,r=new e.h,s=0;s<t.I();s++){t.D(s,r);var n=this.Er(r);if(-1!=n){t.we(s,i);var o=this.g.hc(this.Ts,i);this.Ga.Tj(n,o)}}},s.prototype.ZM=function(t){for(var i=new e.Ta,r=new e.h,s=0;4>s;s++){t.gB(s,r);var n=this.Er(r);if(-1!=n){t.If(s,i);var o=this.g.hc(this.Ts,i);this.Ga.Tj(n,o)}}},s.prototype.gN=function(t){var i=new e.Ta,r=t.ac();if(-1!=(r=this.Er(r))){t.Uo(i);var s=this.g.hc(this.Ts,i);this.Ga.Tj(r,s)}r=t.xc(),-1!=(r=this.Er(r))&&(t.Qo(i),t=this.g.hc(this.Ts,i),this.Ga.Tj(r,t))},s.prototype.fN=function(e){var t=e.D();-1!=(t=this.Er(t))&&(e=this.g.hc(this.Ts,e),this.Ga.Tj(t,e))},s.prototype.Er=function(e){var t=-1;if(0==this.Ga.size(-1))return this.Ga.addElement(-4,-1);if(1==this.Ga.size(-1)){var i=this.g.Oa(this.Ga.ka(this.Ga.sc(-1)));return e.Mz(i)||(t=this.Ga.yn(-5)),t}return this.iC(e)},s.prototype.iC=function(t){var i=-1;do{var r=this.Ga.sc(-1),n=this.Ga.Gc(-1),o=this.Ga.ka(r),a=this.Ga.ka(n),l=new e.h,h=new e.h;if(this.Yh.D(o,l),this.Yh.D(a,h),o=e.h.Wq(h,t,l),s.wm(o))i=this.Ga.yn(-1),(l=this.gC(t,n,r))!=r&&this.hC(t,r,this.Ga.xe(l));else if(s.uG(o)){h=this.Ga.tv(-1);var c=this.Ga.sc(-1),u=this.Ga.Gc(-1);for(o=new e.h,a=new e.h;c!=this.Ga.xe(u);){var p=this.Ga.ka(h);this.Yh.D(p,o),p=e.h.Wq(o,t,l),s.uG(p)?(u=h,h=this.Ga.nl(h)):(c=h,h=this.Ga.Zp(h))}if(h=u,l=c,p=this.Ga.ka(h),c=this.Ga.ka(l),this.Yh.D(p,o),this.Yh.D(c,a),l!=r&&(o=e.h.Wq(a,t,o),!s.wm(o)))continue;i=this.Ga.Au(l,h,-2,!1),this.hC(t,h,n),this.gC(t,l,r)}else null==this.tb&&(this.tb=new e.zb),this.tb.Ec(h),this.tb.Rc(l),0>(l=this.tb.fe(t,!0))?(l=this.Ga.xe(n),this.Ga.wd(n,-1),i=this.Ga.yn(-3),this.gC(t,l,r)):1<l&&(l=this.Ga.lb(r),this.Ga.wd(r,-1),i=this.Ga.Au(-1,l,-3,!1),this.hC(t,l,n))}while(0);return i},s.prototype.hC=function(t,i,r){if(i!=r){var n=this.Ga.ka(i),o=this.Ga.lb(i),a=new e.h,l=new e.h;for(this.Yh.D(n,a);i!=r&&2<this.Ga.size(-1)&&(this.Yh.D(this.Ga.ka(o),l),n=e.h.Wq(l,t,a),!s.wm(n));)n=i,i=o,a.N(l),o=this.Ga.lb(i),this.Yh.wd(n)}},s.prototype.gC=function(t,i,r){if(i==r)return r;var n=this.Ga.ka(i),o=this.Ga.xe(i),a=new e.h,l=new e.h;for(this.Yh.D(n,a);i!=r&&2<this.Ga.size(-1)&&(this.Yh.D(this.Ga.ka(o),l),n=e.h.Wq(a,t,l),!s.wm(n));)n=i,i=o,a.N(l),o=this.Ga.xe(i),this.Yh.wd(n);return i},s.Xu=function(t,i,r){var s=new e.Xb;s.set(i.x),s.sub(t.x);var n=new e.Xb;n.set(r.y),n.sub(t.y);var o=new e.Xb;return o.set(i.y),o.sub(t.y),(i=new e.Xb).set(r.x),i.sub(t.x),s.Ag(n),o.Ag(i),s.sub(o),s},s.wm=function(e){return 0>e},s.uG=function(e){return 0<e},s}();e.$t=s}($||($={})),function(e){var t=function(){function t(e){this.g=null,this.lH=!0,this.nd=e}return t.pU=function(t,i,r){return t=e.ta.Gr(t),e.Zt.Dv(i.Mg(),i.jh(),r.Mg(),r.jh(),e.mc.nx(t))},t.uO=function(t,i){var r=new e.Ta;return e.Zt.MT(t,i,r),r},t.W=function(e,i,r,s){return(r=new t(r)).g=e,r.ra=i,r.lH=s,r.wM()},t.prototype.fM=function(t){return e.Zt.aQ(this.g,t)},t.prototype.kM=function(t){return e.au.W(this.g,t,this.nd)},t.prototype.wM=function(){var t=this.ra,i=e.ta.Gr(t),r=1.00001*(t=e.ta.jN(t));t*=1.000001;for(var s=!1,n=30<this.g.gd+10?1e3:(this.g.gd+10)*(this.g.gd+10),o=0,a=this.g.aS();;o++){if(o>n)throw e.i.ga("Internal Error: max number of iterations exceeded");var l=this.fM(i);if(s=s||l,this.lH&&(l=0!=this.g.Ip(i,!0,!1),s=s||l),l=!1,(0==o||a||e.au.cI(!0,this.g,t,null,this.nd))&&(l=this.kM(r),s=s||l),!l)break;e.np.Bp(this.nd)}return s},t}();e.Tk=t}($||($={})),function(e){var t=function(){function t(e){this.ae=this.Nc=null,this.Zs=0,this.Vb=e,this.Yz=!0}return t.prototype.vv=function(e,t){var i=this.g.cc(e);if(null==i){if(!this.g.fd(e,t))return null;i=t}return i},t.prototype.Zq=function(){var t;void 0===t&&(t=!1),this.Zs++,(t||0==(4095&this.Zs))&&(this.Zs=0,e.np.Bp(this.Vb))},t.prototype.fP=function(){var t=this.g.$q(!1),i=!1,r=new e.zb,s=new e.zb,n=new e.l;n.Pa();var o=new e.l;o.Pa();for(var a=new e.Ta,l=new e.LC,h=t.next();-1!=h;h=t.next()){e.np.Bp(this.Vb);var c=null,u=!1;if(!e.ba.Sn(this.g.jc(t.ck))){if(null==(c=this.vv(h,r)))continue;if(c.A(n),n.X(this.ra,this.ra),c.Ci(this.ra)){if(!c.Ci(0))continue;u=!0,c=null}}var p=this.g.$q(t),d=p.next();for(-1!=d&&(d=p.next());-1!=d;d=p.next()){var f=null,y=!1;if(!e.ba.Sn(this.g.jc(p.ck))){if(null==(f=this.vv(d,s)))continue;if(f.A(o),f.Ci(this.ra)){if(!f.Ci(0))continue;y=!0,f=null}}var g=0,m=0;if(null!=c&&null!=f)n.zG(o)&&(l.Po(c),l.Po(f),l.Fa(this.ra,!1),0<(g=l.ql(0))+(m=l.ql(1))&&(this.g.lr(h,l,0,!0),this.g.lr(d,l,1,!0)),l.clear());else if(null!=c){var v=new e.h;if(this.g.D(d,v),n.contains(v)){if(l.Po(c),this.g.Wi(d,a),l.Fz(this.ra,a,!1),0<(g=l.ql(0)))if(this.g.lr(h,l,0,!0),y){for(y=-1,v=this.g.V(d);-1!=v&&v!=d&&(y=v,null!=(f=this.vv(v,s))&&f.Ci(0));v=this.g.V(v));for(v=d;-1!=v&&(this.g.Eh(v,l.Cf),v!=y);v=this.g.V(v));}else this.g.Eh(d,l.Cf);l.clear()}}else{if(null==f)continue;if(v=new e.h,this.g.D(h,v),o.X(this.ra,this.ra),o.contains(v)){if(l.Po(f),this.g.Wi(h,a),l.Fz(this.ra,a,!1),0<(m=l.ql(0)))if(this.g.lr(d,l,0,!0),u){for(y=-1,v=this.g.V(h);-1!=v&&v!=h&&(y=v,null!=(f=this.vv(v,s))&&f.Ci(0));v=this.g.V(v));for(v=h;-1!=v&&(this.g.Eh(v,l.Cf),v!=y);v=this.g.V(v));}else this.g.Eh(h,l.Cf);l.clear()}}if(g+m!=0){if(0!=g){if(null==(c=this.g.cc(h))){if(!this.g.fd(h,r))continue;c=r,r.A(n)}else c.A(n);if(c.Ci(this.ra))break}i=!0}}}return i},t.prototype.gP=function(){return this.GU()},t.prototype.GU=function(){return(new e.JC).DX(this.g,this.ra)},t.prototype.dI=function(){var t=!1;null==this.Nc&&(this.Nc=new e.Yj);var i=new e.ja(0);i.Jb(this.g.gd+1);for(var r=this.g.$q(),s=r.next();-1!=s;s=r.next())i.add(s);this.g.mx(i,i.size),i.add(-1),r=this.g.Hd(),s=this.g.Hd(),this.ae=new e.MC(this.g,this.ra,!this.Yz),this.Nc.Wo(this.ae);var n=new e.ja(0),o=new e.ja(0),a=0;new e.h;var l=this.g.ud;this.g.wb.rc();for(var h,c,u=this.g.wb.Aa[0].o,p=i.get(a++);-1!=p;){var d=h=u[2*(c=l.U(p,0))],f=c=u[2*c+1];do{var y=l.U(p,2),g=l.U(p,1);if(-1!=y){var m=l.U(y,0),v=u[2*m];0>(f<(m=u[2*m+1])?-1:f>m?1:d<v?-1:d>v?1:0)&&(o.add(p),o.add(y))}-1!=g&&(v=u[2*(m=l.U(g,0))],0>(f<(m=u[2*m+1])?-1:f>m?1:d<v?-1:d>v?1:0)&&(o.add(g),o.add(g))),-1!=(v=this.g.Qa(p,r))&&(n.add(v),this.g.Sa(p,r,-1)),-1!=(v=this.g.Qa(p,s))&&(n.add(v),this.g.Sa(p,s,-1)),-1!==(p=i.get(a++))&&(d=u[2*(f=l.U(p,0))],f=u[2*f+1])}while(-1!=p&&d===h&&f===c);for(d=1==n.size&&2==o.size,v=f=-1,y=0,g=n.size;y<g;y++){m=n.get(y);var b=this.Nc.xe(m);if(-1==b||n.$F(b)||(f=b),-1==(m=this.Nc.lb(m))||n.$F(m)||(v=m),-1!=f&&-1!=v)break}for(this.ae.SJ(c,h),y=0,g=n.size;y<g;y++)m=n.get(y),this.Nc.wd(m,-1);if(n.clear(!1),!d&&-1!=f&&-1!=v&&this.iO(f,v)){t=!0,this.Oi=this.ae.tm();break}for(y=0,g=o.size;y<g;y+=2){if(c=o.get(y),h=o.get(y+1),d?(c=this.Nc.Au(f,v,c,!0),d=!1):c=this.Nc.addElement(c,-1),this.ae.rg){this.Oi=this.ae.tm(),t=!0;break}-1==this.g.Qa(h,r)?this.g.Sa(h,r,c):this.g.Sa(h,s,c)}if(t)break;o.Ch(0)}return this.g.Ud(r),this.g.Ud(s),t},t.prototype.iO=function(e,t){return this.ae.compare(this.Nc,this.Nc.ka(e),t),e=this.ae.rg,this.ae.Lr(),e},t.qE=function(t){for(var i=t.ld;-1!=i;i=t.ve(i))if(e.ba.Ic(t.jc(i)))return!0;return!1},t.YP=function(e,i,r,s){return!!t.qE(e)&&((i=new t(s)).g=e,i.ra=r,15>e.gd?e=i.fP():i.gP())},t.W=function(e,i,r){return t.YP(e,e.AF(),i,r)},t.cI=function(i,r,s,n,o){if(!t.qE(r))return!1;var a=new t(o);if(a.g=r,a.ra=s,a.Yz=i,a.dI())return null!=n&&n.Xt(a.Oi),!0;var l=new e.Ed;return l.TB(),r.Pc(l),(a=new t(o)).g=r,a.ra=s,a.Yz=i,i=a.dI(),l.TB(),r.Pc(l),!!i&&(null!=n&&n.Xt(a.Oi),!0)},t.Ol=function(e,t){return!(16>(e=e.I()))&&2*e+Math.log(e)*Math.LOG10E/Math.log(2)*t<1*e*t},t.dP=function(i,r,s,n){if(e.ba.Ic(r.K()))return new t(n).eP(i,r,s);throw e.i.ga("crack_A_with_B")},t.prototype.eP=function(r,s,n){var o=new e.l;r.yc(o);var a=new e.l;if(s.yc(a),a.X(n,n),!a.isIntersecting(o))return r;var l=r.Cb,h=null;null!=l&&(h=l.Gb),t.Ol(r,r.I())&&(h=e.ta.kj(r,a));var c=null!=h?h.getIterator():null,u=s.Ha();s=r.Ha();var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(a=[];u.ab();)for(;u.Ia();){var d=u.ia();if(null!=h){for(c.Vo(d,n),l=c.next();-1!=l;l=c.next())if(this.Zq(),s.Wb(h.ka(l),-1),s.Ia()){var f=(l=s.ia()).Fa(d,null,p,null,n);for(l=0;l<f;++l){var y=p[l];if(0!=y&&1!=y){var g=s.xb(),m=new i;m.t=y,m.index=g,a.push(m)}}}}else{var v=new e.l;if(d.yc(v),v.X(n,n),o.isIntersecting(v))for(s.$i();s.ab();)for(;s.Ia();)if(this.Zq(),l=s.ia(),y=new e.l,l.yc(y),y.isIntersecting(v))for(f=l.Fa(d,null,p,null,n),l=0;l<f;++l)0!=(y=p[l])&&1!=y&&(g=s.xb(),(m=new i).t=y,m.index=g,a.push(m))}}if(0==a.length)return r;for(a=a.sort(i.yy),r=r.Ja(),s.$i();s.ab()&&!s.Ia(););for(n=s.ia(),o=new e.hg,h=-1,l=0,c=a.length;l<c;){for(p=a[l].index,u=l+1;u<c&&a[u].index==p;)++u;for(;s.xb()<p;){if(this.Zq(),d=s.Ia(),y=s.gb,(v=d||!s.Pn()||s.Qn())&&r.oc(n,h!=y),h=y,!d)for(;s.ab()&&!s.Ia(););n=s.ia()}for(p=0;l<u;l++)(y=a[l].t)!=p&&(n.bh(p,y,o),p=y,y=s.gb,r.oc(o.get(),h!=y),h=y);if((v=(d=s.Ia())||!s.Pn()||s.Qn())&&(n.bh(p,1,o),r.oc(o.get(),!1)),d)n=s.ia();else{for(;s.ab()&&!s.Ia(););n=s.Ia()?s.ia():null}l=u}for(null!=n&&(y=s.gb,(v=(d=s.Ia())||!s.Pn()||s.Qn())&&r.oc(n,h!=y),h=y),d=s.Ia();;){if(!d){for(;s.ab()&&!(d=s.Ia()););if(!d)break}n=s.ia(),y=s.gb,(v=(d=s.Ia())||!s.Pn()||s.Qn())&&r.oc(n,h!=y),h=y}return r},t}();e.au=t;var i=function(){function e(){}return e.yy=function(e,t){return e.index==t.index?e.t>t.t?1:e.t<t.t?-1:0:e.index>t.index?1:-1},e}()}($||($={})),function(e){var t;(t=e.CK||(e.CK={}))[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Coincident=2]="Coincident",t[t.Undefined=3]="Undefined",t[t.Uncut=4]="Uncut";var i=function(e,t,i,r,s,n,o,a,l,h,c){this.Y=e,this.bt=t,this.Os=i,this.tg=r,this.Nm=h,this.Cl=c};e.iY=i;var r=function(){function t(e,t){this.BH=e,this.Ii=t}return t.prototype.iM=function(t,i){var r=new e.h;this.Ii.D(t,r);var s=new e.h;return this.Ii.D(i,s),0!=(r=r.compare(s))?r:(t=this.Ii.Qa(t,this.BH))<(i=this.Ii.Qa(i,this.BH))?-1:t==i?0:1},t}(),s=function(e,t,i,r,s,n,o,a,l){this.tg=e,this.Os=t,this.IA=i,this.MH=r,this.Fi=s,this.Cl=n,this.Nm=o,this.NH=a,this.ET=l};e.hY=s,e.DK=function(){function t(){}return t.BK=function(r,s,n,o,a,l){if(s.B())r=new i(s,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),a.push(r);else if(n.B())r=new i(s,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),a.push(r);else{var h=new e.hd;if(h.Ib(s),h.Ib(n),e.Tk.W(h,o,l,!0),0==h.gd)r=new i(s.Ja(),4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),a.push(r);else{for(s=0,n=h.Hd(),o=h.ld;-1!=o;o=h.ve(o))for(l=h.Ob(o);-1!=l;l=h.Sb(l))for(var c=h.Ya(l),u=0,p=h.Ka(l);u<p;c=h.V(c),u++)h.Sa(c,n,s++);s=t.zM(n,h),t.VL(r,s,h,a)}}},t.zM=function(i,s){for(var n=s.gd,o=new e.ja(0),a=s.ld;-1!=a;a=s.ve(a))for(var l=s.Ob(a);-1!=l;l=s.Sb(l))for(var h=s.Ya(l),c=0,u=s.Ka(l);c<u;h=s.V(h),c++)o.add(h);var p=new r(i,s);o.Wd(0,n,(function(e,t){return p.iM(e,t)})),i=[];var d=[],f=s.Hd(),y=s.Hd();a=s.ld,l=s.ve(a),u=new e.h;var g=new e.h,m=o.get(0),v=s.cd(m),b=s.Rf(v);s.D(m,u);var w=1;for(h=0;w<n-1;){var _=!1;for(c=w;c<n;c++)if(c!=h){var x=o.get(c),S=s.cd(x),M=s.Rf(S);if(s.D(x,g),!u.rb(g))break;b==a&&M==l&&(_=t.mM(f,y,s,i,d,v,m,S,x))}if(_||h==w-1){if(_&&h==w-1&&w--,++h==n)break;m=o.get(h),v=s.cd(m),b=s.Rf(v),s.D(m,u)}_||(w=h+1)}for(n=[],a=s.ld;-1!=a;a=s.ve(a))for(l=s.Ob(a);-1!=l;l=s.Sb(l))for(o=s.Ya(l),c=0,u=s.Ka(l);c<u;o=s.V(o),c++){if(0<=(h=s.Qa(o,y)))for(;h<d.length&&d[h].tg==o;)n.push(d[h++]);if(0<=(h=s.Qa(o,f)))for(;h<i.length&&i[h].tg==o;)n.push(i[h++])}return s.Ud(f),s.Ud(y),n},t.mM=function(e,i,r,s,n,o,a,l,h){var c=r.sj(o),u=r.sj(l),p=r.Ya(o),d=r.Ya(l),f=r.Na(a),y=r.Na(h),g=!1,m=!1,v=!1,b=!1;return a!=p&&(h!=d&&(g=t.nM(e,r,s,o,f,l,y)),h!=u&&(m=t.oM(e,r,s,o,f,l,h))),a!=c&&(h!=d&&(v=t.pM(i,r,n,o,a,l,y,p)),h!=u&&(b=t.qM(i,r,n,o,a,l,h,p))),g&&m&&v?(e=s.length-1,2==n[b?n.length-2:n.length-1].Fi&&(s[e-1]=s[e],--s.length)):g&&m&&b&&2==n[n.length-1].Fi&&(n=s[s.length-1],--s.length,r.Qa(n.tg,e)==s.length&&r.Sa(n.tg,e,-1)),g||m||v||b},t.nM=function(t,i,r,n,o,a,l){var h=new e.zb,c=new e.zb,u=[0,0],p=[0,0],d=i.cc(o);return null==d&&(i.fd(o,h),d=h),null==(h=i.cc(l))&&(i.fd(l,c),h=c),2>(d=d.Fa(h,null,u,p,0))&&(n=new s(o,n,u[0],NaN,d,l,a,p[0],NaN),r.push(n),0>(n=i.Qa(o,t))&&i.Sa(o,t,r.length-1)),!0},t.oM=function(t,i,r,n,o,a,l){var h=new e.zb,c=new e.zb,u=[0,0],p=[0,0],d=i.cc(o);return null==d&&(i.fd(o,h),d=h),null==(h=i.cc(l))&&(i.fd(l,c),h=c),2>(d=d.Fa(h,null,u,p,0))&&(n=new s(o,n,u[0],NaN,d,l,a,p[0],NaN),r.push(n),0>(n=i.Qa(o,t))&&i.Sa(o,t,r.length-1),!0)},t.pM=function(t,i,r,n,o,a,l,h){var c=new e.zb,u=new e.zb,p=[0,0],d=[0,0],f=i.cc(o);return null==f&&(i.fd(o,c),f=c),null==(c=i.cc(l))&&(i.fd(l,u),c=u),2==(f=f.Fa(c,null,p,d,0))?(n=new s(o,n,p[0],p[1],f,l,a,d[0],d[1]),r.push(n),0>(n=i.Qa(o,t))&&i.Sa(o,t,r.length-1),!0):(u=!1,o==h&&(n=new s(o,n,p[0],NaN,f,l,a,d[0],NaN),r.push(n),0>(n=i.Qa(o,t))&&i.Sa(o,t,r.length-1),u=!0),u)},t.qM=function(t,i,r,n,o,a,l,h){var c=new e.zb,u=new e.zb,p=[0,0],d=[0,0],f=i.cc(o);return null==f&&(i.fd(o,c),f=c),null==(c=i.cc(l))&&(i.fd(l,u),c=u),2==(f=f.Fa(c,null,p,d,0))?(n=new s(o,n,p[0],p[1],f,l,a,d[0],d[1]),r.push(n),0>(n=i.Qa(o,t))&&i.Sa(o,t,r.length-1),!0):(u=!1,o==h&&(n=new s(o,n,p[0],NaN,f,l,a,d[0],NaN),r.push(n),0>(n=i.Qa(o,t))&&i.Sa(o,t,r.length-1),u=!0),u)},t.VL=function(r,s,n,o){var a=[];a[0]=new e.h,a[1]=new e.h,a[2]=new e.h,a[3]=new e.h;var l=new e.h,h=new e.h,c=new e.h,u=new e.h,p=null;null!=o&&(p=new e.hg).Pr();var d=0,f=null,y=new e.zb;new e.zb;for(var g=n.Ob(n.ld);-1!=g;g=n.Sb(g)){for(var m=4,v=-1,b=-1,w=-1,_=-1,x=NaN,S=!0,M=!1,T=!0,I=!0,E=!0,A=0,P=g,C=0,O=n.Ya(g),k=n.Ka(g),L=0;L<k;O=n.V(O),L++){var R=n.cc(O);if(null==R){if(!n.fd(O,y))continue;R=y}-1==b&&(b=O);for(var D=0;d<s.length&&O==s[d].tg;){v=s[d].Os;var F=s[d].tg,j=s[d].IA,N=s[d].Nm,z=s[d].Cl,V=s[d].NH;if(2==s[d].Fi){if(M||(P=v,b=F,C=j,w=N,_=z,x=V,m=2,null!=o?f=new e.Ua:A=0,E=!1,I=!0),j=s[d].MH,V=s[d].ET,null!=o?(R.bh(D,s[d].MH,p),f.oc(p.get(),I)):A++,D=j,M=!0,I=S=!1,d+1==s.length||2!=s[d+1].Fi||s[d+1].tg==F&&s[d+1].IA!=D){if(null!=o){var U=new i(f,2,v,F,j,m,P,b,C,N,z,V,w,_,x);o.push(U)}else null.add(A);P=v,b=F,C=j,w=N,_=z,x=V,m=2,M=S=!1,I=E=!0}}else{var G=n.V(F);if(d<s.length-1&&s[d+1].tg==G&&s[d+1].Cl==z&&2==s[d+1].Fi)j!=D&&(E&&(null!=o?f=new e.Ua:A=0),S=0<d&&s[d-1].Os==v?1==m?0:0==m?1:3:3,null!=o?(R.bh(D,j,p),f.oc(p.get(),I),U=new i(f,S,v,F,j,m,P,b,C,N,z,V,w,_,x),o.push(U)):(A++,null.add(A)),D=j,P=v,b=F,C=j,w=N,_=z,x=V,m=S,S=T=!1,I=E=!0);else if(!t.uM(r,n,s,d,l,h)){t.rM(n,s,d,g,O,c,u);var B=!1;if(G=!1,U=!0,!(l.rb(c)||h.rb(c)||l.rb(u)||h.rb(u))){a[0].N(l),a[1].N(h),a[2].N(c),a[3].N(u),a.sort(e.h.ou);var q=a[0],H=a[1],W=a[2],$=a[3];q.rb(l)?H.rb(h)?r?(G=B=!0,U=!1):B=!1:$.rb(h)?r?U=G=B=!0:B=!1:(B=!0,U=H.rb(c)):H.rb(l)?W.rb(h)?r?(G=B=!0,U=!1):B=!1:q.rb(h)?r?U=G=B=!0:B=!1:(B=!0,U=W.rb(c)):W.rb(l)?$.rb(h)?r?(G=B=!0,U=!1):B=!1:H.rb(h)?r?U=G=B=!0:B=!1:(B=!0,U=$.rb(c)):q.rb(h)?r?(G=B=!0,U=!1):B=!1:W.rb(h)?r?U=G=B=!0:B=!1:(B=!0,U=q.rb(c))}B&&(B=O==F,(j!=D||B&&0==D)&&(E&&(null!=o?f=new e.Ua:A=0),null!=o?(R.bh(D,j,p),f.oc(p.get(),I)):A++),U?1!=m?((j!=D||B&&0==D)&&(null!=o?(U=new i(f,1,v,F,j,m,P,b,C,N,z,V,w,_,x),o.push(U)):null.add(A)),G?(d>=s.length-2||s[d+2].Os!=v)&&(m=0):m=1):((j!=D||B&&0==D)&&(null!=o?(U=new i(f,3,v,F,j,m,P,b,C,N,z,V,w,_,x),o.push(U)):null.add(A)),m=1):0!=m?((j!=D||B&&0==D)&&(null!=o?(U=new i(f,0,v,F,j,m,P,b,C,N,z,V,w,_,x),o.push(U)):null.add(A)),G?(d>=s.length-2||s[d+2].Os!=v)&&(m=1):m=0):((j!=D||B&&0==D)&&(null!=o?(U=new i(f,3,v,F,j,m,P,b,C,N,z,V,w,_,x),o.push(U)):null.add(A)),m=0),(j!=D||B&&0==D)&&(D=j,P=v,b=F,C=j,w=N,_=z,x=V,S=T=!1,I=E=!0))}}d++}1!=D&&(E&&(null!=o?f=new e.Ua:A=0),null!=o?(R.bh(D,1,p),f.oc(p.get(),I)):A++,I=E=!1,T=!0)}T&&(j=1,F=n.sj(g),F=n.Na(F),z=N=-1,V=NaN,S?null!=o?(U=new i(f,4,v,F,j,m,P,b,C,N,z,V,w,_,x),o.push(U)):null.add(A):(S=1==m?0:0==m?1:3,null!=o?(U=new i(f,S,v,F,j,m,P,b,C,N,z,V,w,_,x),o.push(U)):null.add(A)))}},t.uM=function(i,r,s,n,o,a){var l=s[n].NH;if(1==l)return t.sM(i,r,s,n,o,a);if(0==l)return t.tM(i,r,s,n,o,a);throw e.i.Ra()},t.sM=function(t,i,r,s,n,o){var a=new e.zb,l=r[s].tg,h=r[s].Nm,c=r[s].Cl,u=-1,p=-1,d=-1,f=-1;if(!t&&0<s){var y=r[s-1];u=y.tg,p=y.Nm,d=y.Cl,f=y.Fi}var g=-1,m=-1,v=-1,b=-1;s<r.length-1&&(g=(y=r[s+1]).tg,m=y.Nm,v=y.Cl,b=y.Fi);var w=i.V(l);return y=i.V(c),t?s==r.length-1||g!=l||m!=h||v!=y||2==b?(null==(t=i.cc(c))&&(i.fd(c,a),t=a),o.N(t.jg()),n.mt(o),o.normalize(),n.normalize(),!1):(null==(t=i.cc(c))&&(i.fd(c,a),t=a),n.N(t.jg()),null==(t=i.cc(y))&&(i.fd(y,a),t=a),o.N(t.jg()),n.Uq(),o.normalize(),n.normalize(),!1):0<s&&u==l&&p==h&&d==y&&2==f||s<r.length-1&&g==w&&m==h&&v==y&&2==b?(null==(t=i.cc(c))&&(i.fd(c,a),t=a),o.N(t.jg()),n.mt(o),o.normalize(),n.normalize(),!1):!(s<r.length-1&&g==l&&m==h&&v==y&&(null==(t=i.cc(c))&&(i.fd(c,a),t=a),n.N(t.jg()),null==(t=i.cc(y))&&(i.fd(y,a),t=a),o.N(t.jg()),n.Uq(),o.normalize(),n.normalize(),1))},t.tM=function(t,i,r,s,n,o){var a=new e.zb,l=r[s].tg,h=r[s].Nm,c=r[s].Cl,u=-1,p=-1,d=-1,f=-1;if(!t&&s<r.length-1){var y=r[s+1];u=y.tg,p=y.Nm,d=y.Cl,f=y.Fi}var g=-1,m=-1,v=-1;y=-1,0<s&&(g=(y=r[s-1]).tg,m=y.Nm,v=y.Cl,y=y.Fi);var b=i.V(l),w=i.Na(c);return t?0!=s&&g==l&&m==h&&v==w&&2!=y||(null==(t=i.cc(c))&&(i.fd(c,a),t=a),o.N(t.jg()),n.mt(o),o.normalize(),n.normalize(),!1):!(0<s&&g==l&&m==h&&v==w&&2==y||s<r.length-1&&u==b&&p==h&&d==w&&2==f)||(null==(t=i.cc(c))&&(i.fd(c,a),t=a),o.N(t.jg()),n.mt(o),o.normalize(),n.normalize(),!1)},t.rM=function(t,i,r,s,n,o,a){var l=new e.zb,h=t.cc(n);if(null==h&&(t.fd(n,l),h=l),i=(r=i[r]).tg,r=r.IA,n=t.V(i),1==r)o.N(h.jg()),-1!=n&&n!=t.sj(s)?(null==(h=t.cc(n))&&(t.fd(n,l),h=l),a.N(h.jg()),null==(h=t.cc(i))&&t.fd(i,l)):a.N(o),o.Uq(),a.normalize(),o.normalize();else{if(0!=r)throw e.i.Ra();a.N(h.jg()),o.mt(a),a.normalize(),o.normalize()}},t}()}($||($={})),function(e){var t;(t=e.UL||(e.UL={}))[t.Linear=0]="Linear",t[t.Angular=1]="Angular",t[t.Area=2]="Area";var i=function(){function t(e,t,i){this.od=t,this.bi=i,this.pA=e}return t.prototype.Nb=function(e){return e instanceof t&&this.bi===e.bi},t.TF=function(e){return 0!==e.od?null:-1===e.pA?new t(-1,2,e.bi*e.bi):t.$g(a[e.pA])},t.$g=function(e){return void 0===(e=o[e])?null:e},t.RO=function(e,i,r){var s=null;if(null!=r)try{"EPSG"===r.values[0]&&(s=t.$g(parseInt(r.values[1])))}catch(n){}return null===s&&(s=new t(-1,e,i)),s},t.prototype.Fc=function(){return this.pA},t.prototype.uF=function(t){if(t.od!=this.od)throw e.i.Hb();return this.bi/t.bi},t.Oh=function(e,t,i){return t.uF(i)*e},t.PE=function(e,t,i,r,s){for(i=i.uF(r),r=0;r<t;r++)s[r]=e[r]*i},t}();e.Uc=i;for(var r=[109401,1e4,109402,4046.8564224,109403,4046.87260987425,109404,1,109405,.09290304,109406,.09290341161327487,109407,.09290137299531805,109408,3.34450944,109409,3429904,109410,1.000027193184865,109411,404.6872609874253,109412,.04046872609874253,109413,2589998.4703195216,109414,1e6,109415,.8361123569578626,109416,404.67838076760535,109417,.04046783807676053,109418,.8361244606523066,109419,.09290271785025629,109420,404.68423895571647,109421,.04046842389557164,109422,.83612589696064,109423,.0929028774400711,109424,404.6849341289498,109425,.04046849341289498,109426,.836125904805842,109427,.09290287831176021,109428,404.68493792602754,109429,.04046849379260275,109430,.09290354800069446,109431,.09290274144751023,109432,.09290207073852812,109433,.09290279616016,109434,.09290273520025,109435,.836124673027592,109436,.836118636646753,109437,.8361251654414399,109438,.83612461680225,109439,2589988.110336,109440,.09290286332673177,109441,.09290349665192114,109442,.83612736,109443,.8361307045194736,109444,404.68564224000005,109445,.04046856422400001,109446,.8361237024040001,109447,.0929026336004445,109448,404.683871963536,109449,.0404683871963536,109450,.01,109451,1e-4,109452,1e-6,109453,64516e-8,109454,.0006451625806477421,109455,25.292852640000003,109456,25.29295381171408,109457,3434528.1495040003,109458,3434290.937856,109459,2.89612324,109460,25e8,109461,225e8,109462,.7168473118308245,109463,100,109464,1.244521604938272e-7,109465,1e-12,109466,1e-18],s=[1031,4.84813681109536e-9,9101,1,9102,.0174532925199433,9103,.0002908882086657216,9104,484813681109536e-20,9105,.01570796326794897,9106,.01570796326794897,9109,1e-6,9112,.0001570796326794897,9113,1570796326794897e-21,9114,.0009817477042468104],n=[1025,.001,109452,1033,.01,109451,9001,1,109404,9002,.3048,109405,9003,.3048006096012192,109406,9005,.3047972654,109407,9014,1.8288,109408,9030,1852,109409,9031,1.0000135965,109410,9033,20.11684023368047,109411,9034,.2011684023368047,109412,9035,1609.3472186944375,109413,9036,1e3,109414,9037,.9143917962000001,109415,9038,20.1166195164,109416,9039,.201166195164,109417,9040,.9143984146160287,109418,9041,.304799471538676,109419,9042,20.116765121552632,109420,9043,.2011676512155263,109421,9050,.9143992,109422,9051,.3047997333333333,109423,9052,20.1167824,109424,9053,.201167824,109425,9060,.9143992042898124,109426,9061,.3047997347632708,109427,9062,20.116782494375872,109428,9063,.2011678249437587,109429,9070,.3048008333333334,109430,9080,.3047995102481469,109431,9081,.30479841,109432,9082,.3047996,109433,9083,.3047995,109434,9084,.9143985307444408,109435,9085,.91439523,109436,9086,.9143988,109437,9087,.9143985,109438,9093,1609.344,109439,9094,.3047997101815088,109440,9095,.3048007491,109441,9096,.9144,109442,9097,20.1168,109444,9098,.201168,109445,9099,.914398,109446,9300,.3047993333333334,109447,9301,20.116756,109448,9302,.20116756,109449,109001,.9144,109442,109002,.9144018288036576,109443,109003,20.1168,109444,109004,.201168,109445,109005,.1,109450,109006,.01,109451,109007,.001,109452,109008,.0254,109453,109009,.0254000508001016,109454,109010,5.0292,109455,109011,5.029210058420118,109456,109012,1853.248,109457,109013,1853.184,109458,109014,1.7018,109459,109015,.8466683600033867,109462,109016,.0003527777777777778,109464,109017,1e-6,109465,109018,1e-9,109466,109030,5e4,109460,109031,15e4,109461],o=[],a=[],l=0;l<r.length;l+=2)o[r[l]]=new i(r[l],2,r[l+1]);for(r=null,l=0;l<s.length;l+=2)o[s[l]]=new i(s[l],1,s[l+1]);for(s=null,l=0;l<n.length;l+=3)o[n[l]]=new i(n[l],0,n[l+1]),a[n[l]]=n[l+2];n=null}($||($={})),function(e){var t=function(){function e(){this.yb=this.pb=0}return e.prototype.set=function(e,t){void 0!==t?(this.pb=e,this.yb=t):"number"==typeof e?(this.pb=e,this.yb=0):(this.pb=e.pb,this.yb=e.yb)},e.prototype.value=function(){return this.pb},e.prototype.add=function(e){var t=this.pb+e.pb;e=this.yb+e.yb+2220446049250313e-31*Math.abs(t),this.pb=t,this.yb=e},e.prototype.cN=function(){var e=this.pb+1,t=this.yb+2220446049250313e-31*Math.abs(e);this.pb=e,this.yb=t},e.prototype.WM=function(e,t){this.pb=e.pb+t.pb,this.yb=e.yb+t.yb+2220446049250313e-31*Math.abs(this.pb)},e.prototype.sub=function(e){if("number"==typeof e){var t=this.pb-e;e=this.yb+2220446049250313e-31*Math.abs(t)}else t=this.pb-e.pb,e=this.yb+e.yb+2220446049250313e-31*Math.abs(t);this.pb=t,this.yb=e},e.prototype.Ag=function(e){var t=this.pb*e.pb;this.yb=this.yb*Math.abs(e.pb)+e.yb*Math.abs(this.pb)+this.yb*e.yb+2220446049250313e-31*Math.abs(t),this.pb=t},e.prototype.Oo=function(e){var t=this.pb*e;this.yb=this.yb*Math.abs(e)+2220446049250313e-31*Math.abs(t),this.pb=t},e.prototype.Ml=function(e,t){var i=Math.abs(e.pb)*Math.abs(t.pb);this.yb=e.yb*Math.abs(t.pb)+t.yb*Math.abs(e.pb)+e.yb*t.yb+2220446049250313e-31*Math.abs(i),this.pb=i},e.prototype.lm=function(e){var t=Math.abs(e.pb),i=this.pb/e.pb,r=(this.yb+Math.abs(i)*e.yb)/t;e.yb>.01*t&&(r*=1+(1+(e=e.yb/t))*e),this.pb=i,this.yb=r+2220446049250313e-31*Math.abs(i)},e.prototype.sqrt=function(){if(0<=this.pb){var e=Math.sqrt(this.pb),t=this.pb>10*this.yb?.5*this.yb/e:this.pb>this.yb?e-Math.sqrt(this.pb-this.yb):Math.max(e,Math.sqrt(this.pb+this.yb)-e);t+=2220446049250313e-31*Math.abs(e)}else this.pb<-1*this.yb?t=e=NaN:(e=0,t=Math.sqrt(this.yb));this.pb=e,this.yb=t},e.prototype.sin=function(e){var t=Math.sin(e.pb),i=Math.cos(e.pb);this.pb=t,t=Math.abs(t),this.yb=(Math.abs(i)+.5*t*e.yb)*e.yb+2220446049250313e-31*t},e.prototype.cos=function(e){var t=Math.sin(e.pb),i=Math.cos(e.pb);this.pb=i,i=Math.abs(i),this.yb=(Math.abs(t)+.5*i*e.yb)*e.yb+2220446049250313e-31*i},e.prototype.qg=function(){return Math.abs(this.pb)<=this.yb},e.prototype.qs=function(){return this.qg()&&0!=this.yb},e}();e.Xb=t}($||($={}));var Q=new $.h,ee=new $.h,te=new $.h,ie=new $.h,re=new $.h;!function(e){var t,i;(i=t||(t={}))[i.closedPath=1]="closedPath",i[i.exteriorPath=2]="exteriorPath",i[i.ringAreaValid=4]="ringAreaValid";var r=function(){function t(e,t,i,r,s,n,o){void 0!==t?(this.ib=e,this.ck=t,this.cl=i,this.ji=r,this.za=n,this.cA=o,this.fw=s):(this.ib=e.ib,this.ck=e.ck,this.cl=e.cl,this.ji=e.ji,this.za=e.za,this.cA=e.cA,this.fw=e.fw),this.UG=!0}return t.prototype.next=function(){return this.UG?(this.UG=!1,this.ji):-1!=this.ji?(this.ji=this.ib.V(this.ji),this.za++,-1!=this.ji&&this.ji!=this.fw?this.ji:this.QT()):-1},t.prototype.QT=function(){for(this.cl=this.ib.Sb(this.cl),this.za=0;-1!=this.ck;){for(;-1!=this.cl;this.cl=this.ib.Sb(this.cl))if(this.fw=this.ji=this.ib.Ya(this.cl),-1!=this.ji)return this.ji;if(this.ck=this.ib.ve(this.ck),-1==this.ck)break;this.cA&&!e.ba.Ic(this.ib.jc(this.ck))||(this.cl=this.ib.Ob(this.ck))}return-1},t.sP=function(e,i,r,s,n,o,a){return new t(e,i,r,s,n,o,a)},t}();e.nY=r,t=function(){function t(){this.ko=this.Cm=this.wk=this.dd=this.Ck=this.wo=this.Pi=this.md=this.ci=this.Tg=this.Te=this.Kl=null,this.rw=this.ld=-1,this.gd=0,this.aA=!1,this.ht=this.it=this.wb=null}return t.prototype.Th=function(e){return null!=this.Te?this.Te[e]:null},t.prototype.Yg=function(e,t){if(null==this.Te){if(null==t)return;this.Te=[];for(var i=0,r=this.wb.I();i<r;i++)this.Te.push(null)}this.Te[e]=t},t.prototype.cp=function(e,t){this.md.T(e,1,t)},t.prototype.bp=function(e,t){this.md.T(e,2,t)},t.prototype.OB=function(e,t){this.md.T(e,6,t)},t.prototype.Up=function(e){return this.md.U(e,6)},t.prototype.fx=function(e,t){this.md.T(e,7,t)},t.prototype.rv=function(e){return this.md.U(e,0)},t.prototype.GJ=function(e,t){this.dd.T(e,1,t)},t.prototype.KJ=function(e,t){this.dd.T(e,0,t)},t.prototype.BF=function(e){return this.dd.U(e,7)},t.prototype.$o=function(e,t){this.dd.T(e,3,t)},t.prototype.ap=function(e,t){this.dd.T(e,4,t)},t.prototype.kU=function(t){null==this.dd&&(this.dd=new e.ad(8));var i=this.dd.De();return this.dd.T(i,2,t),this.dd.T(i,5,0),this.dd.T(i,6,0),this.dd.T(i,7,i),i},t.prototype.GQ=function(e){this.dd.kd(e)},t.prototype.mU=function(t){null==this.md&&(this.md=new e.ad(8),this.ud=new e.ad(5),this.Pi=new e.ce(0),this.wo=new e.ce(0));var i=this.md.De();return this.md.T(i,0,i),this.md.T(i,3,0),this.md.T(i,6,0),this.fx(i,t),i>=this.Pi.size&&(t=16>i?16:e.P.truncate(3*i/2),this.Pi.resize(t),this.wo.resize(t)),this.Pi.set(i,0),this.wo.set(i,0),i},t.prototype.kF=function(e){this.md.kd(e)},t.prototype.Qy=function(e){this.ud.kd(e),this.gd--},t.prototype.gI=function(t){null==this.md&&(this.md=new e.ad(8),this.ud=new e.ad(5),this.Pi=new e.ce(0),this.wo=new e.ce(0));var i=this.ud.De(),r=0<=t?t:i;if(this.ud.T(i,0,r),0>t){if(r>=this.wb.I()){if(t=16>r?16:e.P.truncate(3*r/2),this.wb.resize(t),null!=this.Te)for(var s=0;s<t;s++)this.Te.push(null);null!=this.Tg&&this.Tg.resize(t),this.it=this.wb.vb(0)}this.wb.Db(r,-1e38,-1e38),null!=this.Te&&(this.Te[r]=null),null!=this.Tg&&this.Tg.write(r,1)}return this.ud.T(i,4,2*r),this.gd++,i},t.prototype.xj=function(e,t,i){var r=-1!=t?this.Na(t):this.sj(e),s=-1!=r?this.V(r):-1,n=this.gI(null==i?this.gd:-1),o=this.Va(n);return null!=i&&this.wb.Ht(o,i),this.bj(n,e),this.Cc(n,s),this.Dc(n,r),-1!=s&&this.Dc(s,n),-1!=r&&this.Cc(r,n),i=this.ec(e),r=this.Ya(e),-1==t&&this.Xg(e,n),t==r&&this.Kf(e,n),i&&-1==s&&(this.Cc(n,n),this.Dc(n,n)),this.Wj(e,this.Ka(e)+1),e=this.Rf(e),this.Uj(e,this.I(e)+1),n},t.prototype.pm=function(){return null==this.ko&&(this.ko=new e.Ta(this.wb.description)),this.ko},t.prototype.Zo=function(e,t){this.dd.T(e,2,-134217729&this.dd.U(e,2)||(1==t?134217728:0))},t.prototype.Jn=function(e){return 0!=(134217728&this.dd.U(e,2))?1:0},t.prototype.$M=function(e){var t=this.Kg(e.K(),e.description);return 1736==e.K()&&this.Zo(t,e.Jn()),this.MD(t,e),t},t.prototype.aN=function(e){var t=this.Kg(e.K(),e.description);return this.ND(t,e),t},t.prototype.NV=function(t,i){null==this.md&&(this.md=new e.ad(8),this.ud=new e.ad(5),this.Pi=new e.ce(0),this.wo=new e.ce(0)),this.md.Ee(this.md.Jg+t),this.ud.Ee(this.ud.Jg+i),this.Pi.Jb(this.Pi.size+t),this.wo.Jb(this.wo.size+t)},t.prototype.MD=function(t,i){this.NV(i.ea(),i.I()),this.Kl.Gd(i,0,i.I()),this.it=this.wb.vb(0);for(var r=null!=this.Te&&null!=i.Se,s=0,n=i.ea();s<n;s++)if(!(2>i.Ka(s))){var o=this.wf(t,-1);this.mn(o,i.ec(s));for(var a=i.Ca(s),l=i.Wc(s);a<l;a++){var h=this.xj(o,-1,null);if(r)if(h=this.Va(h),0!=(1&i.RF(a)))this.Yg(h,null);else{var c=new e.hg;i.cc(a,c,!0),this.Yg(h,c.get())}}}},t.prototype.ND=function(e,t){this.Kl.Gd(t,0,t.I()),this.it=this.wb.vb(0),e=this.wf(e,-1);var i=0;for(t=t.I();i<t;i++)this.xj(e,-1,null)},t.prototype.BX=function(t,i,r){var s=this.V(t);if(-1==s)throw e.i.Ra();for(var n=this.pm(),o=this.cd(t),a=0,l=i.ql(r);a<l;a++){var h=this.Va(t),c=this.V(t),u=i.Xp(r,a);0==a&&(u.Uo(n),this.Eh(t,n)),322==u.K()?this.Yg(h,null):this.Yg(h,e.ba.ig(u)),u.Qo(n),a<l-1?t=this.xj(o,c,n):this.Eh(s,n)}},t.prototype.AX=function(t,i,r){var s=this.V(t);if(-1==s)throw e.i.Ra();for(var n=this.pm(),o=this.cd(t),a=0,l=i.ql(r);a<l;a++){var h=this.Va(t),c=this.V(t),u=i.Xp(r,l-a-1);0==a&&(u.Qo(n),this.Eh(t,n)),322==u.K()?this.Yg(h,null):this.Yg(h,e.ba.ig(u)),u.Uo(n),a<l-1?t=this.xj(o,c,n):this.Eh(s,n)}},t.prototype.AF=function(){var t=new e.l;t.Pa();for(var i=this.$q(),r=new e.h,s=!0,n=i.next();-1!=n;n=i.next())this.D(n,r),s?t.$b(r.x,r.y):t.Lk(r.x,r.y),s=!1;return t},t.prototype.Ib=function(t){var i=t.K();if(e.ba.Ic(i))return this.$M(t);if(550==i)return this.aN(t);throw e.i.Ra()},t.prototype.mN=function(t,i){var r=i.K();if(e.ba.Ic(r))this.MD(t,i);else{if(550!=r)throw e.i.Ra();this.ND(t,i)}},t.prototype.eN=function(t,i){var r=this.Kg(1736,t.description);if(2>t.Ka(i))return r;this.Kl.Gd(t,t.Ca(i),t.Wc(i)),this.it=this.wb.vb(0);var s=this.wf(r,-1);this.mn(s,t.ec(i)||!0);var n=null!=this.Te&&null!=t.Se,o=t.Ca(i);for(i=t.Wc(i);o<i;o++){var a=this.xj(s,-1,null);if(n)if(a=this.Va(a),0!=(1&t.RF(o)))this.Yg(a,null);else{var l=new e.hg;t.cc(o,l,!0),this.Yg(a,l.get())}}return r},t.prototype.Ke=function(t){var i=this.jc(t),r=e.RK.Kg(i,this.Kl.description),s=this.I(t);if(0==s)return r;if(e.ba.Ic(i)){i=this.ea(t);for(var n=e.Zc.Ph(i+1),o=e.Zc.Nr(i+1,0),a=r.description,l=0,h=a.Ba;l<h;l++){for(var c=a.qd(l),u=e.ua.Wa(c),p=e.Zc.QE(c,s),d=this.wb.vb(c),f=0,y=0,g=0,m=this.Ob(t);-1!=m;m=this.Sb(m)){var v=0;this.ec(m)&&(v|=1),this.OS(m)&&(v|=4),0!=v&&o.rJ(y,v);var b=this.Ka(m);if(n.write(y++,g),g+=b,0==c){b=d;var w=p,_=new e.h;for(v=this.Ya(m);f<g;v=this.V(v),f++){var x=this.Va(v);b.uc(2*x,_),w.Ut(2*f,_)}}else for(v=this.Ya(m);f<g;v=this.V(v),f++)for(x=this.Va(v),w=0;w<u;w++)_=d.Bg(x*u+w),p.rr(f*u+w,_)}r.kn(c,p),n.write(i,s)}r.HJ(o),r.IJ(n),r.Qc(16777215)}else if(550==i){for(a=r.description,r.resize(s),l=0,h=a.Ba;l<h;l++){for(c=a.qd(l),u=e.ua.Wa(c),p=r.vb(c),d=this.wb.vb(c),f=0,m=this.Ob(t),b=this.Ka(m),v=this.Ya(m);f<b;v=this.V(v),f++)for(x=this.Va(v),w=0;w<u;w++)_=d.Bg(x*u+w),p.rr(f*u+w,_);r.kn(c,p)}r.Qc(16777215)}return r},t.prototype.vB=function(e){for(var t=this.Ob(e);-1!=t;t=this.ar(t));t=this.GR(e);var i=this.ve(e);-1!=t?this.GJ(t,i):this.ld=i,-1!=i?this.KJ(i,t):this.rw=t,this.GQ(e)},t.prototype.Kg=function(t,i){return void 0===i?this.SE(t,e.ee.og()):this.SE(t,i)},t.prototype.SE=function(t,i){return t=this.kU(t),null==this.wb?this.wb=this.Kl=new e.de(i):this.Kl.Ll(i),this.ht=this.Kl.description,this.aA=1<this.ht.Ba,-1==this.ld?this.ld=t:(this.KJ(t,this.rw),this.GJ(this.rw,t)),this.rw=t},t.prototype.ve=function(e){return this.dd.U(e,1)},t.prototype.GR=function(e){return this.dd.U(e,0)},t.prototype.jc=function(e){return 2147483647&this.dd.U(e,2)},t.prototype.zJ=function(t,i,r){i=this.wk[i],(t=this.BF(t))>=i.size&&i.resize(Math.max(e.P.truncate(1.25*t),16),-1),i.write(t,r)},t.prototype.CF=function(e,t){return(e=this.BF(e))<(t=this.wk[t]).size?t.read(e):-1},t.prototype.TE=function(){null==this.wk&&(this.wk=[]);for(var t=0;t<this.wk.length;t++)if(null==this.wk[t])return this.wk[t]=e.Zc.Ph(0),t;return this.wk.push(e.Zc.Ph(0)),this.wk.length-1},t.prototype.nW=function(e){this.wk[e]=null},t.prototype.Ob=function(e){return this.dd.U(e,3)},t.prototype.lv=function(e){return this.dd.U(e,4)},t.prototype.I=function(e){return this.dd.U(e,5)},t.prototype.ea=function(e){return this.dd.U(e,6)},t.prototype.Ip=function(t,i,r){for(var s=0,n=this.ld;-1!=n;n=this.ve(n)){var o=this.jc(n);if(e.ba.Ic(o)&&(!r||1736==o)){o=1736==this.jc(n);for(var a=this.Ob(n);-1!=a;){for(var l=0,h=this.Ya(a);l<e.P.truncate(this.Ka(a)/2);){var c=this.V(h);if(-1==c)break;var u=this.Va(h),p=this.Th(u);null!=p?u=p.Rb():(p=this.Va(c),u=this.wb.Ar(u,p)),u<=t?(0==u?0==s&&(s=-1):s=1,c!=this.sj(a)&&(this.eC(c,h),this.pd(c,!0))):h=this.V(h),l++}for(l=this.Ya(a),h=this.ec(a)?l:this.sj(a);0<this.Ka(a);){if(-1==(c=this.Na(h))){this.pd(h,!0),0==s&&(s=-1);break}var d=this.Va(c);if(null!=(p=this.Th(d))?u=p.Rb():(u=this.Va(h),u=this.wb.Ar(u,d)),u<=t)0==u?0==s&&(s=-1):s=1,this.eC(c,h),this.pd(c,!1),l==c&&(l=this.Ya(a));else if((h=this.Na(h))==l)break}h=this.Ka(a),i&&(o?3>h:2>h)?(a=this.ar(a),s=0<h?1:0==s?-1:s):a=this.Sb(a)}}}return s},t.prototype.eC=function(e,t){var i=this.Va(e),r=this.Va(t);if(null!=this.Tg&&(i=this.Tg.read(i),this.Tg.write(r,i)),null!=this.ci)for(r=0,i=this.ci.length;r<i;r++)if(null!=this.ci[r]){var s=this.Qa(e,r);-1!=s&&this.Sa(t,r,s)}},t.prototype.Wl=function(t,i,r){var s=0,n=this.V(t);if(-1==n)throw e.i.Ra();for(var o=this.Va(t),a=this.Va(n),l=this.Th(o),h=null==l?this.wb.Ar(o,a):l.Rb(),c=0;c<r;c++){var u=i[c];if(0<u&&1>u){var p=u;null!=l&&(p=0<h?l.Sx(u)/h:0),this.wb.cD(o,a,p,this.pm());var d=this.xj(this.cd(t),n,this.pm());if(s++,null!=l){var f=l.el(0,u);p=this.Va(this.Na(d)),this.Yg(p,f),this.mf(d,f.xc()),c!=r-1&&1!=i[c+1]||(u=l.el(u,1),this.Yg(p,u))}}}return s},t.prototype.zX=function(t,i,r){var s=0,n=this.V(t);if(-1==n)throw e.i.ga("internal error");var o=this.Va(t),a=this.Va(n),l=this.Th(o),h=null==l?this.wb.Ar(o,a):l.Rb(),c=0;t=this.cd(t);for(var u=0;u<r;u++){var p=i[u];if(c<p&&1>p){var d=p;if(null!=l&&(d=0<h?l.Sx(p)/h:0),this.wb.cD(o,a,d,this.pm()),d=this.pS(t,n,this.pm()),s++,null!=l){c=l.el(c,p);var f=this.Va(this.Na(d));this.Yg(f,c),this.Db(d,c.qa,c.ma),u!=r-1&&1!=i[u+1]||(c=l.el(p,1),d=this.Va(d),this.Yg(d,c))}}c=p}return s},t.prototype.pS=function(e,t,i){var r=-1!=t?this.Na(t):this.sj(e),s=-1!=r?this.V(r):-1,n=this.gI(null==i?this.gd:-1),o=this.Va(n);return null!=i&&this.wb.Ht(o,i),this.bj(n,e),this.Cc(n,s),this.Dc(n,r),-1!=s&&this.Dc(s,n),-1!=r&&this.Cc(r,n),i=this.ec(e),r=this.Ya(e),-1==t&&this.Xg(e,n),t==r&&(i&&-1!=r||this.Kf(e,n)),i&&-1==s&&(this.Cc(n,n),this.Dc(n,n)),this.Wj(e,this.Ka(e)+1),e=this.Rf(e),this.Uj(e,this.I(e)+1),n},t.prototype.mE=function(t,i,r){var s=this.Va(i),n=this.Va(r);if(0>s||n>this.gd-1)throw e.i.O("invalid call");if(s>n&&!this.ec(t))throw e.i.O("cannot iterate across an open path");for(t=0;i!=r;i=this.V(i))s=this.Va(i),null!=(n=this.Th(s))?t+=n.Rb():(n=this.Va(this.V(i)),t+=this.wb.Ar(s,n));return t},t.prototype.Eh=function(e,t){var i=this.Va(e);this.wb.Ht(i,t),null!=(i=this.Th(i))&&i.setStart(t),-1!=(e=this.Na(e))&&(e=this.Va(e),null!=this.Th(e)&&i.setEnd(t))},t.prototype.Wi=function(e,t){e=this.Va(e),this.wb.we(e,t)},t.prototype.mf=function(e,t){this.Db(e,t.x,t.y)},t.prototype.Db=function(e,t,i){var r=this.Va(e);this.wb.Db(r,t,i),null!=(r=this.Th(r))&&r.SB(t,i),-1!=(e=this.Na(e))&&(e=this.Va(e),null!=this.Th(e)&&r.Sl(t,i))},t.prototype.D=function(e,t){this.wb.D(this.ud.U(e,0),t)},t.prototype.Hc=function(e,t){this.wb.Aa[0].uc(2*this.ud.U(e,0),t)},t.prototype.Oa=function(t){var i=new e.h;return this.wb.D(this.ud.U(t,0),i),i},t.prototype.WF=function(e,t){this.it.uc(2*e,t)},t.prototype.Vc=function(e,t,i){return this.wb.Vc(e,this.Va(t),i)},t.prototype.setAttribute=function(e,t,i,r){this.wb.setAttribute(e,this.Va(t),i,r)},t.prototype.Va=function(e){return this.ud.U(e,0)},t.prototype.jh=function(){var t=new e.h;return this.D(void 0,t),t.y},t.prototype.hq=function(e,t){e=this.Va(e),t=this.Va(t);var i=this.wb.Aa[0].o;return i[2*e]===i[2*t]&&i[2*e+1]===i[2*t+1]},t.prototype.Ev=function(e,t){e=this.Va(e);var i=this.wb.Aa[0].o;return i[2*e]===t.x&&i[2*e+1]===t.y},t.prototype.jX=function(t,i){if(1>i&&(i=1),null==this.Tg){if(1==i)return;this.Tg=e.Zc.En(this.wb.I(),1)}(t=this.Va(t))>=this.Tg.size&&this.Tg.resize(t+1,1),this.Tg.write(t,i)},t.prototype.VF=function(e){return e=this.Va(e),null==this.Tg||e>=this.Tg.size?1:this.Tg.read(e)},t.prototype.Sa=function(e,t,i){t=this.ci[t],e=this.Va(e),t.size<this.wb.I()&&t.resize(this.wb.I(),-1),t.write(e,i)},t.prototype.Qa=function(e,t){return(e=this.Va(e))<(t=this.ci[t]).size?t.read(e):-1},t.prototype.Hd=function(){null==this.ci&&(this.ci=[]);for(var t=0;t<this.ci.length;t++)if(null==this.ci[t])return this.ci[t]=e.Zc.Ph(0,-1),t;return this.ci.push(e.Zc.Ph(0,-1)),this.ci.length-1},t.prototype.Ud=function(e){this.ci[e]=null},t.prototype.cc=function(e){return null!=this.Te?(e=this.Va(e),this.Te[e]):null},t.prototype.fd=function(t,i){var r=this.ud.U(t,2);if(-1==r)return!1;if(this.aA){var s=new e.Ta;this.Wi(t,s),i.setStart(s),this.Wi(r,s),i.setEnd(s)}else this.wb.Hc(this.ud.U(t,0),Q),i.gm(0,Q),this.wb.Hc(this.ud.U(r,0),Q),i.gm(1,Q);return!0},t.prototype.cW=function(t,i,r){if(this.aA){var s=new e.Ta;this.Wi(t,s),r.setStart(s),this.Wi(i,s),r.setEnd(s)}else this.wb.Hc(t,Q),r.gm(0,Q),this.wb.Hc(i,Q),r.gm(1,Q)},t.prototype.wf=function(t,i){if(-1!=i){if(t!=this.Rf(i))throw e.i.Ra();var r=this.ds(i)}else r=this.lv(t);var s=this.mU(t);return-1!=i&&this.cp(i,s),this.bp(s,i),this.cp(s,r),-1!=r?this.bp(r,s):this.$o(t,s),-1==i&&this.ap(t,s),this.Tl(t,this.ea(t)+1),s},t.prototype.fG=function(e,t,i,r){e=this.wf(e,-1);for(var s=0,n=t,o=!1;n==i&&(o=!0),this.bj(n,e),s++,(n=this.V(n))!=t;);return this.mn(e,!0),this.Wj(e,s),o&&(t=i),this.Kf(e,t),this.Xg(e,this.Na(t)),this.ep(e,!1),null!=r&&(r[0]=o),e},t.prototype.ar=function(e){var t=this.ds(e),i=this.Sb(e),r=this.Rf(e);return-1!=t?this.bp(t,i):this.$o(r,i),-1!=i?this.cp(i,t):this.ap(r,t),this.sO(e),this.Tl(r,this.ea(r)-1),this.kF(e),i},t.prototype.sO=function(e){var t=this.Ya(e);if(-1!=t){for(var i=0,r=this.Ka(e);i<r;i++){var s=t;t=this.V(t),this.Qy(s)}t=this.Rf(e),this.Uj(t,this.I(t)-this.Ka(e))}this.Wj(e,0)},t.prototype.Sb=function(e){return this.md.U(e,2)},t.prototype.ds=function(e){return this.md.U(e,1)},t.prototype.Ka=function(e){return this.md.U(e,3)},t.prototype.ec=function(e){return 0!=(1&this.Up(e))},t.prototype.mn=function(e,t){if(this.ec(e)!=t){if(0<this.Ka(e)){var i=this.Ya(e),r=this.sj(e);t?(this.Cc(r,i),this.Dc(i,r),i=this.Va(r)):(this.Cc(r,-1),this.Dc(i,-1),i=this.Va(r)),this.Yg(i,null)}this.OB(e,(1|this.Up(e))-1|(t?1:0))}},t.prototype.Rf=function(e){return this.md.U(e,7)},t.prototype.OS=function(e){return 0!=(2&this.Up(e))},t.prototype.JB=function(e,t){this.OB(e,(2|this.Up(e))-2|(t?2:0))},t.prototype.qz=function(t){if(this.TS(t))return this.Pi.get(this.rv(t));var i=new e.zb,r=this.Ya(t);if(-1==r)return 0;var s=new e.h;this.D(r,s);for(var n=0,o=0,a=this.Ka(t);o<a;o++,r=this.V(r)){var l=this.cc(r);if(null==l){if(!this.fd(r,i))continue;l=i}n+=l.Rx(s.x,s.y)}return this.ep(t,!0),this.Pi.set(this.rv(t),n),n},t.prototype.ir=function(e,t,i){t=this.Ck[t],e=this.rv(e),t.size<this.Pi.size&&t.resize(this.Pi.size,-1),t.write(e,i)},t.prototype.tj=function(e,t){return(e=this.rv(e))<(t=this.Ck[t]).size?t.read(e):-1},t.prototype.Ey=function(){null==this.Ck&&(this.Ck=[]);for(var t=0;t<this.Ck.length;t++)if(null==this.Ck[t])return this.Ck[t]=e.Zc.Ph(0),t;return this.Ck.push(e.Zc.Ph(0)),this.Ck.length-1},t.prototype.wB=function(e){this.Ck[e]=null},t.prototype.PT=function(t,i,r){if(-1==r)throw e.i.O();if(i!=r){var s=this.Sb(r),n=this.ds(r),o=this.Rf(r);-1==n?this.$o(o,s):this.bp(n,s),-1==s?this.ap(o,n):this.cp(s,n),this.Uj(o,this.I(o)-this.Ka(r)),this.Tl(o,this.ea(o)-1),n=-1==i?this.lv(t):this.ds(i),this.cp(r,n),this.bp(r,i),-1==i?this.ap(t,r):this.cp(i,r),-1==n?this.$o(t,r):this.bp(n,r),this.Uj(t,this.I(t)+this.Ka(r)),this.Tl(t,this.ea(t)+1),this.fx(r,t)}},t.prototype.jj=function(e,t){this.wb.we(this.Va(t),this.pm()),this.xj(e,-1,this.pm())},t.prototype.pd=function(t,i){var r=this.cd(t),s=this.Na(t),n=this.V(t);-1!=s&&this.Cc(s,n);var o=this.Ka(r);if(t==this.Ya(r)&&this.Kf(r,1<o?n:-1),-1!=n&&this.Dc(n,s),t==this.sj(r)&&this.Xg(r,1<o?s:-1),-1!=s&&-1!=n){s=this.Va(s);var a=this.Va(n);i?null!=(i=this.Th(s))&&(s=new e.h,this.wb.D(a,s),i.Rc(s)):(a=this.Va(t),i=this.Th(a),this.Yg(s,i),null!=i&&(s=this.wb.Oa(s),i.Ec(s)))}return this.Wj(r,o-1),r=this.Rf(r),this.Uj(r,this.I(r)-1),this.Qy(t),n},t.prototype.Ya=function(e){return this.md.U(e,4)},t.prototype.sj=function(e){return this.md.U(e,5)},t.prototype.V=function(e){return this.ud.U(e,2)},t.prototype.Na=function(e){return this.ud.U(e,1)},t.prototype.cd=function(e){return this.ud.U(e,3)},t.prototype.hc=function(e,t){return this.xj(e,-1,t)},t.prototype.$q=function(t){if(void 0===t)return this.$q(!1);if(t instanceof r)return new r(t);var i,s=-1,n=-1,o=-1,a=0,l=!1;for(i=this.ld;-1!=i;i=this.ve(i))if(!t||e.ba.Ic(this.jc(i))){for(s=this.Ob(i);-1!=s;s=this.Sb(s))if(o=n=this.Ya(s),a=0,-1!=n){l=!0;break}if(l)break}return r.sP(this,i,s,n,o,a,t)},t.prototype.Pc=function(e){if(this.Kl.Pc(e),null!=this.Te)for(var t=0,i=this.Te.length;t<i;t++)null!=this.Te[t]&&this.Te[t].Pc(e)},t.prototype.lr=function(e,t,i,r){r?this.BX(e,t,i):this.AX(e,t,i)},t.prototype.Dc=function(e,t){this.ud.T(e,1,t)},t.prototype.Cc=function(e,t){this.ud.T(e,2,t)},t.prototype.bj=function(e,t){this.ud.T(e,3,t)},t.prototype.Wj=function(e,t){this.md.T(e,3,t)},t.prototype.Kf=function(e,t){this.md.T(e,4,t)},t.prototype.Xg=function(e,t){this.md.T(e,5,t)},t.prototype.Tl=function(e,t){this.dd.T(e,6,t)},t.prototype.Uj=function(e,t){this.dd.T(e,5,t)},t.prototype.hJ=function(e){var t=e;do{var i=this.V(t);this.Cc(t,this.Na(t)),this.Dc(t,i),t=i}while(t!=e)},t.prototype.VB=function(e){this.gd=e},t.prototype.br=function(e){var t=this.ds(e),i=this.Sb(e),r=this.Rf(e);-1!=t?this.bp(t,i):this.$o(r,i),-1!=i?this.cp(i,t):this.ap(r,t),this.Kf(e,-1),this.Xg(e,-1),this.kF(e)},t.prototype.ni=function(t,i){var r=this.Na(t),s=this.V(t);if(-1!=r&&this.Cc(r,s),-1!=s&&this.Dc(s,r),-1!=r&&-1!=s)if(r=this.Va(r),s=this.Va(s),i){if(null!=(i=this.Th(r))){var n=new e.h;this.wb.D(s,n),i.Rc(n)}}else i=this.Va(t),i=this.Th(i),this.Yg(r,i),null!=i&&(n=new e.h,this.wb.D(r,n),i.Ec(n));this.Qy(t)},t.prototype.TS=function(e){return 0!=(4&this.Up(e))},t.prototype.ep=function(e,t){this.OB(e,(4|this.Up(e))-4|(t?4:0))},t.prototype.mx=function(e,t){var i=this.ud.o;this.wb.rc();var r=this.wb.Aa[0].o;e.Wd(0,t,(function(e,t){var s=i[5*e];e=i[5*t],t=r[2*s],s=r[2*s+1];var n=r[2*e];return s<(e=r[2*e+1])?-1:s>e?1:t<n?-1:t>n?1:0}))},t.prototype.aS=function(){for(var t=this.ld;-1!=t;t=this.ve(t))if(!e.ba.Ic(this.jc(t)))return!0;return!1},t.prototype.aC=function(e,t){for(var i=this.Ob(e),r=this.Ob(t),s=this.lv(e),n=this.lv(t),o=this.Ob(e);-1!=o;o=this.Sb(o))this.fx(o,t);for(o=this.Ob(t);-1!=o;o=this.Sb(o))this.fx(o,e);this.$o(e,r),this.$o(t,i),this.ap(e,n),this.ap(t,s),i=this.I(e),r=this.ea(e),s=this.ea(t),this.Uj(e,this.I(t)),this.Uj(t,i),this.Tl(e,s),this.Tl(t,r),i=this.dd.U(e,2),this.dd.T(e,2,this.dd.U(t,2)),this.dd.T(t,2,i)},t}(),e.hd=t}($||($={})),function(e){var t=function(t){function i(i,r,s,n){var o=t.call(this)||this;return o.aa=new e.l,void 0===i?o.ME():"number"==typeof i?o.NO(i,r,s,n):i instanceof e.Ta?void 0!==r?o.Su(i,r,s):o.OO(i):i instanceof e.ua?void 0!==r?o.QO(i,r):o.PO(i):i instanceof e.l?o.MO(i):o.ME(),o}return Z(i,t),i.prototype.Su=function(t,i,r){this.description=e.ee.og(),this.aa.Pa(),t.B()||this.uu(t,i,r)},i.prototype.MO=function(t){this.description=e.ee.og(),this.aa.L(t),this.aa.normalize()},i.prototype.PO=function(t){if(null==t)throw e.i.O();this.description=t,this.aa.Pa()},i.prototype.QO=function(t,i){if(null==t)throw e.i.O();this.description=t,this.aa.L(i),this.aa.normalize()},i.prototype.ME=function(){this.description=e.ee.og(),this.aa.Pa()},i.prototype.OO=function(t){this.description=e.ee.og(),this.aa.Pa(),t.B()||this.uu(t)},i.prototype.NO=function(t,i,r,s){this.description=e.ee.og(),this.L(t,i,r,s)},i.prototype.L=function(e,t,i,r){if(this.wc(),"number"==typeof e)this.aa.L(e,t,i,r);else for(this.Pa(),t=0,i=e.length;t<i;t++)this.$b(e[t])},i.prototype.Yo=function(t){if(this.wc(),!t.WS())throw e.i.O();this.aa.L(t)},i.prototype.Pa=function(){this.wc(),this.aa.Pa()},i.prototype.B=function(){return this.aa.B()},i.prototype.S=function(){return this.aa.S()},i.prototype.da=function(){return this.aa.da()},i.prototype.gk=function(){return this.aa.gk()},i.prototype.Lp=function(){return this.aa.Lp()},i.prototype.Kp=function(){return this.aa.tf()},i.prototype.$b=function(t){if(t instanceof e.h)this.wc(),this.aa.$b(t);else if(t instanceof e.l)this.wc(),this.aa.$b(t);else if(t instanceof e.Ta){if(this.wc(),!t.Bc()){var r=t.description;if(this.description!=r&&this.Ll(r),this.B())this.uu(t);else{this.aa.$b(t.D());for(var s=1,n=r.Ba;s<n;s++)for(var o=r.Fd(s),a=e.ua.Wa(o),l=0;l<a;l++){var h=t.Vc(o,l),c=this.Ug(o,l);c.$b(h),this.setInterval(o,l,c)}}}}else if(t instanceof i&&!t.B())for((r=t.description)!=this.description&&this.Ll(r),this.aa.$b(t.aa),s=1,n=r.Ba;s<n;s++)for(o=r.qd(s),a=e.ua.Wa(o),l=0;l<a;l++)h=t.Ug(o,l),(c=this.Ug(o,l)).$b(h),this.setInterval(o,l,c)},i.prototype.uu=function(t,i,r){if(void 0!==i){this.aa.L(t.D(),i,r),r=1;for(var s=(i=t.description).Ba;r<s;r++)for(var n=i.Fd(r),o=e.ua.Wa(n),a=0;a<o;a++){var l=t.Vc(n,a);this.setInterval(n,a,l,l)}}else for(this.aa.L(t.la[0],t.la[1]),r=1,s=(i=t.description).Ba;r<s;r++)for(n=i.Fd(r),o=e.ua.Wa(n),a=0;a<o;a++)l=t.Vc(n,a),this.setInterval(n,a,l,l)},i.prototype.setInterval=function(t,i,r,s){if(r="number"==typeof r?new e.Oc(r,s):r,this.wc(),0==t)if(0==i)this.aa.v=r.pa,this.aa.C=r.wa;else{if(1!=i)throw e.i.re();this.aa.G=r.pa,this.aa.H=r.wa}else this.nD(0,t,i,r.pa),this.nD(1,t,i,r.wa)},i.prototype.X=function(e,t){this.wc(),this.aa.X(e,t)},i.prototype.Pc=function(t){if(t instanceof e.Ed)this.wc(),t.fC(this.aa);else if(this.wc(),!this.aa.B()){var i=new e.GK;this.Ro(i),i.NS()?i.Pa():t.fC(i)}},i.prototype.copyTo=function(t){if(t.K()!=this.K())throw e.i.O();if(t.wc(),t.description=this.description,t.aa.L(this.aa),t.la=null,null!=this.la){t.pu();for(var i=0;i<2*(this.description.Be.length-2);i++)t.la[i]=this.la[i]}},i.prototype.Ja=function(){return new i(this.description)},i.prototype.He=function(){return this.aa.oF()},i.prototype.Rb=function(){return this.aa.qR()},i.prototype.K=function(){return 197},i.prototype.Eb=function(){return 2},i.prototype.dn=function(e){this.copyTo(e)},i.prototype.A=function(e){e.v=this.aa.v,e.G=this.aa.G,e.C=this.aa.C,e.H=this.aa.H},i.prototype.Ro=function(e){e.v=this.aa.v,e.G=this.aa.G,e.C=this.aa.C,e.H=this.aa.H,e.L(this.aa.v,this.aa.G,this.Pd(0,1,0),this.aa.C,this.aa.H,this.Pd(1,1,0))},i.prototype.Ug=function(t,i){var r=new e.Oc;return r.L(this.Pd(0,t,i),this.Pd(1,t,i)),r},i.prototype.If=function(t,i){i.kg(this.description);var r=this.description.Ba-1;switch(t){case 0:for(t=0;t<r;t++)for(var s=this.description.qd(t),n=e.ua.Wa(s),o=0;o<n;o++)i.setAttribute(s,o,this.Pd(0,s,o));i.Db(this.aa.v,this.aa.G);break;case 1:for(t=0;t<r;t++)for(s=this.description.qd(t),n=e.ua.Wa(s),o=0;o<n;o++)i.setAttribute(s,o,this.Pd(1,s,o));i.Db(this.aa.v,this.aa.H);break;case 2:for(t=0;t<r;t++)for(s=this.description.qd(t),n=e.ua.Wa(s),o=0;o<n;o++)i.setAttribute(s,o,this.Pd(0,s,o));i.Db(this.aa.C,this.aa.H);break;case 3:for(t=0;t<r;t++)for(s=this.description.qd(t),n=e.ua.Wa(s),o=0;o<n;o++)i.setAttribute(s,o,this.Pd(1,s,o));i.Db(this.aa.C,this.aa.G);break;default:throw e.i.re()}},i.prototype.gB=function(e,t){e=this.aa.gB(e),t.na(e.x,e.y)},i.prototype.cR=function(e,t){return t*(e.Qq-2)},i.prototype.pF=function(t,i,r){if(this.aa.B())throw e.i.ga("empty geometry");if(0==i)return 0!=t?0!=r?this.aa.H:this.aa.C:0!=r?this.aa.G:this.aa.v;if(r>=e.ua.Wa(i))throw e.i.O();var s=this.description.Qf(i);return this.pu(),0<=s?this.la[this.cR(this.description,t)+this.description.CR(s)-2+r]:e.ua.te(i)},i.prototype.pu=function(){if(this.wc(),null==this.la&&2<this.description.Be.length){this.la=[];for(var t=i.Ig(this.description,0),r=i.Ig(this.description,1),s=0,n=1,o=this.description.Ba;n<o;n++){var a=this.description.qd(n),l=e.ua.Wa(a);a=e.ua.te(a);for(var h=0;h<l;h++)this.la[t+s]=a,this.la[r+s]=a,s++}}},i.prototype.un=function(t){if(null!=this.la)if(2<t.Be.length){for(var r=e.ee.Jw(t,this.description),s=[],n=i.Ig(this.description,0),o=i.Ig(this.description,1),a=i.Ig(t,0),l=i.Ig(t,1),h=0,c=1,u=t.Ba;c<u;c++){var p=t.qd(c),d=e.ua.Wa(p);if(-1==r[c]){var f=e.ua.te(p);for(p=0;p<d;p++)s[a+h]=f,s[l+h]=f,h++}else for(f=this.description.$j(r[c])-2,p=0;p<d;p++)s[a+h]=this.la[n+f],s[l+h]=this.la[o+f],h++,f++}this.la=s}else this.la=null;this.description=t},i.prototype.Pd=function(t,r,s){if(this.aa.B())throw e.i.ga("This operation was performed on an Empty Geometry.");if(0==r)return 0!=t?0!=s?this.aa.H:this.aa.C:0!=s?this.aa.G:this.aa.v;if(s>=e.ua.Wa(r))throw e.i.re();var n=this.description.Qf(r);return 0<=n?(this.pu(),this.la[i.Ig(this.description,t)+this.description.$j(n)-2+s]):e.ua.te(r)},i.prototype.nD=function(t,r,s,n){if(this.wc(),0==r)0!=t?0!=s?this.aa.H=n:this.aa.C=n:0!=s?this.aa.G=n:this.aa.v=n;else{if(s>=e.ua.Wa(r))throw e.i.re();if(!this.hasAttribute(r)){if(e.ua.vG(r,n))return;this.se(r)}r=this.description.Qf(r),this.pu(),this.la[i.Ig(this.description,t)+this.description.$j(r)-2+s]=n}},i.Ig=function(e,t){return t*(e.Be.length-2)},i.prototype.Fa=function(t){this.wc();var i=new e.l;return t.A(i),this.aa.Fa(i)},i.prototype.isIntersecting=function(t){return t instanceof e.l?this.aa.isIntersecting(t):this.aa.isIntersecting(t.aa)},i.prototype.Ku=function(e,t){this.wc(),e.B()?this.Pa():void 0!==t?this.uu(e,t,void 0):this.aa.Ku(e.Mg(),e.jh())},i.prototype.offset=function(e,t){this.wc(),this.aa.offset(e,t)},i.prototype.normalize=function(){this.wc(),this.aa.normalize()},i.prototype.tf=function(t){if(void 0===t){if(t=new e.Ta(this.description),this.B())return t;for(i=this.description.Ba,r=1;r<i;r++)for(s=this.description.Fd(r),n=e.ua.Wa(s),o=0;o<n;o++)a=.5*(this.Pd(0,s,o)+this.Pd(1,s,o)),t.setAttribute(s,o,a);return t.Db(this.aa.gk(),this.aa.Lp()),t}if(t.kg(this.description),this.B())t.Pa();else{for(var i=this.description.Ba,r=1;r<i;r++)for(var s=this.description.qd(r),n=e.ua.Wa(s),o=0;o<n;o++){var a=.5*(this.pF(0,s,o)+this.pF(1,s,o));t.setAttribute(s,o,a)}t.Db(this.aa.tf())}},i.prototype.hz=function(){return new e.Ta(this.aa.hz())},i.prototype.contains=function(t){return t instanceof e.Ta?!t.B()&&this.aa.contains(t.Mg(),t.jh()):this.aa.contains(t.aa)},i.prototype.WO=function(e){return this.aa.contains(e)},i.prototype.Nb=function(e){if(e==this)return!0;if(!(e instanceof i)||this.description!=e.description)return!1;if(this.B())return!!e.B();if(!this.aa.Nb(e.aa))return!1;for(var t=0,r=2*(this.description.Be.length-2);t<r;t++)if(this.la[t]!=e.la[t])return!1;return!0},i.prototype.dc=function(){var t=this.description.dc();if(t=e.P.Uh(t,this.aa.dc()),!this.B()&&null!=this.la)for(var i=0,r=2*(this.description.Be.length-2);i<r;i++)t=e.P.Uh(t,this.la[i]);return t},i.prototype.fs=function(){return this.aa.v},i.prototype.hs=function(){return this.aa.G},i.prototype.es=function(){return this.aa.C},i.prototype.gs=function(){return this.aa.H},i.prototype.mg=function(){return e.ri.im(this,null)},i.prototype.toString=function(){return this.B()?"Envelope: []":"Envelope: ["+this.aa.v+", "+this.aa.G+", "+this.aa.C+", "+this.aa.H+"]"},i}(e.ba);e.Gh=t}($||($={})),function(e){var t=function(){function t(e,t,i,r){void 0===e?this.Pa():(this.v=e,this.G=t,this.C=i,this.H=r)}return t.construct=function(e,i,r,s){var n=new t;return n.v=e,n.G=i,n.C=r,n.H=s,n},t.prototype.L=function(i,r,s,n){"number"==typeof i?void 0!==s?(this.v=i,this.G=r,this.C=s,this.H=n,this.normalize()):(this.v=i,this.G=r,this.C=i,this.H=r):i instanceof e.h?void 0!==r?(this.v=i.x-.5*r,this.C=this.v+r,this.G=i.y-.5*s,this.H=this.G+s,this.normalize()):(this.v=i.x,this.G=i.y,this.C=i.x,this.H=i.y):i instanceof t?this.L(i.v,i.G,i.C,i.H):i instanceof e.Oc&&(i.B()||r.B()?this.Pa():(this.v=i.pa,this.C=i.wa,this.G=r.pa,this.H=r.wa))},t.prototype.ax=function(e,t){if(void 0!==t)if(0==t)this.Pa();else{this.v=e[0].x,this.G=e[0].y,this.C=this.v,this.H=this.G;for(var i=1;i<t;i++){var r=e[i];r.x<this.v?this.v=r.x:r.x>this.C&&(this.C=r.x),r.y<this.G?this.G=r.y:r.y>this.H&&(this.H=r.y)}}else if(null==e||0==e.length)this.Pa();else for(r=e[0],this.L(r.x,r.y),i=1;i<e.length;i++)t=e[i],this.Lk(t.x,t.y)},t.prototype.Pa=function(){this.H=this.C=this.G=this.v=NaN},t.prototype.B=function(){return isNaN(this.v)},t.prototype.$b=function(i,r){"number"==typeof i?this.B()?(this.v=i,this.G=r,this.C=i,this.H=r):(this.v>i?this.v=i:this.C<i&&(this.C=i),this.G>r?this.G=r:this.H<r&&(this.H=r)):i instanceof e.h||i instanceof e.Od?this.$b(i.x,i.y):i instanceof t&&!i.B()&&(this.$b(i.v,i.G),this.$b(i.C,i.H))},t.prototype.Lk=function(e,t){this.v>e?this.v=e:this.C<e&&(this.C=e),this.G>t?this.G=t:this.H<t&&(this.H=t)},t.prototype.X=function(e,t){this.B()||(this.v-=e,this.C+=e,this.G-=t,this.H+=t,(this.v>this.C||this.G>this.H)&&this.Pa())},t.prototype.scale=function(e){0>e&&this.Pa(),this.B()||(this.v*=e,this.C*=e,this.G*=e,this.H*=e)},t.prototype.zoom=function(e,t){this.B()||this.L(this.tf(),e*this.S(),t*this.da())},t.prototype.isIntersecting=function(e){return!this.B()&&!e.B()&&(this.v<=e.v?this.C>=e.v:e.C>=this.v)&&(this.G<=e.G?this.H>=e.G:e.H>=this.G)},t.prototype.zG=function(e){return(this.v<=e.v?this.C>=e.v:e.C>=this.v)&&(this.G<=e.G?this.H>=e.G:e.H>=this.G)},t.prototype.Fa=function(e){return!this.B()&&!e.B()&&(e.v>this.v&&(this.v=e.v),e.C<this.C&&(this.C=e.C),e.G>this.G&&(this.G=e.G),e.H<this.H&&(this.H=e.H),(e=this.v<=this.C&&this.G<=this.H)||this.Pa(),e)},t.prototype.gB=function(t){switch(t){case 0:return e.h.construct(this.v,this.G);case 1:return e.h.construct(this.v,this.H);case 2:return e.h.construct(this.C,this.H);case 3:return e.h.construct(this.C,this.G);default:throw e.i.re()}},t.prototype.hB=function(t){if(null==t||4>t.length)throw e.i.O();null!=t[0]?t[0].na(this.v,this.G):t[0]=e.h.construct(this.v,this.G),null!=t[1]?t[1].na(this.v,this.H):t[1]=e.h.construct(this.v,this.H),null!=t[2]?t[2].na(this.C,this.H):t[2]=e.h.construct(this.C,this.H),null!=t[3]?t[3].na(this.C,this.G):t[3]=e.h.construct(this.C,this.G)},t.prototype.oF=function(){return this.B()?0:this.S()*this.da()},t.prototype.qR=function(){return this.B()?0:2*(this.S()+this.da())},t.prototype.gk=function(){return(this.C+this.v)/2},t.prototype.Lp=function(){return(this.H+this.G)/2},t.prototype.S=function(){return this.C-this.v},t.prototype.da=function(){return this.H-this.G},t.prototype.move=function(e,t){this.B()||(this.v+=e,this.G+=t,this.C+=e,this.H+=t)},t.prototype.Ku=function(t,i){if(void 0!==i)this.move(t-this.gk(),i-this.Lp());else if(t instanceof e.h)this.Ku(t.x,t.y);else{if(!(t instanceof e.Ta))throw e.i.O();i=(this.C-this.v)/2;var r=(this.H-this.G)/2;this.v=t.Mg()-i,this.C=t.Mg()+i,this.G=t.jh()-r,this.H=t.jh()+r}},t.prototype.offset=function(e,t){this.v+=e,this.C+=e,this.G+=t,this.H+=t},t.prototype.normalize=function(){if(!this.B()){var e=Math.min(this.v,this.C),t=Math.max(this.v,this.C);this.v=e,this.C=t,e=Math.min(this.G,this.H),t=Math.max(this.G,this.H),this.G=e,this.H=t}},t.prototype.fn=function(e){e.na(this.v,this.G)},t.prototype.SI=function(e){e.na(this.C,this.G)},t.prototype.VI=function(e){e.na(this.v,this.H)},t.prototype.gn=function(e){e.na(this.C,this.H)},t.prototype.WS=function(){return this.B()||this.v<=this.C&&this.G<=this.H},t.prototype.tf=function(){return e.h.construct((this.C+this.v)/2,(this.H+this.G)/2)},t.prototype.hz=function(){return e.h.construct(this.v,this.G)},t.prototype.contains=function(i,r){if(void 0!==r)return i>=this.v&&i<=this.C&&r>=this.G&&r<=this.H;if(i instanceof e.Ta)return this.contains(i.Mg(),i.jh());if(i instanceof e.h)return this.contains(i.x,i.y);if(i instanceof t)return i.v>=this.v&&i.C<=this.C&&i.G>=this.G&&i.H<=this.H;throw e.i.O()},t.prototype.jm=function(i,r){if(void 0!==r)return i>this.v&&i<this.C&&r>this.G&&r<this.H;if(i instanceof e.h)return this.jm(i.x,i.y);if(i instanceof t)return i.v>this.v&&i.C<this.C&&i.G>this.G&&i.H<this.H;throw e.i.O()},t.prototype.Nb=function(e){return e==this||e instanceof t&&(!(!this.B()||!e.B())||this.v==e.v&&this.G==e.G&&this.C==e.C&&this.H==e.H)},t.prototype.dc=function(){var t=this.v;t=e.P.truncate(t^t>>>32);var i=e.P.Uh(t);return t=this.C,t=e.P.truncate(t^t>>>32),i=e.P.Uh(t,i),t=this.G,t=e.P.truncate(t^t>>>32),i=e.P.Uh(t,i),t=this.H,t=e.P.truncate(t^t>>>32),e.P.Uh(t,i)},t.prototype.zr=function(){return this.B()?2220446049250313e-29:2220446049250313e-29*(Math.abs(this.v)+Math.abs(this.C)+Math.abs(this.G)+Math.abs(this.H)+1)},t.prototype.ty=function(e,i){var r=this.Zj(e),s=this.Zj(i);if(0!=(r&s))return 0;if(0==(r|s))return 4;var n=(0!=r?1:0)|(0!=s?2:0);do{var o=i.x-e.x,a=i.y-e.y;if(o>a?0!=(r&t.QC)?(0!=(r&t.ku)?(e.y+=a*(this.v-e.x)/o,e.x=this.v):(e.y+=a*(this.C-e.x)/o,e.x=this.C),r=this.Zj(e)):0!=(s&t.QC)?(0!=(s&t.ku)?(i.y+=a*(this.v-i.x)/o,i.x=this.v):(i.y+=a*(this.C-i.x)/o,i.x=this.C),s=this.Zj(i)):0!=r?(0!=(r&t.lu)?(e.x+=o*(this.G-e.y)/a,e.y=this.G):(e.x+=o*(this.H-e.y)/a,e.y=this.H),r=this.Zj(e)):(0!=(s&t.lu)?(i.x+=o*(this.G-i.y)/a,i.y=this.G):(i.x+=o*(this.H-i.y)/a,i.y=this.H),s=this.Zj(i)):0!=(r&t.RC)?(0!=(r&t.lu)?(e.x+=o*(this.G-e.y)/a,e.y=this.G):(e.x+=o*(this.H-e.y)/a,e.y=this.H),r=this.Zj(e)):0!=(s&t.RC)?(0!=(s&t.lu)?(i.x+=o*(this.G-i.y)/a,i.y=this.G):(i.x+=o*(this.H-i.y)/a,i.y=this.H),s=this.Zj(i)):0!=r?(0!=(r&t.ku)?(e.y+=a*(this.v-e.x)/o,e.x=this.v):(e.y+=a*(this.C-e.x)/o,e.x=this.C),r=this.Zj(e)):(0!=(s&t.ku)?(i.y+=a*(this.v-i.x)/o,i.x=this.v):(i.y+=a*(this.C-i.x)/o,i.x=this.C),s=this.Zj(i)),0!=(r&s))return 0}while(0!=(r|s));return n},t.prototype.Zj=function(e){return(e.x<this.v?1:0)|(e.x>this.C?1:0)<<1|(e.y<this.G?1:0)<<2|(e.y>this.H?1:0)<<3},t.prototype.Ci=function(e){return!this.B()&&(this.S()<=e||this.da()<=e)},t.prototype.ub=function(t){return t instanceof e.h?Math.sqrt(this.aK(t)):Math.sqrt(this.ox(t))},t.prototype.ox=function(e){var t=0,i=0,r=this.v-e.C;return r>t&&(t=r),(r=this.G-e.H)>i&&(i=r),(r=e.v-this.C)>t&&(t=r),(r=e.G-this.H)>i&&(i=r),t*t+i*i},t.prototype.aK=function(e){var t=0,i=0,r=this.v-e.x;return r>t&&(t=r),(r=this.G-e.y)>i&&(i=r),(r=e.x-this.C)>t&&(t=r),(r=e.y-this.H)>i&&(i=r),t*t+i*i},t.prototype.en=function(e){this.B()?e.Pa():e.L(this.v,this.C)},t.ku=1,t.lu=4,t.QC=3,t.RC=12,t}();e.l=t}($||($={})),function(e){var t,i;(i=t||(t={}))[i.initialize=0]="initialize",i[i.initializeRed=1]="initializeRed",i[i.initializeBlue=2]="initializeBlue",i[i.initializeRedBlue=3]="initializeRedBlue",i[i.sweep=4]="sweep",i[i.sweepBruteForce=5]="sweepBruteForce",i[i.sweepRedBlueBruteForce=6]="sweepRedBlueBruteForce",i[i.sweepRedBlue=7]="sweepRedBlue",i[i.sweepRed=8]="sweepRed",i[i.sweepBlue=9]="sweepBlue",i[i.iterate=10]="iterate",i[i.iterateRed=11]="iterateRed",i[i.iterateBlue=12]="iterateBlue",i[i.iterateBruteForce=13]="iterateBruteForce",i[i.iterateRedBlueBruteForce=14]="iterateRedBlueBruteForce",i[i.resetRed=15]="resetRed",i[i.resetBlue=16]="resetBlue";var r=function(){function e(e,t){this.di=e,this.WG=t}return e.prototype.qr=function(e,t,i){this.di.xX(i,e,t,this.WG)},e.prototype.bq=function(e){return this.di.Sr(e,this.WG)},e}();t=function(){function t(){this.pw=this.po=this.ff=this.sd=null,this.yq=new e.l,this.Cm=this.Ij=this.Jj=this.Bd=this.Ff=this.Md=this.dw=this.ho=this.rd=this.Fb=null,this.Yb=-1,this.ra=0,this.Nk()}return t.prototype.mr=function(){this.Nk(),this.Qv=!0,null==this.Fb?(this.ho=new e.ja(0),this.Fb=[]):(this.ho.Ch(0),this.Fb.length=0)},t.prototype.bd=function(t,i){if(!this.Qv)throw e.i.Hb();var r=new e.l;r.L(i),this.ho.add(t),this.Fb.push(r)},t.prototype.Hp=function(){if(!this.Qv)throw e.i.Hb();this.Qv=!1,null!=this.Fb&&0<this.Fb.length&&(this.Yb=0,this.Jc=!1)},t.prototype.hK=function(){this.Nk(),this.Pv=!0,null==this.Fb?(this.ho=new e.ja(0),this.Fb=[]):(this.ho.Ch(0),this.Fb.length=0)},t.prototype.AD=function(t,i){if(!this.Pv)throw e.i.Hb();var r=new e.l;r.L(i),this.ho.add(t),this.Fb.push(r)},t.prototype.aF=function(){if(!this.Pv)throw e.i.Hb();this.Pv=!1,null!=this.Fb&&0<this.Fb.length&&null!=this.rd&&0<this.rd.length&&(-1==this.Yb||2==this.Yb?this.Yb=3:3!=this.Yb&&(this.Yb=1),this.Jc=!1)},t.prototype.gK=function(){this.Nk(),this.Ov=!0,null==this.rd?(this.dw=new e.ja(0),this.rd=[]):(this.dw.Ch(0),this.rd.length=0)},t.prototype.wD=function(t,i){if(!this.Ov)throw e.i.Hb();var r=new e.l;r.L(i),this.dw.add(t),this.rd.push(r)},t.prototype.$E=function(){if(!this.Ov)throw e.i.Hb();this.Ov=!1,null!=this.Fb&&0<this.Fb.length&&null!=this.rd&&0<this.rd.length&&(-1==this.Yb||1==this.Yb?this.Yb=3:3!=this.Yb&&(this.Yb=2),this.Jc=!1)},t.prototype.next=function(){if(this.Jc)return!1;for(var t=!0;t;)switch(this.Yb){case 0:t=this.Bz();break;case 1:t=this.iS();break;case 2:t=this.fS();break;case 3:t=this.hS();break;case 4:t=this.IX();break;case 5:t=this.EX();break;case 6:t=this.FX();break;case 7:t=this.GX();break;case 8:t=this.sx();break;case 9:t=this.bC();break;case 10:t=this.Pz();break;case 11:t=this.$S();break;case 12:t=this.XS();break;case 13:t=this.YS();break;case 14:t=this.ZS();break;case 15:t=this.cJ();break;case 16:t=this.bJ();break;default:throw e.i.Ra()}return!this.Jc},t.prototype.UB=function(e){this.ra=e},t.prototype.oz=function(e){return this.Fb[e]},t.prototype.Wy=function(e){return this.rd[e]},t.prototype.pl=function(e){return this.ho.read(e)},t.prototype.jl=function(e){return this.dw.read(e)},t.Oz=function(e){return 1==(1&e)},t.gq=function(e){return 0==(1&e)},t.prototype.Nk=function(){this.Qv=this.Ov=this.Pv=!1,this.Df=this.Ef=this.Sg=this.pe=-1,this.Jc=!0},t.prototype.Bz=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length)return this.pe=this.Fb.length,this.Yb=5,!0;null==this.sd&&(this.sd=new e.ur(!0),this.po=this.sd.getIterator(),this.Md=new e.ja(0)),this.sd.mr();for(var t=0;t<this.Fb.length;t++){var i=this.Fb[t];this.sd.Dr(i.v,i.C)}for(this.sd.Hp(),this.Md.Jb(2*this.Fb.length),this.Md.resize(0),t=0;t<2*this.Fb.length;t++)this.Md.add(t);return this.Lt(this.Md,2*this.Fb.length,!0),this.pe=2*this.Fb.length,this.Yb=4,!0},t.prototype.iS=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length||10>this.rd.length)return this.pe=this.Fb.length,this.Yb=6,!0;null==this.sd&&(this.sd=new e.ur(!0),this.po=this.sd.getIterator(),this.Md=new e.ja(0)),this.sd.mr();for(var t=0;t<this.Fb.length;t++){var i=this.Fb[t];this.sd.Dr(i.v,i.C)}for(this.sd.Hp(),this.Md.Jb(2*this.Fb.length),this.Md.resize(0),t=0;t<2*this.Fb.length;t++)this.Md.add(t);return this.Lt(this.Md,this.Md.size,!0),this.pe=this.Md.size,-1!=this.Ef&&(this.Bd.dh(this.Ef),this.Jj.resize(0),this.Ef=-1),this.Yb=7,this.bJ()},t.prototype.fS=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length||10>this.rd.length)return this.pe=this.Fb.length,this.Yb=6,!0;null==this.ff&&(this.ff=new e.ur(!0),this.pw=this.ff.getIterator(),this.Ff=new e.ja(0)),this.ff.mr();for(var t=0;t<this.rd.length;t++){var i=this.rd[t];this.ff.Dr(i.v,i.C)}for(this.ff.Hp(),this.Ff.Jb(2*this.rd.length),this.Ff.resize(0),t=0;t<2*this.rd.length;t++)this.Ff.add(t);return this.Lt(this.Ff,this.Ff.size,!1),this.Sg=this.Ff.size,-1!=this.Df&&(this.Bd.dh(this.Df),this.Ij.resize(0),this.Df=-1),this.Yb=7,this.cJ()},t.prototype.hS=function(){if(this.Bf=this.Wf=-1,10>this.Fb.length||10>this.rd.length)return this.pe=this.Fb.length,this.Yb=6,!0;null==this.sd&&(this.sd=new e.ur(!0),this.po=this.sd.getIterator(),this.Md=new e.ja(0)),null==this.ff&&(this.ff=new e.ur(!0),this.pw=this.ff.getIterator(),this.Ff=new e.ja(0)),this.sd.mr();for(var t=0;t<this.Fb.length;t++){var i=this.Fb[t];this.sd.Dr(i.v,i.C)}for(this.sd.Hp(),this.ff.mr(),t=0;t<this.rd.length;t++)i=this.rd[t],this.ff.Dr(i.v,i.C);for(this.ff.Hp(),this.Md.Jb(2*this.Fb.length),this.Ff.Jb(2*this.rd.length),this.Md.resize(0),this.Ff.resize(0),t=0;t<2*this.Fb.length;t++)this.Md.add(t);for(t=0;t<2*this.rd.length;t++)this.Ff.add(t);return this.Lt(this.Md,this.Md.size,!0),this.Lt(this.Ff,this.Ff.size,!1),this.pe=this.Md.size,this.Sg=this.Ff.size,-1!=this.Ef&&(this.Bd.dh(this.Ef),this.Jj.resize(0),this.Ef=-1),-1!=this.Df&&(this.Bd.dh(this.Df),this.Ij.resize(0),this.Df=-1),this.Yb=7,!0},t.prototype.IX=function(){var e=this.Md.get(--this.pe),i=e>>1;return t.gq(e)?(this.sd.remove(i),0!=this.pe||(this.Bf=this.Wf=-1,this.Jc=!0,!1)):(this.po.yB(this.Fb[i].v,this.Fb[i].C,this.ra),this.Wf=i,this.Yb=10,!0)},t.prototype.EX=function(){return-1==--this.pe?(this.Bf=this.Wf=-1,this.Jc=!0,!1):(this.Sg=this.Wf=this.pe,this.Yb=13,!0)},t.prototype.FX=function(){return-1==--this.pe?(this.Bf=this.Wf=-1,this.Jc=!0,!1):(this.Wf=this.pe,this.Sg=this.rd.length,this.Yb=14,!0)},t.prototype.GX=function(){var e=this.Md.get(this.pe-1),i=this.Ff.get(this.Sg-1),r=this.Sr(e,!0),s=this.Sr(i,!1);return r>s?this.sx():r<s?this.bC():t.Oz(e)?this.sx():t.Oz(i)?this.bC():this.sx()},t.prototype.sx=function(){var i=this.Md.get(--this.pe),r=i>>1;if(t.gq(i))return-1!=this.Ef&&-1!=this.Jj.get(r)?(this.Bd.kd(this.Ef,this.Jj.get(r)),this.Jj.set(r,-1)):this.sd.remove(r),0!=this.pe||(this.Bf=this.Wf=-1,this.Jc=!0,!1);if(-1!=this.Df&&0<this.Bd.cs(this.Df))for(i=this.Bd.sc(this.Df);-1!=i;){var s=this.Bd.getData(i);this.ff.wj(s),this.Ij.set(s,-1),s=this.Bd.lb(i),this.Bd.kd(this.Df,i),i=s}return 0<this.ff.size()?(this.pw.yB(this.Fb[r].v,this.Fb[r].C,this.ra),this.Wf=r,this.Yb=12):(-1==this.Ef&&(null==this.Bd&&(this.Bd=new e.kp),this.Jj=new e.ja(0),this.Jj.resize(this.Fb.length,-1),this.Jj.Xj(-1,0,this.Fb.length),this.Ef=this.Bd.Qh(1)),this.Jj.set(r,this.Bd.addElement(this.Ef,r)),this.Yb=7),!0},t.prototype.bC=function(){var i=this.Ff.get(--this.Sg),r=i>>1;if(t.gq(i))return-1!=this.Df&&-1!=this.Ij.get(r)?(this.Bd.kd(this.Df,this.Ij.get(r)),this.Ij.set(r,-1)):this.ff.remove(r),0!=this.Sg||(this.Bf=this.Wf=-1,this.Jc=!0,!1);if(-1!=this.Ef&&0<this.Bd.cs(this.Ef))for(i=this.Bd.sc(this.Ef);-1!=i;){var s=this.Bd.getData(i);this.sd.wj(s),this.Jj.set(s,-1),s=this.Bd.lb(i),this.Bd.kd(this.Ef,i),i=s}return 0<this.sd.size()?(this.po.yB(this.rd[r].v,this.rd[r].C,this.ra),this.Bf=r,this.Yb=11):(-1==this.Df&&(null==this.Bd&&(this.Bd=new e.kp),this.Ij=new e.ja(0),this.Ij.resize(this.rd.length,-1),this.Ij.Xj(-1,0,this.rd.length),this.Df=this.Bd.Qh(0)),this.Ij.set(r,this.Bd.addElement(this.Df,r)),this.Yb=7),!0},t.prototype.Pz=function(){if(this.Bf=this.po.next(),-1!=this.Bf)return!1;var e=this.Md.get(this.pe)>>1;return this.sd.wj(e),this.Yb=4,!0},t.prototype.$S=function(){if(this.Wf=this.po.next(),-1!=this.Wf)return!1;this.Bf=this.Wf=-1;var e=this.Ff.get(this.Sg)>>1;return this.ff.wj(e),this.Yb=7,!0},t.prototype.XS=function(){if(this.Bf=this.pw.next(),-1!=this.Bf)return!1;var e=this.Md.get(this.pe)>>1;return this.sd.wj(e),this.Yb=7,!0},t.prototype.YS=function(){if(-1==--this.Sg)return this.Yb=5,!0;this.yq.L(this.Fb[this.pe]);var e=this.Fb[this.Sg];return this.yq.X(this.ra,this.ra),!this.yq.isIntersecting(e)||(this.Bf=this.Sg,!1)},t.prototype.ZS=function(){if(-1==--this.Sg)return this.Yb=6,!0;this.yq.L(this.Fb[this.pe]);var e=this.rd[this.Sg];return this.yq.X(this.ra,this.ra),!this.yq.isIntersecting(e)||(this.Bf=this.Sg,!1)},t.prototype.cJ=function(){return null==this.sd?(this.Jc=!0,!1):(this.pe=this.Md.size,0<this.sd.size()&&this.sd.reset(),-1!=this.Ef&&(this.Bd.dh(this.Ef),this.Jj.resize(0),this.Ef=-1),this.Jc=!1,!0)},t.prototype.bJ=function(){return null==this.ff?(this.Jc=!0,!1):(this.Sg=this.Ff.size,0<this.ff.size()&&this.ff.reset(),-1!=this.Df&&(this.Bd.dh(this.Df),this.Ij.resize(0),this.Df=-1),this.Jc=!1,!0)},t.prototype.Lt=function(t,i,s){null==this.Cm&&(this.Cm=new e.Yt),s=new r(this,s),this.Cm.sort(t,0,i,s)},t.prototype.xX=function(e,i,r,s){var n=this;e.Wd(i,r,(function(e,i){var r=n.Sr(e,s),o=n.Sr(i,s);return r<o||r==o&&t.gq(e)&&t.Oz(i)?-1:1}))},t.prototype.Sr=function(e,i){var r=.5*this.ra;return i?(i=this.Fb[e>>1],t.gq(e)?i.G-r:i.H+r):(i=this.rd[e>>1],t.gq(e)?i.G-r:i.H+r)},t}(),e.qC=t}($||($={})),function(e){var t=function(){function t(){}return t.construct=function(e,i,r,s,n,o){var a=new t;return a.v=e,a.G=i,a.Xe=r,a.C=s,a.H=n,a.Dg=o,a},t.prototype.Pa=function(){this.Xe=this.v=NaN},t.prototype.B=function(){return isNaN(this.v)},t.prototype.NS=function(){return isNaN(this.Xe)},t.prototype.L=function(e,t,i,r,s,n){void 0!==r?"number"==typeof e?(this.v=e,this.G=t,this.Xe=i,this.C=r,this.H=s,this.Dg=n):(this.v=e.x-.5*t,this.C=this.v+t,this.G=e.y-.5*i,this.H=this.G+i,this.Xe=e.z-.5*r,this.Dg=this.Xe+r):(this.v=e,this.G=t,this.Xe=i,this.C=e,this.H=t,this.Dg=i)},t.prototype.move=function(e){this.v+=e.x,this.G+=e.y,this.Xe+=e.z,this.C+=e.x,this.H+=e.y,this.Dg+=e.z},t.prototype.copyTo=function(e){e.v=this.v,e.G=this.G,e.C=this.C,e.H=this.H},t.prototype.Lk=function(e,t,i){this.v>e?this.v=e:this.C<e&&(this.C=e),this.G>t?this.G=t:this.H<t&&(this.H=t),0==isNaN(this.Xe)?this.Xe>i?this.Xe=i:this.Dg<i&&(this.Dg=i):this.Dg=this.Xe=i},t.prototype.$b=function(i,r,s){if("number"==typeof i)this.B()?(this.v=i,this.G=r,this.Xe=s,this.C=i,this.H=r,this.Dg=s):this.Lk(i,r,s);else if(i instanceof e.Od)this.$b(i.x,i.y,i.z);else{if(!(i instanceof t))throw e.i.O();i.B()||(this.$b(i.v,i.G,i.Xe),this.$b(i.C,i.H,i.Dg))}},t.prototype.construct=function(e,t,i){e.B()||t.B()?this.Pa():(this.v=e.pa,this.C=e.wa,this.G=t.pa,this.H=t.wa,this.Xe=i.pa,this.Dg=i.wa)},t.prototype.hB=function(t){if(null==t||8>t.length)throw e.i.O();t[0]=new e.Od(this.v,this.G,this.Xe),t[1]=new e.Od(this.v,this.H,this.Xe),t[2]=new e.Od(this.C,this.H,this.Xe),t[3]=new e.Od(this.C,this.G,this.Xe),t[4]=new e.Od(this.v,this.G,this.Dg),t[5]=new e.Od(this.v,this.H,this.Dg),t[6]=new e.Od(this.C,this.H,this.Dg),t[7]=new e.Od(this.C,this.G,this.Dg)},t.prototype.ax=function(e){if(null==e||0==e.length)this.Pa();else{var t=e[0];for(this.L(t.x,t.y,t.z),t=1;t<e.length;t++){var i=e[t];this.Lk(i.x,i.y,i.z)}}},t}();e.GK=t}($||($={})),function(e){var t;(t=e.i||(e.i={})).Ra=function(){var e=Error();return e.message="Internal Error",e},t.Fe=function(){var e=Error();return e.message="Not Implemented",e},t.Yk=function(){var e=Error();return e.message="The input unit and the spatial reference unit are not of the same unit type.ie Linear vs.Angular",e},t.Hb=function(){var e=Error();return e.message="Invalid Call",e},t.O=function(e){var t=Error();return t.message="Illegal Argument Exception",void 0!==e&&(t.message+=": "+e),t},t.gu=function(e){var t=Error();return t.message=void 0!==e?"Runtime Exception: "+e:"Runtime Exception.",t},t.ga=function(e){var t=Error();return t.message="Geometry Exception: "+e,t},t.yK=function(){var e=Error();return e.message="Assert Failed Exception",e},t.re=function(){var e=Error();return e.message="IndexOutOfBoundsException",e},t.OC=function(){var e=Error();return e.message="UserCancelException",e}}($||($={})),function(e){(e=e.dm||(e.dm={}))[e.forward=0]="forward",e[e.reverse=1]="reverse"}($||($={})),function(e){var t=function(){function t(e,t){this.Xa=e,this.xH=t,this.DH=-1,this.ul=!1}return t.prototype.qe=function(){},t.prototype.next=function(){if(++this.DH==this.xH.I())return null;var t=this.xH.Oa(this.DH);t.scale(this.Xa.fc);var i=new e.Ea;return this.Xa.my(t,this.ul,i),i},t.prototype.Ma=function(){return 0},t}(),i=function(){function t(t,i,r){this.Xa=t,this.sw=i,this.Yn=!1,this.eo=r,this.cw=[0],this.sk=[0],this.Oj=[0],this.Hs=[0],this.ul=!1,this.sq=new e.Ea,this.uk=[]}return t.prototype.qe=function(){},t.prototype.next=function(){if(this.Yn){this.Yn=!1,this.td.ia();var t=e.ba.ig(this.sq);return e.Hg.Mk(t,this.Xa.Cq,!0,!0,this.Xa.Vb)}if(null==this.td&&(this.td=this.sw.Ha(),this.td.ab(),null!=this.eo&&this.eo.Zk(null,0)),!this.td.Ia()){if(!this.td.ab())return null;null!=this.eo&&this.eo.Zk(null,0)}t=null,this.sk[0]=0,this.zA=this.cw[0]=0,this.ei=NaN,this.Yn=!1;for(var i=this.uk.length=0,s=new e.h,n=new e.h,o=[0];this.td.Ia()&&8>this.zA;){var a=this.td.ia();if(s.N(a.ac()),n.N(a.xc()),s.scale(this.Xa.fc),n.scale(this.Xa.fc),e.dj.Ou(s,n)?s.x=n.x:e.dj.Mu(s,n)&&(n.x=s.x),this.uk.length=0,e.dj.lF(this.Xa.Ub,this.Xa.lc,this.Xa.Ae,s,n,this.Xa.KA,this.Xa.$s,o,this.Oj,this.Hs,this.uk,this.cw),null!=this.eo&&(a=this.uk.slice(0),this.eo.iG(this.eo.ea()-1,a,a.length-1)),e.dj.Nu(s,n)?(this.sq.Pa(),this.Xa.my(s,this.ul,this.sq),this.Yn=!0):(this.sq.Pa(),this.Yn=this.ry(o[0],this.sq)),this.Yn){if(this.td.mi(),this.td.zz()){this.td.mi(),this.td.ia();break}this.td.sW();break}null==t&&(t=new e.Ea).Zk(null,0),this.FD(t),i++}if(this.cw[0]=0,0<i){for(o=this.td.xb();0<i;)this.td.mi(),s.N(this.sw.Oa(this.td.xb())),n.N(this.sw.Oa(this.td.ik())),s.scale(this.Xa.fc),n.scale(this.Xa.fc),this.ul&&(e.dj.Ou(s,n)?s.x=n.x:e.dj.Mu(s,n)&&(n.x=s.x)),this.uk.length=0,e.dj.lF(this.Xa.Ub,this.Xa.lc,this.Xa.Ae,n,s,this.Xa.KA,this.Xa.$s,null,this.Oj,this.Hs,this.uk,this.cw),this.FD(t),i--;return s.N(this.sw.Oa(this.td.xb())),s.scale(this.Xa.fc),r.Jr(this.Xa.Ub,this.Xa.lc,this.Xa.fc,this.Xa.sb,s,this.ei+1.570796326794897,this.ei+4.71238898038469,this.Xa.bo,this.ul,this.sk,t,NaN,NaN),this.td.Wb(o),this.td.ia(),i=e.ta.lj(null,t,!0),e.Hg.Mk(t,i,!0,!0,this.Xa.Vb)}return this.Yn=!1,this.td.ia(),t=e.ba.ig(this.sq),e.Hg.Mk(t,this.Xa.Cq,!0,!0,this.Xa.Vb)},t.prototype.FD=function(t){var i=this.uk[0],s=this.Oj[0]-1.570796326794897,n=this.Hs[0]+1.570796326794897;if(!isNaN(this.ei)){if(this.ei>=this.Oj[0]){var o=this.ei+1.570796326794897;s=o+3.141592653589793-(this.ei-this.Oj[0])}else s=(o=this.ei+1.570796326794897)+3.141592653589793-(6.283185307179586-(this.Oj[0]-this.ei));var a=!(this.ei>=this.Oj[0]&&3.141592653589793>=this.ei-this.Oj[0]||this.ei<this.Oj[0]&&3.141592653589793<=this.Oj[0]-this.ei),l=!1;if(Math.abs(s-o)<=.5*this.Xa.bo)if(a){var h=t.Oa(t.I()-2);h.scale(this.Xa.fc);var c=new e.ha(0);for(e.kb.Sy(this.Xa.Ub,this.Xa.lc,i.x,i.y,h.x,h.y,c),h=c.u;h<=o;)h+=6.283185307179586;for(;h>o;)h-=6.283185307179586;h<s&&(l=!0)}else l=!0;l?(t.xB(0,t.I()-1),this.ul||((i=new e.h).N(t.Oa(t.I()-1)),i.scale(this.Xa.fc),-3.141592653589793>i.x-this.sk[0]?this.sk[0]-=6.283185307179586:3.141592653589793<i.x-this.sk[0]&&(this.sk[0]+=6.283185307179586)),a||(s=.5*(s+o))):(a?((o=new e.h).N(i),o.scale(1/this.Xa.fc),t.xf(0,-1,o)):r.Jr(this.Xa.Ub,this.Xa.lc,this.Xa.fc,this.Xa.sb,this.uk[0],o,s,this.Xa.bo,this.ul,this.sk,t,NaN,NaN),this.zA+=1)}r.ly(this.Xa.Ub,this.Xa.lc,this.Xa.fc,this.Xa.sb,this.Xa.Ae,this.uk,s,n,this.ul,this.sk,t),this.ei=this.Hs[0]},t.prototype.ry=function(e,t){return this.Xa.ry(this.uk,e,this.Oj[0],this.Hs[0],this.ul,t)},t.prototype.Ma=function(){return 0},t}(),r=function(){function r(){}return r.buffer=function(t,i,s,n,o,a){if(null==t)throw e.i.O("Geometry::Geodesic_bufferer::buffer");if(t.B())return new e.Ea(t.description);var l=new r;l.Rg=i,l.Kc=e.cb.tc(i);var h=e.cb.wv(l.Kc);if(l.Vb=a,l.Ub=e.cb.fv(l.Kc),l.lc=h*(2-h),l.fc=l.Kc.Id().bi,l.ra=l.Rg.Ln(),l.Cq=l.Kc.Ln(),l.$s=l.Cq*l.fc,l.Bq=1.570796326794897/l.fc,l.DY=3.141592653589793/l.fc,l.Ks=6.283185307179586/l.fc,l.EY=l.Ks/6,l.FA=0,l.CY=1.5707963267948966*l.Ub/l.FA,4==s?(l.Ae=2,l.Xv=!0):(l.Ae=s,l.Xv=!1),l.La=n,l.sb=Math.abs(n),isNaN(o)||.001>o?l.lX():l.ao=o,s=t.K(),e.ba.zd(s)?((s=new e.Ua(t.description)).oc(t,!0),t=s,s=1607):197==s&&(s=new e.l,t.A(s),s.S()<=l.ra||s.da()<=l.ra?((s=new e.Ua(t.description)).bd(t,!1),t=s,s=1607):((s=new e.Ea(t.description)).bd(t,!1),t=s,s=1736)),l.mX(),e.ba.Sn(s)||l.nX(),l.sb<=.5*l.ao)return 1736!=s?new e.Ea(t.description):l.Xv?t:e.dj.Rr(t,l.Rg,l.Ae,l.KA,-1,a);if(0>l.La&&1736!=s)return new e.Ea(t.description);if(l.Xv&&e.ba.Ic(s)?(i=e.dj.Rr(t,i,4,NaN,l.ao,a),t=e.cb.Ah(i,l.Rg,l.Kc)):t=e.cb.Ah(t,l.Rg,l.Kc),(t=e.Ih.mj(t,l.Kc)).B())return new e.Ea(t.description);switch(!l.Xv&&e.ba.Ic(s)&&(t=e.dj.hI(l.fc,t)),t=r.yX(t,l.Kc),s){case 1736:i=l.MN(t);break;case 1607:i=l.NN(t);break;case 550:i=l.KN(t);break;case 33:i=l.LN(t);break;default:throw e.i.ga("corrupted_geometry")}return(l=e.cb.Ah(i,l.Kc,l.Rg)).Ll(t.description),l},r.prototype.MN=function(t){var r=new e.Ea;t=new i(this,t,r),t=e.Hh.local().W(t,this.Kc,this.Vb).next(),t=e.jp.oj(t,this.Kc,2);var s=new e.Ed;return s.scale(1/this.fc,1/this.fc),r.Pc(s),r=e.jp.oj(r,this.Kc,2),0<=this.La?e.Hh.local().W(r,t,this.Kc,this.Vb):e.lp.local().W(r,t,this.Kc,this.Vb)},r.prototype.NN=function(t){return t=new i(this,t,null),t=e.Hh.local().W(t,this.Kc,this.Vb).next(),e.jp.oj(t,this.Kc,2)},r.prototype.KN=function(i){return i=new t(this,i),i=e.Hh.local().W(i,this.Kc,this.Vb).next(),e.jp.oj(i,this.Kc,2)},r.prototype.LN=function(t){(t=t.D()).scale(this.fc);var i=new e.Ea;return this.my(t,!1,i),e.jp.oj(i,this.Kc,2)},r.prototype.ry=function(t,i,s,n,o,a){var l=t[0],h=t[t.length-1],c=l.y>h.y?l.y:h.y,u=e.F.q(this.Ub,this.lc,l.y<h.y?l.y:h.y);if(c=e.F.q(this.Ub,this.lc,c),.001<this.FA-(u+i+this.sb)&&.001<this.FA+(c-i-this.sb))return!1;u=(i=s-1.570796326794897)-3.141592653589793,c=i+3.141592653589793;var p=(s=n+1.570796326794897)+3.141592653589793,d=[NaN],f=[NaN],y=[NaN],g=[NaN];if(n=!1,r.WI(this.Ub,this.lc,this.sb,l,i,u,h,s,d,f),r.WI(this.Ub,this.lc,this.sb,h,p,s,l,u,y,g),(s<d[0]&&d[0]<p||s<f[0]&&f[0]<p)&&(n=!0),n||(u<y[0]&&y[0]<i||u<g[0]&&g[0]<i)&&(n=!0),!n&&o)return!1;for(var m=[],v=t.length-1;0<=v;v--)m.push(t[v]);return a.Pa(),a.Zk(null,0),v=[0],r.ly(this.Ub,this.lc,this.fc,this.sb,this.Ae,t,i,s,o,v,a),r.Jr(this.Ub,this.lc,this.fc,this.sb,h,s,p,this.bo,o,v,a,d[0],f[0]),r.ly(this.Ub,this.lc,this.fc,this.sb,this.Ae,m,p,c,o,v,a),r.Jr(this.Ub,this.lc,this.fc,this.sb,l,u,i,this.bo,o,v,a,y[0],g[0]),t=!1,o||(t=this.AE(this.fc,a)),n||t},r.prototype.my=function(e,t,i){i.Pa(),i.Zk(null,0),r.Jr(this.Ub,this.lc,this.fc,this.sb,e,-this.bo,6.283185307179586,this.bo,t,[0],i,NaN,NaN),t||this.AE(this.fc,i)},r.prototype.AE=function(e,t){var i=this.nO(e,t);return e=this.oO(e,t),i||e},r.prototype.nO=function(t,i){var r=i.I(),s=!1,n=new e.l;if(i.A(n),!e.s.$(n.H*t,1.570796326794897)&&!e.s.$(n.G*t,-1.570796326794897))return!1;var o=new e.h;for(--r;0<=r;r--)i.D(r,o),(o.y==n.H&&e.s.$(o.y*t,1.570796326794897)||o.y==n.G&&e.s.$(o.y*t,-1.570796326794897))&&(s=!0,this.GI(o,r,i));return s},r.prototype.oO=function(e,t){var i=t.Oa(0),r=t.Oa(t.I()-1);return 3.141592653589793<Math.abs(i.x-r.x)*e?(this.LV(t),!0):this.mO(t)},r.prototype.mO=function(e){return 0>e.He()&&(this.KV(e),!0)},r.prototype.GI=function(t,i,r){var s=r.I(),n=0<i?i-1:s-1;if(s=r.Oa(i<s-1?i+1:0),n=r.Oa(n),!e.s.$(s.y,t.y)&&!e.s.$(s.x,t.x)){var o=new e.h;o.na(s.x,t.y),r.Db(i,o)}e.s.$(n.y,t.y)||e.s.$(n.x,t.x)||((s=new e.h).na(n.x,t.y),r.xf(0,i,s))},r.prototype.LV=function(t){var i=new e.Ea,r=new e.Ea,s=new e.Ed,n=t.Oa(0),o=t.Oa(t.I()-1),a=new e.h;n.x>o.x?(o=this.Bq,s.gg(-this.Ks,0)):(o=-this.Bq,s.gg(this.Ks,0)),i.add(t,!1),t.Pa(),r.add(i,!1),r.Pc(s),n=new e.l,r.A(n),n.X((this.Ks-n.S())/2,0),n.G=-this.Bq,n.H=this.Bq;for(var l=0;l<r.I();l++)r.D(l,a),i.xf(0,-1,a);for(r.Pc(s),l=0;l<r.I();l++)r.D(l,a),i.xf(0,-1,a);r=i.Oa(0),s=i.Oa(i.I()-1),a.na(s.x,o),i.xf(0,-1,a),a.na(.5*(s.x+r.x),o),i.xf(0,-1,a),a.na(r.x,o),i.xf(0,-1,a),i=e.Ih.ls(i,this.Kc,2,!0,n.v),i=e.Ih.ls(i,this.Kc,2,!0,n.C),i=e.Vd.clip(i,n,this.Cq,NaN),t.add(i,!1)},r.prototype.KV=function(t){var i=new e.l;t.A(i),i.X((this.Ks-i.S())/2,0),i.G=-this.Bq,i.H=this.Bq,t.Zk(null,0);var r=new e.h;r.na(i.v,i.G),t.xf(1,-1,r),r.na(i.v,i.H),t.xf(1,-1,r),r.na(.5*(i.v+i.C),i.H),t.xf(1,-1,r),r.na(i.C,i.H),t.xf(1,-1,r),r.na(i.C,i.G),t.xf(1,-1,r),r.na(.5*(i.v+i.C),i.G),t.xf(1,-1,r)},r.ly=function(t,i,s,n,o,a,l,h,c,u,p){var d=null;c||((d=new e.h).Sc(),0<p.I()&&(d.N(p.Oa(p.I()-1)),d.scale(s)));var f=new e.ha(0),y=new e.ha(0),g=new e.ha(0),m=new e.h,v=new e.h,b=a[a.length-1];s=1/s;for(var w=0;w<a.length;w++){var _=a[w];if(0==w)var x=l;else w==a.length-1?x=h:(e.kb.xd(t,i,b.x,b.y,_.x,_.y,null,null,f,o),x=f.u-1.570796326794897);e.kb.zi(t,i,_.x,_.y,n,x,y,g),c?v.na(y.u,g.u):(m.na(y.u,g.u),r.ZI(_.x,m.x,d.x,u),v.na(u[0]+m.x,m.y),d.N(v)),v.scale(s),p.xf(0,-1,v)}},r.Jr=function(t,i,s,n,o,a,l,h,c,u,p,d,f){if(!(l-a<h)){var y=new e.ha(0),g=new e.ha(0),m=new e.h,v=new e.h,b=null;c||((b=new e.h).Sc(),0<p.I()&&(b.N(p.Oa(p.I()-1)),b.scale(s)));var w=e.P.truncate(Math.ceil(a/h)),_=w++*h;for(_==a&&(_=w++*h),s=1/s;_<l+h&&(a<d&&d<_?(_=d,w--):a<f&&f<_&&(_=f,w--),!(_>=l));)e.kb.zi(t,i,o.x,o.y,n,_,y,g),c?v.na(y.u,g.u):(m.na(y.u,g.u),r.ZI(o.x,m.x,b.x,u),v.na(u[0]+m.x,m.y),b.N(v)),v.scale(s),p.xf(0,-1,v),a=_,_=w++*h}},r.WI=function(t,i,r,s,n,o,a,l,h,c){var u=new e.h,p=new e.h,d=new e.ha(0),f=new e.ha(0);for(e.kb.zi(t,i,s.x,s.y,r,n,d,f),u.na(d.u,f.u),e.kb.zi(t,i,s.x,s.y,r,o,d,f),p.na(d.u,f.u),r=new e.ha(0),e.kb.Sy(t,i,a.x,a.y,u.x,u.y,r),h[0]=r.u,e.kb.Sy(t,i,a.x,a.y,p.x,p.y,r),c[0]=r.u;h[0]<=c[0];)h[0]+=6.283185307179586;for(;h[0]>c[0];)h[0]-=6.283185307179586;for(;h[0]>=l;)h[0]-=6.283185307179586,c[0]-=6.283185307179586;for(;h[0]<l;)h[0]+=6.283185307179586,c[0]+=6.283185307179586},r.ZI=function(e,t,i,r){if(isNaN(i)){for(;3.141592653589793<r[0]+t-e;)r[0]-=6.283185307179586;for(;3.141592653589793<e-(r[0]+t);)r[0]+=6.283185307179586}else 3.141592653589793<r[0]+t-i?r[0]-=6.283185307179586:3.141592653589793<i-(r[0]+t)&&(r[0]+=6.283185307179586)},r.yX=function(t,i){var r=t.K(),s=e.ba.Ic(r)?t.ea():550==r?t.I():1;if(1==s)return t;var n=new e.ja(0);n.resize(s);for(var o=[],a=new e.l,l=0;l<s;l++){if(n.write(l,l),e.ba.Ic(r)){t.Sj(l,a);var h=a.tf()}else h=t.Oa(l);h=e.PK.OX(i,h),o[l]=h}for(n.Wd(0,n.size,(function(e,t){return o[e]<o[t]?-1:o[e]>o[t]?1:0})),i=t.Ja(),l=0;l<s;l++)a=n.read(l),e.ba.Ic(r)?i.addPath(t,a,!0):i.Gd(t,a,a+1);return i},r.prototype.mX=function(){var t=Math.min(3.141592653589793*this.Ub-this.sb,this.sb);t=Math.min(t,.39269908169872414*this.Ub);var i=new e.h;i.na(0,10*this.fc);var r=45*this.fc,s=new e.ha(0),n=new e.ha(0),o=new e.ha(0),a=new e.ha(0),l=new e.ha(0),h=new e.ha(0),c=new e.ha(0),u=new e.ha(0),p=new e.h,d=new e.h,f=new e.h,y=new e.h;e.kb.zi(this.Ub,this.lc,i.x,i.y,t,0,s,n),p.na(s.u,n.u),e.kb.zi(this.Ub,this.lc,i.x,i.y,t,r,o,a),d.na(o.u,a.u),s=new e.ha(0),n=new e.ha(0);for(var g=new e.ha(0);e.kb.zi(this.Ub,this.lc,i.x,i.y,t,.5*(0+r),l,h),f.na(l.u,h.u),e.kb.xd(this.Ub,this.lc,p.x,p.y,d.x,d.y,s,n,null,2),e.kb.pj(this.Ub,this.lc,p.x,p.y,.5*s.u,n.u,c,u,2),y.na(c.u,u.u),e.kb.xd(this.Ub,this.lc,f.x,f.y,y.x,y.y,g,null,null,2),!(g.u<=this.ao);)r*=.9,e.kb.zi(this.Ub,this.lc,i.x,i.y,t,r,o,a),d.na(o.u,a.u);this.bo=6.283185307179586/Math.ceil(6.283185307179586/(r-0))},r.prototype.nX=function(){var t=Math.min(3.141592653589793*this.Ub-this.sb,this.sb);t=Math.min(t,.39269908169872414*this.Ub);var i=new e.h,r=new e.h;i.na(0,10*this.fc),r.na(10*this.fc,10*this.fc);var s=new e.ha(0),n=new e.ha(0),o=new e.ha(0);e.kb.xd(this.Ub,this.lc,i.x,i.y,r.x,r.y,o,s,n,this.Ae);var a=new e.ha(0),l=new e.ha(0),h=new e.ha(0),c=new e.ha(0),u=new e.h,p=new e.ha(0),d=new e.ha(0),f=new e.ha(0),y=new e.ha(0),g=new e.ha(0),m=new e.ha(0),v=new e.ha(0),b=new e.ha(0),w=new e.ha(0),_=new e.h,x=new e.h,S=new e.h,M=new e.h,T=1;s=s.u,n=n.u+1.570796326794897,o=o.u,e.kb.zi(this.Ub,this.lc,i.x,i.y,t,s-1.570796326794897,d,f),_.na(d.u,f.u),e.kb.zi(this.Ub,this.lc,r.x,r.y,t,n,y,g),x.na(y.u,g.u),d=new e.ha(0),f=new e.ha(0),n=new e.ha(0);for(var I=new e.ha(0);e.kb.pj(this.Ub,this.lc,i.x,i.y,.5*(0+T)*o,s,a,l,this.Ae),u.na(a.u,l.u),e.kb.xd(this.Ub,this.lc,i.x,i.y,u.x,u.y,null,null,p,this.Ae),e.kb.zi(this.Ub,this.lc,u.x,u.y,t,p.u+1.570796326794897,m,v),S.na(m.u,v.u),e.kb.xd(this.Ub,this.lc,_.x,_.y,x.x,x.y,d,f,null,2),e.kb.pj(this.Ub,this.lc,_.x,_.y,.5*d.u,f.u,b,w,2),M.na(b.u,w.u),e.kb.xd(this.Ub,this.lc,S.x,S.y,M.x,M.y,n,null,null,2),!(n.u<=this.ao);)T*=.9,e.kb.pj(this.Ub,this.lc,i.x,i.y,T*o,s,h,c,this.Ae),r.na(h.u,c.u),e.kb.xd(this.Ub,this.lc,i.x,i.y,r.x,r.y,null,null,I,this.Ae),e.kb.zi(this.Ub,this.lc,r.x,r.y,t,I.u+1.570796326794897,y,g),x.na(y.u,g.u);1e5<(t=T*o)&&(t=1e5),this.KA=t},r.prototype.lX=function(){var e=5e4<this.sb?100:1e4<this.sb?10:1;500>this.sb/e&&(e=this.sb/500),.01>e&&(e=.01),this.ao=e},r}();e.NK=r}($||($={})),function(e){var t=function(){function t(){}return t.Of=function(t,i){var r=new e.h;r.N(i),t.push(r)},t.wp=function(e,t){e.add(t.x),e.add(t.y)},t.bB=function(e){e.Ch(e.size-2)},t.iB=function(e,t){t.na(e.get(e.size-2),e.get(e.size-1))},t.Rr=function(i,r,s,n,o,a){if(null==i)throw e.i.O();var l=i.K();if(i.B()||e.ba.Sn(l))return i;var h=new t;h.Rg=r,h.Kc=e.cb.tc(r);var c=e.cb.wv(h.Kc);if(h.Vb=a,h.Ub=e.cb.fv(h.Kc),h.lc=c*(2-c),h.fc=h.Kc.Id().bi,h.Cq=h.Kc.Ln(),h.$s=h.Cq*h.fc,h.uA=n,h.tA=o,h.Ae=s,197==l?(s=new e.Ea(i.description)).bd(i,!1):e.ba.zd(l)?(s=new e.Ua(i.description)).oc(i,!0):s=i,4!=h.Ae){if((r=0==h.Rg.Nb(h.Kc)?e.cb.Ah(s,h.Rg,h.Kc):e.Ih.mj(s,h.Kc)).B())return r;r=t.hI(h.fc,r),r=h.Uy(r),r=e.jp.oj(r,h.Kc,h.Ae),h=e.cb.Ah(r,h.Kc,h.Rg)}else{if(2==e.Gg.Tb(r)?(i=e.cb.ol(),(r=e.Wk.local().W(s,i,r,a))==i&&(r=new e.Ea,i.copyTo(r))):r=e.Ih.mj(s,h.Kc),r.B())return r;h=h.qX(r)}return h},t.hI=function(i,r){var s=new e.l;if(r.yc(s),3.141592653589793>s.S()*i)return r;var n=!1;s=r.Ha();for(var o=new e.h,a=new e.h;s.ab();)for(;s.Ia();){var l=s.ia();if(o.N(l.ac()),a.N(l.xc()),o.scale(i),a.scale(i),3.141592653589793<Math.abs(o.x-a.x)){var h=t.Nu(o,a);if(!h){n=!0;break}if(6.283185307179586<Math.abs(o.x-a.x)){n=!0;break}}}if(!n)return r;n=r.Ja();var c=1<r.description.Ba,u=new e.h,p=new e.h,d=new e.h,f=new e.h,y=new e.Ta;for(s.$i();s.ab();)for(var g=NaN,m=[0];s.Ia();){if(l=s.ia(),o.N(l.ac()),a.N(l.xc()),o.scale(i),a.scale(i),isNaN(g)?(t.Xi(o.x,NaN,m),p.N(o)):p.N(d),g=p.x,h=t.Nu(o,a)){if(6.283185307179586<a.x-o.x)for(;6.283185307179586<a.x-o.x;)a.x-=6.283185307179586;if(-6.283185307179586>a.x-o.x)for(;-6.283185307179586>a.x-o.x;)a.x+=6.283185307179586;t.Xi(a.x,NaN,m),d.N(a)}else u.N(a),t.qU(u),t.Xi(u.x,g,m),d.na(m[0]+u.x,u.y);.5>Math.abs(d.x-a.x)&&d.N(a),c?(l.Uw(0,y),f.N(p),f.scale(1/i),y.Db(f),(h=s.xm())?n.nf(y):n.lineTo(y),s.Rn()&&!r.ec(s.gb)&&(l.Uw(1,y),f.N(d),f.scale(1/i),y.Db(f),n.lineTo(y))):((h=s.xm())&&n.Cz(null,0),l=n.ea()-1,f.N(p),f.scale(1/i),n.xf(l,-1,f),s.Rn()&&!r.ec(s.gb)&&(f.N(d),f.scale(1/i),n.xf(l,-1,f)))}return n},t.lF=function(i,r,s,n,o,a,l,h,c,u,p,d){var f=new e.h,y=new e.h,g=0<n.compare(o);t.YI(g,n,o,f,y),t.mF(i,r,s,f,y,a,NaN,l,h,c,u,null,p,d),g&&t.ZB(c,u,null,p)},t.prototype.Uy=function(i){var r=i.Ja(),s=i.Ha(),n=[],o=null,a=null,l=1<i.description.Ba;l&&(o=new e.ce(0),a=new e.hg);for(var h=[0],c=new e.h,u=new e.h,p=new e.h,d=new e.h;s.ab();)for(h[0]=0;s.Ia();){var f=s.ia();c.N(f.ac()),u.N(f.xc()),c.scale(this.fc),u.scale(this.fc);var y=0<c.compare(u);t.YI(y,c,u,p,d),n.length=0,null!=o&&o.Ch(0),0<this.uA?t.mF(this.Ub,this.lc,this.Ae,p,d,this.uA,this.tA,this.$s,null,null,null,l?o:null,n,h):t.TQ(this.Ub,this.lc,this.Ae,p,d,this.tA,this.$s,l?o:null,n,h),y&&t.ZB(null,null,l?o:null,n),n[0].N(f.ac()),n[n.length-1].N(f.xc());for(var g=1;g<n.length-1;g++)n[g].scale(1/this.fc);l?(y=t.XI(y,f,a),t.LD(s.xm(),s.Rn()&&!i.ec(s.gb),f,y,o,n,r)):t.KD(s.xm(),s.Rn()&&!i.ec(s.gb),n,r)}return r},t.prototype.qX=function(i){var r=i.Ja(),s=i.Ha(),n=[],o=null,a=new e.hg,l=1<i.description.Ba;for(l&&(o=new e.ce(0));s.ab();)for(;s.Ia();){var h=s.ia(),c=h.ac(),u=h.xc();c=0<c.compare(u),u=t.XI(c,h,a),n.length=0,null!=o&&o.Ch(0),t.pX(this.Ub,this.lc,this.fc,u,this.Rg,this.uA,this.tA,l?o:null,n),c&&t.ZB(null,null,l?o:null,n),l?t.LD(s.xm(),s.Rn()&&!i.ec(s.gb),h,u,o,n,r):t.KD(s.xm(),s.Rn()&&!i.ec(s.gb),n,r)}return r},t.KD=function(e,t,i,r){e&&r.Cz(null,0),e=r.ea()-1;var s=i.slice(0);r.iG(e,s,s.length-1),t&&r.xf(e,-1,i[i.length-1])},t.LD=function(t,i,r,s,n,o,a){var l=new e.Ta;if(r.Uo(l),t?a.nf(l):a.lineTo(l),2<o.length){t=s.Rb();for(var h=1;h<o.length-1;h++){var c=s.FG(n.get(h)*t);s.Uw(c,l),l.Db(o[h]),a.lineTo(l)}}i&&(r.Qo(l),a.lineTo(l))},t.mF=function(i,r,s,n,o,a,l,h,c,u,p,d,f,y){var g=new e.ha(0),m=new e.ha(0),v=new e.ha(0);e.kb.xd(i,r,n.x,n.y,o.x,o.y,v,g,m,s),v=v.u;var b=g=g.u;0>b&&(b+=6.283185307179586),0>(m=m.u)&&(m+=6.283185307179586),null!=c&&(c[0]=v),null!=u&&(u[0]=b),null!=p&&(p[0]=m),u=c=NaN,null!=d&&(c=((u=e.F.Bh(i,r))-(p=e.F.q(i,r,n.y)))/v,u=(u+p)/v),p=t.Ou(n,o),m=t.Mu(n,o),b=p||m;var w=t.xE(n,o,h),_=new e.ha(0),x=new e.ha(0),S=new e.h,M=new e.h,T=new e.h;t.Xi(n.x,NaN,y);var I=[y[0]];if(v<=a)t.Of(f,n),t.Xi(o.x,NaN,y),null!=d&&d.add(0),b?(p&&t.eB(n,o,d,f),m&&t.cB(n,o,d,f)):w?t.dB(n,o,g,c,u,d,f):0<l&&(M.na(n.x-I[0],n.y),S.na(o.x-y[0],o.y),t.Ty(i,r,s,n,v,g,M,S,0,1,l,d,f,I)),t.Of(f,o);else{var E=v/((a=1+e.P.truncate(Math.ceil(v/a)))-1),A=new e.h,P=0;t.Of(f,n),A.N(n),M.na(n.x-y[0],n.y),null!=d&&d.add(0);for(var C=1;C<a;C++){if(C<a-1){e.kb.pj(i,r,n.x,n.y,C*E,g,_,x,s),S.na(_.u,x.u),t.Xi(S.x,A.x,y),T.na(y[0]+S.x,S.y);var O=C/(a-1)}else t.Xi(o.x,NaN,y),S.na(o.x-y[0],o.y),T.N(o),O=1;b?(1==C&&p&&t.eB(n,T,d,f),C==a-1&&m&&t.cB(A,o,d,f)):w?t.wE(A,T,h)&&(n.x<o.x?A.x>T.x&&(y[0]+=6.283185307179586,T.na(y[0]+S.x,S.y)):A.x<T.x&&(y[0]-=6.283185307179586,T.na(y[0]+S.x,S.y)),t.dB(A,T,g,c,u,d,f)):0<l&&t.Ty(i,r,s,n,v,g,M,S,P,O,l,d,f,I),t.Of(f,T),null!=d&&d.add(O),A.N(T),M.N(S),I[0]=y[0],P=O}}},t.TQ=function(i,r,s,n,o,a,l,h,c,u){var p=new e.ha(0),d=new e.ha(0),f=new e.ha(0);e.kb.xd(i,r,n.x,n.y,o.x,o.y,f,p,d,s),d=f.u,p=p.u;var y=f=NaN;if(null!=h){y=e.F.Bh(i,r);var g=e.F.q(i,r,n.y);f=(y-g)/d,y=(y+g)/d}g=t.Ou(n,o);var m=t.Mu(n,o),v=g||m;l=t.xE(n,o,l);var b=t.Nu(n,o);b=v||l||b,t.Xi(n.x,NaN,u);var w=new e.h;t.Of(c,n),w.N(n),null!=h&&h.add(0),b?(v?(g&&t.eB(n,o,h,c),m&&t.cB(n,o,h,c)):l&&t.dB(n,o,p,f,y,h,c),t.Xi(o.x,NaN,u),t.Of(c,o)):d<=a?(t.Xi(o.x,NaN,u),t.Of(c,o)):(f=new e.h,l=new e.h,f.N(n),l.N(o),f.x-=u[0],l.x-=u[0],-3.141592653589793>l.x?l.x+=6.283185307179586:3.141592653589793<l.x&&(l.x-=6.283185307179586),t.Ty(i,r,s,n,d,p,f,l,0,1,a,h,c,u),t.Of(c,o),t.Xi(o.x,NaN,u)),null!=h&&h.add(1)},t.Ty=function(i,r,s,n,o,a,l,h,c,u,p,d,f,y){var g=new e.h,m=new e.h;g.na(l.x+y[0],l.y),new e.ha(0),new e.ha(0),new e.ha(0),new e.ha(0);var v=new e.ha(0),b=new e.ha(0),w=new e.ha(0),_=new e.h,x=new e.h,S=new e.h,M=new e.h;_.N(l),x.N(h),l=new e.ce(0),h=new e.ce(0),t.wp(l,x),h.add(u);var T=new e.h,I=new e.zb,E=[];for(t.QJ(4,E);0<l.size;){for(var A,P=!1,C=NaN,O=0;3>O;O++)if(A=E[O]*u+(1-E[O])*c,e.kb.pj(i,r,n.x,n.y,A*o,a,v,b,s),S.na(v.u,b.u),0==O&&(C=A,M.N(S)),t.JW(_,S,x,I),I.ic(I.fe(S,!0),T),e.kb.xd(i,r,S.x,S.y,T.x,T.y,w,null,null,2),w.u>p){P=!0;break}P?(x.N(M),u=C,t.wp(l,x),h.add(u)):(t.bB(l),h.Fn(h.size-1,1,h.size-1),0<l.size&&(t.Xi(x.x,g.x,y),m.na(y[0]+x.x,x.y),t.Of(f,m),g.N(m),null!=d&&d.add(u),_.N(x),c=u,t.iB(l,x),u=h.get(h.size-1)))}},t.pX=function(i,r,s,n,o,a,l,h,c){var u=new e.h,p=new e.h,d=new e.h,f=new e.h,y=new e.h,g=new e.h,m=new e.h,v=new e.h,b=new e.h,w=new e.h,_=new e.ha(0),x=new e.ha(0),S=new e.h,M=[[],[]],T=1==e.Gg.Tb(o);o=o.Yd(0);var I=n.ac(),E=n.xc();T?(g.na(I.x*s,I.y*s),m.na(E.x*s,E.y*s)):(M[0][0]=I.x,M[0][1]=I.y,M[1][0]=E.x,M[1][1]=E.y,e.cb.vt(),g.x=M[0][0]*s,g.y=M[0][1]*s,m.x=M[1][0]*s,m.y=M[1][1]*s);var A=0,P=0,C=1,O=n.Qn();u.N(I),p.N(E),E=new e.ce(0);var k=new e.ce(0),L=new e.ce(0);t.wp(E,p),t.wp(k,m),L.add(C),t.Of(c,u),null!=h&&h.add(P);var R=[],D=0<l?O?5:3:O?5:1;t.QJ(D,R);for(var F=new e.ha(0),j=new e.ha(0),N=new e.ha(0),z=new e.ha(0),V=new e.ha(0),U=new e.ha(0),G=new e.ha(0);0<k.size;){var B=!1,q=NaN;for(e.kb.xd(i,r,g.x,g.y,m.x,m.y,F,j,null,2),I=0;I<D;I++){if(0==I){if(!O&&0>=l&&F.u<=a&&3.141592653589793>Math.abs(g.x-m.x))break;if(n.Sx(P,C)<=o)break}var H=R[I]*C+(1-R[I])*P;if(n.ic(H,d),T?v.na(d.x*s,d.y*s):(M[0][0]=d.x,M[0][1]=d.y,e.cb.vt(),v.x=M[0][0]*s,v.y=M[0][1]*s),0==I&&(q=H,y.N(d),w.N(v),0<a&&(F.u>a||3.141592653589793<=Math.abs(g.x-m.x)))){B=!0;break}if(O&&0<a){if(e.kb.xd(i,r,g.x,g.y,v.x,v.y,N,null,null,2),N.u>a||3.141592653589793<=Math.abs(g.x-v.x)){B=!0;break}}else if(0<l){if(O?(f.ES(u,p,R[I]),T?b.na(f.x*s,f.y*s):(M[0][0]=f.x,M[0][1]=f.y,e.cb.vt(),b.x=M[0][0]*s,b.y=M[0][1]*s)):(f.N(d),b.N(v)),e.kb.xd(i,r,g.x,g.y,b.x,b.y,z,null,null,2),!(z.u<=F.u)){B=!0;break}if(e.kb.pj(i,r,g.x,g.y,z.u,j.u,_,x,2),S.na(_.u,x.u),e.kb.xd(i,r,S.x,S.y,v.x,v.y,V,null,null,2),V.u>l){B=!0;break}if(O){if(e.kb.xd(i,r,S.x,S.y,b.x,b.y,U,null,null,2),U.u>l){B=!0;break}if(e.kb.xd(i,r,b.x,b.y,v.x,v.y,G,null,null,2),G.u>l){B=!0;break}}}}B?(p.N(y),m.N(w),C=q,t.wp(E,p),t.wp(k,m),L.add(C)):(t.bB(E),t.bB(k),L.Fn(L.size-1,1,L.size-1),t.Of(c,p),A+=F.u,null!=h&&h.add(A),0<k.size&&(u.N(p),g.N(m),P=C,t.iB(E,p),t.iB(k,m),C=L.get(L.size-1)))}if(null!=h)for(i=1/A,I=0;I<h.size;I++)h.write(I,h.read(I)*i)},t.ZB=function(e,t,i,r){r.reverse(),null!=i&&i.oi(0,i.size,1),i=null!=e?e[0]:NaN,r=null!=t?t[0]:NaN,null!=e&&(e[0]=r),null!=t&&(t[0]=i)},t.YI=function(e,t,i,r,s){e?(r.N(i),s.N(t)):(r.N(t),s.N(i))},t.XI=function(e,t,i){return e?(i.create(t.K()),t.copyTo(i.get()),i.get().reverse(),i.get()):t},t.Xi=function(e,t,i){if(isNaN(t)){for(;3.141592653589793<i[0]-e;)i[0]-=6.283185307179586;for(;3.141592653589793<e-i[0];)i[0]+=6.283185307179586}else 3.141592653589793<i[0]+e-t?i[0]-=6.283185307179586:3.141592653589793<t-(i[0]+e)&&(i[0]+=6.283185307179586)},t.JW=function(e,t,i,r){3.141592653589793>Math.abs(t.x-e.x)?(r.Ec(e),3.141592653589793<=i.x-e.x?r.Sl(i.x-6.283185307179586,i.y):3.141592653589793<=e.x-i.x?r.Sl(i.x+6.283185307179586,i.y):r.Sl(i.x,i.y)):(r.Ec(i),3.141592653589793<=e.x-i.x?r.Sl(e.x-6.283185307179586,e.y):3.141592653589793<=i.x-e.x?r.Sl(e.x+6.283185307179586,e.y):r.Sl(e.x,e.y))},t.QJ=function(e,t){for(var i=0;i<e;i++){var r=Math.ceil(i/2)/(e+1);i%2!=0&&(r=-r),t[i]=.5+r}},t.Ou=function(t,i){return!!(e.s.$(t.y,1.570796326794897)&&!e.s.$(i.y,1.570796326794897)||e.s.$(t.y,-1.570796326794897)&&!e.s.$(i.y,-1.570796326794897))},t.Mu=function(t,i){return!!(e.s.$(i.y,1.570796326794897)&&!e.s.$(t.y,1.570796326794897)||e.s.$(i.y,-1.570796326794897)&&!e.s.$(t.y,-1.570796326794897))},t.xE=function(i,r,s){return!(!t.wE(i,r,s)||e.s.$(i.y,1.570796326794897)||e.s.$(i.y,-1.570796326794897)||e.s.$(r.y,1.570796326794897)||e.s.$(r.y,-1.570796326794897))},t.wE=function(e,t,i){return Math.abs(Math.abs(e.x-t.x)-3.141592653589793)<=i},t.Nu=function(t,i){return!!(e.s.$(t.y,1.570796326794897)&&e.s.$(i.y,1.570796326794897)||e.s.$(t.y,-1.570796326794897)&&e.s.$(i.y,-1.570796326794897))},t.eB=function(i,r,s,n){if(0<i.y){var o=new e.h;o.na(r.x,1.570796326794897)}else(o=new e.h).na(r.x,-1.570796326794897);e.s.$(i.x,o.x)||e.s.$(r.y,o.y)||(t.Of(n,o),null!=s&&s.add(0))},t.cB=function(i,r,s,n){if(0<r.y){var o=new e.h;o.na(i.x,1.570796326794897)}else(o=new e.h).na(i.x,-1.570796326794897);e.s.$(r.x,o.x)||e.s.$(i.y,o.y)||(t.Of(n,o),null!=s&&s.add(1))},t.dB=function(i,r,s,n,o,a,l){e.s.Dd(s)?(0<1.570796326794897-i.y&&((s=new e.h).na(i.x,1.570796326794897),t.Of(l,s),null!=a&&a.add(n)),0<1.570796326794897-r.y&&((s=new e.h).na(r.x,1.570796326794897),t.Of(l,s),null!=a&&a.add(n))):(0<1.570796326794897+i.y&&((s=new e.h).na(i.x,-1.570796326794897),t.Of(l,s),null!=a&&a.add(o)),0<1.570796326794897+r.y&&((s=new e.h).na(r.x,-1.570796326794897),t.Of(l,s),null!=a&&a.add(o)))},t.qU=function(e){if(-3.141592653589793>e.x)for(;-3.141592653589793>e.x;)e.x+=6.283185307179586;if(3.141592653589793<e.x)for(;3.141592653589793<e.x;)e.x-=6.283185307179586},t}();e.dj=t}($||($={})),function(e){e.jp=function(){function t(){}return t.oj=function(i,r,s){if(null==i||null==r||!e.cb.Xc(r))throw e.i.O();if(i.B())return i;var n=i,o=n.K();if(e.ba.Ic(o)){n=e.Ih.mj(i,r),i=new e.l,n.A(i),o=e.ta.Xd(r,i,!1);for(var a=e.cb.hh(r),l=Math.floor((i.v-a.v)/a.S())*a.S()+a.v;l<i.C;)l>i.v+o&&l<i.C-o&&(n=e.Ih.ls(n,r,s,!0,l)),l+=a.S()}else{if(197==o)return(i=new e.Ea(n.description)).bd(n,!1),t.oj(i,r,s);if(e.ba.zd(o))return(i=new e.Ua(n.description)).oc(n,!0),t.oj(i,r,s)}return t.Py(n,r)},t.Py=function(i,r){if(null==i||null==r||!e.cb.Xc(r))throw e.i.O();if(i.B())return i;var s=i.K();return 197==s?(s=new e.Ea(i.description)).bd(i,!1):e.ba.zd(s)?(s=new e.Ua(i.description)).oc(i,!0):s=i,(s=e.Ih.mj(s,r)).B()?s:1==e.Gg.Tb(r)?e.Ih.Gn(s,r,0,s!=i,0):t.FQ(s,r,s!=i)},t.FQ=function(t,i,r){if(!e.cb.Xc(i))throw e.i.O();if(t.B())return t;var s=e.cb.bf(i),n=-180*s;return s*=360,2==e.Gg.Tb(i)&&(s=(n=e.cb.hh(i)).C,s-=n=n.v),e.Ih.Jp(t,n,s,i,r,0,!0)},t}()}($||($={})),function(e){e.qY=function(){function e(){}return e.R=function(e){return 0>e?-e:e},e.Mb=function(t,i){return 0<=i?e.R(t):-e.R(t)},e.$=function(t,i){return t==i||e.R(t-i)<=e.BC*(1+(e.R(t)+e.R(i))/2)},e.Dd=function(t){return 0==t||e.R(t)<=e.BC},e.Bh=function(t,i){var r=(i=(1-(i=Math.sqrt(1-i)))/(1+i))*i;return t/(1+i)*(1+r*(.25+r*(.015625+1/256*r)))*e.wL},e.wL=1.5707963267948966,e.BC=3552713678800501e-30,e}()}($||($={})),function(e){var t=function(e){this.Xf=e,this.Kk=this.Xf.getCode(),0>this.Kk&&(this.Kk=0)};e.sY=t;var i=function(){function i(e){void 0===e&&(e=null),this.Dj=null,this.Vn=!1,null!==e&&(this.Dj=new t(e))}return i.prototype.Fc=function(){return null!=this.Dj?this.Dj.Kk:0},i.prototype.Pf=function(){var e=new i;return this.copyTo(e),e},i.prototype.copyTo=function(e){e.Dj=this.Dj,e.Vn=this.Vn},i.prototype.Lz=function(){this.Vn=!this.Vn},i.prototype.sm=function(){return null!=this.Dj?this.Dj.Xf:null},i.prototype.DJ=function(i){if(0>=i)throw e.i.O();if(i!=this.Fc()){if(null==(i=e.qf.geogtran(i)))throw e.i.O("Geogtran not found.");this.Dj=new t(i)}},i.prototype.wz=function(){return null==this.Dj?null:this.Dj.Xf.toString()},i.prototype.hX=function(i){if(null==i)throw e.i.O();var r=null;try{r=e.qf.fromString(e.Tc.PE_TYPE_GEOGTRAN,i)}catch(s){throw e.i.O()}this.Dj=new t(r)},i.prototype.Nb=function(e){return e==this||!(!(e instanceof i)||(0>=this.Fc()||this.Fc()!=e.Fc())&&!this.sm().isEqual(e.sm()))&&this.Vn==e.Vn},i.prototype.toString=function(){var e="GeographicTransformation: "+this.wz();return 200<e.length?e.substring(0,197)+"... ("+e.length.toString()+" characters)":e},i.create=function(e,t){var r=new i;return r.DJ(e),t&&r.Lz(),r},i.mP=function(e,t){var r=new i;return r.hX(e),t&&r.Lz(),r},i}();e.Bx=i}($||($={})),function(e){var t=function(){function e(){}return e.construct=function(t,i,r,s){var n=new e;return n.iw=t,n.jw=i,n.FY=r,n.GY=s,n},e.yy=function(e,t){return e.iw==t.iw?e.jw==t.jw?0:e.jw<t.jw?-1:1:e.iw<t.iw?-1:1},e}(),i=function(){function e(){this.nT=[],this.oT=[],this.rp()}return e.fz=function(){return null==e.bK&&(e.bK=new e),e.bK},e.prototype.rp=function(){this.aD(this.nT),this.aD(this.oT)},e.prototype.aD=function(e){try{var i=[];i=i.sort(t.yy);for(var r=0;r<i.length;r++)e.push(i[r])}catch(s){}},e}();e.rY=i}($||($={})),function(e){var t=function(){function e(){}return e.prototype.qD=function(e){this.Fk=e},e.prototype.OM=function(e){this.Gb=e},e.prototype.pD=function(e){this.Ao=e},e.uE=function(e){return!(e.B()||1607!=e.K()&&1736!=e.K())},e.sE=function(e){return!(e.B()||1607!=e.K()&&1736!=e.K()||20>e.I())},e.tE=function(e){return!(e.B()||1607!=e.K()&&1736!=e.K()||20>e.I())},e}();e.Uk=t}($||($={})),function(e){e.bc=function(){function t(){}return t.JT=function(t){var i=new e.Ea;return i.qx(t.fs(),t.hs()),i.zj(t.fs(),t.gs()),i.zj(t.es(),t.gs()),i.zj(t.es(),t.hs()),i},t.Ah=function(t,i){return null===t?null:e.Fx.local().W(t,i,null)},t.YX=function(t,i){var r=e.Hh.local();return t=new e.$c(t),r.W(t,i,null).next()},t.km=function(t,i,r){return e.lp.local().W(t,i,r,null)},t.fp=function(t,i,r){return e.Ix.local().W(t,i,r,null)},t.JX=function(t,i,r){var s=e.Ix.local();for(t=new e.$c(t),i=new e.$c(i),r=s.W(t,i,r,null),s=[];null!=(i=r.next());)s.push(i);return s},t.Nb=function(t,i,r){return e.ej.local().W(3,t,i,r,null)},t.LP=function(t,i,r){return e.ej.local().W(4,t,i,r,null)},t.HS=function(t,i,r){var s=e.Wk.local();for(t=new e.$c(t),i=new e.$c(i),r=s.W(t,i,r,null),s=[];null!=(i=r.next());)s.push(i);return s},t.IP=function(t,i,r){var s=e.lp.local();for(t=new e.$c(t),i=new e.$c(i),r=s.W(t,i,r,null),s=[];null!=(i=r.next());)s.push(i);return s},t.Fa=function(t,i,r){return e.Wk.local().W(t,i,r,null)},t.eY=function(t,i,r){return e.ej.local().W(2,t,i,r,null)},t.contains=function(t,i,r){return e.ej.local().W(1,t,i,r,null)},t.tP=function(t,i,r){return e.ej.local().W(16,t,i,r,null)},t.touches=function(t,i,r){return e.ej.local().W(8,t,i,r,null)},t.tU=function(t,i,r){return e.ej.local().W(32,t,i,r,null)},t.JS=function(t,i,r){return e.ej.local().W(1073741824,t,i,r,null)},t.sB=function(t,i,r,s){return e.rL.local().W(t,i,r,s,null)},t.ub=function(t,i,r,s){var n=null;if(null!=r){if(n=r.Id(),null!=s&&n.Fc()!=s.Fc()&&n.od!=s.od)throw e.i.Yk()}else if(null!=s)throw e.i.O();return t=e.iL.local().W(t,i,null),null!==n&&null!==s&&(t=e.Uc.Oh(t,n,s)),t},t.clip=function(t,i,r){return e.cL.local().W(t,e.l.construct(i.fs(),i.hs(),i.es(),i.gs()),r,null)},t.el=function(t,i,r){if(null==t||null==i)return null;for(t=e.eL.local().W(!0,t,i,r,null),i=[];null!=(r=t.next());)r.B()||i.push(r);return i.slice(0)},t.EN=function(i,r,s,n,o,a,l,h){if(!0===o)return t.FN(i,r,s,n,a,l,h);if(o=s,null!=r){if(l=r.Id(),null!=n&&l.Fc()!=n.Fc()){if(l.od!=n.od)throw e.i.Yk();o=[],e.Uc.PE(s,s.length,n,l,o)}}else if(null!=n)throw e.i.O();if(s=e.sC.local(),a){for(i=new e.$c(i),r=s.W(i,r,o,a,null),i=[];null!=(a=r.next());)i.push(a);a=i.slice(0)}else for(a=[],n=0;n<i.length;n++)a[n]=s.W(i[n],r,o[n],null);return a},t.FN=function(t,i,r,s,n,o,a){if(null===i)throw e.i.O();if(null==s&&(s=4326!==i.Fc()?i.Id():e.Uc.$g(9001)),0!==s.od)throw e.i.O();if(e.Uc.PE(r,r.length,s,e.Uc.$g(9001),r),s=e.xC.local(),n){for(t=new e.$c(t),i=s.W(t,i,o,r,a,!1,n,null),r=[];null!=(o=i.next());)r.push(o);n=r.slice(0)}else{n=[];for(var l=0;l<t.length;l++)n[l]=s.W(t[l],i,o,r[l],a,!1,null)}return n},t.buffer=function(t,i,r,s,n,o,a){var l=r;if(!1===n){if(null!=i){if(n=i.Id(),null!=s&&n.Fc()!=s.Fc()){if(n.od!=s.od)throw e.i.Yk();l=e.Uc.Oh(r,s,n)}}else if(null!=s)throw e.i.O();t=e.sC.local().W(t,i,l,null)}else{if(null===i)throw e.i.O();if(null==s&&(s=4326!==i.Fc()?i.Id():e.Uc.$g(9001)),0!==s.od)throw e.i.O();l=e.Uc.Oh(r,s,e.Uc.$g(9001)),t=e.xC.local().W(t,i,o,l,a,!1,null)}return t},t.rU=function(t,i,r,s,n,o,a){if(null!=i){var l=i.Id();if(null!=a&&l.Fc()!=a.Fc()){if(l.od!=a.od)throw e.i.Yk();r=e.Uc.Oh(r,a,l)}}else if(null!=a)throw e.i.O();for(t=new e.$c(t),i=e.AC.local().W(t,i,r,s,n,o,null),r=[];null!=(s=i.next());)r.push(s);return r.slice(0)},t.offset=function(t,i,r,s,n,o,a){if(null!=i){var l=i.Id();if(null!=a&&l.Fc()!=a.Fc()){if(l.od!=a.od)throw e.i.Yk();r=e.Uc.Oh(r,a,l)}}else if(null!=a)throw e.i.O();return e.AC.local().W(t,i,r,s,n,o,null)},t.aP=function(t){return e.uC.local().W(t,null)},t.bP=function(t,i){var r=e.uC.local();for(t=new e.$c(t),i=r.W(t,i,null),r=[];null!=(t=i.next());)r.push(t);return r},t.iz=function(t,i,r){return e.Gx.local().iz(t,i,r)},t.jz=function(t,i){return e.Gx.local().jz(t,i)},t.kz=function(t,i,r,s){return e.Gx.local().kz(t,i,r,s)},t.YB=function(t,i){return e.$l.local().W(t,i,!1,null)},t.US=function(t,i){return e.$l.local().ss(t,i,null)},t.IQ=function(t,i,r,s,n){var o=e.wC.local();if(null!=i){if(i=i.Id(),null!=n&&i.Fc()!=n.Fc()){if(i.od!=n.od)throw e.i.Yk();r=e.Uc.Oh(r,n,i)}}else if(null!=n)throw e.i.O();return o.W(t,r,s,null)},t.Rr=function(t,i,r,s){var n=e.Zl.local();if(null!=i){if(i=i.Id(),null!=s&&i.Fc()!=s.Fc()){if(i.od!=s.od)throw e.i.Yk();r=e.Uc.Oh(r,s,i)}}else if(null!=s)throw e.i.O();return n.W(t,r,null)},t.Ry=function(t,i,r,s,n){void 0===n&&(n=0);var o=e.kL.local();if(4==n)throw e.i.Fe();if(0!==n)throw e.i.Fe();if(null!==s){if(0!==s.od)throw e.i.O("Unit must be a linear unit type");r=e.Uc.Oh(r,s,e.Uc.$g(9001))}return o.W(t,r,i,n,null)},t.OQ=function(i,r,s,n){if(null===i)return 0;if(4==n)throw e.i.Fe();if(0!==n)throw e.i.Fe();if(197==i.K())i=t.JT(i);else if(1736!=i.K())return 0;if(n=e.cb.tc(r),i=e.cb.Ah(i,r,n),i=e.MK.PQ([i])[0],null!==s){if(2!==s.od)throw e.i.O("Unit must be a area unit type");i=e.Uc.Oh(i,e.Uc.$g(109404),s)}return i},t.RQ=function(t,i,r,s){if(t=e.mL.local().W(t,i,s,null),null!==r){if(0!==r.od)throw e.i.O("Unit must be a linear unit type");t=e.Uc.Oh(t,e.Uc.$g(9001),r)}return t},t.zU=function(t,i,r){if(null===t)return 0;var s=null;if(null!=i){if(0==(s=i.Id()).od&&null==(s=e.Uc.TF(s))&&null!==r)throw e.i.O();if(null!=r&&s.Fc()!=r.Fc()&&s.od!=r.od)throw e.i.Yk()}else if(null!=r)throw e.i.O();return 1736==t.K()||197==t.K()?(t=t.He(),null!==r?e.Uc.Oh(t,s,r):t):0},t.AU=function(t,i,r){if(null===t||t.B()||1>t.Eb())return 0;var s=null;if(null!=i){if(s=i.Id(),null!=r&&s.Fc()!=r.Fc()&&s.od!=r.od)throw e.i.Yk()}else if(null!=r)throw e.i.O();1736==t.K()||197==t.K()?i=t.mg():e.ba.zd(t.K())?(i=new e.Ua(t.description)).oc(t,!0):i=t,t=0,i=i.Ha();for(var n=new e.h,o=new e.h;i.ab();)for(;i.Ia();){var a=i.ia();a.$p(n),a.Ur(o),t+=e.h.ub(n,o)}return null!==s&&null!==r&&(t=e.Uc.Oh(t,s,r)),t},t.YO=function(e){return void 0!==e.points?t.dS(e,void 0!==e.hasZ&&e.hasZ,void 0!==e.hasM&&e.hasM):void 0!==e.rings?t.dG(e.rings,void 0!==e.hasZ&&e.hasZ,void 0!==e.hasM&&e.hasM,"P"):void 0!==e.paths?t.dG(e.paths,void 0!==e.hasZ&&e.hasZ,void 0!==e.hasM&&e.hasM,"L"):void 0!==e.x?t.eS(e):void 0!==e.xmin?t.cS(e):null},t.eS=function(t){if(null==t.x||"NaN"==t.x)return new e.Ta;var i=new e.Ta(t.x,t.y);return void 0!==t.z&&null!==t.z&&i.kX(t.z),void 0!==t.m&&null!==t.m&&i.VW(t.m),i},t.cS=function(t){if(null==t.xmin||"NaN"==t.xmin)return new e.Gh;var i=new e.Gh(t.xmin,t.ymin,t.xmax,t.ymax);return void 0!==t.zmin&&null!==t.zmin&&i.setInterval(1,0,t.zmin,t.zmax),void 0!==t.mmin&&null!==t.mmin&&i.setInterval(2,0,t.mmin,t.mmax),i},t.dS=function(t,i,r){var s=0,n=new e.de,o=3*t.points.length;o%2!=0&&o++,2>o&&(o=2);var a=e.P.truncate(3*t.points.length/2);4>a?a=4:16>a&&(a=16),o=e.Zc.En(o,0);var l=e.Zc.En(a);a=e.Zc.En(a);for(var h=0;h<t.points.length;h++)o.write(2*h,t.points[h][0]),o.write(2*h+1,t.points[h][1]),l.write(h,i||r?t.points[h][2]:NaN),a.write(h,r&&i?t.points[h][3]:NaN),s++;return 0!=s&&(n.resize(s),n.kn(0,o)),i&&(n.se(1),n.kn(1,l)),r&&(n.se(2),n.kn(2,0==i?l:a)),n.Qc(16777215),n},t.dG=function(t,i,r,s){var n=0,o=2;if("P"==s){var a=new e.Ea;n=1,o=3}else a=new e.Ua;for(var l=e.Zc.Ph(0),h=e.Zc.Nr(0),c=0,u=0,p=[],d=[],f=0;f<t.length;f++){var y=t[f].length;if(p[f]=!1,"P"===s&&t[f][0][0]===t[f][t[f].length-1][0]&&t[f][0][1]===t[f][t[f].length-1][1]){var g=0==r||t[f][0][3]===t[f][t[f].length-1][3]||void 0===t[f][0][3]&&void 0===t[f][t[f].length-1][3];(0==i||t[f][0][2]===t[f][t[f].length-1][2]||void 0===t[f][0][2]&&void 0===t[f][t[f].length-1][2])&&g&&(p[f]=!0,--y)}y>=o?(d[f]=!1,u+=1,l.add(c),h.add(n),c+=y):d[f]=!0}for((s=3*c)%2!=0&&s++,2>s&&(s=2),4>(f=e.P.truncate(3*c/2))?f=4:16>f&&(f=16),s=e.Zc.En(s,0),n=e.Zc.En(f),o=e.Zc.En(f),f=y=0;f<t.length;f++)if(!1===d[f])for(g=0;g<t[f].length;g++){var m=!1;g===t[f].length-1&&!0===p[f]&&(m=!0),m||(s.write(2*y,t[f][g][0]),s.write(2*y+1,t[f][g][1]),n.write(y,i||r?t[f][g][2]:NaN),o.write(y,r&&i?t[f][g][3]:NaN),y++)}return 0!=c&&(t=a,l.resize(u),h.resize(u),0<c&&(l.add(c),h.add(0)),t.kn(0,s),t.HJ(h),t.IJ(l)),i&&(a.se(1),a.kn(1,n)),r&&(a.se(2),a.kn(2,0==i?n:o)),a.Qc(16777215),a},t}()}($||($={})),function(e){e.Cx=function(){function e(){}return e.dr=function(e){var t,i=0,r=e.length,s=e[0];for(t=0;t<r-1;t++){var n=e[t+1];i+=(n[0]-s[0])*(n[1]+s[1]),s=n}return 0<=i},e.rotate=function(t,i,r){i=i*Math.PI/180;var s=Math.cos(i),n=Math.sin(i);if(void 0!==t.paths){i={paths:[]};for(var o=0;o<t.paths.length;o++){for(var a=t.paths[o],l=[],h=0;h<a.length;h++){var c=a[h].slice(0);l.push(c);var u=s*(a[h][0]-r.x)-n*(a[h][1]-r.y)+r.x,p=n*(a[h][0]-r.x)+s*(a[h][1]-r.y)+r.y;c[0]=u,c[1]=p}i.paths.push(l)}return i}if(void 0!==t.rings){for(i={rings:[]},o=0;o<t.rings.length;o++){a=t.rings[o],l=[];var d=e.dr(a);for(h=0;h<a.length;h++)c=a[h].slice(0),l.push(c),u=s*(a[h][0]-r.x)-n*(a[h][1]-r.y)+r.x,p=n*(a[h][0]-r.x)+s*(a[h][1]-r.y)+r.y,c[0]=u,c[1]=p;e.dr(l)!==d&&l.reverse(),i.rings.push(l)}return i}if(void 0!==t.x)return i={x:s*(t.x-r.x)-n*(t.y-r.y)+r.x,y:n*(t.x-r.x)+s*(t.y-r.y)+r.y},void 0!==t.z&&(i.z=t.z),void 0!==t.m&&(i.m=t.m),i;if(void 0!==t.points){for(i={points:[]},t=t.points,h=0;h<t.length;h++)(o=t[h].slice(0))[0]=s*(t[h][0]-r.x)-n*(t[h][1]-r.y)+r.x,o[1]=n*(t[h][0]-r.x)+s*(t[h][1]-r.y)+r.y,i.points.push(o);return i}return null},e.BQ=function(t,i){if(void 0!==t.paths){for(var r={paths:[]},s=0;s<t.paths.length;s++){for(var n=t.paths[s],o=[],a=0;a<n.length;a++){var l=n[a].slice(0);o.push(l);var h=i.x-n[a][0];l[0]=n[a][0]+2*h}r.paths.push(o)}return r}if(void 0!==t.rings){for(r={rings:[]},s=0;s<t.rings.length;s++){n=t.rings[s];var c=e.dr(n);for(o=[],a=0;a<n.length;a++)l=n[a].slice(0),o.push(l),h=i.x-n[a][0],l[0]=n[a][0]+2*h;e.dr(o)!==c&&o.reverse(),r.rings.push(o)}return r}if(void 0!==t.x)return h=i.x-t.x,r={x:t.x+2*h,y:t.y},void 0!==t.z&&(r.z=t.z),void 0!==t.m&&(r.m=t.m),r;if(void 0!==t.points){for(r={points:[]},t=t.points,a=0;a<t.length;a++)s=t[a].slice(0),h=i.x-s[0],s[0]+=2*h,r.points.push(s);return r}return void 0!==t.xmin?(r={v:t.xmin,G:t.ymin,C:t.xmax,H:t.ymax},void 0!==t.zmin&&(r.zmin=t.zmin,r.zmax=t.zmax),void 0!==t.mmin&&(r.mmin=t.mmin,r.mmax=t.mmax),h=i.x-t.xmin,r.xmax=t.xmin+2*h,h=i.x-t.xmax,r.xmin=t.xmax+2*h,r):null},e.CQ=function(t,i){if(void 0!==t.paths){for(var r={paths:[]},s=0;s<t.paths.length;s++){for(var n=t.paths[s],o=[],a=0;a<n.length;a++){var l=n[a].slice(0);o.push(l);var h=i.y-n[a][1];l[1]=n[a][1]+2*h}r.paths.push(o)}return r}if(void 0!==t.rings){for(r={rings:[]},s=0;s<t.rings.length;s++){n=t.rings[s];var c=e.dr(n);for(o=[],a=0;a<n.length;a++)l=n[a].slice(0),o.push(l),h=i.y-n[a][1],l[1]=n[a][1]+2*h;e.dr(o)!==c&&o.reverse(),r.rings.push(o)}return r}if(void 0!==t.x)return h=i.y-t.y,r={y:t.y+2*h,x:t.x},void 0!==t.z&&(r.z=t.z),void 0!==t.m&&(r.m=t.m),r;if(void 0!==t.points){for(r={points:[]},t=t.points,a=0;a<t.length;a++)s=t[a].slice(0),h=i.y-s[1],s[1]+=2*h,r.points.push(s);return r}return void 0!==t.xmin?(r={v:t.xmin,G:t.ymin,C:t.xmax,H:t.ymax},void 0!==t.zmin&&(r.zmin=t.zmin,r.zmax=t.zmax),void 0!==t.mmin&&(r.mmin=t.mmin,r.mmax=t.mmax),h=i.y-t.ymin,r.ymax=t.ymin+2*h,h=i.y-t.ymax,r.ymin=t.ymax+2*h,r):null},e}()}($||($={})),function(e){e.RK=function(){function t(){}return t.Kg=function(t,i){switch(null==i&&(i=e.ee.og()),t){case 33:return new e.Ta(i);case 322:return new e.zb(i);case 197:return new e.Gh(i);case 550:return new e.de(i);case 1607:return new e.Ua(i);case 1736:return new e.Ea(i);default:throw e.i.ga("invalid argument.")}},t}()}($||($={})),function(e){var t=function(){function t(t,i){this.Qe=e.ja.rf(t,-1),this.va=new e.bu,this.yl=i}return t.prototype.qW=function(e){this.va.At(Math.min(this.Qe.size,e)),this.va.hn(e)},t.prototype.addElement=function(t,i){if(void 0===i)return this.XM(t);i=e.P.truncate(i%this.Qe.size);var r=this.Qe.get(i);return-1==r&&(r=this.va.Qh(),this.Qe.set(i,r)),this.va.addElement(r,t)},t.prototype.XM=function(t){var i=this.yl.ez(t);i=e.P.truncate(i%this.Qe.size);var r=this.Qe.get(i);return-1==r&&(r=this.va.Qh(),this.Qe.set(i,r)),this.va.addElement(r,t)},t.prototype.kd=function(t,i){if(void 0===i)this.CP(t);else{i=e.P.truncate(i%this.Qe.size);var r=this.Qe.get(i);if(-1==r)throw e.i.O();for(var s=this.va.sc(r),n=-1;-1!=s;){var o=this.va.lb(s);this.va.ka(s)==t?(this.va.kd(r,n,s),-1==this.va.sc(r)&&(this.va.dh(r),this.Qe.set(i,-1))):n=s,s=o}}},t.prototype.CP=function(t){var i=this.yl.ez(t);i=e.P.truncate(i%this.Qe.size);var r=this.Qe.get(i);if(-1==r)throw e.i.O();for(var s=this.va.sc(r),n=-1;-1!=s;){var o=this.va.lb(s);this.va.ka(s)==t?(this.va.kd(r,n,s),-1==this.va.sc(r)&&(this.va.dh(r),this.Qe.set(i,-1))):n=s,s=o}},t.prototype.iR=function(t){return t=e.P.truncate(t%this.Qe.size),-1==(t=this.Qe.get(t))?-1:this.va.sc(t)},t.prototype.wR=function(e){return this.va.lb(e)},t.prototype.wd=function(t){var i=this.yl.ez(this.ka(t));i=e.P.truncate(i%this.Qe.size);var r=this.Qe.get(i);if(-1==r)throw e.i.O();for(var s=this.va.sc(r),n=-1;-1!=s;){if(s==t)return this.va.kd(r,n,s),void(-1==this.va.sc(r)&&(this.va.dh(r),this.Qe.set(i,-1)));n=s,s=this.va.lb(s)}throw e.i.O()},t.prototype.ka=function(e){return this.va.ka(e)},t.prototype.clear=function(){this.Qe=e.ja.rf(this.Qe.size,-1),this.va.clear()},t.prototype.size=function(){return this.va.LF()},t}();e.WK=t}($||($={})),function(e){var t=function(){function t(){this.Mi=new e.ad(3),this.va=new e.ad(6),this.hT=!1,this.je=-1}return t.prototype.hl=function(e){this.Mi.kd(e)},t.prototype.Qw=function(){return this.Mi.De()},t.prototype.cv=function(e){this.va.kd(e)},t.prototype.UA=function(){return this.va.De()},t.prototype.PB=function(e,t){this.Mi.T(e,1,t)},t.prototype.ex=function(e,t){this.Mi.T(e,2,t)},t.prototype.UW=function(e,t){this.Mi.T(e,3,t)},t.prototype.NB=function(e,t){this.va.T(e,4,t)},t.prototype.XW=function(e,t){this.va.T(e,3,t)},t.prototype.LJ=function(e,t){this.va.T(e,2,t)},t.prototype.Qh=function(e){var t=this.UA();return this.va.T(t,3,this.je),this.va.T(t,4,0),this.va.T(t,5,e),-1!=this.je&&this.LJ(this.je,t),this.je=t},t.prototype.dh=function(e){this.DE(e);var t=this.va.U(e,2),i=this.va.U(e,3);return-1!=t?this.XW(t,i):this.je=i,-1!=i&&this.LJ(i,t),this.cv(e),i},t.prototype.At=function(e){this.va.Ee(e)},t.prototype.HF=function(e){return this.va.U(e,5)},t.prototype.TW=function(e,t){this.va.T(e,5,t)},t.prototype.addElement=function(e,t){return this.kS(e,t)},t.prototype.kS=function(e,t){var i=this.Qw();this.ex(i,-1),-1==this.va.U(e,0)&&this.va.T(e,0,i);var r=this.va.U(e,1);return this.PB(i,r),-1!=r&&this.ex(r,i),this.va.T(e,1,i),this.setData(i,t),this.NB(e,this.cs(e)+1),this.hT&&this.UW(i,e),i},t.prototype.kd=function(e,t){var i=this.xe(t),r=this.lb(t);return-1!=i?this.ex(i,r):this.va.T(e,0,r),-1!=r?this.PB(r,i):this.va.T(e,1,i),this.hl(t),this.NB(e,this.cs(e)-1),r},t.prototype.hn=function(e){this.Mi.Ee(e)},t.prototype.getData=function(e){return this.Mi.U(e,0)},t.prototype.setData=function(e,t){this.Mi.T(e,0,t)},t.prototype.lb=function(e){return this.Mi.U(e,2)},t.prototype.xe=function(e){return this.Mi.U(e,1)},t.prototype.sc=function(e){return this.va.U(e,0)},t.prototype.Gc=function(e){return this.va.U(e,1)},t.prototype.clear=function(){for(var e=this.je;-1!=e;)e=this.dh(e)},t.prototype.DE=function(e){for(var t=this.Gc(e);-1!=t;){var i=t;t=this.xe(i),this.hl(i)}this.va.T(e,0,-1),this.va.T(e,1,-1),this.NB(e,0)},t.prototype.B=function(){return 0==this.Mi.size},t.prototype.LF=function(){return this.Mi.size},t.prototype.cs=function(e){return this.va.U(e,4)},t.prototype.lz=function(e){return this.va.U(e,3)},t}();e.kp=t}($||($={})),function(e){var t=function(){function t(t){void 0===t?(this.ug=new e.ad(2),this.va=new e.ad(4),this.je=-1,this.Rv=!0):(this.ug=new e.ad(2),this.va=new e.ad(t?4:2),this.je=-1,this.Rv=t)}return t.prototype.hl=function(e){this.ug.kd(e)},t.prototype.Qw=function(){return this.ug.De()},t.prototype.cv=function(e){this.va.kd(e)},t.prototype.UA=function(){return this.va.De()},t.prototype.Qh=function(){var e=this.UA();return this.Rv&&(this.va.T(e,3,this.je),-1!=this.je&&this.va.T(this.je,2,e),this.je=e),e},t.prototype.dh=function(e){for(var t=this.sc(e);-1!=t;){var i=t;t=this.lb(t),this.hl(i)}this.Rv&&(t=this.va.U(e,2),i=this.va.U(e,3),-1!=t?this.va.T(t,3,i):this.je=i,-1!=i&&this.va.T(i,2,t)),this.cv(e)},t.prototype.At=function(e){this.va.Ee(e)},t.prototype.addElement=function(e,t){var i=this.va.U(e,1),r=this.Qw();return-1!=i?this.ug.T(i,1,r):this.va.T(e,0,r),this.va.T(e,1,r),this.ug.T(r,0,t),r},t.prototype.hn=function(e){this.ug.Ee(e)},t.prototype.kd=function(e,t,i){-1!=t?(this.ug.T(t,1,this.ug.U(i,1)),this.va.U(e,1)==i&&this.va.T(e,1,t)):(this.va.T(e,0,this.ug.U(i,1)),this.va.U(e,1)==i&&this.va.T(e,1,-1)),this.hl(i)},t.prototype.By=function(e,t){var i=this.va.U(e,1),r=this.va.U(t,0);-1!=r&&(-1!=i?this.ug.T(i,1,r):this.va.T(e,0,r),this.va.T(e,1,this.va.U(t,1))),this.Rv&&(e=this.va.U(t,2),i=this.va.U(t,3),-1!=e?this.va.T(e,3,i):this.je=i,-1!=i&&this.va.T(i,2,e)),this.cv(t)},t.prototype.ka=function(e){return this.ug.U(e,0)},t.prototype.Tj=function(e,t){this.ug.T(e,0,t)},t.prototype.lb=function(e){return this.ug.U(e,1)},t.prototype.sc=function(e){return this.va.U(e,0)},t.prototype.Kn=function(e){return this.ka(this.sc(e))},t.prototype.clear=function(){this.ug.nj(!0),this.va.nj(!0),this.je=-1},t.prototype.B=function(){return 0==this.ug.size},t.prototype.LF=function(){return this.ug.size},t.prototype.lz=function(e){return this.va.U(e,3)},t}();e.bu=t}($||($={})),function(e){e.ta=function(){function t(){}return t.Xd=function(e,t,i){return t=t.zr(),e=null!=e&&void 0!==e.Yd?e.Yd(0):0,i&&(t*=4,e*=1.1),Math.max(e,t)},t.Gr=function(e){return 2*Math.sqrt(2)*e},t.jN=function(e){return Math.sqrt(2)*e},t.lj=function(i,r,s){var n=new e.l;return r.A(n),t.Xd(i,n,s)},t.oE=function(e,t,i){return t=t.Ug(1,0).zr(),e=null!=e?e.Yd(1):0,i&&(t*=4,e*=1.1),Math.max(e,t)},t.nv=function(t,i){var r=new e.l;return t.yc(r),t=new e.l,i.yc(t),r.$b(t),r},t.QN=function(t){var i=new e.l;if(t.yc(i),i.B())return null;var r=new e.eu(i,8),s=-1,n=new e.l,o=!1;do{for(var a=0,l=t.ea();a<l;a++){if(t.Sj(a,n),-1==(s=r.Ez(a,n,s))){if(o)throw e.i.ga("internal error");t.Ap(i,!1),o=!0,r.reset(i,8);break}o=!1}}while(o);return r},t.fE=function(t){var i=new e.l;t.yc(i);for(var r=new e.eu(i,8),s=-1,n=t.Ha(),o=new e.l,a=!1;n.ab();)for(;n.Ia();){var l=n.ia(),h=n.xb();if(l.A(o),-1==(s=r.Ez(h,o,s))){if(a)throw e.i.Ra();t.Ap(i,!1),a=!0,r.reset(i,8),n.$i();break}}return r},t.kj=function(t,i){var r=new e.l;t.yc(r);for(var s=new e.eu(r,8),n=-1,o=new e.l,a=t.Ha(),l=!1;a.ab();)for(;a.Ia();){var h=a.ia(),c=a.xb();if(h.A(o),o.isIntersecting(i)&&-1==(n=s.Ez(c,o,n))){if(l)throw e.i.ga("internal error.");t.Ap(r,!1),l=!0,s.reset(r,8),a.$i();break}}return s},t.gE=function(t,i){for(var r=new e.eu(i,8),s=new e.h,n=!1,o=new e.l,a=0;a<t.I();a++)if(t.D(a,s),i.contains(s)&&(o.L(s),-1==r.wj(a,o))){if(n)throw e.i.Ra();n=!0,a=new e.l,t.Ap(a,!1),r.reset(a,8),a=-1}return r},t.dR=function(t,i,r){var s=new e.l,n=new e.l;t.yc(s),i.yc(n),s.X(r,r),n.X(r,r);var o=new e.l;o.L(s),o.Fa(n),t=t.Ha(),i=i.Ha();var a=new e.qC;a.UB(r);var l=!1;for(a.hK();t.ab();)for(;t.Ia();)t.ia().A(s),s.isIntersecting(o)&&(l=!0,(r=new e.l).L(s),a.AD(t.xb(),r));if(a.aF(),!l)return null;for(s=!1,a.gK();i.ab();)for(;i.Ia();)i.ia().A(n),n.isIntersecting(o)&&(s=!0,(r=new e.l).L(n),a.wD(i.xb(),r));return a.$E(),s?a:null},t.eR=function(t,i,r,s,n){var o=t.K(),a=i.K(),l=new e.l,h=new e.l;t.yc(l),i.yc(h),l.X(r,r),h.X(r,r);var c=new e.l;c.L(l),c.Fa(h);var u=new e.qC;u.UB(r);var p=!1;u.hK();var d=0;for(r=t.ea();d<r;d++)s&&1736==o&&!t.Fv(d)||(t.Sj(d,l),l.isIntersecting(c)&&(p=!0,u.AD(d,l)));if(u.aF(),!p)return null;for(t=!1,u.gK(),s=0,r=i.ea();s<r;s++)n&&1736==a&&!i.Fv(s)||(i.Sj(s,h),h.isIntersecting(c)&&(t=!0,u.wD(s,h)));return u.$E(),t?u:null},t.Tu=function(t,i,r){if(t!=i)for(var s=0;s<r;s++)null==t[s]?t[s]=e.h.bl(i[s]):t[s].N(i[s])},t.Dy=function(e,t,i,r){var s=0;for(r+=0;s<r;i++,s++)null==e[s]&&(e[s]=[0,0]),e[s][0]=t[i].x,e[s][1]=t[i].y},t.Cy=function(t,i,r,s){var n=i,o=0;for(i=s+i;n<i;o++,n++)null==t[n]?t[n]=e.h.construct(r[o][0],r[o][1]):t[n].na(r[o][0],r[o][1])},t.cP=function(t,i,r){if(t!=i)for(var s=0;s<r;s++)null==t[s]?t[s]=new e.Ta(i[s]):i[s].copyTo(t[s])},t.nE=function(e,t,i,r){var s=0;return null!=e&&(s=e.Yd(0),r&&!i||null==e||(s+=1.01*e.pz(0))),i&&(t*=4,s*=1.01),Math.max(s,t)},t.ny=function(e,i,r){return t.nE(e,i.zr(),r,!1)},t.ZN=function(i,r){var s=new e.l;return r.A(s),t.ny(i,s,!0)},t.oy=function(e,i){return t.nE(e,i.zr(),!1,!0)},t.Iu=function(i,r){var s=new e.l;return r.A(s),t.oy(i,s)},t.sG=function(t,i,r,s){s*=s;var n=new e.h;if(n.vc(t,i),(t=new e.h).vc(r,i),i=n.Sk(),r=t.Sk(),i<=s&&r<=s)return!0;var o=e.mc.nx(n.xi(t));return(o<=s*i||o<=s*r)&&0<=n.Rh(t)},t.WJ=function(t,i,r,s){for(var n=0;n<i;n++){var o=t[n].y,a=e.P.Rk(o,r,s);a!=o&&(t[n].y=a)}},t}()}($||($={})),function(e){var t,i,r=function(){function e(e){this.Za=e}return e.prototype.compare=function(e,t,i){e=e.ka(i),i=this.Za.nk(t);var r=this.Za.nk(e);return i<r?-1:i==r?o.iq(t)&&o.Hv(e)?-1:o.iq(e)&&o.Hv(t)?1:0:1},e}(),s=function(){function e(e){this.Za=e}return e.prototype.qr=function(e,t,i){this.Za.uX(i,e,t)},e.prototype.bq=function(e){return this.Za.nk(e)},e}();(i=t||(t={}))[i.initialize=0]="initialize",i[i.pIn=1]="pIn",i[i.pL=2]="pL",i[i.pR=3]="pR",i[i.pT=4]="pT",i[i.right=5]="right",i[i.left=6]="left",i[i.all=7]="all";var n=function(){function t(){this.Za=null,this.Ri=new e.Oc,this.ii=new e.ja(0),this.sg=[0,0]}return t.prototype.Yi=function(e,t){this.Ri.pa=e.pa-t,this.Ri.wa=e.wa+t,this.ii.resize(0),this.he=0,this.sg[0]=0},t.prototype.yB=function(t,i,r){if(t>i)throw e.i.O();this.Ri.pa=t-r,this.Ri.wa=i+r,this.ii.resize(0),this.he=0,this.sg[0]=0},t.prototype.Vo=function(e,t){this.Ri.pa=e-t,this.Ri.wa=e+t,this.ii.resize(0),this.he=0,this.sg[0]=0},t.prototype.next=function(){if(!this.Za.nq)throw e.i.Hb();if(0>this.he)return-1;for(var t=!0;t;)switch(this.sg[this.he]){case 1:t=this.vU();break;case 2:t=this.wU();break;case 3:t=this.xU();break;case 4:t=this.yU();break;case 5:t=this.vW();break;case 6:t=this.aT();break;case 7:t=this.lN();break;case 0:t=this.Bz();break;default:throw e.i.Ra()}return-1!=this.Pg?this.Op()>>1:-1},t.construct=function(e){var i=new t;return i.Za=e,i.ii.Jb(20),i.he=-1,i},t.prototype.Bz=function(){return this.Pg=this.nH=this.Ni=this.Mc=-1,null!=this.Za.me&&0<this.Za.me.size?(this.sg[0]=1,this.Ni=this.Za.kf,!0):(this.he=-1,!1)},t.prototype.vU=function(){if(this.Mc=this.Ni,-1==this.Mc)return this.Pg=this.he=-1,!1;var e=this.Za.Pp(this.Mc);return this.Ri.wa<e?(e=this.Za.mk(this.Mc),this.Ni=this.Za.rj(this.Mc),-1!=e&&(this.fi=this.Za.ml(e),this.sg[++this.he]=6),!0):e<this.Ri.pa?(e=this.Za.mk(this.Mc),this.Ni=this.Za.lk(this.Mc),-1!=e&&(this.fi=this.Za.$r(e),this.sg[++this.he]=5),!0):(this.sg[this.he]=2,this.nH=this.Mc,e=this.Za.mk(this.Mc),this.Ni=this.Za.rj(this.Mc),-1!=e&&(this.fi=this.Za.ml(e),this.sg[++this.he]=7),!0)},t.prototype.wU=function(){if(this.Mc=this.Ni,-1==this.Mc)return this.sg[this.he]=3,this.Ni=this.Za.lk(this.nH),!0;if(this.Za.Pp(this.Mc)<this.Ri.pa){var e=this.Za.mk(this.Mc);return this.Ni=this.Za.lk(this.Mc),-1!=e&&(this.fi=this.Za.$r(e),this.sg[++this.he]=5),!0}return e=this.Za.mk(this.Mc),this.Ni=this.Za.rj(this.Mc),-1!=e&&(this.fi=this.Za.ml(e),this.sg[++this.he]=7),-1!=(e=this.Za.lk(this.Mc))&&this.ii.add(e),!0},t.prototype.xU=function(){if(this.Mc=this.Ni,-1==this.Mc)return this.sg[this.he]=4,!0;if(this.Ri.wa<this.Za.Pp(this.Mc)){var e=this.Za.mk(this.Mc);return this.Ni=this.Za.rj(this.Mc),-1!=e&&(this.fi=this.Za.ml(e),this.sg[++this.he]=6),!0}return e=this.Za.mk(this.Mc),this.Ni=this.Za.lk(this.Mc),-1!=e&&(this.fi=this.Za.ml(e),this.sg[++this.he]=7),-1!=(e=this.Za.rj(this.Mc))&&this.ii.add(e),!0},t.prototype.yU=function(){if(0==this.ii.size)return this.Pg=this.he=-1,!1;this.Mc=this.ii.get(this.ii.size-1),this.ii.resize(this.ii.size-1);var e=this.Za.mk(this.Mc);return-1!=e&&(this.fi=this.Za.ml(e),this.sg[++this.he]=7),-1!=this.Za.rj(this.Mc)&&this.ii.add(this.Za.rj(this.Mc)),-1!=this.Za.lk(this.Mc)&&this.ii.add(this.Za.lk(this.Mc)),!0},t.prototype.aT=function(){return this.Pg=this.fi,-1!=this.Pg&&o.iq(this.Op())&&this.Za.nk(this.Op())<=this.Ri.wa?(this.fi=this.KF(),!1):(this.he--,!0)},t.prototype.vW=function(){return this.Pg=this.fi,-1!=this.Pg&&o.Hv(this.Op())&&this.Za.nk(this.Op())>=this.Ri.pa?(this.fi=this.HR(),!1):(this.he--,!0)},t.prototype.lN=function(){return this.Pg=this.fi,-1!=this.Pg&&o.iq(this.Op())?(this.fi=this.KF(),!1):(this.he--,!0)},t.prototype.KF=function(){return this.Za.Tf?this.Za.ag.lb(this.Pg):this.Za.Ui.lb(this.Pg)},t.prototype.HR=function(){return this.Za.Tf?this.Za.ag.xe(this.Pg):this.Za.Ui.xe(this.Pg)},t.prototype.Op=function(){return this.Za.Tf?this.Za.ag.ka(this.Pg):this.Za.Ui.getData(this.Pg)},t}();e.tY=n;var o=function(){function t(e){this.Cm=this.ai=this.ag=this.Ui=this.Mm=this.Fj=this.me=this.Gj=null,this.Tf=e,this.nq=this.Tv=!1}return t.prototype.mr=function(){this.Nk(!0)},t.prototype.Dr=function(t,i){if(!this.Tv)throw e.i.Hb();this.Gj.push(new e.Oc(t,i))},t.prototype.Hp=function(){if(!this.Tv)throw e.i.ga("invalid call");this.Tv=!1,this.nq=!0,this.Tf||(this.mS(),this.$v=this.Gj.length)},t.prototype.wj=function(t){if(!this.Tf||!this.nq)throw e.i.O("invalid call");if(-1==this.kf){var i=this.Gj.length;if(this.dA){var r=new e.ja(0);r.Jb(2*i),this.UI(r),this.ai.Jb(2*i),this.ai.resize(0),this.TI(r),this.Mm.resize(i,-1),this.Mm.Xj(-1,0,i),this.dA=!1}else this.Mm.Xj(-1,0,i);this.kf=this.Vu()}i=this.hG(t<<1,this.kf),r=this.ag.addElement(1+(t<<1),this.rz(i)),this.NJ(i,r),this.Mm.set(t,i),this.$v++},t.prototype.remove=function(t){if(!this.Tf||!this.nq)throw e.i.ga("invalid call");var i=this.Mm.get(t);if(-1==i)throw e.i.O("the interval does not exist in the interval tree");this.Mm.set(t,-1),this.$v--;var r=this.rz(i),s=this.ag.QR(r);this.ag.wd(this.nR(i),r),this.ag.wd(this.KR(i),r),0==(t=this.ag.size(r))&&(this.ag.EP(r),this.RJ(s,-1)),this.Fj.kd(i),r=this.MF(s);var n=this.rj(s),o=this.lk(s);for(i=0;!(0<t||s==this.kf||-1!=n&&-1!=o);)s==this.rj(r)?-1!=n?(this.Ok(r,n),this.Vj(n,r),this.Ok(s,-1)):-1!=o?(this.Ok(r,o),this.Vj(o,r),this.Qk(s,-1)):this.Ok(r,-1):-1!=n?(this.Qk(r,n),this.Vj(n,r),this.Ok(s,-1)):-1!=o?(this.Qk(r,o),this.Vj(o,r),this.Qk(s,-1)):this.Qk(r,-1),this.Vj(s,-1),i++,s=r,t=-1!=(r=this.mk(s))?this.ag.size(r):0,n=this.rj(s),o=this.lk(s),r=this.MF(s)},t.prototype.reset=function(){if(!this.Tf||!this.nq)throw e.i.O("invalid call");this.Nk(!1)},t.prototype.size=function(){return this.$v},t.prototype.getIterator=function(){return n.construct(this)},t.prototype.UI=function(e){for(var t=this.Gj.length,i=0;i<2*t;i++)e.add(i);this.vX(e,2*t)},t.prototype.TI=function(e){for(var t=NaN,i=0;i<e.size;i++){var r=e.get(i),s=this.nk(r);s!=t&&(this.ai.add(r),t=s)}},t.prototype.mS=function(){var t=this.Gj.length,i=new e.ja(0);i.Jb(2*t),this.UI(i),this.ai.Jb(2*t),this.ai.resize(0),this.TI(i),this.Fj.Ee(t),this.Ui.hn(2*t);var r=e.Zc.Ph(t);for(r.Xj(-1,0,t),this.kf=this.Vu(),t=0;t<i.size;t++){var s=i.get(t),n=r.get(s>>1);-1!=n?this.NJ(n,this.Ui.addElement(this.rz(n),s)):(n=this.hG(s,this.kf),r.set(s>>1,n))}},t.prototype.hG=function(t,i){var r=i,s=i,n=-1,o=0,a=this.ai.size-1,l=0,h=t>>1,c=NaN,u=NaN,p=!0,d=this.vR(h);for(h=this.sR(h);p;){o<a?(l=o+e.P.truncate((a-o)/2),-1==this.bz(r)&&this.xJ(r,this.ai.get(l),this.ai.get(l+1))):-1==this.bz(r)&&this.xJ(r,this.ai.get(o),this.ai.get(o));var f=this.Pp(r);if(h<f)-1!=i&&(i==r?(s=r,c=f,u=-1!=(i=this.rj(r))?this.Pp(i):NaN):u>f&&(f<c?this.Ok(s,r):this.Qk(s,r),this.Qk(r,i),this.Tf&&(this.Vj(r,s),this.Vj(i,r)),s=r,c=f,i=-1,u=NaN)),-1==(a=this.oR(r))&&(a=this.Vu(),this.RW(r,a)),r=a,a=l;else if(d>f)-1!=i&&(i==r?(s=r,c=f,u=-1!=(i=this.lk(r))?this.Pp(i):NaN):u<f&&(f<c?this.Ok(s,r):this.Qk(s,r),this.Ok(r,i),this.Tf&&(this.Vj(r,s),this.Vj(i,r)),s=r,c=f,i=-1,u=NaN)),-1==(o=this.LR(r))&&(o=this.Vu(),this.bX(r,o)),r=o,o=l+1;else{-1==(p=this.mk(r))&&(p=this.rP(r),this.RJ(r,p));var y=this.YM(p,t);n=this.pP(),this.eX(n,p),this.QW(n,y),r!=i&&(f<c?this.Ok(s,r):this.Qk(s,r),this.Tf&&this.Vj(r,s),-1!=i&&(u<f?this.Ok(r,i):this.Qk(r,i),this.Tf&&this.Vj(i,r))),p=!1}}return n},t.prototype.Vu=function(){return this.me.De()},t.prototype.rP=function(e){return this.Tf?this.ag.Qr(e):this.Ui.Qh(e)},t.prototype.pP=function(){return this.Fj.De()},t.prototype.Nk=function(t){t?(this.Tv=this.dA=!0,this.nq=!1,null==this.ai?this.ai=e.Zc.Ph(0):this.ai.resize(0),null==this.Gj?this.Gj=[]:this.Gj.length=0):this.dA=!1,this.Tf?null==this.Mm?(this.Mm=e.Zc.Ph(0),this.ag=new e.Yj,this.ag.Wo(new r(this))):this.ag.clear():null==this.Ui?this.Ui=new e.kp:this.Ui.clear(),null==this.me?(this.Fj=new e.ad(3),this.me=new e.ad(this.Tf?8:7)):(this.Fj.nj(!1),this.me.nj(!1)),this.kf=-1,this.$v=0},t.prototype.xJ=function(e,t,i){this.KW(e,t),this.LW(e,i)},t.prototype.Pp=function(e){var t=this.bz(e);return-1==t?NaN:(t=this.nk(t))==(e=this.nk(this.ZQ(e)))?t:.5*(t+e)},t.prototype.KW=function(e,t){this.me.T(e,0,t)},t.prototype.LW=function(e,t){this.me.T(e,1,t)},t.prototype.RW=function(e,t){this.me.T(e,3,t)},t.prototype.bX=function(e,t){this.me.T(e,4,t)},t.prototype.RJ=function(e,t){this.me.T(e,2,t)},t.prototype.Ok=function(e,t){this.me.T(e,5,t)},t.prototype.Qk=function(e,t){this.me.T(e,6,t)},t.prototype.Vj=function(e,t){this.me.T(e,7,t)},t.prototype.eX=function(e,t){this.Fj.T(e,0,t)},t.prototype.YM=function(e,t){return this.Tf?this.ag.addElement(t,e):this.Ui.addElement(e,t)},t.prototype.QW=function(e,t){this.Fj.T(e,1,t)},t.prototype.NJ=function(e,t){this.Fj.T(e,2,t)},t.prototype.ml=function(e){return this.Tf?this.ag.sc(e):this.Ui.sc(e)},t.prototype.$r=function(e){return this.Tf?this.ag.Gc(e):this.Ui.Gc(e)},t.iq=function(e){return 0==(1&e)},t.Hv=function(e){return 1==(1&e)},t.prototype.bz=function(e){return this.me.U(e,0)},t.prototype.ZQ=function(e){return this.me.U(e,1)},t.prototype.mk=function(e){return this.me.U(e,2)},t.prototype.oR=function(e){return this.me.U(e,3)},t.prototype.LR=function(e){return this.me.U(e,4)},t.prototype.rj=function(e){return this.me.U(e,5)},t.prototype.lk=function(e){return this.me.U(e,6)},t.prototype.MF=function(e){return this.me.U(e,7)},t.prototype.rz=function(e){return this.Fj.U(e,0)},t.prototype.nR=function(e){return this.Fj.U(e,1)},t.prototype.KR=function(e){return this.Fj.U(e,2)},t.prototype.vR=function(e){return this.Gj[e].pa},t.prototype.sR=function(e){return this.Gj[e].wa},t.prototype.vX=function(t,i){null==this.Cm&&(this.Cm=new e.Yt);var r=new s(this);this.Cm.sort(t,0,i,r)},t.prototype.uX=function(e,i,r){var s=this;e.Wd(i,r,(function(e,i){var r=s.nk(e),n=s.nk(i);return r<n||r==n&&t.iq(e)&&t.Hv(i)?-1:1}))},t.prototype.nk=function(e){var i=this.Gj[e>>1];return t.iq(e)?i.pa:i.wa},t}();e.ur=o}($||($={})),function(e){var t=function(){function t(t){if(null==t)throw e.i.ga("Invalid arguement");this.hf=t;var i=t.fR();i.ZR()?t.ef.AG()?this.mo=e.ti.PannableFold:this.mo=e.ti.Clip:this.mo=e.ti.DontClip,i.$R()?t.Zf.AG()?this.Sm=e.ti.PannableFold:this.Sm=e.ti.Clip:this.Sm=e.ti.DontClip,this.Dm=i.Lu,this.eH=i.Gy,t=this.hf.kH,this.TG=t.js(2147483648),this.Vv=t.js(1073741824)}return t.Ah=function(e,t,i){return t.xw.Ah(e,i)},t.St=function(e,t,i,r){return e.xw.St(t,i,r)},t.Rt=function(e,t,i,r){if(i=0>i?t.length:i,(e=e.xw.St(t,i,r))==i)return e;for(var s=t=0;s<i;s++){var n=r[s];n.isNaN()||(t<s&&r[t].N(n),t++)}for(;t<i;t++)r[t].Sc();return e},t.transform=function(i,r,s,n,o){if(i.isIdentity())return e.ta.cP(n,r,s),s;for(var a=[],l=0,h=0;h<s;){for(var c=Math.min(a.length,s-h),u=h,p=0;u<c;u++,p++)null==a[p]?a[p]=r[u].D():r[u].D(a[p]);var d=o?t.Rt(i,a,c,a):t.St(i,a,c,a);for(p=u=0;u<d;u++,p++)null==n[h]&&(n[h]=new e.Ta(r[h])),n[h].Db(a[p]);h+=c,l+=d}return l},t.prototype.St=function(t,i,r){if(this.hf.isIdentity())return t!=r&&e.ta.Tu(r,t,i),i;var s=this.hf.ef,n=this.hf.Zf,o=s.Tb(),a=n.Tb();if(0==o&&o===a){var l=s.Sp();return n=l/(n=n.Sp()),(l=new e.Ed).It(n,n),l.TX(t,i,r),i}if(l=e.P.Gu(Math.min(i,64)),3==o){var h=s.Ki;o=(s=h.fk()).Tb(),r!=t&&e.ta.Tu(r,t,i),e.Ab.al(h,r,i,!0),h.Rt(e.dm.forward,r,i),e.Ab.$k(h,r,i,!0)}if(3==o||3===a)throw e.i.ga("image: transform_in_place_");if(2==o)this.mo==e.ti.Clip?(r!=t&&e.ta.Tu(r,t,i),t=s.ol(),e.Ab.FS(t,s,r,i)):(r!=t&&e.ta.Tu(r,t,i),s.Xc()&&(o=s.Yd(0),h=s.Le(),e.Ab.sX(r,i,h,o),e.Ab.iF(r,i,s,0))),e.Ab.AL(s,r,i,l);else for(o=s.Yd(0),h=s.Le(),s=0;s<i;s++)e.Ab.tX(t[s],h,o,r[s]);for(e.Ab.yL(this.hf,r,i,l),t=0,(a=2==a)?t=n.Ai():isNaN(this.Dm)||(t=this.Dm),a&&this.Sm!=e.ti.Clip||e.Ab.iF(r,i,n.tc(),t),a&&(e.Ab.qG(r,i,n,this.Sm),e.Ab.zL(n,r,i,l)),t=i,s=0;s<i;++s)r[s].isNaN()&&t--;return t},t.prototype.Ah=function(t,i){if(this.hf.isIdentity()||t.B())return t;if(33==t.K())return this.OI(t);var r=this.hf.ef,s=this.hf.Zf,n=r.Tb(),o=s.Tb();if(0==n&&n==o)return i=r.Sp(),i/=s=s.Sp(),(s=new e.Ed).It(i,i),(t=e.ba.ig(t)).Pc(s),t;switch(t.K()){case 1607:case 1736:t=this.MI(t,i);break;case 550:t=this.WV(t,i);break;case 197:t=this.VV(t,i);break;default:throw e.i.ga("")}return t},t.prototype.OI=function(t){var i=t.D(),r=[];return r[0]=i,this.St(r,1,r),(t=new e.Ta(t)).Db(r[0]),t},t.prototype.MI=function(t,i){if(t.vm())throw e.i.ga("curves not supported");var r=t.K();if(1736==r)return this.XV(t,i);if(1607==r)return this.YV(t,i);throw e.i.ga("projectMultiPath")},t.prototype.XV=function(i,r){var s=this.hf.ef,n=this.hf.Zf,o=s.Tb(),a=n.Tb(),l=e.P.Gu(Math.min(i.I(),64)),h=e.Ea.ig(i);3==o&&(o=(s=(i=s.Ki).fk()).Tb(),h=i.al(h,!0),this.yp(i,e.dm.forward,h),h=i.$k(h,!0)),i=null,3==a&&(a=(n=(i=n.Ki).fk()).Tb());var c=2==o,u=2==a,p=u?n.tc():n,d=!u&&!this.Vv;a=!1;var f=h;if(c){if((f=e.Ab.LI(f,s,this.mo,r)).B())return f}else{if(h=new e.l,f.yc(h),o=s.Le(),h.G<o.G||h.H>o.H){var y=e.l.construct(h.v-1,o.G,h.C+1,o.H);if((f=e.si.Pu(f,y,s,NaN,0,r)).B())return f}h.S()>2*o.S()&&(f=e.Ab.Jp(f,-2*o.S(),2*o.S(),s,!0,0,!0,r))}h=this.eH,(o=!isNaN(h))&&(f=e.Zl.local().W(f,h,r)),y=u?n.kk():null;var g=NaN;c&&(g=s.Ai());var m=null!=n.Xr();if(this.TG)c&&(e.Ab.wr(s,g,f,l),o&&(c=s.ih(),h*=(g=s.tc().ih())/c)),e.Ab.vr(this.hf,f,d,l),o&&(c=s.tc().ih(),h*=(g=n.tc().ih())/c),s=f;else{var v=new e.Ua(f.description);v.vD(f),c&&(e.Ab.wr(s,g,v,l),o&&(c=s.ih(),h*=(g=s.tc().ih())/c)),e.Ab.vr(this.hf,v,d,l),o&&(c=s.tc().rm(),h*=(g=n.tc().rm())/c),d=NaN,u?(y=n.kk(),d=n.Ai()):isNaN(this.Dm)||(d=this.Dm),c=t.uv(s)|t.uv(n),g=10*p.Yd(0),this.Vv&&(c=3,g=0),s=e.Ab.MQ(f,s,v,p,d,r,c,g)}return m&&(s=e.Ab.PD(s,n,r)),u&&(a||(u=p.Le().S(),s.Ug(0,0).S()>=u-p.Yd(0)&&(p=y.getNorthPoleLocation(),u=y.getSouthPoleLocation(),f=y.getNorthPoleGeometry(),y=y.getSouthPoleGeometry(),d=0,f==e.Eg.PE_POLE_POINT&&p!=e.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(d=1),y==e.Eg.PE_POLE_POINT&&u!=e.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(d|=2),0!==d&&(a=!0))),s=e.Ab.Hz(s,n,this.Sm,r),o&&(s=e.Zl.local().W(s,h,r)),e.Ab.Jx(n,s,l)),s.B()||(a&&(s=e.$l.local().W(s,n,!1,r)),null!=i&&(s=i.$k(s,!1),this.yp(i,e.dm.reverse,s),s=i.al(s,!1))),s},t.uv=function(t){if(2!=t.Tb())return 0;var i=0,r=t.kk();t=r.getNorthPoleLocation();var s=r.getSouthPoleLocation(),n=r.getNorthPoleGeometry();return r=r.getSouthPoleGeometry(),n==e.Eg.PE_POLE_POINT&&t!=e.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(i=1),r==e.Eg.PE_POLE_POINT&&s!=e.Eg.PE_POLE_OUTSIDE_BOUNDARY&&(i|=2),i},t.prototype.YV=function(i,r){var s=this.hf.ef,n=this.hf.Zf,o=s.Tb(),a=n.Tb(),l=e.P.Gu(Math.min(i.I(),64)),h=e.Ua.ig(i);3==o&&(o=(s=(i=s.Ki).fk()).Tb(),h=i.al(h,!0),this.yp(i,e.dm.forward,h),h=i.$k(h,!0)),i=null,3==a&&(a=(n=(i=n.Ki).fk()).Tb());var c=2==o;o=(a=2==a)?n.tc():n;var u=!a&&!this.Vv;if(c){if((h=e.Ab.LI(h,s,this.mo,r)).B())return h}else{var p=new e.l;h.yc(p);var d=s.Le();if((p.G<d.G||p.H>d.H)&&(p=e.l.construct(p.v-1,d.G,p.C+1,d.H),(h=e.si.Pu(h,p,s,NaN,0,r)).B()))return h}var f=NaN;c&&(f=s.Ai()),p=null!=n.Xr(),d=this.eH;var y=!isNaN(d);if(y&&(h=e.Zl.local().W(h,d,r)),this.TG)c&&e.Ab.wr(s,f,h,l),y&&(c=s.ih(),d*=(f=s.tc().ih())/c),e.Ab.vr(this.hf,h,u,l),y&&(c=s.tc().ih(),d*=(f=n.tc().ih())/c),s=h;else{var g=new e.Ua(h.description);g.vD(h),c&&(e.Ab.wr(s,f,g,l),y&&(c=s.ih(),d*=(f=s.tc().ih())/c)),e.Ab.vr(this.hf,g,u,l),y&&(c=s.tc().ih(),d*=(f=n.tc().ih())/c),u=NaN,a?u=n.Ai():isNaN(this.Dm)||(u=this.Dm),c=t.uv(s)|t.uv(n),f=10*o.Yd(0),this.Vv&&(c=3,f=0),s=e.Ab.NQ(h,s,g,o,u,r,c,f)}return p&&(s=e.Ab.PD(s,n,r)),a&&(s=e.Ab.Hz(s,n,this.Sm,r),y&&(s=e.Zl.local().W(s,d,r)),e.Ab.Jx(n,s,l)),s.B()||null!=i&&(s=i.$k(s,!1),this.yp(i,e.dm.reverse,s),s=i.al(s,!1)),s},t.prototype.VV=function(t,i){var r=(t.da()+t.S())/400;return 0!=r?(r=e.Zl.local().W(t,r,i),r=this.MI(r,i),i=t.Ja(),r.dn(i)):(i=new e.Ta(t.Kp()),r=this.OI(i),i=t.Ja(),r.B()?i.Pa():(t.copyTo(i),t=r.D(),i.L(t.x,t.y,t.x,t.y))),i},t.prototype.WV=function(t,i){t=e.ba.ig(t);var r=this.hf.ef,s=this.hf.Zf,n=r.Tb(),o=s.Tb(),a=e.P.Gu(Math.min(t.I(),64));if(3==n){var l=r.Ki;n=(r=l.fk()).Tb(),t=l.$k(t,!0),this.yp(l,e.dm.forward,t),t=l.al(t,!0)}if(2==n){if(this.mo==e.ti.Clip?t=e.Wk.local().W(t,r.ol(),r,i):r.Xc()&&(n=new e.l,t.yc(n),r.Le().contains(n)||(this.mo==e.ti.PannableFold&&(t=e.Ab.mj(t,r)),e.Ab.Kt(t,r.Le(),r.Yd(0),!0),t=e.Ab.Gn(t,r,0,!0,0,i))),t.B())return t;e.Ab.wr(r,0,t,a)}else e.Ab.Kt(t,r.Le(),r.Yd(0),!0);return e.Ab.vr(this.hf,t,!1,a),r=0,n=!1,l=null,3==o&&(n=!0,o=(s=(l=s.Ki).fk()).Tb()),(o=2==o)?r=s.Ai():isNaN(this.Dm)||(r=this.Dm),o&&this.Sm!=e.ti.Clip||(t=e.Ab.Gn(t,s.tc(),r,!1,0,i)),o&&(t=e.Ab.Hz(t,s,this.Sm,i),e.Ab.Jx(s,t,a),t.B())||n&&(t=l.$k(t,!0),this.yp(l,e.dm.reverse,t),t=l.al(t,!0)),t},t.prototype.yp=function(t,i,r){var s=r.I();if(0!=s){for(var n=r.vb(0),o=e.P.lg(200,0),a=[],l=0;l<s;){var h=Math.min(100,s-l);n.Ww(2*l,2*h,o,2,!0);for(var c=0;c<h;++c)a[c]=e.h.construct(o[2*l],o[2*l+1]);t.Rt(i,a,h),l+=h}r.Qc(1993)}},t.Py=function(t,i,r){if(null==t||null==i||!i.Xc())throw e.i.ga("Invalid Arguement");if(t.B())return t;var s=t.K();return 197==s?(s=new e.Ea(t.description)).bd(t,!1):e.ba.zd(s)?(s=new e.Ua(t.description)).oc(t,!0):s=t,(s=e.Ab.mj(s,i)).B()?s:e.Ab.Gn(s,i,0,s!=t,0,r)},t.oj=function(i,r,s,n){if(null==i||null==r||!r.Xc())throw e.i.ga("Invalid Arguement");if(i.B())return i;var o=i.K();if(e.ba.Ic(o)){i=e.Ab.mj(i,r),o=new e.l,i.A(o);for(var a=e.ta.ny(r,o,!1),l=r.hh(),h=Math.floor((o.v-l.v)/l.S())*l.S()+l.v;h<o.C;)h>o.v+a&&h<o.C-a&&(i=e.Ab.lS(i,r,s,h)),h+=l.S()}else{if(197==o)return(o=new e.Ea(i.description)).bd(i,!1),t.oj(o,r,s,n);if(e.ba.zd(o))return(o=new e.Ua(i.description)).oc(i,!0),t.oj(o,r,s,n)}return t.Py(i,r,n)},t}();e.cu=t}($||($={})),function(e){var t=function(t){function i(i,r,s,n){var o=t.call(this)||this;return void 0===i?o.description=e.ee.og():void 0===s?o.description=i:(o.description=e.ee.og(),o.SB(i,r),o.Sl(s,n)),o}return Z(i,t),i.prototype.K=function(){return 322},i.prototype.Rb=function(){var e=this.sa-this.qa,t=this.oa-this.ma;return Math.sqrt(e*e+t*t)},i.prototype.Ci=function(e){var t=this.sa-this.qa,i=this.oa-this.ma;return Math.sqrt(t*t+i*i)<=e},i.prototype.Qn=function(){return!1},i.prototype.jg=function(){var t=new e.h;return t.vc(this.xc(),this.ac()),t},i.VO=function(e,t){return new i(e.x,e.y,t.x,t.y)},i.prototype.dn=function(t){t.Pa(),t.kg(this.description);var i=new e.l;this.A(i),t.Yo(i),i=1;for(var r=this.description.Ba;i<r;i++)for(var s=this.description.qd(i),n=e.ua.Wa(s);i<n;i++){var o=this.Ug(s,0);t.setInterval(s,0,o)}},i.prototype.A=function(e){e.L(this.sa,this.oa,this.qa,this.ma),e.normalize()},i.prototype.Ro=function(e){e.Pa(),e.$b(this.sa,this.oa,this.Pd(0,1,0)),e.$b(this.qa,this.ma,this.Pd(1,1,0))},i.prototype.Pc=function(t){if(t instanceof e.Ed){this.wc();var i=new e.h;i.x=this.sa,i.y=this.oa,t.Fh(i,i),this.sa=i.x,this.oa=i.y,i.x=this.qa,i.y=this.ma,t.Fh(i,i),this.qa=i.x,this.ma=i.y}else this.wc(),(i=new e.Od).x=this.sa,i.y=this.oa,i.z=this.Pd(0,1,0),i=t.gp(i),this.sa=i.x,this.oa=i.y,this.vn(0,1,0,i.z),i.x=this.qa,i.y=this.ma,i.z=this.Pd(1,1,0),i=t.gp(i),this.qa=i.x,this.ma=i.y,this.vn(1,1,0,i.z)},i.prototype.Ja=function(){return new i(this.description)},i.prototype.Rx=function(e,t){return(this.qa-e-(this.sa-e))*(this.ma-t+(this.oa-t))*.5},i.prototype.tx=function(e){return e*this.Rb()},i.prototype.FG=function(e){return e/this.Rb()},i.prototype.vF=function(t){return e.mc.jq(this.sa,this.qa,t)},i.prototype.YQ=function(t){return e.mc.jq(this.oa,this.ma,t)},i.prototype.el=function(t,i){var r=new e.hg;return this.bh(t,i,r),r.get()},i.prototype.bh=function(t,i,r){if(null==r)throw e.i.O();r.Pr(),(r=r.get()).kg(this.description);var s=new e.h;this.ic(t,s),r.SB(s.x,s.y),this.ic(i,s),r.Sl(s.x,s.y),s=1;for(var n=this.description.Ba;s<n;s++)for(var o=this.description.Fd(s),a=e.ua.Wa(o),l=0;l<a;l++){var h=this.Vc(t,o,l);r.RB(o,l,h),h=this.Vc(i,o,l),r.IB(o,l,h)}},i.prototype.Vc=function(t,i,r){if(0==i)return 0==r?this.ic(t).x:this.ic(t).y;switch(e.ua.gz(i)){case 0:return.5>t?this.xv(i,r):this.hv(i,r);case 1:var s=this.xv(i,r);return i=this.hv(i,r),e.mc.jq(s,i,t);case 2:throw e.i.ga("not implemented")}throw e.i.Ra()},i.prototype.fe=function(e,t){var i=this.qa-this.sa,r=this.ma-this.oa,s=i*i+r*r;return 0==s?.5:(e=((e.x-this.sa)*i+(e.y-this.oa)*r)/s,t||(0>e?e=0:1<e&&(e=1)),e)},i.prototype.fq=function(e,t,i,r){if(e){if(0==(e=this.ma-this.oa))return t==this.ma?-1:0;if(0>(t=(t-this.oa)/e)||1<t)return 0;null!=i&&(i[0]=this.vF(t))}else{if(0==(e=this.qa-this.sa))return t==this.qa?-1:0;if(0>(t=(t-this.sa)/e)||1<t)return 0;null!=i&&(i[0]=this.YQ(t))}return null!=r&&(r[0]=t),1},i.prototype.Me=function(e,t){var i=this.ma-this.oa;return 0==i?e==this.ma?t:NaN:(e=(e-this.oa)/i,t=this.vF(e),1==e&&(t=this.qa),t)},i.prototype.su=function(e,t,i){return 0<=this.sp(e.x,e.y,t,i)},i.prototype.wi=function(e,t,i){return 0<=this.sp(e,t,i,!0)},i.prototype.rs=function(e,t){return this.su(e,t,!1)},i.prototype.jI=function(){if(this.ma<this.oa||this.ma==this.oa&&this.qa<this.sa){var e=this.sa;this.sa=this.qa,this.qa=e,e=this.oa,this.oa=this.ma,this.ma=e,e=0;for(var t=this.description.Qq-2;e<t;e++){var i=this.la[e];this.la[e]=this.la[e+t],this.la[e+t]=i}}},i.prototype.vu=function(t,i){(i=e.h.construct(t,i)).sub(this.ac());var r=new e.h;return r.vc(this.xc(),this.ac()),(t=r.xi(i))>(i=8881784197001252e-31*(Math.abs(r.x*i.y)+Math.abs(r.y*i.x)))?-1:t<-i?1:0},i.prototype.sp=function(t,i,r,s){var n=this.sa,o=this.oa,a=t-n,l=i-o;if((a=Math.sqrt(a*a+l*l))<=Math.max(r,6661338147750939e-31*a))return s&&0==a?NaN:0;if(a=t-this.qa,l=i-this.ma,(a=Math.sqrt(a*a+l*l))<=Math.max(r,6661338147750939e-31*a))return s&&0==a?NaN:1;if(a=this.qa-this.sa,l=this.ma-this.oa,0<(s=Math.sqrt(a*a+l*l))){var h=1/s,c=t-n,u=i-o,p=c*(a*=h)+u*(l*=h),d=17763568394002505e-31*(Math.abs(c*a)+Math.abs(u*l)),f=a;if(a=-l,l=f,p<-(d=Math.max(r,d))||p>s+d)return NaN;if(Math.abs(c*a+u*l)<=Math.max(r,17763568394002505e-31*(Math.abs(c*a)+Math.abs(u*l)))&&(.5>=(a=e.P.Rk(p*h,0,1))?(l=this.sa+(this.qa-this.sa)*a,s=this.oa+(this.ma-this.oa)*a):(l=this.qa-(this.qa-this.sa)*(1-a),s=this.ma-(this.ma-this.oa)*(1-a)),e.h.Jy(l,s,t,i)<=r)){if(.5>a){if(e.h.Jy(l,s,n,o)<=r)return 0}else if(e.h.Jy(l,s,this.qa,this.ma)<=r)return 1;return a}}return NaN},i.prototype.Nb=function(e){return null!=e&&(e==this||e.constructor===this.constructor&&this.xM(e))},i.prototype.jD=function(t,i,r){var s=r?this.sa:this.qa;r=r?this.oa:this.ma;var n=new e.h;return n.x=t.qa-s,n.y=t.ma-r,!(i.Rh(n)>6661338147750939e-31*i.YC(n))||(n.x=t.sa-s,n.y=t.oa-r,i.Rh(n)<=6661338147750939e-31*i.YC(n))},i.prototype.iD=function(t){var i=new e.h;return i.x=this.qa-this.sa,i.y=this.ma-this.oa,!!this.jD(t,i,!1)&&(i.Uq(),!!this.jD(t,i,!0))},i.FM=function(e,t){var i=e.vu(t.sa,t.oa),r=e.vu(t.qa,t.ma);return!(0>i&&0>r||0<i&&0<r)&&(i=t.vu(e.sa,e.oa),r=t.vu(e.qa,e.ma),!(0>i&&0>r||0<i&&0<r)&&((i=e.Rb())>(r=t.Rb())?e.iD(t):t.iD(e)))},i.DM=function(t,i,r){var s=e.h.construct(NaN,NaN),n=t.qa-t.sa,o=t.ma-t.oa,a=i.qa-i.sa,l=i.ma-i.oa,h=a*o-n*l;if(0==h)return s;var c=8881784197001252e-31*(Math.abs(a*o)+Math.abs(n*l)),u=i.sa-t.sa,p=i.oa-t.oa,d=a*p-u*l,f=d/h,y=Math.abs(h);return f<-(a=(8881784197001252e-31*(Math.abs(a*p)+Math.abs(u*l))*y+c*Math.abs(d))/(h*h)+2220446049250313e-31*Math.abs(f))||f>1+a||(a=(l=n*p-u*o)/h)<-(n=(8881784197001252e-31*(Math.abs(n*p)+Math.abs(u*o))*y+c*Math.abs(l))/(h*h)+2220446049250313e-31*Math.abs(a))||a>1+n||(f=e.P.Rk(f,0,1),n=e.P.Rk(a,0,1),o=t.ic(f),h=i.ic(n),(c=new e.h).vc(o,h),c.length()>r&&(c.add(o,h),c.scale(.5),f=t.fe(c,!1),n=i.fe(c,!1),t=t.ic(f),i=i.ic(n),t.sub(i),t.length()>r)||s.na(f,n)),s},i.GM=function(e,t,r,s){var n=0;if((e.sa==t.sa&&e.oa==t.oa||e.sa==t.qa&&e.oa==t.ma)&&(n++,!s))return 1;if(e.qa==t.sa&&e.ma==t.oa||e.qa==t.qa&&e.ma==t.ma){if(2==++n)return 2;if(!s)return 1}return t.wi(e.sa,e.oa,r)||t.wi(e.qa,e.ma,r)||e.wi(t.sa,t.oa,r)||e.wi(t.qa,t.ma,r)?1:s&&0!=n||0==i.FM(e,t)?0:1},i.Xx=function(t,r,s,n,o,a){var l=0,h=t.sp(r.sa,r.oa,a,!1),c=t.sp(r.qa,r.ma,a,!1),u=r.sp(t.sa,t.oa,a,!1),p=r.sp(t.qa,t.ma,a,!1);return isNaN(h)||(null!=n&&(n[l]=h),null!=o&&(o[l]=0),null!=s&&(s[l]=e.h.construct(r.sa,r.oa)),l++),isNaN(c)||(null!=n&&(n[l]=c),null!=o&&(o[l]=1),null!=s&&(s[l]=e.h.construct(r.qa,r.ma)),l++),2==l||isNaN(u)||0==h&&0==u||0==c&&1==u||(null!=n&&(n[l]=0),null!=o&&(o[l]=u),null!=s&&(s[l]=e.h.construct(t.sa,t.oa)),l++),2==l||isNaN(p)||1==h&&0==p||1==c&&1==p||(null!=n&&(n[l]=1),null!=o&&(o[l]=p),null!=s&&(s[l]=e.h.construct(r.qa,r.ma)),l++),0<l?(2==l&&null!=n&&n[0]>n[1]&&(t=n[0],n[0]=n[1],n[1]=t,null!=o&&(n=o[0],o[0]=o[1],o[1]=n),null!=s&&(o=e.h.construct(s[0].x,s[0].y),s[0]=s[1],s[1]=o)),l):(l=i.DM(t,r,a),isNaN(l.x)?0:(null!=s&&(s[0]=t.ic(l.x)),null!=n&&(n[0]=l.x),null!=o&&(o[0]=l.y),1))},i.prototype.XF=function(){return 0},i.prototype.pp=function(){},i.prototype.toString=function(){return"Line: ["+this.sa.toString()+", "+this.oa.toString()+", "+this.qa.toString()+", "+this.ma.toString()+"]"},i}(e.KC);e.zb=t}($||($={})),function(e){var t=function(){function e(){this.Lm=[],this.za=-1}return e.prototype.Ma=function(){return this.za},e.prototype.next=function(){if(null!=this.Lm&&0!=this.Lm.length){this.za++;var e=this.Lm[0];return this.Lm=1>=this.Lm.length?[]:this.Lm.slice(1),e}return this.Lm=null},e.prototype.NX=function(e){this.Lm.push(e)},e.prototype.qe=function(){},e}();e.ZK=t}($||($={})),function(e){var t;(t=e.KL||(e.KL={}))[t.enumFillRuleOddEven=0]="enumFillRuleOddEven",t[t.enumFillRuleWinding=1]="enumFillRuleWinding";var i=function(t){function i(i,r){var s=t.call(this)||this;if(s.yf=!1,s.Gq=null,s.uq=0,s.tq=0,s.Bj=null,s.Ng=!1,s.nb=null,s.mb=null,s.Se=null,s.Mj=null,s.Td=null,s.vq=0,s.gb=0,s.zq=0,void 0===r)s.yf=i,s.Ng=!1,s.vq=0,s.uq=0,s.tq=0,s.xa=0,s.description=e.ee.og();else{if(null==r)throw e.i.O();s.yf=i,s.Ng=!1,s.vq=0,s.uq=0,s.tq=0,s.xa=0,s.description=r}return s.Bj=null,s.gb=0,s}return Z(i,t),i.prototype.vm=function(){return 0<this.vq},i.prototype.Wx=function(){this.wc(),null==this.Gq?this.Gq=new e.Ta(this.description):this.Gq.kg(this.description)},i.prototype.qx=function(t,i){var r=new e.h;r.x=t,r.y=i,this.Mt(r)},i.prototype.Mt=function(e){this.Wx(),this.Gq.Db(e),this.Ng=!0},i.prototype.nf=function(t){if(t.B())throw e.i.O();this.Ll(t.description),this.Wx(),t.copyTo(this.Gq),this.Ng=!0},i.prototype.Qx=function(){var t=1;this.Ng&&(this.Wx(),null==this.nb?(this.nb=e.Zc.Ph(2),this.nb.write(0,0),this.mb=e.Zc.Nr(2,0)):(this.nb.resize(this.nb.size+1,0),this.mb.resize(this.mb.size+1,0)),this.yf&&this.mb.write(this.mb.size-2,1),t++);var i=this.xa;this.nb.write(this.nb.size-1,this.xa+t),this.fm(i+t),this.mb.write(this.nb.size-1,0),this.Ng&&(this.Ht(i,this.Gq),this.Ng=!1)},i.prototype.zj=function(e,t){this.Qx(),this.Db(this.xa-1,e,t)},i.prototype.Di=function(e){this.Qx(),this.Db(this.xa-1,e)},i.prototype.lineTo=function(e){this.Qx(),this.Ht(this.xa-1,e)},i.prototype.sU=function(t){if(this.wc(),this.yf)throw e.i.Ra();var i=this.ea();if(t>i)throw e.i.Ra();if(this.ec(t)){if(null==this.mb)throw e.i.Ra();var r=this.xa,s=this.Ca(t),n=this.Wc(t);this.fm(this.xa+1),this.rc();for(var o=0,a=this.description.Ba;o<a;o++)if(null!=this.Aa[o]){var l=e.ua.Wa(this.description.Fd(o));this.Aa[o].Nn(l*n,this.Aa[o],l*s,l,!0,1,l*r)}for(;i>t;i--)r=this.nb.read(i),this.nb.write(i,r+1);this.mb.CE(t,1)}},i.prototype.Cp=function(){if(this.ux(),void 0===e){this.Ng=!1;var e=this.ea()-1}var t=this.mb.read(e);this.mb.write(e,1|t),null!=this.Se&&(e=this.Wc(e)-1,this.Se.write(e,1),this.Mj.write(e,-1))},i.prototype.ec=function(e){return 0!=(1&this.mb.read(e))},i.prototype.On=function(e){if(this.ec(e))return!0;var t=this.Ca(e);return!(t>(e=this.Wc(e)-1))&&(t=this.Oa(t),e=this.Oa(e),t.rb(e))},i.prototype.zv=function(e){return 0!=(2&this.mb.read(e))},i.prototype.oc=function(t,i){if(this.Ll(t.description),322!=t.K())throw e.i.Ra();var r=new e.Ta;(i||this.B())&&(t.Uo(r),this.nf(r)),t.Qo(r),this.lineTo(r)},i.prototype.vp=function(e){var t=0==this.xa;this.qx(e.v,e.G),this.zj(e.v,e.H),this.zj(e.C,e.H),this.zj(e.C,e.G),this.Cp(),this.Ng=!1,t&&this.Nf(256,!1)},i.prototype.bd=function(t,i){if(!t.B()){for(var r=0==this.xa,s=new e.Ta(this.description),n=0;4>n;n++)t.If(i?4-n-1:n,s),0==n?this.nf(s):this.lineTo(s);this.Cp(),this.Ng=!1,r&&!i&&this.Nf(256,!1)}},i.prototype.add=function(e,t){for(var i=0;i<e.ea();i++)this.addPath(e,i,!t)},i.prototype.addPath=function(e,t,i){this.wf(-1,e,t,i)},i.prototype.Zk=function(e,t){this.Cz(e,t)},i.prototype.Fr=function(t,i,r,s,n){if(n||0!=this.ea()||(n=!0),0>i&&(i=t.ea()-1),i>=t.ea()||0>r||0>s||s>t.sv(i))throw e.i.ga("index out of bounds");if(0!=s){var o=t.ec(i)&&r+s==t.sv(i);if(!o||1!=s){if(this.Ng=!1,this.Ll(t.description),r=t.Ca(i)+r+1,n&&(s++,r--),o&&s--,o=this.xa,this.fm(this.xa+s),this.rc(),n){if(0==s)return;this.nb.add(this.xa),n=t.mb.read(i),n&=-5,this.yf&&(n|=1),this.mb.write(this.mb.size-1,n),this.mb.add(0)}else this.nb.write(this.mb.size-1,this.xa);n=0;for(var a=this.description.Ba;n<a;n++){var l=this.description.qd(n),h=e.ua.Wa(l),c=t.description.Qf(l);0>c||null==t.Aa[c]?this.Aa[n].Mn(h*o,e.ua.te(l),s*h,h*o):this.Aa[n].Nn(h*o,t.Aa[c],h*r,s*h,!0,h,h*o)}if(this.vm())throw e.i.Ra();if(t.zv(i))throw e.i.Ra();this.Qc(1993)}}},i.prototype.gJ=function(){for(var e=0,t=this.ea();e<t;e++)this.uW(e)},i.prototype.uW=function(t){if(this.rc(),t>=this.ea())throw e.i.O();var i=this.Ca(t),r=this.Ka(t);t=this.ec(t)?1:0;for(var s=0,n=this.description.Ba;s<n;s++)if(null!=this.Aa[s]){var o=e.ua.Wa(this.description.Fd(s));this.Aa[s].oi(o*(i+t),o*(r-t),o)}this.Qc(1993)},i.prototype.ar=function(t){this.rc();var i=this.ea();if(0>t&&(t=i-1),t>=i)throw e.i.O();for(var r=this.Ca(t),s=this.Ka(t),n=0,o=this.description.Ba;n<o;n++)if(null!=this.Aa[n]){var a=e.ua.Wa(this.description.Fd(n));this.Aa[n].Fn(a*r,a*s,a*this.xa)}for(r=t+1;r<=i;r++)n=this.nb.read(r),this.nb.write(r-1,n-s);if(null==this.mb)for(r=t+1;r<=i;r++)t=this.mb.read(r),this.mb.write(r-1,t);this.nb.resize(i),this.mb.resize(i),this.xa-=s,this.Qg-=s,this.Qc(1993)},i.prototype.wf=function(t,i,r,s){if(i==this)throw e.i.O();if(r>=i.ea())throw e.i.O();var n=this.ea();if(t>n)throw e.i.O();0>t&&(t=n),0>r&&(r=i.ea()-1),this.Ng=!1,this.Ll(i.description),i.rc();var o=i.Ca(r),a=i.Ka(r),l=this.xa,h=i.ec(r)&&!s?1:0;this.fm(this.xa+a),this.rc();for(var c=t<n?this.Ca(t):l,u=0,p=this.description.Ba;u<p;u++){var d=this.description.Fd(u),f=i.description.Qf(d),y=e.ua.Wa(d);0<=f&&null!=i.Aa[f]?(0!=h&&this.Aa[u].Nn(c*y,i.Aa[f],y*o,y,!0,y,y*l),this.Aa[u].Nn((c+h)*y,i.Aa[f],y*(o+h),y*(a-h),s,y,y*(l+h))):this.Aa[u].Mn(c*y,e.ua.te(d),y*a,y*l)}for(this.nb.add(l+a),s=n;s>=t+1;s--)o=this.nb.read(s-1),this.nb.write(s,o+a);for(i.zv(r),this.mb.add(0),s=n-1;s>=t+1;s--)n=this.mb.read(s),n&=-5,this.mb.write(s+1,n);n=i.BR().read(r),n&=-5,this.yf&&(n|=1),this.mb.write(t,n)},i.prototype.Cz=function(t,i){var r=-1,s=this.ea();if(r>s)throw e.i.O();0>r&&(r=s),this.Ng=!1;var n=this.xa;this.fm(this.xa+i),this.rc();var o=r<s?this.Ca(r):n;if(null!=t)this.Aa[0].Dz(2*o,t,0,i,!0,2*n);else{var a=e.ua.te(0);this.Aa[0].Mn(2*o,a,2*i,2*n)}t=1;for(var l=this.description.Ba;t<l;t++){a=this.description.qd(t);var h=e.ua.Wa(a);a=e.ua.te(a),this.Aa[t].Mn(o*h,a,h*i,h*n)}for(this.nb.add(this.xa),n=s;n>=r+1;n--)o=this.nb.read(n-1),this.nb.write(n,o+i);for(this.mb.add(0),n=s-1;n>=r+1;n--)i=this.mb.read(n),i&=-5,this.mb.write(n+1,i);this.yf&&this.mb.write(r,1)},i.prototype.iG=function(t,i,r){var s=-1;if(0>t&&(t=this.ea()),t>this.ea()||s>this.Ka(t)||r>i.length)throw e.i.ga("index out of bounds");if(0!=r){t==this.ea()&&(this.nb.add(this.xa),this.yf?this.mb.add(1):this.mb.add(0)),0>s&&(s=this.Ka(t)),this.rc();var n=this.xa;this.fm(this.xa+r),this.rc();for(var o=0,a=this.description.Ba;o<a;o++){var l=this.description.Fd(o),h=e.ua.Wa(l);this.Aa[o].Vt(h*(this.Ca(t)+s+r),(n-this.Ca(t)-s)*h,this.Aa[o],h*(this.Ca(t)+s),!0,h),0==o?this.Aa[o].oC(h*(this.Ca(t)+s),r,i,0,!0):this.Aa[o].Xj(e.ua.te(l),(this.Ca(t)+s)*h,r*h)}for(this.vm()&&(this.Se.Vt(this.Ca(t)+s+r,n-this.Ca(t)-s,this.Se,this.Ca(t)+s,!0,1),this.Mj.Vt(this.Ca(t)+s+r,n-this.Ca(t)-s,this.Mj,this.Ca(t)+s,!0,1),this.Se.Xj(1,this.Ca(t)+s,r),this.Mj.Xj(-1,this.Ca(t)+s,r)),t+=1,i=this.ea();t<=i;t++)this.nb.write(t,this.nb.read(t)+r)}},i.prototype.xf=function(t,i,r){var s=this.ea();if(0>t&&(t=this.ea()),t>=s||i>this.Ka(t))throw e.i.ga("index out of bounds");t==this.ea()&&(this.nb.add(this.xa),this.yf?this.mb.add(1):this.mb.add(0)),0>i&&(i=this.Ka(t));var n=this.xa;this.fm(this.xa+1),this.rc();var o=this.Ca(t);this.Aa[0].wj(2*(o+i),r,2*n),r=1;for(var a=this.description.Ba;r<a;r++){var l=this.description.Fd(r),h=e.ua.Wa(l);this.Aa[r].Mn(h*(o+i),e.ua.te(l),h,h*n)}for(t+=1;t<=s;t++)this.nb.write(t,this.nb.read(t)+1)},i.prototype.xB=function(t,i){var r=this.ea();if(0>t&&(t=r-1),t>=r||i>=this.Ka(t))throw e.i.ga("index out of bounds");this.rc();var s=this.Ca(t);0>i&&(i=this.Ka(t)-1),i=s+i,s=0;for(var n=this.description.Ba;s<n;s++)if(null!=this.Aa[s]){var o=e.ua.Wa(this.description.Fd(s));this.Aa[s].Fn(o*i,o,o*this.xa)}for(;r>=t+1;r--)i=this.nb.read(r),this.nb.write(r,i-1);this.xa--,this.Qg--,this.Qc(1993)},i.prototype.mE=function(t,i,r,s){if(t=this.Ca(t)+i,(r=this.Ca(r)+s)<t||0>t||r>this.I()-1)throw e.i.O();i=0,(s=this.Ha()).Wb(t);do{for(;s.Ia()&&(t=s.ia(),s.xb()!=r);)i+=t=t.Rb();if(s.xb()==r)break}while(s.ab());return i},i.prototype.YN=function(t,i,r){if(i=this.Ca(t)+i,r=this.Ca(t)+r,0>i||r>this.I()-1)throw e.i.O();var s=this.Ha();if(i>r){if(!this.ec(t))throw e.i.O("cannot iterate across an open path");s.DB()}var n=t=0;s.Wb(i);do{n+=t,t=s.ia().Rb()}while(s.xb()!=r);return n},i.prototype.mg=function(){return e.ri.im(this,null)},i.prototype.BS=function(t,i,r){for(var s=t;s<r-1;s++)if(this.ec(s))throw e.i.O("cannot interpolate across closed paths");if(1!=(s=this.description.Ba)){var n=this.mE(t,i,r,void 0);if(0!=n)for(var o=1;o<s;o++){var a=this.description.qd(o);if(2!=e.ua.gz(a))for(var l=e.ua.Wa(a),h=0;h<l;h++)this.DS(a,t,i,r,n,h)}}},i.prototype.AS=function(t,i,r){var s=this.description.Ba;if(1!=s){var n=this.YN(t,i,r);if(0!=n)for(var o=1;o<s;o++){var a=this.description.qd(o);if(2!=e.ua.gz(a))for(var l=e.ua.Wa(a),h=0;h<l;h++)this.CS(a,t,i,r,n,h)}}},i.prototype.DS=function(t,i,r,s,n,o){var a=this.Ha(),l=this.Ca(i)+r;s=this.Ca(s)+void 0,i=this.Vc(t,l,o),r=this.Vc(t,s,o);var h=i,c=0;a.Wb(l);do{if(a.Ia()){if(a.ia(),a.xb()==s)break;this.setAttribute(t,a.xb(),o,h),a.mi();do{if(l=a.ia(),a.ik()==s)return;c+=l=l.Rb(),h=e.mc.jq(i,r,c/n),a.Pn()||this.setAttribute(t,a.ik(),o,h)}while(a.Ia())}}while(a.ab())},i.prototype.CS=function(t,i,r,s,n,o){var a=this.Ha(),l=this.Ca(i)+r;if((i=this.Ca(i)+s)!=l){s=this.Vc(t,l,o),r=this.Vc(t,i,o);var h=0;a.Wb(l),a.DB(),l=s;do{var c=a.ia();this.setAttribute(t,a.xb(),o,l),h+=l=c.Rb(),l=e.mc.jq(s,r,h/n)}while(a.ik()!=i)}},i.prototype.Pa=function(){this.vq=0,this.Ng=!1,this.Td=this.Se=this.Mj=this.mb=this.nb=null,this.oD()},i.prototype.Pc=function(t){t instanceof e.Ed?this.QD(t,-1):this.oN(t)},i.prototype.QD=function(t,i){if(!this.B()&&!t.isIdentity()){this.rc();var r=this.Aa[0],s=new e.h,n=new e.h;if(0>i){var o=this.vm(),a=0;i=this.xa}else o=this.zv(i),a=this.Ca(i),i=this.Wc(i);for(;a<i;a++){if(s.x=r.read(2*a),s.y=r.read(2*a+1),o){var l=this.Mj.read(a);if(0<=l)switch(7&this.Se.read(a)){case 2:n.x=this.Td.read(l),n.y=this.Td.read(l+1),t.Fh(n,n),this.Td.write(l,n.x),this.Td.write(l+1,n.y),n.x=this.Td.read(l+3),n.y=this.Td.read(l+4),t.Fh(n,n),this.Td.write(l+3,n.x),this.Td.write(l+4,n.y);break;case 4:throw e.i.Ra()}}t.Fh(s,s),r.write(2*a,s.x),r.write(2*a+1,s.y)}this.Qc(1993)}},i.prototype.oN=function(t){if(!this.B()){this.se(1),this.rc();for(var i=this.Aa[0],r=this.Aa[1],s=new e.Od,n=new e.Od,o=this.vm(),a=0;a<this.xa;a++){if(s.x=i.read(2*a),s.y=i.read(2*a+1),s.z=r.read(a),o){var l=this.Mj.read(a);if(0<=l)switch(7&this.Se.read(a)){case 2:n.x=this.Td.read(l),n.y=this.Td.read(l+1),n.z=this.Td.read(l+2),n=t.gp(n),this.Td.write(l,n.x),this.Td.write(l+1,n.y),this.Td.write(l+1,n.z),n.x=this.Td.read(l+3),n.y=this.Td.read(l+4),n.z=this.Td.read(l+5),n=t.gp(n),this.Td.write(l+3,n.x),this.Td.write(l+4,n.y),this.Td.write(l+5,n.z);break;case 4:throw e.i.Ra()}}s=t.gp(s),i.write(2*a,s.x),i.write(2*a+1,s.y),r.write(a,s.z)}this.Qc(1993)}},i.prototype.dy=function(){null==this.nb&&(this.nb=e.Zc.Ph(1,0),this.mb=e.Zc.Nr(1,0)),null!=this.Se&&(this.Se.resize(this.Qg,1),this.Mj.resize(this.Qg,-1))},i.prototype.pp=function(t){t.Ng=!1,t.vq=this.vq,t.zq=this.zq,t.nb=null!=this.nb?e.ja.Cn(this.nb):null,t.mb=null!=this.mb?e.rn.Cn(this.mb):null,t.Mj=null!=this.Mj?e.ja.Cn(this.Mj):null,t.Se=null!=this.Se?e.rn.Cn(this.Se):null,t.Td=null!=this.Td?e.ce.Cn(this.Td):null,t.uq=this.uq,t.tq=this.tq,t.Bj=this.ak(1024)?null:this.Bj},i.prototype.Rb=function(){if(!this.ak(512))return this.uq;for(var t=this.Ha(),i=new e.Dx(0);t.ab();)for(;t.Ia();)i.add(t.ia().Rb());return this.uq=i.tm(),this.Nf(512,!1),i.tm()},i.prototype.Nb=function(e){if(e==this)return!0;if(!(e instanceof i&&t.prototype.Nb.call(this,e)))return!1;var r=this.ea();return!(r!=e.ea()||null!=this.nb&&!this.nb.Nb(e.nb,0,r+1)||this.zq!=e.zq||null!=this.mb&&!this.mb.Nb(e.mb,0,r))&&t.prototype.Nb.call(this,e)},i.prototype.Ha=function(){return new e.QL(this)},i.prototype.cy=function(e){if(t.prototype.cy.call(this,e),this.vm())for(e=this.Ha();e.ab();)e.Ia()},i.prototype.Ap=function(e,i){if(t.prototype.Ap.call(this,e,i),this.vm())for(e=this.Ha();e.ab();)e.Ia()},i.prototype.Yx=function(){this.xa=null==this.nb||0==this.nb.size?0:this.nb.read(this.nb.size-1)},i.prototype.He=function(){return this.yf?(this.yu(),this.tq):0},i.prototype.Fv=function(e){return!!this.yf&&(this.ak(8)?(this.yu(),0<this.Bj.read(e)):0!=(4&this.mb.read(e)))},i.prototype.Kr=function(e){return this.yf?(this.yu(),this.Bj.read(e)):0},i.prototype.yu=function(){if(this.ak(1024)){var t=this.ea();null==this.Bj?this.Bj=new e.ce(t):this.Bj.size!=t&&this.Bj.resize(t),t=new e.Dx(0);for(var i=new e.Dx(0),r=new e.h,s=0,n=this.Ha();n.ab();){for(i.reset(),this.D(this.Ca(n.gb),r);n.Ia();)i.add(n.ia().Rx(r.x,r.y));t.add(i.tm());var o=s++;this.Bj.write(o,i.tm())}this.tq=t.tm(),this.Nf(1024,!1)}},i.prototype.xR=function(){if(this.yf){this.hm();for(var e=this.ea(),t=0;t<e;t++)this.mb.read(t)}},i.prototype.hm=function(){if(this.ak(8)){this.yu();var t=this.ea();(null==this.mb||this.mb.size<t)&&(this.mb=e.Zc.Nr(t+1));for(var i=1,r=0;r<t;r++){var s=this.Bj.read(r);0==r&&(i=0<s?1:-1),0<s*i?this.mb.rJ(r,4):this.mb.CE(r,4)}this.Nf(8,!1)}},i.prototype.nz=function(t){var i=this.gb,r=this.ea();if(0<=i&&i<r){if(t<this.Wc(i)){if(t>=this.Ca(i))return i;i--}else i++;if(0<=i&&i<r&&t>=this.Ca(i)&&t<this.Wc(i))return this.gb=i}if(5>r){for(i=0;i<r;i++)if(t<this.Wc(i))return this.gb=i;throw e.i.ga("corrupted geometry")}for(i=0,--r;r>i;){var s=i+(r-i>>1);if(t<this.Ca(s))r=s-1;else{if(!(t>=(i=this.Wc(s))))return this.gb=s;i=s+1}}return this.gb=i},i.prototype.sz=function(){var e=this.I();if(!this.yf){e-=this.ea();for(var t=0,i=this.ea();t<i;t++)this.ec(t)&&e++}return e},i.prototype.sv=function(e){var t=this.Ka(e);return this.ec(e)||t--,t},i.prototype.Ja=function(){return new i(this.yf,this.description)},i.prototype.Eb=function(){return this.yf?2:1},i.prototype.K=function(){return this.yf?1736:1607},i.prototype.IJ=function(e){this.nb=e,this.Qc(16777215)},i.prototype.MR=function(){return this.ux(),this.Se},i.prototype.BR=function(){return this.ux(),this.mb},i.prototype.HJ=function(e){this.mb=e,this.Qc(16777215)},i.prototype.ea=function(){return null!=this.nb?this.nb.size-1:0},i.prototype.Wc=function(e){return this.nb.read(e+1)},i.prototype.Ka=function(e){return this.nb.read(e+1)-this.nb.read(e)},i.prototype.Ca=function(e){return this.nb.read(e)},i.prototype.mu=function(t,i){null==this.Cb&&(this.Cb=new e.Uk),i=e.Lx.fW(i);var r=this.Cb.Fk;if(null!=r){if(!(r.Ik<t||i>r.IR()))return!0;this.Cb.qD(null)}return r=e.Lx.create(this,t,i),this.Cb.qD(r),!0},i.prototype.dc=function(){var e=t.prototype.dc.call(this);if(!this.Bc()){var i=this.ea();null!=this.nb&&this.nb.Bn(e,0,i+1),null!=this.mb&&this.mb.Bn(e,0,i)}return e},i.prototype.RF=function(e){return null!=this.Se?this.Se.read(e):1},i.prototype.cc=function(t,i,r){var s=this.nz(t);if(t==this.Wc(s)-1&&!this.ec(s))throw e.i.ga("index out of bounds");this.rc();var n=this.Se,o=1;switch(null!=n&&(o=7&n.read(t)),o){case 1:i.Pr();break;case 2:case 4:default:throw e.i.Ra()}if(i=i.get(),r?i.kg(e.ee.og()):i.kg(this.description),s=t==this.Wc(s)-1&&this.ec(s)?this.Ca(s):t+1,n=new e.h,this.D(t,n),i.Ec(n),this.D(s,n),i.Rc(n),!r)for(r=1,n=this.description.Ba;r<n;r++){o=this.description.Fd(r);for(var a=e.ua.Wa(o),l=0;l<a;l++){var h=this.Vc(o,t,l);i.RB(o,l,h),h=this.Vc(o,s,l),i.IB(o,l,h)}}},i.prototype.Sj=function(t,i){if(t>=this.ea())throw e.i.O();if(this.B())i.Pa();else{if(this.zv(t))throw e.i.ga("not implemented");var r=this.vb(0),s=new e.h,n=new e.l;n.Pa();var o=this.Ca(t);for(t=this.Wc(t);o<t;o++)r.uc(2*o,s),n.$b(s);i.L(n)}},i.prototype.gj=function(t){return null==this.Cb&&(this.Cb=new e.Uk),!(0==t||16>this.I()||(t=e.ta.fE(this),this.Cb.OM(t),0))},i.prototype.$L=function(){if(null==this.Cb&&(this.Cb=new e.Uk),null==this.Cb.Ao){this.Cb.pD(null);var t=e.ta.QN(this);this.Cb.pD(t)}},i.prototype.Zo=function(e){this.zq=e},i.prototype.Jn=function(){return this.zq},i.prototype.vD=function(t){if(this==t)throw e.i.ga("MultiPathImpl.add");for(var i=this.ea(),r=0;r<t.ea();r++)this.addPath(t,r,!0),this.sU(i),i++},i.prototype.cO=function(t){var i=this.nz(t),r=this.Ca(i);if(r!=t){if(t>=(i=this.Wc(i))||t<r)throw e.i.ga("change_ring_start_point");for(var s=0,n=this.description.Ba;s<n;s++){var o=this.description.qd(s);o=e.ua.Wa(o),this.Aa[s].rotate(r*o,t*o,i*o)}}},i}(e.Ex);e.Vk=i}($||($={})),function(e){var t=function(t){function i(i){var r=t.call(this)||this;if(void 0!==i){if(null==i)throw e.i.O();r.description=i}else r.description=e.ee.og();return r.xa=0,r}return Z(i,t),i.prototype.Ja=function(){return new i(this.description)},i.prototype.add=function(e){this.resize(this.xa+1),this.Eh(this.xa-1,e)},i.prototype.Cu=function(t,i){this.resize(this.xa+1);var r=new e.h;r.na(t,i),this.Db(this.xa-1,r)},i.prototype.Gd=function(t,i,r){if(r=0>r?t.I():r,0>i||i>t.I()||r<i)throw e.i.O();if(i!=r){this.Ll(t.description),r-=i;var s=this.xa;this.resize(this.xa+r),this.rc();for(var n=0,o=t.description.Ba;n<o;n++){var a=t.description.Fd(n),l=e.ua.Wa(a),h=this.vb(a);a=t.vb(a),h.Nn(s*l,a,i*l,r*l,!0,1,s*l)}}},i.prototype.zD=function(t,i){var r=t.length;if(i=0>i?r:i,0>r||0>i)throw e.i.O();if(0!=i){r=i-0,i=this.xa,this.resize(this.xa+r);for(var s=0;s<r;s++)this.Db(i+s,t[0+s])}},i.prototype.xB=function(t){if(0>t||t>=this.I())throw e.i.ga("index out of bounds");this.rc();for(var i=0,r=this.description.Ba;i<r;i++)if(null!=this.Aa[i]){var s=e.ua.Wa(this.description.Fd(i));this.Aa[i].Fn(s*t,s,s*this.xa)}this.xa--,this.Qg--,this.Qc(1993)},i.prototype.resize=function(e){this.fm(e)},i.prototype.pp=function(){},i.prototype.Pa=function(){t.prototype.oD.call(this)},i.prototype.Pc=function(t){if(t instanceof e.Ed){if(this.B())return;this.rc();for(var i=this.Aa[0],r=new e.h,s=0;s<this.xa;s++)r.x=i.read(2*s),r.y=i.read(2*s+1),t.Fh(r,r),i.write(2*s,r.x),i.write(2*s+1,r.y)}else{if(this.B())return;this.rc(),this.se(1),this.rc(),i=this.Aa[0],r=this.Aa[1];var n=new e.Od;for(s=0;s<this.xa;s++){n.x=i.read(2*s),n.y=i.read(2*s+1),n.z=r.read(s);var o=t.gp(n);i.write(2*s,o.x),i.write(2*s+1,o.y),r.write(s,o.z)}}this.Qc(1993)},i.prototype.Eb=function(){return 0},i.prototype.K=function(){return 550},i.prototype.He=function(){return 0},i.prototype.Rb=function(){return 0},i.prototype.Nb=function(e){return e==this||e instanceof i&&t.prototype.Nb.call(this,e)},i.prototype.bW=function(t,i){var r=this.xa;if(r=Math.min(r,i+1e3),0>i||i>=this.xa||r<i||1e3!=t.length)throw e.i.O();var s=r-i,n=[];for(this.vb(0).Ww(2*i,2*s,n,0,!0),i=0;i<s;i++)t[i]=e.h.construct(n[2*i],n[2*i+1]);return r},i.prototype.Yx=function(){},i.prototype.dy=function(){},i.prototype.mu=function(){return!1},i.prototype.gj=function(){return!1},i.prototype.mg=function(){return null},i}(e.Ex);e.de=t}($||($={})),function(e){var t;(t=e.aL||(e.aL={}))[t.NotDetermined=0]="NotDetermined",t[t.Structure=1]="Structure",t[t.DegenerateSegments=2]="DegenerateSegments",t[t.Clustering=3]="Clustering",t[t.Cracking=4]="Cracking",t[t.CrossOver=5]="CrossOver",t[t.RingOrientation=6]="RingOrientation",t[t.RingOrder=7]="RingOrder",t[t.OGCPolylineSelfTangency=8]="OGCPolylineSelfTangency",t[t.OGCPolygonSelfTangency=9]="OGCPolygonSelfTangency",t[t.OGCDisconnectedInterior=10]="OGCDisconnectedInterior";var i=function(){function e(e,t,i){void 0===e?(this.Kj=0,this.Lo=this.Ko=-1):(this.Kj=e,this.Ko=t,this.Lo=i)}return e.prototype.Xt=function(e){this.Kj=e.Kj,this.Ko=e.Ko,this.Lo=e.Lo},e}();e.Nd=i}($||($={})),function(e){e.P=function(){function t(){}return t.assert=function(t){if(!1===t)throw e.i.yK()},t.UJ=function(e){return isNaN(e)?NaN:0===e?e:0<e?1:-1},t.Gu=function(e){var i;void 0===i&&(i=0);for(var r=[],s=0;s<e;s++)r[s]=t.lg(2,i);return r},t.lg=function(e,t){void 0===t&&(t=0);for(var i=[],r=0;r<e;r++)i[r]=t;return i},t.av=function(e,t){var i,r;for(void 0===i&&(i=0),void 0===r&&(r=e.length-1);i<=r;i++)e[i]=t},t.Rk=function(e,t,i){return e<t?t:e>i?i:e},t.Uh=function(e,t){var i=5381;return((i=((i=((i=void 0!==t?(t<<5)+t+(255&e):(i<<5)+i+(255&e))<<5)+i+(e>>8&255))<<5)+i+(e>>16&255))<<5)+i+(e>>24&255)&2147483647},t.vj=function(){throw Error("Not Implemented")},t.WA=function(e){return t.RT(e)+12345&2147483647},t.OG=function(e){var i=32,r=e%t.Ox|0,s=e/t.Ox|0;return 0==(i&=63)?e:(32>i?(e=r>>>i|s<<32-i,i=s>>i):(e=s>>i-32,i=0<=s?0:-1),i*t.Ox+(e>>>0))},t.RT=function(e){var t=1103515245;return((t-20077)*(e|=0)|0)+(20077*e|0)|0},t.truncate=function(e){return 0>e?-1*Math.floor(Math.abs(e)):Math.floor(e)},t.MAX_SAFE_INTEGER=Math.pow(2,53)-1,t.MIN_SAFE_INTEGER=-t.MAX_SAFE_INTEGER,t.NC=65536,t.Ox=t.NC*t.NC,t}()}($||($={})),function(e){var t;(t=e.uL||(e.uL={}))[t.Project=0]="Project",t[t.Union=1]="Union",t[t.Difference=2]="Difference",t[t.Proximity2D=3]="Proximity2D",t[t.Relate=4]="Relate",t[t.Equals=5]="Equals",t[t.Disjoint=6]="Disjoint",t[t.Intersects=7]="Intersects",t[t.Within=8]="Within",t[t.Contains=9]="Contains",t[t.Crosses=10]="Crosses",t[t.Touches=11]="Touches",t[t.Overlaps=12]="Overlaps",t[t.Buffer=13]="Buffer",t[t.Distance=14]="Distance",t[t.Intersection=15]="Intersection",t[t.Clip=16]="Clip",t[t.Cut=17]="Cut",t[t.DensifyByLength=18]="DensifyByLength",t[t.DensifyByAngle=19]="DensifyByAngle",t[t.LabelPoint=20]="LabelPoint",t[t.GeodesicBuffer=21]="GeodesicBuffer",t[t.GeodeticDensifyByLength=22]="GeodeticDensifyByLength",t[t.ShapePreservingDensify=23]="ShapePreservingDensify",t[t.GeodeticLength=24]="GeodeticLength",t[t.GeodeticArea=25]="GeodeticArea",t[t.Simplify=26]="Simplify",t[t.SimplifyOGC=27]="SimplifyOGC",t[t.Offset=28]="Offset",t[t.Generalize=29]="Generalize",t[t.SymmetricDifference=30]="SymmetricDifference",t[t.ConvexHull=31]="ConvexHull",t[t.Boundary=32]="Boundary",t[t.SimpleRelation=33]="SimpleRelation";var i=function(){function e(){}return e.prototype.K=function(){return null},e.prototype.xn=function(){},e.prototype.Ju=function(){return!1},e}();e.Ge=i}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 13},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r,s,n){return t instanceof e.ba?(n=new e.$c(t),this.W(n,i,[r],!1,s).next()):!0===s?(r=new e.tC(t,i,r,!1,n),e.Hh.local().W(r,i,n)):new e.tC(t,i,r,!1,n)},i.instance=null,i}(e.Ge);e.sC=t}($||($={})),function(e){var t=function(){function t(t,i,r,s,n){this.za=-1,this.Sd=t,this.Vz=i,this.Ds=r,this.iT=new e.l,this.iT.Pa(),this.fo=-1,this.Vb=n}return t.prototype.next=function(){for(var e;null!=(e=this.Sd.next());)return this.za=this.Sd.Ma(),this.fo+1<this.Ds.length&&this.fo++,this.buffer(e,this.Ds[this.fo]);return null},t.prototype.Ma=function(){return this.za},t.prototype.buffer=function(t,i){return e.zK.buffer(t,i,this.Vz,NaN,96,this.Vb)},t.prototype.qe=function(){},t}();e.tC=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 16},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r,s){return t instanceof e.ba?(t=new e.$c(t),this.W(t,i,r,s).next()):new e.dL(t,i,r,s)},i.instance=null,i}(e.Ge);e.cL=t}($||($={})),function(e){var t=function(){function t(t,i,r){if(this.za=-1,null==t)throw e.i.O();this.aa=i,this.yk=t,this.ra=e.ta.Xd(r,i,!1)}return t.prototype.next=function(){var t;return null!=(t=this.yk.next())?(this.za=this.yk.Ma(),e.Vd.clip(t,this.aa,this.ra,0)):null},t.prototype.Ma=function(){return this.za},t.prototype.qe=function(){},t}();e.dL=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 31},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r){return t instanceof e.ba?e.vC.jE(t):new e.vC(i,t,r)},i.instance=null,i}(e.Ge);e.uC=t}($||($={})),function(e){var t=function(){function t(t,i,r){if(this.oA=new e.$t,this.za=-1,null==i)throw e.i.O();this.VG=t,this.Jc=!1,this.yk=i,this.Vb=r}return t.prototype.next=function(){if(this.VG){if(!this.Jc){var e=this.WN(this.yk);return this.Jc=!0,e}return null}if(!this.Jc){if(null!=(e=this.yk.next()))return this.za=this.yk.Ma(),t.jE(e);this.Jc=!0}return null},t.prototype.Ma=function(){return this.za},t.prototype.WN=function(e){for(var t;null!=(t=e.next());)this.oA.Ib(t);return this.oA.VQ()},t.prototype.qe=function(){if(!this.Jc){if(!this.VG)throw e.i.ga("Invalid call for non merging convex hull.");var t=this.yk.next();if(null==t)throw e.i.ga("Expects a non-null geometry.");this.oA.Ib(t)}},t.jE=function(i){if(t.LS(i))return i;var r=i.K();if(e.Vk.zd(r))return(r=new e.Ua(i.description)).oc(i,!0),r;if(550==r&&2==i.I()){var s=new e.Ta;return r=new e.Ua(i.description),i.we(0,s),r.nf(s),i.we(1,s),r.lineTo(s),r}return e.$t.JO(i)},t.LS=function(t){if(t.B())return!0;var i=t.K();return 33==i||197==i||!e.Vk.zd(i)&&(550==i?1==t.I():1607==i?1==t.ea()&&2>=t.I():1==t.ea()&&(2>=t.I()||e.$t.BG(t,0)))},t}();e.vC=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 17},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r,s,n){return new e.fL(t,i,r,s,n)},i.instance=null,i}(e.Ge);e.eL=t}($||($={})),function(e){var t=function(){function t(t,i,r,s,n){if(this.Uf=null,null==i||null==r)throw e.i.ga("invalid argument");this.fT=t,this.hA=i,this.dH=r,t=e.ta.nv(i,r),this.ra=e.ta.Xd(s,t,!0),this.cH=-1,this.nd=n}return t.prototype.Ma=function(){return 0},t.prototype.next=function(){return this.JQ(),++this.cH<this.Uf.length?this.Uf[this.cH]:null},t.prototype.JQ=function(){if(null==this.Uf)switch(this.Uf=[],this.hA.K()){case 1607:this.LQ();break;case 1736:this.KQ()}},t.prototype.LQ=function(){var t=new e.Ua,i=new e.Ua,r=new e.Ua;this.Uf.push(t),this.Uf.push(i);var s=[];e.DK.BK(this.fT,this.hA,this.dH,this.ra,s,this.nd);for(var n=0;n<s.length;n++){var o=s[n];if(0==o.bt)t.add(o.Y,!1);else if(1==o.bt||2==o.bt)i.add(o.Y,!1);else if(3==o.bt)this.Uf.push(o.Y);else{if(4!=o.bt)throw e.i.ga("internal");r.add(o.Y,!1)}}r.B()||t.B()&&i.B()&&!(3<=this.Uf.length)||this.Uf.push(r),t.B()&&i.B()&&3>this.Uf.length&&(this.Uf.length=0)},t.prototype.KQ=function(){var t=new e.ja(0),i=new e.hd,r=i.TE(),s=i.Ib(this.hA),n=i.Ib(this.dH),o=new e.Hg;try{o.Ft(i,this.ra,this.nd),o.el(r,s,n,t);var a=i.Ke(s),l=new e.Ea,h=new e.Ea;for(this.Uf.length=0,this.Uf.push(l),this.Uf.push(h),s=0;s<t.size;s++){var c=new e.hd,u=c.Ib(a),p=c.Ib(i.Ke(t.get(s)));o.fr(c,this.nd);var d=o.Bv(u,p),f=c.Ke(d);if(!f.B()){var y=i.CF(t.get(s),r);2==y?l.add(f,!1):1==y?h.add(f,!1):this.Uf.push(f);var g=new e.hd;u=g.Ib(a),p=g.Ib(i.Ke(t.get(s))),o.fr(g,this.nd),a=g.Ke(o.km(u,p))}}!a.B()&&0<t.size&&this.Uf.push(a),l.B()&&h.B()&&(this.Uf.length=0)}finally{o.Vg()}},t.prototype.qe=function(){},t}();e.fL=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 18},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r){if(t instanceof e.ba)return t=new e.$c(t),this.W(t,i,r).next();if(0>=i)throw e.i.O();return new e.gL(t,i,r)},i.instance=null,i}(e.Ge);e.Zl=t}($||($={})),function(e){var t=function(){function t(e,t){this.za=-1,this.Sd=e,this.Qs=t}return t.prototype.Ma=function(){return this.za},t.prototype.next=function(){var e;return null!=(e=this.Sd.next())?(this.za=this.Sd.Ma(),this.FP(e)):null},t.prototype.FP=function(t){if(t.B()||1>t.Eb())return t;var i=t.K();if(1736==i||1607==i)return this.Iy(t);if(e.ba.zd(i))return this.HP(t);if(197==i)return this.GP(t);throw e.i.Ra()},t.prototype.HP=function(t){if(t.Rb()<=this.Qs)return t;var i=new e.Ua(t.description);return i.oc(t,!0),this.Iy(i)},t.prototype.GP=function(t){var i=new e.Ea(t.description);i.bd(t,!1);var r=new e.l;return t.A(r),t=r.da(),r.S()<=this.Qs&&t<=this.Qs?i:this.Iy(i)},t.prototype.Iy=function(t){for(var i=t.Ja(),r=t.Ha();r.ab();)for(var s=!0;r.Ia();){var n=r.ia();if(322!=n.K())throw e.i.ga("not implemented");var o=r.Pn(),a=n.Rb();if(a>this.Qs){var l=Math.ceil(a/this.Qs);a=new e.Ta(t.description),s&&(n.Uo(a),i.nf(a));var h=s=1/l,c=0;for(--l;c<l;c++)n.Uw(h,a),i.lineTo(a),h+=s;o?i.Cp():(n.Qo(a),i.lineTo(a))}else o?i.Cp():i.oc(n,s);s=!1}return i},t.prototype.qe=function(){},t}();e.gL=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.K=function(){return 2},i.prototype.W=function(t,i,r,s){return t instanceof e.ba?(t=new e.$c(t),i=new e.$c(i),this.W(t,i,r,s).next()):new e.hL(t,i,r,s)},i.km=function(t,r,s,n){if(t.B()||r.B())return t;var o=t.Eb(),a=r.Eb();if(o>a)return t;var l=t.K(),h=r.K(),c=new e.l,u=new e.l,p=new e.l;t.A(c),r.A(u),p.L(c),p.$b(u);var d=(p=e.ta.Xd(s,p,!0))*Math.sqrt(2)*1.00001,f=new e.l;if(f.L(c),f.X(d,d),!f.isIntersecting(u))return t;if(1==o&&2==a)return i.AV(t,r,h,s,n);if(33==l)switch(e.Vk.zd(h)?(s=new e.Ua(r.description),s.oc(r,!0)):s=r,h){case 1736:return i.NU(t,s,p);case 1607:return i.OU(t,s,p);case 550:return i.LU(t,s,p);case 197:return i.KU(t,s,p);case 33:return i.MU(t,s,p);default:throw e.i.O()}else if(550==l)switch(h){case 1736:return i.dU(t,r,p);case 197:return i.bU(t,r,p);case 33:return i.cU(t,r,p)}return e.Hg.km(t,r,s,n)},i.NU=function(t,i,r){return 0==e.jd.CG(i,t,r)?t:t.Ja()},i.OU=function(t,i,r){var s=t.D();i=i.Ha();for(var n=r*Math.sqrt(2)*1.00001,o=n*n,a=new e.l;i.ab();)for(;i.Ia();){var l=i.ia();if(l.A(a),a.X(n,n),a.contains(s)){if(l.rs(s,r))return t.Ja();var h=l.ac();if(e.h.zc(s,h)<=o)return t.Ja();if(h=l.xc(),e.h.zc(s,h)<=o)return t.Ja()}}return t},i.LU=function(t,i,r){var s=i.vb(0);i=i.I();var n=t.D(),o=new e.h;r=r*Math.sqrt(2)*1.00001,r*=r;for(var a=0;a<i;a++)if(s.uc(2*a,o),e.h.zc(o,n)<=r)return t.Ja();return t},i.KU=function(t,i,r){var s=new e.l;return i.A(s),s.X(r,r),i=t.D(),s.contains(i)?t.Ja():t},i.MU=function(t,i,r){r=r*Math.sqrt(2)*1.00001,r*=r;var s=t.D();return i=i.D(),e.h.zc(s,i)<=r?t.Ja():t},i.dU=function(t,i,r){var s=new e.l;i.A(s),s.X(r,r);for(var n=t.I(),o=!1,a=[],l=0;l<n;l++)a[l]=!1;var h=new e.h;for(l=0;l<n;l++)t.D(l,h),s.contains(h)&&0!=e.jd.Zd(i,h,r)&&(o=!0,a[l]=!0);if(!o)return t;for(i=t.Ja(),l=0;l<n;l++)a[l]||i.Gd(t,l,l+1);return i},i.bU=function(t,i,r){var s=new e.l;i.A(s),s.X(r,r),i=t.I();var n=!1;r=[];for(var o=0;o<i;o++)r[o]=!1;var a=new e.h;for(o=0;o<i;o++)t.D(o,a),s.contains(a)&&(n=!0,r[o]=!0);if(!n)return t;for(s=t.Ja(),o=0;o<i;o++)r[o]||s.Gd(t,o,o+1);return s},i.cU=function(t,i,r){var s=t.vb(0),n=t.I(),o=i.D(),a=new e.h,l=!1;i=[];for(var h=0;h<n;h++)i[h]=!1;for(r=(h=r*Math.sqrt(2)*1.00001)*h,h=0;h<n;h++)s.uc(2*h,a),e.h.zc(a,o)<=r&&(l=!0,i[h]=!0);if(!l)return t;for(s=t.Ja(),h=0;h<n;h++)i[h]||s.Gd(t,h,h+1);return s},i.AV=function(t,i,r,s,n){var o=new e.Gh;t.dn(o);var a=new e.l;return i.A(a),o.$b(a),o.X(.1*o.S(),.1*o.da()),(a=new e.Ea).bd(o,!1),1736==r?a.add(i,!0):a.bd(i,!0),e.Wk.local().W(t,a,s,n)},i.instance=null,i}(e.Ge);e.lp=t}($||($={})),function(e){var t=function(){function t(e,t,i,r){this.us=null==t,this.za=-1,this.Sd=e,this.Vz=i,this.lT=t.next(),this.Vb=r}return t.prototype.next=function(){return this.us?null:null!=(t=this.Sd.next())?(this.za=this.Sd.Ma(),e.lp.km(t,this.lT,this.Vz,this.Vb)):null;var t},t.prototype.Ma=function(){return this.za},t.prototype.qe=function(){},t}();e.hL=t}($||($={})),function(e){var t=function(){function t(t){this.nd=t,this.Cj=new e.l,this.Cj.Pa(),this.ph=new e.l,this.ph.Pa()}return t.prototype.Ot=function(){var e=this.Cj.v;this.Cj.v=this.ph.v,this.ph.v=e,e=this.Cj.C,this.Cj.C=this.ph.C,this.ph.C=e,e=this.Cj.G,this.Cj.G=this.ph.G,this.ph.G=e,e=this.Cj.H,this.Cj.H=this.ph.H,this.ph.H=e},t.prototype.XP=function(t,i){if(null!=this.nd&&!this.nd.progress(-1,-1))throw e.i.gu("user_canceled");var r=!this.Cj.isIntersecting(this.ph);return e.ba.Ic(t.K())&&e.ba.Ic(i.K())?t.I()>i.I()?this.ZD(t,i,r):(this.Ot(),t=this.ZD(i,t,r),this.Ot(),t):550==t.K()&&e.ba.Ic(i.K())?(t=this.$D(i,t,r),this.Ot(),t):550==i.K()&&e.ba.Ic(t.K())?this.$D(t,i,r):550==t.K()&&550==i.K()?t.I()>i.I()?this.aE(t,i):(this.Ot(),t=this.aE(i,t),this.Ot(),t):0},t.prototype.ZD=function(t,i,r){var s=t.Ha(),n=i.Ha(),o=new e.l,a=new e.l,l=17976931348623157e292;if(!r&&this.dY(t,i,s,n))return 0;for(;s.ab();)for(;s.Ia();)if((t=s.ia()).A(o),!(o.ox(this.ph)>l)){for(;n.ab();)for(;n.Ia();)if((i=n.ia()).A(a),o.ox(a)<l&&(i=t.ub(i,r),(i*=i)<l)){if(0==i)return 0;l=i}n.$i()}return Math.sqrt(l)},t.prototype.$D=function(t,i,r){var s=t.Ha(),n=new e.l,o=17976931348623157e292,a=new e.h,l=i.I();for(r=!r&&1736==t.K();s.ab();)for(;s.Ia();){var h=s.ia();if(h.A(n),!(1<l&&n.ox(this.ph)>o)){for(var c=0;c<l;c++){if(i.D(c,a),r&&0!=e.jd.Zd(t,a,0))return 0;var u=h.fe(a,!1);if(a.sub(h.ic(u)),(u=a.Sk())<o){if(0==u)return 0;o=u}}r=!1}}return Math.sqrt(o)},t.prototype.aE=function(t,i){for(var r,s=17976931348623157e292,n=new e.h,o=new e.h,a=t.I(),l=i.I(),h=0;h<a;h++)if(t.D(h,n),!(1<l&&this.ph.aK(n)>s))for(var c=0;c<l;c++)if(i.D(c,o),(r=e.h.zc(n,o))<s){if(0==r)return 0;s=r}return Math.sqrt(s)},t.prototype.dY=function(t,i,r,s){if(1736==t.K()){for(;s.ab();)if(s.Ia()){var n=s.ia();if(0!=e.jd.Zd(t,n.xc(),0))return!0}s.$i()}if(1736==i.K()){for(;r.ab();)if(r.Ia()&&(t=r.ia(),0!=e.jd.Zd(i,t.xc(),0)))return!0;r.$i()}return!1},t.prototype.im=function(e,t){return e.B()||t.B()?NaN:(e.A(this.Cj),t.A(this.ph),this.XP(e,t))},t}(),i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return Z(r,i),r.prototype.W=function(i,r,s){if(null==i||null==r)throw e.i.O();if(i.B()||r.B())return NaN;var n=i.K(),o=r.K();if(33==n){if(33==o)return e.h.ub(i.D(),r.D());if(197==o)return s=new e.l,r.A(s),s.ub(i.D());(n=new e.de).add(i),i=n}else if(197==n){if(197==o)return o=new e.l,i.A(o),s=new e.l,r.A(s),s.ub(o);(n=new e.Ea).bd(i,!1),i=n}return 33==o?((o=new e.de).add(r),r=o):197==o&&((o=new e.Ea).bd(r,!1),r=o),new t(s).im(i,r)},r.local=function(){return null===r.instance&&(r.instance=new r),r.instance},r.prototype.K=function(){return 14},r.instance=null,r}(e.Ge);e.iL=i}($||($={})),function(e){var t=function(){function t(e,t,i,r){this.rH=e,this.vH=t,this.nd=r,this.SG=i}return t.prototype.next=function(){var e=this.rH.next();return null==e?null:this.rC(e)},t.prototype.Ma=function(){return this.rH.Ma()},t.prototype.rC=function(t){var i=t.K();if(e.ba.Sn(i))return t;if(197==i)return(i=new e.Ea(t.description)).bd(t,!1),this.rC(i);if(t.B())return t;if(null==t)throw e.i.Ra();i=t.Ja();for(var r=new e.zb,s=0,n=t.ea();s<n;s++)this.LK(t,s,i,r);return i},t.prototype.LK=function(t,i,r,s){if(!(2>t.Ka(i))){var n=t.Ca(i),o=t.Wc(i)-1,a=t.vb(0),l=t.ec(i),h=new e.ja(0);h.Jb(t.Ka(i)+1);var c=new e.ja(0);for(c.Jb(t.Ka(i)+1),h.add(l?n:o),h.add(n),n=new e.h;1<h.size;){var u=h.Gc();h.Jf();var p=h.Gc();t.D(u,n),s.Ec(n),t.D(p,n),s.Rc(n),0<=(p=this.KK(s,n,a,u,p,o))?(h.add(p),h.add(u)):c.add(u)}if(l||c.add(h.get(0)),c.size==h.size)r.addPath(t,i,!0);else if(2<=c.size&&(!this.SG||2!=c.size||!(l||e.h.ub(t.Oa(c.get(0)),t.Oa(c.get(1)))<=this.vH))){for(i=new e.Ta,s=0,o=c.size;s<o;s++)t.we(c.get(s),i),0==s?r.nf(i):r.lineTo(i);l&&(this.SG||2!=c.size||r.lineTo(i),r.Cp())}}},t.prototype.KK=function(e,t,i,r,s,n){var o=s-1;for(s<=r&&(o=n),n=s=-1,r+=1;r<=o;r++){i.uc(2*r,t);var a=t.x,l=t.y;e.ic(e.fe(t,!1),t),t.x-=a,t.y-=l,(a=t.length())>this.vH&&a>n&&(s=r,n=a)}return s},t.prototype.qe=function(){},t}();e.jL=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 29},i.prototype.W=function(t,i,r,s){return t instanceof e.ba?(t=new e.$c(t),this.W(t,i,r,s).next()):new e.jL(t,i,r,s)},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.instance=null,i}(e.Ge);e.wC=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 21},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r,s,n,o,a,l){return t instanceof e.ba?(l=new e.$c(t),this.W(l,i,r,[s],n,o,!1,a).next()):!0===a?(r=new e.yC(t,i,r,s,n,!1,!1,l),e.Hh.local().W(r,i,l)):new e.yC(t,i,r,s,n,!1,!1,l)},i.instance=null,i}(e.Ge);e.xC=t}($||($={})),function(e){var t=function(){function t(t,i,r,s,n,o,a,l){if(o)throw e.i.Fe();if(null==i)throw e.i.O();this.za=-1,this.Ns=t,this.vg=i,this.Ae=r,this.Ds=s,this.ao=n,this.fo=-1,this.Vb=l,this.jT=new e.l,this.jT.Pa()}return t.prototype.next=function(){for(var e;null!=(e=this.Ns.next());)return this.za=this.Ns.Ma(),this.fo+1<this.Ds.length&&this.fo++,this.SQ(e,this.Ds[this.fo]);return null},t.prototype.Ma=function(){return this.za},t.prototype.SQ=function(t,i){return e.NK.buffer(t,this.vg,this.Ae,i,this.ao,this.Vb)},t.prototype.qe=function(){},t}();e.yC=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 24},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r){if(null==i)throw e.i.O();if(t.B()||1>t.Eb())return 0;if(4==r)throw e.i.Fe();var s=e.cb.tc(i),n=e.cb.wv(s),o=e.cb.fv(s);n*=2-n;var a=s.Id().bi,l=t.K();if(1736==l||197==l)var h=t.mg();else e.ba.zd(l)?(h=new e.Ua(t.description)).oc(t,!0):h=t;if(0==s.Nb(i)){if(e.cb.Xc(i)){h=e.Ih.mj(h,i),1607==l&&h==t&&(h=e.ba.ig(t)),t=new e.Oc,e.cb.hh(i).en(t),l=0;for(var c=h.I();l<c;l++){var u=h.Oa(l);u.x=e.Ih.an(u.x,t),h.Db(l,u)}}t=h.Ja(),h=e.Ih.NI(i,s,h,t)?t:e.cb.Ah(h,i,s)}return this.$P(h,r,o,n,a)},i.prototype.$P=function(t,i,r,s,n){var o=new e.ha(0),a=0;for(t=t.Ha();t.ab();)for(;t.Ia();){var l=t.ia(),h=l.ac();l=l.xc(),h.scale(n),l.scale(n),e.kb.xd(r,s,h.x,h.y,l.x,l.y,o,null,null,i),a+=o.u}return a},i.instance=null,i}(e.Ge);e.mL=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 18},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r,s,n){return t instanceof e.ba?(t=new e.$c(t),this.W(t,i,r,s,n).next()):new e.lL(t,r,s,i,-1,-1,n)},i.instance=null,i}(e.Ge);e.kL=t}($||($={})),function(e){var t=function(){function t(t,i,r,s,n,o){if(0<o)throw e.i.Fe();if(4!=r&&0<n)throw e.i.Fe();if(null==i)throw e.i.O();this.za=-1,this.Ns=t,this.vg=i,this.Ae=r,this.tT=s,this.sT=n}return t.prototype.next=function(){for(var e;null!=(e=this.Ns.next());)return this.za=this.Ns.Ma(),this.Uy(e);return null},t.prototype.Ma=function(){return this.za},t.prototype.Uy=function(t){return e.dj.Rr(t,this.vg,this.Ae,this.tT,this.sT,this.Vb)},t.prototype.qe=function(){},t}();e.lL=t}($||($={})),function(e){var t;(t=e.VK||(e.VK={}))[t.Unknown=0]="Unknown",t[t.Contains=1]="Contains",t[t.Within=2]="Within",t[t.Equals=3]="Equals",t[t.Disjoint=4]="Disjoint",t[t.Touches=8]="Touches",t[t.Crosses=16]="Crosses",t[t.Overlaps=32]="Overlaps",t[t.NoThisRelation=64]="NoThisRelation",t[t.Intersects=1073741824]="Intersects",t[t.IntersectsOrDisjoint=1073741828]="IntersectsOrDisjoint",e.nL=function(){function t(){}return t.dW=function(t,i){var r=t.K(),s=i.K();if(e.ba.yj(r)){var n=t.Cb;if(null!=n&&null!=(n=n.Fk)){if(33==s){var o=i.D();n=n.To(o.x,o.y)}else o=new e.l,i.A(o),n=n.So(o);if(1==n)return 1;if(0==n)return 4}}if(e.ba.yj(s)&&null!=(n=i.Cb)&&null!=(n=n.Fk)){if(33==r?(t=t.D(),n=n.To(t.x,t.y)):(i=new e.l,t.A(i),n=n.So(i)),1==n)return 2;if(0==n)return 4}return 0},t}()}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.K=function(){return 15},i.prototype.W=function(t,i,r,s,n){return t instanceof e.ba?(t=new e.$c(t),i=new e.$c(i),this.W(t,i,r,s,n).next()):void 0===n?new e.zC(t,i,r,s,-1):new e.zC(t,i,r,s,n)},i.prototype.xn=function(t,i,r){this.Ju(t)&&(i=e.ta.lj(i,t,!1),t.gj(r)||t.mu(i,r))},i.prototype.Ju=function(t){return e.Lx.rE(t)},i.instance=null,i}(e.Ge);e.Wk=t}($||($={})),function(e){var t=function(){function t(t,i,r,s,n){if(this.us=null==i,this.za=-1,this.Sd=t,this.vg=r,this.Pe=i.next(),this.Ej=this.Pe.K(),this.Vb=s,this.Gi=n,-1!=this.Gi&&(0>=this.Gi||7<this.Gi))throw e.i.O("bad dimension mask")}return t.prototype.next=function(){if(this.us)return null;if(null!=this.Aw){var e=this.Aw.next();if(null!=e)return e;this.Aw=null}for(;null!=(e=this.Sd.next());)return this.za=this.Sd.Ma(),-1==this.Gi?e=this.Fa(e):(this.Aw=this.GS(e),e=this.Aw.next()),e;return null},t.prototype.Ma=function(){return this.za},t.prototype.Fa=function(t){var i=this.rK(t);if(null!=i)return i;i=e.ta.nv(this.Pe,t);var r=e.ta.Xd(this.vg,i,!0);i=new e.l,this.Pe.A(i);var s=new e.l;return t.A(s),i.X(2*r,2*r),i.Fa(s),i.X(100*r,100*r),r=e.Vd.clip(this.Pe,i,0,0),t=e.Vd.clip(t,i,0,0),e.Hg.Bv(t,r,this.vg,this.Vb)},t.prototype.HI=function(t,i,r){var s=0;if(0!=(1&i))null==r[0]&&(r[0]=new e.de(t)),s++;else for(var n=0;n<r.length-1;n++)r[n]=r[n+1];if(0!=(2&i))null==r[s]&&(r[s]=new e.Ua(t)),s++;else for(n=s;n<r.length-1;n++)r[n]=r[n+1];if(0!=(4&i))null==r[s]&&(r[s]=new e.Ea(t)),s++;else for(n=s;n<r.length-1;n++)r[n]=r[n+1];if(3!=s){for(t=[],n=0;n<s;n++)t[n]=r[n];return new e.$c(t)}return new e.$c(r)},t.prototype.GS=function(t){var i=this.rK(t);if(null!=i){var r=[null,null,null];return r[i.Eb()]=i,this.HI(t.description,this.Gi,r)}i=e.ta.nv(this.Pe,t),r=e.ta.Xd(this.vg,i,!0),i=new e.l,this.Pe.A(i),i.X(2*r,2*r);var s=new e.l;return t.A(s),i.Fa(s),i.X(100*r,100*r),r=e.Vd.clip(this.Pe,i,0,0),i=e.Vd.clip(t,i,0,0),r=e.Hg.Kz(i,r,this.vg,this.Vb),this.HI(t.description,this.Gi,r)},t.prototype.rK=function(i){var r=e.ta.nv(i,this.Pe),s=e.ta.Xd(this.vg,r,!0);r=i.K();var n=i.B(),o=this.Pe.B();if(!(o=n||o)){o=new e.l,i.A(o);var a=new e.l;this.Pe.A(a),a.X(2*s,2*s),o=!o.isIntersecting(a)}if(!o)if(4==(a=e.nL.dW(this.Pe,i)))o=!0;else{if(0!=(2&a))return this.Pe;if(0!=(1&a))return i}if(o)return(s=e.ba.uf(r))<(o=e.ba.uf(this.Ej))?t.BB(i,n):s>o||0==s&&550==r&&33==this.Ej?this.fJ():t.BB(i,n);if((-1==this.Gi||4==this.Gi)&&197==r&&197==this.Ej)return s=this.Pe,r=new e.l,i.A(r),n=new e.l,s.A(n),r.Fa(n),s=new e.Gh,i.copyTo(s),s.Yo(r),s;if(197==r&&0==e.ba.uf(this.Ej)||197==this.Ej&&0==e.ba.uf(r))return n=197==r?i:this.Pe,i=197==r?this.Pe:i,r=new e.l,n.A(r),e.Vd.clip(i,r,s,0);if(0==e.ba.uf(r)&&0<e.ba.uf(this.Ej)||0<e.ba.uf(r)&&0==e.ba.uf(this.Ej)){if(s=e.ta.lj(this.vg,i,!1),550==r||33==r)return e.Hg.rG(i,this.Pe,s);if(550==this.Ej||33==this.Ej)return e.Hg.rG(this.Pe,i,s);throw e.i.Ra()}return-1!=this.Gi&&2!=this.Gi||1607!=r||1736!=this.Ej?-1!=this.Gi&&2!=this.Gi||1736!=r||1607!=this.Ej?null:this.oK(this.Pe,i):this.oK(i,this.Pe)},t.prototype.oK=function(t,i){var r=t,s=i,n=e.ta.lj(this.vg,i,!1),o=new e.l;s.A(o);var a=new e.l;r.A(a),a.X(2*n,2*n),o.Fa(a),o.X(10*n,10*n),r=t=e.Vd.clip(t,o,0,0),a=new e.ja(0);var l=-1,h=s.Cb;if(null!=h){var c=h.Fk;if(null!=c){l=0,a.Jb(r.I()+r.ea());for(var u=new e.l,p=r.Ha();p.ab();)for(;p.Ia();){p.ia().A(u);var d=c.So(u);1==d?a.add(1):0==d?a.add(0):(a.add(-1),l++)}}}if(5<i.I()&&(h=(s=i=e.Vd.clip(i,o,0,0)).Cb),0>l&&(l=r.sz()),o=r.I()+s.I(),l*s.I()>Math.log(o)*o*4)return null;o=null,l=s.Ha(),null!=h&&null!=h.Gb&&(o=h.Gb),null==o&&20<s.I()&&(o=e.ta.fE(s)),t=t.Ja(),s=null,h=r.Ha(),c=[0,0,0,0,0,0,0,0,0],u=new e.ce(0),p=new e.hg,d=-1;for(var f=0,y=0,g=0<a.size,m=-1;h.ab();){m=h.gb;var v=0;for(d=-1,f=0;h.Ia();){var b=g?e.P.truncate(a.get(y)):-1;y++;var w=h.ia();if(0>b){if(null!=o)for(null==s?s=o.mR(w,n):s.Vo(w,n),b=s.next();-1!=b;b=s.next()){l.Wb(o.ka(b)),b=l.ia();var _=w.Fa(b,null,c,null,n);for(b=0;b<_;b++)u.add(c[b])}else for(l.$i();l.ab();)for(;l.Ia();)for(b=l.ia(),_=w.Fa(b,null,c,null,n),b=0;b<_;b++)u.add(c[b]);if(0<u.size){u.Wd(0,u.size,(function(e,t){return e-t}));var x=0;u.add(1),_=-1,b=0;for(var S=u.size;b<S;b++){var M=u.get(b);if(M!=x){var T=!1;if(0!=x||1!=M?(w.bh(x,M,p),x=p.get()):(x=w,T=!0),2<=v){if(t.Fr(r,m,d,f,3==v),1!=this.HD(i,x.ac(),n)&&1!=this.JD(i,x,n))return null;t.oc(x,!1),v=1,f=0}else switch(_=this.JD(i,x,n),_){case 1:T?2>v?(d=h.xb()-r.Ca(m),f=1,v=0==v?3:2):f++:(t.oc(x,0==v),v=1);break;case 0:v=0,d=-1,f=0;break;default:return null}x=M}}}else{if(0>(b=this.HD(i,w.ac(),n)))return null;1==b?(2>v&&(d=h.xb()-r.Ca(m),v=0==v?3:2),f++):(d=-1,f=0)}u.clear(!1)}else 0!=b&&1==b&&(0==v?(v=3,d=h.xb()-r.Ca(m)):1==v?(v=2,d=h.xb()-r.Ca(m)):f++)}2<=v&&(t.Fr(r,m,d,f,3==v),d=-1)}return t},t.prototype.HD=function(t,i,r){return e.Fg.ym(t,i,r)},t.prototype.JD=function(t,i,r){var s=i.ac();i=i.xc();var n=e.Fg.ym(t,s,r),o=e.Fg.ym(t,i,r);return 1==n&&0==o||0==n&&1==o?-1:0==n||0==o?0:1==n||1==o?1:((n=new e.h).add(s,i),n.scale(.5),0==(t=e.Fg.ym(t,n,r))?0:1==t?1:-1)},t.BB=function(e,t){return t?e:e.Ja()},t.prototype.fJ=function(){return null==this.qH&&(this.qH=this.Pe.Ja()),this.qH},t.prototype.qe=function(){},t}();e.zC=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 28},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r,s,n,o,a){return t instanceof e.ba?(t=new e.$c(t),this.W(t,i,r,s,n,o,a).next()):new e.oL(t,i,r,s,n,o,a)},i.instance=null,i}(e.Ge);e.AC=t}($||($={})),function(e){var t=function(){function t(e,t,i,r,s,n,o){this.za=-1,this.Sd=e,this.Nj=t,this.La=i,this.Li=r,this.wA=s,this.mH=n,this.nd=o}return t.prototype.next=function(){var e=this.Sd.next();return null!=e?(this.za=this.Sd.Ma(),this.bL(e)):null},t.prototype.Ma=function(){return this.za},t.prototype.bL=function(t){var i=0>=this.mH?e.ta.lj(this.Nj,t,!1):this.mH;return e.AK.W(t,this.La,this.Li,this.wA,i,this.nd)},t.prototype.qe=function(){},t}();e.oL=t}($||($={})),function(e){var t;(t=e.FK||(e.FK={}))[t.clipToDomainOnly=1]="clipToDomainOnly",t[t.clipWithHorizon=2]="clipWithHorizon",t[t.foldAndClipWithHorizon=3]="foldAndClipWithHorizon";var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 0},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r){return t instanceof e.ba?(t=new e.$c(t),this.W(t,i,r).next()):new e.qL(t,i,r)},i.prototype.transform=function(t,i,r,s){return e.cu.transform(t,i,r,s,!0)},i.prototype.Rt=function(t,i,r,s){return e.cu.Rt(t,i,r,s)},i.instance=null,i}(e.Ge);e.Fx=i}($||($={})),function(e){var t=function(){function t(e,t,i){this.za=-1,this.Sd=e,this.CT=t,this.nd=i}return t.prototype.next=function(){var t=this.Sd.next();return null!=t?(this.za=this.Sd.Ma(),e.cu.Ah(t,this.CT,this.nd)):null},t.prototype.Ma=function(){return this.za},t.prototype.qe=function(){},t}();e.qL=t}($||($={})),function(e){var t=function(){function t(){}return t.prototype.reset=function(){this.qh=this.xk=-1,this.vs=this.mq=!1},t.prototype.sQ=function(e,t,i){for(e.Wb(t,i);e.Ia();){var r=e.ia();if(0!=(r=r.Rb()))return e.xb()}for(e.Wb(t,i);e.zz();)if(0!=(r=(r=e.mi()).Rb()))return e.xb();return-1},t.prototype.tQ=function(e,t){for(e.Wb(t,-1);e.zz();)if(0!=e.mi().Rb())return e.xb();return-1},t.prototype.rQ=function(e,t){for(e.Wb(t,-1),e.ia();e.Ia();)if(0!=e.ia().Rb())return e.xb();return-1},t.prototype.qQ=function(t,i,r,s){if(this.xk=this.sQ(i,r,s),-1!=this.xk){i.Wb(this.xk,-1);var n=i.ia(),o=n.ic(n.fe(t,!1));if(r=e.h.zc(o,t),(s=new e.h).N(o),s.sub(n.ac()),(o=new e.h).N(t),o.sub(n.ac()),this.mq=0>s.xi(o),this.qh=this.rQ(i,this.xk),-1!=this.qh){i.Wb(this.qh,-1);var a=(n=i.ia()).fe(t,!1);a=n.ic(a);var l=e.h.zc(a,t);l>r?this.qh=-1:(s.N(a),s.sub(n.ac()),o.N(t),o.sub(n.ac()),this.vs=0>s.xi(o))}-1==this.qh&&(this.qh=this.tQ(i,this.xk),-1!=this.qh&&(i.Wb(this.qh,-1),a=(n=i.ia()).fe(t,!1),a=n.ic(a),(l=e.h.zc(a,t))>r?this.qh=-1:(s.N(a),s.sub(n.ac()),o.N(t),o.sub(n.ac()),this.vs=0>s.xi(o),t=this.xk,this.xk=this.qh,this.qh=t,t=this.mq,this.mq=this.vs,this.vs=t)))}},t.prototype.VN=function(e,t,i,r,s){return i=i.Ha(),this.qQ(e,i,r,s),-1!=this.xk&&-1==this.qh?this.mq:-1!=this.xk&&-1!=this.qh?this.mq==this.vs?this.mq:(i.Wb(this.xk,-1),e=i.ia().jg(),i.Wb(this.qh,-1),t=i.ia().jg(),0<=e.xi(t)):t},t}(),i=function(i){function r(){return null!==i&&i.apply(this,arguments)||this}return Z(r,i),r.local=function(){return null===r.instance&&(r.instance=new r),r.instance},r.prototype.K=function(){return 3},r.prototype.iz=function(t,i,r){var s;if(void 0===s&&(s=!1),t.B())return new e.bm;i=i.D();var n=t,o=t.K();switch(197==o&&((n=new e.Ea).bd(t,!1),o=1736),o){case 33:return this.pI(n,i);case 550:return this.bI(n,i);case 1607:case 1736:return this.ST(n,i,r,s);default:throw e.i.ga("not implemented")}},r.prototype.jz=function(t,i){if(t.B())return new e.bm;i=i.D();var r=t,s=t.K();switch(197==s&&((r=new e.Ea).bd(t,!1),s=1736),s){case 33:return this.pI(r,i);case 550:case 1607:case 1736:return this.bI(r,i);default:throw e.i.ga("not implemented")}},r.prototype.kz=function(t,i,r,s){if(0>s)throw e.i.O();if(t.B())return[];i=i.D();var n=t,o=t.K();switch(197==o&&((n=new e.Ea).bd(t,!1),o=1736),o){case 33:return this.JU(n,i,r,s);case 550:case 1607:case 1736:return this.jU(n,i,r,s);default:throw e.i.ga("not implemented")}},r.prototype.ST=function(i,r,s,n){if(1736==i.K()&&s&&(s=new e.l,i.A(s),s=e.ta.Xd(null,s,!1),0!=(n?e.jd.Zd(i,r,0):e.jd.Zd(i,r,s)))){var o=new e.bm(r,0,0);return n&&o.OJ(!0),o}var a=i.Ha();o=new e.h;for(var l=s=-1,h=17976931348623157e292,c=0;a.ab();)for(;a.Ia();){var u=a.ia();u=u.ic(u.fe(r,!1));var p=e.h.zc(u,r);p<h?(c=1,o=u,s=a.xb(),l=a.gb,h=p):p==h&&c++}return o=new e.bm(o,s,Math.sqrt(h)),n&&(a.Wb(s,l),u=a.ia(),n=0>e.h.Wq(r,u.ac(),u.xc()),1<c&&((c=new t).reset(),n=c.VN(r,n,i,s,l)),o.OJ(n)),o},r.prototype.pI=function(t,i){return t=t.D(),i=e.h.ub(t,i),new e.bm(t,0,i)},r.prototype.bI=function(t,i){for(var r=t.vb(0),s=t.I(),n=t=0,o=0,a=17976931348623157e292,l=0;l<s;l++){var h=new e.h;r.uc(2*l,h);var c=e.h.zc(h,i);c<a&&(n=h.x,o=h.y,t=l,a=c)}return(i=new e.bm).ay(n,o,t,Math.sqrt(a)),i},r.prototype.JU=function(t,i,r,s){return 0==s?[]:(r*=r,t=t.D(),(i=e.h.zc(t,i))<=r?(r=[],(s=new e.bm).ay(t.x,t.y,0,Math.sqrt(i)),r[0]=s):r=[],r)},r.prototype.jU=function(t,i,r,s){if(0==s)return[];var n=t.vb(0),o=t.I();t=[],r*=r;for(var a=0;a<o;a++){var l=n.read(2*a),h=n.read(2*a+1),c=i.x-l,u=i.y-h;(c=c*c+u*u)<=r&&((u=new e.bm).ay(l,h,a,Math.sqrt(c)),t.push(u))}return i=t.length,t.sort((function(e,t){return e.La<t.La?-1:e.La==t.La?0:1})),s>=i||(t.length=s),t.slice(0)},r.instance=null,r}(e.Ge);e.Gx=i}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 4},i.prototype.W=function(t,i,r,s,n){return e.cm.sB(t,i,r,s,n)},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.Ju=function(t){return e.Wt.qy(t)},i.prototype.xn=function(t,i,r){e.Wt.uD(t,i,r)},i.instance=null,i}(e.Ge);e.rL=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 33},i.prototype.W=function(t,i,r,s,n){return 1073741824===t?!e.vd.tB(i,r,s,4,n):e.vd.tB(i,r,s,t,n)},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.Ju=function(t){return e.Wt.qy(t)},i.prototype.xn=function(t,i,r){e.Wt.uD(t,i,r)},i.instance=null,i}(e.Ge);e.ej=t}($||($={})),function(e){var t=function(){function t(t,i,r,s){if(this.nd=s,this.gT=r,this.za=-1,null==t)throw e.i.O();this.yk=t,this.Nj=i}return t.prototype.next=function(){var t;if(null!=(t=this.yk.next())){if(this.za=this.yk.Ma(),null!=this.nd&&!this.nd.progress(-1,-1))throw e.i.gu("user_canceled");return this.YB(t)}return null},t.prototype.Ma=function(){return this.za},t.prototype.YB=function(t){if(null==t)throw e.i.O();return e.Hx.VJ(t,this.Nj,this.gT,this.nd)},t.prototype.qe=function(){},t}();e.sL=t}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 26},i.prototype.W=function(t,i,r,s){return t instanceof e.ba?(t=new e.$c(t),this.W(t,i,r,s).next()):new e.sL(t,i,r,s)},i.prototype.ss=function(t,i,r,s,n){return 0<(void 0!==s?e.Hx.ss(t,i,r,s,n):e.Hx.ss(t,i,!1,null,r))},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.instance=null,i}(e.Ge);e.$l=t}($||($={})),function(e){var t=function(){function e(){this.Aq=0}return e.prototype.aX=function(e){this.Aq&=-2,this.Aq|=e?1:0},e.prototype.Yp=function(){return 0!=(1&this.Aq)},e.prototype.PF=function(){return this.Yp()?0:1},e}();e.lY=t;var i=function(){},r=function(e,t,i,r){this.x=e,this.y=t,this.Bi=i,this.zm=r},s=function(){function e(e){this.Ce=e}return e.prototype.compare=function(e,t,i){return e=e.ka(i),t=this.Ce.lf.read(2*t),0>(t-=e=this.Ce.lf.read(2*e))?-1:0<t?1:0},e}(),n=function(){function e(e){this.Ce=e}return e.prototype.compare=function(e,t,i){t=this.Ce.hb[t],e=this.Ce.hb[e.ka(i)];var r=t.Yp(),s=e.Yp();i=t.ne.Me(this.Ce.No,0);var n=e.ne.Me(this.Ce.No,0);return i==n&&((r=.5*((i=Math.min(r?t.ne.oa:t.ne.ma,s?e.ne.oa:e.ne.ma))-this.Ce.No)+this.Ce.No)==this.Ce.No&&(r=i),i=t.ne.Me(r,0),n=e.ne.Me(r,0)),i<n?-1:i>n?1:0},e}(),o=function(){function t(t,i){this.QI=new e.h,this.parent=t,this.VR=i}return t.prototype.qr=function(e,t,i){var r=this.parent,s=this.VR;i.Wd(e,t,(function(e,t){return r.Nh(e,t,s)}))},t.prototype.bq=function(e){return e=this.parent.hi.get(e),this.parent.lf.uc(2*(e>>1),this.QI),this.QI.y+(0!=(1&e)?this.parent.Pj:-this.parent.Pj)},t}(),a=function(){function a(t,i,r,s,n){this.fH=t.description,this.Y=t,this.Rg=i,this.Pj=e.ta.lj(this.Rg,t,!1),this.Co=e.ta.lj(this.Rg,t,!0),this.rA=r,this.eT=this.fH.Ba,this.hb=[],this.qo=[],this.nh=new e.kp,this.fb=new e.Yj,this.ke=new e.Nd,this.QG=this.sl=n}return a.prototype.VS=function(){return this.QG=!0,(!e.ba.Ic(this.Y.K())||this.yE()&&this.vE(!1))&&this.eO()?e.ba.Ic(this.Y.K())?this.hO()?1607==this.Y.K()?this.jO()?2:0:this.kO()?this.lO():0:0:2:0},a.prototype.dC=function(t,i){var r=this.lf.read(2*t);t=this.lf.read(2*t+1);var s=this.lf.read(2*i);return i=this.lf.read(2*i+1),!e.Zt.Dv(r,t,s,i,this.Pj*this.Pj)||0!=this.Y.Eb()&&r==s&&t==i},a.prototype.yE=function(){for(var t=this.Y,i=t.yf?3:2,r=0,s=t.ea();r<s;r++)if(t.Ka(r)<i)return this.ke=new e.Nd(1,r,0),!1;return!0},a.prototype.vE=function(t){var i=this.Y,r=i.Ha(),s=i.hasAttribute(1);for(i=s?e.ta.oE(this.Rg,i,!1):0;r.ab();)for(;r.Ia();){var n=r.ia();if(!(n.Rb()>this.Pj)){if(t&&s){var o=n.xv(1,0);if(n=n.xv(1,0),Math.abs(n-o)>i)continue}return this.ke=new e.Nd(2,r.xb(),-1),!1}}return!0},a.prototype.eO=function(){var t=this.Y,i=null;e.ba.Ic(this.Y.K())&&(i=this.Y);var r=(this.QG||this.sl)&&null!=i,n=t.I();this.lf=t.vb(0),this.hi=new e.ja(0),this.hi.Jb(2*n),this.gi=new e.ja(0),this.gi.Jb(2*n),r&&(null==this.Hl&&(this.Hl=new e.ja(0)),this.Hl.Jb(n));for(var a=t=0;a<n;a++)if(this.hi.add(2*a),this.hi.add(2*a+1),this.gi.add(2*a),this.gi.add(2*a+1),r){for(;a>=i.Wc(t);)t++;this.Hl.add(t)}for((new e.Yt).sort(this.gi,0,2*n,new o(this,r)),this.fb.clear(),this.fb.Wo(new s(this)),this.fb.Ee(n),i=0,n*=2;i<n;i++)if(r=this.gi.get(i),r=(t=this.hi.get(r))>>1,0==(1&t)){if(t=this.fb.addElement(r,-1),-1!=(a=this.fb.xe(t))&&!this.dC(this.fb.ka(a),r))return this.ke=new e.Nd(3,r,this.fb.ka(a)),!1;var l=this.fb.lb(t);if(-1!=l&&!this.dC(this.fb.ka(l),r))return this.ke=new e.Nd(3,r,this.fb.ka(l)),!1}else if(t=this.fb.search(r,-1),a=this.fb.xe(t),l=this.fb.lb(t),this.fb.wd(t,-1),-1!=a&&-1!=l&&!this.dC(this.fb.ka(a),this.fb.ka(l)))return this.ke=new e.Nd(3,this.fb.ka(a),this.fb.ka(l)),!1;return!0},a.prototype.hO=function(){return 10>this.Y.I()?this.fO():this.gO()},a.prototype.gO=function(){var t=new e.hd;t.Ib(this.Y);var i=new e.Nd;return!e.au.cI(!1,t,this.Pj,i,this.nd)||(i.Ko=t.Va(i.Ko),i.Lo=t.Va(i.Lo),this.ke.Xt(i),!1)},a.prototype.fO=function(){var t=this.Y,i=t.Ha();for(t=t.Ha();i.ab();)for(;i.Ia();){var r=i.ia();if(!i.Rn()||!i.QS()){t.rW(i);do{for(;t.Ia();){var s=t.ia();if(0!=(s=r.Br(s,this.Pj,!0)))return this.ke=new e.Nd(2==s?5:4,i.xb(),t.xb()),!1}}while(t.ab())}}return!0},a.prototype.kO=function(){var t=this.Y;this.hb.length=0,this.qo.length=0,this.$f=t.Ha(),this.$f.DB();var i=new e.ja(0);i.Jb(10);var r=NaN,s=0,n=0;for(t=2*t.I();n<t;n++){var o=this.gi.get(n);if(0==(1&(o=this.hi.get(o)))){o>>=1;var a=this.lf.read(2*o),l=this.lf.read(2*o+1);if(0!=i.size&&(a!=r||l!=s)){if(!this.II(i))return!1;null!=i&&i.clear(!1)}i.add(o),r=a,s=l}}return!!this.II(i)},a.prototype.jO=function(){for(var t=this.Y,r=Array(t.ea()),s=0,n=t.ea();s<n;s++)r[s]=t.On(s);n=new i;var o=new e.h;s=this.gi.get(0);var a=(s=this.hi.get(s))>>1;this.lf.uc(2*a,o);var l=r[s=this.Hl.get(a)],h=t.Ca(s),c=t.Wc(s)-1;n.fl=a==h||a==c,n.iy=this.sl?!l&&n.fl:n.fl,n.Bi=s,n.x=o.x,n.y=o.y,n.zm=a;for(var u=new i,p=1,d=this.gi.size;p<d;p++)if(s=this.gi.get(p),0==(1&(s=this.hi.get(s)))){a=s>>1,this.lf.uc(2*a,o),(s=this.Hl.get(a))!=n.Bi&&(l=r[s],h=t.Ca(s),c=t.Wc(s)-1);var f=a==h||a==c,y=this.sl?!l&&n.fl:n.fl;if(u.x=o.x,u.y=o.y,u.Bi=s,u.zm=a,u.iy=y,u.fl=f,u.x==n.x&&u.y==n.y)if(this.sl){if(!(u.iy&&n.iy||u.Bi==n.Bi&&(u.fl||n.fl)))return this.ke=new e.Nd(8,u.zm,n.zm),!1}else if(!u.fl||!n.fl)return this.ke=new e.Nd(5,u.zm,n.zm),!1;s=n,n=u,u=s}return!0},a.prototype.BE=function(){for(var t=this.Y,i=[],s=-1,n=!1,o=0,a=t.ea();o<a;o++)t.Fv(o)&&(n=!1,s++,o<a-1&&(t.Fv(o+1)||(n=!0))),i[o]=n?s:-1;n=new e.h,o=this.gi.get(0);var l=(o=this.hi.get(o))>>1;this.lf.uc(2*l,n),o=this.Hl.get(l),s=new r(n.x,n.y,o,l,i[o]),t=[];var h=1;for(a=this.gi.size;h<a;h++)if(o=this.gi.get(h),0==(1&(o=this.hi.get(o)))){if(l=o>>1,this.lf.uc(2*l,n),o=this.Hl.get(l),(o=new r(n.x,n.y,o,l,i[o])).x==s.x&&o.y==s.y){if(o.Bi==s.Bi)return this.ke=new e.Nd(9,o.zm,s.zm),!1;0<=i[o.Bi]&&i[o.Bi]==i[s.Bi]&&(0!=t.length&&t[t.length-1]==s||t.push(s),t.push(o))}s=o}if(0==t.length)return!0;for(o=new e.kp(!0),e.P.av(i,-1),n=-1,(h=new e.h).Sc(),s=0,a=t.length;s<a;s++){(l=t[s]).x==h.x&&l.y==h.y||(n=o.Qh(0),h.x=l.x,h.y=l.y);var c=i[l.Bi];-1==c&&(c=o.Qh(2),i[l.Bi]=c),o.addElement(c,n),o.addElement(n,c)}for((a=new e.ja(0)).Jb(10),s=o.je;-1!=s;s=o.lz(s))if(0==(1&(t=o.HF(s)))&&0!=(2&t)){for(t=-1,a.add(s),a.add(-1);0<a.size;){if(n=a.Gc(),a.Jf(),h=a.Gc(),a.Jf(),0!=(1&(l=o.HF(h)))){t=0==(2&l)?n:h;break}for(o.TW(h,1|l),l=o.sc(h);-1!=l;l=o.lb(l))(c=o.getData(l))!=n&&(a.add(c),a.add(h))}if(-1!=t){for(o=-1,s=0,a=i.length;s<a;s++)if(i[s]==t){o=s;break}return this.ke=new e.Nd(10,o,-1),!1}}return!0},a.prototype.lO=function(){var t=this.Y;if(0>=t.He())return this.ke=new e.Nd(6,1==t.ea()?1:-1,-1),0;if(1==t.ea())return this.sl&&!this.BE()?0:2;this.uo=e.ja.rf(t.ea(),0),this.DA=e.ja.rf(t.ea(),-1);for(var i=-1,r=0,s=0,o=t.ea();s<o;s++){var a=t.Kr(s);if(this.uo.write(s,0>a?0:256),0<a)i=s,r=a;else{if(0==a)return this.ke=new e.Nd(6,s,-1),0;if((0>i||r<Math.abs(a))&&(this.ke=new e.Nd(7,s,-1),this.sl))return 0;this.DA.write(s,i)}}for(this.dt=t.ea(),this.Qm=new e.ja(0),this.Qm.Jb(10),o=t.I(),this.No=NaN,(t=new e.ja(0)).Jb(10),this.Sq=e.ja.rf(o,-1),this.Iw=e.ja.rf(o,-1),null!=this.Aj?this.Aj.clear(!1):this.Aj=new e.ja(0),this.Aj.Jb(10),this.fb.clear(),this.fb.Wo(new n(this)),i=0,o*=2;0<this.dt&&i<o;i++)if(r=this.gi.get(i),0==(1&(r=this.hi.get(r)))){if(r>>=1,(s=this.lf.read(2*r+1))!=this.No&&0!=t.size){if(!this.ut(t))return 0;null!=t&&t.clear(!1)}t.add(r),this.No=s}return 0<this.dt&&!this.ut(t)?0:this.sl?0==this.ke.Kj&&this.BE()?2:0:0==this.ke.Kj?2:1},a.prototype.II=function(t){if(1==t.size)return!0;for(var i=0,r=t.size;i<r;i++){var s=t.get(i);this.$f.Wb(s);var n=this.$f.mi();this.hb.push(this.Uu(n,s,this.$f.gb,!0)),this.$f.ia(),n=this.$f.ia(),this.hb.push(this.Uu(n,s,this.$f.gb,!1))}var o=this;for(this.hb.sort((function(e,t){return o.PP(e,t)})),-1==(s=this.nh.je)&&(s=this.nh.Qh(0)),this.nh.hn(this.hb.length),i=0,r=this.hb.length;i<r;i++)this.nh.addElement(s,i);i=!0;for(var a=r=-1;i&&(i=!1,-1!=(n=this.nh.sc(s)));)for(var l=this.nh.lb(n);-1!=l;)if(r=this.nh.getData(n),a=this.nh.getData(l),(r=this.hb[r].Jo)!=(a=this.hb[a].Jo))n=l,l=this.nh.lb(n);else if(i=!0,this.nh.kd(s,n),n=this.nh.xe(l),-1==(l=this.nh.kd(s,l))||-1==n)break;if(i=this.nh.cs(s),this.nh.DE(s),0<i)return this.ke=new e.Nd(5,r,a),!1;for(i=0,r=t.size;i<r;i++)this.pB(this.hb[i]);return this.hb.length=0,!0},a.prototype.ut=function(t){for(var i=0,r=t.size;i<r;i++){var s=t.get(i),n=this.Sq.read(s);if(-1!=n){var o=this.fb.ka(n);this.Aj.add(o),this.fb.wd(n,-1),this.pB(this.hb[o]),this.hb[o]=null,this.Sq.write(s,-1)}-1!=(n=this.Iw.read(s))&&(o=this.fb.ka(n),this.Aj.add(o),this.fb.wd(n,-1),this.pB(this.hb[o]),this.hb[o]=null,this.Iw.write(s,-1))}for(i=0,r=t.size;i<r;i++){if(s=t.get(i),this.$f.Wb(s),(n=this.$f.mi()).oa>n.ma){var a=this.$f.xb(),l=this.Uu(n,s,this.$f.gb,!0);0<this.Aj.size?(o=this.Aj.Gc(),this.Aj.Jf(),this.hb[o]=l):(o=this.hb.length,this.hb.push(l)),n=this.fb.addElement(o,-1),-1==this.Sq.read(a)?this.Sq.write(a,n):this.Iw.write(a,n),0==(3&this.uo.read(this.$f.gb))&&this.Qm.add(n)}this.$f.ia(),(n=this.$f.ia()).oa<n.ma&&(a=this.$f.ik(),l=this.Uu(n,s,this.$f.gb,!1),0<this.Aj.size?(o=this.Aj.Gc(),this.Aj.Jf(),this.hb[o]=l):(o=this.hb.length,this.hb.push(l)),n=this.fb.addElement(o,-1),-1==this.Sq.read(a)?this.Sq.write(a,n):this.Iw.write(a,n),0==(3&this.uo.read(this.$f.gb))&&this.Qm.add(n))}for(i=0,r=this.Qm.size;i<r&&0<this.dt;i++)if(n=this.Qm.get(i),0==(3&this.uo.read(this.hb[this.fb.ka(n)].CA))){t=-1,s=this.fb.xe(n);var h=n;l=null,o=-1;for(var c=0;-1!=s&&(o=this.fb.ka(s),o=(l=this.hb[o]).CA,0==(3&(c=this.uo.read(o))));)h=s,s=this.fb.xe(s);-1==s?(a=1,s=h):(t=1==(3&c)?o:this.DA.read(o),a=0!=l.PF()?0:1,s=this.fb.lb(s));do{if(o=this.fb.ka(s),o=(l=this.hb[o]).CA,0==(3&(h=this.uo.read(o)))){if(a!=l.PF())return this.ke=new e.Nd(6,o,-1),!1;if(h=252&h|(c=0==a||l.Yp()?2:1),this.uo.write(o,c),2==c&&0==this.ke.Kj&&this.DA.read(o)!=t&&(this.ke=new e.Nd(7,o,-1),this.sl))return!1;if(this.dt--,0==this.dt)return!0}1==(3&h)&&(t=o),h=s,s=this.fb.lb(s),a=0!=a?0:1}while(h!=n)}return null!=this.Qm?this.Qm.clear(!1):this.Qm=new e.ja(0),!0},a.prototype.Uu=function(t,i,r,s){if(322!=t.K())throw e.i.Ra();return(t=this.kP(t)).Jo=i,t.CA=r,t.Aq=0,t.aX(s),t},a.prototype.kP=function(i){if(0<this.qo.length){var r=this.qo[this.qo.length-1];--this.qo.length,i.copyTo(r.ne)}else(r=new t).ne=e.KC.ig(i);return r},a.prototype.pB=function(e){322==e.ne.K()&&this.qo.push(e)},a.prototype.aU=function(){for(var t=this.Y.I(),i=new e.ja(0),r=0;r<t;r++)i.add(r);var s=this;for(i.Wd(0,t,(function(e,t){return s.Qu(e,t)})),r=1;r<t;r++)if(0==this.Qu(i.get(r-1),i.get(r)))return this.ke=new e.Nd(3,i.get(r-1),i.get(r)),0;return 2},a.prototype.zV=function(){return this.yE()&&this.vE(!0)?2:0},a.prototype.eV=function(){return this.VS()},a.prototype.fU=function(){for(var t=this.Y.I(),i=new e.ja(0),r=0;r<t;r++)i.add(r);var s=this;i.Wd(0,t,(function(e,t){return s.HO(e,t)}));var n=Array(t);for(e.P.av(n,!1),n[i.get(0)]=!0,r=1;r<t;r++){var o=i.get(r-1),a=i.get(r);0==this.Qu(o,a)?n[a]=!1:n[a]=!0}i=this.Y.Ja(),o=this.Y,a=0;var l=1;for(r=0;r<t;r++)n[r]?l=r+1:(a<l&&i.Gd(o,a,l),a=r+1);return a<l&&i.Gd(o,a,l),i.Dh(2,this.Co),i},a.prototype.DV=function(){var t=this.Y,i=t.Ha(),r=t.Ha(),s=this.Y.Ja(),n=this.Y,o=t.hasAttribute(1),a=o?e.ta.oE(this.Rg,t,!0):0,l=new e.ja(0),h=new e.ja(0);for(l.Jb(e.P.truncate(t.I()/2+1)),h.Jb(e.P.truncate(t.I()/2+1));i.ab();)if(r.ab(),!(2>t.Ka(i.gb))){r.tW();for(var c,u,p=!0;i.Ia();){var d=i.ia(),f=r.mi();if(i.xb()>r.xb())break;p&&(l.add(i.xb()),h.add(r.ik()),p=!1),u=l.Gc();var y=i.ik();if(1<y-u){var g=new e.h;g.vc(t.Oa(u),t.Oa(y)),c=g.length()}else c=d.Rb();u=h.Gc(),1<(y=r.xb())-u?((g=new e.h).vc(t.Oa(u),t.Oa(y)),u=g.length()):u=f.Rb(),c>this.Co?l.add(i.ik()):o&&(c=t.Vc(1,l.Gc(),0),d=d.hv(1,0),Math.abs(d-c)>a&&l.add(i.ik())),u>this.Co?h.add(r.xb()):o&&(c=t.Vc(1,h.Gc(),0),d=f.hv(1,0),Math.abs(d-c)>a&&h.add(r.xb()))}if(l.Gc()<h.Gc()?l.size>h.size?l.Jf():h.Jf():(l.Gc()!=h.Gc()&&h.Jf(),h.Jf()),2<=h.size+l.size){for(p=new e.Ta,f=0,d=l.size;f<d;f++)n.we(l.get(f),p),0==f?s.nf(p):s.lineTo(p);for(f=h.size-1;0<f;f--)n.we(h.get(f),p),s.lineTo(p);n.ec(i.gb)?s.Cp():0<h.size&&(n.we(h.get(0),p),s.lineTo(p))}null!=l&&l.clear(!1),null!=h&&h.clear(!1)}return s.Dh(2,this.Co),s},a.prototype.hV=function(){return this.rX()},a.prototype.rX=function(){return 1736==this.Y.K()&&1==this.Y.Jn()?e.Hg.Mk(this.Y,this.Co,!0,!1,this.nd):(this.Ii=new e.hd,this.Ii.Ib(this.Y),0!=this.Ii.gd&&(1!=this.rA&&e.Tk.W(this.Ii,this.Co,this.nd,!0),1736==this.Y.K()&&e.tn.W(this.Ii,this.Ii.ld,this.rA,!1,this.nd)),this.Y=this.Ii.Ke(this.Ii.ld),1736==this.Y.K()&&(this.Y.hm(),this.Y.Zo(0)),this.Y.Dh(2,this.Co),this.Y)},a.ss=function(t,i,r,s,n){if(null!=s&&(s.Kj=0,s.Ko=-1,s.Lo=-1),t.B())return 1;var o=t.K();if(33==o)return 1;var l=e.ta.lj(i,t,!1);if(197==o)return i=new e.l,t.A(i),i.Ci(l)?(null!=s&&(s.Kj=2,s.Ko=-1,s.Lo=-1),0):1;if(e.ba.zd(o))return(l=new e.Ua(t.description)).oc(t,!0),a.ss(l,i,r,s,n);var h=t.qm(l);if(-1!=(r=r?-1:h))return r;if(i=new a(t,i,r,n,!1),550==o)r=i.aU();else if(1607==o)r=i.zV();else{if(1736!=o)throw e.i.Ra();r=i.eV()}return t.Dh(r,l),null!=s&&0==r&&s.Xt(i.ke),r},a.VJ=function(t,i,r,s){if(t.B())return t;var n=t.K();if(33==n)return t;var o=e.ta.lj(i,t,!1);if(197==n)return i=new e.l,t.A(i),i.Ci(o)?t.Ja():t;if(e.ba.zd(n))return(n=new e.Ua(t.description)).oc(t,!0),a.VJ(n,i,r,s);if(o=t.qm(o),2==(r=r?-1:o))return t;if(t=new a(t,i,r,s,!1),550==n)t=t.fU();else if(1607==n)t=t.DV();else{if(1736!=n)throw e.i.Ra();t=t.hV()}return t},a.prototype.Nh=function(t,i,r){if(t==i)return 0;t=this.hi.get(t);var s=this.hi.get(i);i=t>>1;var n=s>>1,o=new e.h,a=new e.h;return this.lf.uc(2*i,o),o.y+=0!=(1&t)?this.Pj:-this.Pj,this.lf.uc(2*n,a),a.y+=0!=(1&s)?this.Pj:-this.Pj,0==(t=o.compare(a))&&r?0>(r=this.Hl.get(i)-this.Hl.get(n))?-1:0<r?1:0:t},a.prototype.Qu=function(t,i){if(t==i)return 0;var r=this.Y,s=r.Oa(t),n=r.Oa(i);if(s.x<n.x)return-1;if(s.x>n.x)return 1;if(s.y<n.y)return-1;if(s.y>n.y)return 1;for(s=1;s<this.eT;s++){n=this.fH.qd(s);for(var o=e.ua.Wa(n),a=0;a<o;a++){var l=r.Vc(n,t,a),h=r.Vc(n,i,a);if(l<h)return-1;if(l>h)return 1}}return 0},a.prototype.HO=function(e,t){var i=this.Qu(e,t);return 0==i?e<t?-1:1:i},a.prototype.PP=function(e,t){if(e===t)return 0;var i=e.ne.jg();e.Yp()&&i.Uq(),e=t.ne.jg(),t.Yp()&&e.Uq(),t=i.ru();var r=e.ru();return r==t?(t=i.xi(e),Math.abs(t)<=8881784197001252e-31*(Math.abs(e.x*i.y)+Math.abs(e.y*i.x))&&(t--,t++),0>t?1:0<t?-1:0):t<r?-1:1},a}();e.Hx=a}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 30},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.prototype.W=function(t,i,r,s){return t instanceof e.ba?(t=new e.$c(t),i=new e.$c(i),this.W(t,i,r,s).next()):new e.tL(t,i,r,s)},i.fp=function(t,r,s,n){var o=t.Eb(),a=r.Eb();if(t.B()&&r.B())return o>a?t:r;if(t.B())return r;if(r.B())return t;var l=new e.l,h=new e.l,c=new e.l;return t.A(l),r.A(h),c.L(l),c.$b(h),l=e.ta.Xd(s,c,!0),h=t.K(),c=r.K(),33==h&&33==c?i.RU(t,r,l):h!=c?0<o||0<a?o>a?t:r:550==h?i.aI(t,r,l):i.aI(r,t,l):e.Hg.fp(t,r,s,n)},i.RU=function(t,i,r){r=r*Math.sqrt(2)*1.00001,r*=r;var s=t.D(),n=i.D(),o=new e.de(t.description);return e.h.zc(s,n)>r&&(o.add(t),o.add(i)),o},i.aI=function(t,i,r){var s=t.vb(0),n=t.I(),o=i.D(),a=t.Ja();r=r*Math.sqrt(2)*1.00001;var l=new e.l;if(t.A(l),l.X(r,r),l.contains(o)){r*=r,l=!1;for(var h=[],c=0;c<n;c++)h[c]=!1;for(c=0;c<n;c++){var u=s.read(2*c),p=s.read(2*c+1);(u-=o.x)*u+(p-=o.y)*p<=r&&(l=!0,h[c]=!0)}if(l)for(c=0;c<n;c++)h[c]||a.Gd(t,c,c+1);else a.Gd(t,0,n),a.add(i)}else a.Gd(t,0,n),a.add(i);return a},i.instance=null,i}(e.Ge);e.Ix=t}($||($={})),function(e){var t=function(){function t(e,t,i,r){this.us=null==t,this.za=-1,this.Sd=e,this.vg=i,this.DT=t.next(),this.Vb=r}return t.prototype.next=function(){return this.us?null:null!=(t=this.Sd.next())?(this.za=this.Sd.Ma(),e.Ix.fp(t,this.DT,this.vg,this.Vb)):null;var t},t.prototype.Ma=function(){return this.za},t.prototype.qe=function(){},t}();e.tL=t}($||($={})),function(e){var t=function(){function e(){}return e.prototype.Az=function(){this.Vy=null,this.yx=-1,this.sK=!1},e}(),i=function(){function e(){this.Ir=0,this.qj=[]}return e.prototype.hN=function(e){this.Ir+=e.yx,this.qj.push(e)},e.prototype.JV=function(){this.Ir-=this.qj[this.qj.length-1].yx,--this.qj.length},e.prototype.hy=function(){return this.qj[this.qj.length-1]},e.prototype.Nb=function(e){return e===this},e}(),r=function(){function r(e,t,i){this.za=-1,this.Jc=!1,this.sH=[!1,!1,!1,!1],this.wq=[0,0,0,0],this.eA=!1,this.zk=-1,this.kq=0,this.co=-1,this.Eo=[],this.Sd=e,this.vg=t,this.Vb=i}return r.WD=function(e){var t=[],i=0;for(e=Object.keys(e);i<e.length;i++)t.push(Number(e[i]));return t.sort((function(e,t){return e-t})),t},r.prototype.YF=function(t){var i=this.Eo[t],s=r.WD(i)[0],n=i[s],o=n.hy().Vy;return n=n.hy().sK,delete i[s],n&&(o=e.$l.local().W(o,this.vg,!1,this.Vb),0==t&&33==o.K()&&(t=new e.de(o.description),o.B()||t.add(o),o=t)),o},r.prototype.next=function(){if(this.Jc&&this.co==this.zk)return null;for(;!this.iK(););if(-1==this.zk)return null;if(this.eA){for(this.co++;;){if(this.co>this.zk||0>this.co)throw e.i.Ra();if(this.sH[this.co])break}return this.za++,this.YF(this.co)}return this.za=0,this.co=this.zk,this.YF(this.zk)},r.prototype.Ma=function(){return this.za},r.prototype.iK=function(){if(this.Jc)return!0;var t=null;if(null!=this.Sd&&null==(t=this.Sd.next())&&(this.Jc=!0,this.Sd=null),e.np.Bp(this.Vb),null!=t){var i=t.Eb();this.sH[i]=!0,i>=this.zk&&!this.eA&&(this.ED(i,!1,t),i>this.zk&&!this.eA&&this.pW(i))}if(0<this.kq)for(i=0;i<=this.zk;i++)for(;1<this.wq[i]&&0!=(t=this.xO(i)).length;)t=e.Hg.NP(t,this.vg,this.Vb),this.ED(i,!0,t);return this.Jc},r.prototype.xO=function(e){for(var t=[],i=[],s=this.Eo[e],n=r.WD(s),o=0;o<n.length;o++){var a=n[o],l=s[a];if(this.Jc||1e4<l.Ir&&1<l.qj.length){for(this.wq[e]-=l.qj.length,this.kq-=l.qj.length;0<l.qj.length;)t.push(l.hy().Vy),l.JV();i.push(a)}}for(o=0;o<i.length;o++)delete s[i[o]];return t},r.prototype.pW=function(e){for(var t=0;t<e;t++)this.Eo[t]=[],this.kq-=this.wq[t],this.wq[t]=0},r.prototype.ED=function(e,s,n){var o=new t;if(o.Az(),o.Vy=n,n=r.WR(n),o.yx=n,n=r.UR(n),e+1>this.Eo.length)for(var a=0,l=Math.max(2,e+1);a<l;a++)this.Eo.push([]);void 0===(a=this.Eo[e][n])&&(a=new i,this.Eo[e][n]=a),o.sK=s,a.hN(o),this.wq[e]++,this.kq++,this.zk=Math.max(this.zk,e)},r.UR=function(t){return 0<t?e.P.truncate(Math.log(t)/Math.log(4)+.5):0},r.WR=function(t){var i=t.K();if(e.ba.yj(i))return t.I();if(33==i)return 1;if(197==i)return 4;if(e.ba.zd(i))return 2;throw e.i.Ra()},r.prototype.qe=function(){this.iK()},r}();e.vL=r}($||($={})),function(e){var t=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Z(i,t),i.prototype.K=function(){return 1},i.prototype.W=function(t,i,r,s){return void 0===s?new e.vL(t,i,r):this.ZP(t,i,r,s)},i.prototype.ZP=function(t,i,r,s){return t=new e.$c([t,i]),this.W(t,r,s).next()},i.local=function(){return null===i.instance&&(i.instance=new i),i.instance},i.instance=null,i}(e.Ge);e.Hh=t}($||($={})),function(e){var t,i;(i=t||(t={}))[i.nextPath=0]="nextPath",i[i.nextSegment=1]="nextSegment",i[i.iterate=2]="iterate",t=function(){function t(t,i,r,s){this.Us=new e.l,this.wT=t,this.xT=i,this.oq=s,this.vo=-1,this.tl=!1;var n=t.Cb;null!=n&&null!=(n=s?n.Ao:n.Gb)&&(this.Jc=!1,this.ra=r,this.Gb=n,this.yw=this.Gb.getIterator(),this.pq=this.tl=!0,this.Yb=0,s?this.vo=i.ea():this.td=i.Ha()),this.tl||null!=(n=i.Cb)&&null!=(n=s?n.Ao:n.Gb)&&(this.Jc=!1,this.ra=r,this.Gb=n,this.yw=this.Gb.getIterator(),this.tl=!0,this.pq=!1,this.Yb=0,s?this.vo=t.ea():this.td=t.Ha()),this.tl||(this.di=s?e.ta.eR(t,i,r,1<=t.qm(0),1<=i.qm(0)):e.ta.dR(t,i,r))}return t.prototype.next=function(){if(this.tl){if(this.Jc)return!1;for(var t=!0;t;)switch(this.Yb){case 0:t=this.nU();break;case 1:t=this.oU();break;case 2:t=this.Pz();break;default:throw e.i.ga("internal error")}return!this.Jc}return null!=this.di&&this.di.next()},t.prototype.pl=function(){return this.tl?this.pq?this.Gb.ka(this.Gs):this.oq?this.vo:this.td.xb():this.di.pl(this.di.Wf)},t.prototype.jl=function(){return this.tl?this.pq?this.oq?this.vo:this.td.xb():this.Gb.ka(this.Gs):this.di.jl(this.di.Bf)},t.prototype.oz=function(){if(!this.oq)throw e.i.ga("internal error");return this.tl?this.pq?this.Gb.yF(this.Gs):this.Us:this.di.oz(this.di.Wf)},t.prototype.Wy=function(){if(!this.oq)throw e.i.ga("internal error");return this.tl?this.pq?this.Us:this.Gb.yF(this.Gs):this.di.Wy(this.di.Bf)},t.prototype.nU=function(){return this.oq?-1==--this.vo?(this.Jc=!0,!1):(this.pq?this.xT.Sj(this.vo,this.Us):this.wT.Sj(this.vo,this.Us),this.yw.Yi(this.Us,this.ra),this.Yb=2,!0):this.td.ab()?(this.Yb=1,!0):(this.Jc=!0,!1)},t.prototype.oU=function(){if(!this.td.Ia())return this.Yb=0,!0;var e=this.td.ia();return this.yw.Vo(e,this.ra),this.Yb=2,!0},t.prototype.Pz=function(){return this.Gs=this.yw.next(),-1==this.Gs&&(this.Yb=this.oq?0:1,!0)},t}(),e.am=t}($||($={})),function(e){(e=e.GL||(e.GL={}))[e.enumClosed=1]="enumClosed",e[e.enumHasNonlinearSegments=2]="enumHasNonlinearSegments",e[e.enumOGCStartPolygon=4]="enumOGCStartPolygon",e[e.enumCalcMask=4]="enumCalcMask"}($||($={})),function(e){e.IC=function(){function t(){}return t.ub=function(i,r,s,n,o,a,l,h,c){var u=[0,0,0],p=[0,0,0],d=[0,0,0],f=[0,0,0,0],y=new e.ha(0),g=new e.ha(0),m=new e.ha(0);if(null!=l||null!=h||null!=c)if(e.s.ui(r))e.Zg.ub(i,s,n,o,a,l,h,c);else{o=e.F.ca(o),s=e.F.ca(s);var v=e.F.ca(o-s);if(e.s.$(n,a)&&(e.s.$(s,o)||e.s.$(e.s.R(n),1.570796326794897)))null!=l&&(l.u=0),null!=h&&(h.u=0),null!=c&&(c.u=0);else{if(e.s.$(n,-a)){if(e.s.$(e.s.R(n),1.570796326794897))return null!=l&&(l.u=2*e.F.Bh(i,r)),null!=h&&(h.u=0<n?e.F.ca(3.141592653589793-e.F.ca(o)):e.F.ca(o)),void(null!=c&&(c.u=0<n?e.F.ca(o):e.F.ca(3.141592653589793-e.F.ca(o))));e.s.$(e.s.R(v),3.141592653589793)&&(null!=l&&(l.u=2*e.F.Bh(i,r)),null!=h&&(h.u=0),null!=c&&(c.u=0))}else{if(e.s.$(e.s.R(n),1.570796326794897)||e.s.$(e.s.R(a),1.570796326794897))return void e.Xk.ub(i,r,s,n,o,a,l,h,c);if(e.s.$(s,o)||e.s.$(e.s.R(v),3.141592653589793))return void e.Xk.ub(i,r,s,n,o,a,l,h,c);if(e.s.Dd(n))return void e.Xk.ub(i,r,s,n,o,a,l,h,c)}var b=Math.sqrt(1-r);o=e.F.ca(o-s),s=0,e.F.dl(1,r,n,s,0,y,g,m),u[0]=y.u,u[1]=g.u,u[2]=m.u,e.F.dl(1,r,a,o,0,y,g,m),p[0]=y.u,p[1]=g.u,p[2]=m.u,d[0]=0,d[1]=0,d[2]=-1*r*e.F.n(1,r,n)*Math.sin(n),0>o?e.F.Yq(d,p,u,f,0):e.F.Yq(d,u,p,f,0),g=[0,0,0],m=[0,0,0];var w=[0,0,0];u=[0,0,0],y=[0,0,0];var _=Math.acos(f[2]/1),x=1-r,S=Math.tan(_),M=1+S*S/x,T=2*d[2]*S/x;for(x=(-T+(S=Math.sqrt(T*T-4*M*(d[2]*d[2]/x-1))))/(M*=2),T=(-T-S)/M,S=Math.tan(_),_=(x+T)/2,d=((M=S*x+d[2])+(S*T+d[2]))/2,S=e.F.hp(x-_,M-d),x=d/b*1.570796326794897,T=0;100>T&&(M=(M=e.F.w(r,x))*M/Math.cos(x)*(Math.sin(x)-d*M/(1-r)),!e.s.Dd(M));T++)x-=M;d=e.F.n(1,r,x)*Math.cos(x),S=1-S/(d=Math.sqrt((d-_)*(d+_))),S*=2-S,M=e.F.qn(g),_=e.F.qn(m),x=e.F.qn(w);var I=e.F.Tt(w,g);T=e.F.Tt(w,m),e.F.xx(w,g,u),e.F.xx(w,m,y),g=Math.acos(I/(x*M)),m=Math.acos(T/(x*_)),m*=e.s.Mb(1,e.F.Tt(u,y)),(1.570796326794897<=e.s.R(g)&&1.570796326794897<=e.s.R(m)||3.141592653589793<e.s.R(g-m))&&(g=(3.141592653589793-e.s.R(g))*e.s.Mb(1,g),m=(3.141592653589793-e.s.R(m))*e.s.Mb(1,m)),u=e.F.Rj(S,m),y=e.F.q(d,S,e.F.Rj(S,g)),u=e.F.q(d,S,u),u=e.s.R(u-y)*i,g=new e.ha(0),m=new e.ha(0),w=f[1]/1,w*=-e.s.Mb(1,v),y=Math.acos(w)*e.s.Mb(1,v),t.sf(i,r,s,n,u,y,g,m),e.s.$(o,g.u)&&e.s.$(a,m.u)||(S=e.F.hp(e.F.ca(o-g.u),a-m.u),t.sf(i,r,s,n,u,e.F.ca(y+3.141592653589793),g,m),(M=e.F.hp(e.F.ca(o-g.u),a-m.u))<S&&(y=e.F.ca(y+3.141592653589793))),g=[0,0,0,0],m=[0,0,0,0],S=[0,0,0],i=[0,0,0],s=[0,0,0],n=[0,0,0],w=[0,0,0],(d=[0,0,0])[0]=0,d[1]=0,d[2]=b,S[0]=0,S[1]=0,S[2]=0,e.F.Yq(S,d,p,g,0),e.s.Dd(a)?(i[0]=p[0],i[1]=p[1],i[2]=1,s[0]=1*Math.cos(o)-1*Math.sin(o),s[1]=1*Math.sin(o)+1*Math.cos(o)):(r=e.F.n(1,r,a)*Math.cos(a),i[0]=0,i[1]=0,p[2]+=Math.tan(1.570796326794897-e.s.R(a))*r*e.s.Mb(1,a),s[0]=r*Math.cos(o)-r*Math.sin(o),s[1]=r*Math.sin(o)+r*Math.cos(o)),s[2]=p[2],e.F.Yq(p,s,i,m,1),e.F.xx(m,g,n),e.F.xx(m,f,w),w=e.F.Tt(n,w)/(e.F.qn(n)*e.F.qn(w)),w*=e.s.Mb(1,v),o=Math.acos(w)*-e.s.Mb(1,v),(0<y&&0<o||0>y&&0>o)&&(o=e.F.ca(o+3.141592653589793)),null!=l&&(l.u=u),null!=h&&(h.u=y),null!=c&&(c.u=o)}}},t.sf=function(t,i,r,s,n,o,a,l){var h=[0,0,0],c=[0,0,0],u=[0,0,0],p=[0,0,0],d=[0,0,0],f=[0,0,0],y=[0,0,0],g=[0,0,0,0],m=new e.ha(0),v=new e.ha(0),b=new e.ha(0),w=new e.ha(0),_=new e.ha(0),x=new e.ha(0);if(null!=a&&null!=l)if(e.s.ui(i))e.Zg.sf(t,r,s,n,o,a,l);else if(e.s.Dd(n))null!=a&&(a.u=r),null!=l&&(l.u=s);else if(o=e.F.ca(o),0>n&&(n=e.s.R(n),o=e.F.ca(o+3.141592653589793)),r=e.F.ca(r),s=e.F.ca(s),1.570796326794897<e.s.R(s)&&(r=e.F.ca(r+3.141592653589793),s=e.s.Mb(3.141592653589793,s)-s),e.s.$(e.s.R(s),1.570796326794897)||e.s.Dd(s)||e.s.Dd(o)||e.s.$(e.s.R(o),3.141592653589793))e.Xk.sf(t,i,r,s,n,o,a,l);else{var S=Math.sqrt(1-i);for(t=n/t,e.F.dl(1,i,s,0,0,w,_,x),h[0]=w.u,h[1]=_.u,h[2]=_.u,y[0]=0,y[1]=0,y[2]=-1*i*e.F.n(1,i,s)*Math.sin(s),w=e.F.n(1,i,s),_=e.F.ca(1.570796326794897-o),x=Math.sin(_),n=Math.cos(s),s=Math.sin(s),d[0]=w*n-s*x,d[1]=Math.cos(_),d[2]=(1-i)*w*s+n*x,0>o?e.F.Yq(y,d,h,g,0):e.F.Yq(y,h,d,g,0),h=Math.acos(g[2]/1),g=Math.atan2(-g[1],-g[0]),s=1-i,_=1+(d=Math.tan(h))*d/s,s=(-(w=2*y[2]*d/s)+(d=Math.sqrt(w*w-4*_*(y[2]*y[2]/s-1))))/(_*=2),w=(-w-d)/_,d=Math.tan(h),h=(s+w)/2,y=((_=d*s+y[2])+(d*w+y[2]))/2,d=e.F.hp(s-h,_-y),S=y/S*1.570796326794897,s=0;100>s&&(w=(w=e.F.w(i,S))*w/Math.cos(S)*(Math.sin(S)-y*w/(1-i)),!e.s.Dd(w));s++)S-=w;S=e.F.n(1,i,S)*Math.cos(S),y=1-d/(S=Math.sqrt((S-h)*(S+h))),y*=2-y,f=Math.acos(e.F.Tt(f,c)/(e.F.qn(f)*e.F.qn(c))),f*=e.s.Mb(1,c[0]),o=(e.F.q(S,y,e.F.Rj(y,f))+t*e.s.Mb(1,o))/e.F.Bh(S,y),o=e.F.ca(1.570796326794897*o),o=e.F.Tq(y,o),e.F.n(S,y,o),d=e.F.ca(g+r),r=Math.cos(d),o=Math.sin(d),u[0]=p[0]*r+p[1]*-o,u[1]=p[0]*o+p[1]*r,u[2]=p[2],e.F.bO(i,u[0],u[1],u[2],b,v,m),null!=a&&(a.u=v.u),null!=l&&(l.u=b.u)}},t}()}($||($={})),function(e){var t=function(){function t(t){this.Za=null,this.wt=new e.h,this.xt=new e.h,this.g=t}return t.prototype.compare=function(e,t,i){return this.g.Hc(t,this.wt),this.g.Hc(e.ka(i),this.xt),this.wt.compare(this.xt)},t}(),i=function(){function t(t){this.Cf=new e.h,this.Dk=new e.h,this.g=t}return t.prototype.Eh=function(e){this.Cf.N(e)},t.prototype.compare=function(e,t){return this.g.Hc(e.ka(t),this.Dk),this.Cf.compare(this.Dk)},t}(),r=function(e){function t(t){var i=e.call(this,t.g,t.ra,!1)||this;return i.ib=t,i}return Z(t,e),t.prototype.compare=function(e,t,i){if(this.rg)return-1;var r=this.ib.Rd.Kn(this.ib.Sh(t));e=e.ka(i);var s=this.ib.Rd.Kn(this.ib.Sh(e));return this.Fm=i,this.JE(t,r,e,s)},t}(e.MC),s=function(e){function t(t){var i=e.call(this,t.g,t.ra)||this;return i.ib=t,i}return Z(t,e),t.prototype.compare=function(e,t){return this.rg?-1:(e=this.ib.Rd.Kn(this.ib.Sh(e.ka(t))),this.Fm=t,this.KE(t,e))},t}(e.TL),n=function(){function n(){this.Nc=this.df=this.ko=this.Rd=this.mh=this.Ad=this.hb=this.g=null,this.Og=!1,this.wh=this.Pm=this.ie=this.Gk=this.oh=this.Ak=this.Gf=this.ae=null,this.yh=this.Lq=this.OA=this.ra=0,this.Yv=this.Xn=!1,this.zo=new e.h,this.Qi=new e.h,this.hb=new e.ad(8),this.Ad=new e.ad(5),this.mh=new e.bu,this.Rd=new e.bu,this.Og=!1,this.wh=new e.h,this.wh.na(0,0),this.ra=0,this.yh=-1,this.Xn=!1,this.g=null,this.df=new e.Yj,this.Nc=new e.Yj,this.oh=new e.ja(0),this.Gk=new e.LC,this.Gf=new e.ja(0),this.Ak=new e.ja(0),this.ko=new e.Ta}return n.prototype.DX=function(t,i){var r=new e.Ed;return r.TB(),t.Pc(r),this.gr(t),this.Xn=!1,this.ra=i,this.OA=i*i,i=this.cC(),t.Pc(r),i||(this.iQ(),i||this.cC()),-1!=this.yh&&(this.g.Ud(this.yh),this.yh=-1),this.g=null,this.Xn},n.prototype.HX=function(e,t){this.gr(e),this.Xn=!1,this.ra=t,this.OA=t*t,this.Og=!1,this.cC(),this.Og||(this.Og=1==e.Ip(t,!0,!1)),-1!=this.yh&&(this.g.Ud(this.yh),this.yh=-1),this.g=null},n.prototype.pg=function(e,t){return this.hb.U(e,0+t)},n.prototype.FB=function(e,t,i){this.hb.T(e,0+t,i)},n.prototype.Sh=function(e){return this.hb.U(e,2)},n.prototype.MW=function(e,t){this.hb.T(e,2,t)},n.prototype.JF=function(e,t){return this.hb.U(e,3+t)},n.prototype.Rp=function(e){return this.hb.U(e,7)},n.prototype.Rl=function(e,t){this.hb.T(e,7,t)},n.prototype.Tp=function(e,t){return this.hb.U(e,3+this.Qp(e,t))},n.prototype.hr=function(e,t,i){this.hb.T(e,3+this.Qp(e,t),i)},n.prototype.ER=function(e,t){return this.hb.U(e,5+this.Qp(e,t))},n.prototype.jr=function(e,t,i){this.hb.T(e,5+this.Qp(e,t),i)},n.prototype.Tr=function(e){return this.Ad.U(e,0)},n.prototype.IW=function(e,t){this.Ad.T(e,0,t)},n.prototype.$y=function(e){return this.Ad.U(e,4)},n.prototype.er=function(e,t){this.Ad.T(e,4,t)},n.prototype.kl=function(e){return this.Ad.U(e,1)},n.prototype.nn=function(e,t){this.Ad.T(e,1,t)},n.prototype.Zy=function(e){return this.Ad.U(e,3)},n.prototype.Et=function(e,t){this.Ad.T(e,3,t)},n.prototype.$m=function(e){var t=this.Ad.De(),i=this.mh.Qh();return this.IW(t,i),-1!=e?(this.mh.addElement(i,e),this.g.Sa(e,this.yh,t),this.er(t,this.g.Va(e))):this.er(t,-1),t},n.prototype.zP=function(e){this.Ad.kd(e)},n.prototype.CD=function(e,t){this.mh.addElement(this.Tr(e),t),this.g.Sa(t,this.yh,e)},n.prototype.nt=function(e){var t=this.hb.De(),i=this.Rd.Qh();return this.MW(t,i),-1!=e&&this.Rd.addElement(i,e),t},n.prototype.DD=function(e,t){this.Rd.addElement(this.Sh(e),t)},n.prototype.Wu=function(e){this.hb.kd(e),0<=(e=this.oh.dF(e))&&this.oh.IV(e)},n.prototype.ij=function(t,i){if(-1==this.pg(t,0))this.FB(t,0,i);else{if(-1!=this.pg(t,1))throw e.i.Ra();this.FB(t,1,i)}this.fy(t,i)},n.prototype.fy=function(e,t){var i=this.kl(t);if(-1!=i){var r=this.Tp(i,t);this.jr(r,t,e),this.hr(e,t,r),this.hr(i,t,e),this.jr(e,t,i)}else this.jr(e,t,e),this.hr(e,t,e),this.nn(t,e)},n.prototype.Qp=function(e,t){return this.pg(e,0)==t?0:1},n.prototype.Zm=function(e,t){var i,r=this.Zy(t);if(-1!=r&&(this.df.wd(r,-1),this.Et(t,-1)),-1!=(r=this.kl(t))){var s=i=r;do{var n=!1,o=this.Qp(i,t),a=this.JF(i,o);if(this.pg(i,o+1&1)==e){if(this.Yu(i),this.Rd.dh(this.Sh(i)),this.Wu(i),i==a){r=-1;break}r==i&&(r=this.kl(t),s=a,n=!0)}i=a}while(i!=s||n);if(-1!=r){do{o=this.Qp(i,t),a=this.JF(i,o),this.FB(i,o,e),i=a}while(i!=s);-1!=(i=this.kl(e))?(s=this.Tp(i,e),n=this.Tp(r,e),s==i?(this.nn(e,r),this.fy(i,e),this.nn(e,i)):n==r&&this.fy(r,e),this.hr(r,e,s),this.jr(s,e,r),this.hr(i,e,n),this.jr(n,e,i)):this.nn(e,r)}}for(r=this.Tr(e),i=this.Tr(t),s=this.mh.sc(i);-1!=s;s=this.mh.lb(s))this.g.Sa(this.mh.ka(s),this.yh,e);this.mh.By(r,i),this.zP(t)},n.prototype.KT=function(e,t){var i=this.pg(e,0),r=this.pg(e,1),s=this.pg(t,0),n=this.pg(t,1);this.Rd.By(this.Sh(e),this.Sh(t)),t==this.kl(i)&&this.nn(i,e),t==this.kl(r)&&this.nn(r,e),this.Yu(t),this.Wu(t),i==s&&r==n||r==s&&i==n||(this.In(i,this.zo),this.In(s,this.Qi),this.zo.rb(this.Qi)?(i!=s&&this.Zm(i,s),r!=n&&this.Zm(r,n)):(r!=s&&this.Zm(r,s),i!=n&&this.Zm(i,n)))},n.prototype.Yu=function(e){var t=this.pg(e,1);this.WE(e,this.pg(e,0)),this.WE(e,t)},n.prototype.WE=function(e,t){var i=this.Tp(e,t),r=this.ER(e,t),s=this.kl(t);i!=e?(this.hr(r,t,i),this.jr(i,t,r),s==e&&this.nn(t,i)):this.nn(t,-1)},n.prototype.OD=function(e,t,i){var r=this.Rd.sc(e),s=this.Rd.ka(r);e=this.Ie(s);var n=this.Ie(this.g.V(s));for(this.g.lr(s,t,i,!0),r=this.Rd.lb(r);-1!=r;r=this.Rd.lb(r)){s=this.Rd.ka(r);var o=this.Ie(s)==e;this.g.lr(s,t,i,o)}r=t.Xp(i,0).ac(),t=t.Xp(i,t.ql(i)-1).xc(),this.tK(e,r),this.tK(n,t)},n.prototype.RE=function(e,t,i){var r=this.Sh(e),s=this.pg(e,0),n=this.pg(e,1),o=this.nt(-1);for(this.oh.add(o),this.Rl(o,-3),this.Gf.add(o),this.ij(o,s),e=1,t=t.ql(i);e<t;e++)i=this.$m(-1),this.Ak.add(i),this.Gf.add(i),this.ij(o,i),o=this.nt(-1),this.oh.add(o),this.Rl(o,-3),this.Gf.add(o),this.ij(o,i);for(this.ij(o,n),r=this.Rd.sc(r);-1!=r;r=this.Rd.lb(r))if(n=this.Rd.ka(r),this.Ie(n)==s){e=0;do{0<e&&(o=this.Gf.get(e-1),this.CD(o,n),-1==this.$y(o)&&this.er(o,this.g.Va(n))),o=this.Gf.get(e),e+=2,this.DD(o,n),n=this.g.V(n)}while(e<this.Gf.size)}else{e=this.Gf.size-1;do{e<this.Gf.size-2&&(o=this.Gf.get(e+1),this.CD(o,n),0>this.$y(o)&&this.er(o,this.g.Va(n))),o=this.Gf.get(e),e-=2,this.DD(o,n),n=this.g.V(n)}while(0<=e)}this.Gf.clear(!1)},n.prototype.Ie=function(e){return this.g.Qa(e,this.yh)},n.prototype.KI=function(t,i,r){var s=this.pg(i,0),n=new e.h;this.In(s,n);var o=new e.h,a=this.pg(i,1);this.In(a,o);var l=r.ql(t),h=r.Xp(t,0),c=new e.h;if(h.$p(c),!n.rb(c)){if(!this.Og){var u=n.compare(this.wh);0>u*(c=c.compare(this.wh))&&(this.Og=!0)}this.nF(s,this.Gf),this.Ak.add(s)}for(!this.Og&&1<l&&(u=n.compare(o),h=h.xc(),(n.compare(h)!=u||h.compare(o)!=u||0>h.compare(this.wh))&&(this.Og=!0)),t=(h=r.Xp(t,l-1)).xc(),o.rb(t)||(this.Og||0>(u=o.compare(this.wh))*(c=t.compare(this.wh))&&(this.Og=!0),this.nF(a,this.Gf),this.Ak.add(a)),this.Gf.add(i),o=0,a=this.Gf.size;o<a;o++)t=this.Gf.get(o),r=this.Rp(t),e.ad.DG(r)&&(this.Nc.wd(r,-1),this.Rl(t,-1)),t!=i&&-3!=this.Rp(t)&&(this.oh.add(t),this.Rl(t,-3));this.Gf.clear(!1)},n.prototype.dO=function(e,t){this.ae.compare(this.Nc,this.Nc.ka(e),t),this.ae.rg&&(this.ae.Lr(),this.gF(e,t))},n.prototype.gF=function(t,i){this.Xn=!0,t=this.Nc.ka(t),i=this.Nc.ka(i);var r=this.Rd.Kn(this.Sh(t)),s=this.Rd.Kn(this.Sh(i)),n=this.g.cc(r);null==n&&(null==this.ie&&(this.ie=new e.zb),this.g.fd(r,this.ie),n=this.ie),null==(r=this.g.cc(s))&&(null==this.Pm&&(this.Pm=new e.zb),this.g.fd(s,this.Pm),r=this.Pm),this.Gk.Po(n),this.Gk.Po(r),this.Gk.Fa(this.ra,!0)&&(this.Og=!0),this.$J(t,i,-1,this.Gk),this.Gk.clear()},n.prototype.yQ=function(t,i){this.Xn=!0,i=this.Nc.ka(i);var r=this.Rd.Kn(this.Sh(i)),s=this.g.cc(r);null==s&&(null==this.ie&&(this.ie=new e.zb),this.g.fd(r,this.ie),s=this.ie),r=this.tF(t),this.Gk.Po(s),this.g.Wi(r,this.ko),this.Gk.Fz(this.ra,this.ko,!0),this.$J(i,-1,t,this.Gk),this.Gk.clear()},n.prototype.oS=function(){if(0!=this.oh.size)for(;0!=this.oh.size;){if(this.oh.size>Math.max(100,this.g.gd)){this.oh.clear(!1),this.Og=!0;break}var e=this.oh.Gc();this.oh.Jf(),this.Rl(e,-1),-1!=this.MS(e)&&this.nS(e),this.Wn=!1}},n.prototype.nS=function(e){if(this.Wn){var t=this.Nc.Au(this.EH,this.yH,e,!0);this.Wn=!1}else t=this.Nc.BD(e);-1==t?this.KT(this.Nc.ka(this.Nc.xF()),e):(this.Rl(e,t),this.ae.rg&&(this.ae.Lr(),this.gF(this.ae.Fm,t)))},n.prototype.MS=function(t){var i=this.pg(t,0);if(t=this.pg(t,1),this.In(i,this.zo),this.In(t,this.Qi),e.h.zc(this.zo,this.Qi)<=this.OA)return this.Og=!0,-1;var r=this.zo.compare(this.wh),s=this.Qi.compare(this.wh);return 0>=r&&0<s?t:0>=s&&0<r?i:-1},n.prototype.gQ=function(){var t=new e.ja(0);t.Jb(this.g.gd);for(var i=this.g.$q(),r=i.next();-1!=r;r=i.next())-1!=this.g.Qa(r,this.yh)&&t.add(r);this.g.mx(t,t.size),this.hQ(t)},n.prototype.hQ=function(i){this.df.clear(),this.df.Ee(i.size),this.df.Wo(new t(this.g));var r=new e.h;r.Sc();for(var s=-1,n=new e.h,o=0,a=i.size;o<a;o++){var l=i.get(o);this.g.Hc(l,n),n.rb(r)?(l=this.g.Qa(l,this.yh),this.Zm(s,l)):(s=this.Ie(l),this.g.Hc(l,r),l=this.df.yn(l),this.Et(s,l))}},n.prototype.iQ=function(){var t=new e.ja(0);t.Jb(this.g.gd);for(var i=this.df.sc(-1);-1!=i;i=this.df.lb(i))t.add(this.df.ka(i));this.df.clear(),this.g.mx(t,t.size),i=0;for(var r=t.size;i<r;i++){var s=t.get(i),n=this.Ie(s);s=this.df.yn(s),this.Et(n,s)}},n.prototype.nF=function(t,i){var r=this.kl(t);if(-1!=r){var s=r;do{e.ad.DG(this.Rp(s))&&i.add(s),s=this.Tp(s,t)}while(s!=r)}},n.prototype.tK=function(e,t){for(e=this.mh.sc(this.Tr(e));-1!=e;e=this.mh.lb(e))this.g.mf(this.mh.ka(e),t)},n.prototype.$J=function(e,t,i,r){this.Yu(e),-1!=t&&this.Yu(t),this.KI(0,e,r),-1!=t&&this.KI(1,t,r),-1!=i&&(r.Cf.D(this.zo),this.In(i,this.Qi),this.Qi.rb(this.zo)||this.Ak.add(i)),i=0;for(var s=this.Ak.size;i<s;i++){var n=this.Ak.get(i),o=this.Zy(n);-1!=o&&(this.df.wd(o,-1),this.Et(n,-1))}for(i=this.Sh(e),s=-1!=t?this.Sh(t):-1,this.OD(i,r,0),-1!=t&&this.OD(s,r,1),this.RE(e,r,0),-1!=t&&this.RE(t,r,1),this.Rd.dh(i),this.Wu(e),-1!=t&&(this.Rd.dh(s),this.Wu(t)),i=0,s=this.Ak.size;i<s;i++)(n=this.Ak.get(i))==this.Lq&&(this.Yv=!0),-1==(o=this.Zy(n))&&(-1==(o=this.df.BD(this.tF(n)))?(e=this.Ie(this.df.ka(this.df.xF())),this.Zm(e,n)):this.Et(n,o));this.Ak.clear(!1)},n.prototype.In=function(e,t){this.g.WF(this.$y(e),t)},n.prototype.tF=function(e){return this.mh.Kn(this.Tr(e))},n.prototype.cC=function(){this.Yv=!1,this.Lq=-1,null==this.ae&&(this.Nc.Sv=!1,this.ae=new r(this),this.Nc.$n=this.ae);var t=new e.ja(0),n=null,o=null;this.yH=this.EH=-1,this.Wn=!1;for(var a=this.df.sc(-1);-1!=a;){this.Wn=!1;var l=this.df.ka(a);this.Lq=this.Ie(l),this.g.Hc(l,this.wh),this.ae.SJ(this.wh.y,this.wh.x);var h=this.kl(this.Lq),c=-1==h;if(!c){l=h;do{var u=this.Rp(l);-1==u?(this.oh.add(l),this.Rl(l,-3)):-3!=u&&t.add(u),l=this.Tp(l,this.Lq)}while(l!=h)}if(0<t.size){for(this.Wn=1==t.size&&1==this.oh.size,c=0,h=t.size;c<h;c++)l=this.Nc.ka(t.get(c)),this.Rl(l,-2);var p=-2,d=-2;for(c=0,h=t.size;c<h;c++){if(u=t.get(c),-2==p){var f=this.Nc.xe(u);-1!=f?(l=this.Nc.ka(f),-2!=(l=this.Rp(l))&&(p=f)):p=-1}if(-2==d&&(-1!=(u=this.Nc.lb(u))?(l=this.Nc.ka(u),-2!=(l=this.Rp(l))&&(d=u)):d=-1),-2!=p&&-2!=d)break}for(c=0,h=t.size;c<h;c++)u=t.get(c),l=this.Nc.ka(u),this.Nc.wd(u,-1),this.Rl(l,-1);t.clear(!1),this.EH=-1!=p?p:-1,this.yH=-1!=d?d:-1,-1!=p&&-1!=d?this.Wn||this.dO(p,d):-1==p&&-1==d&&(this.Wn=!1)}else c&&(null==n&&(n=new s(this)),n.Eh(this.wh),this.Nc.mJ(n),n.rg&&(n.Lr(),this.yQ(this.Lq,n.Fm)));this.oS(),this.Yv?(this.Yv=!1,null==o&&(o=new i(this.g)),o.Eh(this.wh),a=this.df.mJ(o)):a=this.df.lb(a)}return this.Xn},n.prototype.gr=function(t){for(this.g=t,this.yh=this.g.Hd(),this.hb.Ee(t.gd+32),this.Ad.Ee(t.gd),this.mh.At(t.gd),this.mh.hn(t.gd),this.Rd.At(t.gd+32),this.Rd.hn(t.gd+32),t=this.g.ld;-1!=t;t=this.g.ve(t))if(e.ba.Ic(this.g.jc(t)))for(l=this.g.Ob(t);-1!=l;l=this.g.Sb(l)){var i=this.g.Ka(l),r=this.g.Ya(l),s=this.$m(r),n=this.nt(r);for(this.ij(n,s),h=this.g.V(r),r=0,i-=2;r<i;r++){var o=this.g.V(h),a=this.$m(h);this.ij(n,a),n=this.nt(h),this.ij(n,a),h=o}this.g.ec(l)?(a=this.$m(h),this.ij(n,a),n=this.nt(h),this.ij(n,a),this.ij(n,s)):(a=this.$m(h),this.ij(n,a))}else for(var l=this.g.Ob(t);-1!=l;l=this.g.Sb(l)){var h=this.g.Ya(l);for(s=0,i=this.g.Ka(l);s<i;s++)this.$m(h),h=this.g.V(h)}this.gQ()},n}();e.JC=n}($||($={})),function(e){var t=function(t){function i(r,s,n){var o=t.call(this)||this;if(void 0!==r)if(void 0!==n){o.description=e.ee.og();var a=new e.Od;a.L(r,s,n),o.XB(a)}else if(void 0!==s)o.description=e.ee.og(),o.Db(r,s);else if(r instanceof e.ua)o.description=r;else if(r instanceof e.h)o.description=e.ee.og(),o.Db(r);else{if(!(r instanceof i))throw e.i.O();o.description=r.description,o.Db(r.Mg(),r.jh()),null!==r.la&&(o.la=r.la.slice(0))}else o.description=e.ee.og();return o}return Z(i,t),i.prototype.D=function(t){if(void 0===t){if(this.Bc())throw e.i.ga("This operation should not be performed on an empty geometry.");return(t=new e.h).na(this.la[0],this.la[1]),t}if(this.Bc())throw e.i.ga("This operation should not be performed on an empty geometry.");t.na(this.la[0],this.la[1])},i.prototype.Db=function(e,t){"number"==typeof e?(this.wc(),null==this.la&&this.up(),this.la[0]=e,this.la[1]=t):(this.wc(),this.Db(e.x,e.y))},i.prototype.xz=function(){if(this.Bc())throw e.i.ga("This operation should not be performed on an empty geometry.");var t=new e.Od;return t.x=this.la[0],t.y=this.la[1],t.z=this.description.aG()?this.la[2]:e.ua.te(1),t},i.prototype.XB=function(t){this.wc();var i=this.hasAttribute(1);i||e.ua.vG(1,t.z)||(this.se(1),i=!0),null==this.la&&this.up(),this.la[0]=t.x,this.la[1]=t.y,i&&(this.la[2]=t.z)},i.prototype.Mg=function(){if(this.Bc())throw e.i.ga("This operation should not be performed on an empty geometry.");return this.la[0]},i.prototype.WB=function(e){this.setAttribute(0,0,e)},i.prototype.jh=function(){if(this.Bc())throw e.i.ga("This operation should not be performed on an empty geometry.");return this.la[1]},i.prototype.TJ=function(e){this.setAttribute(0,1,e)},i.prototype.TR=function(){return this.Vc(1,0)},i.prototype.kX=function(e){this.setAttribute(1,0,e)},i.prototype.rR=function(){return this.Vc(2,0)},i.prototype.VW=function(e){this.setAttribute(2,0,e)},i.prototype.Fc=function(){return this.qF(3,0)},i.prototype.DJ=function(e){this.setAttribute(3,0,e)},i.prototype.Vc=function(t,i){var r=this.description.Qf(t);return 0<=r?this.la[this.description.$j(r)+i]:e.ua.te(t)},i.prototype.qF=function(t,i){var r=this.description.Qf(t);return 0<=r?this.la[this.description.$j(r)+i]:e.ua.te(t)},i.prototype.setAttribute=function(e,t,i){this.wc();var r=this.description.Qf(e);0>r&&(this.se(e),r=this.description.Qf(e)),null==this.la&&this.up(),this.la[this.description.$j(r)+t]=i},i.prototype.K=function(){return 33},i.prototype.Eb=function(){return 0},i.prototype.Pa=function(){this.wc(),null!=this.la&&(this.la[0]=NaN,this.la[1]=NaN)},i.prototype.un=function(t){if(null!=this.la){for(var i=e.ee.Jw(t,this.description),r=[],s=0,n=0,o=t.Ba;n<o;n++){var a=t.qd(n),l=e.ua.Wa(a);if(-1==i[n]){var h=e.ua.te(a);for(a=0;a<l;a++)r[s]=h,s++}else for(h=this.description.$j(i[n]),a=0;a<l;a++)r[s]=this.la[h],s++,h++}this.la=r}this.description=t},i.prototype.up=function(){this.dJ(this.description.Be.length),i.VD(this.description.Be,this.la,this.description.Be.length),this.la[0]=NaN,this.la[1]=NaN},i.prototype.Pc=function(t){if(t instanceof e.Ed){if(!this.Bc()){var i=this.D();t.Fh(i,i),this.Db(i)}}else this.Bc()||(this.se(1),i=this.xz(),this.XB(t.gp(i)))},i.prototype.copyTo=function(t){if(33!=t.K())throw e.i.O();t.wc(),null==this.la?(t.Pa(),t.la=null,t.kg(this.description)):(t.kg(this.description),t.dJ(this.description.Be.length),i.VD(this.la,t.la,this.description.Be.length))},i.prototype.Ja=function(){return new i(this.description)},i.prototype.B=function(){return this.Bc()},i.prototype.Bc=function(){return null==this.la||isNaN(this.la[0])||isNaN(this.la[1])},i.prototype.dn=function(e){e.Pa(),this.description!=e.description&&e.kg(this.description),e.$b(this)},i.prototype.A=function(e){this.Bc()?e.Pa():(e.v=this.la[0],e.G=this.la[1],e.C=this.la[0],e.H=this.la[1])},i.prototype.Ro=function(e){if(this.Bc())e.Pa();else{var t=this.xz();e.v=t.x,e.G=t.y,e.Xe=t.z,e.C=t.x,e.H=t.y,e.Dg=t.z}},i.prototype.Ug=function(t,i){var r=new e.Oc;return this.Bc()?(r.Pa(),r):(t=this.Vc(t,i),r.pa=t,r.wa=t,r)},i.prototype.dJ=function(t){if(null==this.la)this.la=e.P.lg(t);else if(this.la.length<t){for(var i=this.la.slice(0),r=this.la.length;r<t;r++)i[r]=0;this.la=i}},i.VD=function(e,t,i){if(0<i)for(i=0;i<e.length;i++)t[i]=e[i]},i.prototype.Nb=function(e){if(e==this)return!0;if(!(e instanceof i)||this.description!=e.description)return!1;if(this.Bc())return!!e.Bc();for(var t=0,r=this.description.Be.length;t<r;t++)if(this.la[t]!=e.la[t])return!1;return!0},i.prototype.dc=function(){var t=this.description.dc();if(!this.Bc())for(var i=0,r=this.description.Be.length;i<r;i++){var s=this.la[i];s=e.P.truncate(s^s>>>32),t=e.P.Uh(s,t)}return t},i.prototype.mg=function(){return null},i}(e.ba);e.Ta=t}($||($={})),function(e){var t=function(){function e(e,t,i){void 0!==e&&(this.x=e,this.y=t,this.z=i)}return e.construct=function(t,i,r){var s=new e;return s.x=t,s.y=i,s.z=r,s},e.prototype.L=function(e,t,i){this.x=e,this.y=t,this.z=i},e.prototype.kx=function(){this.z=this.y=this.x=0},e.prototype.normalize=function(){var e=this.length();0==e&&(this.x/=e,this.y/=e,this.z/=e)},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)},e.prototype.Ag=function(t){new e(this.x*t,this.y*t,this.z*t)},e.prototype.Rh=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e}();e.Od=t}($||($={})),function(e){var t=function(){function t(e,t,i){this.Hw=this.xA=null,this.Yf=t,this.vT=t.y-i,this.uT=t.y+i,this.Fw=0,this.Zz=e,this.ra=i,this.HT=i*i,this.$z=0!=i,this.Mv=!1}return t.prototype.result=function(){return 0!=this.Fw?1:0},t.prototype.RM=function(t){return t=t.ic(t.fe(this.Yf,!1)),e.h.zc(t,this.Yf)<=this.HT},t.prototype.YE=function(e){if(!this.$z&&(this.Zz&&this.Yf.rb(e.ac())||this.Yf.rb(e.xc())))this.Mv=!0;else if(e.oa==this.Yf.y&&e.oa==e.ma){if(this.Zz&&!this.$z){var t=Math.max(e.sa,e.qa);this.Yf.x>Math.min(e.sa,e.qa)&&this.Yf.x<t&&(this.Mv=!0)}}else{var i=!1;if(t=Math.max(e.sa,e.qa),this.Yf.x>t?i=!0:this.Yf.x>=Math.min(e.sa,e.qa)&&(i=0<e.fq(!0,this.Yf.y,this.Hw,null)&&this.Hw[0]<=this.Yf.x),i){if(this.Yf.y==e.ac().y){if(this.Yf.y<e.xc().y)return}else if(this.Yf.y==e.xc().y&&this.Yf.y<e.ac().y)return;this.Fw=this.Zz?1^this.Fw:this.Fw+(e.ac().y>e.xc().y?1:-1)}}},t.prototype.JI=function(e){var t=e.Ug(0,1);if(t.pa>this.uT||t.wa<this.vT)return!1;if(this.$z&&this.RM(e))return!0;if(t.pa>this.Yf.y||t.wa<this.Yf.y)return!1;if(null==this.xA&&(this.xA=[null,null,null,null,null]),null==this.Hw&&(this.Hw=[0,0,0]),0<(t=e.XF()))for(e=0;e<t;e++){var i=this.xA[e].get();if(this.YE(i),this.Mv)return!0}else if(this.YE(e),this.Mv)return!0;return!1},t.HM=function(e,i,r){for(i=new t(0==e.Jn(),i,r),e=e.Ha();e.ab();)for(;e.Ia();)if(r=e.ia(),i.JI(r))return-1;return i.result()},t.IM=function(i,r,s,n){var o=new e.l;i.yc(o),o.X(n,n);var a=new t(0==i.Jn(),s,n);i=i.Ha();var l=new e.l;for(l.L(o),l.C=s.x+n,l.G=s.y-n,l.H=s.y+n,n=(s=r.EF(l,n)).next();-1!=n;n=s.next())if(i.Wb(r.ka(n)),i.Ia()&&(n=i.ia(),a.JI(n)))return-1;return a.result()},t.ym=function(i,r,s){if(i.B())return 0;var n=new e.l;if(i.yc(n),n.X(s,s),!n.contains(r))return 0;if(null!=(n=i.Cb)){var o=n.Fk;if(null!=o){if(1==(o=o.To(r.x,r.y)))return 1;if(0==o)return 0}if(null!=(n=n.Gb))return t.IM(i,n,r,s)}return t.HM(i,r,s)},t.SS=function(e,i,r){return i.B()?0:t.ym(e,i.D(),r)},t.Ol=function(e,t){return!(16>(e=e.I()))&&2*e+Math.log(e)/Math.log(2)*t<1*e*t},t}();e.Fg=t}($||($={})),function(e){var t=function(e){function t(t){return e.call(this,!0,t)||this}return Z(t,e),t.prototype.Ja=function(){return new t(this.description)},t.prototype.Eb=function(){return 2},t.prototype.K=function(){return 1736},t.prototype.pG=function(e,t,i){this.AS(e,t,i)},t.prototype.hR=function(){this.xR()},t}(e.Vk);e.Ea=t}($||($={})),function(e){var t;(t=e.JL||(e.JL={}))[t.PiPOutside=0]="PiPOutside",t[t.PiPInside=1]="PiPInside",t[t.PiPBoundary=2]="PiPBoundary",e.jd=function(){function t(){}return t.CG=function(t,i,r){return 0==(t=e.Fg.SS(t,i,r))?0:1==t?1:2},t.Zd=function(t,i,r){return 0==(t=e.Fg.ym(t,i,r))?0:1==t?1:2},t.KX=function(i,r,s,n,o){if(r.length<s||o.length<s)throw e.i.O();for(var a=0;a<s;a++)o[a]=t.Zd(i,r[a],n)},t.kK=function(i,r,s,n,o){if(1736==i.K())t.KX(i,r,s,n,o);else{if(197!=i.K())throw e.i.ga("invalid_call");var a=new e.l;i.A(a),t.SM(a,r,s,n,o)}},t.SM=function(t,i,r,s,n){if(i.length<r||n.length<r)throw e.i.O();if(t.B())for(s=0;s<r;s++)n[s]=0;else for(t.X(.5*-s,.5*-s),t.X(.5*s,.5*s),s=0;s<r;s++)t.contains(i[s])?n[s]=1:t.contains(i[s])?n[s]=2:n[s]=0},t.MX=function(e,t,i,r,s){for(var n=0;n<i;n++)s[n]=e.rs(t[n],r)?2:0},t.LX=function(e,t,i,r,s){var n=e.Cb,o=null;null!=n&&(o=n.Fk),n=i;for(var a=0;a<i;a++)if(s[a]=1,null!=o){var l=t[a];0==o.To(l.x,l.y)&&(s[a]=0,n--)}if(0!=n)for(e=e.Ha();e.ab()&&0!=n;)for(;e.Ia()&&0!=n;)for(o=e.ia(),a=0;a<i&&0!=n;a++)1==s[a]&&o.rs(t[a],r)&&(s[a]=2,n--);for(a=0;a<i;a++)1==s[a]&&(s[a]=0)},t.lK=function(i,r,s,n,o){var a=i.K();if(1607==a)t.LX(i,r,s,n,o);else{if(!e.ba.zd(a))throw e.i.ga("Invalid call.");t.MX(i,r,s,n,o)}},t}()}($||($={})),function(e){var t=function(e){function t(t,i){if(2==arguments.length){var r=e.call(this,!1,t.description)||this;r.nf(t),r.lineTo(i)}else r=e.call(this,!1,t)||this;return r}return Z(t,e),t.prototype.Ja=function(){return new t(this.description)},t.prototype.Eb=function(){return 1},t.prototype.K=function(){return 1607},t.prototype.pG=function(e,t,i){this.BS(e,t,i)},t}(e.Vk);e.Ua=t}($||($={})),function(e){var t=function(){function t(){}return t.prototype.progress=function(){return!0},t.Bp=function(t){if(null!=t&&!t.progress(-1,-1))throw e.i.OC()},t}();e.np=t}($||($={})),function(e){var t;(t=e.HK||(e.HK={}))[t.clipWithInputHorizon=1]="clipWithInputHorizon",t[t.clipWithOutputHorizon=2]="clipWithOutputHorizon";var i,r=function(){function e(){this.gl=3,this.Gy=this.Lu=NaN}return e.prototype.ZR=function(){return this.js(1)},e.prototype.$R=function(){return this.js(2)},e.prototype.js=function(e){return 0!=(this.gl&e)},e.prototype.Pf=function(){var t=new e;return t.Lu=this.Lu,t.Gy=this.Gy,t.gl=this.gl,t},e}();e.oY=r,(i=e.IK||(e.IK={}))[i.Dont_Geonomalize_Polygon=2147483648]="Dont_Geonomalize_Polygon",i[i.Dont_Adjust_At_Poles=1073741824]="Dont_Adjust_At_Poles";var s=function(){function e(){this.gl=0}return e.prototype.js=function(e){return 0!=(this.gl&e)},e.ig=function(t){var i=new e;return i.gl=t.gl,i},e.prototype.eM=function(e){this.gl=e.gl},e}();e.pY=s;var n=function(){function t(t,i,r){this.ef=t,this.Zf=i,this.Vf=new e.l,this.Vf.L(r),this.qT=t.dc()+i.dc()+this.Vf.dc().toString()}return t.prototype.dc=function(){return this.qT},t.prototype.Nb=function(e){return this==e||this.ef.Nb(e.ef)&&this.Zf.Nb(e.Zf)&&this.Vf.Nb(e.Vf)},t}();e.uY=n,n=function(){function t(){this.Zf=this.ef=null,this.jH=new r,this.kH=new s,this.xw=this.Xf=null,this.nw=this.Un=!0}return t.Or=function(e,i,r,s){var n;void 0===s&&(s=null),void 0===n&&(n=null);var o=new t;return o.rp(e,i,r,s,n),o},t.prototype.rp=function(t,i,r,s,n){if(null==t||null==i)throw e.i.ga("invalidArgument");if(this.ef=t,this.Zf=i,this.nw=this.Un=!1,null!=s&&(this.jH=s.Pf()),null!=n&&this.kH.eM(n),n=!1,1==i.Tb()&&null!=s&&(s=s.Lu,isNaN(s)||0==s||(n=!0)),t==i)this.Un=!n,this.nw=!0;else{s=t.Tb();var o=i.Tb();if(0==s||0==o){if(null!=r)throw e.i.O();null!=t.Id()&&null!=i.Id()&&(this.Un=t.Id().Nb(i.Id()))}else 3==s||3==o?this.Un=t.Nb(i):this.ef.bS(this.Zf)?this.Un=!n:this.Un=!1,this.Xf=r,null!=this.Xf&&this.Xf.hx(),this.nw=(null==this.Xf||0==this.Xf.count())&&this.ef.tc().Nb(this.Zf.tc())}this.cY()},t.prototype.isIdentity=function(){return this.Un},t.prototype.fR=function(){return this.jH.Pf()},t.prototype.Nb=function(e){return e==this||!!(e instanceof t&&this.ef.Nb(e.ef)&&this.Zf.Nb(e.Zf))&&(this.Xf==e.Xf||!(null==this.Xf||null==e.Xf||!this.Xf.Nb(e.Xf)))},t.prototype.cY=function(){this.xw=new e.cu(this)},t}(),e.xr=n}($||($={})),function(e){var t=function(){function t(){}return t.Ep=function(e){return e*t.eW},t.lx=function(e,i){return t.ZO(i-e)},t.$O=function(t){return-360<=t&&720>t?(0>t?t+=360:360<=t&&(t-=360),t):(0>(t=e.mc.JK(t))&&(t+=360),t)},t.ZO=function(e){return 180<(e=t.$O(e))&&(e-=360),e},t.eW=57.29577951308232,t}();e.sr=t,e.Ih=function(){function i(){}return i.mj=function(t,i){var r=new e.l;t.A(r);var s=e.cb.hh(i),n=new e.l;return n.L(s),n.v=r.v,n.C=r.C,n.X(.01*n.da(),0),i=e.ta.Xd(i,r,!1),n.contains(r)?t:e.Vd.clip(t,n,i,0)},i.ls=function(t,r,s,n,o){if(!e.cb.Xc(r))throw e.i.O();var a=e.ta.lj(r,t,!1),l=e.cb.hh(r),h=e.cb.tc(r),c=h.Id().bi,u=e.cb.wv(h);h=e.cb.fv(h),u*=2-u;var p=new e.Oc;l.en(p);var d=[[0,0],[0,0]];if(2==e.Gg.Tb(r)?n?(d[0][0]=i.an(o,p),d[0][1]=l.Lp(),e.cb.vt(),l=d[0][0]*c):(d[0][0]=l.gk(),d[0][1]=o,e.cb.vt(),l=d[0][1]*c):l=o*c,!n&&0!=l)throw e.i.O();var f=new e.ha,y=new e.hd;t=y.Ib(t);for(var g=[0],m=new e.h,v=new e.h,b=new e.h,w=new e.h,_=new e.h,x=new e.h,S=y.Ob(t);-1!=S;S=y.Sb(S)){var M=y.Ya(S);y.D(M,b);for(var T=!1,I=M=y.V(M);-1!=I;I=y.V(I)){if(I==M){if(T)break;T=!0}if(y.D(I,w),n&&a<o-b.x&&w.x-o>a||a<o-w.x&&b.x-o>a||!n&&a<-b.y&&w.y>a||a<-w.y&&b.y>a)do{if(!(Math.abs(b.x-w.x)>=.5*p.S())){if(2==e.Gg.Tb(r)?(d[0][0]=i.an(b.x,p),d[0][1]=b.y,d[1][0]=i.an(w.x,p),d[1][1]=w.y,e.cb.UV(),_.x=d[0][0]*c,_.y=d[0][1]*c,x.x=d[1][0]*c,x.y=d[1][1]*c):(_.x=b.x*c,_.y=b.y*c,x.x=w.x*c,x.y=w.y*c),x.x=6.283185307179586*(w.x-b.x)/p.S()+_.x,n){if(v.x=l,v.y=i.Iz(h,u,_,x,l,s),isNaN(v.y))break}else{if(v.x=i.Gz(h,u,_,x,s),isNaN(v.x))break;v.y=0}e.kb.xd(h,u,_.x,_.y,x.x,x.y,f,null,null,s);var E=f.u;e.kb.xd(h,u,_.x,_.y,v.x,v.y,f,null,null,s);var A=f.u;2==e.Gg.Tb(r)?(d[0][0]=v.x/c,d[0][1]=v.y/c,e.cb.UQ(),n?(m.y=d[0][1],m.x=o):(m.x=i.ps(d[0][0],b.x,w.x,p),m.y=o)):n?(m.x=o,m.y=v.y/c):(m.x=i.ps(v.x/c,b.x,w.x,p),m.y=o),g[0]=0<E?e.P.Rk(A/E,0,1):.5,0!=g[0]&&1!=g[0]&&(E=y.Na(I),y.Wl(E,g,1),y.Db(y.V(E),m.x,m.y))}}while(0);b.N(w)}}return y.Ke(t)},i.Gn=function(t,r,s,n,o){if(t.B())return t;var a=e.cb.bf(r);return i.Jp(t,s-180*a,360*a,r,n,o,!0)},i.Iz=function(t,r,s,n,o,a){if(3.141592653589793<=Math.abs(s.x-n.x)||!i.Tn(s.x,n.x,o))return NaN;if(s.x>n.x)var l=n;else l=s,s=n;n=new e.ha(0);var h=new e.ha(0),c=new e.ha(0);e.kb.xd(t,r,l.x,l.y,s.x,s.y,h,n,null,a);var u=h.u,p=0,d=1,f=new e.h;for(f.N(l);u*(d-p)>1e-12*t;){var y=.5*(p+d);if(e.kb.pj(t,r,l.x,l.y,u*y,n.u,h,c,a),f.x=h.u,f.y=c.u,f.x==o)break;if(i.Tn(l.x,f.x,o))d=y;else{if(!i.Tn(s.x,f.x,o))return NaN;p=y}}return f.y},i.Tn=function(e,i,r){return e=t.Ep(e),i=t.lx(e,t.Ep(i)),0==(r=t.lx(e,t.Ep(r)))||0<i&&0<r&&r<=i||0>i&&0>r&&r>=i},i.an=function(e,t){var i=t.wa-t.pa;return t.Jt(e-Math.floor((e-t.pa)/i)*i)},i.ps=function(t,i,r,s){var n=new e.Oc;for(n.L(i,r),r=s.S(),t=Math.floor((t-i)/r)*r+t,n=n.tf();Math.abs(t-n)>Math.abs(t+r-n);)t+=r;return t},i.Gz=function(t,i,r,s,n){if(r.y>s.y)var o=s;else o=r,r=s;if((s=new e.Oc).L(o.y,r.y),!s.contains(0)||3.141592653589793<=Math.abs(o.x-r.x))return NaN;if(o.x==r.x)return o.x;var a=new e.ha(0),l=new e.ha(0),h=new e.ha(0);e.kb.xd(t,i,o.x,o.y,r.x,r.y,l,a,null,n);var c=l.u,u=0,p=1,d=new e.h;for(d.N(o);c*(p-u)>1e-12*t;){var f=.5*(u+p);if(e.kb.pj(t,i,o.x,o.y,c*f,a.u,l,h,n),d.x=l.u,d.y=h.u,s.L(o.y,d.y),0==d.y)break;if(s.contains(0))p=f;else{if(s.L(r.y,d.y),!s.contains(0))return NaN;u=f}}return d.x},i.Jp=function(t,i,r,s,n,o,a){var l=new e.l;if(t.A(l),l.B())return t;var h=new e.Oc;l.en(h);var c=new e.Oc;if(c.L(i,i+r),c.contains(h)&&c.wa!=h.wa)return t;var u=new e.l;u.L(l);var p=t.K();if(33==p)return((l=(u=n?t:t.Pf()).Mg())<c.pa||l>=c.wa||a&&l==c.wa)&&(l+=Math.ceil((c.pa-l)/r)*r,l=c.Jt(l),u.WB(l)),u;if(550==p){for(s=(u=n?t:t.Pf()).vb(0),p=2*u.I(),t=!1,n=0;n<p;n+=2)((l=s.read(n))<c.pa||l>=c.wa||a&&l==c.wa)&&(t=!0,l+=Math.ceil((c.pa-l)/r)*r,l=c.Jt(l),s.write(n,l));return t&&u.Qc(1993),u}if(c.contains(h))return t;if(197==p)return r=n?t:t.Pf(),l.Fa(u),r.Yo(l),r;var d=.1*Math.max(l.da(),l.S());for(u.X(0,d),a=t,c=s.Yd(0),t=e.Hh.local(),n=new e.Ed;;){var f=Math.floor((h.pa-i)/r),y=Math.ceil((h.wa-i)/r);if(!(3<y-f))break;f=Math.floor(.5*(y+f)),u.v=l.v-d,u.C=i+r*f;var g=e.Vd.clip(a,u,c,o);u.v=u.C,u.C=l.C+d;var m=e.Vd.clip(a,u,c,o);n.gg((f-y)*r,0),m.Pc(n),1736==p?a=t.W(g,m,s,null):(a=g).add(m,!1),a.A(l),l.en(h)}for(u.v=i,u.C=i+r,(i=new e.l).L(u),i.X(c,0),0!=(i=Math.floor((l.v-u.v)/r)*r)?(u.move(i,0),n.gg(-i,0)):n.KB(),i=1607==p?new e.Ua(a.description):new e.Ea(a.description),o=new e.l,h=new e.l;l.C>u.v;)(d=e.Vd.clip(a,u,c,0)).A(h),(1607==p?!d.B()&&(h.S()>c||h.da()>c):!d.B()&&(1736!=p||h.S()>c))&&(d.Pc(n),d.A(h),i.A(o),o.X(c,c),o.isIntersecting(h)&&1736==p?i=t.W(i,d,s,null):i.add(d,!1)),u.move(r,0),n.shift(-r,0);return i},i.NI=function(t,i,r,s){var n=new e.de(r.description);n.Gd(r,0,-1),n=e.cb.Ah(n,t,i);var o=r.I();if(s.Pa(),!e.cb.Xc(t)||o!=n.I())return!1;var a=new e.l;r.A(a);var l=new e.l;if(n.A(l),a=a.S(),l=l.S(),0!=a&&0!=l){if(l/=a,t=e.cb.hh(i).S()/e.cb.hh(t).S(),1e-10<Math.abs(l/t-1))return!1}else if(0!=a||0!=l)return!1;for(s.add(r,!1),r=0;r<o;r++)t=n.Oa(r),s.Db(r,t);return!0},i.Jz=function(){throw e.i.Fe()},i}()}($||($={})),function(e){var t,i,r,s;(i=t=e.ti||(e.ti={}))[i.Clip=0]="Clip",i[i.DontClip=1]="DontClip",i[i.PannableFold=2]="PannableFold",(s=r=e.OK||(e.OK={}))[s.Geodesic=0]="Geodesic",s[s.Loxodrome=1]="Loxodrome",s[s.GreatElliptic=2]="GreatElliptic",s[s.NormalSection=3]="NormalSection",s[s.ShapePreserving=4]="ShapePreserving",e.Ab=function(){function i(){}return i.yv=function(t,i,r){if(r||0<i){for(t=t.toString(e.Tc.PE_STR_NAME_CANON|e.Tc.PE_STR_AUTH_NONE),i=[],r=0;r<t.length;r++)i[r]="a"<=t[r]&&"z">=t[r]?i[r]=t[r].toUpperCase():t[r];return i.join()}return t.toString(e.Tc.PE_STR_AUTH_TOP)},i.wr=function(t,i,r,s){var n=s.length,o=r.I();if(0!=o){var a=r.vb(0),l=Math.min(o,n),h=0,c=t.fh();isNaN(i)&&(i=0);for(var u=t.Xc(),p=179*(t=u?t.tc().Le().S():0)/360;0<o;){if(a.oB(h<<1,l,s),e.fj.projToGeogCenter(c,l,s,i),u)for(var d=0;d<l;d++){var f=s[d][0]-i,y=e.mc.sign(f),g=a.read(2*(h+d));0>y*e.mc.sign(g)&&Math.abs(f)>p&&(s[d][0]+=-y*t)}a.nC(h<<1,l,s),h+=l,o-=l,l=Math.min(o,n)}r.Qc(1993)}},i.AL=function(t,i,r,s){var n=0,o=t.fh();isNaN(n)&&(n=0);var a=t.Xc(),l=t.bf();t=360*l,l*=179;for(var h=s.length,c=0;c<r;){for(var u=c;u<r&&i[u].isNaN();++u)c++;var p=Math.min(h,r-c);if(0<p){u=1;for(var d=c+1;u<p;++u,++d)if(i[d].isNaN()){p=u;break}if(e.ta.Dy(s,i,c,p),e.fj.projToGeogCenter(o,p,s,n),a)for(u=0,d=c;u<p;++u,++d){var f=i[d].x,y=s[u][0]-n,g=e.mc.sign(y);0>g*e.mc.sign(f)&&Math.abs(y)>l&&(s[u][0]-=g*t)}e.ta.Cy(i,c,s,p),c+=p}}},i.Jx=function(t,i,r){var s=r.length,n=i.I();if(!(1>n)){var o=i.vb(0),a=Math.min(n,s),l=0,h=t.fh(),c=t.Xc(),u=c?t.Le().S():0,p=179*u/360,d=0;for(c&&(d=t.Ai());0<n;){if(o.oB(l<<1,a,r),e.fj.geogToProj(h,a,r),c)for(t=0;t<a;t++){var f=r[t][0],y=e.mc.sign(f),g=o.read(2*(l+t))-d;0>y*e.mc.sign(g)&&Math.abs(f)>p&&(r[t][0]+=-y*u)}o.nC(l<<1,a,r),l+=a,n-=a,a=Math.min(n,s)}i.Qc(1993)}},i.zL=function(t,i,r,s){if(0!=r){var n=t.fh(),o=t.Xc(),a=o?t.Le().S():0,l=179*a/360,h=0;for(o&&(h=t.Ai()),t=0;t<r;){for(var c=t;c<r&&i[c].isNaN();++c)t++;var u=Math.min(s.length,r-t);if(0<u){c=1;for(var p=t+1;c<u;++c,++p)if(i[p].isNaN()){u=c;break}if(e.ta.Dy(s,i,t,u),e.fj.geogToProj(n,u,s),o)for(c=0,p=t;c<u;c++){var d=s[c][0],f=e.mc.sign(d);0>f*e.mc.sign(i[p].x-h)&&Math.abs(d)>l&&(s[c][0]-=f*a)}e.ta.Cy(i,t,s,u),t+=u}}}},i.vr=function(t,i,r,s){var n=i.I();if(0!=n){var o=i.vb(0),a=t.ef,l=t.Zf,h=a.tc().Sp(),c=l.tc().Sp(),u=a.bf(),p=l.bf();if(null==(t=t.Xf)||0==t.count()){for(r=h/c,s=(a.Wp()-l.Wp())*p,c=-90*u,t=90*u,h=!1,p=1,a=2*n;p<a;)u=o.get(p),(l=e.P.Rk(u,c,t))!=u&&(o.set(p,l),h=!0),p+=2;if(0!=s||1!=r)for(h=!0,c=new e.h,p=0;p<n;p++)o.uc(2*p,c),c.x*=r,c.x+=s,c.y*=r,o.Ut(2*p,c);h&&i.Qc(1993)}else{a=s.length,l=Math.min(n,a);var d=e.P.lg(l),f=null,y=0,g=NaN,m=NaN,v=360*p,b=p/u;r&&(m=90*p,g=89.9*u,f=e.P.lg(l));for(var w=!0,_=0;0!=n;){for(u=!1,o.oB(y<<1,l,s),p=0;p<l;p++)d[p]=s[p][0];if(r)for(p=0;p<l;p++){var x=Math.abs(s[p][1])-g;0<x&&(u=s[p][1],s[p][1]=e.mc.Dn(g,u),f[p]=e.mc.Dn(x,u),u=!0)}for(p=s[0][0],t.transform(s,l,h,c),w&&(_=s[0][0]-b*p,w=!1),p=0;p<l;p++)x=s[p][0]-d[p]*b-_,200<Math.abs(x)&&(s[p][0]=0<x?s[p][0]-v:s[p][0]+v);if(u){for(p=0;p<l;p++)0!=f[p]&&(s[p][1]+=b*f[p],s[p][1]>m?s[p][1]=m:s[p][1]<-m&&(s[p][1]=-m));for(u=0;u<l;u++)f[u]=0}o.nC(y<<1,l,s),y+=l,n-=l,l=Math.min(n,a)}i.Qc(1993)}}},i.yL=function(t,i,r,s){if(t.nw)s=90*t.ef.bf(),e.ta.WJ(i,r,-s,s);else{var n=t.Xf,o=t.ef,a=t.Zf;t=o.Yr();var l=a.Yr(),h=o.bf(),c=90*h,u=a.bf();if(null==n||0==n.count()){if(s=t/l,n=(o.Wp()-a.Wp())*u,e.ta.WJ(i,r,-c,c),0!=n||1!=s)for(u=0;u<r;u++)i[u].x*=s,i[u].x+=n,i[u].y*=s}else{o=Math.min(r,s.length),c=e.P.lg(o),a=360*u,h=u/h;for(var p=!0,d=0,f=0;0!=r;){for(u=0;u<o;u++)c[u]=i[u+f].x;for(u=i[0].x,e.ta.Dy(s,i,f,o),n.transform(s,o,t,l),e.ta.Cy(i,f,s,o),p&&(d=i[0].x-h*u,p=!1),u=0;u<o;u++){var y=i[f+u].x-c[u]*h-d;200<Math.abs(y)&&(i[f+u].x=0<y?i[f+u].x-a:i[f+u].x+a)}f+=o,r-=o,o=Math.min(r,s.length)}}}},i.ev=function(e,t){return e=e.hh(),isNaN(t)||e.Ku(t,0),e},i.MQ=function(t,r,s,n,o,a,l,h){for(var c=i.ev(n,o),u=c.S(),p=u/360,d=i.hE*p,f=t.vb(0),y=r.Xc(),g=y?u/r.Le().S():0,m=!1,v=new e.Ea(s.description),b=0,w=s.ea();b<w;++b){var _=y,x=new e.Ua(s.description);if(x.addPath(s,b,!0),0!=l){var S=i.GD(!0,x,c.H-h,c.H,l);(m=m||S)&&(_=!1)}var M=-1;_&&(M=t.Ca(b));var T=x.vb(0),I=x.I(),E=0,A=T.read(0),P=0;S=3*n.Yd(0);var C=!1,O=new e.h;O.Sc();var k=new e.h;k.Sc();for(var L=!1,R=1;R<I;++R){var D=e.h.construct(T.Bg(2*R),T.Bg(2*R+1)),F=D.x,j=F+E,N=j-A;if(D.x=j,Math.abs(N)>d){if(_){var z=M+(R+1<I?R:0),V=f.read(2*(M+R-1));z=(f.read(2*z)-V)*g,Math.abs(N-z)>1*p&&(_=!1)}_||(j=F+(E-=e.mc.Dn(u,j-A)),++P,L=0!=E,D.x=j)}else C||e.ta.sG(k,O,D,S)&&(C=!0);L&&T.write(2*R,j),A=j,k.N(O),O.N(D)}0<P&&x.Qc(1993),_=x.Oa(0),I=x.Oa(I-1),x=e.h.ub(_,I)<S?i.mQ(x,n,o,a,C):i.nQ(t,b,x,n,o),v.add(x,!1)}return o=n.Yd(0),s=c.S()/180,i.Kt(v,c,.1*o,!1),v=v!=(o=e.si.clip(v,c,o,s,a)),t=t.He(),l=0,0<(h=o.He())&&0>t?l=1:0>=h&&0<t&&(0==h?(h=NaN,2==r.Tb()?h=r.ol().He():1==r.Tb()&&(h=r.Le().oF()),t>.99*h&&(l=-1)):l=-1),0!=l&&((r=new e.Ea(o.description)).vp(c),(r=e.Zl.local().W(r,s,a)).add(o,!1),v=!0,o=r),v&&(o=e.$l.local().W(o,n,!1,a)),o},i.nQ=function(t,r,s,n,o){var a=s.I(),l=s.Oa(0),h=s.Oa(a-1);o=(n=i.ev(n,o)).S(),l=e.mc.sign(h.x-l.x);var c=new e.l;s.yc(c);var u=n.gk();if(h=u-o,u+=o,0<=l){var p=Math.ceil((h-c.v)/o);for(p*=o;h>c.v+p;)p+=o;for(;h<c.C+p;)p-=o;var d=p;720<c.S()&&(u=h+360*Math.ceil(c.S()/360))}else{for(p=Math.ceil((u-c.C)/o),p*=o;u<c.C+p;)p-=o;for(;u>c.v+p;)p+=o;d=p,720<c.S()&&(h=u-360*Math.ceil(c.S()/360))}p=l*o;var f=e.l.construct(c.v,c.G,c.C,c.H);f.move(d,0);var y=new e.Ed;y.gg(d,0),s.Pc(y),(c=new e.Ua(s.description)).add(s,!1),d=s.Oa(a-1),o=0;for(var g=c.Oa(0).x;0<l?f.C<u:f.v>h;)f.move(p,0),y.Lb=p,s.Pc(y),g+=p,n.v<=g&&n.C>=g&&(o=c.I()-1),s.Db(0,d),d=s.Oa(a-1),c.Fr(s,0,0,a-1,!1);return s=new e.Ea(c.description),a=0<t.Kr(r),s.add(c,!1),t=c.Oa(0),h=c.Oa(c.I()-1),r=s.ea()-1,(0>l?a:!a)?(l=e.h.construct(h.x,n.H),s.Di(l),l=e.h.construct(n.gk(),n.H),s.Di(l),n=e.h.construct(t.x,n.H)):(l=e.h.construct(h.x,n.G),s.Di(l),l=e.h.construct(n.gk(),n.G),s.Di(l),n=e.h.construct(t.x,n.G)),s.Di(n),s.pG(0,r,0),s.cO(o),s},i.mQ=function(t,r,s,n,o){var a=new e.Ea(t.description);a.add(t,!1),a.xB(0,a.I()-1);var l=new e.l;a.yc(l);var h=(s=i.ev(r,s)).S(),c=Math.ceil((s.v-l.v)/h);for(c*=h;s.v>l.v+c;)c+=h;for(;s.v<l.C+c;)c-=h;if(0!=(c+=h)){l.move(c,0);var u=new e.Ed;u.gg(c,0),a.Pc(u)}if(s.v<=l.v&&s.C>l.C)return o&&(o=a.He(),r=(a=e.$l.local().W(a,r,!0,n)).He(),(r=e.mc.sign(o)!=e.mc.sign(r))&&a.gJ()),a;for((t=new e.Ea(t.description)).add(a,!1),o=o||l.S()>h-r.Yd(0);l.v<s.C;)l.move(h,0),(u=new e.Ed).gg(h,0),a.Pc(u),t.add(a,!1);return o&&(o=t.He(),t.Zo(1),r=(t=e.$l.local().W(t,r,!0,n)).He(),(r=e.mc.sign(o)!=e.mc.sign(r))&&t.gJ()),t},i.GD=function(t,i,r,s,n){for(var o=i.vb(0),a=i.I(),l=!1,h=0;h<a;h++){var c=e.h.construct(o.Bg(2*h),o.Bg(2*h+1));if(0!=(1&n)&&c.y>=r){l=!0;break}if(0!=(2&n)&&c.y<=-r){l=!0;break}}if(!l)return!1;o=!1,t&&(o=i.On(0)),a=(t=new e.hd).Ib(i),l=t.Ob(a);var u=-1,p=!0,d=new e.h;d.Sc(),h=new e.Ta;for(var f=-1,y=t.Ya(l);-1!=y;y=t.V(y)){c=t.Oa(y);var g=0!=(1&n)&&90<=c.y?1:0;if(g|=0!=(2&n)&&c.y<=-r?2:0,0<u&&u!=g){if(d.x!=c.x){d.x=c.x,t.Wi(t.Na(y),h);var m=t.xj(l,y,h);t.mf(m,d)}if(o)for(f=-1!=f?t.V(f):t.Ya(l),m=t.Na(y);f!=m;)f=t.pd(f,!1);f=-1}0<g&&(c.y=e.mc.Dn(s,c.y),t.mf(y,c),p||u==g||(c.x!=d.x?(t.Wi(y,h),m=t.xj(l,y,h),t.Db(m,d.x,c.y),f=m):f=y)),u=g,d=c,p=!1}if(o){if(-1!=f)for(f=t.V(f);-1!=f;)f=t.pd(f,!1);r=t.Ya(l),t.hq(r,t.sj(l))||(t.Wi(r,h),t.xj(l,-1,h))}return t.Ke(a).copyTo(i),!0},i.Hz=function(r,s,n,o){var a=r;if(a.B()||n==t.DontClip)return a;var l=a.K();if(33==l)return a=[(o=a).D()],i.qG(a,1,s,n),a[0].isNaN()?o.Pa():o.Db(a[0]),r;var h=(r=s.tc()).bf(),c=90*h,u=180*h,p=360*h,d=s.Ai(),f=.5*h,y=new e.l;a.A(y);var g=s.Wr(),m=s.HQ(),v=197==g.K();if(s=new e.l,g.A(s),n==t.PannableFold&&(n=r.Le().S(),s.v=d-.5*n,s.C=s.v+n),y.G<-c||y.H>c){if((new e.l).L(y.v-h,-c,y.C+h,c),(a=e.si.Pu(a,s,r,NaN,0,o)).B())return a;a.A(y)}if(m&&(s.H<y.G||s.G>y.H))return a.Ja();if(y.S()>p&&(a=i.Jp(a,d-u,p,r,!0,0,!0,o)).A(y),0!=(c=i.XN(y.v,y.C,s.v,s.C,p))&&y.move(c,0),y.C>s.C||y.v<s.v){if(y.C>s.C)for(;y.v>=s.C;)y.move(-p,0),c-=p;for(;y.v<s.C-p;)y.move(p,0),c+=p}if(n=e.ta.Iu(r,g),0!=c&&((h=new e.Ed).gg(c,0),a.Pc(h)),m){if(v&&s.contains(y))return a;for(m=[null,null],c=0;2>c;c++){if(v?h=e.ba.Ic(l)?e.si.clip(a,s,n,f,o):e.si.clip(a,s,n,0,o):(h=e.Wk.local().W(a,g,r,o))==g&&(h=e.ba.ig(h)),s.v<=y.v&&s.C>=y.C||s.v>=y.v&&s.C<=y.C)return h;m[c]=h,0==c&&(y.move(-p,0),(h=new e.Ed).gg(-p,0),a.Pc(h))}if(550==l)m[0].Gd(m[1],0,-1);else if(e.ba.Ic(l))m[0].add(m[1],!1);else{if(33!=l)throw e.i.ga("intersect_with_GCS_horizon: unexpected geometry type");m[0].B()&&(m[0]=m[1])}return m[0]}if(s.H<y.G||s.G>y.H)return a;for(l=0;!a.B()&&y.C>s.v;)0!=l&&((h=new e.Ed).gg(l,0),a.Pc(h)),e.ej.local().W(4,a,g,r,o)||g==(a=e.lp.local().W(a,g,r,o))&&(a=e.ba.ig(a)),0!=l&&((f=new e.Ed).gg(-l,0),a.Pc(f)),l-=p,y.move(-p,0);return a},i.qG=function(r,s,n,o){if(0!=s&&o!=t.DontClip)if(o==t.PannableFold){o=n.zR();for(var a=s,l=0;l<s;l++)(r[l].y>o.H||r[l].y<o.G)&&(r[l].Sc(),a--);0!=a&&i.bv(r,s,o.v,o.S())}else{var h=90*(o=n.bf()),c=180*o;for(o*=360,a=s,l=0;l<s;l++)(r[l].y>h||r[l].y<-h)&&(r[l].Sc(),a--);if(0!=a){(a=new e.l).ax(r,s),h=n.Wr();var u=n.jv();l=197==h.K();var p=new e.l;if(h.A(p),!u||!(p.H<a.G||p.G>a.H))if(u)if(i.bv(r,s,p.gk()-c,o),a=s,l)for(l=0;l<s;l++)p.contains(r[l])||(r[l].Sc(),a--);else for(n=e.ta.Iu(n.tc(),h),l=0;l<s;l++)(c=0!=e.jd.Zd(h,r[l],n))||(r[l].Sc(),a--);else for(i.bv(r,s,-c,o),a=s,n=e.ta.Iu(n.tc(),h),l=0;l<s;l++)(c=r[l]).isNaN()&&a--,u=i.lE(c.x,p.v,p.C,o),c.x+=u,(c=0!=e.jd.Zd(h,c,n))&&(r[l].Sc(),a--)}}},i.Jp=function(t,i,r,s,n,o,a,l){var h=t.K(),c=i+r;if(33===h){var u=(s=n?t:t.Pf()).Mg();return(u<i||u>=c||a&&u==c)&&(u+=Math.ceil((i-u)/r)*r,u=e.P.Rk(u,i,c),s.WB(u)),s}if(t.B())return t;if(u=new e.l,t.A(u),u.B())return t;var p=new e.Oc;u.en(p);var d=new e.Oc;if(d.L(i,c),d.contains(p))return t;if((c=new e.l).L(u),550===h){for(l=(s=n?t:t.Pf()).vb(0),h=2*s.I(),c=!1,i=0;i<h;i+=2)((u=l.read(i))<d.pa||u>=d.wa||a&&u==d.wa)&&(c=!0,u+=Math.ceil((d.pa-u)/r)*r,u=d.Jt(u),l.write(i,u));return c&&s.Qc(1993),s}if(197==h)return r=n?t:t.Pf(),u.Fa(c),r.Yo(u),r;var f=.1*Math.max(u.da(),u.S());for(c.X(0,f),a=t,d=s.Yd(0),t=e.Hh.local(),n=new e.Ed;;){var y=Math.floor((p.pa-i)/r),g=Math.ceil((p.wa-i)/r);if(!(3<g-y))break;y=Math.floor(.5*(g+y)),c.v=u.v-f,c.C=i+r*y;var m=e.si.clip(a,c,d,o,l);c.v=c.C,c.C=u.C+f;var v=e.si.clip(a,c,d,o,l);n.gg((y-g)*r,0),v.Pc(n),1736==h?a=t.W(m,v,s,null):(a=m).add(v,!1),a.A(u),u.en(p)}for(c.v=i,c.C=i+r,(i=new e.l).L(c),i.X(d,0),0!=(i=Math.floor((u.v-c.v)/r)*r)?(c.move(i,0),n.gg(-i,0)):n.KB(),i=1607==h?new e.Ua(a.description):new e.Ea(a.description),o=new e.l,p=new e.l;u.C>c.v;)(f=e.si.clip(a,c,d,0,l)).A(p),(1607==h?!f.B()&&(p.S()>d||p.da()>d):!f.B()&&(1736!=h||p.S()>d))&&(f.Pc(n),f.A(p),i.A(o),o.X(d,d),o.isIntersecting(p)&&1736==h?i=t.W(i,f,s,null):i.add(f,!1)),c.move(r,0),n.shift(-r,0);return i},i.bv=function(t,i,r,s){for(var n=r+s,o=0;o<i;o++){var a=t[o].x;r<=a&&a<n||!(a<r||a>n||a==n)||(a+=Math.ceil((r-a)/s)*s,a=e.P.Rk(a,r,n),t[o].x=a)}},i.Gn=function(t,r,s,n,o,a){if(!r.Xc())throw e.i.ga("fold_into_360_degree_range");if(t.B())return t;if(2==r.Tb()){s=r.qv();var l=r.pv()-s}else{var h=r.bf();l=360*h,s-=180*h}return i.Jp(t,s,l,r,n,o,!0,a)},i.iF=function(e,t,r,s){if(2==r.Tb())s=r.qv(),r=r.pv()-s;else{var n=r.bf();r=360*n,s-=180*n}i.bv(e,t,s,r)},i.mj=function(t,i){var r=i.Le();if(33==t.K()){var s=t.jh();return r.G<=s&&s<=r.H?t:t.Ja()}s=new e.l,t.A(s);var n=new e.l;return n.L(r),n.v=s.v,n.C=s.C,n.X(.01*n.da(),0),r=e.ta.oy(i,s),n.contains(s)?t:e.si.clip(t,n,r,0,null)},i.kr=function(e,t,i){return e>t.C&&e-t.C<i?t.C:e<t.v&&t.v-e<i?t.v:e},i.tX=function(e,t,r,s){s.x=i.kr(e.x,t,r),s.y=e.y},i.sX=function(e,t,r,s){for(var n=0;n<t;n++)e[n].y<r.G||e[n].y>r.H?e[n].Sc():e[n].x=i.kr(e[n].x,r,s)},i.Kt=function(t,r,s,n){if(!t.B()){var o=t.K();if(!n||1736!=o)if(e.ba.yj(o)){n=t.vb(0),o=0;for(var a=t.I();o<a;o++){var l=n.read(2*o),h=i.kr(l,r,s);h!=l&&n.write(2*o,h)}t.Qc(1993)}else if(197==o)n=new e.l,t.A(n),n.v=i.kr(n.v,r,s),n.C=i.kr(n.C,r,s),t.Yo(n);else{if(33!=o)throw e.i.ga("internal error");t.WB(i.kr(t.Mg(),r,s))}}},i.lS=function(t,r,s,n){var o=new e.hd,a=o.Ib(t);return t=e.ta.Iu(r,t),i.ls(o,a,r,t,s,!0,n),o.Ke(a)},i.ls=function(t,s,n,o,a,l,h){if(!n.Xc())throw e.i.O("invalid call");var c=n.Le(),u=n.tc(),p=u.fh().getDatum().getSpheroid();u=u.Id().bi;var d=p.getFlattening();p=p.getAxis(),d*=2-d;var f=new e.Oc;c.en(f);var y=null,g=[[0,0],[0,0]];if(2==n.Tb()?(y=n.fh(),l?(g[0][0]=i.an(h,f),g[0][1]=c.Lp(),e.fj.projToGeog(y,1,g),c=g[0][0]*u):(g[0][0]=c.gk(),g[0][1]=h,e.fj.projToGeog(y,1,g),c=g[0][1]*u)):c=h*u,!l&&0!=c&&a!=r.GreatElliptic)throw e.i.ga("invalid argument");var m=new e.ha,v=[0],b=new e.h,w=new e.h,_=new e.h,x=[null,null],S=new e.h,M=new e.h,T=new e.h,I=new e.h;for(s=t.Ob(s);-1!=s;s=t.Sb(s)){var E=t.Ya(s);t.D(E,S);for(var A=!1,P=E=t.V(E);-1!=P;P=t.V(P)){if(P==E){if(A)break;A=!0}if(t.D(P,M),l&&(o<h-S.x&&M.x-h>o||o<h-M.x&&S.x-h>o)||!l&&(0!=h||o<-S.y&&M.y>o||o<-M.y&&S.y>o))do{if(!(Math.abs(S.x-M.x)>=.5*f.S())){if(2==n.Tb()?(g[0][0]=i.an(S.x,f),g[0][1]=S.y,g[1][0]=i.an(M.x,f),g[1][1]=M.y,e.fj.projToGeogCenter(y,2,g,0),T.x=g[0][0]*u,T.y=g[0][1]*u,I.y=g[1][1]*u):(T.x=S.x*u,T.y=S.y*u,I.y=M.y*u),I.x=2*(M.x-S.x)*Math.PI/f.S()+T.x,l){if(w.x=c,w.y=i.Iz(p,d,T,I,c,a),isNaN(w.y))break;x[0]=w;var C=1}else if(a==r.GreatElliptic){var O=[0,0];if(0==(C=e.Mx.Jz(d,T,I,c,O)))break;w.x=O[0],w.y=c,x[0]=w,2==C&&(_.x=O[1],_.y=c,x[1]=_)}else{if(w.x=i.Gz(p,d,T,I,a),isNaN(w.x))break;w.y=0,x[0]=w,C=1}var k=-1;for(O=0;O<C;O++){e.kb.xd(p,d,T.x,T.y,I.x,I.y,m,null,null,a);var L=m.u;e.kb.xd(p,d,T.x,T.y,x[O].x,x[O].y,m,null,null,a);var R=m.u;if(2==n.Tb()?(g[0][0]=x[O].x/u,g[0][1]=x[O].y/u,e.fj.geogToProj(y,1,g),l?(b.y=g[0][1],b.x=h):(b.x=i.ps(g[0][0],S.x,M.x,f),b.y=h)):l?(b.x=h,b.y=x[O].y/u):(b.x=i.ps(x[O].x/u,S.x,M.x,f),b.y=h),v[0]=0<L?e.P.Rk(R/L,0,1):.5,0==v[0]||1==v[0])break;k>v[0]||(k=t.Na(P),t.Wl(k,v,1),t.Db(t.V(k),b.x,b.y),k=v[0])}}}while(0);S.N(M)}}},i.an=function(e,t){var i=t.wa-t.pa;return t.Jt(e-Math.floor((e-t.pa)/i)*i)},i.ps=function(t,i,r,s){var n=new e.Oc;for(n.L(i,r),r=s.S(),t=Math.floor((t-i)/r)*r+t,n=n.tf();Math.abs(t-n)>Math.abs(t+r-n);)t+=r;return t},i.Tn=function(t,i,r){return t=e.sr.Ep(t),i=e.sr.lx(t,e.sr.Ep(i)),0==(r=e.sr.lx(t,e.sr.Ep(r)))||0<i&&0<r&&r<=i||0>i&&0>r&&r>=i},i.Iz=function(t,s,n,o,a,l){if(l==r.GreatElliptic)return e.Mx.IS(s,n,o,a);if(Math.abs(n.x-o.x)>=Math.PI||!i.Tn(n.x,o.x,a))return NaN;if(n.x>o.x)var h=o;else h=n,n=o;o=new e.ha;var c=new e.ha,u=new e.ha;e.kb.xd(t,s,h.x,h.y,n.x,n.y,c,o,null,l);var p=c.u,d=0,f=1,y=new e.h;for(y.N(h);p*(f-d)>1e-12*t;){var g=.5*(d+f);if(e.kb.pj(t,s,h.x,h.y,p*g,o.u,c,u,l),y.x=c.u,y.y=u.u,y.x==a)break;if(i.Tn(h.x,y.x,a))f=g;else{if(!i.Tn(n.x,y.x,a))return NaN;d=g}}return y.y},i.Gz=function(t,i,s,n,o){if(o==r.GreatElliptic)return t=[0,0],e.Mx.Jz(i,s,n,0,t),t[0];if(s.y>n.y)var a=n;else a=s,s=n;if((n=new e.Oc).L(a.y,s.y),!n.contains(0)||Math.abs(a.x-s.x)>=Math.PI)return NaN;if(a.x==s.x)return a.x;var l=new e.ha,h=new e.ha,c=new e.ha;e.kb.xd(t,i,a.x,a.y,s.x,s.y,h,l,null,o);var u=h.u,p=0,d=1,f=new e.h;for(f.N(a);u*(d-p)>1e-12*t;){var y=.5*(p+d);if(e.kb.pj(t,i,a.x,a.y,u*y,l.u,h,c,o),f.x=h.u,f.y=c.u,n.L(a.y,f.y),0==f.y)break;if(n.contains(0))d=y;else{if(n.L(s.y,f.y),!n.contains(0))return NaN;p=y}}return f.x},i.NI=function(t,i,r,s){if(!t.ef.Xc())return!1;var n=new e.de(i.description);if(n.Gd(i,0,-1),s=e.Fx.local().W(n,t,s),n=i.I(),r.Pa(),n!=s.I())return!1;var o=new e.l;i.A(o);var a=new e.l;if(s.A(a),o=o.S(),a=a.S(),0!=o&&0!=a){if(a/=o,t=t.Zf.hh().S()/t.ef.hh().S(),1e-10<Math.abs(a/t-1))return!1}else if(0!=o||0!=a)return!1;for(r.add(i,!1),i=new e.h,t=0;t<n;t++)s.D(t,i),r.Db(t,i);return!0},i.iN=function(e,t){return(e%=360*t)>=180*t&&(e-=360*t),e},i.LI=function(r,s,n,o){if(n==t.Clip){var a=s.ol();197==a.K()?(n=new e.l,a.A(n),a=e.ta.oy(s,n),r=e.si.clip(r,n,a,5e4*s.rm(),o)):e.ej.local().W(1,a,r,s,o)||(r=e.Wk.local().W(r,a,s,o))==a&&(r=e.Vk.ig(r))}else s.Xc()&&(o=new e.l,r.yc(o),s.Le().contains(o)||(i.Kt(r,s.Le(),s.Yd(0),!0),n==t.PannableFold&&(r=i.mj(r,s)),r=i.Gn(r,s,0,!0,1e5*s.rm(),null)));return r},i.PD=function(t,i,r){var s=i.Xr();if(null==s)return t;var n=(i=i.tc()).Le().S(),o=new e.l;t.yc(o);var a=new e.Oc;o.en(a),o=s.Ha(),s=null;for(var l=new e.Ed;o.ab();)for(;o.Ia();){var h=o.ia(),c=h.Ug(0,0),u=new e.Oc;for(u.L(c.pa,c.wa),c=0;u.wa>a.pa;)u.move(-n),--c;for(;u.pa<=a.wa;){if(u.isIntersecting(a)){null==s&&(s=new e.Ua);var p=e.zb.VO(h.ac(),h.xc());0!=c&&(l.gg(c*n,0),p.Pc(l)),s.oc(p,!0)}u.move(n),++c}}return null!=s?(i=e.ta.ZN(i,s),i=e.ta.Gr(i),e.au.dP(t,s,i,r)):t},i.XN=function(e,t,r,s,n){return e>=r&&t<=s?0:i.lE(.5*(t+e),r,s,n)},i.lE=function(t,i,r,s){return e.mc.round((.5*(r+i)-t)/s)*s},i.NQ=function(t,r,s,n,o,a,l,h){var c=i.ev(n,o),u=c.S(),p=u/360,d=i.hE*p,f=t.vb(0),y=r.Xc(),g=y?u/r.Le().S():0;r=t.Ja();for(var m=0,v=s.ea();m<v;++m){var b=y,w=new e.Ua(s.description);w.addPath(s,m,!0);var _=s.ec(m);0!=l&&(_=i.GD(_,w,c.H-h,c.H,l))&&(b=!1);var x=-1;_=w.I();var S=!1;b&&(x=t.Ca(m),S=t.ec(m));var M=w.vb(0),T=0,I=M.read(0),E=0,A=3*n.Yd(0),P=!1,C=new e.h;C.Sc();var O=new e.h;O.Sc();for(var k=!1,L=1;L<_;++L){var R=e.h.construct(M.Bg(2*L),M.Bg(2*L+1)),D=R.x,F=D+T,j=F-I;if(R.x=F,Math.abs(j)>d){if(b){var N=x+L-1,z=x;(!S||L+1<_)&&(z+=L),N=f.read(2*N),z=(f.read(2*z)-N)*g,Math.abs(j-z)>1*p&&(y=!1)}b||(F=D+(T-=e.mc.Dn(u,F-I)),++E,k=0!=T,R.x=F)}else P||e.ta.sG(C,O,R,A)&&(P=!0);k&&M.write(2*L,F),I=F,C.N(O),O.N(R)}0!=E&&w.Qc(1993),b=w.Oa(0),_=w.Oa(_-1),e.h.ub(b,_),w=i.oQ(w,n,isNaN(o)?0:o,a),r.add(w,!1)}return t=n.Yd(0),s=c.S()/180,i.Kt(r,c,.1*t,!1),e.si.clip(r,c,t,s,a)},i.oQ=function(e,t,r,s){return i.Gn(e,t,r,!0,0,s)},i.FS=function(t,i,r,s){var n=t.K();if(1736==n)for(i=null!=i?i.Yd(0):0,n=0;n<s;n++)1!=e.jd.Zd(t,r[n],i)&&r[n].Sc();else{if(197!=n)throw e.i.O();for(n=0;n<s;n++)t.WO(r[n])||r[n].Sc()}},i.al=function(t,i,r,s){if(32>r)for(var n=new e.Ta,o=0;o<r;o++)n.Db(i[o]),t.al(n,s).D(i[o]);else{var a=new e.de;for(a.se(3),a.zD(i,r),n=a.vb(3),o=0;o<r;o++)n.write(o,o);for(o=t.al(a,s),t=o.vb(0),n=o.vb(3),s=e.h.construct(NaN,NaN),a=0;a<r;a++)i[a]=s;for(r=o.I(),o=0;o<r;o++)s=n.read(o),t.uc(2*o,i[s])}},i.$k=function(t,i,r,s){if(32>r)for(var n=new e.Ta,o=0;o<r;o++)n.Db(i[o]),t.$k(n,s).D(i[o]);else{var a=new e.de;for(a.se(3),a.zD(i,r),n=a.vb(3),o=0;o<r;o++)n.write(o,o);for(o=t.$k(a,s),t=o.vb(0),n=o.vb(3),s=e.h.construct(NaN,NaN),a=0;a<r;a++)i[a]=s;for(r=o.I(),o=0;o<r;o++)s=n.read(o),t.uc(2*o,i[s])}},i.hE=210,i}()}($||($={})),function(e){var t;(t=e.ML||(e.ML={}))[t.rightSide=1]="rightSide";var i=function(){function t(t,i,r){this.Cs=new e.h,void 0===t?this.Jo=-1:(this.Cs.N(t),this.Jo=i,this.La=r,this.ow=0)}return t.prototype.OJ=function(e){this.ow=e?1|this.ow:-2&this.ow},t.prototype.B=function(){return 0>this.Jo},t.prototype.az=function(){if(this.B())throw e.i.ga("invalid call");return new e.Ta(this.Cs.x,this.Cs.y)},t.prototype.Va=function(){if(this.B())throw e.i.ga("invalid call");return this.Jo},t.prototype.cz=function(){if(this.B())throw e.i.ga("invalid call");return this.La},t.prototype.Nz=function(){return 0!=(1&this.ow)},t.prototype.ay=function(e,t,i,r){this.Cs.x=e,this.Cs.y=t,this.Jo=i,this.La=r},t}();e.bm=i}($||($={})),function(e){var t=function(){function t(){}return t.prototype.Vo=function(t,i){this.uh.resize(0),this.Ji.length=0,this.tk=-1,t.yc(this.Ek),this.Ek.X(i,i),this.Ek.isIntersecting(this.Gb.Da)?((this.ws=e.ba.zd(t.K()))?(this.LH=t.ac(),this.KH=t.xc(),this.ra=i):this.ra=NaN,this.uh.add(this.Gb.kf),this.Ji.push(this.Gb.Da),this.Rs=this.Gb.Vr(this.Gb.kf)):this.Rs=-1},t.prototype.Yi=function(e,t){this.uh.resize(0),this.Ji.length=0,this.tk=-1,this.Ek.L(e),this.Ek.X(t,t),this.ra=NaN,this.Ek.isIntersecting(this.Gb.Da)?(this.uh.add(this.Gb.kf),this.Ji.push(this.Gb.Da),this.Rs=this.Gb.Vr(this.Gb.kf),this.ws=!1):this.Rs=-1},t.prototype.next=function(){if(0==this.uh.size)return-1;this.tk=this.Rs;var t=null,r=null,s=null,n=null;this.ws&&(t=new e.h,r=new e.h,s=new e.l);for(var o=!1;!o;){for(;-1!=this.tk;){var a=this.Gb.Xy(this.Gb.gv(this.tk));if(a.isIntersecting(this.Ek)){if(!this.ws){o=!0;break}if(t.N(this.LH),r.N(this.KH),s.L(a),s.X(this.ra,this.ra),0<s.ty(t,r)){o=!0;break}}this.tk=this.Gb.ov(this.tk)}if(-1==this.tk){a=this.uh.Gc();var l=this.Ji[this.Ji.length-1];for(null==n&&((n=[])[0]=new e.l,n[1]=new e.l,n[2]=new e.l,n[3]=new e.l),i.wJ(l,n),this.uh.Jf(),--this.Ji.length,l=0;4>l;l++){var h=this.Gb.Np(a,l);if(-1!=h&&0<this.Gb.NR(h)&&n[l].isIntersecting(this.Ek))if(this.ws){if(t.N(this.LH),r.N(this.KH),s.L(n[l]),s.X(this.ra,this.ra),0<s.ty(t,r)){var c=new e.l;c.L(n[l]),this.uh.add(h),this.Ji.push(c)}}else(c=new e.l).L(n[l]),this.uh.add(h),this.Ji.push(c)}if(0==this.uh.size)return-1;this.tk=this.Gb.Vr(this.uh.get(this.uh.size-1))}}return this.Rs=this.Gb.ov(this.tk),this.tk},t.UO=function(i,r,s){var n=new t;return n.Gb=i,n.Ek=new e.l,n.uh=new e.ja(0),n.Ji=[],n.Vo(r,s),n},t.TO=function(i,r,s){var n=new t;return n.Gb=i,n.Ek=new e.l,n.uh=new e.ja(0),n.Ji=[],n.Yi(r,s),n},t.SO=function(i){var r=new t;return r.Gb=i,r.Ek=new e.l,r.uh=new e.ja(0),r.Ji=[],r},t}();e.vY=t;var i=function(){function i(t,i){this.jf=new e.ad(11),this.$h=new e.ad(5),this.xs=[],this.hw=new e.ja(0),this.Da=new e.l,this.Nk(t,i)}return i.prototype.reset=function(e,t){this.jf.nj(!1),this.$h.nj(!1),this.xs.length=0,this.hw.clear(!1),this.Nk(e,t)},i.prototype.wj=function(e,t){return this.Av(e,t,0,this.Da,this.kf,!1,-1)},i.prototype.Ez=function(e,t,i){i=-1==i?this.kf:this.OF(i);var r=this.da(i),s=this.gR(i);return this.Av(e,t,r,s,i,!1,-1)},i.prototype.ka=function(e){return this.bR(e)},i.prototype.yF=function(e){return this.Xy(this.gv(e))},i.prototype.da=function(e){return this.kv(e)},i.prototype.gR=function(t){var i=new e.l;i.L(this.Da);var r=this.kv(t);t=this.IF(t);for(var s=0;s<2*r;s+=2){var n=e.P.truncate(3&t>>s);0==n?(i.v=.5*(i.v+i.C),i.G=.5*(i.G+i.H)):1==n?(i.C=.5*(i.v+i.C),i.G=.5*(i.G+i.H)):(2==n?i.C=.5*(i.v+i.C):i.v=.5*(i.v+i.C),i.H=.5*(i.G+i.H))}return i},i.prototype.NR=function(e){return this.vz(e)},i.prototype.mR=function(e,i){return t.UO(this,e,i)},i.prototype.EF=function(e,i){return t.TO(this,e,i)},i.prototype.getIterator=function(){return t.SO(this)},i.prototype.Nk=function(t,i){if(0>i||32<2*i)throw e.i.O("invalid height");this.rT=i,this.Da.L(t),this.kf=this.jf.De(),this.ix(this.kf,0),this.cx(this.kf,0),this.FJ(this.kf,0),this.CJ(this.kf,0)},i.prototype.Av=function(t,r,s,n,o,a,l){if(!n.contains(r))return 0==s?-1:this.Av(t,r,0,this.Da,this.kf,a,l);if(!a)for(var h=o;-1!=h;h=this.AR(h))this.ix(h,this.vz(h)+1);(h=new e.l).L(n),n=o;var c=[];for(c[0]=new e.l,c[1]=new e.l,c[2]=new e.l,c[3]=new e.l;s<this.rT&&this.aO(n);s++){i.wJ(h,c);for(var u=!1,p=0;4>p;p++)if(c[p].contains(r)){u=!0;var d=this.Np(n,p);-1==d&&(d=this.jP(n,p)),this.ix(d,this.vz(d)+1),n=d,h.L(c[p]);break}if(!u)break}return this.jS(t,r,s,h,n,a,o,l)},i.prototype.jS=function(e,t,i,r,s,n,o,a){var l=this.FF(s);if(n){if(s==o)return a;this.KP(a),n=a}else n=this.lP(),this.HB(n,e),this.zW(this.gv(n),t);return this.$W(n,s),-1!=l?(this.gx(n,l),this.dx(l,n)):this.yJ(s,n),this.LB(s,n),this.cx(s,this.mv(s)+1),this.$N(s)&&this.EQ(i,r,s),n},i.prototype.KP=function(e){var t=this.OF(e),i=this.FF(t),r=this.FR(e),s=this.ov(e);this.Vr(t)==e?(-1!=s?this.gx(s,-1):this.LB(t,-1),this.yJ(t,s)):i==e?(this.dx(r,-1),this.LB(t,r)):(this.gx(s,r),this.dx(r,s)),this.gx(e,-1),this.dx(e,-1),this.cx(t,this.mv(t)-1)},i.wJ=function(e,t){var i=.5*(e.v+e.C),r=.5*(e.G+e.H);t[0].L(i,r,e.C,e.H),t[1].L(e.v,r,i,e.H),t[2].L(e.v,e.G,i,r),t[3].L(i,e.G,e.C,r)},i.prototype.$N=function(e){return 8==this.mv(e)&&!this.ZF(e)},i.prototype.EQ=function(e,t,i){var r=this.Vr(i);do{var s=this.gv(r),n=this.$h.U(r,0);s=this.Xy(s),this.Av(n,s,e,t,i,!0,r),r=n=this.ov(r)}while(-1!=r)},i.prototype.aO=function(e){return 8<=this.mv(e)||this.ZF(e)},i.prototype.ZF=function(e){return-1!=this.Np(e,0)||-1!=this.Np(e,1)||-1!=this.Np(e,2)||-1!=this.Np(e,3)},i.prototype.jP=function(e,t){var i=this.jf.De();return this.EW(e,t,i),this.ix(i,0),this.cx(i,0),this.Pk(i,e),this.CJ(i,this.kv(e)+1),this.FJ(i,t<<2*this.kv(e)|this.IF(e)),i},i.prototype.lP=function(){var t=this.$h.De();if(0<this.hw.size){var i=this.hw.Gc();this.hw.Jf()}else i=this.xs.length,this.xs.push(new e.l);return this.AW(t,i),t},i.prototype.Np=function(e,t){return this.jf.U(e,t)},i.prototype.EW=function(e,t,i){this.jf.T(e,t,i)},i.prototype.Vr=function(e){return this.jf.U(e,4)},i.prototype.yJ=function(e,t){this.jf.T(e,4,t)},i.prototype.FF=function(e){return this.jf.U(e,5)},i.prototype.LB=function(e,t){this.jf.T(e,5,t)},i.prototype.IF=function(e){return this.jf.U(e,6)},i.prototype.FJ=function(e,t){this.jf.T(e,6,t)},i.prototype.mv=function(e){return this.jf.U(e,7)},i.prototype.vz=function(e){return this.jf.U(e,8)},i.prototype.cx=function(e,t){this.jf.T(e,7,t)},i.prototype.ix=function(e,t){this.jf.T(e,8,t)},i.prototype.AR=function(e){return this.jf.U(e,9)},i.prototype.Pk=function(e,t){this.jf.T(e,9,t)},i.prototype.kv=function(e){return this.jf.U(e,10)},i.prototype.CJ=function(e,t){this.jf.T(e,10,t)},i.prototype.bR=function(e){return this.$h.U(e,0)},i.prototype.HB=function(e,t){this.$h.T(e,0,t)},i.prototype.FR=function(e){return this.$h.U(e,1)},i.prototype.ov=function(e){return this.$h.U(e,2)},i.prototype.gx=function(e,t){this.$h.T(e,1,t)},i.prototype.dx=function(e,t){this.$h.T(e,2,t)},i.prototype.OF=function(e){return this.$h.U(e,3)},i.prototype.$W=function(e,t){this.$h.T(e,3,t)},i.prototype.gv=function(e){return this.$h.U(e,4)},i.prototype.AW=function(e,t){this.$h.T(e,4,t)},i.prototype.Xy=function(e){return this.xs[e]},i.prototype.zW=function(e,t){this.xs[e].L(t)},i}();e.eu=i}($||($={})),function(e){var t;(t=e.TK||(e.TK={}))[t.Outside=0]="Outside",t[t.Inside=1]="Inside",t[t.Border=2]="Border";var i=function(){function e(e,t){this.FT=t,this.Wh=e}return e.prototype.$w=function(e,t){this.aH!=t&&e.flush(),this.aH=t},e.prototype.ZE=function(e,t){for(var i=0;i<t;)for(var r=e[i++],s=e[i++],n=e[i++]*this.FT;r<s;r++)this.Wh[n+(r>>4)]|=this.aH<<2*(15&r)},e}();e.wY=i;var r=function(){function t(e,t,i){this.Wh=null,this.MA=this.Ik=this.VH=this.TH=this.Fs=this.iH=this.Hf=this.Wm=0,this.Si=this.Jk=this.xl=null,this.Az(e,t,i)}return t.create=function(i,r,s){if(!t.rE(i))throw e.i.O();return t.oP(i,r,s)},t.fW=function(t){switch(t){case 0:t=1024;break;case 1:t=16384;break;case 2:t=262144;break;default:throw e.i.ga("Internal Error")}return t},t.rE=function(e){return!(e.B()||1607!=e.K()&&1736!=e.K())},t.prototype.jQ=function(t,i){i=i.Ha();for(var r=new e.h,s=new e.h;i.ab();)for(;i.Ia();){var n=i.ia();if(322!=n.K())throw e.i.ga("Internal Error");t.Fh(n.ac(),r),t.Fh(n.xc(),s),this.Si.ey(r.x,r.y,s.x,s.y)}this.Si.aJ(e.Nx.Ax)},t.prototype.kQ=function(){throw e.i.ga("Internal Error")},t.prototype.My=function(t,i){for(var r=1;4>r;r++)t.ey(i[r-1].x,i[r-1].y,i[r].x,i[r].y);t.ey(i[3].x,i[3].y,i[0].x,i[0].y),this.Si.aJ(e.Nx.Ax)},t.prototype.jK=function(t,i,r){for(var s=[null,null,null,null],n=0;n<s.length;n++)s[n]=new e.h;i=i.Ha(),r=this.Jk.SX(r)+1.5,n=new e.h;for(var o=new e.h,a=new e.h,l=new e.h,h=new e.h,c=new e.l,u=new e.h;i.ab();){var p=!1,d=!0;for(u.na(0,0);i.Ia();){var f=i.ia();if(l.x=f.sa,l.y=f.oa,h.x=f.qa,h.y=f.ma,c.Pa(),c.$b(l.x,l.y),c.Lk(h.x,h.y),this.xl.zG(c)){this.Jk.Fh(h,h),d?(this.Jk.Fh(l,l),u.N(l),d=!1):l.N(u),n.vc(h,l);var y=.5>(f=n.length());0==f?n.na(1,0):(y||u.N(h),n.scale(r/f),o.na(-n.y,n.x),a.na(n.y,-n.x),l.sub(n),h.add(n),s[0].add(l,o),s[1].add(l,a),s[2].add(h,a),s[3].add(h,o),y?p=!0:this.My(t,s))}else p&&(this.My(t,s),p=!1),d=!0}p&&this.My(t,s)}},t.prototype.lC=function(t){return e.P.truncate(t*this.iH+this.TH)},t.prototype.mC=function(t){return e.P.truncate(t*this.Fs+this.VH)},t.oP=function(e,i,r){return new t(e,i,r)},t.prototype.Az=function(t,r,s){this.Hf=Math.max(e.P.truncate(2*Math.sqrt(s)+.5),64),this.Wm=e.P.truncate((2*this.Hf+31)/32),this.xl=new e.l,this.Ik=r,s=0;for(var n=this.Hf,o=this.Wm;8<=n;)s+=n*o,n=e.P.truncate(n/2),o=e.P.truncate((2*n+31)/32);this.Wh=e.P.lg(s,0),this.Si=new e.Nx,s=new i(this.Wh,this.Wm,this),this.Si.oX(this.Hf,this.Hf,s),t.A(this.xl),this.xl.X(r,r),n=new e.l;var a=r*(o=e.l.construct(1,1,this.Hf-2,this.Hf-2)).S();switch(r*=o.da(),n.L(this.xl.tf(),Math.max(a,this.xl.S()),Math.max(r,this.xl.da())),this.MA=this.Ik,this.Jk=new e.Ed,this.Jk.gS(n,o),new e.Ed,t.K()){case 550:s.$w(this.Si,2),this.kQ();break;case 1607:s.$w(this.Si,2),this.jK(this.Si,t,this.MA);break;case 1736:s.$w(this.Si,1),this.jQ(this.Jk,t),s.$w(this.Si,2),this.jK(this.Si,t,this.MA)}this.iH=this.Jk.eb,this.Fs=this.Jk.bb,this.TH=this.Jk.Lb,this.VH=this.Jk.Qb,this.PN()},t.prototype.PN=function(){this.Si.flush();for(var t=0,i=this.Hf*this.Wm,r=this.Hf,s=e.P.truncate(this.Hf/2),n=this.Wm,o=e.P.truncate((2*s+31)/32);8<r;){for(r=0;r<s;r++)for(var a=2*r,l=2*r+1,h=0;h<s;h++){var c=2*h,u=2*h+1,p=c>>4;c=2*(15&c);var d=u>>4;u=2*(15&u);var f=this.Wh[t+n*a+p]>>c&3;f|=this.Wh[t+n*a+d]>>u&3,f|=this.Wh[t+n*l+p]>>c&3,f|=this.Wh[t+n*l+d]>>u&3,this.Wh[i+o*r+(h>>4)]|=f<<2*(15&h)}r=s,n=o,t=i,s=e.P.truncate(r/2),o=e.P.truncate((2*s+31)/32),i=t+n*r}},t.prototype.To=function(e,t){return this.xl.contains(e,t)?(e=this.lC(e),t=this.mC(t),0>e||e>=this.Hf||0>t||t>=this.Hf||0==(t=this.Wh[this.Wm*t+(e>>4)]>>2*(15&e)&3)?0:1==t?1:2):0},t.prototype.So=function(t){if(!t.Fa(this.xl))return 0;var i=this.lC(t.v),r=this.lC(t.C),s=this.mC(t.G);if(t=this.mC(t.H),0>i&&(i=0),0>s&&(s=0),r>=this.Hf&&(r=this.Hf-1),t>=this.Hf&&(t=this.Hf-1),i>r||s>t)return 0;for(var n=Math.max(r-i,1)*Math.max(t-s,1),o=0,a=this.Wm,l=this.Hf,h=0;;){if(32>n||16>l){for(n=s;n<=t;n++)for(var c=i;c<=r;c++)if(1<(h=this.Wh[o+a*n+(c>>4)]>>2*(15&c)&3))return 2;if(0==h)return 0;if(1==h)return 1}o+=a*l,l=e.P.truncate(l/2),a=e.P.truncate((2*l+31)/32),i=e.P.truncate(i/2),s=e.P.truncate(s/2),r=e.P.truncate(r/2),t=e.P.truncate(t/2),n=Math.max(r-i,1)*Math.max(t-s,1)}},t.prototype.IR=function(){return this.Hf*this.Wm},t}();e.Lx=r}($||($={})),function(e){var t;(t=e.NL||(e.NL={}))[t.contains=1]="contains",t[t.within=2]="within",t[t.equals=3]="equals",t[t.disjoint=4]="disjoint",t[t.touches=8]="touches",t[t.crosses=16]="crosses",t[t.overlaps=32]="overlaps",t[t.unknown=0]="unknown",t[t.intersects=1073741824]="intersects";var i=function(){function e(){}return e.construct=function(t,i,r,s,n,o,a,l){var h=new e;return h.qw=t,h.Om=i,h.Lj=r,h.Ti=s,h.tH=n,h.HY=o,h.IY=a,h.JY=l,h},e}();e.Wt=function(){function t(){}return t.uD=function(i,r,s){if(t.qy(i)){var n=e.ta.lj(r,i,!1);r=!1,e.Uk.uE(i)&&(r=r||i.mu(n,s)),1736!=(n=i.K())&&1607!=n||!e.Uk.sE(i)||0==s||(r=r||i.gj(s)),1736!=n&&1607!=n||!e.Uk.tE(i)||0==s||r||i.$L()}},t.qy=function(t){return e.Uk.uE(t)||e.Uk.sE(t)||e.Uk.tE(t)},t}();var r=function(){function t(){this.sh=[]}return t.tB=function(i,r,s,n,o){var a=i.K(),l=r.K();if(197==a){if(197==l)return t.jW(i,r,s,n);if(33==l)return 2==n?n=1:1==n&&(n=2),t.$I(r,i,s,n)}else if(33==a){if(197==l)return t.$I(i,r,s,n);if(33==l)return t.lW(i,r,s,n)}if(i.B()||r.B())return 4==n;var h=new e.l;i.A(h);var c=new e.l;r.A(c);var u=new e.l;if(u.L(h),u.$b(c),s=e.ta.Xd(s,u,!1),t.dk(h,c,s))return 4==n;switch(h=!1,e.Vk.zd(a)&&((a=new e.Ua(i.description)).oc(i,!0),i=a,a=1607),e.Vk.zd(l)&&((l=new e.Ua(r.description)).oc(r,!0),r=l,l=1607),197!=a&&197!=l?(i.Eb()<r.Eb()||33==a&&550==l)&&(2==n?n=1:1==n&&(n=2)):1736!=a&&197!=l&&(2==n?n=1:1==n&&(n=2)),a){case 1736:switch(l){case 1736:h=t.rt(i,r,s,n,o);break;case 1607:h=t.bn(i,r,s,n,o);break;case 33:h=t.qt(i,r,s,n);break;case 550:h=t.pt(i,r,s,n,o);break;case 197:h=t.yI(i,r,s,n,o)}break;case 1607:switch(l){case 1736:h=t.bn(r,i,s,n,o);break;case 1607:h=t.aB(i,r,s,n,o);break;case 33:h=t.tt(i,r,s,n,o);break;case 550:h=t.st(i,r,s,n,o);break;case 197:h=t.EI(i,r,s,n)}break;case 33:switch(l){case 1736:h=t.qt(r,i,s,n);break;case 1607:h=t.tt(r,i,s,n,o);break;case 550:h=t.lt(r,i,s,n)}break;case 550:switch(l){case 1736:h=t.pt(r,i,s,n,o);break;case 1607:h=t.st(r,i,s,n,o);break;case 550:h=t.TA(i,r,s,n,o);break;case 33:h=t.lt(i,r,s,n);break;case 197:h=t.$H(i,r,s,n)}break;case 197:switch(l){case 1736:h=t.yI(r,i,s,n,o);break;case 1607:h=t.EI(r,i,s,n);break;case 550:h=t.$H(r,i,s,n)}}return h},t.jW=function(i,r,s,n){if(i.B()||r.B())return 4==n;var o=new e.l,a=new e.l,l=new e.l;switch(i.A(o),r.A(a),l.L(o),l.$b(a),i=e.ta.Xd(s,l,!1),n){case 4:return t.dk(o,a,i);case 2:return t.bF(a,o,i);case 1:return t.bF(o,a,i);case 3:return t.ek(o,a,i);case 8:return t.VP(o,a,i);case 32:return t.UP(o,a,i);case 16:return t.TP(o,a,i)}return!1},t.$I=function(i,r,s,n){if(i.B()||r.B())return 4==n;i=i.D();var o=new e.l,a=new e.l;switch(r.A(o),a.L(i),a.$b(o),r=e.ta.Xd(s,a,!1),n){case 4:return t.Sw(i,o,r);case 2:return t.ZA(i,o,r);case 1:return t.HU(i,o,r);case 3:return t.nI(i,o,r);case 8:return t.YA(i,o,r)}return!1},t.lW=function(i,r,s,n){if(i.B()||r.B())return 4==n;i=i.D(),r=r.D();var o=new e.l;switch(o.L(i),o.$b(r),s=e.ta.Xd(s,o,!1),n){case 4:return t.IU(i,r,s);case 2:return t.mI(r,i,s);case 1:return t.mI(i,r,s);case 3:return t.oI(i,r,s)}return!1},t.rt=function(e,i,r,s,n){switch(s){case 4:return t.aV(e,i,r);case 2:return t.Tw(i,e,r,n);case 1:return t.Tw(e,i,r,n);case 3:return t.dV(e,i,r);case 8:return t.lV(e,i,r);case 32:return t.gV(e,i,r,n)}return!1},t.bn=function(e,i,r,s,n){switch(s){case 4:return t.bV(e,i,r);case 1:return t.$A(e,i,r,n);case 8:return t.mV(e,i,r,n);case 16:return t.XU(e,i,r)}return!1},t.qt=function(e,i,r,s){switch(s){case 4:return t.$U(e,i,r);case 1:return t.UU(e,i,r);case 8:return t.kV(e,i,r)}return!1},t.pt=function(e,i,r,s){switch(s){case 4:return t.ZU(e,i,r);case 1:return t.TU(e,i,r);case 8:return t.jV(e,i,r);case 16:return t.WU(e,i,r)}return!1},t.yI=function(e,i,r,s,n){if(t.YU(e,i,r))return 4==s;if(4==s)return!1;switch(s){case 2:return t.nV(e,i,r);case 1:return t.SU(e,i,r);case 3:return t.cV(e,i,r);case 8:return t.iV(e,i,r,n);case 32:return t.fV(e,i,r,n);case 16:return t.VU(e,i,r,n)}return!1},t.aB=function(e,i,r,s){switch(s){case 4:return t.wV(e,i,r);case 2:return t.CI(i,e,r);case 1:return t.CI(e,i,r);case 3:return t.yV(e,i,r);case 8:return t.FI(e,i,r);case 32:return t.CV(e,i,r);case 16:return t.DI(e,i,r)}return!1},t.tt=function(e,i,r,s){switch(s){case 4:return t.vV(e,i,r);case 1:return t.qV(e,i,r);case 8:return t.GV(e,i,r)}return!1},t.st=function(e,i,r,s){switch(s){case 4:return t.uV(e,i,r);case 1:return t.pV(e,i,r);case 8:return t.FV(e,i,r);case 16:return t.sV(e,i,r)}return!1},t.EI=function(e,i,r,s){if(t.tV(e,i,r))return 4==s;if(4==s)return!1;switch(s){case 2:return t.HV(e,i,r);case 1:return t.oV(e,i,r);case 3:return t.xV(e,i,r);case 8:return t.EV(e,i,r);case 32:return t.BV(e,i,r);case 16:return t.rV(e,i,r)}return!1},t.TA=function(e,i,r,s){switch(s){case 4:return t.XT(e,i,r);case 2:return t.XH(i,e,r);case 1:return t.XH(e,i,r);case 3:return t.ZT(e,i,r);case 32:return t.eU(e,i,r)}return!1},t.lt=function(e,i,r,s){switch(s){case 4:return t.YH(e,i,r);case 2:return t.iU(e,i,r);case 1:return t.UT(e,i,r);case 3:return t.Ow(e,i,r)}return!1},t.$H=function(e,i,r,s){switch(s){case 4:return t.WT(e,i,r);case 2:return t.hU(e,i,r);case 1:return t.TT(e,i,r);case 3:return t.YT(e,i,r);case 8:return t.gU(e,i,r);case 16:return t.VT(e,i,r)}return!1},t.dV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!!t.ek(n,o,s)&&4!=(n=t.qc(i,r,!1))&&1!=n&&2!=n&&(!!t.WH(i,r,s)||(n=i.Rb(),o=r.Rb(),!(Math.abs(n-o)>4*Math.max(i.I(),r.I())*s)&&t.Rz(i,r,s,!0)))},t.aV=function(e,i,r){var s=t.qc(e,i,!0);return 4==s||1!=s&&2!=s&&1073741824!=s&&t.wI(e,i,r)},t.lV=function(e,i,r){var s=t.qc(e,i,!1);return 4!=s&&1!=s&&2!=s&&t.AI(e,i,r,null)},t.gV=function(e,i,r,s){var n=t.qc(e,i,!1);return 4!=n&&1!=n&&2!=n&&t.xI(e,i,r,s)},t.Tw=function(i,r,s,n){var o=new e.l,a=new e.l;return i.A(o),r.A(a),!!t.Ac(o,a,s)&&4!=(o=t.qc(i,r,!1))&&2!=o&&(1==o||t.tI(i,r,s,n))},t.bV=function(e,i,r){var s=t.qc(e,i,!0);return 4==s||1!=s&&1073741824!=s&&t.wI(e,i,r)},t.mV=function(e,i,r,s){var n=t.qc(e,i,!1);return 4!=n&&1!=n&&t.BI(e,i,r,s)},t.XU=function(e,i,r){var s=t.qc(e,i,!1);return 4!=s&&1!=s&&t.vI(e,i,r,null)},t.$A=function(i,r,s,n){var o=new e.l,a=new e.l;return i.A(o),r.A(a),!!t.Ac(o,a,s)&&4!=(o=t.qc(i,r,!1))&&(1==o||t.uI(i,r,s,n))},t.$U=function(t,i,r){return 0==e.jd.CG(t,i,r)},t.kV=function(e,i,r){return i=i.D(),t.zI(e,i,r)},t.UU=function(e,i,r){return i=i.D(),t.sI(e,i,r)},t.ZU=function(i,r,s){var n=t.qc(i,r,!1);if(4==n)return!0;if(1==n)return!1;n=new e.l,i.A(n),n.X(s,s);for(var o=new e.h,a=0;a<r.I();a++)if(r.D(a,o),n.contains(o)){var l=e.jd.Zd(i,o,s);if(1==l||2==l)return!1}return!0},t.jV=function(t,i,r){var s=this.qc(t,i,!1);if(4==s||1==s)return!1;s=new e.l,t.A(s),s.X(r,r);for(var n=!1,o=t,a=!1,l=0;l<i.I();l++){var h=i.Oa(l);if(s.contains(h))if(2==(h=e.jd.Zd(o,h,r)))n=!0;else if(1==h)return!1;a||(!e.Fg.Ol(t,i.I()-1)||null!=t.Cb&&null!=t.Cb.Gb?o=t:(o=new e.Ea,t.copyTo(o),o.gj(1)),a=!0)}return!!n},t.WU=function(t,i,r){var s=this.qc(t,i,!1);if(4==s||1==s)return!1;var n=new e.l;s=new e.l;var o=new e.l;t.A(n),i.A(o),s.L(n),s.X(r,r),o=n=!1;for(var a=t,l=!1,h=0;h<i.I();h++){var c=i.Oa(h);if(s.contains(c)?0==(c=e.jd.Zd(a,c,r))?o=!0:1==c&&(n=!0):o=!0,n&&o)return!0;l||(!e.Fg.Ol(t,i.I()-1)||null!=t.Cb&&null!=t.Cb.Gb?a=t:(a=new e.Ea,t.copyTo(a),a.gj(1)),l=!0)}return!1},t.TU=function(t,i,r){var s=new e.l,n=new e.l;if(t.A(s),i.A(n),!this.Ac(s,n,r))return!1;if(4==(n=this.qc(t,i,!1)))return!1;if(1==n)return!0;n=!1;for(var o=t,a=!1,l=0;l<i.I();l++){var h=i.Oa(l);if(!s.contains(h))return!1;if(1==(h=e.jd.Zd(o,h,r)))n=!0;else if(0==h)return!1;a||(!e.Fg.Ol(t,i.I()-1)||null!=t.Cb&&null!=t.Cb.Gb?o=t:(o=new e.Ea,t.copyTo(o),o.gj(1)),a=!0)}return n},t.cV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!!t.ek(n,o,s)&&((n=new e.Ea).bd(r,!1),t.Rz(i,n,s,!0))},t.YU=function(i,r,s){var n=t.qc(i,r,!1);if(4==n)return!0;if(1==n||2==n)return!1;var o=new e.l;if(n=new e.l,i.A(o),r.A(n),t.Ac(n,o,s))return!1;if(o=new e.h,n.fn(o),0!=(r=e.jd.Zd(i,o,s)))return!1;if(n.SI(o),0!=(r=e.jd.Zd(i,o,s)))return!1;if(n.gn(o),0!=(r=e.jd.Zd(i,o,s)))return!1;if(n.VI(o),0!=(r=e.jd.Zd(i,o,s)))return!1;r=i.vb(0),(o=new e.l).L(n),o.X(s,s);for(var a=0,l=i.I();a<l;a++){var h=r.read(2*a),c=r.read(2*a+1);if(o.contains(h,c))return!1}return!t.KG(i,n,s)},t.iV=function(i,r,s,n){var o=t.qc(i,r,!1);if(4==o||1==o||2==o)return!1;o=new e.l;var a=new e.l;return i.A(o),r.A(a),!t.Ac(a,o,s)&&(a.S()<=s&&a.da()<=s?(r=r.Kp(),t.zI(i,r,s)):a.S()<=s||a.da()<=s?(o=new e.Ua,a=new e.Ta,r.If(0,a),o.nf(a),r.If(2,a),o.lineTo(a),t.BI(i,o,s,n)):((o=new e.Ea).bd(r,!1),t.AI(i,o,s,n)))},t.fV=function(i,r,s,n){var o=t.qc(i,r,!1);if(4==o||1==o||2==o)return!1;o=new e.l;var a=new e.l;return i.A(o),r.A(a),!(t.Ac(a,o,s)||a.S()<=s||a.da()<=s)&&((o=new e.Ea).bd(r,!1),t.xI(i,o,s,n))},t.nV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),t.Ac(o,n,s)},t.SU=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!!t.Ac(n,o,s)&&4!=(n=t.qc(i,r,!1))&&2!=n&&(1==n||(o.S()<=s&&o.da()<=s?(r=r.Kp(),t.sI(i,r,s)):o.S()<=s||o.da()<=s?(o=new e.Ua,n=new e.Ta,r.If(0,n),o.nf(n),r.If(2,n),o.lineTo(n),t.uI(i,o,s,null)):((o=new e.Ea).bd(r,!1),t.tI(i,o,s,null))))},t.VU=function(i,r,s,n){var o=new e.l,a=new e.l;return i.A(o),r.A(a),!(t.Ac(a,o,s)||a.da()>s&&a.S()>s||a.da()<=s&&a.S()<=s)&&(o=new e.Ua,a=new e.Ta,r.If(0,a),o.nf(a),r.If(2,a),o.lineTo(a),t.vI(i,o,s,n))},t.yV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!(!t.ek(n,o,s)||4==t.qc(i,r,!1))&&(!!t.WH(i,r,s)||t.Rz(i,r,s,!1))},t.wV=function(t,i,r){return 4==this.qc(t,i,!1)||!!new e.am(t,i,r,!0).next()&&!this.LG(t,i,r)},t.FI=function(i,r,s){if(4==t.qc(i,r,!1))return!1;var n=new e.ce(0);if(0!=t.Sz(i,r,s,n))return!1;for(var o=new e.de,a=0;a<n.size;a+=2){var l=n.read(a),h=n.read(a+1);o.Cu(l,h)}return i=i.mg(),r=r.mg(),i.Gd(r,0,r.I()),t.Nw(i,o,s)},t.DI=function(i,r,s){if(4==t.qc(i,r,!1))return!1;var n=new e.ce(0);if(0!=t.Sz(i,r,s,n))return!1;for(var o=new e.de,a=0;a<n.size;a+=2){var l=n.read(a),h=n.read(a+1);o.Cu(l,h)}return i=i.mg(),r=r.mg(),i.Gd(r,0,r.I()),!t.Nw(i,o,s)},t.CV=function(e,i,r){return 4!=t.qc(e,i,!1)&&t.NG(e,i,r)},t.CI=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!(!t.Ac(n,o,s)||4==t.qc(i,r,!1))&&t.Am(r,i,s,!1)},t.vV=function(e,i,r){return 4==t.qc(e,i,!1)||(i=i.D(),!t.Tz(e,i,r))},t.GV=function(e,i,r){return 4!=t.qc(e,i,!1)&&(i=i.D(),t.Uz(e,i,r))},t.qV=function(e,i,r){return 4!=t.qc(e,i,!1)&&(i=i.D(),t.JG(e,i,r))},t.uV=function(e,i,r){return 4==t.qc(e,i,!1)||!t.MG(e,i,r,!1)},t.FV=function(t,i,r){if(4==this.qc(t,i,!1))return!1;var s=t.Ha(),n=new e.l,o=new e.l,a=new e.l;t.A(n),i.A(o),n.X(r,r),o.X(r,r),a.L(n),a.Fa(o),n=null;var l=t.Cb;if(null!=l){var h=l.Gb;n=l.Ao,null==h&&(h=l=e.ta.kj(t,a))}else h=l=e.ta.kj(t,a);var c=h.getIterator(),u=null;null!=n&&(u=n.getIterator());var p=new e.h,d=new e.h,f=!1,y=r*r;for(n=new e.rn(i.I()),l=0;l<i.I();l++)n.write(l,0);for(l=0;l<i.I();l++)if(i.D(l,p),a.contains(p)){if(o.L(p.x,p.y,p.x,p.y),null!=u&&(u.Yi(o,r),-1==u.next()))continue;c.Yi(o,r);for(var g=c.next();-1!=g;g=c.next())if(s.Wb(h.ka(g)),(g=s.ia()).ic(g.fe(p,!1),d),e.h.zc(p,d)<=y){n.write(l,1),f=!0;break}}if(!f)return!1;for(t=t.mg(),s=new e.de,o=new e.h,l=0;l<i.I();l++)0!=n.read(l)&&(i.D(l,o),s.Cu(o.x,o.y));return this.Nw(t,s,r)},t.sV=function(t,i,r){if(4==this.qc(t,i,!1))return!1;var s=t.Ha(),n=new e.l,o=new e.l,a=new e.l;t.A(n),i.A(o),n.X(r,r),o.X(r,r),a.L(n),a.Fa(o),n=null;var l=t.Cb;if(null!=l){var h=l.Gb;n=l.Ao,null==h&&(h=l=e.ta.kj(t,a))}else h=l=e.ta.kj(t,a);var c=h.getIterator(),u=null;null!=n&&(u=n.getIterator());var p=new e.h,d=new e.h,f=!1,y=!1,g=r*r;for(n=new e.rn(i.I()),l=0;l<i.I();l++)n.write(l,0);for(l=0;l<i.I();l++)if(i.D(l,p),a.contains(p)){if(o.L(p.x,p.y,p.x,p.y),null!=u&&(u.Yi(o,r),-1==u.next())){y=!0;continue}c.Yi(o,r);for(var m=!1,v=c.next();-1!=v;v=c.next())if(s.Wb(h.ka(v)),(v=s.ia()).ic(v.fe(p,!1),d),e.h.zc(p,d)<=g){n.write(l,1),m=f=!0;break}m||(y=!0)}else y=!0;if(!f||!y)return!1;for(t=t.mg(),s=new e.de,o=new e.h,l=0;l<i.I();l++)0!=n.read(l)&&(i.D(l,o),s.Cu(o.x,o.y));return!this.Nw(t,s,r)},t.pV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!(!t.Ac(n,o,s)||4==t.qc(i,r,!1)||!t.MG(i,r,s,!0)||(i=i.mg(),t.ZH(i,r,s)))},t.xV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!(o.da()>s&&o.S()>s)&&t.ek(n,o,s)},t.tV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!t.Ac(o,n,s)&&!t.KG(i,o,s)},t.EV=function(i,r,s){var n=new e.l,o=new e.l;if(i.A(n),r.A(o),o.da()<=s&&o.S()<=s)return o=r.Kp(),t.Uz(i,o,s);if(o.da()<=s||o.S()<=s)return o=new e.Ua,n=new e.Ta,r.If(0,n),o.nf(n),r.If(2,n),o.lineTo(n),t.FI(i,o,s);i=i.Ha(),r=new e.l,n=new e.l,r.L(o),n.L(o),r.X(-s,-s),n.X(s,s),o=!1;for(var a=new e.l,l=new e.l;i.ab();)for(;i.Ia();){if(i.ia().A(a),l.L(r),l.Fa(a),!l.B()&&(l.da()>s||l.S()>s))return!1;l.L(n),l.Fa(a),l.B()||(o=!0)}return o},t.BV=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!(t.Ac(n,o,s)||t.Ac(o,n,s)||t.Ac(o,n,s)||o.da()>s&&o.S()>s||o.da()<=s&&o.S()<=s)&&(n=new e.Ua,o=new e.Ta,r.If(0,o),n.nf(o),r.If(2,o),n.lineTo(o),t.NG(i,n,s))},t.HV=function(i,r,s){var n=new e.l,o=new e.l;if(i.A(n),r.A(o),!t.Ac(o,n,s)||o.da()<=s&&o.S()<=s)return!1;if(o.da()<=s||o.S()<=s)return t.Ac(o,n,s);i=i.Ha(),(r=new e.l).L(o),r.X(-s,-s),o=!1,n=new e.l;for(var a=new e.l;i.ab();)for(;i.Ia();)i.ia().A(n),r.jm(n)?o=!0:(a.L(r),a.Fa(n),!a.B()&&(a.da()>s||a.S()>s)&&(o=!0));return o},t.oV=function(i,r,s){var n=new e.l,o=new e.l;return r.A(o),i.A(n),!(!t.Ac(n,o,s)||o.da()>s&&o.S()>s)&&(o.da()<=s&&o.S()<=s?(r=r.Kp(),t.JG(i,r,s)):(n=new e.Ua,o=new e.Ta,r.If(0,o),n.nf(o),r.If(2,o),n.lineTo(o),t.Am(n,i,s,!1)))},t.rV=function(i,r,s){var n=new e.l,o=new e.l;if(i.A(n),r.A(o),t.Ac(o,n,s)||o.da()<=s&&o.S()<=s)return!1;if(o.da()<=s||o.S()<=s)return n=new e.Ua,o=new e.Ta,r.If(0,o),n.nf(o),r.If(2,o),n.lineTo(o),t.DI(i,n,s);i=i.Ha(),r=new e.l,(n=new e.l).L(o),r.L(o),n.X(-s,-s),r.X(s,s);for(var a=o=!1,l=new e.l,h=new e.l;i.ab();)for(;i.Ia();)if(i.ia().A(l),a||r.contains(l)||(a=!0),o||(h.L(n),h.Fa(l),!h.B()&&(h.da()>s||h.S()>s)&&(o=!0)),o&&a)return!0;return!1},t.ZT=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!!t.ek(n,o,s)&&(!!t.$T(i,r,s)||t.SA(i,r,s,!1,!0,!1))},t.XT=function(e,i,r){return!t.ZH(e,i,r)},t.eU=function(e,i,r){return t.SA(e,i,r,!1,!1,!0)},t.XH=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!!t.Ac(n,o,s)&&t.SA(r,i,s,!0,!1,!1)},t.Nw=function(t,i,r){r*=r;for(var s=new e.h,n=new e.h,o=0;o<i.I();o++){i.D(o,n);for(var a=!1,l=0;l<t.I();l++)if(t.D(l,s),e.h.zc(s,n)<=r){a=!0;break}if(!a)return!1}return!0},t.Ow=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),t.ek(n,o,s)},t.YH=function(e,i,r){return i=i.D(),t.kt(e,i,r)},t.iU=function(e,i,r){return t.Ow(e,i,r)},t.UT=function(e,i,r){return!t.YH(e,i,r)},t.YT=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!(o.da()>s||o.S()>s)&&t.ek(n,o,s)},t.WT=function(i,r,s){var n=new e.l,o=new e.l;if(i.A(n),r.A(o),t.Ac(o,n,s))return!1;for((r=new e.l).L(o),r.X(s,s),s=new e.h,o=0;o<i.I();o++)if(i.D(o,s),r.contains(s))return!1;return!0},t.gU=function(t,i,r){var s=new e.l,n=new e.l,o=new e.l;if(i.A(s),s.da()<=r&&s.S()<=r)return!1;if(s.da()<=r||s.S()<=r){i=new e.h;var a=!1;n.L(s),o.L(s),n.X(r,r),s.da()>r?o.X(0,-r):o.X(-r,0);for(var l=0;l<t.I();l++)if(t.D(l,i),n.contains(i)){if(s.da()>r){if(i.y>o.G&&i.y<o.H)return!1}else if(i.x>o.v&&i.x<o.C)return!1;a=!0}return a}for(n.L(s),o.L(s),n.X(r,r),o.X(-r,-r),i=new e.h,a=!1,l=0;l<t.I();l++)if(t.D(l,i),n.contains(i)){if(o.jm(i))return!1;a=!0}return a},t.hU=function(i,r,s){var n=new e.l,o=new e.l;if(i.A(n),r.A(o),!t.Ac(o,n,s))return!1;if(o.da()<=s&&o.S()<=s)return t.ek(n,o,s);if(o.da()<=s||o.S()<=s){r=!1,n=new e.l;var a=new e.l;n.L(o),a.L(o),o.da()>s?n.X(0,-s):n.X(-s,0),a.X(s,s);for(var l=new e.h,h=0;h<i.I();h++){if(i.D(h,l),!a.contains(l))return!1;o.da()>s?l.y>n.G&&l.y<n.H&&(r=!0):l.x>n.v&&l.x<n.C&&(r=!0)}return r}for(r=!1,n=new e.l,a=new e.l,n.L(o),a.L(o),n.X(-s,-s),a.X(s,s),l=new e.h,h=0;h<i.I();h++){if(i.D(h,l),!a.contains(l))return!1;n.jm(l)&&(r=!0)}return r},t.TT=function(i,r,s){var n=new e.l,o=new e.l;return i.A(n),r.A(o),!(!t.Ac(n,o,s)||o.da()>s||o.S()>s||(r=r.Kp(),t.kt(i,r,s)))},t.VT=function(i,r,s){var n=new e.l,o=new e.l;if(i.A(n),r.A(o),t.Ac(o,n,s)||o.da()<=s&&o.S()<=s)return!1;if(o.da()<=s||o.S()<=s){r=new e.l,n=new e.l,r.L(o),o.da()>s?r.X(0,-s):r.X(-s,0),n.L(o),n.X(s,s);for(var a=new e.h,l=!1,h=!1,c=0;c<i.I();c++)if(i.D(c,a),l||(o.da()>s?a.y>r.G&&a.y<r.H&&(l=!0):a.x>r.v&&a.x<r.C&&(l=!0)),h||n.contains(a)||(h=!0),l&&h)return!0;return!1}for(r=new e.l,n=new e.l,r.L(o),r.X(-s,-s),n.L(o),n.X(s,s),a=new e.h,h=l=!1,c=0;c<i.I();c++)if(i.D(c,a),!l&&r.jm(a)&&(l=!0),h||n.contains(a)||(h=!0),l&&h)return!0;return!1},t.oI=function(t,i,r){return e.h.zc(t,i)<=r*r},t.IU=function(t,i,r){return e.h.zc(t,i)>r*r},t.mI=function(e,i,r){return t.oI(e,i,r)},t.nI=function(i,r,s){var n=new e.l;return n.L(i),t.ek(n,r,s)},t.Sw=function(t,i,r){var s=new e.l;return s.L(i),s.X(r,r),!s.contains(t)},t.YA=function(t,i,r){if(i.da()<=r&&i.S()<=r)return!1;var s=new e.l,n=new e.l;if(s.L(i),s.X(r,r),!s.contains(t))return!1;if(i.da()<=r||i.S()<=r){if(n.L(i),i.da()>r?n.X(0,-r):n.X(-r,0),i.da()>r){if(t.y>n.G&&t.y<n.H)return!1}else if(t.x>n.v&&t.x<n.C)return!1;return!0}return n.L(i),n.X(-r,-r),!n.jm(t)},t.ZA=function(t,i,r){if(i.da()<=r&&i.S()<=r)return!0;if(i.da()<=r||i.S()<=r){var s=new e.l;s.L(i),i.da()>r?s.X(0,-r):s.X(-r,0);var n=!1;return i.da()>r?t.y>s.G&&t.y<s.H&&(n=!0):t.x>s.v&&t.x<s.C&&(n=!0),n}return(s=new e.l).L(i),s.X(-r,-r),s.jm(t)},t.HU=function(e,i,r){return t.nI(e,i,r)},t.ek=function(e,i,r){return t.Ac(e,i,r)&&t.Ac(i,e,r)},t.dk=function(t,i,r){var s=new e.l;return s.L(i),s.X(r,r),!t.isIntersecting(s)},t.VP=function(i,r,s){if(i.da()<=s&&i.S()<=s){var n=i.tf();return t.YA(n,r,s)}if(r.da()<=s&&r.S()<=s)return n=r.tf(),t.YA(n,i,s);if(i.da()>s&&i.S()>s&&(r.da()<=s||r.S()<=s)?n=r:(n=i,i=r),n.da()<=s||n.S()<=s){if(i.da()<=s||i.S()<=s){r=new e.zb;var o=new e.zb,a=[0,0],l=[0,0],h=new e.h;return n.fn(h),r.Ec(h),n.gn(h),r.Rc(h),i.fn(h),o.Ec(h),i.gn(h),o.Rc(h),r.Fa(o,null,a,l,s),1==r.Fa(o,null,null,null,s)&&(0==a[0]||1==a[1]||0==l[0]||1==l[1])}return r=new e.l,o=new e.l,r.L(i),r.X(-s,-s),o.L(r),o.Fa(n),!(!o.B()&&(o.da()>s||o.S()>s))}return i.X(s,s),(o=new e.l).L(n),o.Fa(i),!(o.B()||!o.B()&&o.da()>s&&o.S()>s)},t.UP=function(i,r,s){if(t.Ac(i,r,s)||t.Ac(r,i,s)||i.da()<=s&&i.S()<=s||r.da()<=s&&r.S()<=s)return!1;if(i.da()<=s||i.S()<=s){if(r.da()>s&&r.S()>s)return!1;var n=new e.zb,o=new e.zb,a=[0,0],l=[0,0],h=new e.h;return i.fn(h),n.Ec(h),i.gn(h),n.Rc(h),r.fn(h),o.Ec(h),r.gn(h),o.Rc(h),n.Fa(o,null,a,l,s),2==n.Fa(o,null,null,null,s)&&(0<a[0]||1>a[1])&&(0<l[0]||1>l[1])}return!(r.da()<=s||r.S()<=s||((n=new e.l).L(i),n.Fa(r),n.B()||n.da()<=s||n.S()<=s))},t.bF=function(i,r,s){if(!t.Ac(i,r,s))return!1;if(i.da()<=s&&i.S()<=s)return i=i.tf(),t.ZA(i,r,s);if(r.da()<=s&&r.S()<=s)return r=r.tf(),t.ZA(r,i,s);if(i.da()<=s||i.S()<=s)return t.Ac(i,r,s);if(r.da()<=s||r.S()<=s){var n=new e.l;return n.L(i),n.X(-s,-s),!!n.jm(r)||((i=new e.l).L(n),i.Fa(r),!(i.B()||i.da()<=s&&i.S()<=s))}return t.Ac(i,r,s)},t.TP=function(i,r,s){if(t.Ac(i,r,s)||t.Ac(r,i,s)||i.da()<=s&&i.S()<=s||r.da()<=s&&r.S()<=s||r.da()>s&&r.S()>s&&i.da()>s&&i.S()>s)return!1;if(i.da()>s&&i.S()>s)var n=r;else n=i,i=r;if(i.da()>s&&i.S()>s){r=new e.l;var o=new e.l;return o.L(i),o.X(-s,-s),r.L(o),r.Fa(n),!(r.B()||r.da()<=s&&r.S()<=s)}r=new e.zb,o=new e.zb;var a=[0,0],l=[0,0],h=new e.h;return n.fn(h),r.Ec(h),n.gn(h),r.Rc(h),i.fn(h),o.Ec(h),i.gn(h),o.Rc(h),r.Fa(o,null,a,l,s),1==r.Fa(o,null,null,null,s)&&0<a[0]&&1>a[1]&&0<l[0]&&1>l[1]},t.wI=function(t,i,r){var s=new e.l,n=new e.l,o=new e.am(t,i,r,!0);if(!o.next())return!0;if(this.LG(t,i,r))return!1;var a=t,l=null;1736==i.K()&&(l=i);var h=!1,c=!1;do{var u=o.pl(),p=o.jl();if(p=i.Oa(i.Ca(p)),s.L(o.oz()),s.X(r,r),s.contains(p)&&0!=(p=e.jd.Zd(a,p,0))||1736==i.K()&&(u=t.Oa(t.Ca(u)),n.L(o.Wy()),n.X(r,r),n.contains(u)&&0!=(p=e.jd.Zd(l,u,0))))return!1;h||(!e.Fg.Ol(t,i.ea()-1)||null!=t.Cb&&null!=t.Cb.Gb?a=t:(a=new e.Ea,t.copyTo(a),a.gj(1)),h=!0),1736!=i.K()||c||(c=i,!e.Fg.Ol(c,t.ea()-1)||null!=i.Cb&&null!=i.Cb.Gb?l=i:(l=new e.Ea,c.copyTo(l),l.gj(1)),c=!0)}while(o.next());return!0},t.Ac=function(t,i,r){var s=new e.l;return s.L(t),s.X(r,r),s.contains(i)},t.ms=function(t,i,r){var s=new e.l;return s.L(i),s.X(r,r),i=new e.h,t.fn(i),!(s.contains(i)&&(t.SI(i),s.contains(i)&&(t.VI(i),s.contains(i)&&(t.gn(i),s.contains(i)))))},t.WH=function(t,i,r){if(t.ea()!=i.ea()||t.I()!=i.I())return!1;var s=new e.h,n=new e.h,o=!0;r*=r;for(var a=0;a<t.ea();a++){if(t.Wc(a)!=i.Wc(a)){o=!1;break}for(var l=t.Ca(a);l<i.Wc(a);l++)if(t.D(l,s),i.D(l,n),e.h.zc(s,n)>r){o=!1;break}if(!o)break}return!!o},t.$T=function(t,i,r){if(t.I()!=i.I())return!1;var s=new e.h,n=new e.h,o=!0;r*=r;for(var a=0;a<t.I();a++)if(t.D(a,s),i.D(a,n),e.h.zc(s,n)>r){o=!1;break}return!!o},t.SA=function(t,i,r,s,n,o){var a=!1;if(t.I()>i.I()){s&&(s=!1,a=!0);var l=i}else l=t,t=i;if(i=null,n||o||a){i=new e.rn(t.I());for(var h=0;h<t.I();h++)i.write(h,0)}h=new e.l;var c=new e.l,u=new e.l;l.A(h),t.A(c),h.X(r,r),c.X(r,r),u.L(h),u.Fa(c),c=new e.h;for(var p=new e.h,d=!0,f=e.ta.gE(t,u),y=f.getIterator(),g=r*r,m=0;m<l.I();m++)if(l.D(m,c),u.contains(c)){var v=!1;h.L(c.x,c.y,c.x,c.y),y.Yi(h,r);for(var b=y.next();-1!=b&&(b=f.ka(b),t.D(b,p),!(e.h.zc(c,p)<=g&&((n||o||a)&&i.write(b,1),v=!0,s)));b=y.next());if(!v&&(d=!1,n||s))return!1}else{if(n||s)return!1;d=!1}if(o&&d)return!1;if(s)return!0;for(h=0;h<t.I();h++)if(1==i.read(h)){if(o)return!0}else if(n||a)return!1;return!o},t.ZH=function(t,i,r){if(t.I()>i.I())var s=i;else s=t,t=i;i=new e.l;var n=new e.l,o=new e.l;s.A(i),t.A(n),i.X(r,r),n.X(r,r),o.L(i),o.Fa(n),n=new e.h;for(var a=new e.h,l=r*r,h=e.ta.gE(t,o),c=h.getIterator(),u=0;u<s.I();u++)if(s.D(u,n),o.contains(n)){i.L(n.x,n.y,n.x,n.y),c.Yi(i,r);for(var p=c.next();-1!=p;p=c.next())if(t.D(h.ka(p),a),e.h.zc(n,a)<=l)return!0}return!1},t.Rz=function(e,i,r,s){return t.Am(e,i,r,s)&&t.Am(i,e,r,s)},t.Am=function(r,s,n,o){function a(e,t){return d.IE(e,t)}var l,h=[0,0],c=[0,0],u=0,p=new e.ja(0),d=new t,f=new e.l,y=new e.l,g=new e.l;r.A(f),s.A(y),f.X(n,n),y.X(n,n),g.L(f),g.Fa(y),r=r.Ha(),y=s.Ha();var m=null,v=m=null,b=s.Cb;for(null!=b?(m=b.Gb,v=b.Ao,null==m&&(m=e.ta.kj(s,g))):m=e.ta.kj(s,g),s=m.getIterator(),b=null,null!=v&&(b=v.getIterator());r.ab();)for(;r.Ia();){var w=!1,_=r.ia();if(_.A(f),!f.isIntersecting(g))return!1;if(null!=b&&(b.Yi(f,n),-1==b.next()))return!1;for(v=_.Rb(),s.Vo(_,n),l=s.next();-1!=l;l=s.next()){y.Wb(m.ka(l)),l=y.ia();var x=_.Fa(l,null,h,c,n);if(2==x&&(!o||c[0]<=c[1])){var S=h[1],M=c[0],T=c[1];if((x=h[0])*v<=n&&(1-S)*v<=n){w=!0,u=0,p.resize(0),d.sh.length=0;var I=r.xb();for(M=!0;M;){if(r.Ia()){if(v=(_=r.ia()).Rb(),2==(x=_.Fa(l,null,h,c,n))&&(!o||c[0]<=c[1])&&(S=h[1],(x=h[0])*v<=n&&(1-S)*v<=n)){I=r.xb();continue}if(y.Ia()&&(l=y.ia(),2==(x=_.Fa(l,null,h,c,n))&&(!o||c[0]<=c[1])&&(S=h[1],(x=h[0])*v<=n&&(1-S)*v<=n))){I=r.xb();continue}}M=!1}I!=r.xb()&&(r.Wb(I),r.ia());break}I=r.xb(),l=i.construct(I,r.gb,x,S,y.xb(),y.gb,M,T),d.sh.push(l),p.add(p.size)}}if(!w){if(u==d.sh.length)return!1;for(1<p.size-u&&p.Wd(u,p.size,a),w=0;u<d.sh.length;u++)if(!((l=d.sh[p.get(u)]).Lj<w&&l.Ti<w)){if(v*(l.Lj-w)>n)return!1;if(v*(1-(w=l.Ti))<=n||1==w)break}if(v*(1-w)>n)return!1;u=0,p.resize(0),d.sh.length=0}}return!0},t.NG=function(i,r,s){if(1>t.Sz(i,r,s,null))return!1;var n=new e.l,o=new e.l;i.A(n),r.A(o);var a=t.ms(n,o,s);return n=t.ms(o,n,s),!((!a||!n)&&(a&&!n?t.Am(r,i,s,!1):n&&!a?t.Am(i,r,s,!1):t.Am(i,r,s,!1)||t.Am(r,i,s,!1)))},t.Sz=function(r,s,n,o){function a(e,t){return y.IE(e,t)}if(r.sz()>s.sz())var l=s,h=r;else l=r,h=s;r=l.Ha(),s=h.Ha();var c=[0,0],u=[0,0],p=-1,d=0,f=new e.ja(0),y=new t,g=new e.l,m=new e.l,v=new e.l;l.A(g),h.A(m),g.X(n,n),m.X(n,n),v.L(g),v.Fa(m),l=null,null!=o&&(l=new e.h);var b=m=m=null,w=h.Cb;for(null!=w?(m=w.Gb,b=w.Ao,null==m&&(m=e.ta.kj(h,v))):m=e.ta.kj(h,v),h=m.getIterator(),w=null,null!=b&&(w=b.getIterator());r.ab();)for(b=0;r.Ia();){var _=r.ia();if(_.A(g),g.isIntersecting(v)){if(null!=w&&(w.Yi(g,n),-1==w.next()))continue;var x=_.Rb();h.Vo(_,n);for(var S=h.next();-1!=S;S=h.next()){var M=m.ka(S);s.Wb(M);var T=s.ia(),I=T.Rb(),E=_.Fa(T,null,c,u,n);if(0<E){S=c[0],p=u[0];var A=2==E?c[1]:NaN,P=2==E?u[1]:NaN;if(2==E){if(x*(A-S)>n)return 1;var C=x*(A-S);if(s.Ia()){if(T=s.ia(),2==(E=_.Fa(T,null,c,null,n))){var O=c[1];if(C+(E=x*(O-(E=c[0])))>n)return 1}s.Wb(M),s.ia()}if(!s.xm()){if(s.mi(),T=s.mi(),2==(E=_.Fa(T,null,c,null,n))&&C+(E=x*((O=c[1])-(E=c[0])))>n)return 1;s.Wb(M),s.ia()}if(r.Ia()){if(M=r.xb(),2==(E=(_=r.ia()).Fa(T,null,c,null,n))&&C+(E=x*((O=c[1])-(E=c[0])))>n)return 1;r.Wb(M),r.ia()}if(!r.xm()){if(M=r.xb(),r.mi(),2==(E=(_=r.mi()).Fa(T,null,c,null,n))&&C+(E=I*((O=c[1])-(E=c[0])))>n)return 1;r.Wb(M),r.ia()}T=i.construct(r.xb(),r.gb,S,A,s.xb(),s.gb,p,P),y.sh.push(T),f.add(f.size)}p=0,null!=o&&(_.ic(S,l),o.add(l.x),o.add(l.y))}}if(d<y.sh.length){for(f.Wd(d,f.size,a),_=0,S=y.sh[f.get(d)].Om;d<y.sh.length;d++)if(!((T=y.sh[f.get(d)]).Lj<_&&T.Ti<_))if(x*(T.Lj-_)>n)b=x*(T.Ti-T.Lj),_=T.Ti,S=T.Om;else{if(T.Om!=S?(b=x*(T.Ti-T.Lj),S=T.Om):b+=x*(T.Ti-T.Lj),b>n)return 1;if(1==(_=T.Ti))break}x*(1-_)>n&&(b=0),d=0,f.resize(0),y.sh.length=0}}}return p},t.LG=function(t,i,r){var s=t.Ha(),n=i.Ha();for(t=new e.am(t,i,r,!1);t.next();){i=t.pl();var o=t.jl();if(s.Wb(i),n.Wb(o),i=s.ia(),0<n.ia().Fa(i,null,null,null,r))return!0}return!1},t.MG=function(t,i,r,s){var n=t.Ha(),o=new e.l,a=new e.l,l=new e.l;t.A(o),i.A(a),o.X(r,r),o.contains(a),a.X(r,r),l.L(o),l.Fa(a),null!=(o=t.Cb)?null==(o=o.Gb)&&(o=e.ta.kj(t,l)):o=e.ta.kj(t,l),t=o.getIterator();for(var h=new e.h,c=new e.h,u=r*r,p=0;p<i.I();p++)if(i.D(p,h),l.contains(h)){a.L(h.x,h.y,h.x,h.y),t.Yi(a,r);for(var d=!1,f=t.next();-1!=f;f=t.next())if(n.Wb(o.ka(f)),(f=n.ia()).ic(f.fe(h,!1),c),e.h.zc(c,h)<=u){d=!0;break}if(s){if(!d)return!1}else if(d)return!0}return!!s},t.Tz=function(t,i,r){var s=new e.h,n=r*r,o=t.Ha();if(null!=(t=t.Cb)&&null!=(t=t.Gb)){var a=new e.l;for(a.L(i),a=(r=t.EF(a,r)).next();-1!=a;a=r.next())if(o.Wb(t.ka(a)),o.Ia()){var l=(a=o.ia()).fe(i,!1);if(a.ic(l,s),e.h.zc(i,s)<=n)return!0}return!1}for(t=new e.l;o.ab();)for(;o.Ia();)if((a=o.ia()).A(t),t.X(r,r),t.contains(i)&&(l=a.fe(i,!1),a.ic(l,s),e.h.zc(i,s)<=n))return!0;return!1},t.JG=function(e,i,r){return t.Tz(e,i,r)&&!t.Uz(e,i,r)},t.Uz=function(e,i,r){return e=e.mg(),!t.kt(e,i,r)},t.KG=function(t,i,r){if(t.vm()){var s=new e.zb(i.v,i.G,i.v,i.H),n=new e.zb(i.v,i.H,i.C,i.H),o=new e.zb(i.C,i.H,i.C,i.G);for(i=new e.zb(i.C,i.G,i.v,i.G),t=t.Ha();t.ab();)for(;t.Ia();){var a=t.ia();if(a.isIntersecting(s,r)||a.isIntersecting(n,r)||a.isIntersecting(o,r)||a.isIntersecting(i,r))return!0}}else{(s=new e.l).L(i),s.X(r,r),r=t.vb(0),n=new e.h,o=new e.h,i=new e.h,a=new e.h;for(var l=0,h=t.ea();l<h;l++)for(var c=!0,u=t.Ca(l),p=t.Wc(l);u<p;u++)if(c)r.uc(2*u,o),c=!1;else{if(r.uc(2*u,n),i.N(o),a.N(n),0!=s.ty(i,a))return!0;o.N(n)}}return!1},t.qc=function(i,r,s){var n=i.K(),o=r.K();if(e.ba.yj(n)){var a=i.Cb;if(null!=a&&null!=(a=a.Fk))if(33==o){var l=r.D();if(1==(l=a.To(l.x,l.y)))return 1;if(0==l)return 4}else{if(l=new e.l,r.A(l),1==(l=a.So(l)))return 1;if(0==l)return 4;if(s&&e.ba.yj(o)&&t.zE(r,a))return 1073741824}}if(e.ba.yj(o)&&null!=(a=r.Cb)&&null!=(a=a.Fk))if(33==n){if(i=i.D(),1==(l=a.To(i.x,i.y)))return 2;if(0==l)return 4}else{if(r=new e.l,i.A(r),1==(l=a.So(r)))return 2;if(0==l)return 4;if(s&&e.ba.yj(n)&&t.zE(i,a))return 1073741824}return 0},t.zE=function(t,i){for(var r=t.I(),s=new e.h,n=0;n<r;n++)if(t.D(n,s),1==i.To(s.x,s.y))return!0;return!1},t.AI=function(t,i,r,s){for(var n=1<=t.qm(0)&&1<=i.qm(0),o=t.Ha(),a=i.Ha(),l=[0,0],h=[0,0],c=new e.am(t,i,r,!1),u=!1;c.next();){var p=c.pl(),d=c.jl();if(o.Wb(p),a.Wb(d),p=o.ia(),2==(d=a.ia().Fa(p,null,h,l,r))){if(u=l[0],d=l[1],p=p.Rb(),n&&(d-u)*p>r)return!1;u=!0}else if(0!=d){if(p=h[0],0<(u=l[0])&&1>u&&0<p&&1>p)return!1;u=!0}}return!!u&&(o=new e.l,a=new e.l,n=new e.l,t.A(o),i.A(a),o.X(1e3*r,1e3*r),a.X(1e3*r,1e3*r),n.L(o),n.Fa(a),!(10<t.I()&&(t=e.Vd.clip(t,n,r,0),t.B())||10<i.I()&&(i=e.Vd.clip(i,n,r,0),i.B()))&&e.cm.rt(t,i,r,"F********",s))},t.xI=function(i,r,s,n){var o=1<=i.qm(0)&&1<=r.qm(0),a=new e.l,l=new e.l,h=new e.l;i.A(a),r.A(l);for(var c=!1,u=t.ms(a,l,s),p=t.ms(l,a,s),d=i.Ha(),f=r.Ha(),y=[0,0],g=[0,0],m=new e.am(i,r,s,!1);m.next();){var v=m.pl(),b=m.jl();if(d.Wb(v),f.Wb(b),b=d.ia(),2==(v=f.ia().Fa(b,null,g,y,s))){v=y[0];var w=y[1];if(b=b.Rb(),o&&(w-v)*b>s&&(c=!0,u&&p))return!0}else if(0!=v&&(b=g[0],0<(v=y[0])&&1>v&&0<b&&1>b))return!0}if(o=new e.l,d=new e.l,o.L(a),o.X(1e3*s,1e3*s),d.L(l),d.X(1e3*s,1e3*s),h.L(o),h.Fa(d),a="",a=c?a+"**":a+"T*",u){if(10<r.I()&&(r=e.Vd.clip(r,h,s,0)).B())return!1;a+="****"}else a+="T***";if(p){if(10<i.I()&&(i=e.Vd.clip(i,h,s,0)).B())return!1;a+="***"}else a+="T**";return e.cm.rt(i,r,s,a.toString(),n)},t.tI=function(i,r,s,n){var o=[!1],a=t.rI(i,r,s,o);return o[0]?a:(o=new e.l,r.A(o),o.X(1e3*s,1e3*s),!(10<i.I()&&(i=e.Vd.clip(i,o,s,0),i.B()))&&e.cm.Tw(i,r,s,n))},t.rI=function(t,i,r,s){s[0]=!1;for(var n=t.Ha(),o=i.Ha(),a=[0,0],l=[0,0],h=new e.am(t,i,r,!1),c=!1;h.next();){var u=h.pl(),p=h.jl();if(n.Wb(u,-1),o.Wb(p,-1),u=n.ia(),0!=(u=o.ia().Fa(u,null,l,a,r))&&(c=!0,1==u&&(u=a[0],p=l[0],0<u&&1>u&&0<p&&1>p)))return s[0]=!0,!1}if(!c){for(s[0]=!0,a=new e.l,t.A(a),a.X(r,r),h=t,c=!1,l=new e.l,s=0,n=i.ea();s<n;s++)if(0<i.Ka(s)){if(i.Sj(s,l),!a.isIntersecting(l))return!1;if(o=i.Oa(i.Ca(s)),0==(o=e.Fg.ym(h,o,0)))return!1;c||(!e.Fg.Ol(t,i.ea()-1)||null!=t.Cb&&null!=t.Cb.Gb?h=t:(o=new e.Ea,t.copyTo(o),o.gj(1),h=o),c=!0)}if(1==t.ea()||1607==i.K())return!0;for(a=new e.l,i.A(a),a.X(r,r),l=i,h=!1,r=new e.l,s=0,n=t.ea();s<n;s++)if(0<t.Ka(s)){if(t.Sj(s,r),a.isIntersecting(r)&&(o=t.Oa(t.Ca(s)),1==(o=e.Fg.ym(l,o,0))))return!1;h||(!e.Fg.Ol(i,t.ea()-1)||null!=i.Cb&&null!=i.Cb.Gb?l=i:(o=new e.Ea,i.copyTo(o),o.gj(1),l=o),h=!0)}return!0}return!1},t.BI=function(t,i,r,s){for(var n=t.Ha(),o=i.Ha(),a=[0,0],l=[0,0],h=new e.am(t,i,r,!1),c=!1;h.next();){var u=h.pl(),p=h.jl();if(n.Wb(u),o.Wb(p),u=n.ia(),2==(u=o.ia().Fa(u,null,l,a,r)))c=!0;else if(0!=u){if(c=a[0],u=l[0],0<c&&1>c&&0<u&&1>u)return!1;c=!0}}return!!c&&(o=new e.l,a=new e.l,n=new e.l,t.A(o),i.A(a),o.X(1e3*r,1e3*r),a.X(1e3*r,1e3*r),n.L(o),n.Fa(a),!(10<t.I()&&(t=e.Vd.clip(t,n,r,0),t.B())||10<i.I()&&(i=e.Vd.clip(i,n,r,0),i.B()))&&e.cm.bn(t,i,r,"F********",s))},t.vI=function(i,r,s,n){for(var o=i.Ha(),a=r.Ha(),l=[0,0],h=[0,0],c=new e.am(i,r,s,!1),u=!1;c.next();){var p=c.pl(),d=c.jl();if(o.Wb(p),a.Wb(d),p=o.ia(),2==(p=a.ia().Fa(p,null,h,l,s)))u=!0;else if(0!=p){if(u=l[0],p=h[0],0<u&&1>u&&0<p&&1>p)return!0;u=!0}}return!!u&&(a=new e.l,l=new e.l,h=new e.l,c=new e.l,o=new e.l,i.A(a),r.A(l),t.ms(l,a,s)?(h.L(a),h.X(1e3*s,1e3*s),c.L(l),c.X(1e3*s,1e3*s),o.L(h),o.Fa(c),!(10<i.I()&&(i=e.Vd.clip(i,o,s,0),i.B())||10<r.I()&&(r=e.Vd.clip(r,o,s,0),r.B()))&&(s=e.cm.bn(i,r,s,"T********",n))):s=e.cm.bn(i,r,s,"T*****T**",n))},t.uI=function(i,r,s,n){var o=[!1],a=t.rI(i,r,s,o);return o[0]?a:(o=new e.l,r.A(o),o.X(1e3*s,1e3*s),!(10<i.I()&&(i=e.Vd.clip(i,o,s,0),i.B()))&&e.cm.$A(i,r,s,n))},t.sI=function(t,i,r){return 1==e.jd.Zd(t,i,r)},t.zI=function(t,i,r){return 2==e.jd.Zd(t,i,r)},t.kt=function(t,i,r){var s=new e.h;r*=r;for(var n=0;n<t.I();n++)if(t.D(n,s),e.h.zc(s,i)<=r)return!1;return!0},t.prototype.IE=function(e,t){return e=this.sh[e],t=this.sh[t],e.Om<t.Om||e.Om==t.Om&&(e.qw<t.qw||e.qw==t.qw&&(e.Lj<t.Lj||e.Lj==t.Lj&&(e.Ti<t.Ti||e.Ti==t.Ti&&e.tH<t.tH)))?-1:1},t}();e.vd=r}($||($={})),function(e){var t,i,r,s;(i=t||(t={}))[i.InteriorInterior=0]="InteriorInterior",i[i.InteriorBoundary=1]="InteriorBoundary",i[i.InteriorExterior=2]="InteriorExterior",i[i.BoundaryInterior=3]="BoundaryInterior",i[i.BoundaryBoundary=4]="BoundaryBoundary",i[i.BoundaryExterior=5]="BoundaryExterior",i[i.ExteriorInterior=6]="ExteriorInterior",i[i.ExteriorBoundary=7]="ExteriorBoundary",i[i.ExteriorExterior=8]="ExteriorExterior",(s=r||(r={}))[s.AreaAreaPredicates=0]="AreaAreaPredicates",s[s.AreaLinePredicates=1]="AreaLinePredicates",s[s.LineLinePredicates=2]="LineLinePredicates",s[s.AreaPointPredicates=3]="AreaPointPredicates",s[s.LinePointPredicates=4]="LinePointPredicates",s[s.PointPointPredicates=5]="PointPointPredicates",t=function(){function t(){this.le=0,this.j=new e.ju,this.J=[0,0,0,0,0,0,0,0,0],this.$a=[0,0,0,0,0,0,0,0,0],this.fa=[!1,!1,!1,!1,!1,!1,!1,!1,!1],this.Um=this.ww=-1}return t.sB=function(t,i,r,s,n){if(9!=s.length)throw e.i.ga("relation string length has to be 9 characters");for(var o=0;9>o;o++){var a=s.charAt(o);if("*"!=a&&"T"!=a&&"F"!=a&&"0"!=a&&"1"!=a&&"2"!=a)throw e.i.ga("relation string")}if(0!=(o=this.DR(s,t.Eb(),i.Eb())))return e.vd.tB(t,i,r,o,n);o=new e.l,t.A(o),a=new e.l,i.A(a);var l=new e.l;if(l.L(o),l.$b(a),r=e.ta.Xd(r,l,!1),t=this.OE(t,r),i=this.OE(i,r),t.B()||i.B())return this.kW(t,i,s);switch(o=i.K(),a=!1,t.K()){case 1736:switch(o){case 1736:a=this.rt(t,i,r,s,n);break;case 1607:a=this.bn(t,i,r,s,n);break;case 33:a=this.qt(t,i,r,s);break;case 550:a=this.pt(t,i,r,s,n)}break;case 1607:switch(o){case 1736:a=this.bn(i,t,r,this.aq(s),n);break;case 1607:a=this.aB(t,i,r,s,n);break;case 33:a=this.tt(t,i,r,s,n);break;case 550:a=this.st(t,i,r,s,n)}break;case 33:switch(o){case 1736:a=this.qt(i,t,r,this.aq(s));break;case 1607:a=this.tt(i,t,r,this.aq(s),n);break;case 33:a=this.QU(t,i,r,s);break;case 550:a=this.lt(i,t,r,this.aq(s))}break;case 550:switch(o){case 1736:a=this.pt(i,t,r,this.aq(s),n);break;case 1607:a=this.st(i,t,r,this.aq(s),n);break;case 550:a=this.TA(t,i,r,s,n);break;case 33:a=this.lt(t,i,r,s)}break;default:a=!1}return a},t.rt=function(i,r,s,n,o){var a=new t;a.Zi(),a.cj(n),a.pJ();var l=new e.l,h=new e.l;return i.A(l),r.A(h),n=!1,e.vd.dk(l,h,s)&&(a.Du(i,r),n=!0),n||(4==(l=e.vd.qc(i,r,!1))?(a.Du(i,r),n=!0):1==l?(a.gy(r),n=!0):2==l&&(a.RD(i),n=!0)),n||(i=(n=new e.hd).Ib(i),r=n.Ib(r),a.Xo(n,s,o),a.Dp(i,r),a.j.Vg()),t.fg(a.J,a.Yc)},t.Tw=function(i,r,s,n){var o=new t;o.Zi(),o.cj("T*****F**"),o.pJ();var a=new e.l,l=new e.l;i.A(a),r.A(l);var h=!1;return e.vd.dk(a,l,s)&&(o.Du(i,r),h=!0),h||(4==(a=e.vd.qc(i,r,!1))?(o.Du(i,r),h=!0):1==a?(o.gy(r),h=!0):2==a&&(o.RD(i),h=!0)),h?this.fg(o.J,o.Yc):(i=(h=new e.hd).Ib(i),a=h.Ib(r),e.Tk.W(h,s,n,!1),s=h.Ke(a).mg(),h.Ip(0,!0,!0),e.tn.W(h,i,-1,!1,n),0!=h.I(i)&&(e.tn.W(h,a,-1,!1,n),o.gr(h,n),(r=0==h.I(a))||(o.Dp(i,a),o.j.Vg(),a=this.fg(o.J,o.Yc))?(i=h.Ke(i),i=(h=new e.hd).Ib(i),a=h.Ib(s),o.gr(h,n),o.le=0,o.Zi(),o.cj(r?"T*****F**":"******F**"),o.CB(),o.Dp(i,a),o.j.Vg(),this.fg(o.J,o.Yc)):a))},t.bn=function(i,r,s,n,o){var a=new t;a.Zi(),a.cj(n),a.CB();var l=new e.l,h=new e.l;return i.A(l),r.A(h),n=!1,e.vd.dk(l,h,s)&&(a.Eu(i,r),n=!0),n||(4==(l=e.vd.qc(i,r,!1))?(a.Eu(i,r),n=!0):1==l&&(a.SD(r),n=!0)),n||(i=(n=new e.hd).Ib(i),r=n.Ib(r),a.Xo(n,s,o),a.lh=a.j.Fp(),t.Kw(r,a.j,a.lh),a.Dp(i,r),a.j.Gp(a.lh),a.j.Vg()),t.fg(a.J,a.Yc)},t.$A=function(i,r,s,n){var o=new t;o.Zi(),o.cj("T*****F**"),o.CB();var a=new e.l,l=new e.l;i.A(a),r.A(l);var h=!1;return e.vd.dk(a,l,s)&&(o.Eu(i,r),h=!0),h||(4==(a=e.vd.qc(i,r,!1))?(o.Eu(i,r),h=!0):1==a&&(o.SD(r),h=!0)),h?this.fg(o.J,o.Yc):(i=(h=new e.hd).Ib(i),r=h.Ib(r),o.Xo(h,s,n),0!=h.I(i)&&(o.Dp(i,r),o.j.Vg(),this.fg(o.J,o.Yc)))},t.pt=function(i,r,s,n,o){var a=new t;a.Zi(),a.cj(n),a.qJ();var l=new e.l,h=new e.l;return i.A(l),r.A(h),n=!1,e.vd.dk(l,h,s)&&(a.Fu(i),n=!0),n||(4==(l=e.vd.qc(i,r,!1))?(a.Fu(i),n=!0):1==l&&(a.rN(),n=!0)),n||(i=(n=new e.hd).Ib(i),r=n.Ib(r),a.Xo(n,s,o),a.Ay(i,r),a.j.Vg()),t.fg(a.J,a.Yc)},t.aB=function(i,r,s,n,o){var a=new t;a.Zi(),a.cj(n),a.SW(),n=new e.l;var l=new e.l;i.A(n),r.A(l);var h=!1;return e.vd.dk(n,l,s)&&(a.HG(i,r),h=!0),h||4!=e.vd.qc(i,r,!1)||(a.HG(i,r),h=!0),h||(i=(n=new e.hd).Ib(i),r=n.Ib(r),a.Xo(n,s,o),a.Zh=a.j.Fp(),a.lh=a.j.Fp(),t.Kw(i,a.j,a.Zh),t.Kw(r,a.j,a.lh),a.Dp(i,r),a.j.Gp(a.Zh),a.j.Gp(a.lh),a.j.Vg()),t.fg(a.J,a.Yc)},t.st=function(i,r,s,n,o){var a=new t;a.Zi(),a.cj(n),a.EJ(),n=new e.l;var l=new e.l;i.A(n),r.A(l);var h=!1;return e.vd.dk(n,l,s)&&(a.Qz(i),h=!0),h||4!=e.vd.qc(i,r,!1)||(a.Qz(i),h=!0),h||(i=(n=new e.hd).Ib(i),r=n.Ib(r),a.Xo(n,s,o),a.Zh=a.j.Fp(),t.Kw(i,a.j,a.Zh),a.Ay(i,r),a.j.Gp(a.Zh),a.j.Vg()),t.fg(a.J,a.Yc)},t.TA=function(i,r,s,n,o){var a=new t;a.Zi(),a.cj(n),a.JJ(),n=new e.l;var l=new e.l;i.A(n),r.A(l);var h=!1;return e.vd.dk(n,l,s)&&(a.qI(),h=!0),h||(i=(n=new e.hd).Ib(i),r=n.Ib(r),a.Xo(n,s,o),a.Ay(i,r),a.j.Vg()),t.fg(a.J,a.Yc)},t.qt=function(i,r,s,n){var o=new t;o.Zi(),o.cj(n),o.qJ();var a=new e.l;i.A(a),r=r.D();var l=!1;return e.vd.Sw(r,a,s)&&(o.Fu(i),l=!0),l||(1==(s=e.jd.Zd(i,r,s))?(o.J[0]=0,o.J[2]=2,o.J[3]=-1,o.J[5]=1,o.J[6]=-1):2==s?(o.J[6]=-1,0!=i.He()?(o.J[0]=-1,o.J[3]=0,o.J[2]=2,o.J[5]=1):(o.J[0]=0,o.J[3]=-1,o.J[5]=-1,s=new e.l,i.A(s),o.J[2]=0==s.da()&&0==s.S()?-1:1)):o.Fu(i)),this.fg(o.J,n)},t.tt=function(i,r,s,n,o){var a=new t;a.Zi(),a.cj(n),a.EJ();var l=new e.l;i.A(l),n=r.D();var h=!1;if(e.vd.Sw(n,l,s)&&(a.Qz(i),h=!0),!h){l=null;var c=h=!1;(a.fa[0]||a.fa[6])&&(e.vd.Tz(i,n,s)?(a.fa[0]&&(l=e.ri.im(i,o),c=!e.vd.kt(l,n,s),h=!0,a.J[0]=c?-1:0),a.J[6]=-1):(a.J[0]=-1,a.J[6]=0)),a.fa[3]&&(null!=l&&l.B()?a.J[3]=-1:(h||(null==l&&(l=e.ri.im(i,o)),c=!e.vd.kt(l,n,s),h=!0),a.J[3]=c?0:-1)),a.fa[5]&&(null!=l&&l.B()?a.J[5]=-1:h&&!c?a.J[5]=0:(null==l&&(l=e.ri.im(i,o)),o=e.vd.Ow(l,r,s),a.J[5]=o?-1:0)),a.fa[2]&&(0!=i.Rb()?a.J[2]=1:((o=new e.de(i.description)).Gd(i,0,i.I()),i=e.vd.Ow(o,r,s),a.J[2]=i?-1:0))}return this.fg(a.J,a.Yc)},t.lt=function(i,r,s,n){var o=new t;o.Zi(),o.cj(n),o.JJ();var a=new e.l;i.A(a),r=r.D();var l=!1;if(e.vd.Sw(r,a,s)&&(o.qI(),l=!0),!l){a=!1,l=!0,s*=s;for(var h=0;h<i.I();h++){var c=i.Oa(h);if(e.h.zc(c,r)<=s?a=!0:l=!1,a&&!l)break}a?(o.J[0]=0,o.J[2]=l?-1:0,o.J[6]=-1):(o.J[0]=-1,o.J[2]=0,o.J[6]=0)}return t.fg(o.J,n)},t.QU=function(i,r,s,n){i=i.D(),r=r.D();for(var o=[],a=0;9>a;a++)o[a]=-1;return e.h.zc(i,r)<=s*s?o[0]=0:(o[2]=0,o[6]=0),o[8]=2,t.fg(o,n)},t.fg=function(e,t){for(var i=0;9>i;i++)switch(t.charAt(i)){case"T":if(-1==e[i])return!1;break;case"F":if(-1!=e[i])return!1;break;case"0":if(0!=e[i])return!1;break;case"1":if(1!=e[i])return!1;break;case"2":if(2!=e[i])return!1}return!0},t.kW=function(t,i,r){var s=[-1,-1,-1,-1,-1,-1,-1,-1,-1];if(t.B()&&i.B()){for(var n=0;9>n;n++)s[n]=-1;return this.fg(s,r)}return n=!1,t.B()&&(t=i,n=!0),s[0]=-1,s[1]=-1,s[3]=-1,s[4]=-1,s[6]=-1,s[7]=-1,s[8]=2,i=t.K(),e.ba.Ic(i)?1736==i?0!=t.He()?(s[2]=2,s[5]=1):(s[5]=-1,i=new e.l,t.A(i),s[2]=0==i.da()&&0==i.S()?0:1):(i=0!=t.Rb(),s[2]=i?1:0,s[5]=e.ri.cq(t)?0:-1):(s[2]=0,s[5]=-1),n&&this.nK(s),this.fg(s,r)},t.DR=function(e,i,r){return t.WP(e)?3:t.MP(e)?4:t.RX(e,i,r)?8:t.uP(e,i,r)?16:t.XO(e)?1:t.uU(e,i,r)?32:0},t.WP=function(e){return"T"==e.charAt(0)&&"*"==e.charAt(1)&&"F"==e.charAt(2)&&"*"==e.charAt(3)&&"*"==e.charAt(4)&&"F"==e.charAt(5)&&"F"==e.charAt(6)&&"F"==e.charAt(7)&&"*"==e.charAt(8)},t.MP=function(e){return"F"==e.charAt(0)&&"F"==e.charAt(1)&&"*"==e.charAt(2)&&"F"==e.charAt(3)&&"F"==e.charAt(4)&&"*"==e.charAt(5)&&"*"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8)},t.RX=function(e,t,i){return(0!=t||0!=i)&&((2!=t||2!=i)&&("F"==e.charAt(0)&&"*"==e.charAt(1)&&"*"==e.charAt(2)&&"T"==e.charAt(3)&&"*"==e.charAt(4)&&"*"==e.charAt(5)&&"*"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8)||1==t&&1==i&&"F"==e.charAt(0)&&"T"==e.charAt(1)&&"*"==e.charAt(2)&&"*"==e.charAt(3)&&"*"==e.charAt(4)&&"*"==e.charAt(5)&&"*"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8))||0!=i&&"F"==e.charAt(0)&&"*"==e.charAt(1)&&"*"==e.charAt(2)&&"*"==e.charAt(3)&&"T"==e.charAt(4)&&"*"==e.charAt(5)&&"*"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8))},t.uP=function(e,t,i){return t>i?"T"==e.charAt(0)&&"*"==e.charAt(1)&&"*"==e.charAt(2)&&"*"==e.charAt(3)&&"*"==e.charAt(4)&&"*"==e.charAt(5)&&"T"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8):1==t&&1==i&&"0"==e.charAt(0)&&"*"==e.charAt(1)&&"*"==e.charAt(2)&&"*"==e.charAt(3)&&"*"==e.charAt(4)&&"*"==e.charAt(5)&&"*"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8)},t.XO=function(e){return"T"==e.charAt(0)&&"*"==e.charAt(1)&&"*"==e.charAt(2)&&"*"==e.charAt(3)&&"*"==e.charAt(4)&&"*"==e.charAt(5)&&"F"==e.charAt(6)&&"F"==e.charAt(7)&&"*"==e.charAt(8)},t.uU=function(e,t,i){if(t==i){if(1!=t)return"T"==e.charAt(0)&&"*"==e.charAt(1)&&"T"==e.charAt(2)&&"*"==e.charAt(3)&&"*"==e.charAt(4)&&"*"==e.charAt(5)&&"T"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8);if("1"==e.charAt(0)&&"*"==e.charAt(1)&&"T"==e.charAt(2)&&"*"==e.charAt(3)&&"*"==e.charAt(4)&&"*"==e.charAt(5)&&"T"==e.charAt(6)&&"*"==e.charAt(7)&&"*"==e.charAt(8))return!0}return!1},t.Kw=function(e,t,i){e=t.Ma(e);for(var r=t.Oe;-1!=r;r=t.Sf(r))if(0!=(t.yd(r)&e)){var s=t.Je(r);if(-1==s)t.pn(r,i,0);else{var n=s,o=0;do{0!=(t.eh(n)&e)&&o++,n=t.kc(t.ya(n))}while(n!=s);t.pn(r,i,o)}}},t.aq=function(e){var t=""+e.charAt(0);return t+=e.charAt(3),t+=e.charAt(6),t+=e.charAt(1),t+=e.charAt(4),t+=e.charAt(7),t+=e.charAt(2),(t+=e.charAt(5))+e.charAt(8)},t.prototype.Zi=function(){for(var e=0;9>e;e++)this.J[e]=-2,this.$a[e]=-2},t.nK=function(e){var t=e[1],i=e[2],r=e[5];e[1]=e[3],e[2]=e[6],e[5]=e[7],e[3]=t,e[6]=i,e[7]=r},t.prototype.cj=function(e){for(this.Yc=e,e=0;9>e;e++)"*"!=this.Yc.charAt(e)?(this.fa[e]=!0,this.le++):this.fa[e]=!1},t.prototype.MJ=function(){for(var e=0;9>e;e++)this.fa[e]&&-2==this.J[e]&&(this.J[e]=-1,this.fa[e]=!1)},t.prototype.pc=function(e){return!(-2==this.J[e]||(-1==this.J[e]?(this.fa[e]=!1,this.le--,0):"T"!=this.Yc.charAt(e)&&"F"!=this.Yc.charAt(e)&&this.J[e]<this.$a[e]||(this.fa[e]=!1,this.le--,0)))},t.prototype.pJ=function(){this.ww=0,this.$a[0]=2,this.$a[1]=1,this.$a[2]=2,this.$a[3]=1,this.$a[4]=1,this.$a[5]=1,this.$a[6]=2,this.$a[7]=1,this.$a[8]=2,this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},t.prototype.CB=function(){this.ww=1,this.Um=3,this.$a[0]=1,this.$a[1]=0,this.$a[2]=2,this.$a[3]=1,this.$a[4]=0,this.$a[5]=1,this.$a[6]=1,this.$a[7]=0,this.$a[8]=2,this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},t.prototype.SW=function(){this.ww=2,this.Um=4,this.$a[0]=1,this.$a[1]=0,this.$a[2]=1,this.$a[3]=0,this.$a[4]=0,this.$a[5]=0,this.$a[6]=1,this.$a[7]=0,this.$a[8]=2,this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},t.prototype.qJ=function(){this.Um=3,this.$a[0]=0,this.$a[1]=-1,this.$a[2]=2,this.$a[3]=0,this.$a[4]=-1,this.$a[5]=1,this.$a[6]=0,this.$a[7]=-1,this.$a[8]=2,this.fa[1]&&(this.J[1]=-1,this.fa[1]=!1,this.le--),this.fa[4]&&(this.J[4]=-1,this.fa[4]=!1,this.le--),this.fa[7]&&(this.J[7]=-1,this.fa[7]=!1,this.le--),this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},t.prototype.EJ=function(){this.Um=4,this.$a[0]=0,this.$a[1]=-1,this.$a[2]=1,this.$a[3]=0,this.$a[4]=-1,this.$a[5]=0,this.$a[6]=0,this.$a[7]=-1,this.$a[8]=2,this.fa[1]&&(this.J[1]=-1,this.fa[1]=!1,this.le--),this.fa[4]&&(this.J[4]=-1,this.fa[4]=!1,this.le--),this.fa[7]&&(this.J[7]=-1,this.fa[7]=!1,this.le--),this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},t.prototype.JJ=function(){this.Um=5,this.$a[0]=0,this.$a[1]=-1,this.$a[2]=0,this.$a[3]=-1,this.$a[4]=-1,this.$a[5]=-1,this.$a[6]=0,this.$a[7]=-1,this.$a[8]=2,this.fa[1]&&(this.J[1]=-1,this.fa[1]=!1,this.le--),this.fa[3]&&(this.J[3]=-1,this.fa[3]=!1,this.le--),this.fa[4]&&(this.J[4]=-1,this.fa[4]=!1,this.le--),this.fa[5]&&(this.J[5]=-1,this.fa[5]=!1,this.le--),this.fa[7]&&(this.J[7]=-1,this.fa[7]=!1,this.le--),this.fa[8]&&(this.J[8]=2,this.fa[8]=!1,this.le--)},t.prototype.pN=function(e,t,i){var r=!0;return this.fa[0]&&(this.tS(e,t,i),r=r&&this.pc(0)),this.fa[1]&&(this.kG(e,t,1),r=r&&this.pc(1)),this.fa[2]&&(this.lG(e,t,i,2),r=r&&this.pc(2)),this.fa[3]&&(this.kG(e,i,3),r=r&&this.pc(3)),this.fa[4]&&(this.tN(e,t,i),r=r&&this.pc(4)),this.fa[5]&&(this.XD(e,i,5),r=r&&this.pc(5)),this.fa[6]&&(this.lG(e,i,t,6),r=r&&this.pc(6)),this.fa[7]&&(this.XD(e,t,7),r=r&&this.pc(7)),r},t.prototype.Du=function(e,t){this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.Hr(e,this.fa[2]?2:-1,this.Yc.charAt(2),this.fa[5]?5:-1,this.Yc.charAt(5)),this.Hr(t,this.fa[6]?6:-1,this.Yc.charAt(6),this.fa[7]?7:-1,this.Yc.charAt(7))},t.prototype.Hr=function(t,i,r,s,n){-1==i&&-1==s||(("T"!=r&&"F"!=r&&-1!=i||"T"!=n&&"F"!=n&&-1!=s)&&0==t.He()?(-1!=s&&(this.J[s]=-1),-1!=i&&(r=new e.l,t.A(r),this.J[i]=0==r.da()&&0==r.S()?0:1)):(-1!=i&&(this.J[i]=2),-1!=s&&(this.J[s]=1)))},t.prototype.gy=function(e){this.J[2]=2,this.J[3]=-1,this.J[4]=-1,this.J[5]=1,this.J[6]=-1,this.J[7]=-1,this.Hr(e,this.fa[0]?0:-1,this.Yc.charAt(0),this.fa[1]?1:-1,this.Yc.charAt(1))},t.prototype.RD=function(e){this.gy(e),t.nK(this.J)},t.prototype.Eu=function(t,i){if(this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.fa[6]){var r=this.Yc.charAt(6);r="T"==r||"F"==r||0!=i.Rb(),this.J[6]=r?1:0}this.fa[7]&&(i=e.ri.cq(i),this.J[7]=i?0:-1),this.Hr(t,this.fa[2]?2:-1,this.Yc.charAt(2),this.fa[5]?5:-1,this.Yc.charAt(5))},t.prototype.SD=function(t){if(this.fa[0]){var i=this.Yc.charAt(0);i="T"==i||"F"==i||0!=t.Rb(),this.J[0]=i?1:0}this.fa[1]&&(t=e.ri.cq(t),this.J[1]=t?0:-1),this.J[2]=2,this.J[3]=-1,this.J[4]=-1,this.J[5]=1,this.J[6]=-1,this.J[7]=-1},t.prototype.Fu=function(e){this.J[0]=-1,this.J[3]=-1,this.J[6]=0,this.Hr(e,this.fa[2]?2:-1,this.Yc.charAt(2),this.fa[5]?5:-1,this.Yc.charAt(5))},t.prototype.rN=function(){this.J[0]=0,this.J[2]=2,this.J[3]=-1,this.J[5]=1,this.J[6]=-1},t.prototype.HG=function(t,i){if(this.J[0]=-1,this.J[1]=-1,this.J[3]=-1,this.J[4]=-1,this.fa[2]){var r=this.Yc.charAt(2);r="T"==r||"F"==r||0!=t.Rb(),this.J[2]=r?1:0}this.fa[5]&&(t=e.ri.cq(t),this.J[5]=t?0:-1),this.fa[6]&&(r="T"==(r=this.Yc.charAt(6))||"F"==r||0!=i.Rb(),this.J[6]=r?1:0),this.fa[7]&&(i=e.ri.cq(i),this.J[7]=i?0:-1)},t.prototype.Qz=function(t){if(this.J[0]=-1,this.J[3]=-1,this.fa[2]){var i=this.Yc.charAt(2);i="T"==i||"F"==i||0!=t.Rb(),this.J[2]=i?1:0}this.fa[5]&&(t=e.ri.cq(t),this.J[5]=t?0:-1),this.J[6]=0},t.prototype.qI=function(){this.J[0]=-1,this.J[2]=0,this.J[6]=0},t.prototype.qN=function(e,t,i){var r=!0;return this.fa[0]&&(this.uS(e,t),r=r&&this.pc(0)),this.fa[1]&&(this.qS(e,t,i,this.lh),r=r&&this.pc(1)),this.fa[2]&&(this.rS(e,t),r=r&&this.pc(2)),this.fa[3]&&(this.xN(e,t,i,this.lh),r=r&&this.pc(3)),this.fa[4]&&(this.uN(e,t,i,this.lh),r=r&&this.pc(4)),this.fa[5]&&(this.vN(e,t,i),r=r&&this.pc(5)),this.fa[6]&&(this.dQ(e,t),r=r&&this.pc(6)),this.fa[7]&&(this.cQ(e,t,i,this.lh),r=r&&this.pc(7)),r},t.prototype.cT=function(e,t,i){var r=!0;return this.fa[0]&&(this.xS(e,t,i,this.Zh,this.lh),r=r&&this.pc(0)),this.fa[1]&&(this.mG(e,t,i,this.Zh,this.lh,1),r=r&&this.pc(1)),this.fa[2]&&(this.nG(e,t,i,2),r=r&&this.pc(2)),this.fa[3]&&(this.mG(e,i,t,this.lh,this.Zh,3),r=r&&this.pc(3)),this.fa[4]&&(this.zN(e,t,i,this.Zh,this.lh),r=r&&this.pc(4)),this.fa[5]&&(this.YD(e,i,this.Zh,5),r=r&&this.pc(5)),this.fa[6]&&(this.nG(e,i,t,6),r=r&&this.pc(6)),this.fa[7]&&(this.YD(e,t,this.lh,7),r=r&&this.pc(7)),r},t.prototype.TD=function(e,t,i){var r=!0;return this.fa[0]&&(this.vS(e,t),r=r&&this.pc(0)),this.fa[2]&&(this.sS(e,t),r=r&&this.pc(2)),this.fa[3]&&(this.yN(e,t,i),r=r&&this.pc(3)),this.fa[5]&&(this.wN(e,t),r=r&&this.pc(5)),this.fa[6]&&(this.eQ(e,t),r=r&&this.pc(6)),r},t.prototype.IG=function(e,t,i){var r=!0;return this.fa[0]&&(this.yS(e,t,i,this.Zh),r=r&&this.pc(0)),this.fa[2]&&(this.wS(e,i),r=r&&this.pc(2)),this.fa[3]&&(this.BN(e,t,i,this.Zh),r=r&&this.pc(3)),this.fa[5]&&(this.AN(e,t,i,this.Zh),r=r&&this.pc(5)),this.fa[6]&&(this.fQ(e,t,i),r=r&&this.pc(6)),r},t.prototype.PU=function(e,t,i){var r=!0;return this.fa[0]&&(this.zS(e,t,i),r=r&&this.pc(0)),this.fa[2]&&(this.oG(e,t,i,2),r=r&&this.pc(2)),this.fa[6]&&(this.oG(e,i,t,6),r=r&&this.pc(6)),r},t.prototype.tS=function(e,t,i){2!=this.J[0]&&0!=((e=this.j.af(e))&t)&&0!=(e&i)&&(this.J[0]=2)},t.prototype.kG=function(e,t,i){if(1!=this.J[i]){var r=this.j.af(this.j.ya(e));0!=(this.j.af(e)&t)&&0!=(r&t)&&(this.J[i]=1)}},t.prototype.lG=function(e,t,i,r){2!=this.J[r]&&0!=((e=this.j.af(e))&t)&&0==(e&i)&&(this.J[r]=2)},t.prototype.tN=function(e,t,i){if(1!=this.J[4]){var r=this.j.eh(e);0!=(r&t)&&0!=(r&i)?this.J[4]=1:0!=this.J[4]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)&&0!=((e=this.j.yd(this.j.vf(e)))&t)&&0!=(e&i)&&(this.J[4]=0)}},t.prototype.XD=function(e,t,i){if(1!=this.J[i]){var r=this.j.af(this.j.ya(e));0==(this.j.af(e)&t)&&0==(r&t)&&(this.J[i]=1)}},t.prototype.uS=function(e,t){if(1!=this.J[0]){var i=this.j.af(this.j.ya(e));0!=(this.j.af(e)&t)&&0!=(i&t)&&(this.J[0]=1)}},t.prototype.qS=function(e,t,i,r){if(0!=this.J[1]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)){var s=this.j.vf(e),n=this.j.yd(s);0==(n&t)&&0!=(this.j.af(e)&t)&&(e=this.j.ng(s,r),0!=(n&i)&&e%2!=0&&(this.J[1]=0))}},t.prototype.rS=function(e,t){2!=this.J[2]&&0!=(this.j.eh(e)&t)&&(this.J[2]=2)},t.prototype.xN=function(e,t,i,r){if(1!=this.J[3]){var s=this.j.eh(e);0!=(s&t)&&0!=(s&i)?this.J[3]=1:0!=this.J[3]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)&&(s=this.j.vf(e),0!=((e=this.j.yd(s))&t)&&(t=this.j.ng(s,r),0!=(e&i)&&t%2==0&&(this.J[3]=0)))}},t.prototype.uN=function(e,t,i,r){if(0!=this.J[4]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)){var s=this.j.vf(e);0!=((e=this.j.yd(s))&t)&&(t=this.j.ng(s,r),0!=(e&i)&&t%2!=0&&(this.J[4]=0))}},t.prototype.vN=function(e,t,i){1!=this.J[5]&&0!=((e=this.j.eh(e))&t)&&0==(e&i)&&(this.J[5]=1)},t.prototype.dQ=function(e,t){if(1!=this.J[6]){var i=this.j.af(this.j.ya(e));0==(this.j.af(e)&t)&&0==(i&t)&&(this.J[6]=1)}},t.prototype.cQ=function(e,t,i,r){if(0!=this.J[7]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)){var s=this.j.vf(e),n=this.j.yd(s);0==(n&t)&&0==(this.j.af(e)&t)&&(e=this.j.ng(s,r),0!=(n&i)&&e%2!=0&&(this.J[7]=0))}},t.prototype.xS=function(e,t,i,r,s){if(1!=this.J[0]){var n=this.j.eh(e);0!=(n&t)&&0!=(n&i)?this.J[0]=1:0!=this.J[0]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)&&(e=this.j.vf(e),0!=((n=this.j.yd(e))&t)&&0!=(n&i)&&(t=this.j.ng(e,r),s=this.j.ng(e,s),t%2==0&&s%2==0&&(this.J[0]=0)))}},t.prototype.mG=function(e,t,i,r,s,n){if(0!=this.J[n]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)){e=this.j.vf(e);var o=this.j.yd(e);0!=(o&t)&&0!=(o&i)&&(t=this.j.ng(e,r),s=this.j.ng(e,s),t%2==0&&s%2!=0&&(this.J[n]=0))}},t.prototype.nG=function(e,t,i,r){1!=this.J[r]&&0!=((e=this.j.eh(e))&t)&&0==(e&i)&&(this.J[r]=1)},t.prototype.zN=function(e,t,i,r,s){if(0!=this.J[4]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)){e=this.j.vf(e);var n=this.j.yd(e);0!=(n&t)&&0!=(n&i)&&(t=this.j.ng(e,r),s=this.j.ng(e,s),t%2!=0&&s%2!=0&&(this.J[4]=0))}},t.prototype.YD=function(e,t,i,r){0!=this.J[r]&&1!=this.j.Bb(this.j.ue(this.j.ya(e)),this.Vi)&&(e=this.j.vf(e),0==(this.j.yd(e)&t)&&this.j.ng(e,i)%2!=0&&(this.J[r]=0))},t.prototype.vS=function(e,t){0!=this.J[0]&&0==(this.j.yd(e)&t)&&0!=(this.j.hk(this.j.Yy(e))&t)&&(this.J[0]=0)},t.prototype.sS=function(e,t){2!=this.J[2]&&0!=(this.j.yd(e)&t)&&(this.J[2]=2)},t.prototype.yN=function(e,t,i){0!=this.J[3]&&0!=((e=this.j.yd(e))&t)&&0!=(e&i)&&(this.J[3]=0)},t.prototype.wN=function(e,t){1!=this.J[5]&&0!=(this.j.yd(e)&t)&&(this.J[5]=1)},t.prototype.eQ=function(e,t){0!=this.J[6]&&0==(this.j.yd(e)&t)&&0==(this.j.hk(this.j.Yy(e))&t)&&(this.J[6]=0)},t.prototype.yS=function(e,t,i,r){if(0!=this.J[0]){var s=this.j.yd(e);0!=(s&t)&&0!=(s&i)&&this.j.ng(e,r)%2==0&&(this.J[0]=0)}},t.prototype.wS=function(e,t){1!=this.J[2]&&(-1!=this.j.Je(e)?this.J[2]=1:0!=this.J[2]&&0==(this.j.yd(e)&t)&&(this.J[2]=0))},t.prototype.BN=function(e,t,i,r){if(0!=this.J[3]){var s=this.j.yd(e);0!=(s&t)&&0!=(s&i)&&this.j.ng(e,r)%2!=0&&(this.J[3]=0)}},t.prototype.AN=function(e,t,i,r){if(0!=this.J[5]){var s=this.j.yd(e);0!=(s&t)&&0==(s&i)&&this.j.ng(e,r)%2!=0&&(this.J[5]=0)}},t.prototype.fQ=function(e,t,i){0!=this.J[6]&&0==((e=this.j.yd(e))&t)&&0!=(e&i)&&(this.J[6]=0)},t.prototype.zS=function(e,t,i){0!=this.J[0]&&0!=((e=this.j.yd(e))&t)&&0!=(e&i)&&(this.J[0]=0)},t.prototype.oG=function(e,t,i,r){0!=this.J[r]&&0!=((e=this.j.yd(e))&t)&&0==(e&i)&&(this.J[r]=0)},t.prototype.Dp=function(t,i){var r=!1;t=this.j.Ma(t),i=this.j.Ma(i),this.Vi=this.j.ah();for(var s=this.j.Oe;-1!=s;s=this.j.Sf(s)){var n=this.j.Je(s);if(-1==n){if(-1!=this.Um)switch(this.Um){case 3:r=this.TD(s,t,i);break;case 4:r=this.IG(s,t,i);break;default:throw e.i.ga("internal error")}}else{var o=n;do{var a=o;if(1!=this.j.Bb(a,this.Vi))do{switch(this.ww){case 0:r=this.pN(a,t,i);break;case 1:r=this.qN(a,t,i);break;case 2:r=this.cT(a,t,i);break;default:throw e.i.ga("internal error")}if(r)break;this.j.Kb(a,this.Vi,1),a=this.j.kc(a)}while(a!=o&&!r);if(r)break;o=this.j.kc(this.j.ya(a))}while(o!=n);if(r)break}}r||this.MJ(),this.j.Lg(this.Vi)},t.prototype.Ay=function(t,i){var r=!1;t=this.j.Ma(t),i=this.j.Ma(i);for(var s=this.j.Oe;-1!=s;s=this.j.Sf(s)){switch(this.Um){case 3:r=this.TD(s,t,i);break;case 4:r=this.IG(s,t,i);break;case 5:r=this.PU(s,t,i);break;default:throw e.i.Ra()}if(r)break}r||this.MJ()},t.prototype.gr=function(e,t){this.j.fr(e,t)},t.prototype.Xo=function(e,t,i){this.QP(e,t,i),this.gr(e,i)},t.prototype.QP=function(t,i,r){for(e.Tk.W(t,i,r,!1),t.Ip(0,!0,!0),i=t.ld;-1!=i;i=t.ve(i))1736==t.jc(i)&&e.tn.W(t,i,-1,!1,r)},t.OE=function(t,i){var r=t.K();return e.ba.zd(r)?((i=new e.Ua(t.description)).oc(t,!0),i):197==r?(r=new e.l,t.A(r),r.da()<=i&&r.S()<=i?(i=new e.Ta(t.description),t.tf(i),i):r.da()<=i||r.S()<=i?(i=new e.Ua(t.description),r=new e.Ta,t.If(0,r),i.nf(r),t.If(2,r),i.lineTo(r),i):((i=new e.Ea(t.description)).bd(t,!1),i)):t},t}(),e.cm=t}($||($={})),function(e){var t=function(){function t(t){this.Gm=new e.ja(0),this.ew=new e.ja(0),this.wt=new e.h,this.xt=new e.h,this.g=t,this.Is=-1}return t.prototype.cc=function(e){return this.g.cc(this.uz(e))},t.prototype.Cv=function(e){var t=this.dz(e);if(e=this.zF(e),this.g.Na(t)==e){var i=t;t=e,e=i}return this.g.Hc(t,this.wt),this.g.Hc(e,this.xt),this.wt.y<this.xt.y},t.prototype.uz=function(e){var t=this.dz(e);return e=this.zF(e),this.g.V(t)==e?t:e},t.prototype.dz=function(e){return this.Gm.get(e)},t.prototype.zF=function(e){return this.ew.get(e)},t.prototype.jF=function(e){this.Gm.set(e,this.Is),this.Is=e},t.prototype.fI=function(t){if(-1!=this.Is){var i=this.Is;return this.Is=this.Gm.get(i),this.Gm.set(i,t),this.ew.set(i,this.g.V(t)),i}return null==this.Gm&&(this.Gm=new e.ja(0),this.ew=new e.ja(0)),i=this.Gm.size,this.Gm.add(t),this.ew.add(this.g.V(t)),i},t.prototype.mz=function(e){return this.g.cd(this.dz(e))},t}();e.mY=t;var i=function(){function t(t){this.Ce=t,this.ie=new e.zb,this.Pm=new e.zb,this.uH=0,this.Bo=null,this.sA=-1}return t.prototype.compare=function(e,t,i){i=e.ka(i);var r=this.Ce.hb;if(this.sA==t)var s=this.uH;else this.Bo=r.cc(t),null==this.Bo?((e=r.g).fd(r.uz(t),this.ie),this.Bo=this.ie,s=this.ie.Me(this.Ce.zh,0)):s=this.Bo.Me(this.Ce.zh,0),this.uH=s,this.sA=t;if(null==(e=r.cc(i))){(e=r.g).fd(r.uz(i),this.Pm),e=this.Pm;var n=this.Pm.Me(this.Ce.zh,0)}else n=e.Me(this.Ce.zh,0);return s==n&&(t=r.Cv(t),i=r.Cv(i),(t=.5*((i=Math.min(t?this.Bo.ma:this.Bo.oa,i?e.ma:e.oa))+this.Ce.zh))==this.Ce.zh&&(t=i),s=this.Bo.Me(t,0),n=e.Me(t,0)),s<n?-1:s>n?1:0},t.prototype.reset=function(){this.sA=-1},t}(),r=function(){function r(){this.Ym=this.Il=null,this.fb=new e.Yj,this.fb.JP(),this.ae=new i(this),this.fb.Wo(this.ae)}return r.prototype.zQ=function(){var t=!1;if(this.gw&&(t=this.AQ()),1==this.g.ea(this.Y)){var i=this.g.Ob(this.Y);return t=this.g.qz(i),this.g.JB(i,!0),0>t&&(t=this.g.Ya(i),this.g.hJ(t),this.g.Xg(i,this.g.Na(t)),!0)}for(this.Gl=this.g.Ey(),this.xo=this.g.Ey(),i=this.g.Ob(this.Y);-1!=i;i=this.g.Sb(i))this.g.ir(i,this.Gl,0),this.g.ir(i,this.xo,-1);i=new e.ja(0),this.zh=NaN;var r=new e.h;this.et=this.g.ea(this.Y),this.so=this.g.Hd(),this.Ss=this.g.Hd();for(var s=this.Il.sc(this.Il.je);-1!=s;s=this.Il.lb(s)){var n=this.Il.getData(s);if(this.g.Hc(n,r),r.y!=this.zh&&0!=i.size&&(t=this.ut(i)||t,this.ae.reset(),i.clear(!1)),i.add(n),this.zh=r.y,0==this.et)break}for(0<this.et&&(t=this.ut(i)||t,i.clear(!1)),this.g.Ud(this.so),this.g.Ud(this.Ss),i=this.g.Ob(this.Y);-1!=i;)if(3==this.g.tj(i,this.Gl)){for(this.g.JB(i,!0),r=i,i=this.g.tj(i,this.xo);-1!=i;)s=this.g.tj(i,this.xo),this.g.PT(this.Y,this.g.Sb(r),i),r=i,i=s;i=this.g.Sb(r)}else this.g.JB(i,!1),i=this.g.Sb(i);return this.g.wB(this.Gl),this.g.wB(this.xo),t},r.prototype.ut=function(e){return this.QV(e)},r.prototype.QV=function(i){var r=!1;null==this.hb&&(this.hb=new t(this.g)),null==this.Ym?(this.Ym=new e.ja(0),this.Ym.Jb(16)):this.Ym.clear(!1),this.PV(i);for(var s=0,n=i.size;s<n;s++){var o=i.get(s);-1!=o&&this.gG(o,-1)}for(s=0;s<this.Ym.size&&0<this.et;s++)if(i=this.Ym.get(s),o=this.hb.mz(this.fb.ka(i)),n=-1,0==this.g.tj(o,this.Gl)){o=this.fb.xe(i);for(var a,l=i;-1!=o;){var h=this.fb.ka(o),c=this.hb.mz(h),u=this.g.tj(c,this.Gl);if(0!=u){n=c;break}l=o,o=this.fb.xe(o)}-1==o?(a=!0,o=l):(h=this.fb.ka(o),a=this.hb.Cv(h),o=this.fb.lb(o),a=!a);do{if(h=this.fb.ka(o),c=this.hb.mz(h),0==(u=this.g.tj(c,this.Gl))&&(a!=this.hb.Cv(h)&&(r=this.g.Ya(c),this.g.hJ(r),this.g.Xg(c,this.g.Na(r)),r=!0),this.g.ir(c,this.Gl,a?3:2),a||(l=this.g.tj(n,this.xo),this.g.ir(n,this.xo,c),this.g.ir(c,this.xo,l)),this.et--,0==this.et))return r;n=c,l=o,o=this.fb.lb(o),a=!a}while(l!=i)}return r},r.prototype.PV=function(e){for(var t=0,i=e.size;t<i;t++){var r=e.get(t),s=this.g.Qa(r,this.so),n=this.g.Qa(r,this.Ss);if(-1!=s){var o=this.fb.ka(s);this.hb.jF(o),this.g.Sa(r,this.so,-1)}-1!=n&&(o=this.fb.ka(n),this.hb.jF(o),this.g.Sa(r,this.Ss,-1)),o=-1,-1!=s&&-1!=n?(this.fb.wd(s,-1),this.fb.wd(n,-1),e.set(t,-1)):o=-1!=s?s:n,-1!=o&&(this.gG(r,o)||this.fb.wd(o,-1),e.set(t,-1))}},r.prototype.gG=function(t,i){var r=new e.h,s=new e.h;this.g.Hc(t,r);var n=this.g.V(t);this.g.Hc(n,s);var o=!1;if(r.y<s.y){o=!0;var a=this.hb.fI(t);if(-1==i)var l=this.fb.addElement(a,-1);else l=i,this.fb.Tj(l,a);-1==(a=this.g.Qa(n,this.so))?this.g.Sa(n,this.so,l):this.g.Sa(n,this.Ss,l),n=this.g.cd(t),0==this.g.tj(n,this.Gl)&&this.Ym.add(l)}return n=this.g.Na(t),this.g.Hc(n,s),r.y<s.y&&(o=!0,a=this.hb.fI(n),-1==i?l=this.fb.addElement(a,-1):(l=i,this.fb.Tj(l,a)),-1==(a=this.g.Qa(n,this.so))?this.g.Sa(n,this.so,l):this.g.Sa(n,this.Ss,l),n=this.g.cd(t),0==this.g.tj(n,this.Gl)&&this.Ym.add(l)),o},r.W=function(e,t,i,s){var n=new r;return n.g=e,n.Y=t,n.Il=i,n.gw=s,n.zQ()},r.prototype.AQ=function(){var t=new e.ja(0),i=new e.ja(0),r=-1,s=-1,n=new e.h;n.Sc();for(var o=-1,a=-1,l=-1,h=new e.h,c=this.Il.sc(this.Il.je);-1!=c;c=this.Il.lb(c)){var u=this.Il.getData(c);this.g.Hc(u,h);var p=this.g.cd(u);n.rb(h)&&a==p?(-1==s&&(r=this.g.Ey(),s=this.g.Hd()),-1==l&&(l=i.size,this.g.Sa(o,s,l),i.add(1),-1==this.g.tj(p,r)&&(this.g.ir(p,r,o),t.add(p))),this.g.Sa(u,s,l),i.PW(i.Gc()+1)):(l=-1,n.N(h)),o=u,a=p}if(0==t.size)return!1;for(n=new e.ja(0),o=new e.ja(0),a=0,l=t.size;a<l;a++){p=t.get(a);var d=this.g.tj(p,r);for(u=this.g.Qa(d,s),n.clear(!1),o.clear(!1),n.add(d),o.add(u),u=this.g.V(d);u!=d;u=this.g.V(u)){var f=u;if(-1!=(h=this.g.Qa(f,s)))if(0==o.size)o.add(h),n.add(f);else if(o.Gc()==h){c=n.Gc();var y=this.g.V(c);d=this.g.V(f),this.g.Cc(c,d),this.g.Dc(d,c),this.g.Cc(f,y),this.g.Dc(y,f),f=[!1],y=this.g.fG(this.Y,y,this.g.Ya(p),f),this.g.Sa(u,s,-1),f[0]&&this.g.Kf(p,d),u=this.g.Ka(p),u-=d=this.g.Ka(y),this.g.Wj(p,u),i.set(h,i.get(h)-1),1==i.get(h)&&(i.set(h,0),o.Jf(),n.Jf()),u=d=c}else n.add(u),o.add(h)}}return this.g.wB(r),this.g.Ud(s),!0},r}();e.OL=r}($||($={})),function(e){var t=function(){function t(){}return t.prototype.hg=function(){this.JA=this.tb=null},t.prototype.get=function(){return this.JA},t.prototype.set=function(t){if(this.JA=t,null!=t)throw 322==t.K()&&(this.tb=t),e.i.Ra()},t.prototype.create=function(t){if(322!=t)throw e.i.ga("Not Implemented");this.Pr()},t.prototype.Pr=function(){null==this.tb&&(this.tb=new e.zb),this.JA=this.tb},t}();e.hg=t}($||($={})),function(e){(e=e.PL||(e.PL={}))[e.enumLineSeg=1]="enumLineSeg",e[e.enumBezierSeg=2]="enumBezierSeg",e[e.enumArcSeg=4]="enumArcSeg",e[e.enumNonlinearSegmentMask=6]="enumNonlinearSegmentMask",e[e.enumSegmentMask=7]="enumSegmentMask",e[e.enumDensified=8]="enumDensified"}($||($={})),function(e){var t=function(e){this.aj=e,this.jC=this.kC=1,this.mB=this.lB=this.nB=0},i=function(){function i(){this.Hq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Bk=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.Cf=new e.Ta,this.ra=this.Dw=0,this.no=[],this.at=[],this.zw=[],this.Kq=[],this.GA=[]}return i.prototype.qB=function(e){if(null!=e){for(var t=0,i=e.length;t<i;t++)this.hW(e[t]);e.length=0}},i.prototype.hW=function(e){e.aj=null,this.Kq.push(e)},i.prototype.Pw=function(e){if(0===this.Kq.length)var i=new t(e);else(i=this.Kq[this.Kq.length-1]).aj=e,--this.Kq.length;return i},i.prototype.JR=function(e,t){return 0==e?this.at[t]:this.zw[t]},i.prototype.VA=function(){this.Dw>=this.GA.length&&this.GA.push(new e.hg);var t=this.GA[this.Dw];return this.Dw++,t},i.prototype.clear=function(){this.qB(this.no),this.qB(this.at),this.qB(this.zw),this.Dw=0},i.prototype.Po=function(e){this.no.push(this.Pw(e))},i.prototype.ql=function(e){return 0==e?this.at.length:this.zw.length},i.prototype.Xp=function(e,t){return this.JR(e,t).aj},i.prototype.Fa=function(t,i){if(2!=this.no.length)throw e.i.Ra();this.ra=t;var r=e.mc.nx(.01*t),s=!1,n=this.no[0],o=this.no[1];if(i||0!=(5&n.aj.Br(o.aj,t,!0))){if(322==n.aj.K()){var a=n.aj;if(322==o.aj.K()){i=o.aj;var l=e.zb.Xx(a,i,null,this.Hq,this.Bk,t);if(0==l)throw e.zb.Xx(a,i,null,this.Hq,this.Bk,t),e.i.Ra();t=Array(9),e.P.av(t,null);for(var h=0;h<l;h++){var c=this.Hq[h],u=this.Bk[h],p=n.mB,d=1;0==c?(p=n.nB,d=n.kC):1==c&&(p=n.lB,d=n.jC);var f=o.mB,y=1;0==u?(f=o.nB,y=o.kC):1==u&&(f=o.lB,y=o.jC);var g=new e.h;p==f?(p=new e.h,a.ic(c,p),c=new e.h,i.ic(u,c),y/=u=d+y,e.mc.GG(p,c,y,g),e.h.zc(g,p)+e.h.zc(g,c)>r&&(s=!0)):p>f?(a.ic(c,g),c=new e.h,i.ic(u,c),e.h.zc(g,c)>r&&(s=!0)):(i.ic(u,g),p=new e.h,a.ic(c,p),e.h.zc(g,p)>r&&(s=!0)),t[h]=g}for(n=0,o=-1,h=0;h<=l;h++)(y=h<l?this.Hq[h]:1)!=n&&(r=this.VA(),a.bh(n,y,r),-1!=o&&r.get().Ec(t[o]),h!=l&&r.get().Rc(t[h]),n=y,this.at.push(this.Pw(r.get()))),o=h;for(a=[0,0,0,0,0,0,0,0,0],h=0;h<l;h++)a[h]=h;for(1<l&&this.Bk[0]>this.Bk[1]&&(y=this.Bk[0],this.Bk[0]=this.Bk[1],this.Bk[1]=y,h=a[0],a[0]=a[1],a[1]=h),n=0,o=-1,h=0;h<=l;h++)(y=h<l?this.Bk[h]:1)!=n&&(r=this.VA(),i.bh(n,y,r),-1!=o&&(n=a[o],r.get().Ec(t[n])),h!=l&&(n=a[h],r.get().Rc(t[n])),n=y,this.zw.push(this.Pw(r.get()))),o=h;return s}}throw e.i.Ra()}return!1},i.prototype.Fz=function(t,i,r){if(i.copyTo(this.Cf),1!=this.no.length)throw e.i.Ra();this.ra=t;var s=this.no[0];if(r||s.aj.su(i.D(),t,!0)){if(322!=s.aj.K())throw e.i.Ra();var n=(t=s.aj).fe(i.D(),!1);this.Hq[0]=n;var o=s.mB;for(r=1,0==n?(o=s.nB,r=s.kC):1==n&&(o=s.lB,r=s.jC),s=new e.h,0==o?(o=new e.h,t.ic(n,o),i=i.D(),e.mc.GG(o,i,1/(r+1),s)):0<o?(s=new e.h,t.ic(n,s)):s=i.D(),r=0,n=-1,o=0;1>=o;o++){if((i=1>o?this.Hq[o]:1)!=r){var a=this.VA();t.bh(r,i,a),-1!=n&&a.get().Ec(s),1!=o&&a.get().Rc(s),r=i,this.at.push(this.Pw(a.get()))}n=o}this.Cf.Db(s)}},i}();e.LC=i}($||($={})),function(e){var t=function(){function t(t){this.Es=this.rk=this.tb=null,this.bg=0,this.Bm=!1,this.Af=-1,this.El=this.Kd=0,this.gb=-1,this.ib=t,this.bg=this.Ux(this.El),this.Bm=!1,this.rk=null,this.Es=new e.h}return t.prototype.rW=function(t){if(this.ib!=t.ib)throw e.i.Hb();this.Af=t.Af,this.Kd=t.Kd,this.gb=t.gb,this.El=t.El,this.bg=t.bg,this.Bm=t.Bm,this.rk=null},t.prototype.ia=function(){if(this.Af!=this.Kd&&this.tD(),this.Bm)this.Kd=(this.Kd+1)%this.bg;else{if(this.Kd==this.bg)throw e.i.re();this.Kd++}return this.rk},t.prototype.mi=function(){if(this.Bm)this.Kd=(this.bg+this.Kd-1)%this.bg;else{if(0==this.Kd)throw e.i.re();this.Kd--}return this.Kd!=this.Af&&this.tD(),this.rk},t.prototype.sW=function(){this.Af=-1,this.Kd=0},t.prototype.tW=function(){this.Kd=this.bg,this.Af=-1},t.prototype.Wb=function(e,t){if(void 0===t&&(t=-1),0<=this.gb&&this.gb<this.ib.ea()){var i=this.AM();if(e>=i&&e<this.ib.Wc(this.gb))return this.Af=-1,void(this.Kd=e-i)}t=0<=t&&t<this.ib.ea()&&e>=this.ib.Ca(t)&&e<this.ib.Wc(t)?t:this.ib.nz(e),this.El=t+1,this.gb=t,this.Af=-1,this.Kd=e-this.ib.Ca(t),this.bg=this.Ux(t),this.ib.Ca(this.gb),this.ib.ec(this.gb)},t.prototype.ab=function(){return this.gb=this.El,!(this.gb>=this.ib.ea()||(this.Af=-1,this.Kd=0,this.bg=this.Ux(this.gb),this.ib.Ca(this.gb),this.ib.ec(this.gb),this.El++,0))},t.prototype.$i=function(){this.bg=this.Kd=this.Af=-1,this.El=0,this.gb=-1},t.prototype.Ux=function(e){if(this.ib.Bc())return 0;var t=1;return this.ib.ec(e)&&(t=0),this.ib.Ka(e)-t},t.prototype.Pn=function(){return this.Af==this.bg-1&&this.ib.ec(this.gb)},t.prototype.DB=function(){this.Bm=!0},t.prototype.xb=function(){return this.ib.nb.o[this.gb]+this.Af},t.prototype.AM=function(){return this.ib.Ca(this.gb)},t.prototype.ik=function(){return this.Pn()?this.ib.Ca(this.gb):this.xb()+1},t.prototype.xm=function(){return 0==this.Af},t.prototype.Rn=function(){return this.Af==this.bg-1},t.prototype.Ia=function(){return this.Kd<this.bg},t.prototype.zz=function(){return 0<this.Kd},t.prototype.Pf=function(){var e=new t(this.ib);return e.Af=this.Af,e.Kd=this.Kd,e.bg=this.bg,e.gb=this.gb,e.El=this.El,e.ib=this.ib,e.Bm=this.Bm,e},t.prototype.tD=function(){if(0>this.Kd||this.Kd>=this.bg)throw e.i.re();this.Af=this.Kd;var t=this.xb();this.ib.rc();var i=this.ib.Se,r=1;switch(null!=i&&(r=7&i.read(t)),i=this.ib.description,r){case 1:null==this.tb&&(this.tb=new e.zb),this.rk=this.tb;break;case 2:throw e.i.ga("internal error");case 4:default:throw e.i.Ra()}this.rk.kg(i),r=this.ik(),this.ib.Hc(t,this.Es),this.rk.Ec(this.Es),this.ib.Hc(r,this.Es),this.rk.Rc(this.Es);for(var s=1,n=i.Ba;s<n;s++)for(var o=i.qd(s),a=e.ua.Wa(o),l=0;l<a;l++){var h=this.ib.Vc(o,t,l);this.rk.RB(o,l,h),h=this.ib.Vc(o,r,l),this.rk.IB(o,l,h)}},t.prototype.QS=function(){return this.gb==this.ib.ea()-1},t.prototype.Qn=function(){var e=this.ib.MR();return null!=e&&1!=(7&e.read(this.Af))},t}();e.QL=t}($||($={})),function(e){var t=function(){function t(t){t instanceof e.ba?(this.pH=t,this.za=-1,this.Fi=1):(this.kT=t.slice(0),this.za=-1,this.Fi=t.length)}return t.prototype.Ma=function(){return this.za},t.prototype.next=function(){return this.za<this.Fi-1?(this.za++,null!=this.pH?this.pH:this.kT[this.za]):null},t.prototype.qe=function(){},t}();e.$c=t}($||($={})),function(e){var t=function(){this.next=null},i=function(){function i(){this.Vq=this.Lw=this.Mw=0,this.cF=!1,this.ZJ=0,this.jn=this.Lf=this.Yl=this.Kh=null,this.Ql=0,this.py=null,this.rl=this.pi=-1}return i.prototype.oX=function(t,i,r){this.pi=t,this.rl=i,this.Kh=this.Yl=null,this.Vq=0,this.py=r,null==this.jn&&(this.jn=e.P.lg(384,0)),this.fK()},i.prototype.S=function(){return this.pi},i.prototype.da=function(){return this.rl},i.prototype.flush=function(){0<this.Ql&&(this.py.ZE(this.jn,this.Ql),this.Ql=0)},i.prototype.fK=function(){if(0<this.Vq){for(var e=0;e<this.rl;e++){for(var t=this.Yl[e];null!=t;){var i=t;t=t.next,i.next=null}this.Yl[e]=null}this.Kh=null}this.Mw=this.rl,this.Lw=-1,this.Vq=0},i.prototype.aJ=function(e){for(this.cF=e==i.Ax,e=this.Mw;e<=this.Lw;e++)this.kN(),this.dN(e),this.RP();this.fK()},i.prototype.ey=function(i,r,s,n){if(r!=n){var o=1;if(r>n&&(o=i,i=s,s=o,o=r,r=n,n=o,o=-1),!(0>n||r>=this.rl)){0>i&&0>s?s=i=-1:i>=this.pi&&s>=this.pi&&(s=i=this.pi);var a=(s-i)/(n-r);n>this.rl&&(s=a*((n=this.rl)-r)+i),0>r&&(i=a*(0-r)+i,r=0);var l=Math.max(this.pi+1,8388607);-8388607>i?(r=(0-i)/a+r,i=0):i>l&&(r=(this.pi-i)/a+r,i=this.pi),-8388607>s?n=(0-i)/a+r:s>l&&(n=(this.pi-i)/a+r),(r=e.P.truncate(r))!=(n=e.P.truncate(n))&&((s=new t).x=e.P.truncate(4294967296*i),s.y=r,s.H=n,s.OP=e.P.truncate(4294967296*a),s.dir=o,null==this.Yl&&(this.Yl=e.P.lg(this.rl,null)),s.next=this.Yl[s.y],this.Yl[s.y]=s,s.y<this.Mw&&(this.Mw=s.y),s.H>this.Lw&&(this.Lw=s.H),this.Vq++)}}},i.prototype.kN=function(){if(null!=this.Kh){for(var e=!1,t=null,i=this.Kh;null!=i;)if(i.y++,i.y==i.H){var r=i;i=i.next,null!=t?t.next=i:this.Kh=i,r.next=null}else i.x+=i.OP,null!=t&&t.x>i.x&&(e=!0),t=i,i=i.next;e&&(this.Kh=this.YJ(this.Kh))}},i.prototype.dN=function(e){if(!(e>=this.rl)){var t=this.Yl[e];if(null!=t){this.Yl[e]=null,t=this.YJ(t),this.Vq-=this.ZJ,e=this.Kh;for(var i=!0,r=t,s=null;null!=e&&null!=r;)e.x>r.x?(i&&(this.Kh=r),i=r.next,r.next=e,null!=s&&(s.next=r),s=r,r=i):(i=e.next,e.next=r,null!=s&&(s.next=e),s=e,e=i),i=!1;null==this.Kh&&(this.Kh=t)}}},i.XJ=function(e,t){return 0>e?0:e>t?t:e},i.prototype.RP=function(){if(null!=this.Kh)for(var t=0,r=this.Kh,s=e.P.truncate(e.P.OG(r.x)),n=r.next;null!=n;n=n.next)if(t=this.cF?1^t:t+n.dir,n.x>r.x){var o=e.P.truncate(e.P.OG(n.x));0!=t&&(r=i.XJ(s,this.pi),(s=i.XJ(o,this.pi))>r&&r<this.pi&&(this.jn[this.Ql++]=r,this.jn[this.Ql++]=s,this.jn[this.Ql++]=n.y,this.Ql==this.jn.length&&(this.py.ZE(this.jn,this.Ql),this.Ql=0))),r=n,s=o}},i.prototype.YJ=function(t){for(var r=0,s=t;null!=s;s=s.next)r++;if(this.ZJ=r,1==r)return t;null==this.Lf?this.Lf=e.P.lg(Math.max(r,16),null):this.Lf.length<r&&(this.Lf=e.P.lg(Math.max(r,2*this.Lf.length),null));var n=0;for(s=t;null!=s;s=s.next)this.Lf[n++]=s;for(2==r?this.Lf[0].x>this.Lf[1].x&&(t=this.Lf[0],this.Lf[0]=this.Lf[1],this.Lf[1]=t):i.sN(this.Lf,r,(function(e,t){return e==t?0:e.x<t.x?-1:e.x>t.x?1:0})),t=this.Lf[0],this.Lf[0]=null,s=t,n=1;n<r;n++)s.next=this.Lf[n],s=this.Lf[n],this.Lf[n]=null;return s.next=null,t},i.sN=function(e,t,i){if(t==e.length)e.sort(i);else{var r=e.slice(0,0),s=e.slice(t);t=e.slice(0,t).sort(i),e.length=0,e.push.apply(e,r.concat(t).concat(s))}},i.Ax=0,i}();e.Nx=i}($||($={})),function(e){var t=function(){function t(){}return t.prototype.vi=function(e,t){var i=this.g.Qa(e,this.Rq);if(this.Fl==i&&(this.Fl=this.oe.lb(this.Fl)),this.io==i&&(this.io=this.oe.lb(this.io)),this.oe.kd(this.LA,i),this.bk(e),t&&-1!=(t=this.g.cd(e))&&this.g.Ya(t)==e){var r=this.g.V(e);if(r!=e){if((i=this.g.cd(r))==t)return void this.g.Kf(t,r);if((r=this.g.Na(e))!=e&&(i=this.g.cd(r))==t)return void this.g.Kf(t,r)}this.g.Kf(t,-1),this.g.Xg(t,-1)}},t.prototype.hD=function(){for(var t=!1,i=new e.h;;){null==this.Xh?(this.Xh=new e.ja(0),this.As=new e.ja(0),this.ye=new e.ja(0)):(this.Xh.clear(!1),this.As.clear(!1),this.ye.clear(!1));for(var r=this.io,s=0,n=!0;r!=this.Fl;){var o=this.oe.getData(r),a=new e.h;this.g.Hc(o,a),n&&(this.g.Hc(o,i),n=!1),a=this.g.Na(o);var l=this.g.V(o);-559038737!=this.g.Qa(a,this.zg)&&(this.Xh.add(a),this.g.Sa(a,this.zg,-559038737),this.As.add(o),this.ye.add(s++)),-559038737!=this.g.Qa(l,this.zg)&&(this.Xh.add(l),this.g.Sa(l,this.zg,-559038737),this.As.add(o),this.ye.add(s++)),r=this.oe.lb(r)}if(2>this.Xh.size)break;var h=this;for(this.ye.Wd(0,this.ye.size,(function(e,t){return h.hM(e,t)})),r=0,s=this.ye.size;r<s;r++)n=this.ye.get(r),n=this.Xh.get(n),this.g.Sa(n,this.zg,r),a=new e.h,this.g.Hc(n,a);for(a=this.LM(i),r=0,s=this.ye.size;r<s;r++)-1!=(n=this.ye.get(r))&&(n=this.Xh.get(n),this.g.Sa(n,this.zg,-1));if(!a)break;t=!0}return t},t.prototype.LM=function(e){for(var t=!1,i=!0;i;){i=!1;var r=0;-1==this.ye.get(r)&&(r=this.em(r));for(var s=this.em(r),n=0,o=this.ye.size;n<o&&-1!=r&&-1!=s&&r!=s;n++){var a=this.ye.get(r);s=this.ye.get(s),a=this.Xh.get(a),s=this.Xh.get(s);var l=this.g.V(a);this.g.Ev(l,e)||(l=this.g.Na(a));var h=this.g.V(s);this.g.Ev(h,e)||(h=this.g.Na(s));var c=this.qu(l,a),u=this.qu(h,s),p=c?this.g.Na(l):this.g.V(l),d=u?this.g.Na(h):this.g.V(h),f=!1;(this.tp(l)||this.tp(h)||this.tp(a)||this.tp(s)||this.tp(p)||this.tp(d))&&(f=!0),!f&&this.g.hq(a,s)&&(f=!0,this.lD(c,u,l,a,h,s)),!f&&this.g.hq(p,d)&&(f=!0,this.lD(!c,!u,l,p,h,d)),f&&(t=!0),i=i||f,r=this.em(r),s=this.em(r)}}if(!t)for(r=0,-1==this.ye.get(r)&&(r=this.em(r)),s=this.em(r),n=0,o=this.ye.size;n<o&&-1!=r&&-1!=s&&r!=s;n++)a=this.ye.get(r),s=this.ye.get(s),a=this.Xh.get(a),s=this.Xh.get(s),l=this.g.V(a),this.g.Ev(l,e)||(l=this.g.Na(a)),h=this.g.V(s),this.g.Ev(h,e)||(h=this.g.Na(s)),c=this.qu(l,a),u=this.qu(h,s),p=c?this.g.Na(l):this.g.V(l),d=u?this.g.Na(h):this.g.V(h),this.vM(c,u,a,l,p,s,h,d)&&(t=!0),r=this.em(r),s=this.em(r);return t},t.prototype.PM=function(){1736==this.g.jc(this.Y)&&1==this.g.Jn(this.Y)&&(new e.Hg).CU(this.gw,this.g,this.Y,this.nd);var t=!1,i=!0;this.zg=this.Rq=-1;var r=this.g.I(this.Y),s=new e.ja(0);s.Jb(r);for(var n=this.g.Ob(this.Y);-1!=n;n=this.g.Sb(n))for(var o=this.g.Ya(n),a=0,l=this.g.Ka(n);a<l;a++)s.add(o),o=this.g.V(o);var h=this.g.ud.o,c=this.g.ud.Mf;this.g.wb.rc();var u=this.g.wb.Aa[0].o;for(s.Wd(0,r,(function(e,t){var i=h[c*e],r=h[c*t],s=u[2*i];i=u[2*i+1];var n=u[2*r];return 0==(s=i<(r=u[2*r+1])?-1:i>r?1:s<n?-1:s>n?1:0)&&(s=(e=h[c*e+3])<(t=h[c*t+3])?-1:e==t?0:1),s})),this.Rq=this.g.Hd(),this.oe=new e.kp,this.LA=this.oe.Qh(0),this.oe.hn(r),n=0;n<r;n++)o=s.get(n),a=this.oe.addElement(this.LA,o),this.g.Sa(o,this.Rq,a);for(this.zg=this.g.Hd(),this.Fl=-1,this.VC()&&(t=!0);i;){i=!1,r=0,s=!1;do{s=!1,this.io=-1,l=0,n=new e.h,a=new e.h;for(var p=this.oe.sc(this.LA);-1!=p;)o=this.oe.getData(p),-1!=this.io?(this.g.Hc(o,a),n.rb(a)?l++:(n.N(a),this.Fl=p,0<l&&(o=this.hD())&&(s=!0,-1!=this.Fl&&(o=this.oe.getData(this.Fl),this.g.Hc(o,n))),this.io=p=this.Fl,l=0)):(this.io=p,this.g.Hc(this.oe.getData(p),n),l=0),-1!=p&&(p=this.oe.lb(p));if(this.Fl=-1,0<l&&(o=this.hD())&&(s=!0),10<r++)throw e.i.Ra();s&&this.yM(),this.VC()&&(s=!0),i=i||s&&!1,t=t||s}while(s)}return this.g.Ud(this.Rq),this.g.Ud(this.zg),e.OL.W(this.g,this.Y,this.oe,this.gw)||t},t.prototype.qu=function(e,t){return this.g.V(t)!=e},t.prototype.vM=function(e,t,i,r,s,n,o,a){if(r==o)return this.bk(i),this.bk(n),!1;var l=this.g.Qa(i,this.zg),h=this.g.Qa(s,this.zg),c=this.g.Qa(n,this.zg),u=this.g.Qa(a,this.zg),p=[0,0,0,0];for((i=[0,0,0,0,0,0,0,0])[0]=0,p[0]=l,i[1]=0,p[1]=h,i[2]=1,p[2]=c,i[3]=1,p[3]=u,l=1;4>l;l++){for(h=p[l],c=i[l],u=l-1;0<=u&&p[u]>h;)p[u+1]=p[u],i[u+1]=i[u],u--;p[u+1]=h,i[u+1]=c}return p=0,0!=i[0]&&(p|=1),0!=i[1]&&(p|=2),0!=i[2]&&(p|=4),0!=i[3]&&(p|=8),(5==p||10==p)&&(e==t?e?(this.g.Cc(a,r),this.g.Dc(r,a),this.g.Cc(s,o),this.g.Dc(o,s)):(this.g.Dc(a,r),this.g.Cc(r,a),this.g.Dc(s,o),this.g.Cc(o,s)):e?(this.g.Dc(r,n),this.g.Cc(n,r),this.g.Dc(o,s),this.g.Cc(s,o)):(this.g.Cc(r,n),this.g.Dc(n,r),this.g.Cc(o,s),this.g.Dc(s,o)),!0)},t.prototype.lD=function(e,t,i,r,s,n){this.BY?this.NM():this.MM(e,t,i,r,s,n)},t.prototype.NM=function(){throw e.i.ga("not implemented.")},t.prototype.MM=function(e,t,i,r,s,n){if(e!=t)e?(this.g.Cc(i,s),this.g.Dc(s,i),this.g.Cc(n,r),this.g.Dc(r,n),this.wn(s,i),this.vi(s,!0),this.g.ni(s,!0),this.bk(i),this.wn(n,r),this.vi(n,!0),this.g.ni(n,!1)):(this.g.Cc(s,i),this.g.Dc(i,s),this.g.Cc(r,n),this.g.Dc(n,r),this.wn(s,i),this.vi(s,!0),this.g.ni(s,!1),this.bk(i),this.wn(n,r),this.vi(n,!0),this.g.ni(n,!0)),this.bk(r);else{var o=e?i:r,a=t?s:n;for(e=e?r:i,t=t?n:s,s=!1,this.g.Cc(o,a),this.g.Cc(a,o),this.g.Dc(e,t),this.g.Dc(t,e),n=t;n!=a;)i=this.g.Na(n),r=this.g.V(n),this.g.Dc(n,r),this.g.Cc(n,i),s=s||n==o,n=r;s||(i=this.g.Na(a),r=this.g.V(a),this.g.Dc(a,r),this.g.Cc(a,i)),this.wn(a,o),this.vi(a,!0),this.g.ni(a,!1),this.bk(o),this.wn(t,e),this.vi(t,!0),this.g.ni(t,!1),this.bk(e)}},t.prototype.VC=function(){for(var e=!1,t=this.g.Ob(this.Y);-1!=t;){for(var i=this.g.Ya(t),r=0,s=this.g.Ka(t);r<s&&1<s;){var n=this.g.Na(i),o=this.g.V(i);this.g.hq(n,o)?(e=!0,this.vi(i,!1),this.g.pd(i,!0),this.vi(o,!1),this.g.pd(o,!0),i=n,r=0,s=this.g.Ka(t)):(i=o,r++)}if(2>this.g.Ka(t)){for(e=this.g.Ya(t),r=0,s=this.g.Ka(t);r<s;r++)this.vi(e,!1),e=this.g.V(e);t=this.g.ar(t),e=!0}else t=this.g.Sb(t)}return e},t.prototype.tp=function(e){for(var t=!1;;){var i=this.g.V(e),r=this.g.Na(e);if(i==e)return this.vi(e,!0),this.g.ni(e,!1),!0;if(!this.g.hq(i,r))break;if(t=!0,this.bk(r),this.bk(i),this.vi(e,!0),this.g.ni(e,!1),this.wn(i,r),this.vi(i,!0),this.g.ni(i,!0),i==r)break;e=r}return t},t.prototype.yM=function(){for(var e=0,t=this.oe.sc(this.oe.je);-1!=t;t=this.oe.lb(t)){var i=this.oe.getData(t);this.g.bj(i,-1)}for(var r=0,s=this.g.Ob(this.Y);-1!=s;)if(-1==(t=this.g.Ya(s))||-1!=this.g.cd(t))i=s,s=this.g.Sb(s),this.g.br(i);else{this.g.bj(t,s);var n=1;for(i=this.g.V(t);i!=t;i=this.g.V(i))this.g.bj(i,s),n++;this.g.ep(s,!1),this.g.Wj(s,n),this.g.Xg(s,this.g.Na(t)),r+=n,e++,s=this.g.Sb(s)}for(t=this.oe.sc(this.oe.je);-1!=t;t=this.oe.lb(t))i=this.oe.getData(t),-1==this.g.cd(i)&&(s=this.g.fG(this.Y,i,i,null),r+=this.g.Ka(s),e++);for(this.g.Tl(this.Y,e),this.g.Uj(this.Y,r),e=0,r=this.g.ld;-1!=r;r=this.g.ve(r))e+=this.g.I(r);this.g.VB(e)},t.prototype.em=function(e){for(var t=0,i=this.ye.size-1;t<i;t++)if(e=(e+1)%this.ye.size,-1!=this.ye.get(e))return e;return-1},t.prototype.wn=function(e,t){var i=this.g.Qa(t,this.Rq),r=this.g.Qa(t,this.zg);this.g.eC(e,t),this.g.Sa(t,this.Rq,i),this.g.Sa(t,this.zg,r)},t.prototype.bk=function(e){var t=this.g.Qa(e,this.zg);-1!=t&&(this.ye.set(t,-1),this.g.Sa(e,this.zg,-1))},t.W=function(e,i,r,s,n){var o=new t;return o.g=e,o.Y=i,o.rA=r,o.gw=s,o.nd=n,o.PM()},t.prototype.hM=function(t,i){var r=this.Xh.get(t),s=new e.h;this.g.Hc(r,s),r=new e.h;var n=this.Xh.get(i);return this.g.Hc(n,r),s.rb(r)?0:(n=this.As.get(t),t=new e.h,this.g.Hc(n,t),n=this.As.get(i),i=new e.h,this.g.Hc(n,i),(n=new e.h).vc(s,t),(s=new e.h).vc(r,i),e.h.ou(n,s))},t}();e.tn=t}($||($={})),function(e){var t,i;(t=e.SL||(e.SL={}))[t.Local=0]="Local",t[t.Geographic=1]="Geographic",t[t.Projected=2]="Projected",t[t.Image=3]="Image",t[t.Unknown=4]="Unknown",(i=e.LL||(e.LL={}))[i.Integer32=0]="Integer32",i[i.Integer64=1]="Integer64",i[i.FloatingPoint=2]="FloatingPoint";var r=function(){function t(){this.qp="",this.tu=null,this.eg=0,this.RH=this.Io=-1,this.xh=null}return t.prototype.Fc=function(){return this.eg},t.prototype.NF=function(){return 1},t.prototype.Yd=function(){var t=.001;return 0!=this.eg?t=e.yr.uQ(this.eg):null!=this.xh&&(t=e.PC.vQ(this.xh)),t},t.prototype.wz=function(){return this.xh},t.prototype.Id=function(){return 0!=this.eg?e.Uc.$g(e.yr.Ny(this.eg)):null!=this.xh?e.PC.wQ(this.xh):void 0},t.Tb=function(t){if(0!=t.eg){if(!0===e.yr.PS(t.eg))return 1;if(!0===e.yr.RS(t.eg))return 2}return 4},t.prototype.bs=function(){var t=this.Fc();return-1!=this.Io?this.Io:(this.Io=e.yr.xK(t),-1!=this.Io?this.Io:t)},t.create=function(i){if(0>=i)throw e.i.O("Invalid or unsupported wkid: "+i);var r=new t;return r.eg=i,r},t.iP=function(i){if(null==i||0==i.length)throw e.i.O("Cannot create SpatialReference from null or empty text.");var r=new t;return r.xh=i,r},t.prototype.Nb=function(e){return this==e||null!=e&&this.constructor==e.constructor&&this.eg==e.eg&&(0!=this.eg||this.xh===e.xh)},t.prototype.toString=function(){return"[ tol: "+this.Ln()+"; wkid: "+this.Fc()+"; wkt: "+this.wz()+"]"},t.prototype.dc=function(){if(""!==this.qp)return this.qp;var e=this.toString();if(Array.prototype.reduce)return this.qp="S"+e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0);var t=0;if(0===e.length)return"";for(var i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return this.qp="S"+t},t.prototype.Ln=function(){return this.Yd(0)},t.prototype.gh=function(){return null!==this.tu?this.tu:this.tu=e.hu.qP(this)},t.RN=2147483645,t.SN=9007199254740990,t}();e.Gg=r}($||($={})),function(e){var t=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.Ki=null,i.IT=null,i.Jq=new e.RL,i.Fo=null,i.kw=null,i}return Z(i,t),i.qP=function(t){var r=new i;if(r.eg=t.eg,r.Io=t.Io,r.RH=t.RH,r.xh=t.xh,""!==r.xh&&null!==r.xh){t=i.cM(r.xh);var s=i.aM(r.xh);r.Jq.Vx(t,s,e.iu.Integer64),r.$x(t),r.by(s),r.eg=t.bs()}else t=i.bM(r.eg),r.$x(t),r.by(null),r.Jq.Vx(t,null,e.iu.Integer64);return r},i.prototype.Yd=function(e){return this.Jq.Ln(e)},i.aM=function(t){if(0>=t.length)throw e.i.O();var r=null;try{r=e.FC.fromString(t)}catch(s){r=null}return null==r?null:i.UC(r,!0)},i.prototype.$x=function(e){this.Ld=e,this.Fo=this.Ld.Id()},i.prototype.by=function(e){this.CH=e,this.IT=null!=this.CH?this.CH.Fo:null},i.prototype.Xc=function(){return 0!=this.Tb()&&3!=this.Tb()&&this.Ld.Xc()},i.prototype.AG=function(){return 0!=this.Tb()&&(3==this.Tb()?this.Ki.fk().Xc():this.Ld.Xc())},i.prototype.fh=function(){return null!=this.Ld?this.Ld.Re:null},i.prototype.rm=function(){return this.Ld.rm()},i.prototype.bf=function(){return this.Ld.bf()},i.prototype.ih=function(){return null!=this.Ld?this.Ld.tw:NaN},i.prototype.Wp=function(){return this.Ld.Wp()},i.prototype.Xr=function(){return this.Ld.Xr()},i.prototype.kk=function(){return this.Ld.kk()},i.prototype.bS=function(t){return e.GC.Ky(this.Ld,t.Ld)},i.prototype.ol=function(){return this.Ld.ol()},i.prototype.Wr=function(){return this.Ld.Wr()},i.prototype.Ai=function(){return 3==this.Tb()?this.Ki.fk().Ai():this.Ld.Ai()},i.prototype.hh=function(){if(!this.Xc())throw e.i.O("!isPannable()");var t=new e.l;return this.Ld.hh(t),t},i.prototype.Le=function(){if(!this.Xc())throw e.i.O("!isPannable()");return this.Ld.to},i.prototype.zR=function(){if(!this.Xc())throw e.i.O("!isPannable()");var t=new e.l;return this.Ld.yR(t),t},i.prototype.qv=function(){if(!this.Xc())throw e.i.O("!isPannable()");return this.Ld.qv()},i.prototype.pv=function(){if(!this.Xc())throw e.i.O("!isPannable()");return this.Ld.pv()},i.prototype.Yr=function(){return null!=this.Ki?this.Ki.fk().Yr():this.Ld.Yr()},i.prototype.HQ=function(){return this.Ld.jv()},i.prototype.Sp=function(){return this.Fo.getUnitFactor()},i.prototype.pz=function(e){return this.Jq.pz(e)},i.prototype.tc=function(){var t=this.Tb();if(1==t)return this;if(3==t)return this.Ki.fk().tc();if(0==t)throw e.i.ga("invalid call");if(4===t)throw e.i.ga("invalid call");if(null!==this.kw)return this.kw;if(null==(t=this.fh().getGeogcs()))throw e.i.Ra();return this.kw=i.UE(t,this.Jq.NF())},i.UE=function(t,r){if(null==t)throw e.i.O("null pointer.");var s=new i;return t=i.nu(t,!0),s.Jq.Vx(t,null,r),s.$x(t),s.by(null),s.eg=t.bs(),s},i.prototype.Tb=function(){var t=this.fh();if(null!=t)switch(t.getType()){case e.Tc.PE_TYPE_GEOGCS:return 1;case e.Tc.PE_TYPE_PROJCS:return 2}return 4},i.prototype.jv=function(){return this.Ld.jv()},i.nu=function(t,r){var s=t.getCode();if(0>=s&&0<(s=e.qf.getCode(t))){if(null==(t=e.qf.coordsys(s)))throw e.i.O("Text to wkid mapping had failed: "+s);return i.nu(t,r)}return r&&0<s&&(r=i.px[s])?r:(r=e.Ab.yv(t,s,!1),i.dK[r]||(t=0>=s?t:e.qf.coordsys(s),t=new e.GC(t),i.dK[r]=t,0<s&&(i.px[s]=t),t))},i.bM=function(t){if(0>=t)throw e.i.O("Invalid or unsupported wkid: "+t);var r=i.px[t];if(null!=r)return r;if(null==(r=e.qf.coordsys(t)))throw e.i.O("Invalid or unsupported wkid: "+t);return(r=i.nu(r,!1)).bs()!=t&&(i.px[t]=r),r},i.cM=function(t){if(null==t||void 0===t||0==t.length)throw e.i.O("Cannot create SpatialReference from null or empty text.");var r=null;try{r=e.qf.fromString(e.Tc.PE_TYPE_COORDSYS,t)}catch(s){throw e.i.O("Cannot create SpatialReference from text. "+s.message)}if(null===r)throw e.i.O("Cannot create SpatialReference from text. ");return i.nu(r,!0)},i.UC=function(t,r){var s,n=t.getCode();if(0>=n&&0<(n=e.qf.getCode(t))){if(null===(n=e.qf.vertcs(n)))throw e.i.O();return i.UC(n,r)}if(r&&0<n&&(r=i.cK[n]))return r;if(t=e.Ab.yv(t,n,!1),r=i.eK[t])return r;if(0>=n||(s=e.qf.vertcs(n)),null===s)throw e.i.O();return s=new e.HL(s),i.eK[t]=s,0<n&&(i.cK[n]=s),s},i.kI=function(t,i){if(null===i||i.B())return null;var r=new e.l;if(null!==i&&1!=t.Tb()){var s=t.tc(),n=s.fh();t=e.xr.Or(t,s,null,null),(i=e.Fx.local().W(i,t,null)).A(r)}else n=t.fh(),i.A(r);return i=n.getPrimem().getLongitude(),n=n.getUnit().getUnitFactor(),new e.DC(r.v,r.G,r.C,r.H,i,n)},i.dD=function(e){var t={name:"",steps:[],_pt:null,_entry:null},i=0;for(e=e.getEntries();i<e.length;i++){var r=e[i],s={AY:!1,OY:"",NY:-1,geogtran:null};0===r.getDirection()?s.isInverse=!1:s.isInverse=!0;var n=r.getGeogtran().getCode();-1<n?s.wkid=n:s.wkt=r.getGeogtran().toString(),t.steps.push(s)}return t},i.OR=function(t,r,s,n){return void 0===s&&(s=null),s=i.kI(n,s),t=e.mp.getGTlist(t.fh(),r.fh(),2,e.mp.PE_GTLIST_OPTS_COMMON,s,1),r=null,t&&0<t.length&&(r=this.dD(t[0]),e.Kx.destroy(t)),null!==s&&s.destroy(),r},i.PR=function(t,r,s,n){var o;if(void 0===s&&(s=null),void 0===n&&(n=null),void 0===o&&(o=30),s=i.kI(n,s),t=e.mp.getGTlist(t.fh(),r.fh(),2,e.mp.PE_GTLIST_OPTS_COMMON,s,o),r=[],t&&0<t.length){for(o=0;o<t.length;o++)r.push(this.dD(t[o]));e.Kx.destroy(t)}return null!==s&&s.destroy(),r},i.px={},i.dK={},i.cK={},i.eK={},i}(e.Gg);e.hu=t}($||($={})),function(e){var t,i;(i=t=e.iu||(e.iu={}))[i.Integer32=0]="Integer32",i[i.Integer64=1]="Integer64",i[i.FloatingPoint=2]="FloatingPoint";var r=function(){function i(){this.rp()}return i.prototype.assign=function(e){this.Hm=e.Hm,this.Im=e.Im,this.Qj=e.Qj,this.mA=e.mA,this.Go=e.Go,this.lA=e.lA,this.Ik=e.Ik,this.Oq=e.Oq,this.Nq=e.Nq,this.Tm=e.Tm},i.prototype.NF=function(){return this.Tm},i.prototype.rp=function(){this.Im=this.Hm=0,this.Qj=1,this.mA=0,this.Go=1,this.lA=0,this.Nq=this.Oq=this.Ik=2220446049250313e-29,this.Tm=t.FloatingPoint},i.prototype.Vx=function(i,r,s){if(this.rp(),this.Tm=s,s!=t.FloatingPoint){var n=new e.l;i.$Q(n),this.Hm=n.v,this.Im=n.G}else this.Im=this.Hm=-17976931348623157e292;(n=i.Re.getType())==e.Tc.PE_TYPE_GEOGCS?(n=(s==t.Integer64?1e-9:1/18e5)*i.bf(),this.Qj=1/n):n==e.Tc.PE_TYPE_PROJCS&&(n=(s==t.Integer64?1e-4:.001)*i.rm(),this.Qj=1/n),null!=r?(n=(s==t.Integer32?.001:1e-4)*r.AH,this.Go=1/n):this.Go=1e4,this.QM(),this.Ik=i.tw,this.Oq=null!=r?.001*r.AH:.001,this.Nq=2220446049250313e-29},i.prototype.QM=function(){if(this.Tm!=t.FloatingPoint){var i=this.Tm==t.Integer64?e.Gg.SN:e.Gg.RN,r=i/this.Qj,s=this.Hm+r,n=e.P.truncate((s-this.Hm)*this.Qj);n>i&&(this.Qj=i/(s-this.Hm)),r=this.Im+r,(n=e.P.truncate((r-this.Im)*this.Qj))>i&&(this.Qj=i/(r-this.Im))}},i.prototype.UB=function(e){switch(e){case 0:this.Ik=void 0;case 1:this.Oq=void 0;case 2:this.Nq=void 0}},i.prototype.Ln=function(e){switch(e){case 0:return this.Ik;case 1:return this.Oq;case 2:return this.Nq}return 0},i.prototype.pz=function(e){if(this.Tm==t.FloatingPoint)return 0;switch(e){case 0:return 1/this.Qj;case 1:case 2:return 1/this.Go;default:return 0}},i.prototype.toString=function(){var e="SRPD [m_toleranceXY: "+this.Ik.toString();return(e=(e=(e=(e=(e=(e=(e=(e=(e=e+";m_falseX: "+this.Hm.toString())+";m_falseY: "+this.Im.toString())+";m_unitsXY: "+this.Qj.toString())+";m_falseZ: "+this.mA.toString())+";m_unitsZ: "+this.Go.toString())+";m_falseM: "+this.lA.toString())+";m_toleranceZ: "+this.Oq.toString())+";m_toleranceM: "+this.Nq.toString())+";m_precision: "+this.Tm.toString())+"] "},i}();e.RL=r}($||($={})),function(e){function t(e,t){return 89.99999<t?t=89.99999:-89.99999>t&&(t=-89.99999),t*=.017453292519943,[111319.49079327169*e,3189068.5*Math.log((1+Math.sin(t))/(1-Math.sin(t)))]}function i(e,t,i){return e=e/6378137*57.29577951308232,i?[e,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*t/6378137)))]:[e-360*Math.floor((e+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*t/6378137)))]}function r(t,i,r){var s=t.Pf();if(33===t.K())i=i(s.Mg(),s.jh()),s.Db(i[0],i[1]);else if(197===t.K()){var n=i(t.fs(),t.hs(),r);i=i(t.es(),t.gs(),r),s.L(n[0],n[1],i[0],i[1])}else for(n=new e.h,t=0;t<s.I();t++){s.D(t,n);var o=i(n.x,n.y,r);n.na(o[0],o[1]),s.Db(t,n)}return s}function s(e){return r(e,i,!0)}function n(e){return r(e,t,!0)}var o=Math.PI/180;e.MK=function(){function t(){}return t.wu=function(t){var i=Math.sqrt(.006694379990197414),r=Math.sin(t.y*o);return e.h.construct(6378137*t.x*o,3167719.6636462314*(r/(1-.006694379990197414*r*r)-1/(2*i)*Math.log((1-i*r)/(1+i*r))))},t.Tx=function(t,i,r,s){var n=1/298.257223563,a=Math.sin(r);r=Math.cos(r);var l=(1-n)*Math.tan(t),h=l*(t=1/Math.sqrt(1+l*l)),c=Math.atan2(l,r),u=(l=t*a)*l,p=1-u,d=272331606107.54688*p/40408299984661.45,f=1+d/16384*(4096+d*(d*(320-175*d)-768)),y=d/1024*(256+d*(d*(74-47*d)-128));d=s/(6356752.31424518*f);for(var g,m,v,b=2*Math.PI;1e-12<Math.abs(d-b);)v=Math.cos(2*c+d),b=d,d=s/(6356752.31424518*f)+y*(g=Math.sin(d))*(v+y/4*((m=Math.cos(d))*(2*v*v-1)-y/6*v*(4*g*g-3)*(4*v*v-3)));return s=h*g-t*m*r,p=n/16*p*(4+n*(4-3*p)),e.h.construct((i+(Math.atan2(g*a,t*m-h*g*r)-(1-p)*n*l*(d+p*g*(v+p*m*(2*v*v-1)))))/o,Math.atan2(h*m+t*g*r,(1-n)*Math.sqrt(u+s*s))/o)},t.EM=function(e,t,i,r){var s=1/298.257223563,n=r-t,o=Math.atan((1-s)*Math.tan(e)),a=Math.atan((1-s)*Math.tan(i)),l=Math.sin(o);o=Math.cos(o);var h=Math.sin(a);a=Math.cos(a);var c=n,u=1e3;do{var p=Math.sin(c),d=Math.cos(c),f=Math.sqrt(a*p*a*p+(o*h-l*a*d)*(o*h-l*a*d));if(0===f)return 0;d=l*h+o*a*d;var y=Math.atan2(f,d),g=o*a*p/f,m=1-g*g;p=d-2*l*h/m,isNaN(p)&&(p=0);var v=s/16*m*(4+s*(4-3*m)),b=c;c=n+(1-v)*s*g*(y+v*f*(p+v*d*(2*p*p-1)))}while(1e-12<Math.abs(c-b)&&0<--u);return 0===u?(l=r-t,{azimuth:Math.atan2(Math.sin(l)*Math.cos(i),Math.cos(e)*Math.sin(i)-Math.sin(e)*Math.cos(i)*Math.cos(l)),geodesicDistance:6371008.771415059*Math.acos(Math.sin(e)*Math.sin(i)+Math.cos(e)*Math.cos(i)*Math.cos(r-t))}):(t=(e=272331606107.54688*m/40408299984661.45)/1024*(256+e*(e*(74-47*e)-128)),{azimuth:Math.atan2(a*Math.sin(c),o*h-l*a*Math.cos(c)),QQ:6356752.31424518*(1+e/16384*(4096+e*(e*(320-175*e)-768)))*(y-t*f*(p+t/4*(d*(2*p*p-1)-t/6*p*(4*f*f-3)*(4*p*p-3)))),MY:Math.atan2(o*Math.sin(c),o*h*Math.cos(c)-l*a)})},t.bQ=function(t){var i=t.hasAttribute(1),r=t.hasAttribute(2),s=[],n=t.ea(),o=null,a=null;i&&(o=t.vb(1)),r&&(a=t.vb(2));for(var l=new e.h,h=0;h<n;h++){for(var c=t.Ca(h),u=t.Ka(h),p=0,d=0,f=NaN,y=NaN,g=NaN,m=NaN,v=t.ec(h),b=[],w=c;w<c+u;w++){t.D(w,l),m=g=NaN;var _=[l.x,l.y];i&&(g=o.get(w),_.push(g)),r&&(n=a.get(w),_.push(m)),w==c&&v&&(p=l.x,d=l.y,f=g,y=m),b.push(_)}!v||p==l.x&&d==l.y&&(!i||isNaN(f)&&isNaN(g)||f==g)&&(!r||isNaN(y)&&isNaN(m)||y==m)||b.push(b[0].slice(0)),s.push(b)}return s},t.Ry=function(e,i){e=t.bQ(e),637.100877141506>i&&(i=637.100877141506);for(var r,s=[],n=0;n<e.length;n++){var a,l,h=e[n];s.push(r=[]),r.push([h[0][0],h[0][1]]);var c=h[0][0]*o,u=h[0][1]*o;for(a=0;a<h.length-1;a++){var p=h[a+1][0]*o,d=h[a+1][1]*o;if(c!==p||u!==d){p=(d=t.EM(u,c,d,p)).azimuth;var f=(d=d.QQ)/i;if(1<f){for(l=1;l<=f-1;l++){var y=t.Tx(u,c,p,l*i);r.push([y.x,y.y])}l=t.Tx(u,c,p,(d+Math.floor(f-1)*i)/2),r.push([l.x,l.y])}u=t.Tx(u,c,p,d),r.push([u.x,u.y]),c=u.x*o,u=u.y*o}}}return{iJ:s}},t.PQ=function(i){for(var r=[],s=0;s<i.length;s++){var n=i[s];n=t.Ry(n,1e4),r.push(n)}i=[];for(var o=0;o<r.length;o++){n=r[o];var a=0;for(s=0;s<n.iJ.length;s++){var l,h=n.iJ[s],c=t.wu(e.h.construct(h[0][0],h[0][1])),u=t.wu(e.h.construct(h[h.length-1][0],h[h.length-1][1])),p=u.x*c.y-c.x*u.y;for(l=0;l<h.length-1;l++)c=t.wu(e.h.construct(h[l+1][0],h[l+1][1])),p+=(u=t.wu(e.h.construct(h[l][0],h[l][1]))).x*c.y-c.x*u.y;a+=p}a/=1,i.push(a/-2)}return i},t}(),e.cb=function(){function t(){}return t.rB=function(e,i,r,s,n,o,a){t.ZC[e.dc()]=i,0==isNaN(r)&&(t.eD[e.dc()]=r),0==isNaN(s)&&(t.rD[e.dc()]=s),0==isNaN(n)&&(t.TC[e.dc()]=n),t.fD[e.dc()]=o,null!==a&&(t.gD[e.dc()]=a)},t.Xw=function(e,i,r){t.kD[e.dc()+"-"+i.dc()]=r},t.tc=function(i){if(null==(i=t.ZC[i.dc()]))throw e.i.Fe();return i},t.bf=function(i){if(null==(i=t.eD[i.dc()]))throw e.i.Fe();return i},t.wv=function(i){if(null==(i=t.rD[i.dc()]))throw e.i.Fe();return i},t.fv=function(i){if(null==(i=t.TC[i.dc()]))throw e.i.Fe();return i},t.hh=function(i){if(null==(i=t.gD[i.dc()]))throw e.i.Fe();return e.l.construct(i[0],i[1],i[2],i[3])},t.Xc=function(i){if(null==(i=t.fD[i.dc()]))throw e.i.Fe();return i},t.Ah=function(i,r,s){if(r.Nb(s))return i;var n=t.kD[r.dc()+"-"+s.dc()];if(void 0!==n)return n(i,r,s);throw e.i.Fe()},t.vt=function(){throw e.i.Fe()},t.UQ=function(){throw e.i.Fe()},t.UV=function(){throw e.i.Fe()},t.ol=function(){throw e.i.Fe()},t.iW=function(){var t=e.Gg.create(102100),i=e.Gg.create(3857),r=e.Gg.create(4326);e.cb.rB(t,r,NaN,NaN,NaN,!1,null),e.cb.rB(r,r,1,.0033528106647474805,6378137,!0,[-180,-90,180,90]),e.cb.rB(i,r,NaN,NaN,NaN,!1,null),e.cb.Xw(t,r,s),e.cb.Xw(r,t,n),e.cb.Xw(i,r,s),e.cb.Xw(r,i,n)},t.ZC=[],t.eD=[],t.rD=[],t.TC=[],t.fD=[],t.gD=[],t.kD=[],t}()}($||($={})),$.cb.iW(),function(e){var t=function(){function t(e){this.o=new Int32Array(0),this.jo=-1,this.Jg=this.size=this.Dl=0,this.Mf=e}return t.prototype.kd=function(e){e<this.Dl?(this.o[e*this.Mf]=this.jo,this.jo=e):this.Dl--,this.size--},t.prototype.U=function(e,t){return this.o[e*this.Mf+t]},t.prototype.T=function(e,t,i){this.o[e*this.Mf+t]=i},t.prototype.De=function(){var t=this.jo;if(-1==t){if(this.Dl==this.Jg){if(2147483647<(t=0!=this.Jg?e.P.truncate(3*(this.Jg+1)/2):1)&&(t=2147483647),t==this.Jg)throw e.i.re();this.yz(t)}t=this.Dl,this.Dl++}else this.jo=this.o[t*this.Mf];this.size++;for(var i=t*this.Mf;i<t*this.Mf+this.Mf;i++)this.o[i]=-1;return t},t.prototype.Nl=function(t){var i=this.jo;if(-1==i){if(this.Dl==this.Jg){if(2147483647<(i=0!=this.Jg?e.P.truncate(3*(this.Jg+1)/2):1)&&(i=2147483647),i==this.Jg)throw e.i.re();this.yz(i)}i=this.Dl,this.Dl++}else this.jo=this.o[i*this.Mf];this.size++;for(var r=i*this.Mf,s=0;s<t.length;s++)this.o[r+s]=t[s];return i},t.prototype.nj=function(e){this.jo=-1,this.size=this.Dl=0,e&&(this.o=null,this.Jg=0)},t.prototype.Ee=function(e){e>this.Jg&&this.yz(e)},t.prototype.rx=function(e,t){e*=this.Mf,t*=this.Mf;for(var i=0;i<this.Mf;i++){var r=this.o[t+i];this.o[t+i]=this.o[e+i],this.o[e+i]=r}},t.prototype.$B=function(e,t,i){var r=this.o[this.Mf*t+i];this.o[this.Mf*t+i]=this.o[this.Mf*e+i],this.o[this.Mf*e+i]=r},t.DG=function(e){return 0<=e},t.prototype.yz=function(e){null==this.o&&(this.o=new Int32Array(0));var t=new Int32Array(this.Mf*e);t.set(this.o,0),this.o=t,this.Jg=e},t}();e.ad=t}($||($={})),function(e){var t,i;(i=t||(t={}))[i.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",i[i.enumInputModeSimplifyAlternate=4]="enumInputModeSimplifyAlternate",i[i.enumInputModeSimplifyWinding=5]="enumInputModeSimplifyWinding",i[i.enumInputModeIsSimplePolygon=7]="enumInputModeIsSimplePolygon";var r=function(){function t(t){this.Ce=t,this.zh=NaN,this.XG=new e.hg,this.YG=new e.hg,this.ns=new e.Oc,this.os=new e.Oc}return t.prototype.compare=function(e,t,i){if(e=e.ka(i),this.Ce.jB(t,this.XG),this.Ce.jB(e,this.YG),t=this.XG.get(),e=this.YG.get(),this.ns.L(t.sa,t.qa),this.os.L(e.sa,e.qa),this.ns.wa<this.os.pa)return-1;if(this.ns.pa>this.os.wa)return 1;i=t.oa==t.ma;var r=e.oa==e.ma;if(i||r){if(i&&r)return 0;if(t.oa==e.oa&&t.sa==e.sa)return i?1:-1;if(t.ma==e.ma&&t.qa==e.qa)return i?-1:1}return(i=t.Me(this.zh,this.ns.pa))==(r=e.Me(this.zh,this.os.pa))&&((r=.5*((i=Math.min(t.ma,e.ma))+this.zh))==this.zh&&(r=i),i=t.Me(r,this.ns.pa),r=e.Me(r,this.os.pa)),i<r?-1:i>r?1:0},t.prototype.TJ=function(e){this.zh=e},t}(),s=function(){function t(t){this.ib=t,this.OH=new e.hg,this.Cf=new e.h,this.qA=new e.Oc}return t.prototype.YW=function(e){this.Cf.N(e)},t.prototype.compare=function(e,t){return this.ib.jB(e.ka(t),this.OH),e=this.OH.get(),this.qA.L(e.sa,e.qa),this.Cf.x<this.qA.pa?-1:this.Cf.x>this.qA.wa?1:(e=e.Me(this.Cf.y,this.Cf.x),this.Cf.x<e?-1:this.Cf.x>e?1:0)},t}();t=function(){function t(){this.$G=this.Ei=this.Hi=this.fA=this.Zn=this.ze=this.Lc=this.kh=this.ge=null,this.Ho=this.xg=-1,this.ZG=!0,this.jA=!1,this.gA=NaN,this.Oi=new e.Nd,this.UN=2147483647,this.TN=e.P.truncate(-2147483648),this.dg=this.be=this.Jl=this.Eq=this.Em=this.Dq=this.Ps=this.Oe=-1,this.xa=0}return t.prototype.sy=function(e){this.gA=e},t.prototype.$m=function(){null==this.ge&&(this.ge=new e.ad(8));var t=this.ge.De();return this.ge.T(t,1,0),t},t.prototype.lU=function(){null==this.Lc&&(this.Lc=new e.ad(8));var t=this.Lc.De();this.Lc.T(t,2,0),this.Lc.T(t,3,0);var i=this.Lc.De();return this.Lc.T(i,2,0),this.Lc.T(i,3,0),this.BJ(t,i),this.BJ(i,t),t},t.prototype.eI=function(){null==this.ze&&(this.ze=new e.ad(8));var t=this.ze.De();return this.ze.T(t,2,0),t},t.prototype.HW=function(e,t){this.ge.T(e,7,t)},t.prototype.on=function(e,t){this.ge.T(e,2,t)},t.prototype.GW=function(e,t){this.ge.T(e,1,t)},t.prototype.ZW=function(e,t){this.ge.T(e,3,t)},t.prototype.WW=function(e,t){this.ge.T(e,4,t)},t.prototype.er=function(e,t){this.ge.T(e,5,t)},t.prototype.XQ=function(e){return this.ge.U(e,5)},t.prototype.FW=function(e,t){this.ge.T(e,6,t)},t.prototype.VM=function(e,t){this.FW(t,e)},t.prototype.AJ=function(e,t){this.Lc.T(e,1,t)},t.prototype.BJ=function(e,t){this.Lc.T(e,4,t)},t.prototype.Vl=function(e,t){this.Lc.T(e,5,t)},t.prototype.Ul=function(e,t){this.Lc.T(e,6,t)},t.prototype.NW=function(e,t){this.Lc.T(e,2,t)},t.prototype.bx=function(e,t){this.Lc.T(e,3,t)},t.prototype.DF=function(e){return this.Lc.U(e,3)},t.prototype.Gt=function(e,t){this.Lc.T(e,7,t)},t.prototype.wK=function(e,t){if(-1!=this.om(e))for(t=t?-1:e,e=this.om(e);-1!=e;e=this.ks(e))this.g.Sa(this.uj(e),this.Eq,t)},t.prototype.wx=function(e,t){-1!=e&&(this.wK(e,t),this.wK(this.ya(e),t))},t.prototype.Dt=function(e,t){this.ze.T(e,1,t)},t.prototype.Wg=function(e,t){this.ze.T(e,2,t)},t.prototype.ln=function(e,t){this.ze.T(e,3,t),this.DW(e,this.WQ(t)),this.BW(t,e)},t.prototype.BW=function(e,t){this.ze.T(e,4,t)},t.prototype.DW=function(e,t){this.ze.T(e,5,t)},t.prototype.vJ=function(e,t){this.ze.T(e,6,t)},t.prototype.tJ=function(e,t){this.ze.T(e,7,t)},t.prototype.sJ=function(e,t){this.Zn.write(e,t)},t.prototype.uJ=function(e,t){this.fA.write(e,t)},t.prototype.ZX=function(t){var i=0,r=0,s=this.sF(t),n=new e.h,o=new e.h,a=new e.h;this.Zr(s,n),o.N(n);var l=s;do{this.nm(l,a),r+=e.h.ub(o,a),this.$e(this.ya(l))!=t&&(i+=(a.x-n.x-(o.x-n.x))*(a.y-n.y+(o.y-n.y))*.5),o.N(a),l=this.kc(l)}while(l!=s);this.Zn.write(t,i),this.fA.write(t,r)},t.prototype.FU=function(t,i){var n=new r(this),o=new e.Yj;o.Ee(e.P.truncate(this.xa/2)),o.Wo(n);for(var a=new e.ja(0),l=this.ah(),h=null,c=0,u=new e.h,p=this.Oe;-1!=p;p=this.Sf(p)){if(0==(255&++c)&&null!=i&&!i.progress(-1,-1))throw e.i.OC();var d=this.Je(p);if(-1!=d){if(a.Ch(0),!this.VX(o,l,a,d)){this.D(p,u),n.TJ(u.y);var f=d;do{var y=this.Bb(f,l);-1!=y&&(o.wd(y,-1),this.Kb(f,l,-2)),f=this.kc(this.ya(f))}while(d!=f);f=d;do{-1==(y=this.Bb(f,l))&&(y=o.addElement(f,-1),a.add(y)),f=this.kc(this.ya(f))}while(d!=f)}for(d=a.size-1;0<=d;d--)y=a.get(d),f=o.ka(y),this.Kb(this.ya(f),l,y),this.EU(o,y,t)}else-1==this.Yy(p)&&(null==h&&(h=new s(this)),this.D(p,u),h.YW(u),f=o.xW(h),d=this.Jl,-1!=f&&(y=o.ka(f),this.$e(y)==this.$e(this.ya(y))&&(y=this.GF(o,f)),-1!=y&&(d=this.$e(y))),this.VM(d,p))}this.Lg(l)},t.prototype.EU=function(e,t,i){var r=e.ka(t),s=this.$e(r);if(-1==this.Hn(s)){var n=this.GF(e,t),o=this.ya(r),a=this.$e(o);this.Mp(s),this.Mp(a);var l=this.Hn(s),h=this.Hn(a);if(-1==n&&-1==l&&(a==s?(this.ln(a,this.Jl),l=h=this.Jl):(-1==h&&(this.ln(a,this.Jl),h=this.Jl),this.ln(s,a),l=a)),-1!=n){var c=this.$e(n);-1==h&&(0>=this.Mp(c)?(h=this.Hn(c),this.ln(a,h)):(this.ln(a,c),h=c),a==s&&(l=h))}-1==l&&this.WX(s,a),0==i?this.$V(e,t,r,n,s,a):5==i?this.aW(e,t,r,o,s,a):4==i&&this.ZV(r,n,s,a)}},t.prototype.$V=function(e,t,i,r,s,n){var o=this.hk(s);if(-1!=r){var a=this.hk(n),l=this.hk(this.$e(r));r=o&a&l,l^=l&this.eh(i),0!=(l|=r)&&(this.Wg(n,a|l),this.Wg(s,l|o),o=o||l)}for(t=e.lb(t);-1!=t&&(r=e.ka(t),i=this.$e(this.ya(r)),s=this.hk(i),n=this.eh(r),a=this.$e(r),r=s&(l=this.hk(a))&o,o^=o&n,0!=(o|=r));t=e.lb(t))this.Wg(i,s|o),this.Wg(a,l|o)},t.prototype.aW=function(t,i,r,s,n,o){if(n!=o){r=this.Bb(r,this.dg),r+=this.Bb(s,this.dg),s=0;var a=new e.ja(0),l=new e.ja(0);l.add(0);for(var h=t.sc(-1);h!=i;h=t.lb(h)){var c=t.ka(h),u=this.ya(c),p=this.$e(c),d=this.$e(u);if(p!=d){if(c=this.Bb(c,this.dg),s+=c+=this.Bb(u,this.dg),u=!1,0!=a.size&&a.Gc()==d&&(l.Jf(),a.Jf(),u=!0),-1==this.Hn(d))throw e.i.Ra();u&&this.Hn(d)==p||(l.add(s),a.add(p))}}s+=r,0!=a.size&&a.Gc()==o&&(l.Jf(),a.Jf()),0!=s?0==l.Gc()&&(t=this.g.ld,t=this.Ma(t),this.Wg(n,t)):0!=l.Gc()&&(t=this.g.ld,t=this.Ma(t),this.Wg(n,t))}},t.prototype.ZV=function(e,t,i,r){var s=this.Ma(this.g.ld);if(-1==t)this.Wg(r,this.Ho),0!=(1&(e=this.Bb(e,this.xg)))?this.Wg(i,s):this.Wg(i,this.Ho);else{var n=this.hk(r);0==n?(n=this.hk(this.$e(t)),this.Wg(r,n),0!=(1&(e=this.Bb(e,this.xg)))?this.Wg(i,n==s?this.Ho:s):this.Wg(i,n)):0!=(1&(e=this.Bb(e,this.xg)))?this.Wg(i,n==s?this.Ho:s):this.Wg(i,n)}},t.prototype.VX=function(e,t,i,r){var s=r,n=-1,o=-1,a=0;do{if(2==a)return!1;var l=this.Bb(s,t);if(-1!=l){if(-1!=n)return!1;n=l}else{if(-1!=o)return!1;o=s}a++,s=this.kc(this.ya(s))}while(r!=s);return-1!=o&&-1!=n&&(this.Kb(e.ka(n),t,-2),e.Tj(n,o),i.add(n),!0)},t.prototype.WX=function(e,t){var i=this.Mp(e);if(0!=i){var r=this.Mp(t);(0<i&&0>r||0>i&&0<r||-1!=(t=this.Hn(t)))&&this.ln(e,t)}},t.prototype.nP=function(t,i){this.Eq=this.g.Hd();for(var r=0,s=i.size;r<s;r++){var n=i.get(r),o=this.g.Qa(n,this.Em),a=this.g.Rf(this.g.cd(n)),l=this.g.jc(a);if(e.ba.Ic(l)){var h=this.g.V(n);if(-1!=h){var c=this.g.Qa(h,this.Em);if(o!=c){var u=this.lU(),p=this.ya(u),d=this.kh.De();this.kh.T(d,0,n),this.kh.T(d,1,-1),this.Gt(u,d),this.AJ(u,o),-1==(d=this.Je(o))?(this.on(o,u),this.Vl(u,p),this.Ul(p,u)):(o=this.ue(d),this.Vl(d,p),this.Ul(p,d),this.Ul(o,u),this.Vl(u,o)),this.AJ(p,c),-1==(o=this.Je(c))?(this.on(c,p),this.Ul(u,p),this.Vl(p,u)):(c=this.ue(o),this.Vl(o,u),this.Ul(u,o),this.Ul(c,p),this.Vl(p,c)),a=this.Ma(a),0==t?(this.Kb(p,this.be,0),this.Kb(u,this.be,1736==l?a:0)):5==t?(c=new e.h,this.g.D(n,c),n=new e.h,this.g.D(h,n),o=h=0,0>c.compare(n)?h=1:o=-1,this.Kb(p,this.be,0),this.Kb(u,this.be,0),this.Kb(u,this.dg,h),this.Kb(p,this.dg,o)):7==t?(this.Kb(p,this.be,this.Ho),this.Kb(u,this.be,1736==l?a:0)):4==t&&(this.Kb(p,this.be,0),this.Kb(u,this.be,0),this.Kb(u,this.xg,1),this.Kb(p,this.xg,1)),l=1736==l?this.TN:0,this.bx(u,a|l),this.bx(p,a|l)}}}}},t.prototype.LT=function(e,t){var i=this.om(t);if(-1!=i){var r=this.om(e);this.kh.T(i,1,r),this.Gt(e,i),this.Gt(t,-1)}e=this.ya(e),t=this.ya(t),-1!=(i=this.om(t))&&(r=this.om(e),this.kh.T(i,1,r),this.Gt(e,i),this.Gt(t,-1))},t.prototype.wX=function(t){function i(e,t){return s.zO(e,t)}var r=new e.ja(0);r.Jb(10);for(var s=this,n=this.Oe;-1!=n;n=this.Sf(n)){r.clear(!1);var o=this.Je(n);if(-1!=o){var a=o;do{r.add(a),a=this.kc(this.ya(a))}while(a!=o);if(1<r.size){if(a=!0,2<r.size)r.Wd(0,r.size,i),r.add(r.get(0));else if(0<this.yO(r.get(0),r.get(1))){var l=r.get(0);r.set(0,r.get(1)),r.set(1,l)}else a=!1;for(var h=l=r.get(0),c=this.vf(h),u=this.ya(h),p=-1,d=1,f=r.size;d<f;d++){var y=r.get(d),g=this.ya(y),m=this.jk(g);if(m==c&&y!=h){if(0==t)p=this.DF(h)|this.DF(y),this.bx(h,p),this.bx(u,p),this.Kb(h,this.be,this.Bb(h,this.be)|this.Bb(y,this.be)),this.Kb(u,this.be,this.Bb(u,this.be)|this.Bb(g,this.be));else if(-1!=this.dg)p=this.Bb(h,this.dg)+this.Bb(y,this.dg),g=this.Bb(u,this.dg)+this.Bb(g,this.dg),this.Kb(h,this.dg,p),this.Kb(u,this.dg,g);else{if(7==t)return void(this.Oi=new e.Nd(5,n,-1));-1!=this.xg&&(p=this.Bb(h,this.xg)+this.Bb(y,this.xg),g=this.Bb(u,this.xg)+this.Bb(g,this.xg),this.Kb(h,this.xg,p),this.Kb(u,this.xg,g))}this.LT(h,y),this.Fy(y),p=h,r.set(d,-1),y==l&&(r.set(0,-1),l=-1)}else this.wx(p,!1),p=-1,h=y,c=m,u=g}if(this.wx(p,!1),p=-1,a){for(l=-1,d=0,f=r.size;d<f;d++)if(-1!=(y=r.get(d)))if(-1==l)h=l=y,c=this.vf(h),u=this.ya(h);else if(y!=h&&(g=this.ya(y),m=this.jk(g),this.Ul(u,y),this.Vl(y,u),h=y,c=m,u=g,7==t&&(this.Bb(y,this.be)|this.Bb(this.ue(y),this.be))==(1|this.Ho)))return void(this.Oi=new e.Nd(5,n,-1));this.on(n,l)}else{for(l=-1,d=0,f=r.size;d<f;d++)if(-1!=(y=r.get(d))){l=y;break}o!=l&&this.on(n,l)}}}}},t.prototype.ON=function(){for(var t=-1,i=this.ah(),r=this.Oe;-1!=r;r=this.Sf(r)){var s=this.Je(r);if(-1!=s){var n=s;do{if(1!=this.Bb(n,i)){var o=this.eI();this.Dt(o,n),this.tJ(o,t),-1!=t&&this.vJ(t,o),t=o;var a=0,l=n;do{a|=this.Bb(l,this.be),this.NW(l,o),this.Kb(l,i,1),l=this.kc(l)}while(l!=n);this.Wg(o,a)}n=this.kc(this.ya(n))}while(n!=s)}}o=this.eI(),this.Dt(o,-1),this.tJ(o,t),-1!=t&&this.vJ(t,o),this.Jl=o,this.Zn=e.ce.rf(this.ze.size,NaN),this.fA=e.ce.rf(this.ze.size,NaN),this.sJ(this.Jl,1/0),this.uJ(this.Jl,1/0),this.Lg(i)},t.prototype.jR=function(e,t,i){if(-1==(t=-1!=t?t:this.Je(e)))return-1;for(e=t;;){if(1!=this.Bb(t,i))return t;if((t=this.kc(this.ya(t)))==e)return-1}},t.prototype.oW=function(){for(var e=this.ah(),t=this.Oe;-1!=t;t=this.Sf(t))for(var i=-1;;){var r=this.jR(t,i,e);if(-1==r)break;i=this.kc(this.ya(r));for(var s=r;;){var n=this.kc(s),o=this.ue(s),a=this.ya(s);if(o==a){if(this.AP(s),i!=s&&i!=a||(i=-1),s==r||o==r){if(s==(r=n)||o==r)break;s=n;continue}}else this.Kb(s,e,1);if((s=n)==r)break}}this.Lg(e)},t.prototype.GB=function(t,i,r,s,n){this.Vg(),this.ZG=n,this.g=t,this.Dq=this.g.TE(),(t=new e.ja(0)).Jb(null!=r?this.g.I(r.get(0)):this.g.gd);var o=0,a=1,l=null!=r?r.get(0):this.g.ld;for(n=1;-1!=l;){this.g.zJ(l,this.Dq,a),a<<=1;for(var h=this.g.Ob(l);-1!=h;h=this.g.Sb(h))for(var c=this.g.Ya(h),u=0,p=this.g.Ka(h);u<p;u++)t.add(c),c=this.g.V(c);e.ba.Sn(this.g.jc(l))||(o+=this.g.ea(l)),null!=r?(l=n<r.size?r.get(n):-1,n++):l=this.g.ve(l)}for(this.Ho=a,this.xa=t.size,this.g.mx(t,this.xa),null==this.kh&&(this.kh=new e.ad(2),this.ge=new e.ad(8),this.Lc=new e.ad(8),this.ze=new e.ad(8)),this.kh.Ee(this.xa),e.np.Bp(s),this.ge.Ee(this.xa+10),this.Lc.Ee(2*this.xa+32),this.ze.Ee(Math.max(32,o)),this.Em=this.g.Hd(),r=new e.h,n=0,o=new e.h,r.Sc(),a=0;a<=this.xa;a++)if(a<this.xa?(c=t.get(a),this.g.D(c,o)):o.Sc(),!r.rb(o)){if(n<a){for(c=this.$m(),p=u=-1;n<a;n++)p=t.get(n),this.g.Sa(p,this.Em,c),l=this.kh.De(),this.kh.T(l,0,p),this.kh.T(l,1,u),u=l,h=this.g.cd(p),l=this.g.Rf(h),l=this.Ma(l),this.GW(c,this.yd(c)|l);this.HW(c,u),this.er(c,this.g.Va(p)),-1!=this.Ps&&this.WW(this.Ps,c),this.ZW(c,this.Ps),this.Ps=c,-1==this.Oe&&(this.Oe=c)}n=a,r.N(o)}e.np.Bp(s),this.be=this.ah(),5==i&&(this.dg=this.ah()),4==i&&(this.xg=this.ah()),this.nP(i,t),0==this.Oi.Kj&&(this.wX(i),0==this.Oi.Kj&&(isNaN(this.gA)||this.pO()?(this.ON(),0==this.Oi.Kj&&(this.Lg(this.be),this.be=-1,this.ZG&&this.FU(i,s))):this.jA=!0))},t.prototype.Fy=function(e){var t=this.kc(e),i=this.ue(e),r=this.ya(e),s=this.kc(r),n=this.ue(r);t!=r&&(this.Ul(n,t),this.Vl(t,n)),i!=r&&(this.Ul(i,s),this.Vl(s,i)),i=this.jk(e),this.Je(i)==e&&(s!=e?this.on(i,s):this.on(i,-1)),s=this.jk(r),this.Je(s)==r&&(t!=r?this.on(s,t):this.on(s,-1)),this.Lc.kd(e),this.Lc.kd(r)},t.prototype.GF=function(e,t){for(;;){if(-1==(t=e.xe(t)))return-1;var i=e.ka(t);if(this.$e(i)!=this.$e(this.ya(i)))return i}},t.prototype.fr=function(e,t){var i;void 0===i&&(i=!0),this.GB(e,0,null,t,i)},t.prototype.nJ=function(t,i,r){var s=new e.ja(0);s.add(i),this.GB(t,4,s,r,1736==t.jc(i))},t.prototype.oJ=function(t,i,r){var s=new e.ja(0);s.add(i),this.GB(t,5,s,r,!0)},t.prototype.Vg=function(){null!=this.g&&(-1!=this.Dq&&(this.g.nW(this.Dq),this.Dq=-1),-1!=this.Em&&(this.g.Ud(this.Em),this.Em=-1),-1!=this.Eq&&(this.g.Ud(this.Eq),this.Eq=-1),-1!=this.be&&(this.Lg(this.be),this.be=-1),-1!=this.dg&&(this.Lg(this.dg),this.dg=-1),-1!=this.xg&&(this.Lg(this.xg),this.xg=-1),this.g=null,this.ge.nj(!0),this.kh.nj(!0),this.Ps=this.Oe=-1,null!=this.Lc&&this.Lc.nj(!0),null!=this.Hi&&(this.Hi.length=0),null!=this.Ei&&(this.Ei.length=0),null!=this.$G&&(this.$G.length=0),null!=this.ze&&this.ze.nj(!0),this.Jl=-1,this.Zn=null)},t.prototype.Je=function(e){return this.ge.U(e,2)},t.prototype.D=function(e,t){this.g.WF(this.XQ(e),t)},t.prototype.yd=function(e){return this.ge.U(e,1)},t.prototype.Sf=function(e){return this.ge.U(e,4)},t.prototype.Yy=function(e){return this.ge.U(e,6)},t.prototype.mm=function(e){return this.ge.U(e,7)},t.prototype.ks=function(e){return this.kh.U(e,1)},t.prototype.uj=function(e){return this.kh.U(e,0)},t.prototype.ng=function(e,t){return(t=this.Ei[t]).size<=e?-1:t.read(e)},t.prototype.pn=function(e,t,i){(t=this.Ei[t]).size<=e&&t.resize(this.ge.size,-1),t.write(e,i)},t.prototype.Fp=function(){null==this.Ei&&(this.Ei=[]);for(var t=e.ja.rf(this.ge.Jg,-1),i=0,r=this.Ei.length;i<r;i++)if(null==this.Ei[i])return this.Ei[i]=t,i;return this.Ei.push(t),this.Ei.length-1},t.prototype.Gp=function(e){this.Ei[e]=null},t.prototype.jk=function(e){return this.Lc.U(e,1)},t.prototype.vf=function(e){return this.jk(this.ya(e))},t.prototype.ya=function(e){return this.Lc.U(e,4)},t.prototype.ue=function(e){return this.Lc.U(e,5)},t.prototype.kc=function(e){return this.Lc.U(e,6)},t.prototype.$e=function(e){return this.Lc.U(e,2)},t.prototype.af=function(e){return this.hk(this.Lc.U(e,2))},t.prototype.om=function(e){return this.Lc.U(e,7)},t.prototype.Zr=function(e,t){this.D(this.jk(e),t)},t.prototype.nm=function(e,t){this.D(this.vf(e),t)},t.prototype.eh=function(e){return this.Lc.U(e,3)&this.UN},t.prototype.Bb=function(e,t){return(t=this.Hi[t]).size<=e?-1:t.read(e)},t.prototype.Kb=function(e,t,i){(t=this.Hi[t]).size<=e&&t.resize(this.Lc.size,-1),t.write(e,i)},t.prototype.ah=function(){null==this.Hi&&(this.Hi=[]);for(var t=e.ja.rf(this.Lc.Jg,-1),i=0,r=this.Hi.length;i<r;i++)if(null==this.Hi[i])return this.Hi[i]=t,i;return this.Hi.push(t),this.Hi.length-1},t.prototype.Lg=function(e){this.Hi[e]=null},t.prototype.AP=function(e){var t=this.$e(e),i=this.ya(e),r=this.kc(e);r==i&&(r=this.kc(r))==e&&(r=-1);var s=this.sF(t);s!==e&&s!=i||this.Dt(t,r),i=this.Zn.read(t),isNaN(i)||(this.sJ(t,NaN),this.uJ(t,NaN)),this.wx(e,!0),this.Fy(e)},t.prototype.BP=function(e){for(var t=0,i=e.size;t<i;t++){var r=e.get(t),s=this.$e(this.ya(r));this.Dt(this.$e(r),-1),this.Dt(s,-1),this.wx(r,!0),this.Fy(r)}},t.prototype.sF=function(e){return this.ze.U(e,1)},t.prototype.hk=function(e){return this.ze.U(e,2)},t.prototype.Hn=function(e){return this.ze.U(e,3)},t.prototype.WQ=function(e){return this.ze.U(e,4)},t.prototype.Mp=function(e){var t=this.Zn.read(e);return isNaN(t)&&(this.ZX(e),t=this.Zn.read(e)),t},t.prototype.Ma=function(e){return this.g.CF(e,this.Dq)},t.prototype.Ie=function(e){return this.g.Qa(e,this.Em)},t.prototype.lR=function(e){return this.g.Qa(e,this.Eq)},t.prototype.kR=function(e,t){var i=this.Je(e);if(-1==i)return-1;var r=i,s=-1,n=-1;do{if(this.vf(r)==t)return r;if(-1==s){if(-1==(s=this.Je(t)))break;n=s}if(this.vf(n)==e)return this.ya(n);r=this.kc(this.ya(r)),n=this.kc(this.ya(n))}while(r!=i&&n!=s);return-1},t.prototype.jB=function(t,i){i.Pr(),i=i.get();var r=new e.h;this.Zr(t,r),i.Ec(r),this.nm(t,r),i.Rc(r)},t.prototype.zO=function(t,i){if(t==i)return 0;var r=new e.h;this.nm(t,r);var s=new e.h;return this.nm(i,s),r.rb(s)?0:(i=new e.h,this.Zr(t,i),(t=new e.h).vc(r,i),(r=new e.h).vc(s,i),e.h.ou(t,r))},t.prototype.yO=function(t,i){if(t==i)return 0;var r=new e.h;this.nm(t,r);var s=new e.h;return this.nm(i,s),r.rb(s)?0:(i=new e.h,this.Zr(t,i),(t=new e.h).vc(r,i),(r=new e.h).vc(s,i),0<=r.y&&0<t.y?e.h.ou(t,r):0)},t.prototype.pO=function(){for(var t=e.mc.nx(this.gA),i=new e.h,r=new e.h,s=new e.h,n=new e.h,o=new e.h,a=this.Oe;-1!=a;a=this.Sf(a)){var l=this.Je(a);if(-1!=l){var h=l;this.Zr(h,i),this.nm(h,r),o.vc(r,i);var c=o.Sk();do{var u=h;if((h=this.kc(this.ya(h)))!=u){this.nm(h,s),n.vc(s,i),u=n.Sk();var p=n.xi(o);if(p*p/(u*c)*Math.min(u,c)<=t)return!1;o.N(n),c=u,r.N(s)}}while(h!=l)}}return!0},t}(),e.ju=t}($||($={})),function(e){var t=function(){function t(){this.j=null,this.gH=new e.h,this.hH=new e.h,this.Hj=null,this.Nv=!1,this.vl=-1}return t.prototype.cf=function(e){return e<this.Hj.length&&this.Hj[e]},t.prototype.el=function(t,i,r,s){var n=e.ba.uf(this.j.g.jc(r));if(2!=e.ba.uf(this.j.g.jc(i))||1!=n)throw e.i.Ra();this.xP(t,i,r,s)},t.prototype.fr=function(t,i){null==this.j&&(this.j=new e.ju),this.j.fr(t,i)},t.prototype.Ft=function(t,i,r){for(e.Tk.W(t,i,r,!0),i=t.ld;-1!=i;i=t.ve(i))1736==t.jc(i)&&e.tn.W(t,i,-1,this.Nv,r);this.fr(t,r)},t.prototype.EE=function(e,t,i,r,s){var n=this.j.g;if(1736==n.jc(e))for(e=n.Ob(e);-1!=e;e=n.Sb(e)){var o=n.Ya(e);this.j.Ie(o),this.j.Ie(n.V(o));var a=this.j.lR(o);if(-1!=a){var l=this.j.Bb(a,i);if(1!=l&&2!=l)if(this.cf(this.j.af(a))){this.j.Kb(a,i,1),l=n.wf(t,-1);var h=a,c=this.j.Ie(o),u=1;do{var p=this.um(o,s);n.jj(l,p),-1!=r&&this.j.pn(c,r,1),this.j.Kb(h,i,1),h=this.j.kc(h);do{var d=-1!=(p=1==u?n.V(o):n.Na(o))?this.j.Ie(p):-1}while(d==c);var f=this.j.jk(h);if(f!=d){do{d=-1!=(p=1==u?n.Na(o):n.V(o))?this.j.Ie(p):-1}while(d==c);f!=d?(d=f,p=this.j.uj(this.j.mm(d))):u=-u}c=d,o=p}while(h!=a);n.mn(l,!0)}else this.j.Kb(a,i,2)}}},t.prototype.XE=function(){for(var t=this.j.ah(),i=new e.ja(0),r=this.j.Oe;-1!=r;r=this.j.Sf(r)){var s=this.j.Je(r),n=s;if(-1!=s)do{if(1!=this.j.Bb(n,t)){var o=this.j.ya(n);this.j.Kb(o,t,1),this.j.Kb(n,t,1),this.cf(this.j.af(n))&&this.cf(this.j.af(o))&&i.add(n)}n=this.j.kc(this.j.ya(n))}while(n!=s)}this.j.Lg(t),this.j.BP(i)},t.prototype.um=function(e,t){return-1==t?e:this.SR(e,t)},t.prototype.SR=function(e,t){var i=this.j.g,r=this.j.mm(this.j.Ie(e));do{var s=this.j.uj(r);if(i.Rf(i.cd(s))==t)return s;r=this.j.ks(r)}while(-1!=r);return e},t.prototype.Pt=function(t,i,r){this.XE();var s=this.j.g,n=s.Kg(1736),o=this.j.ah();return this.mK(t,i,n,r,o,-1),this.j.Lg(o),e.tn.W(s,n,1,this.Nv,null),n},t.prototype.mK=function(e,t,i,r,s,n){for(this.EE(e,i,s,n,r),-1!=t&&this.EE(t,i,s,n,r),e=this.j.g,t=this.j.Oe;-1!=t;t=this.j.Sf(t)){var o=this.j.Je(t);if(-1!=o){var a=o;do{var l=this.j.Bb(a,s);if(1!=l&&2!=l)if(this.cf(this.j.af(a))){l=e.wf(i,-1);var h=a;do{var c=this.j.om(h);-1!=c?c=this.j.uj(c):(c=this.j.uj(this.j.om(this.j.ya(h))),c=this.j.g.V(c)),c=this.um(c,r),e.jj(l,c),this.j.Kb(h,s,1),-1!=n&&(c=this.j.Ie(c),this.j.pn(c,n,1)),h=this.j.kc(h)}while(h!=a);e.mn(l,!0)}else this.j.Kb(a,s,2);a=this.j.kc(this.j.ya(a))}while(a!=o)}}},t.prototype.PX=function(t,i,r){var s=this.j.g,n=s.Kg(1736),o=s.Kg(1607),a=s.Kg(550);this.XE();var l=-1,h=this.j.ah(),c=this.j.Fp();for(this.mK(t,i,n,r,h,c),t=this.j.Oe;-1!=t;t=this.j.Sf(t))if(-1!=(i=this.j.Je(t))){var u=i;do{var p=this.j.Bb(u,h),d=this.j.Bb(this.j.ya(u),h);if(2==(p|=d))if(p=this.j.eh(u),this.cf(p)){var f=s.wf(o,-1),y=u;p=this.Zw(t,s),p=this.um(p,r),s.jj(f,p),this.j.pn(t,c,1);do{if(p=this.j.vf(y),d=this.Zw(p,s),d=this.um(d,r),s.jj(f,d),this.j.Kb(y,h,1),this.j.Kb(this.j.ya(y),h,1),this.j.pn(p,c,1),y=this.j.kc(y),p=this.j.Bb(y,h),2!=(p|=d=this.j.Bb(this.j.ya(y),h)))break;if(p=this.j.eh(y),!this.cf(p)){this.j.Kb(y,h,1),this.j.Kb(this.j.ya(y),h,1);break}}while(y!=u)}else this.j.Kb(u,h,1),this.j.Kb(this.j.ya(u),h,1);u=this.j.kc(this.j.ya(u))}while(u!=i)}for(t=this.j.Oe;-1!=t;t=this.j.Sf(t))1!=(p=this.j.ng(t,c))&&(p=this.j.yd(t),this.cf(p)&&(-1==l&&(l=s.wf(a,-1)),-1!=(i=this.j.mm(t))&&(i=this.j.uj(i),p=this.um(i,r),s.jj(l,p))));return this.j.Gp(c),this.j.Lg(h),e.tn.W(s,n,1,this.Nv,null),(r=[])[0]=a,r[1]=o,r[2]=n,r},t.prototype.Zw=function(e,t){var i=-1;for(e=this.j.mm(e);-1!=e;e=this.j.ks(e)){var r=this.j.uj(e);-1==i&&(i=r);var s=this.j.Ma(t.Rf(t.cd(r)));if(this.cf(s)){i=r;break}}return i},t.prototype.fB=function(t,i){for(var r=this.ll(i),s=this.j.jk(i),n=this.j.vf(i),o=0,a=0,l=this.j.mm(s);-1!=l;l=this.j.ks(l)){var h=this.j.uj(l),c=t.cd(h),u=this.j.Ma(t.Rf(c));c=t.Ya(c),(u=0!=(u&r))&&c==h&&(this.vl=i);var p=t.V(h);-1!=p&&this.j.Ie(p)==n?(o++,u&&(-1===this.vl&&c==p&&(h=this.j.kc(i),this.cf(this.ll(h))&&(this.vl=h)),a++)):-1!=(h=t.Na(h))&&this.j.Ie(h)==n&&(o--,u&&(-1===this.vl&&c===h&&(h=this.j.kc(i),this.cf(this.ll(h))&&(this.vl=h)),a--))}return this.j.D(s,this.gH),this.j.D(n,this.hH),(0!=a?a:o)*e.h.ub(this.gH,this.hH)},t.prototype.ll=function(e){return this.j.eh(e)|this.j.af(e)|this.j.af(this.j.ya(e))},t.prototype.pK=function(e){for(var t=this.j.ya(this.j.ue(e)),i=-1;t!=e;){if(this.cf(this.ll(t))){if(-1!=i)return-1;i=t}t=this.j.ya(this.j.ue(t))}return-1!=i?this.j.ya(i):-1},t.prototype.qK=function(e){for(var t=this.j.ya(this.j.kc(e)),i=-1;t!=e;){if(this.cf(this.ll(t))){if(-1!=i)return-1;i=t}t=this.j.ya(this.j.kc(t))}return-1!=i?this.j.ya(i):-1},t.prototype.eJ=function(t,i,r,s,n){var o=this.j.g,a=t,l=this.j.ya(a);this.j.Kb(a,r,1),this.j.Kb(l,r,1),this.vl=-1;for(var h=this.fB(o,a),c=a,u=-1,p=!1,d=1;;){var f=this.j.ue(a);if(f==l)break;if(l=this.j.kc(l),this.j.ya(f)!=l){if(-1==(a=this.pK(a))){p=!0;break}l=this.j.ya(a)}else a=f;if(a==t){u=t;break}if(f=this.ll(a),!this.cf(f))break;this.j.Kb(a,r,1),this.j.Kb(l,r,1),c=a,h+=this.fB(o,a),d++}if(-1==u)for(a=t,l=this.j.ya(a),u=a;(t=this.j.kc(a))!=l;){if(l=this.j.ue(l),this.j.ya(t)!=l){if(-1==(a=this.qK(a))){p=!0;break}l=this.j.ya(a)}else a=t;if(f=this.ll(a),!this.cf(f))break;this.j.Kb(a,r,1),this.j.Kb(l,r,1),u=a,h+=this.fB(o,a),d++}else if(-1!=this.vl&&(c=this.vl,u=this.j.ue(this.vl),this.j.ya(u)!=this.j.kc(this.j.ya(c))&&-1==(u=this.pK(c))))throw e.i.Ra();for(0<=h||(a=u,u=this.j.ya(c),c=this.j.ya(a)),r=o.wf(i,-1),a=c,c=this.j.jk(c),p=this.j.vf(u)==c&&p,h=this.Zw(c,o),h=this.um(h,n),o.jj(r,h),-1!=s&&this.j.pn(c,s,1),c=0,d=p?e.P.truncate((d+1)/2):-1;t=this.j.vf(a),h=this.Zw(t,o),h=this.um(h,n),o.jj(r,h),c++,-1!=s&&this.j.pn(t,s,1),p&&c==d&&(r=o.wf(i,-1),o.jj(r,h)),a!=u;)if(t=this.j.kc(a),this.j.ue(this.j.ya(a))!=this.j.ya(t)){if(-1==(a=this.qK(a)))throw e.i.Ra()}else a=t},t.prototype.Qt=function(e){for(var t=this.j.g.Kg(1607),i=this.j.ah(),r=this.j.Oe;-1!=r;r=this.j.Sf(r)){var s=this.j.Je(r),n=s;do{1!=this.j.Bb(n,i)&&this.cf(this.ll(n))&&this.eJ(n,t,i,-1,e),n=this.j.kc(this.j.ya(n))}while(n!=s)}return this.j.Lg(i),t},t.prototype.QX=function(e){for(var t=this.j.g,i=t.Kg(1607),r=t.Kg(550),s=this.j.ah(),n=this.j.Fp(),o=-1,a=this.j.Oe;-1!=a;a=this.j.Sf(a)){var l=this.j.Je(a),h=l;do{var c=this.j.Bb(h,s);1!=c&&(c=this.ll(h),this.cf(c)&&this.eJ(h,i,s,n,e)),h=this.j.kc(this.j.ya(h))}while(h!=l)}for(a=this.j.Oe;-1!=a;a=this.j.Sf(a))1!=(c=this.j.ng(a,n))&&(c=this.j.yd(a),this.cf(c)&&(-1==o&&(o=t.wf(r,-1)),-1!=(l=this.j.mm(a))&&(l=this.j.uj(l),l=this.um(l,e),t.jj(o,l))));return this.j.Lg(s),this.j.Gp(n),(e=[])[0]=r,e[1]=i,e},t.prototype.pr=function(){for(var e=this.j.g,t=e.Kg(550),i=e.wf(t,-1),r=this.j.Oe;-1!=r;r=this.j.Sf(r))if(this.cf(this.j.yd(r))){for(var s=-1,n=this.j.mm(r);-1!=n;n=this.j.ks(n)){var o=this.j.uj(n);-1==s&&(s=o);var a=this.j.Ma(e.Rf(e.cd(o)));if(this.cf(a)){s=o;break}}e.jj(i,s)}return t},t.prototype.eq=function(e){this.Hj=[];for(var t=0;t<e;t++)this.Hj[t]=!1},t.RV=function(t,i,r){var s=t.Ja(),n=Array(1e3);e.P.av(n,null);var o=e.P.lg(1e3,0),a=t.I(),l=!0,h=2==i.Eb();if(1!=i.Eb()&&2!=i.Eb())throw e.i.Ra();for(var c=0;c<a;){var u=e.P.truncate(t.bW(n,c)-c);h?e.jd.kK(i,n,u,r,o):e.jd.lK(i,n,u,r,o);for(var p=0,d=0;d<u;d++)0==o[d]&&(l&&(l=!1,s.Gd(t,0,c)),p!=d&&s.Gd(t,c+p,c+d),p=d+1);l||p==u||s.Gd(t,c+p,c+u),c+=u}return l?t:s},t.rG=function(i,r,s){return i instanceof e.de?t.RV(i,r,s):r instanceof e.Ta?i.B()||r.B()?i.Ja():e.Tk.pU(s,i,r)?e.Tk.uO(i,r):i.Ja():t.SV(i,r,s)},t.Bv=function(i,r,s,n){var o=new e.l;i.A(o);var a=new e.l;r.A(a);var l=new e.l;if(l.L(o),l.$b(a),s=e.ta.Xd(s,l,!0),(l=new e.l).L(a),a=e.ta.Gr(s),l.X(a,a),!o.isIntersecting(l)){if(i.Eb()<=r.Eb())return t.li(t.Ue(i.Ja()),i,"&");if(i.Eb()>r.Eb())return t.li(t.Ue(r.Ja()),i,"&")}return a=new t,l=(o=new e.hd).Ib(t.Ue(i)),r=o.Ib(t.Ue(r)),a.Ft(o,s,n),n=a.Bv(l,r),i=t.li(o.Ke(n),i,"&"),e.ba.Ic(i.K())&&(i.Dh(2,s),1736==i.K()&&i.hm()),i},t.SV=function(t,i,r){if(t.B()||i.B())return t.Ja();var s=[null],n=[0],o=2==i.Eb();if(1!=i.Eb()&&2!=i.Eb())throw e.i.Ra();return s[0]=t.D(),o?e.jd.kK(i,s,1,r,n):e.jd.lK(i,s,1,r,n),0==n[0]?t.Ja():t},t.prototype.BU=function(t,i,r,s,n){if(t.B())return t;var o=new e.hd;return t=o.Ib(t),this.Mk(o,t,i,r,s,n)},t.prototype.DU=function(t,i,r,s,n,o){if(n&&550!=t.jc(i)){var a=new e.JC;a.HX(t,r),a.Og?(e.Tk.W(t,r,o,!0),n=!1):this.j.sy(r)}else e.Tk.W(t,r,o,!0),n=!1;if(s&&550!=t.jc(i)?this.j.oJ(t,i,o):this.j.nJ(t,i,o),this.j.jA)return this.j.Vg(),this.j=null,this.Mk(t,i,r,s,!1,o);if(this.j.sy(NaN),o=this.j.Ma(i),this.eq(o+1),this.Hj[o]=!0,1736==t.jc(i)||s&&550!=t.jc(i))return t.Zo(i,0),i=this.Pt(i,-1,-1),(t=t.Ke(i)).Zo(0),n?t.Dh(1,0):(t.Dh(2,r),t.hm()),t;if(1607==t.jc(i))return i=this.Qt(-1),t=t.Ke(i),n||t.Dh(2,r),t;if(550==t.jc(i))return i=this.pr(),t=t.Ke(i),n||t.Dh(2,r),t;throw e.i.Ra()},t.prototype.Mk=function(t,i,r,s,n,o){this.j=new e.ju;try{return this.DU(t,i,r,s,n,o)}finally{this.j.Vg()}},t.Mk=function(e,i,r,s,n){return(new t).BU(e,i,r,s,n)},t.prototype.CU=function(t,i,r,s){this.Nv=t,this.j=new e.ju,t=i.Jn(r);var n=i.jc(r);if(1!=t||550==n?this.j.nJ(i,r,s):this.j.oJ(i,r,s),!this.j.jA)if(this.j.sy(NaN),s=this.j.Ma(r),this.eq(s+1),this.Hj[s]=!0,1736==i.jc(r)||1==t&&550!=i.jc(r))i.Zo(r,0),s=this.Pt(r,-1,-1),i.aC(s,r),i.vB(s);else if(1607==i.jc(r))s=this.Qt(-1),i.aC(s,r),i.vB(s);else{if(550!=i.jc(r))throw e.i.ga("internal error");s=this.pr(),i.aC(s,r),i.vB(s)}},t.prototype.km=function(t,i){var r=e.ba.uf(this.j.g.jc(t)),s=e.ba.uf(this.j.g.jc(i));if(r>s)return t;var n=this.j.Ma(t),o=this.j.Ma(i);if(this.eq(1+(n|o)),this.Hj[this.j.Ma(t)]=!0,2==r&&2==s)return this.Pt(t,i,-1);if(1==r&&2==s||1==r&&1==s)return this.Qt(-1);if(0==r)return this.pr();throw e.i.Ra()},t.prototype.Bv=function(t,i){var r=e.ba.uf(this.j.g.jc(t)),s=e.ba.uf(this.j.g.jc(i)),n=this.j.Ma(t),o=this.j.Ma(i);if(this.eq(1+(n|o)),this.Hj[this.j.Ma(t)|this.j.Ma(i)]=!0,n=-1,1<this.j.g.ht.Ba&&(n=t),2==r&&2==s)return this.Pt(t,i,n);if(1==r&&0<s||1==s&&0<r)return this.Qt(n);if(0==r||0==s)return this.pr();throw e.i.Ra()},t.prototype.Kz=function(t,i){var r=e.ba.uf(this.j.g.jc(t)),s=e.ba.uf(this.j.g.jc(i)),n=this.j.Ma(t),o=this.j.Ma(i);if(this.eq(1+(n|o)),this.Hj[this.j.Ma(t)|this.j.Ma(i)]=!0,n=-1,1<this.j.g.ht.Ba&&(n=t),2==r&&2==s)return this.PX(t,i,n);if(1==r&&0<s||1==s&&0<r)return this.QX(n);if(0==r||0==s)return(t=[])[0]=this.pr(),t;throw e.i.Ra()},t.prototype.fp=function(t,i){var r=e.ba.uf(this.j.g.jc(t)),s=e.ba.uf(this.j.g.jc(i)),n=this.j.Ma(t),o=this.j.Ma(i);if(this.eq(1+(n|o)),this.Hj[this.j.Ma(t)]=!0,this.Hj[this.j.Ma(i)]=!0,2==r&&2==s)return this.Pt(t,i,-1);if(1==r&&1==s)return this.Qt(-1);if(0==r&&0==s)return this.pr();throw e.i.Ra()},t.Ue=function(t){var i=t.K();return 197==i?(i=new e.Ea(t.description),t.B()||i.bd(t,!1),i):33==i?(i=new e.de(t.description),t.B()||i.add(t),i):322==i?(i=new e.Ua(t.description),t.B()||i.oc(t,!0),i):t},t.li=function(t,i,r){var s=t.K();return 197==s?(i=new e.Ea(t.description),t.B()||i.bd(t,!1),i):33!=s||"|"!=r&&"^"!=r?322==s?(i=new e.Ua(t.description),t.B()||i.oc(t,!0),i):33==s&&"-"==r&&33==i.K()||550==s&&"&"==r&&33==i.K()?(i=new e.Ta(t.description),t.B()||t.we(0,i),i):t:(i=new e.de(t.description),t.B()||i.add(t),i)},t.km=function(i,r,s,n){if(i.B()||r.B()||i.Eb()>r.Eb())return t.li(t.Ue(i),i,"-");var o=new e.l;i.A(o);var a=new e.l;if(r.A(a),!o.isIntersecting(a))return t.li(t.Ue(i),i,"-");var l=new e.l;return l.L(o),l.$b(a),s=e.ta.Xd(s,l,!0),a=new t,l=(o=new e.hd).Ib(t.Ue(i)),r=o.Ib(t.Ue(r)),a.Ft(o,s,n),n=a.km(l,r),n=o.Ke(n),i=t.li(n,i,"-"),e.ba.Ic(i.K())&&(i.Dh(2,s),1736==i.K()&&i.hm()),i},t.NP=function(i,r,s){if(2>i.length)throw e.i.O("not enough geometries to dissolve");for(var n=0,o=0,a=i.length;o<a;o++)n=Math.max(i[o].Eb(),n);var l=new e.l;l.Pa();var h=new e.hd,c=-1,u=0,p=-1;for(o=0,a=i.length;o<a;o++)if(i[o].Eb()==n)if(i[o].B())-1==p&&(p=o);else{p=o,-1==c?c=h.Ib(t.Ue(i[o])):h.mN(c,t.Ue(i[o]));var d=new e.l;i[o].yc(d),l.$b(d),u++}return 2>u?t.Ue(i[p]):(i=2==n,r=e.ta.Xd(0==n?r:null,l,!0),(new t).Mk(h,c,r,i,!0,s))},t.Kz=function(i,r,s,n){var o=[null,null,null],a=new e.l;i.A(a);var l=new e.l;r.A(l);var h=new e.l;if(h.L(a),h.$b(l),s=e.ta.Xd(s,h,!0),(h=new e.l).L(l),l=e.ta.Gr(s),h.X(l,l),!a.isIntersecting(h)){if(i.Eb()<=r.Eb())return o[(i=t.li(t.Ue(i.Ja()),i,"&")).Eb()]=i,o;if(i.Eb()>r.Eb())return o[(i=t.li(t.Ue(r.Ja()),i,"&")).Eb()]=i,o}for(l=new t,h=(a=new e.hd).Ib(t.Ue(i)),r=a.Ib(t.Ue(r)),l.Ft(a,s,n),n=l.Kz(h,r),r=0;r<n.length;r++)l=t.li(a.Ke(n[r]),i,"&"),e.ba.Ic(l.K())&&(l.Dh(2,s),1736==l.K()&&l.hm()),o[l.Eb()]=l;return o},t.fp=function(i,r,s,n){if(i.Eb()>r.Eb())return t.li(t.Ue(i),i,"^");if(i.Eb()<r.Eb()||i.B())return t.li(t.Ue(r),i,"^");if(r.B())return t.li(t.Ue(i),i,"^");var o=new e.l;i.A(o);var a=new e.l;r.A(a);var l=new e.l;return l.L(o),l.$b(a),s=e.ta.Xd(s,l,!0),a=new t,l=(o=new e.hd).Ib(t.Ue(i)),r=o.Ib(t.Ue(r)),a.Ft(o,s,n),n=a.fp(l,r),i=t.li(o.Ke(n),i,"^"),e.ba.Ic(i.K())&&(i.Dh(2,s),1736==i.K()&&i.hm()),i},t.prototype.DQ=function(e,t){var i=this.j.g;e=i.wf(e,-1);for(var r=t.size,s=0;s<r;s++){var n=t.get(s);i.jj(e,n)}i.mn(e,!0)},t.prototype.OW=function(e,t){for(var i=this.j.g,r=i.ld;-1!=r;r=i.ve(r))if(r==t)for(var s=i.Ob(r);-1!=s;s=i.Sb(s)){var n=i.Ya(s);if(-1!=n)for(var o=i.V(n);-1!=o;){n=this.j.Ie(n);var a=this.j.Ie(o);-1!=(n=this.j.kR(n,a))&&(a=this.j.ya(n),this.j.Kb(n,e,1),this.j.Kb(a,e,2)),n=o,o=i.V(n)}}},t.prototype.TV=function(t,i,r,s){r=this.j.Ma(r),s=this.j.Ma(s);var n=new e.ja(0);n.Jb(256);for(var o=this.j.g,a=this.j.ah(),l=this.j.Oe;-1!=l;l=this.j.Sf(l)){var h=this.j.Je(l);if(-1!=h){var c=h;do{if(1!=this.j.Bb(c,a)){var u=c,p=c,d=!1,f=0;do{if(this.j.Kb(u,a,1),!d){var y=this.j.eh(u);0!=(y&s)&&0!=(this.j.af(u)&r)&&(p=u,d=!0)}d&&(n.add(this.j.uj(this.j.mm(this.j.jk(u)))),-1!=t&&0!=((y=this.j.eh(u))&s)&&(f|=y=this.j.Bb(u,t))),u=this.j.kc(u)}while(u!=p);d&&0<this.j.Mp(this.j.$e(p))&&(u=o.Kg(1736),this.DQ(u,n),-1!=i&&o.zJ(u,i,f)),n.clear(!1)}c=this.j.kc(this.j.ya(c))}while(c!=h)}}this.j.Lg(a)},t.prototype.xP=function(e,t,i,r){this.j.oW();var s=-1;-1!=e&&(s=this.j.ah(),this.OW(s,i)),this.TV(s,e,t,i),-1!=s&&(this.j.Lg(s),s=-1);var n=this.j.g;for(e=0,s=n.ld;-1!=s;s=n.ve(s))s!=t&&s!=i&&(r.add(s),e++);r.Wd(0,e,(function(e,t){return(e=n.qz(n.Ob(e)))<(t=n.qz(n.Ob(t)))?-1:e==t?0:1}))},t.prototype.Vg=function(){null!=this.j&&(this.j.Vg(),this.j=null)},t}();e.Hg=t}($||($={})),function(e){var t=function(){function t(e){void 0!==e?this.It(e):this.KB()}return t.prototype.kx=function(){this.Qb=this.Lb=this.qb=this.jb=this.bb=this.eb=0},t.prototype.Nb=function(e){return this==e||e instanceof t&&this.eb==e.eb&&this.jb==e.jb&&this.Lb==e.Lb&&this.qb==e.qb&&this.bb==e.bb&&this.Qb==e.Qb},t.prototype.dc=function(){return e.P.vj(),e.P.vj(),e.P.vj(),e.P.vj(),e.P.vj(),e.P.vj()},t.prototype.Fh=function(e,t){var i=this.qb*e.x+this.bb*e.y+this.Qb;t.x=this.eb*e.x+this.jb*e.y+this.Lb,t.y=i},t.prototype.TX=function(t,i,r){for(var s=0;s<i;s++){var n=t[s].x,o=t[s].y,a=this.eb*n+this.jb*o+this.Lb;n=this.qb*n+this.bb*o+this.Qb,null!=r[s]?r[s].na(a,n):r[s]=e.h.construct(a,n)}},t.prototype.multiply=function(e){t.multiply(this,e,this)},t.multiply=function(e,t,i){var r=e.eb*t.eb+e.qb*t.jb,s=e.jb*t.eb+e.bb*t.jb,n=e.Lb*t.eb+e.Qb*t.jb+t.Lb,o=e.eb*t.qb+e.qb*t.bb,a=e.jb*t.qb+e.bb*t.bb;e=e.Lb*t.qb+e.Qb*t.bb+t.Qb,i.eb=r,i.jb=s,i.Lb=n,i.qb=o,i.bb=a,i.Qb=e},t.prototype.Pf=function(){var e=new t;return e.eb=this.eb,e.jb=this.jb,e.Lb=this.Lb,e.qb=this.qb,e.bb=this.bb,e.Qb=this.Qb,e},t.prototype.fC=function(t){if(!t.B()){for(var i=[],r=0;4>r;r++)i[r]=new e.h;t.hB(i),this.UX(i,i),t.ax(i,4)}},t.prototype.UX=function(t,i){for(var r=0;r<t.length;r++){var s=new e.h,n=t[r];s.x=this.eb*n.x+this.jb*n.y+this.Lb,s.y=this.qb*n.x+this.bb*n.y+this.Qb,i[r]=s}},t.prototype.gS=function(e,t){e.B()||t.B()||0==e.S()||0==e.da()?this.kx():(this.jb=this.qb=0,this.eb=t.S()/e.S(),this.bb=t.da()/e.da(),this.Lb=t.v-e.v*this.eb,this.Qb=t.G-e.G*this.bb)},t.prototype.SX=function(t){var i=new e.h,r=new e.h;i.na(this.eb,this.qb),r.na(this.jb,this.bb),i.sub(i);var s=.5*i.Sk();return i.na(this.eb,this.qb),r.na(this.jb,this.bb),i.add(r),t*(s>(i=.5*i.Sk())?Math.sqrt(s):Math.sqrt(i))},t.prototype.KB=function(){this.eb=1,this.qb=this.Lb=this.jb=0,this.bb=1,this.Qb=0},t.prototype.isIdentity=function(t){if(void 0!==t){var i=e.h.construct(0,1);return this.Fh(i,i),i.sub(e.h.construct(0,1)),!(i.Sk()>t*t)&&(i.na(0,0),this.Fh(i,i),!(i.Sk()>t*t)&&(i.na(1,0),this.Fh(i,i),i.sub(e.h.construct(1,0)),i.Sk()<=t*t))}return 1==this.eb&&1==this.bb&&0==this.jb&&0==this.Lb&&0==this.qb&&0==this.Qb},t.prototype.Ci=function(e){return Math.abs(this.eb*this.bb-this.qb*this.jb)<=2*e*(Math.abs(this.eb*this.bb)+Math.abs(this.qb*this.jb))},t.prototype.gg=function(e,t){this.eb=1,this.jb=0,this.Lb=e,this.qb=0,this.bb=1,this.Qb=t},t.prototype.It=function(e,t){void 0!==t?(this.eb=e,this.qb=this.Lb=this.jb=0,this.bb=t,this.Qb=0):this.It(e,e)},t.prototype.TB=function(){this.eb=0,this.jb=1,this.Lb=0,this.qb=1,this.Qb=this.bb=0},t.prototype.cX=function(e){this.dX(Math.cos(e),Math.sin(e))},t.prototype.dX=function(e,t){this.eb=e,this.jb=-t,this.Lb=0,this.qb=t,this.bb=e,this.Qb=0},t.prototype.shift=function(e,t){this.Lb+=e,this.Qb+=t},t.prototype.scale=function(e,t){this.eb*=e,this.jb*=e,this.Lb*=e,this.qb*=t,this.bb*=t,this.Qb*=t},t.prototype.flipX=function(e,t){this.eb=-this.eb,this.jb=-this.jb,this.Lb=e+t-this.Lb},t.prototype.flipY=function(e,t){this.qb=-this.qb,this.bb=-this.bb,this.Qb=e+t-this.Qb},t.prototype.rotate=function(e){var i=new t;i.cX(e),this.multiply(i)},t.prototype.inverse=function(e){if(void 0!==e){var t=this.eb*this.bb-this.jb*this.qb;0==t?e.kx():(t=1/t,e.Lb=(this.jb*this.Qb-this.Lb*this.bb)*t,e.Qb=(this.Lb*this.qb-this.eb*this.Qb)*t,e.eb=this.bb*t,e.jb=-this.jb*t,e.qb=-this.qb*t,e.bb=this.eb*t)}else this.inverse(this)},t}();e.Ed=t}($||($={})),function(e){var t=function(){function t(){}return t.prototype.kx=function(){this.Cg=this.Qb=this.Lb=this.Ze=this.We=this.Ve=this.Ye=this.bb=this.jb=this.pf=this.qb=this.eb=0},t.prototype.It=function(e,t){this.eb=e,this.jb=this.pf=this.qb=0,this.bb=t,this.We=this.Ve=this.Ye=0,this.Ze=void 0,this.Cg=this.Qb=this.Lb=0},t.prototype.translate=function(e,t,i){this.Lb+=e,this.Qb+=t,this.Cg+=i},t.prototype.fC=function(t){if(!t.B()){for(var i=new e.Od[8],r=0;8>r;r++)i[r]=new e.Od;t.hB(i),this.transform(i,8,i),t.ax(i)}},t.prototype.transform=function(t,i,r){for(var s=0;s<i;s++){var n=new e.Od,o=t[s];n.x=this.eb*o.x+this.jb*o.y+this.Ve*o.z+this.Lb,n.y=this.qb*o.x+this.bb*o.y+this.We*o.z+this.Qb,n.z=this.pf*o.x+this.Ye*o.y+this.Ze*o.z+this.Cg,r[s]=n}},t.prototype.gp=function(t){var i=new e.Od;return i.x=this.eb*t.x+this.jb*t.y+this.Ve*t.z+this.Lb,i.y=this.qb*t.x+this.bb*t.y+this.We*t.z+this.Qb,i.z=this.pf*t.x+this.Ye*t.y+this.Ze*t.z+this.Cg,i},t.prototype.Ag=function(e){t.multiply(this,e,this)},t.multiply=function(e,t,i){var r=e.eb*t.eb+e.qb*t.jb+e.pf*t.Ve,s=e.eb*t.qb+e.qb*t.bb+e.pf*t.We,n=e.eb*t.pf+e.qb*t.Ye+e.pf*t.Ze,o=e.jb*t.eb+e.bb*t.jb+e.Ye*t.Ve,a=e.jb*t.qb+e.bb*t.bb+e.Ye*t.We,l=e.jb*t.pf+e.bb*t.Ye+e.Ye*t.Ze,h=e.Ve*t.eb+e.We*t.jb+e.Ze*t.Ve,c=e.Ve*t.qb+e.We*t.bb+e.Ze*t.We,u=e.Ve*t.pf+e.We*t.Ye+e.Ze*t.Ze,p=e.Lb*t.eb+e.Qb*t.jb+e.Cg*t.Ve+t.Lb,d=e.Lb*t.qb+e.Qb*t.bb+e.Cg*t.We+t.Qb;e=e.Lb*t.pf+e.Qb*t.Ye+e.Cg*t.Ze+t.Cg,i.eb=r,i.qb=s,i.pf=n,i.jb=o,i.bb=a,i.Ye=l,i.Ve=h,i.We=c,i.Ze=u,i.Lb=p,i.Qb=d,i.Cg=e},t.inverse=function(t,i){var r=t.eb*(t.bb*t.Ze-t.Ye*t.We)-t.qb*(t.jb*t.Ze-t.Ye*t.Ve)+t.pf*(t.jb*t.We-t.bb*t.Ve);if(0==r)throw e.i.ga("math singularity");var s=1/r;r=(t.bb*t.Ze-t.Ye*t.We)*s;var n=-(t.jb*t.Ze-t.Ye*t.Ve)*s,o=(t.jb*t.We-t.bb*t.Ve)*s,a=-(t.qb*t.Ze-t.We*t.pf)*s,l=(t.eb*t.Ze-t.pf*t.Ve)*s,h=-(t.eb*t.We-t.qb*t.Ve)*s,c=(t.qb*t.Ye-t.pf*t.bb)*s,u=-(t.eb*t.Ye-t.pf*t.jb)*s;s*=t.eb*t.bb-t.qb*t.jb;var p=-(t.Lb*r+t.Qb*n+t.Cg*o),d=-(t.Lb*a+t.Qb*l+t.Cg*h);t=-(t.Lb*c+t.Qb*u+t.Cg*s),i.eb=r,i.qb=a,i.pf=c,i.jb=n,i.bb=l,i.Ye=u,i.Ve=o,i.We=h,i.Ze=s,i.Lb=p,i.Qb=d,i.Cg=t},t.prototype.Pf=function(){var e=new t;return e.eb=this.eb,e.qb=this.qb,e.pf=this.pf,e.jb=this.jb,e.bb=this.bb,e.Ye=this.Ye,e.Ve=this.Ve,e.We=this.We,e.Ze=this.Ze,e.Lb=this.Lb,e.Qb=this.Qb,e.Cg=this.Cg,e},t}();e.yY=t}($||($={})),function(e){var t=function(t){function r(e){if(void 0!==e)e=t.call(this,e.dc(),e)||this;else{(e=t.call(this)||this).cg=[],e.cg[0]=0,e.Ba=1,e.vh=[];for(var i=0;10>i;i++)e.vh[i]=-1;e.vh[e.cg[0]]=0}return e.lq=!0,e}return Z(r,t),r.prototype.se=function(e){this.hasAttribute(e)||(this.vh[e]=0,this.bD())},r.prototype.removeAttribute=function(t){if(0==t)throw e.i.O("Position attribue cannot be removed");this.hasAttribute(t)&&(this.vh[t]=-1,this.bD())},r.prototype.reset=function(){this.cg[0]=0,this.Ba=1;for(var e=0;e<this.vh.length;e++)this.vh[e]=-1;this.vh[this.cg[0]]=0,this.lq=!0},r.prototype.wF=function(){return i.fz().add(this)},r.og=function(){return i.fz().RR()},r.prototype.lM=function(){var t=this.dc();return new e.ua(t,this)},r.prototype.bD=function(){for(var e=this.Ba=0,t=0;10>e;e++)0<=this.vh[e]&&(this.cg[t]=e,this.vh[e]=t,t++,this.Ba++);this.lq=!0},r.prototype.dc=function(){return this.lq&&(this.yl=this.Bn(),this.lq=!1),this.yl},r.prototype.Nb=function(e){if(null==e)return!1;if(e==this)return!0;if(!(e instanceof r)||e.Ba!=this.Ba)return!1;for(var t=0;t<this.Ba;t++)if(this.cg[t]!=e.cg[t])return!1;return this.lq==e.lq},r.prototype.yG=function(e){if(e.Ba!=this.Ba)return!1;for(var t=0;t<this.Ba;t++)if(this.cg[t]!=e.cg[t])return!1;return!0},r.Jw=function(e,t){for(var i=[],r=0;r<e.Ba;r++)i[r]=-1;r=0;for(var s=e.Ba;r<s;r++)i[r]=t.Qf(e.qd(r));return i},r.tR=function(e,t){return(e=new r(e)).se(t),e.wF()},r.uR=function(e,t){for(var i=null,s=0;10>s;s++)!e.hasAttribute(s)&&t.hasAttribute(s)&&(null==i&&(i=new r(e)),i.se(s));return null!=i?i.wF():e},r}(e.ua);e.ee=t;var i=function(){function e(){this.map=[];var e=new t;this.add(e),(e=new t).se(1),this.add(e)}return e.fz=function(){return e.UK},e.prototype.RR=function(){return e.ft},e.prototype.add=function(t){var i=t.dc();if(null!=e.ft&&e.ft.dc()==i&&t.yG(e.ft))return e.ft;if(null!=e.Ew&&e.Ew.dc()==i&&t.yG(e.Ew))return e.Ew;var r=null;return void 0!==this.map[i]&&(r=this.map[i]),null==r&&(1==(r=t.lM()).Ba?e.ft=r:2==r.Ba&&1==r.qd(1)?e.Ew=r:this.map[i]=r),r},e.UK=new e,e}()}($||($={}));var se={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},ne={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},oe=new(function(){function e(){this.JM=50,this.op=new Map,this.hj=[]}return e.prototype.clear=function(){this.hj.length=0,this.op.clear()},e.prototype.delete=function(e){return!!this.op.delete(e)&&(this.hj.splice(this.hj.indexOf(e),1),!0)},e.prototype.get=function(e){var t=this.op.get(e);if(void 0!==t)return this.hj[0]!==e&&(this.hj.splice(this.hj.indexOf(e),1),this.hj.unshift(e)),t},e.prototype.has=function(e){return this.op.has(e)},e.prototype.set=function(e,t){return void 0!==this.get(e)&&this.delete(e),this.hj.unshift(e),this.op.set(e,t),this.gM(),this},e.prototype.gM=function(){for(;this.hj.length&&this.hj.length>this.JM;){var e=this.hj.pop();this.op.delete(e)}},e}()),ae=((W={}).convertJSONToGeometry=function(e){return $.bc.YO(e)},W.hasM=function(e){return e.hasAttribute($.Jh.M)},W.hasZ=function(e){return e.hasAttribute($.Jh.Z)},W.getPointX=function(e){return e.Mg()},W.getPointY=function(e){return e.jh()},W.getPointZ=function(e){return e.TR()},W.getPointM=function(e){return e.rR()},W.getXMin=function(e){return e.fs()},W.getYMin=function(e){return e.hs()},W.getXMax=function(e){return e.es()},W.getYMax=function(e){return e.gs()},W.getZExtent=function(e){return e.Ug($.Jh.Z,0)},W.getMExtent=function(e){return e.Ug($.Jh.M,0)},W.exportPaths=function(e){var t=[],i=e.ea(),r=null,s=null,n=e.hasAttribute($.Jh.Z),o=e.hasAttribute($.Jh.M);n&&(r=e.vb($.Jh.Z)),o&&(s=e.vb($.Jh.M));for(var a=new $.h,l=0;l<i;l++){for(var h=e.Ca(l),c=e.Ka(l),u=0,p=0,d=NaN,f=NaN,y=NaN,g=NaN,m=e.ec(l),v=[],b=h;b<h+c;b++){e.D(b,a),g=y=NaN;var w=[a.x,a.y];n&&(y=r.get(b),w.push(y)),o&&(g=s.get(b),w.push(g)),b==h&&m&&(u=a.x,p=a.y,d=y,f=g),v.push(w)}!m||u==a.x&&p==a.y&&(!n||isNaN(d)&&isNaN(y)||d==y)&&(!o||isNaN(f)&&isNaN(g)||f==g)||v.push(v[0].slice(0)),t.push(v)}return t},W.exportPathsFlat=function(){},W.exportPoints=function(e){var t=e.hasAttribute($.Jh.Z),i=e.hasAttribute($.Jh.M),r=null,s=null;t&&(r=e.vb($.Jh.Z)),i&&(s=e.vb($.Jh.M));for(var n=new $.h,o=e.I(),a=[],l=0;l<o;l++){e.D(l,n);var h=[n.x,n.y];t&&h.push(r.get(l)),i&&h.push(s.get(l)),a.push(h)}return a},W.exportPointsFlat=function(){},W);return function(){function e(){}return e.buffer=A,e.clip=l,e.contains=c,e.convexHull=x,e.crosses=u,e.cut=h,e.densify=D,e.difference=S,e.disjoint=m,e.distance=p,e.equals=d,e.extendedSpatialReferenceInfo=a,e.generalize=R,e.geodesicArea=z,e.geodesicBuffer=P,e.geodesicDensify=F,e.geodesicLength=V,e.intersect=T,e.intersects=f,e.isSimple=w,e.nearestCoordinate=O,e.nearestVertex=k,e.nearestVertices=L,e.offset=E,e.overlaps=v,e.planarArea=j,e.planarLength=N,e.relate=b,e.simplify=_,e.symmetricDifference=M,e.touches=y,e.union=I,e.within=g,e.rotate=$.Cx.rotate,e.flipHorizontal=$.Cx.BQ,e.flipVertical=$.Cx.CQ,e._enableProjection=U,e._project=q,e._getTransformation=G,e._getTransformationBySuitability=B,e}()}();void 0!==i&&(e.exports=i)}(NAe);var zAe=NAe.exports,VAe=Object.freeze(Object.assign(Object.create(null),NAe.exports,{default:zAe})),UAe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",G:zAe,g:VAe});const GAe={convertToGEGeometry:function(e,t){if(null==t)return null;let i="cache"in t?t.cache._geVersion:void 0;return null==i&&(i=e.convertJSONToGeometry(t),"cache"in t&&(t.cache._geVersion=i)),i},exportPoint:function(e,t,i){const r=e.hasZ(t),s=e.hasM(t),n=new il({x:e.getPointX(t),y:e.getPointY(t),spatialReference:i});return r&&(n.z=e.getPointZ(t)),s&&(n.m=e.getPointM(t)),n.cache._geVersion=t,n},exportPolygon:function(e,t,i){const r=new rw({rings:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportPolyline:function(e,t,i){const r=new nw({paths:e.exportPaths(t),hasZ:e.hasZ(t),hasM:e.hasM(t),spatialReference:i});return r.cache._geVersion=t,r},exportMultipoint:function(e,t,i){const r=new gb({hasZ:e.hasZ(t),hasM:e.hasM(t),points:e.exportPoints(t),spatialReference:i});return r.cache._geVersion=t,r},exportExtent:function(e,t,i){const r=e.hasZ(t),s=e.hasM(t),n=new Ol({xmin:e.getXMin(t),ymin:e.getYMin(t),xmax:e.getXMax(t),ymax:e.getYMax(t),spatialReference:i});if(r){const i=e.getZExtent(t);n.zmin=i.vmin,n.zmax=i.vmax}if(s){const i=e.getMExtent(t);n.mmin=i.vmin,n.mmax=i.vmax}return n.cache._geVersion=t,n}};var BAe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",hydratedAdapter:GAe});function qAe(e){return Array.isArray(e)?e[0].spatialReference:e&&e.spatialReference}function HAe(e,t,i){return zAe.distance(GAe,qAe(e),e,t,i)}function WAe(e){return zAe.simplify(GAe,qAe(e),e)}function $Ae(e){return"xmin"in e?"center"in e?e.center:null:"x"in e?e:"extent"in e?e.extent.center:null}function JAe(e,t,i){return zAe.geodesicArea(GAe,qAe(e),e,t,i)}function XAe(e,t,i){return zAe.geodesicLength(GAe,qAe(e),e,t,i)}var KAe=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",buffer:function(e,t,i,r=!1){return zAe.buffer(GAe,qAe(e),e,t,i,r)},clip:function(e,t){return zAe.clip(GAe,qAe(e),e,t)},contains:function(e,t){return zAe.contains(GAe,qAe(e),e,t)},convexHull:function(e,t=!1){return zAe.convexHull(GAe,qAe(e),e,t)},crosses:function(e,t){return zAe.crosses(GAe,qAe(e),e,t)},cut:function(e,t){return zAe.cut(GAe,qAe(e),e,t)},densify:function(e,t,i){return zAe.densify(GAe,qAe(e),e,t,i)},difference:function(e,t){return zAe.difference(GAe,qAe(e),e,t)},disjoint:function(e,t){return zAe.disjoint(GAe,qAe(e),e,t)},distance:HAe,equals:function(e,t){return zAe.equals(GAe,qAe(e),e,t)},extendedSpatialReferenceInfo:function(e){return zAe.extendedSpatialReferenceInfo(e)},flipHorizontal:function(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const r=e.spatialReference;if(null==(t=null!=(i=t)?i:$Ae(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(zAe.flipHorizontal(e,t));return s.spatialReference=r,s},flipVertical:function(e,t){var i;if(null==e)throw new Error("Illegal Argument Exception");const r=e.spatialReference;if(null==(t=null!=(i=t)?i:$Ae(e)))throw new Error("Illegal Argument Exception");const s=e.constructor.fromJSON(zAe.flipVertical(e,t));return s.spatialReference=r,s},generalize:function(e,t,i,r){return zAe.generalize(GAe,qAe(e),e,t,i,r)},geodesicArea:JAe,geodesicBuffer:function(e,t,i,r,s,n){return zAe.geodesicBuffer(GAe,qAe(e),e,t,i,r,s,n)},geodesicDensify:function(e,t,i,r=0){return zAe.geodesicDensify(GAe,qAe(e),e,t,i,r)},geodesicLength:XAe,intersect:function(e,t){return zAe.intersect(GAe,qAe(e),e,t)},intersects:function(e,t){return zAe.intersects(GAe,qAe(e),e,t)},isSimple:function(e){return zAe.isSimple(GAe,qAe(e),e)},nearestCoordinate:function(e,t,i=!0){return zAe.nearestCoordinate(GAe,qAe(e),e,t,i)},nearestVertex:function(e,t){return zAe.nearestVertex(GAe,qAe(e),e,t)},nearestVertices:function(e,t,i,r){return zAe.nearestVertices(GAe,qAe(e),e,t,i,r)},offset:function(e,t,i,r,s,n){return zAe.offset(GAe,qAe(e),e,t,i,r,s,n)},overlaps:function(e,t){return zAe.overlaps(GAe,qAe(e),e,t)},planarArea:function(e,t){return zAe.planarArea(GAe,qAe(e),e,t)},planarLength:function(e,t){return zAe.planarLength(GAe,qAe(e),e,t)},relate:function(e,t,i){return zAe.relate(GAe,qAe(e),e,t,i)},rotate:function(e,t,i){var r;if(null==e)throw new Error("Illegal Argument Exception");const s=e.spatialReference;if(null==(i=null!=(r=i)?r:$Ae(e)))throw new Error("Illegal Argument Exception");const n=e.constructor.fromJSON(zAe.rotate(e,t,i));return n.spatialReference=s,n},simplify:WAe,symmetricDifference:function(e,t){return zAe.symmetricDifference(GAe,qAe(e),e,t)},touches:function(e,t){return zAe.touches(GAe,qAe(e),e,t)},union:function(e,t=null){return zAe.union(GAe,qAe(e),e,t)},within:function(e,t){return zAe.within(GAe,qAe(e),e,t)}});let YAe=class extends jo{constructor(){super(...arguments),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}};Q([ro({type:Aa})],YAe.prototype,"outSpatialReference",void 0),Q([ro({type:Ol})],YAe.prototype,"processExtent",void 0),Q([ro({type:Aa})],YAe.prototype,"processSpatialReference",void 0),Q([ro({nonNullable:!0})],YAe.prototype,"returnFeatureCollection",void 0),Q([ro({nonNullable:!0})],YAe.prototype,"returnM",void 0),Q([ro({nonNullable:!0})],YAe.prototype,"returnZ",void 0),YAe=Q([Ro("esri/rest/geoprocessor/GPOptions")],YAe),YAe.from=qn(YAe);var ZAe=YAe;let QAe=class extends Ko{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};Q([ro({type:Ol})],QAe.prototype,"extent",void 0),Q([ro()],QAe.prototype,"height",void 0),Q([ro()],QAe.prototype,"href",void 0),Q([ro()],QAe.prototype,"opacity",void 0),Q([ro()],QAe.prototype,"rotation",void 0),Q([ro()],QAe.prototype,"scale",void 0),Q([ro()],QAe.prototype,"visible",void 0),Q([ro()],QAe.prototype,"width",void 0),QAe=Q([Ro("esri.layer.support.MapImage")],QAe);var ePe=QAe;let tPe=class extends Ko{constructor(e){super(e),this.itemId=null,this.url=null}};Q([ro({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],tPe.prototype,"itemId",void 0),Q([ro({type:String,json:{write:!0}})],tPe.prototype,"url",void 0),tPe=Q([Ro("esri.rest.support.DataFile")],tPe);var iPe=tPe;const rPe=new ee({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1});let sPe=class extends Ko{constructor(e){super(e),this.distance=0,this.units=null}};Q([ro({json:{write:!0}})],sPe.prototype,"distance",void 0),Q([ro({json:{read:rPe.read,write:rPe.write}})],sPe.prototype,"units",void 0),sPe=Q([Ro("esri/rest/support/LinearUnit")],sPe);var nPe=sPe;const oPe=new ee({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",GPField:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string","GPMultiValue:GPBoolean":"multi-value","GPMultiValue:GPDataFile":"multi-value","GPMultiValue:GPDate":"multi-value","GPMultiValue:GPDouble":"multi-value","GPMultiValue:GPFeatureRecordSetLayer":"multi-value","GPMultiValue:GPField":"multi-value","GPMultiValue:GPLinearUnit":"multi-value","GPMultiValue:GPLong":"multi-value","GPMultiValue:GPRasterData":"multi-value","GPMultiValue:GPRasterDataLayer":"multi-value","GPMultiValue:GPRecordSet":"multi-value","GPMultiValue:GPString":"multi-value"});let aPe=class extends Ko{constructor(e){super(e),this.dataType=null,this.value=null}};Q([ro({json:{read:oPe.read,write:oPe.write}})],aPe.prototype,"dataType",void 0),Q([ro()],aPe.prototype,"value",void 0),aPe=Q([Ro("esri.rest.support.ParameterValue")],aPe);var lPe=aPe;let hPe=class extends Ko{constructor(e){super(e),this.format=null,this.itemId=null,this.url=null}};Q([ro()],hPe.prototype,"format",void 0),Q([ro({json:{read:{source:"itemID"},write:{target:"itemID"}}})],hPe.prototype,"itemId",void 0),Q([ro()],hPe.prototype,"url",void 0),hPe=Q([Ro("esri/rest/support/RasterData")],hPe);var cPe=hPe;async function uPe(e,t,i,r,s){const n={},o={},h=[];return function(e,t,i){for(const r in e){const s=e[r];if(s&&"object"==typeof s&&s instanceof vL){const{features:e}=s;i[r]=[t.length,t.length+e.length],e.forEach((e=>{t.push(e.geometry)}))}}}(r,h,n),xk(h).then((h=>{const{outSpatialReference:c,processExtent:u,processSpatialReference:p,returnFeatureCollection:d,returnM:f,returnZ:y}=i,{path:g}=sk(e);for(const e in n){const t=n[e];o[e]=h.slice(t[0],t[1])}const m=c?c.wkid||c:null,v=p?p.wkid||p:null,b="execute"===t?{returnFeatureCollection:d||void 0,returnM:f||void 0,returnZ:y||void 0}:null,w=dPe(l(a(a(a({},u?{context:{extent:u,outSR:m,processSR:v}}:{"env:outSR":m,"env:processSR":v}),r),b),{f:"json"}),null,o),_=l(a({},s),{query:w});return $i(`${g}/${t}`,_)}))}function pPe(e){const t=e.dataType,i=lPe.fromJSON(e);switch(t){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":return i;case"GPDate":i.value=new Date(i.value);break;case"GPDataFile":i.value=iPe.fromJSON(i.value);break;case"GPLinearUnit":i.value=nPe.fromJSON(i.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const t=e.value.url;i.value=t?iPe.fromJSON(i.value):vL.fromJSON(i.value);break}case"GPRasterData":case"GPRasterDataLayer":{const t=e.value.mapImage;i.value=t?ePe.fromJSON(t):cPe.fromJSON(i.value);break}case"GPField":i.value=SO.fromJSON(i.value);break;case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return i;case"GPMultiValue:GPDate":{const e=i.value;i.value=e.map((e=>new Date(e)));break}case"GPMultiValue:GPDataFile":i.value=i.value.map((e=>iPe.fromJSON(e)));break;case"GPMultiValue:GPLinearUnit":i.value=i.value.map((e=>nPe.fromJSON(e)));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":i.value=i.value.map((e=>vL.fromJSON(e)));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":i.value=i.value.map((e=>e?ePe.fromJSON(e):cPe.fromJSON(i.value)));break;case"GPMultiValue:GPField":i.value=i.value.map((e=>SO.fromJSON(e)))}return i}function dPe(e,t,i){for(const r in e){const t=e[r];Array.isArray(t)?e[r]=JSON.stringify(t.map((e=>dPe({item:e},!0).item))):t instanceof Date&&(e[r]=t.getTime())}return nk(e,t,i)}const fPe=new ee({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"});let yPe=class extends Ko{constructor(e){super(e),this.description=null,this.type=null}};Q([ro({type:String,json:{write:!0}})],yPe.prototype,"description",void 0),Q([ro({type:String,json:{read:fPe.read,write:fPe.write}})],yPe.prototype,"type",void 0),yPe=Q([Ro("esri.rest.support.GPMessage")],yPe);var gPe,mPe=yPe;const vPe=new ee({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"});let bPe=gPe=class extends Ko{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.requestOptions=null,this.sourceUrl=null,this._timer=null}cancelJob(e){const{jobId:t,sourceUrl:i}=this,{path:r}=sk(i),s=l(a(a({},this.requestOptions),e),{query:{f:"json"}});return this._clearTimer(),$i(`${r}/jobs/${t}/cancel`,s).then((e=>{const t=gPe.fromJSON(e.data);return this.messages=t.messages,this.jobStatus=t.jobStatus,this}))}destroy(){clearInterval(this._timer)}checkJobStatus(e){const{path:t}=sk(this.sourceUrl),i=l(a(a({},this.requestOptions),e),{query:{f:"json"}});return $i(`${t}/jobs/${this.jobId}`,i).then((({data:e})=>{const t=gPe.fromJSON(e);return this.messages=t.messages,this.jobStatus=t.jobStatus,this}))}fetchResultData(e,t,i){t=ZAe.from(t||{});const{returnFeatureCollection:r,returnM:s,returnZ:n,outSpatialReference:o}=t,{path:h}=sk(this.sourceUrl),c=dPe({returnFeatureCollection:r,returnM:s,returnZ:n,outSR:o,returnType:"data",f:"json"},null),u=l(a(a({},this.requestOptions),i),{query:c});return $i(`${h}/jobs/${this.jobId}/results/${e}`,u).then((e=>pPe(e.data)))}fetchResultImage(e,t,i){const{path:r}=sk(this.sourceUrl),s=dPe(l(a({},t.toJSON()),{f:"json"})),n=l(a(a({},this.requestOptions),i),{query:s});return $i(`${r}/jobs/${this.jobId}/results/${e}`,n).then((e=>pPe(e.data)))}async fetchResultMapImageLayer(){const{path:e}=sk(this.sourceUrl),t=e.indexOf("/GPServer/"),i=`${e.substring(0,t)}/MapServer/jobs/${this.jobId}`;return new((await import("./MapImageLayer.d2c4de58.js")).default)({url:i})}async waitForJobCompletion(e={}){const{interval:t=1e3,signal:i,statusCallback:r}=e;return new Promise(((e,s)=>{ot(i,(()=>{this._clearTimer(),s(Qe())})),this._clearTimer();const n=setInterval((()=>{this._timer||s(Qe()),this.checkJobStatus(this.requestOptions).then((t=>{const{jobStatus:i}=t;switch(this.jobStatus=i,i){case"job-succeeded":this._clearTimer(),e(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":r&&r(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),s(this)}}))}),t);this._timer=n}))}_clearTimer(){this._timer&&(clearInterval(this._timer),this._timer=null)}};Q([ro()],bPe.prototype,"jobId",void 0),Q([ro({json:{read:vPe.read}})],bPe.prototype,"jobStatus",void 0),Q([ro({type:[mPe]})],bPe.prototype,"messages",void 0),Q([ro()],bPe.prototype,"requestOptions",void 0),Q([ro({json:{write:!0}})],bPe.prototype,"sourceUrl",void 0),bPe=gPe=Q([Ro("esri.rest.support.JobInfo")],bPe);var wPe=bPe;const _Pe=new ee({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),xPe=_Pe.fromJSON.bind(_Pe),SPe=_Pe.toJSON.bind(_Pe),MPe=new ee({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),TPe=MPe.fromJSON.bind(MPe),IPe=MPe.toJSON.bind(MPe),EPe="simple-marker",APe="simple-line";function PPe(e,t){const{graphic:i,renderer:r,symbol:s}=t,n=s.type;if("text"===n||"shield-label-symbol"===n||!("visualVariables"in r)||!r.visualVariables)return;const o=r.getVisualVariablesForType("size"),a=r.getVisualVariablesForType("color"),l=r.getVisualVariablesForType("opacity"),h=r.getVisualVariablesForType("rotation"),c=o&&o[0],u=a&&a[0],p=l&&l[0],d=h&&h[0];if(c){const t=YF(c,i,{shape:n===EPe?s.style:null});null!=t&&(n===EPe?e.size=RS(t):"picture-marker"===n?(e.width=RS(t),e.height=RS(t)):n===APe?e.width=RS(t):e.outline&&(e.outline.width=RS(t)))}if(u){const t=JF(u,i);(t&&n===EPe||n===APe||"simple-fill"===n)&&(e.color=t?t.toJSON():void 0)}if(p){const t=XF(p,i);null!=t&&e.color&&(e.color[3]=Math.round(255*t))}d&&(e.angle=-KF(r,i))}function CPe(e){return e&&"bing-maps"===e.type}function OPe(e){return e&&"csv"===e.type}function kPe(e){return e&&"feature"===e.type}function LPe(e){return e&&"geojson"===e.type}function RPe(e){return e&&"graphics"===e.type}function DPe(e){return e&&"group"===e.type}function FPe(e){return e&&"esri.views.2d.layers.GroupLayerView2D"===e.declaredClass}function jPe(e){return e&&"imagery"===e.type}function NPe(e){return e&&"kml"===e.type}function zPe(e){return e&&"map-image"===e.type}function VPe(e){return e&&"map-notes"===e.type}function UPe(e){return e&&"open-street-map"===e.type}function GPe(e){return e&&"stream"===e.type}function BPe(e){return e&&"tile"===e.type}function qPe(e){return e&&"vector-tile"===e.type}function HPe(e){return e&&"web-tile"===e.type}function WPe(e){return e&&"wms"===e.type}function $Pe(e){return e&&"wmts"===e.type}let JPe=class extends jo{constructor(e){super(e),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.label=null,this.layout="map-only",this.layoutOptions=null,this.outScale=0,this.scalePreserved=!0,this.showLabels=!0}};Q([ro()],JPe.prototype,"attributionVisible",void 0),Q([ro()],JPe.prototype,"exportOptions",void 0),Q([ro()],JPe.prototype,"forceFeatureAttributes",void 0),Q([ro()],JPe.prototype,"format",void 0),Q([ro()],JPe.prototype,"label",void 0),Q([ro()],JPe.prototype,"layout",void 0),Q([ro()],JPe.prototype,"layoutOptions",void 0),Q([ro()],JPe.prototype,"outScale",void 0),Q([ro()],JPe.prototype,"scalePreserved",void 0),Q([ro()],JPe.prototype,"showLabels",void 0),JPe=Q([Ro("esri.rest.support.PrintTemplate")],JPe);var XPe=JPe;const KPe={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},YPe=new ee({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),ZPe=new ee({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),QPe=new ek({returnGeometry:!0}),eCe=new Map;async function tCe(e,t,i){const r=rCe(e);let s=eCe.get(r);return Promise.resolve().then((()=>s?{data:s.gpMetadata}:(s={gpServerUrl:r,is11xService:!1,legendLayerNameMap:[],legendLayers:[]},$i(r,{query:{f:"json"}})))).then((e=>(s.gpMetadata=e.data,s.cimVersion=s.gpMetadata.cimVersion,s.is11xService=!!s.cimVersion,eCe.set(r,s),iCe(t,s)))).then((r=>{const n=function(e){return e.gpMetadata&&e.gpMetadata.executionType?ZPe.fromJSON(e.gpMetadata.executionType):"sync"}(s);let o;const a=e=>"sync"===n?e.results&&e.results[0]&&e.results[0].value:o.fetchResultData("Output_File",null,i).then((e=>e.value));return"async"===n?async function(e,t,i,r){return i=ZAe.from(i||{}),uPe(e,"submitJob",i,t,r).then((t=>{const i=wPe.fromJSON(t.data);return i.sourceUrl=e,i}))}(e,r,null,i).then((e=>(o=e,e.waitForJobCompletion({interval:t.updateDelay}).then(a)))):async function(e,t,i,r){return uPe(e,"execute",i=ZAe.from(i||{}),t,r).then((e=>{const t=e.data.results||[],i=e.data.messages||[];return{results:t.map(pPe),messages:i.map((e=>mPe.fromJSON(e)))}}))}(e,r,null,i).then(a)}))}async function iCe(e,t){t=t||{is11xService:!1,legendLayerNameMap:[],legendLayers:[]};const i=e.template||new XPe;null==i.showLabels&&(i.showLabels=!0);const r=i.exportOptions;let s;const n=IPe(i.layout);if(r&&(s={dpi:r.dpi},"map_only"===n.toLowerCase()||""===n)){const e=r.width,t=r.height;s.outputSize=[e,t]}const o=i.layoutOptions;let a;if(o){let e,t;"Miles"===o.scalebarUnit||"Kilometers"===o.scalebarUnit?(e="Kilometers",t="Miles"):"Meters"!==o.scalebarUnit&&"Feet"!==o.scalebarUnit||(e="Meters",t="Feet"),a={titleText:o.titleText,authorText:o.authorText,copyrightText:o.copyrightText,customTextElements:o.customTextElements,scaleBarOptions:{metricUnit:YPe.toJSON(e),metricLabel:KPe[e],nonMetricUnit:YPe.toJSON(t),nonMetricLabel:KPe[t]}}}let l=null;o&&o.legendLayers&&(l=o.legendLayers.map((e=>{t.legendLayerNameMap[e.layerId]=e.title;const i={id:e.layerId};return e.subLayerIds&&(i.subLayerIds=e.subLayerIds),i})));const h=await async function(e,t,i){const r=e.view;let s=r.spatialReference;const n={operationalLayers:await sCe(r,t,i)};let o=i.ssExtent||e.extent||r.extent;if(s&&s.isWrappable&&(o=o.clone()._normalize(!0),s=o.spatialReference),n.mapOptions={extent:o&&o.toJSON(),spatialReference:s&&s.toJSON(),showAttribution:t.attributionVisible},i.ssExtent=null,r.background&&(n.background=r.background.toJSON()),r.rotation&&(n.mapOptions.rotation=-r.rotation),t.scalePreserved&&(n.mapOptions.scale=t.outScale||r.scale),r.timeExtent){const e=m(r.timeExtent.start)?r.timeExtent.start.getTime():null,t=m(r.timeExtent.end)?r.timeExtent.end.getTime():null;n.mapOptions.time=[e,t]}return n}(e,i,t);if(h.operationalLayers){const e=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),i=/[\u0600-\u06FF]/,r=t=>{const r=t.text,s=t.font,n=s&&s.family&&s.family.toLowerCase();r&&s&&("arial"===n||"arial unicode ms"===n)&&(s.family=e.test(r)?"Arial Unicode MS":"Arial","normal"!==s.style&&i.test(r)&&(s.family="Arial Unicode MS"))},s=()=>{throw new Be("print-task:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};h.operationalLayers.forEach((e=>{var i,n,o;null!=(i=e.featureCollection)&&i.layers?e.featureCollection.layers.forEach((e=>{var i,n,o,a;if(null!=(i=e.layerDefinition)&&null!=(n=i.drawingInfo)&&null!=(o=n.renderer)&&o.symbol){const i=e.layerDefinition.drawingInfo.renderer;"esriTS"===i.symbol.type?r(i.symbol):"CIMSymbolReference"!==i.symbol.type||t.is11xService||s()}null!=(a=e.featureSet)&&a.features&&e.featureSet.features.forEach((e=>{e.symbol&&("esriTS"===e.symbol.type?r(e.symbol):"CIMSymbolReference"!==e.symbol.type||t.is11xService||s())}))})):!t.is11xService&&null!=(n=e.layerDefinition)&&null!=(o=n.drawingInfo)&&o.renderer&&JSON.stringify(e.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&s()}))}e.outSpatialReference&&(h.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(h,{exportOptions:s,layoutOptions:a||{}}),Object.assign(h.layoutOptions,{legendOptions:{operationalLayers:null!=l?l:t.legendLayers.slice()}}),t.legendLayers.length=0,eCe.set(t.gpServerUrl,t);const c={Web_Map_as_JSON:JSON.stringify(h),Format:SPe(i.format),Layout_Template:n};return e.extraParameters&&Object.assign(c,e.extraParameters),c}function rCe(e){let t=e;const i=t.lastIndexOf("/GPServer/");return i>0&&(t=t.slice(0,i+9)),t}async function sCe(e,t,i){const r=[],s={layerView:null,printTemplate:t,view:e};let n=0;t.scalePreserved&&(n=t.outScale||e.scale);const o=function(e,t){const i=e.allLayerViews.items;if(t===e.scale)return i.filter((e=>!e.suspended));const r=new Array;for(const s of i)FPe(s.parent)&&!r.includes(s.parent)||!s.visible||t&&"isVisibleAtScale"in s&&!s.isVisibleAtScale(t)||r.push(s);return r}(e,n);for(const a of o){const e=a.layer;if(!e.loaded||DPe(e))continue;let t;s.layerView=a,t=CPe(e)?nCe(e):OPe(e)?await oCe(e,s,i):kPe(e)?await lCe(e,s,i):LPe(e)?await hCe(e,s,i):RPe(e)?await cCe(e,s,i):jPe(e)?uCe(e,i):NPe(e)?await pCe(e,s,i):zPe(e)?dCe(e,s,i):VPe(e)?await fCe(s,i):UPe(e)?{type:"OpenStreetMap"}:GPe(e)?await gCe(e,s,i):BPe(e)?mCe(e):qPe(e)?await vCe(e,s,i):HPe(e)?bCe(e):WPe(e)?wCe(e):$Pe(e)?_Ce(e):await yCe(e,s,i),t&&(Array.isArray(t)?r.push(...t):(t.id=e.id,t.title=i.legendLayerNameMap[e.id]||e.title,t.opacity=e.opacity,t.minScale=e.minScale||0,t.maxScale=e.maxScale||0,r.push(t)))}if(n&&r.forEach((e=>{e.minScale=0,e.maxScale=0})),e.graphics&&e.graphics.length){const s=await aCe(null,e.graphics,t,i);s&&r.push(s)}return r}function nCe(e){return{culture:e.culture,key:e.key,type:"BingMaps"+("aerial"===e.style?"Aerial":"hybrid"===e.style?"Hybrid":"Road")}}async function oCe(e,{layerView:t,printTemplate:i},r){let s;return r.legendLayers&&r.legendLayers.push({id:e.id}),r.is11xService?(s={type:"CSV"},e.write(s,{origin:"web-map"}),delete s.popupInfo,delete s.layerType,s.showLabels=i.showLabels&&e.labelsVisible,s):aCe(e,await TCe(t),i,r)}async function aCe(e,t,i,r){let s;const n={layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}},o={layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}},a={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}},l={layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}},h={layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}};if(h.layerDefinition.name="textLayer",delete h.layerDefinition.drawingInfo,e){if("esri.layers.FeatureLayer"===e.declaredClass||"esri.layers.StreamLayer"===e.declaredClass?n.layerDefinition.name=o.layerDefinition.name=a.layerDefinition.name=l.layerDefinition.name=r.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:"esri.layers.GraphicsLayer"===e.declaredClass&&(t=e.graphics.items),e.renderer){const t=e.renderer.toJSON();n.layerDefinition.drawingInfo.renderer=t,o.layerDefinition.drawingInfo.renderer=t,a.layerDefinition.drawingInfo.renderer=t,l.layerDefinition.drawingInfo.renderer=t}if(i.showLabels&&e.labelsVisible&&"function"==typeof e.write){var c,u;const t=null==(c=e.write({},{origin:"web-map"}).layerDefinition)||null==(u=c.drawingInfo)?void 0:u.labelingInfo;t&&(s=!0,n.layerDefinition.drawingInfo.labelingInfo=t,o.layerDefinition.drawingInfo.labelingInfo=t,a.layerDefinition.drawingInfo.labelingInfo=t,l.layerDefinition.drawingInfo.labelingInfo=t)}}let p;null!=e&&e.renderer||s||(delete n.layerDefinition.drawingInfo,delete o.layerDefinition.drawingInfo,delete a.layerDefinition.drawingInfo,delete l.layerDefinition.drawingInfo);const d=null==e?void 0:e.fieldsIndex,f=null==e?void 0:e.renderer;if(d){if(f&&"function"==typeof f.collectRequiredFields){const e=new Set;await f.collectRequiredFields(e,d),p=Array.from(e)}const e=d.fields.map((e=>e.toJSON()));n.layerDefinition.fields=e,o.layerDefinition.fields=e,a.layerDefinition.fields=e,l.layerDefinition.fields=e}const y=t&&t.length;let g;for(let v=0;v<y;v++){const s=t[v]||t.getItemAt(v);if(!1===s.visible||!s.geometry)continue;if(g=s.toJSON(),g.hasOwnProperty("popupTemplate")&&delete g.popupTemplate,g.geometry&&g.geometry.z&&delete g.geometry.z,g.symbol&&g.symbol.outline&&"esriCLS"===g.symbol.outline.type&&!r.is11xService)continue;!r.is11xService&&g.symbol&&g.symbol.outline&&g.symbol.outline.color&&g.symbol.outline.color[3]&&(g.symbol.outline.color[3]=255);const c=e&&e.renderer&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!g.symbol&&e&&e.renderer&&c&&!r.is11xService){const t=e.renderer,i=await t.getSymbolAsync(s);if(!i)continue;g.symbol=i.toJSON(),"hasVisualVariables"in t&&t.hasVisualVariables()&&PPe(g.symbol,{renderer:t,graphic:s,symbol:i})}if(g.symbol&&(g.symbol.angle||delete g.symbol.angle,ICe(g.symbol)?g.symbol=await SCe(g.symbol,r):g.symbol.text&&delete g.attributes),(!i||!i.forceFeatureAttributes)&&p&&p.length){const e={};p.forEach((t=>{g.attributes&&g.attributes.hasOwnProperty(t)&&(e[t]=g.attributes[t])})),g.attributes=e}"polygon"===s.geometry.type?n.featureSet.features.push(g):"polyline"===s.geometry.type?o.featureSet.features.push(g):"point"===s.geometry.type?g.symbol&&g.symbol.text?h.featureSet.features.push(g):a.featureSet.features.push(g):"multipoint"===s.geometry.type?l.featureSet.features.push(g):"extent"===s.geometry.type&&(g.geometry=rw.fromExtent(s.geometry).toJSON(),n.featureSet.features.push(g))}const m=[n,o,l,a,h].filter((e=>e.featureSet.features.length>0));for(const v of m){const e=v.featureSet.features.every((e=>e.symbol));!e||i&&i.forceFeatureAttributes||v.featureSet.features.forEach((e=>{delete e.attributes})),e&&delete v.layerDefinition.drawingInfo,v.layerDefinition.drawingInfo&&v.layerDefinition.drawingInfo.renderer&&await MCe(v.layerDefinition.drawingInfo.renderer,r)}return m.length?{featureCollection:{layers:m},showLabels:s}:null}async function lCe(e,t,i){var r,s;let n;i.legendLayers&&i.legendLayers.push({id:e.id});const o=e.renderer;if(e.featureReduction||o&&"dot-density"===o.type&&(!i.is11xService||parseFloat(i.cimVersion)<2.6))return yCe(e,t,i);const{layerView:a,printTemplate:l,view:h}=t,c=o&&("valueExpression"in o&&o.valueExpression||"hasVisualVariables"in o&&o.hasVisualVariables()),u="feature-layer"!==(null==(r=e.source)?void 0:r.type)&&"ogc-feature"!==(null==(s=e.source)?void 0:s.type);if(!i.is11xService&&c||e.featureReduction||u||!o||"field"in o&&null!=o.field&&("string"!=typeof o.field||!e.getField(o.field))){const t=await TCe(a);n=await aCe(e,t,l,i)}else{var p,d;if(n={id:(f=e.write()).id,title:f.title,opacity:f.opacity,minScale:f.minScale,maxScale:f.maxScale,url:f.url,layerDefinition:f.layerDefinition},n.showLabels=l.showLabels&&e.labelsVisible,xCe(n,e),null!=(p=n.layerDefinition)&&null!=(d=p.drawingInfo)&&d.renderer&&(delete n.layerDefinition.minScale,delete n.layerDefinition.maxScale,await MCe(n.layerDefinition.drawingInfo.renderer,i),"visualVariables"in o&&o.visualVariables&&o.visualVariables[0])){const e=o.visualVariables[0];if("size"===e.type&&e.maxSize&&"number"!=typeof e.maxSize&&e.minSize&&"number"!=typeof e.minSize){const t=tj(e,h.scale);n.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=t.minSize,n.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=t.maxSize}}}var f;return n}async function hCe(e,{layerView:t,printTemplate:i},r){return r.legendLayers&&r.legendLayers.push({id:e.id}),aCe(e,await TCe(t),i,r)}async function cCe(e,{printTemplate:t},i){return aCe(e,null,t,i)}function uCe(e,t){t.legendLayers&&t.legendLayers.push({id:e.id});const i={bandIds:e.bandIds,compressionQuality:e.compressionQuality,format:e.format,interpolation:e.interpolation};if((e.mosaicRule||e.definitionExpression)&&(i.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.renderingRule||e.renderer)if(t.is11xService)e.renderingRule&&(i.renderingRule=e.renderingRule.toJSON()),e.renderer&&(i.layerDefinition=i.layerDefinition||{},i.layerDefinition.drawingInfo=i.layerDefinition.drawingInfo||{},i.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const t=e.exportImageServiceParameters.combineRendererWithRenderingRule();t&&(i.renderingRule=t.toJSON())}return xCe(i,e),i}async function pCe(e,t,i){const r=t.printTemplate;if(i.is11xService){const t={type:"kml"};return e.write(t,{origin:"web-map"}),delete t.layerType,t.url=hi(e.url),t}{const s=[],n=t.layerView;n.allVisibleMapImages.forEach(((t,i)=>{const r={id:`${e.id}_image${i}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:e.opacity,extent:t.extent};"data:image/png;base64,"===t.href.substr(0,22)?r.imageData=t.href.substr(22):r.url=t.href,s.push(r)}));const o=[...n.allVisiblePoints.items,...n.allVisiblePolylines.items,...n.allVisiblePolygons.items],l=a({id:e.id},await aCe(null,o,r,i));return s.push(l),s}}function dCe(e,{view:t},i){let r;const s={id:e.id,subLayerIds:[]};let n=[];const o=t.scale,a=e=>{const t=0===o,i=0===e.minScale||o<=e.minScale,r=0===e.maxScale||o>=e.maxScale;if(e.visible&&(t||i&&r))if(e.sublayers)e.sublayers.forEach(a);else{const t=e.toExportImageJSON(),i={id:e.id,name:e.title,layerDefinition:{drawingInfo:t.drawingInfo,definitionExpression:t.definitionExpression,source:t.source}};n.unshift(i),s.subLayerIds.push(e.id)}};return e.sublayers&&e.sublayers.forEach(a),n.length&&(n=n.map((({id:e,name:t,layerDefinition:i})=>({id:e,name:t,layerDefinition:i}))),r={layers:n,visibleLayers:e.capabilities.exportMap.supportsDynamicLayers?void 0:s.subLayerIds},xCe(r,e),i.legendLayers.push(s)),r}async function fCe({layerView:e,printTemplate:t},i){const r=[],s=e.layer;if(m(s.featureCollections))for(const n of s.featureCollections){const e=await aCe(n,n.source,t,i);e&&r.push(...e.featureCollection.layers)}else if(m(s.sublayers))for(const n of s.sublayers){const e=await aCe(null,n.graphics,t,i);e&&r.push(...e.featureCollection.layers)}return{featureCollection:{layers:r}}}async function yCe(e,{printTemplate:t,view:i},r){const s={type:"image"},n={format:"png",ignoreBackground:!0,layers:[e],rotation:0},o=r.ssExtent||i.extent.clone();let a=96,l=!0,h=!0;if(t.exportOptions){const e=t.exportOptions;e.dpi>0&&(a=e.dpi),e.width>0&&(l=e.width%2==i.width%2),e.height>0&&(h=e.height%2==i.height%2)}if("map-only"===t.layout&&t.scalePreserved&&(!t.outScale||t.outScale===i.scale)&&96===a&&(!l||!h)&&(n.area={x:0,y:0,width:i.width,height:i.height},l||(n.area.width-=1),h||(n.area.height-=1),!r.ssExtent)){const e=i.toMap(FS(n.area.width,n.area.height));o.ymin=e.y,o.xmax=e.x,r.ssExtent=o}s.extent=o.clone()._normalize(!0).toJSON();const c=await i.takeScreenshot(n),{data:u}=mi(c.dataUrl);return s.imageData=u,s}async function gCe(e,{layerView:t,printTemplate:i},r){return r.legendLayers&&r.legendLayers.push({id:e.id}),aCe(e,await TCe(t),i,r)}function mCe(e){const t={customParameters:e.customParameters};return xCe(t,e),t}async function vCe(e,t,i){if(i.is11xService&&e.serviceUrl&&e.styleUrl){const t=Ui&&Ui.findCredential(e.styleUrl),r=Ui&&Ui.findCredential(e.serviceUrl);if(!t&&!r||"2.1.0"!==i.cimVersion){const i={type:"VectorTileLayer"};return i.styleUrl=hi(e.styleUrl),t&&(i.token=t.token),r&&r.token!==i.token&&(i.additionalTokens=[{url:e.serviceUrl,token:r.token}]),i}}return yCe(e,t,i)}function bCe(e){const t={type:"WebTiledLayer",urlTemplate:e.urlTemplate.replace(/\${/g,"{"),credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(t.subDomains=e.subDomains),t}function wCe(e){let t;const i=[],r=e=>{e.visible&&(e.sublayers?e.sublayers.forEach(r):e.name&&i.unshift(e.name))};return e.sublayers&&e.sublayers.forEach(r),i.length&&(t={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:hi(e.url),version:e.version}),t}function _Ce(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:hi(e.url)}}function xCe(e,t){if(t.url)if(e.url=hi(e.url||t.url),"apiKey"in t&&t.apiKey)e.token=t.apiKey;else if(Z.apiKey&&qi(t.url))e.token=Z.apiKey;else{var i,r;e.token=null==(i=Ui)||null==(r=i.findCredential(t.url))?void 0:r.token}}async function SCe(e,t){t.canvas||(t.canvas=document.createElement("canvas"));const i=1024;t.canvas.width=i,t.canvas.height=i;const r=t.canvas.getContext("2d");let s,n;if(e.path){var o;const t=new Path2D(e.path);t.closePath(),r.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",r.fill(t);const a=function(e,t=15){const i=e.canvas.width,r=e.canvas.height,s=e.getImageData(0,0,i,r).data;let n,o,a,l,h,c;e:for(o=r;o--;)for(n=i;n--;)if(s[4*(i*o+n)+3]>t){c=o;break e}if(!c)return null;e:for(n=i;n--;)for(o=c+1;o--;)if(s[4*(i*o+n)+3]>t){h=n;break e}e:for(n=0;n<=h;++n)for(o=c+1;o--;)if(s[4*(i*o+n)+3]>t){a=n;break e}e:for(o=0;o<=c;++o)for(n=a;n<=h;++n)if(s[4*(i*o+n)+3]>t){l=o;break e}return{x:a,y:l,width:h-a,height:c-l}}(r);if(!a)return null;r.clearRect(0,0,i,i);const l=LS(e.size)/Math.max(a.width,a.height);r.scale(l,l);const h=i/l,c=h/2-a.width/2-a.x,u=h/2-a.height/2-a.y;if(r.translate(c,u),Array.isArray(e.color)&&r.fill(t),null!=(o=e.outline)&&o.width&&Array.isArray(e.outline.color)){const i=e.outline;r.lineWidth=LS(i.width)/l,r.lineJoin="round",r.strokeStyle=`rgba(${i.color[0]},${i.color[1]},${i.color[2]},${i.color[3]/255})`,r.stroke(t),a.width+=r.lineWidth,a.height+=r.lineWidth}a.width*=l,a.height*=l;const p=r.getImageData(512-a.width/2,512-a.height/2,Math.ceil(a.width),Math.ceil(a.height));s=p.width,n=p.height,r.canvas.width=s,r.canvas.height=n,r.putImageData(p,0,0)}else{const t="image/svg+xml"===e.contentType?"data:image/svg+xml;base64,"+e.imageData:e.url,i=(await $i(t,{responseType:"image"})).data;s=LS(e.width),n=LS(e.height),r.canvas.width=s,r.canvas.height=n,r.drawImage(i,0,0,r.canvas.width,r.canvas.height)}return{type:"esriPMS",imageData:r.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:RS(n),width:RS(s),xoffset:e.xoffset,yoffset:e.yoffset}}async function MCe(e,t){const i=e.type;if("simple"===i&&ICe(e.symbol))e.symbol=await SCe(e.symbol,t);else if("uniqueValue"===i||"classBreaks"===i){ICe(e.defaultSymbol)&&(e.defaultSymbol=await SCe(e.defaultSymbol,t));const r=e["uniqueValue"===i?"uniqueValueInfos":"classBreakInfos"];if(r)for(const e of r)ICe(e.symbol)&&(e.symbol=await SCe(e.symbol,t))}}async function TCe(e){return e.queryFeatures(QPe).then((e=>e.features))}function ICe(e){return e&&(e.path||"image/svg+xml"===e.contentType||e.url&&e.url.endsWith(".svg"))}let ECe=class extends jo{constructor(e){super(e),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};Q([ro()],ECe.prototype,"extent",void 0),Q([ro()],ECe.prototype,"extraParameters",void 0),Q([ro()],ECe.prototype,"outSpatialReference",void 0),Q([ro()],ECe.prototype,"template",void 0),Q([ro()],ECe.prototype,"updateDelay",void 0),Q([ro()],ECe.prototype,"view",void 0),ECe=Q([Ro("esri.rest.support.PrintParameters")],ECe);var ACe=ECe;let PCe=class extends Ko{constructor(e){super(e),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutOptions=null}};Q([ro()],PCe.prototype,"description",void 0),Q([ro({json:{read:xPe}})],PCe.prototype,"format",void 0),Q([ro()],PCe.prototype,"label",void 0),Q([ro({json:{read:TPe}})],PCe.prototype,"layout",void 0),Q([ro()],PCe.prototype,"layoutOptions",void 0),PCe=Q([Ro("esri.widgets.Print.CustomTemplate")],PCe);var CCe=PCe;const OCe=xh.ofType(CCe);let kCe=class extends ra{constructor(e){super(e),this._handles=new Mh,this.allowedFormats="all",this.allowedLayouts="all",this.defaultTemplates=new OCe,this.extraParameters=null,this.includeDefaultTemplates=!0,this.effectivePrintServiceUrl=null,this.error=null,this.portal=Yl.getDefault(),this.printServiceUrl=null,this.scaleEnabled=!1,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.print=this.print.bind(this)}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return"loading"===this.loadStatus?"initializing":this.error||"failed"===this.loadStatus?"error":this.get("view.ready")&&"loaded"===this.loadStatus?"ready":"disabled"}async load(e){return this.addResolvingPromise(this._loadResources(e).catch((e=>this.error=e))),this}async print(e){const{view:t,extraParameters:i,updateDelay:r}=this;if(!t)throw new Be("print:view-required","view is not set");const s=this._getExtent(t.viewpoint,this.scaleEnabled?e.outScale:void 0);!function(e){if(e.layoutOptions||(e.layoutOptions={}),e.layoutOptions.customTextElements||(e.layoutOptions.customTextElements=[]),!e.layoutOptions.customTextElements.find((e=>"date"in e))){const{customTextElements:t}=e.layoutOptions;t.push({date:Te(Date.now(),Me("short-date"))})}}(e);const n=new ACe({view:t,template:e,extent:s,extraParameters:i,updateDelay:r});try{return await tCe(this.effectivePrintServiceUrl,n)}catch(o){const e="print-task:cim-symbol-unsupported"===o.name?o.message:"An error occurred while exporting the web map.";throw new Be("print:export-error",e,{error:o})}}async _loadResources(e){let t=[];const{printServiceUrl:i}=this;if(!i){var r;if(this.destroyed)return;const{portal:i}=this;try{await i.load(e)}catch(n){throw new Be("print:could-not-load-portal","Cannot load print resource information from portal",{url:this.effectivePrintServiceUrl})}const o=null==(r=i.helperServices)?void 0:r.printTask;var s;o&&(this._set("effectivePrintServiceUrl",o.url),t=(null!=(s=null==o?void 0:o.templates)?s:[]).map((e=>CCe.fromJSON(e))))}t.length>0&&this.defaultTemplates.addMany(t),await this._loadServiceDescription(e)}async _loadServiceDescription(e){const t=await this._getPrintTemplatesFromService(e);this._set("templatesInfo",t)}_getPrintTemplatesFromService(e){if(-1===this.effectivePrintServiceUrl.toLowerCase().split("/").indexOf("gpserver"))throw new Be("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});return $i(this.effectivePrintServiceUrl,l(a({},e),{query:{f:"json"},timeout:6e4})).then((e=>{const t=e&&e.data,i=t&&t.parameters;let r=null,s=null;return i.forEach((e=>{let t,i=e.choiceList&&e.choiceList.slice();i&&i.length&&e.defaultValue&&(t=i.indexOf(e.defaultValue)),t>-1&&(i.splice(t,1),i.unshift(e.defaultValue));const n=(e,t)=>{const i="all"===t?e:e.filter((e=>t.indexOf(e)>-1));return 0===i.length?e:i};if("Format"===e.name){const t=n(i.map(xPe),this.allowedFormats),s=xPe(e.defaultValue);r={defaultValue:t.includes(s)?s:t[0],choiceList:t}}else if("Layout_Template"===e.name){let t,r;i=i.filter((e=>"map_only"!==e.toLowerCase())),i.some(((e,i)=>{const r=e.toLowerCase();return r.indexOf("letter")>-1&&r.indexOf("landscape")>-1?(t=i,!0):r.indexOf("a4")>-1&&r.indexOf("landscape")>-1&&(t=i,!1)})),t&&(r=i[t],i.splice(t,1),i.unshift(r));const o=n(i.map(TPe),this.allowedLayouts),a=TPe(e.defaultValue);s={defaultValue:o.includes(a)?a:o[0],choiceList:o}}})),this.error=null,{format:r,layout:s}})).catch((e=>{throw new Be("print:unavailable-service-info","Can't fetch templates info from service",{error:e})}))}_getExtent(e,t){const i=t||this.view.scale,r=this.get("view.size"),s=e?e.targetGeometry:null;return IK(new Ol,new m$({scale:i,targetGeometry:s}),r)}};Q([ro()],kCe.prototype,"allowedFormats",void 0),Q([ro()],kCe.prototype,"allowedLayouts",void 0),Q([ro({type:OCe})],kCe.prototype,"defaultTemplates",void 0),Q([ro()],kCe.prototype,"extraParameters",void 0),Q([ro()],kCe.prototype,"includeDefaultTemplates",void 0),Q([ro({aliasOf:{source:"printServiceUrl",overridable:!0},readOnly:!0})],kCe.prototype,"effectivePrintServiceUrl",void 0),Q([ro()],kCe.prototype,"error",void 0),Q([ro({type:Yl})],kCe.prototype,"portal",void 0),Q([ro()],kCe.prototype,"printServiceUrl",void 0),Q([ro({readOnly:!0})],kCe.prototype,"state",null),Q([ro()],kCe.prototype,"scaleEnabled",void 0),Q([ro({readOnly:!0})],kCe.prototype,"templatesInfo",void 0),Q([ro()],kCe.prototype,"updateDelay",void 0),Q([ro()],kCe.prototype,"view",void 0),kCe=Q([Ro("esri.widgets.Print.PrintViewModel")],kCe);var LCe=kCe;export{jw as $,WAe as A,fE as B,XAe as C,fM as D,rw as E,JAe as F,Yl as G,Rv as H,FAe as I,qh as J,jAe as K,xh as L,xS as M,$I as N,KI as O,mMe as P,Fy as Q,Ka as R,BI as S,LCe as T,XPe as U,Z as V,Ql as W,fB as X,d8 as Y,K6 as Z,t5 as _,Be as a,gce as a$,nm as a0,a5 as a1,c6 as a2,Q as a3,sa as a4,Ko as a5,vL as a6,Aa as a7,m as a8,sk as a9,Mw as aA,nA as aB,xr as aC,gs as aD,U7 as aE,dw as aF,fw as aG,E7 as aH,P7 as aI,O7 as aJ,L7 as aK,D7 as aL,j7 as aM,V7 as aN,J7 as aO,K7 as aP,$t as aQ,G7 as aR,Z7 as aS,e8 as aT,W7 as aU,tCe as aV,rCe as aW,eCe as aX,iCe as aY,Wce as aZ,nme as a_,xk as aa,$i as ab,$R as ac,te as ad,th as ae,H as af,ee as ag,mPe as ah,Ol as ai,_ as aj,rk as ak,Ei as al,J as am,Ne as an,g5 as ao,LV as ap,aU as aq,hU as ar,sz as as,A as at,st as au,et as av,Kt as aw,tt as ax,dV as ay,KV as az,Iy as b,ym as b$,rme as b0,qhe as b1,zhe as b2,eue as b3,s2 as b4,nt as b5,y as b6,Ik as b7,ot as b8,Qe as b9,en as bA,$e as bB,Rh as bC,fX as bD,bX as bE,mX as bF,$X as bG,X1 as bH,H1 as bI,W1 as bJ,J1 as bK,km as bL,mv as bM,BF as bN,G4 as bO,B4 as bP,$v as bQ,fA as bR,iH as bS,FS as bT,dm as bU,Fm as bV,Rm as bW,Um as bX,m$ as bY,WK as bZ,jS as b_,X4 as ba,ht as bb,rt as bc,a0 as bd,v as be,AX as bf,A4 as bg,E4 as bh,LS as bi,GQ as bj,N4 as bk,C4 as bl,O4 as bm,D4 as bn,R4 as bo,H4 as bp,os as bq,sh as br,Uhe as bs,k as bt,x as bu,S as bv,Z4 as bw,rK as bx,TX as by,j0 as bz,ex as c,Ja as c$,EK as c0,PX as c1,GK as c2,TK as c3,zK as c4,DK as c5,EX as c6,BK as c7,Gge as c8,Mh as c9,fk as cA,bw as cB,c2 as cC,E$ as cD,A$ as cE,lw as cF,Tb as cG,ya as cH,cw as cI,aG as cJ,lG as cK,oG as cL,_t as cM,oY as cN,sY as cO,ffe as cP,pm as cQ,hm as cR,um as cS,lm as cT,Gr as cU,ck as cV,zb as cW,xl as cX,dk as cY,uk as cZ,$a as c_,xt as ca,T as cb,Ci as cc,rR as cd,Ek as ce,v$ as cf,pw as cg,Ab as ch,Aie as ci,Oie as cj,uw as ck,JL as cl,dR as cm,pR as cn,WL as co,hw as cp,R$ as cq,Ma as cr,UA as cs,Sk as ct,hl as cu,Yb as cv,w$ as cw,D$ as cx,KB as cy,b$ as cz,C3 as d,$4 as d$,fa as d0,Ha as d1,ba as d2,mZ as d3,_Z as d4,K4 as d5,QI as d6,d0 as d7,Y4 as d8,x4 as d9,VF as dA,jF as dB,cN as dC,Sj as dD,iR as dE,hR as dF,sR as dG,oR as dH,wR as dI,mR as dJ,V4 as dK,bN as dL,U4 as dM,z4 as dN,w4 as dO,P as dP,C as dQ,OG as dR,Cs as dS,HO as dT,v0 as dU,P4 as dV,fae as dW,VQ as dX,W4 as dY,J4 as dZ,bv as d_,M4 as da,_R as db,nR as dc,DS as dd,Q4 as de,T4 as df,_v as dg,_Q as dh,BQ as di,_4 as dj,gv as dk,q4 as dl,zj as dm,ZB as dn,s_ as dp,wX as dq,gX as dr,SQ as ds,CX as dt,DX as du,BX as dv,vX as dw,I4 as dx,na as dy,pj as dz,y8 as e,Ode as e$,k4 as e0,L4 as e1,F4 as e2,j4 as e3,rs as e4,ZL as e5,YL as e6,tq as e7,De as e8,QB as e9,h as eA,x$ as eB,Wa as eC,sl as eD,gZ as eE,_$ as eF,lt as eG,Rg as eH,gb as eI,F$ as eJ,ci as eK,R as eL,Ri as eM,MV as eN,TV as eO,Ii as eP,Re as eQ,tse as eR,o9 as eS,n9 as eT,Vte as eU,Vie as eV,qye as eW,Spe as eX,Bre as eY,Are as eZ,dae as e_,n_ as ea,O as eb,VA as ec,S4 as ed,Bq as ee,kie as ef,Die as eg,Rie as eh,Lie as ei,eq as ej,TQ as ek,PQ as el,Hg as em,pt as en,HG as eo,E5 as ep,mi as eq,ra as er,XR as es,iL as et,mO as eu,lk as ev,X as ew,ZU as ex,QU as ey,eG as ez,S8 as f,Fse as f$,jm as f0,tye as f1,lie as f2,Hte as f3,Pre as f4,CZ as f5,Lge as f6,WV as f7,xte as f8,_ce as f9,$m as fA,Zde as fB,Kde as fC,Wue as fD,Xde as fE,Jle as fF,vme as fG,uue as fH,lle as fI,fme as fJ,Zte as fK,rie as fL,sde as fM,Hde as fN,Nve as fO,Lve as fP,Fve as fQ,Dve as fR,Sbe as fS,M as fT,_te as fU,VS as fV,Jse as fW,Zse as fX,Nm as fY,zae as fZ,Ene as f_,Ace as fa,mve as fb,tfe as fc,$fe as fd,Sce as fe,hfe as ff,Hfe as fg,Zle as fh,Yle as fi,Kle as fj,wce as fk,mfe as fl,cfe as fm,wfe as fn,gfe as fo,ife as fp,mhe as fq,Sfe as fr,Ife as fs,ohe as ft,ahe as fu,Efe as fv,lhe as fw,Pfe as fx,Xle as fy,Zre as fz,ite as g,yY as g$,NS as g0,Or as g1,rY as g2,Qye as g3,GS as g4,Dv as g5,MQ as g6,Zm as g7,One as g8,Bne as g9,aY as gA,ege as gB,Xye as gC,Mte as gD,_r as gE,Sr as gF,Mr as gG,Cye as gH,hve as gI,gge as gJ,PZ as gK,sie as gL,L$ as gM,EZ as gN,Ete as gO,US as gP,$se as gQ,Koe as gR,sne as gS,wv as gT,Jm as gU,Goe as gV,Hoe as gW,Voe as gX,Xoe as gY,Uoe as gZ,Joe as g_,Ym as ga,Bae as gb,Gae as gc,zS as gd,Dm as ge,Sm as gf,qm as gg,Wae as gh,NX as gi,rde as gj,wZ as gk,xZ as gl,k$ as gm,fge as gn,Ape as go,lY as gp,xA as gq,HZ as gr,DZ as gs,Sv as gt,nY as gu,Rse as gv,Mve as gw,ese as gx,Kse as gy,Xm as gz,Z8 as h,ev as h$,vY as h0,uY as h1,gY as h2,hY as h3,pY as h4,cY as h5,hv as h6,h9 as h7,$oe as h8,uae as h9,nue as hA,rhe as hB,Jde as hC,qfe as hD,ihe as hE,Ofe as hF,Rfe as hG,jfe as hH,Ffe as hI,Cfe as hJ,Afe as hK,gve as hL,fve as hM,cme as hN,Ra as hO,c$ as hP,Rn as hQ,fY as hR,ane as hS,Fde as hT,_Y as hU,ube as hV,Yse as hW,Ese as hX,Ose as hY,moe as hZ,voe as h_,Ote as ha,qoe as hb,Woe as hc,_oe as hd,woe as he,Pve as hf,Ate as hg,yoe as hh,Nse as hi,Zne as hj,nv as hk,Hm as hl,Jv as hm,I as hn,Eq as ho,Vse as hp,Km as hq,Dte as hr,Rte as hs,fm as ht,h$ as hu,Mv as hv,Qse as hw,ine as hx,g as hy,dn as hz,Dh as i,Jce as i$,FX as i0,LX as i1,RX as i2,lme as i3,GX as i4,Gm as i5,L as i6,Mb as i7,Ib as i8,ns as i9,kae as iA,xY as iB,mue as iC,yue as iD,vue as iE,gue as iF,Lae as iG,XX as iH,ov as iI,pv as iJ,cv as iK,Fre as iL,Gre as iM,xv as iN,Rae as iO,MY as iP,ene as iQ,Us as iR,afe as iS,lfe as iT,jse as iU,Nue as iV,zue as iW,tJ as iX,due as iY,Vue as iZ,Zae as i_,bbe as ia,Eb as ib,HAe as ic,Lte as id,kse as ie,Ane as ig,Pne as ih,Gne as ii,Cne as ij,nne as ik,Bm as il,qne as im,Iv as io,Hne as ip,$ne as iq,Xne as ir,Hae as is,rv as it,Vne as iu,cse as iv,hse as iw,j$ as ix,N$ as iy,nK as iz,jh as j,RI as j$,w as j0,Yde as j1,hpe as j2,Wm as j3,Wde as j4,hue as j5,iae as j6,hn as j7,lae as j8,SY as j9,Ste as jA,nG as jB,Bve as jC,Hve as jD,qve as jE,Use as jF,xce as jG,Bfe as jH,RQ as jI,une as jJ,so as jK,zM as jL,NM as jM,bs as jN,pi as jO,BM as jP,di as jQ,zr as jR,Th as jS,WM as jT,KJ as jU,Bh as jV,qJ as jW,Une as jX,C$ as jY,LZ as jZ,qte as j_,$ce as ja,lue as jb,yge as jc,j as jd,uE as je,n$ as jf,Pde as jg,Epe as jh,Due as ji,Fue as jj,eie as jk,wge as jl,Sb as jm,xb as jn,tne as jo,jue as jp,vve as jq,Gfe as jr,kfe as js,npe as jt,fue as ju,kne as jv,Kne as jw,$ae as jx,yve as jy,dve as jz,wwe as k,uge as k$,tG as k0,dI as k1,iG as k2,zI as k3,rG as k4,bI as k5,RM as k6,KU as k7,YU as k8,qie as k9,nge as kA,Mm as kB,_ge as kC,bme as kD,_me as kE,Sme as kF,kme as kG,xme as kH,Mme as kI,_fe as kJ,ipe as kK,yme as kL,dme as kM,mge as kN,vge as kO,eI as kP,age as kQ,gm as kR,bge as kS,DQ as kT,tie as kU,gle as kV,Bte as kW,dY as kX,Aq as kY,PS as kZ,XM as k_,Ak as ka,aie as kb,yie as kc,Age as kd,Bie as ke,kZ as kf,Nte as kg,Uie as kh,Lg as ki,Gte as kj,$te as kk,I$ as kl,hie as km,sge as kn,pge as ko,Pge as kp,gne as kq,nie as kr,oie as ks,pie as kt,cge as ku,iie as kv,ss as kw,fT as kx,fv as ky,Oge as kz,bte as l,hae as l$,Nme as l0,zge as l1,Nge as l2,jge as l3,Fge as l4,Dge as l5,Rge as l6,RS as l7,IZ as l8,EQ as l9,Tv as lA,Ufe as lB,vfe as lC,nhe as lD,efe as lE,Ute as lF,epe as lG,lge as lH,nde as lI,zZ as lJ,Lne as lK,_le as lL,mme as lM,ule as lN,Tpe as lO,Nhe as lP,Bs as lQ,z$ as lR,S$ as lS,Rre as lT,at as lU,cie as lV,zA as lW,VV as lX,ks as lY,In as lZ,Pn as l_,Ede as la,o$ as lb,AQ as lc,dle as ld,cle as le,ale as lf,mle as lg,hle as lh,vle as li,kpe as lj,dne as lk,Yte as ll,Ye as lm,ape as ln,Uue as lo,Xce as lp,Kce as lq,Qte as lr,oge as ls,hge as lt,zm as lu,Am as lv,sK as lw,WX as lx,zX as ly,Kue as lz,b8 as m,fi as m$,_j as m0,Cge as m1,Ege as m2,Fh as m3,Hh as m4,Gh as m5,iJ as m6,ut as m7,wN as m8,Gie as m9,ade as mA,ufe as mB,Wfe as mC,Xhe as mD,Ome as mE,dfe as mF,bfe as mG,rfe as mH,tpe as mI,MN as mJ,Tle as mK,wle as mL,Mle as mM,Vm as mN,VM as mO,$1 as mP,Un as mQ,_A as mR,va as mS,_a as mT,Sa as mU,Ua as mV,jQ as mW,qle as mX,Hle as mY,Ble as mZ,Gle as m_,AZ as ma,Nie as mb,hI as mc,Jye as md,SMe as me,i_ as mf,HN as mg,Qs as mh,die as mi,MMe as mj,P$ as mk,M$ as ml,O$ as mm,sH as mn,Hv as mo,ek as mp,rge as mq,Uh as mr,Zo as ms,q7 as mt,D as mu,ds as mv,us as mw,Oue as mx,wue as my,kue as mz,Ro as n,Y$ as n$,yi as n0,mY as n1,Ile as n2,xle as n3,ai as n4,Ele as n5,Sle as n6,Dle as n7,ble as n8,Ole as n9,ct as nA,mw as nB,iU as nC,p_ as nD,y_ as nE,S_ as nF,b_ as nG,__ as nH,w_ as nI,d_ as nJ,f_ as nK,W_ as nL,wt as nM,dt as nN,cs as nO,AV as nP,gt as nQ,x_ as nR,J$ as nS,XN as nT,kg as nU,Q$ as nV,dZ as nW,fZ as nX,yZ as nY,vZ as nZ,RK as n_,V as na,z as nb,Pbe as nc,wJ as nd,Roe as ne,Zie as nf,mb as ng,Ub as nh,Doe as ni,Foe as nj,joe as nk,mre as nl,E as nm,_b as nn,Ooe as no,hJ as np,S0 as nq,P0 as nr,F0 as ns,Ca as nt,Og as nu,IQ as nv,CQ as nw,OQ as nx,LQ as ny,Qo as nz,Swe as o,FA as o$,zi as o0,Jt as o1,Ui as o2,Li as o3,fie as o4,Vb as o5,xMe as o6,XB as o7,b5 as o8,kQ as o9,vR as oA,XL as oB,BL as oC,dl as oD,Il as oE,nl as oF,ole as oG,ple as oH,fle as oI,yle as oJ,Ale as oK,Ple as oL,Cle as oM,kle as oN,Lle as oO,Rle as oP,Fle as oQ,jle as oR,Nle as oS,zle as oT,Vle as oU,Ule as oV,hs as oW,F as oX,wA as oY,EY as oZ,IY as o_,UQ as oa,l6 as ob,mN as oc,Xa as od,Ze as oe,SO as of,yt as og,ft as oh,Tl as oi,mt as oj,le as ok,zAe as ol,Ta as om,V$ as on,gR as oo,D_ as op,bie as oq,Nj as or,jj as os,Yoe as ot,b as ou,f6 as ov,Kb as ow,GA as ox,ga as oy,kL as oz,jo as p,fs as p$,Dg as p0,dL as p1,hL as p2,Ok as p3,cR as p4,lL as p5,pL as p6,zte as p7,xU as p8,zh as p9,pF as pA,xF as pB,a9 as pC,gr as pD,_i as pE,si as pF,xi as pG,ow as pH,f9 as pI,u9 as pJ,c9 as pK,g9 as pL,p9 as pM,m9 as pN,k5 as pO,o6 as pP,a6 as pQ,v9 as pR,b9 as pS,CT as pT,H$ as pU,eae as pV,Nbe as pW,Obe as pX,fre as pY,zbe as pZ,ore as p_,vO as pa,M_ as pb,tR as pc,R_ as pd,N_ as pe,z_ as pf,H_ as pg,zie as ph,eL as pi,jie as pj,Qk as pk,Jk as pl,Dk as pm,rA as pn,cL as po,uR as pp,vN as pq,AL as pr,PL as ps,Fa as pt,lR as pu,Pk as pv,N as pw,Jve as px,Qm as py,Yn as pz,nwe as q,eU as q$,bq as q0,_q as q1,GMe as q2,wq as q3,HMe as q4,bTe as q5,aq as q6,lq as q7,eT as q8,cq as q9,li as qA,Ti as qB,Jfe as qC,Eme as qD,Ime as qE,Ame as qF,bve as qG,Nce as qH,upe as qI,cpe as qJ,nz as qK,QV as qL,RG as qM,oo as qN,jg as qO,QS as qP,rU as qQ,ZV as qR,EV as qS,IV as qT,CV as qU,OV as qV,YV as qW,ES as qX,PI as qY,eh as qZ,nk as q_,YB as qa,RV as qb,SU as qc,pU as qd,uU as qe,vV as qf,DV as qg,vMe as qh,M6 as qi,Fg as qj,sU as qk,JV as ql,Dn as qm,tE as qn,MO as qo,qn as qp,Tr as qq,JG as qr,gG as qs,WN as qt,$N as qu,VO as qv,PG as qw,Kv as qx,wMe as qy,ws as qz,rwe as r,hbe as r$,vt as r0,no as r1,ZD as r2,QD as r3,wj as r4,RF as r5,Dq as r6,rj as r7,Fq as r8,KF as r9,Ah as rA,VG as rB,zv as rC,$V as rD,SG as rE,MG as rF,YN as rG,JN as rH,xG as rI,oU as rJ,nU as rK,co as rL,nE as rM,SV as rN,kV as rO,Wo as rP,aa as rQ,SA as rR,XO as rS,ik as rT,zU as rU,r_ as rV,Te as rW,Me as rX,Ce as rY,WU as rZ,yv as r_,Fj as ra,Ij as rb,Zn as rc,YD as rd,nF as re,SN as rf,PV as rg,c5 as rh,y5 as ri,MZ as rj,Jo as rk,jM as rl,Fe as rm,aw as rn,l_ as ro,c_ as rp,AU as rq,_G as rr,bG as rs,NG as rt,XV as ru,Bt as rv,bi as rw,hi as rx,Le as ry,Yx as rz,Pg as s,qse as s0,Gse as s1,Kve as s2,Ade as s3,cr as s4,yL as s5,bL as s6,Wj as s7,yB as s8,l5 as s9,u6 as sa,Mwe as sb,KAe as sc,RAe as t,gte as u,il as v,Ibe as w,xy as x,ro as y,nw as z};
