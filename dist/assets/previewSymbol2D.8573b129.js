var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&o(e,t,a[t]);return e},r=(e,l)=>a(e,t(l));import{bi as c,q0 as u,q1 as m,H as p,q2 as h,a as d,q3 as f,q4 as y,q5 as v,l7 as b}from"./vendor.c9efa5f2.js";const w="picture-fill",g=120,M=document.createElement("canvas");function x(e,a){var t,l;const n=null!=(null==a?void 0:a.size)?c(a.size):null,s=null!=(null==a?void 0:a.maxSize)?c(a.maxSize):null,o=null!=(null==a?void 0:a.opacity)?a.opacity:null,x=null!=(null==a?void 0:a.rotation)?a.rotation:"angle"in e?e.angle:null,k=u(e);let L=m(e);if(k&&!L){const e="type"in k?null:new p(k);"#ffffff"===(e?e.toHex():null)&&(L={color:"#bdc3c7",width:.75})}const j={shape:null,fill:null,stroke:L,offset:[0,0]};null!=(t=L)&&t.width&&(L.width=Math.min(L.width,80));const z=(null==(l=L)?void 0:l.width)||0;let q=null!=n&&(null==(null==a?void 0:a.scale)||(null==a?void 0:a.scale)),O=0,P=0,C=!1;switch(e.type){case"simple-marker":{const a=e.style,t=Math.min(null!=n?n:c(e.size),s||g);switch(O=t,P=t,a){case"circle":j.shape={type:"circle",cx:0,cy:0,r:.5*t},q||(O+=z,P+=z);break;case"cross":j.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[O,.5*P]},{command:"M",values:[.5*O,0]},{command:"L",values:[.5*O,P]}]};break;case"diamond":j.shape={type:"path",path:[{command:"M",values:[0,.5*P]},{command:"L",values:[.5*O,0]},{command:"L",values:[O,.5*P]},{command:"L",values:[.5*O,P]},{command:"Z",values:[]}]},q||(O+=z,P+=z);break;case"square":j.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[O,0]},{command:"L",values:[O,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},q||(O+=z,P+=z),x&&(C=!0);break;case"triangle":j.shape={type:"path",path:[{command:"M",values:[.5*O,0]},{command:"L",values:[O,P]},{command:"L",values:[0,P]},{command:"Z",values:[]}]},q||(O+=z,P+=z),x&&(C=!0);break;case"x":j.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[O,P]},{command:"M",values:[O,0]},{command:"L",values:[0,P]}]},x&&(C=!0);break;case"path":j.shape={type:"path",path:e.path||""},q||(O+=z,P+=z),x&&(C=!0),q=!0}break}case"simple-line":{const e=Math.min(null!=n?n:z,s||80),a=e>22?2*e:40;L.width=e,O=a,P=e,j.shape={type:"path",path:[{command:"M",values:[0,P]},{command:"L",values:[O,P]}]};break}case w:case"simple-fill":O=Math.min(null!=n?n:22,s||g)+z,P=O,q=!0,j.shape="object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.isSquareFill?h.squareFill[0]:h.fill[0];break;case"picture-marker":{let a=c(e.width),t=c(e.height);const l=Math.max(a,t),o=a/t;a=o<=1?Math.ceil(l*o):l,t=o<=1?l:Math.ceil(l/o),O=Math.min(null!=n?n:a,s||g),P=Math.min(null!=n?n:t,s||g),j.shape={type:"image",x:-Math.round(O/2),y:-Math.round(P/2),width:O,height:P,src:e.url||""},x&&(C=!0);break}case"text":{const a=e,t=a.text||"Aa",l=a.font,o=Math.min(null!=n?n:c(l.size),s||g),i=function(e,a){const t=M.getContext("2d"),l=[];return a&&(a.weight&&l.push(a.weight),a.size&&l.push(a.size+"px"),a.family&&l.push(a.family)),t.font=l.join(" "),t.measureText(e).width}(t,{weight:l.weight,size:o,family:l.family}),r=/[\uE600-\uE6FF]/.test(t);O=r?o:i,P=o;let u=.25*function(e){if(0===e.length)return 0;if(e.length>2){const a=b(1),t=parseFloat(e);switch(e.slice(-2)){case"px":return t;case"pt":return t*a;case"in":return 72*t*a;case"pc":return 12*t*a;case"mm":return 2.8346456692913384*t*a;case"cm":return 28.346456692913385*t*a}}return parseFloat(e)}((l?o:0).toString());r&&(u+=5),j.shape={type:"text",text:t,x:0,y:u,align:"middle",decoration:l&&l.decoration,rotated:a.rotated,kerning:a.kerning},j.font=l&&{size:o,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!j.shape)return Promise.reject(new d("symbolPreview: renderPreviewHTML2D","symbol not supported."));const S=k,F=e.color;let E=null;return S&&"pattern"===S.type&&F&&e.type!==w?E=f(S.src,F.toCss(!0)).then((e=>(S.src=e,j.fill=S,j))):(j.fill=k,E=Promise.resolve(j)),E.then((e=>{const t=[[e]];if("object"==typeof(null==a?void 0:a.symbolConfig)&&null!=a&&a.symbolConfig.applyColorModulation){const a=.6*O;t.unshift([r(i({},e),{offset:[-a,0],fill:y(k,-.3)})]),t.push([r(i({},e),{offset:[a,0],fill:y(k,.3)})]),O+=2*a}return v(t,[O,P],{node:a&&a.node,scale:q,opacity:o,rotation:x,useRotationSize:C})}))}export{x as previewSymbol2D};
