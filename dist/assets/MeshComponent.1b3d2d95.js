var t,e=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o;import{a3 as l,y as u,mO as c,dy as p,a4 as h,n as d,a5 as g,jM as m,mP as y,mQ as f,H as w,a8 as v,an as T,hO as x,af as D}from"./vendor.c9efa5f2.js";const b=new WeakMap;let j=0,C=t=class extends g{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,o){if(t instanceof HTMLImageElement){const a={type:"image-element",src:m(t.src,o),crossOrigin:t.crossOrigin};e[r]=a}else if(t instanceof HTMLCanvasElement){const o=t.getContext("2d").getImageData(0,0,t.width,t.height),a={type:"canvas-element",imageData:this.encodeImageData(o)};e[r]=a}else if(t instanceof HTMLVideoElement){const a={type:"video-element",src:m(t.src,o),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=a}else{const o={type:"image-data",imageData:this.encodeImageData(t)};e[r]=o}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this.decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this.decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this.imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this.imageDataContainsTransparent(t);if(e){const t=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(".png"===t||"data:image/png;"===r)return!0}return!1}set transparent(t){null!=t?this._override("transparent",t):this._clearOverride("transparent")}get contentHash(){const t="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(e="")=>`d:${e},t:${this.transparent},w:${t}`;return null!=this.url?e(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(b.has(this.data)||b.set(this.data,++j),e(b.get(this.data))):e()}clone(){const e={url:this.url,data:this.data,wrap:this.cloneWrap()};return new t(e)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return y(r,t.width,t.height)}imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(255!==t.data[e])return!0;return!1}static from(e){return"string"==typeof e?new t({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new t({data:e}):f(t,e)}};l([u({type:String,json:{write:c}})],C.prototype,"url",null),l([u({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),u()],C.prototype,"data",null),l([p("data")],C.prototype,"writeData",null),l([h("data")],C.prototype,"readData",null),l([u({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],C.prototype,"transparent",null),l([u({json:{write:!0}})],C.prototype,"wrap",void 0),l([u({readOnly:!0})],C.prototype,"contentHash",null),C=t=l([d("esri.geometry.support.MeshTexture")],C);var M,A=C;let O=M=class extends g{constructor(t){super(t),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=v(t)?t.get(this):null;if(r)return r;const o=new M(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,o),o}clonePropertiesWithDeduplication(t){return{color:v(this.color)?this.color.clone():null,colorTexture:v(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:v(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};l([u({type:w,json:{write:!0}})],O.prototype,"color",void 0),l([u({type:A,json:{write:!0}})],O.prototype,"colorTexture",void 0),l([u({type:A,json:{write:!0}})],O.prototype,"normalTexture",void 0),l([u({nonNullable:!0,json:{write:!0}})],O.prototype,"alphaMode",void 0),l([u({nonNullable:!0,json:{write:!0}})],O.prototype,"alphaCutoff",void 0),l([u({nonNullable:!0,json:{write:!0}})],O.prototype,"doubleSided",void 0),O=M=l([d("esri.geometry.support.MeshMaterial")],O);var W,I=O;let N=W=class extends I{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=v(t)?t.get(this):null;if(r)return r;const o=new W(this.clonePropertiesWithDeduplication(e));return v(t)&&t.set(this,o),o}clonePropertiesWithDeduplication(t){return e=((t,e)=>{for(var r in e||(e={}))n.call(e,r)&&s(t,r,e[r]);if(a)for(var r of a(e))i.call(e,r)&&s(t,r,e[r]);return t})({},super.clonePropertiesWithDeduplication(t)),l={emissiveColor:v(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:v(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:v(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:v(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null},r(e,o(l));var e,l}};l([u({type:w,json:{write:!0}})],N.prototype,"emissiveColor",void 0),l([u({type:A,json:{write:!0}})],N.prototype,"emissiveTexture",void 0),l([u({type:A,json:{write:!0}})],N.prototype,"occlusionTexture",void 0),l([u({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],N.prototype,"metallic",void 0),l([u({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],N.prototype,"roughness",void 0),l([u({type:A,json:{write:!0}})],N.prototype,"metallicRoughnessTexture",void 0),N=W=l([d("esri.geometry.support.MeshMaterialMetallicRoughness")],N);var P,F=N;const S=T.getLogger("esri.geometry.support.MeshVertexAttributes");let L=P=class extends g{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return H(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},S)}castPosition(t){return t&&t instanceof Float32Array&&S.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),H(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},S)}castUv(t){return H(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},S)}castNormal(t){return H(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},S)}castTangent(t){return H(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},S)}clone(){const t={position:D(this.position),uv:D(this.uv),normal:D(this.normal),tangent:D(this.tangent),color:D(this.color)};return new P(t)}clonePositional(){const t={position:D(this.position),normal:D(this.normal),tangent:D(this.tangent),uv:this.uv,color:this.color};return new P(t)}};function E(t,e,r,o){const{loggerTag:a,stride:n}=e;return t.length%n!=0?(o.error(a,`Invalid array length, expected a multiple of ${n}`),new r([])):t}function H(t,e,r,o,a){if(!t)return t;if(t instanceof e)return E(t,o,e,a);for(const n of r)if(t instanceof n)return E(new e(t),o,e,a);if(Array.isArray(t))return E(new e(t),o,e,a);{const o=r.map((t=>`'${t.name}'`));return a.error(`Failed to set property, expected one of ${o}, but got ${t.constructor.name}`),new e([])}}function $(t,e,r){e[r]=function(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}(t)}l([u({json:{write:$}})],L.prototype,"color",void 0),l([x("color")],L.prototype,"castColor",null),l([u({nonNullable:!0,json:{write:$}})],L.prototype,"position",void 0),l([x("position")],L.prototype,"castPosition",null),l([u({json:{write:$}})],L.prototype,"uv",void 0),l([x("uv")],L.prototype,"castUv",null),l([u({json:{write:$}})],L.prototype,"normal",void 0),l([x("normal")],L.prototype,"castNormal",null),l([u({json:{write:$}})],L.prototype,"tangent",void 0),l([x("tangent")],L.prototype,"castTangent",null),L=P=l([d("esri.geometry.support.MeshVertexAttributes")],L);var _,R=L;const U=T.getLogger("esri.geometry.support.MeshComponent");let V=_=class extends g{constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(t){return f(_,t)}castFaces(t){return H(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},U)}castMaterial(t){return f(t&&"object"==typeof t&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?F:I,t)}clone(){return new _({faces:D(this.faces),shading:this.shading,material:D(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:D(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new _(r)}};l([u({json:{write:!0}})],V.prototype,"faces",void 0),l([x("faces")],V.prototype,"castFaces",null),l([u({type:I,json:{write:!0}})],V.prototype,"material",void 0),l([x("material")],V.prototype,"castMaterial",null),l([u({type:String,json:{write:!0}})],V.prototype,"shading",void 0),l([u({type:Boolean})],V.prototype,"trustSourceNormals",void 0),V=_=l([d("esri.geometry.support.MeshComponent")],V);var z=V;export{F as c,z as f,A as m,L as p,R as y};
